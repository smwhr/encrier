var sm=Object.defineProperty,om=Object.defineProperties;var lm=Object.getOwnPropertyDescriptors;var Rh=Object.getOwnPropertySymbols;var am=Object.prototype.hasOwnProperty,um=Object.prototype.propertyIsEnumerable;var Lh=(t,e,n)=>e in t?sm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ei=(t,e)=>{for(var n in e||(e={}))am.call(e,n)&&Lh(t,n,e[n]);if(Rh)for(var n of Rh(e))um.call(e,n)&&Lh(t,n,e[n]);return t},Dh=(t,e)=>om(t,lm(e));var oe={exports:{}},Z={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Vh=Object.getOwnPropertySymbols,hm=Object.prototype.hasOwnProperty,cm=Object.prototype.propertyIsEnumerable;function fm(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function dm(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Jf=dm()?Object.assign:function(t,e){for(var n,r=fm(t),i,s=1;s<arguments.length;s++){n=Object(arguments[s]);for(var o in n)hm.call(n,o)&&(r[o]=n[o]);if(Vh){i=Vh(n);for(var l=0;l<i.length;l++)cm.call(n,i[l])&&(r[i[l]]=n[i[l]])}}return r};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eu=Jf,Rr=60103,Qf=60106;Z.Fragment=60107;Z.StrictMode=60108;Z.Profiler=60114;var Xf=60109,Yf=60110,Zf=60112;Z.Suspense=60113;var ed=60115,td=60116;if(typeof Symbol=="function"&&Symbol.for){var gt=Symbol.for;Rr=gt("react.element"),Qf=gt("react.portal"),Z.Fragment=gt("react.fragment"),Z.StrictMode=gt("react.strict_mode"),Z.Profiler=gt("react.profiler"),Xf=gt("react.provider"),Yf=gt("react.context"),Zf=gt("react.forward_ref"),Z.Suspense=gt("react.suspense"),ed=gt("react.memo"),td=gt("react.lazy")}var Wh=typeof Symbol=="function"&&Symbol.iterator;function pm(t){return t===null||typeof t!="object"?null:(t=Wh&&t[Wh]||t["@@iterator"],typeof t=="function"?t:null)}function os(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rd={};function Lr(t,e,n){this.props=t,this.context=e,this.refs=rd,this.updater=n||nd}Lr.prototype.isReactComponent={};Lr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(os(85));this.updater.enqueueSetState(this,t,e,"setState")};Lr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function id(){}id.prototype=Lr.prototype;function Pu(t,e,n){this.props=t,this.context=e,this.refs=rd,this.updater=n||nd}var Ou=Pu.prototype=new id;Ou.constructor=Pu;Eu(Ou,Lr.prototype);Ou.isPureReactComponent=!0;var xu={current:null},sd=Object.prototype.hasOwnProperty,od={key:!0,ref:!0,__self:!0,__source:!0};function ld(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)sd.call(e,r)&&!od.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){for(var a=Array(l),u=0;u<l;u++)a[u]=arguments[u+2];i.children=a}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:Rr,type:t,key:s,ref:o,props:i,_owner:xu.current}}function mm(t,e){return{$$typeof:Rr,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Tu(t){return typeof t=="object"&&t!==null&&t.$$typeof===Rr}function gm(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var jh=/\/+/g;function Ml(t,e){return typeof t=="object"&&t!==null&&t.key!=null?gm(""+t.key):e.toString(36)}function ho(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Rr:case Qf:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Ml(o,0):r,Array.isArray(i)?(n="",t!=null&&(n=t.replace(jh,"$&/")+"/"),ho(i,e,n,"",function(u){return u})):i!=null&&(Tu(i)&&(i=mm(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(jh,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Array.isArray(t))for(var l=0;l<t.length;l++){s=t[l];var a=r+Ml(s,l);o+=ho(s,e,n,a,i)}else if(a=pm(t),typeof a=="function")for(t=a.call(t),l=0;!(s=t.next()).done;)s=s.value,a=r+Ml(s,l++),o+=ho(s,e,n,a,i);else if(s==="object")throw e=""+t,Error(os(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e));return o}function As(t,e,n){if(t==null)return t;var r=[],i=0;return ho(t,r,"","",function(s){return e.call(n,s,i++)}),r}function vm(t){if(t._status===-1){var e=t._result;e=e(),t._status=0,t._result=e,e.then(function(n){t._status===0&&(n=n.default,t._status=1,t._result=n)},function(n){t._status===0&&(t._status=2,t._result=n)})}if(t._status===1)return t._result;throw t._result}var ad={current:null};function Gt(){var t=ad.current;if(t===null)throw Error(os(321));return t}var ym={ReactCurrentDispatcher:ad,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:xu,IsSomeRendererActing:{current:!1},assign:Eu};Z.Children={map:As,forEach:function(t,e,n){As(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return As(t,function(){e++}),e},toArray:function(t){return As(t,function(e){return e})||[]},only:function(t){if(!Tu(t))throw Error(os(143));return t}};Z.Component=Lr;Z.PureComponent=Pu;Z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ym;Z.cloneElement=function(t,e,n){if(t==null)throw Error(os(267,t));var r=Eu({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=xu.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(a in e)sd.call(e,a)&&!od.hasOwnProperty(a)&&(r[a]=e[a]===void 0&&l!==void 0?l[a]:e[a])}var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){l=Array(a);for(var u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:Rr,type:t.type,key:i,ref:s,props:r,_owner:o}};Z.createContext=function(t,e){return e===void 0&&(e=null),t={$$typeof:Yf,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:Xf,_context:t},t.Consumer=t};Z.createElement=ld;Z.createFactory=function(t){var e=ld.bind(null,t);return e.type=t,e};Z.createRef=function(){return{current:null}};Z.forwardRef=function(t){return{$$typeof:Zf,render:t}};Z.isValidElement=Tu;Z.lazy=function(t){return{$$typeof:td,_payload:{_status:-1,_result:t},_init:vm}};Z.memo=function(t,e){return{$$typeof:ed,type:t,compare:e===void 0?null:e}};Z.useCallback=function(t,e){return Gt().useCallback(t,e)};Z.useContext=function(t,e){return Gt().useContext(t,e)};Z.useDebugValue=function(){};Z.useEffect=function(t,e){return Gt().useEffect(t,e)};Z.useImperativeHandle=function(t,e,n){return Gt().useImperativeHandle(t,e,n)};Z.useLayoutEffect=function(t,e){return Gt().useLayoutEffect(t,e)};Z.useMemo=function(t,e){return Gt().useMemo(t,e)};Z.useReducer=function(t,e,n){return Gt().useReducer(t,e,n)};Z.useRef=function(t){return Gt().useRef(t)};Z.useState=function(t){return Gt().useState(t)};Z.version="17.0.2";oe.exports=Z;var co=oe.exports,ud={exports:{}},dt={},hd={exports:{}},cd={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var e,n,r,i;if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var a=null,u=null,h=function(){if(a!==null)try{var b=t.unstable_now();a(!0,b),a=null}catch(V){throw setTimeout(h,0),V}};e=function(b){a!==null?setTimeout(e,0,b):(a=b,setTimeout(h,0))},n=function(b,V){u=setTimeout(b,V)},r=function(){clearTimeout(u)},t.unstable_shouldYield=function(){return!1},i=t.unstable_forceFrameRate=function(){}}else{var S=window.setTimeout,d=window.clearTimeout;if(typeof console!="undefined"){var C=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof C!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var E=!1,T=null,p=-1,f=5,g=0;t.unstable_shouldYield=function(){return t.unstable_now()>=g},i=function(){},t.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):f=0<b?Math.floor(1e3/b):5};var y=new MessageChannel,P=y.port2;y.port1.onmessage=function(){if(T!==null){var b=t.unstable_now();g=b+f;try{T(!0,b)?P.postMessage(null):(E=!1,T=null)}catch(V){throw P.postMessage(null),V}}else E=!1},e=function(b){T=b,E||(E=!0,P.postMessage(null))},n=function(b,V){p=S(function(){b(t.unstable_now())},V)},r=function(){d(p),p=-1}}function F(b,V){var $=b.length;b.push(V);e:for(;;){var J=$-1>>>1,ne=b[J];if(ne!==void 0&&0<R(ne,V))b[J]=V,b[$]=ne,$=J;else break e}}function A(b){return b=b[0],b===void 0?null:b}function W(b){var V=b[0];if(V!==void 0){var $=b.pop();if($!==V){b[0]=$;e:for(var J=0,ne=b.length;J<ne;){var ve=2*(J+1)-1,Y=b[ve],$e=ve+1,qe=b[$e];if(Y!==void 0&&0>R(Y,$))qe!==void 0&&0>R(qe,Y)?(b[J]=qe,b[$e]=$,J=$e):(b[J]=Y,b[ve]=$,J=ve);else if(qe!==void 0&&0>R(qe,$))b[J]=qe,b[$e]=$,J=$e;else break e}}return V}return null}function R(b,V){var $=b.sortIndex-V.sortIndex;return $!==0?$:b.id-V.id}var k=[],z=[],Fe=1,me=null,Q=3,ze=!1,m=!1,w=!1;function O(b){for(var V=A(z);V!==null;){if(V.callback===null)W(z);else if(V.startTime<=b)W(z),V.sortIndex=V.expirationTime,F(k,V);else break;V=A(z)}}function N(b){if(w=!1,O(b),!m)if(A(k)!==null)m=!0,e(x);else{var V=A(z);V!==null&&n(N,V.startTime-b)}}function x(b,V){m=!1,w&&(w=!1,r()),ze=!0;var $=Q;try{for(O(V),me=A(k);me!==null&&(!(me.expirationTime>V)||b&&!t.unstable_shouldYield());){var J=me.callback;if(typeof J=="function"){me.callback=null,Q=me.priorityLevel;var ne=J(me.expirationTime<=V);V=t.unstable_now(),typeof ne=="function"?me.callback=ne:me===A(k)&&W(k),O(V)}else W(k);me=A(k)}if(me!==null)var ve=!0;else{var Y=A(z);Y!==null&&n(N,Y.startTime-V),ve=!1}return ve}finally{me=null,Q=$,ze=!1}}var D=i;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(b){b.callback=null},t.unstable_continueExecution=function(){m||ze||(m=!0,e(x))},t.unstable_getCurrentPriorityLevel=function(){return Q},t.unstable_getFirstCallbackNode=function(){return A(k)},t.unstable_next=function(b){switch(Q){case 1:case 2:case 3:var V=3;break;default:V=Q}var $=Q;Q=V;try{return b()}finally{Q=$}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=D,t.unstable_runWithPriority=function(b,V){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var $=Q;Q=b;try{return V()}finally{Q=$}},t.unstable_scheduleCallback=function(b,V,$){var J=t.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?J+$:J):$=J,b){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=$+ne,b={id:Fe++,callback:V,priorityLevel:b,startTime:$,expirationTime:ne,sortIndex:-1},$>J?(b.sortIndex=$,F(z,b),A(k)===null&&b===A(z)&&(w?r():w=!0,n(N,$-J))):(b.sortIndex=ne,F(k,b),m||ze||(m=!0,e(x))),b},t.unstable_wrapCallback=function(b){var V=Q;return function(){var $=Q;Q=V;try{return b.apply(this,arguments)}finally{Q=$}}}})(cd);hd.exports=cd;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jo=oe.exports,ce=Jf,Oe=hd.exports;function L(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Jo)throw Error(L(227));var fd=new Set,Gi={};function Mn(t,e){Ir(t,e),Ir(t+"Capture",e)}function Ir(t,e){for(Gi[t]=e,t=0;t<e.length;t++)fd.add(e[t])}var Bt=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Cm=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Mh=Object.prototype.hasOwnProperty,$h={},Bh={};function Sm(t){return Mh.call(Bh,t)?!0:Mh.call($h,t)?!1:Cm.test(t)?Bh[t]=!0:($h[t]=!0,!1)}function wm(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function _m(t,e,n,r){if(e===null||typeof e=="undefined"||wm(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ge(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ae={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ae[t]=new Ge(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ae[e]=new Ge(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ae[t]=new Ge(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ae[t]=new Ge(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ae[t]=new Ge(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ae[t]=new Ge(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ae[t]=new Ge(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ae[t]=new Ge(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ae[t]=new Ge(t,5,!1,t.toLowerCase(),null,!1,!1)});var Nu=/[\-:]([a-z])/g;function bu(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Nu,bu);Ae[e]=new Ge(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Nu,bu);Ae[e]=new Ge(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Nu,bu);Ae[e]=new Ge(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ae[t]=new Ge(t,1,!1,t.toLowerCase(),null,!1,!1)});Ae.xlinkHref=new Ge("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ae[t]=new Ge(t,1,!1,t.toLowerCase(),null,!0,!0)});function Iu(t,e,n,r){var i=Ae.hasOwnProperty(e)?Ae[e]:null,s=i!==null?i.type===0:r?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");s||(_m(e,n,i,r)&&(n=null),r||i===null?Sm(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var $n=Jo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ei=60103,kn=60106,sn=60107,ku=60108,bi=60114,Au=60109,Fu=60110,Qo=60112,Ii=60113,Po=60120,Xo=60115,Ru=60116,Lu=60121,Du=60128,dd=60129,Vu=60130,Aa=60131;if(typeof Symbol=="function"&&Symbol.for){var Pe=Symbol.for;Ei=Pe("react.element"),kn=Pe("react.portal"),sn=Pe("react.fragment"),ku=Pe("react.strict_mode"),bi=Pe("react.profiler"),Au=Pe("react.provider"),Fu=Pe("react.context"),Qo=Pe("react.forward_ref"),Ii=Pe("react.suspense"),Po=Pe("react.suspense_list"),Xo=Pe("react.memo"),Ru=Pe("react.lazy"),Lu=Pe("react.block"),Pe("react.scope"),Du=Pe("react.opaque.id"),dd=Pe("react.debug_trace_mode"),Vu=Pe("react.offscreen"),Aa=Pe("react.legacy_hidden")}var Gh=typeof Symbol=="function"&&Symbol.iterator;function ti(t){return t===null||typeof t!="object"?null:(t=Gh&&t[Gh]||t["@@iterator"],typeof t=="function"?t:null)}var $l;function Pi(t){if($l===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);$l=e&&e[1]||""}return`
`+$l+t}var Bl=!1;function Fs(t,e){if(!t||Bl)return"";Bl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(a){var r=a}Reflect.construct(t,[],e)}else{try{e.call()}catch(a){r=a}t.call(e.prototype)}else{try{throw Error()}catch(a){r=a}t()}}catch(a){if(a&&r&&typeof a.stack=="string"){for(var i=a.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,l=s.length-1;1<=o&&0<=l&&i[o]!==s[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==s[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==s[l])return`
`+i[o].replace(" at new "," at ");while(1<=o&&0<=l);break}}}finally{Bl=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Pi(t):""}function Em(t){switch(t.tag){case 5:return Pi(t.type);case 16:return Pi("Lazy");case 13:return Pi("Suspense");case 19:return Pi("SuspenseList");case 0:case 2:case 15:return t=Fs(t.type,!1),t;case 11:return t=Fs(t.type.render,!1),t;case 22:return t=Fs(t.type._render,!1),t;case 1:return t=Fs(t.type,!0),t;default:return""}}function Cr(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case sn:return"Fragment";case kn:return"Portal";case bi:return"Profiler";case ku:return"StrictMode";case Ii:return"Suspense";case Po:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Fu:return(t.displayName||"Context")+".Consumer";case Au:return(t._context.displayName||"Context")+".Provider";case Qo:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case Xo:return Cr(t.type);case Lu:return Cr(t._render);case Ru:e=t._payload,t=t._init;try{return Cr(t(e))}catch{}}return null}function yn(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function pd(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Pm(t){var e=pd(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Rs(t){t._valueTracker||(t._valueTracker=Pm(t))}function md(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=pd(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Oo(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function Fa(t,e){var n=e.checked;return ce({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function Uh(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=yn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function gd(t,e){e=e.checked,e!=null&&Iu(t,"checked",e,!1)}function Ra(t,e){gd(t,e);var n=yn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?La(t,e.type,n):e.hasOwnProperty("defaultValue")&&La(t,e.type,yn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function zh(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function La(t,e,n){(e!=="number"||Oo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function Om(t){var e="";return Jo.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}function Da(t,e){return t=ce({children:void 0},e),(e=Om(e.children))&&(t.children=e),t}function Sr(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+yn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Va(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(L(91));return ce({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function qh(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(L(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(L(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:yn(n)}}function vd(t,e){var n=yn(e.value),r=yn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Hh(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}var Wa={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function yd(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ja(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?yd(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ls,Cd=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!==Wa.svg||"innerHTML"in t)t.innerHTML=e;else{for(Ls=Ls||document.createElement("div"),Ls.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ls.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ui(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ki={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xm=["Webkit","ms","Moz","O"];Object.keys(ki).forEach(function(t){xm.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ki[e]=ki[t]})});function Sd(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ki.hasOwnProperty(t)&&ki[t]?(""+e).trim():e+"px"}function wd(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Sd(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Tm=ce({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ma(t,e){if(e){if(Tm[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(L(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(L(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(L(61))}if(e.style!=null&&typeof e.style!="object")throw Error(L(62))}}function $a(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Wu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ba=null,wr=null,_r=null;function Kh(t){if(t=as(t)){if(typeof Ba!="function")throw Error(L(280));var e=t.stateNode;e&&(e=rl(e),Ba(t.stateNode,t.type,e))}}function _d(t){wr?_r?_r.push(t):_r=[t]:wr=t}function Ed(){if(wr){var t=wr,e=_r;if(_r=wr=null,Kh(t),e)for(t=0;t<e.length;t++)Kh(e[t])}}function ju(t,e){return t(e)}function Pd(t,e,n,r,i){return t(e,n,r,i)}function Mu(){}var Od=ju,An=!1,Gl=!1;function $u(){(wr!==null||_r!==null)&&(Mu(),Ed())}function Nm(t,e,n){if(Gl)return t(e,n);Gl=!0;try{return Od(t,e,n)}finally{Gl=!1,$u()}}function zi(t,e){var n=t.stateNode;if(n===null)return null;var r=rl(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(L(231,e,typeof n));return n}var Ga=!1;if(Bt)try{var ni={};Object.defineProperty(ni,"passive",{get:function(){Ga=!0}}),window.addEventListener("test",ni,ni),window.removeEventListener("test",ni,ni)}catch{Ga=!1}function bm(t,e,n,r,i,s,o,l,a){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var Ai=!1,xo=null,To=!1,Ua=null,Im={onError:function(t){Ai=!0,xo=t}};function km(t,e,n,r,i,s,o,l,a){Ai=!1,xo=null,bm.apply(Im,arguments)}function Am(t,e,n,r,i,s,o,l,a){if(km.apply(this,arguments),Ai){if(Ai){var u=xo;Ai=!1,xo=null}else throw Error(L(198));To||(To=!0,Ua=u)}}function Bn(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&1026)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function xd(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Jh(t){if(Bn(t)!==t)throw Error(L(188))}function Fm(t){var e=t.alternate;if(!e){if(e=Bn(t),e===null)throw Error(L(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Jh(i),t;if(s===r)return Jh(i),e;s=s.sibling}throw Error(L(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o)throw Error(L(189))}}if(n.alternate!==r)throw Error(L(190))}if(n.tag!==3)throw Error(L(188));return n.stateNode.current===n?t:e}function Td(t){if(t=Fm(t),!t)return null;for(var e=t;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function Qh(t,e){for(var n=t.alternate;e!==null;){if(e===t||e===n)return!0;e=e.return}return!1}var Nd,Bu,bd,Id,za=!1,xt=[],un=null,hn=null,cn=null,qi=new Map,Hi=new Map,ri=[],Xh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qa(t,e,n,r,i){return{blockedOn:t,domEventName:e,eventSystemFlags:n|16,nativeEvent:i,targetContainers:[r]}}function Yh(t,e){switch(t){case"focusin":case"focusout":un=null;break;case"dragenter":case"dragleave":hn=null;break;case"mouseover":case"mouseout":cn=null;break;case"pointerover":case"pointerout":qi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hi.delete(e.pointerId)}}function ii(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t=qa(e,n,r,i,s),e!==null&&(e=as(e),e!==null&&Bu(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Rm(t,e,n,r,i){switch(e){case"focusin":return un=ii(un,t,e,n,r,i),!0;case"dragenter":return hn=ii(hn,t,e,n,r,i),!0;case"mouseover":return cn=ii(cn,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return qi.set(s,ii(qi.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Hi.set(s,ii(Hi.get(s)||null,t,e,n,r,i)),!0}return!1}function Lm(t){var e=Fn(t.target);if(e!==null){var n=Bn(e);if(n!==null){if(e=n.tag,e===13){if(e=xd(n),e!==null){t.blockedOn=e,Id(t.lanePriority,function(){Oe.unstable_runWithPriority(t.priority,function(){bd(n)})});return}}else if(e===3&&n.stateNode.hydrate){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function fo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=qu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null)return e=as(n),e!==null&&Bu(e),t.blockedOn=n,!1;e.shift()}return!0}function Zh(t,e,n){fo(t)&&n.delete(e)}function Dm(){for(za=!1;0<xt.length;){var t=xt[0];if(t.blockedOn!==null){t=as(t.blockedOn),t!==null&&Nd(t);break}for(var e=t.targetContainers;0<e.length;){var n=qu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null){t.blockedOn=n;break}e.shift()}t.blockedOn===null&&xt.shift()}un!==null&&fo(un)&&(un=null),hn!==null&&fo(hn)&&(hn=null),cn!==null&&fo(cn)&&(cn=null),qi.forEach(Zh),Hi.forEach(Zh)}function si(t,e){t.blockedOn===e&&(t.blockedOn=null,za||(za=!0,Oe.unstable_scheduleCallback(Oe.unstable_NormalPriority,Dm)))}function kd(t){function e(i){return si(i,t)}if(0<xt.length){si(xt[0],t);for(var n=1;n<xt.length;n++){var r=xt[n];r.blockedOn===t&&(r.blockedOn=null)}}for(un!==null&&si(un,t),hn!==null&&si(hn,t),cn!==null&&si(cn,t),qi.forEach(e),Hi.forEach(e),n=0;n<ri.length;n++)r=ri[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ri.length&&(n=ri[0],n.blockedOn===null);)Lm(n),n.blockedOn===null&&ri.shift()}function Ds(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var dr={animationend:Ds("Animation","AnimationEnd"),animationiteration:Ds("Animation","AnimationIteration"),animationstart:Ds("Animation","AnimationStart"),transitionend:Ds("Transition","TransitionEnd")},Ul={},Ad={};Bt&&(Ad=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition);function Yo(t){if(Ul[t])return Ul[t];if(!dr[t])return t;var e=dr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Ad)return Ul[t]=e[n];return t}var Fd=Yo("animationend"),Rd=Yo("animationiteration"),Ld=Yo("animationstart"),Dd=Yo("transitionend"),Vd=new Map,Gu=new Map,Vm=["abort","abort",Fd,"animationEnd",Rd,"animationIteration",Ld,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Dd,"transitionEnd","waiting","waiting"];function Uu(t,e){for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Gu.set(r,e),Vd.set(r,i),Mn(i,[r])}}var Wm=Oe.unstable_now;Wm();var se=8;function cr(t){if((1&t)!==0)return se=15,1;if((2&t)!==0)return se=14,2;if((4&t)!==0)return se=13,4;var e=24&t;return e!==0?(se=12,e):(t&32)!==0?(se=11,32):(e=192&t,e!==0?(se=10,e):(t&256)!==0?(se=9,256):(e=3584&t,e!==0?(se=8,e):(t&4096)!==0?(se=7,4096):(e=4186112&t,e!==0?(se=6,e):(e=62914560&t,e!==0?(se=5,e):t&67108864?(se=4,67108864):(t&134217728)!==0?(se=3,134217728):(e=805306368&t,e!==0?(se=2,e):(1073741824&t)!==0?(se=1,1073741824):(se=8,t))))))}function jm(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function Mm(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(L(358,t))}}function Ki(t,e){var n=t.pendingLanes;if(n===0)return se=0;var r=0,i=0,s=t.expiredLanes,o=t.suspendedLanes,l=t.pingedLanes;if(s!==0)r=s,i=se=15;else if(s=n&134217727,s!==0){var a=s&~o;a!==0?(r=cr(a),i=se):(l&=s,l!==0&&(r=cr(l),i=se))}else s=n&~o,s!==0?(r=cr(s),i=se):l!==0&&(r=cr(l),i=se);if(r===0)return 0;if(r=31-Cn(r),r=n&((0>r?0:1<<r)<<1)-1,e!==0&&e!==r&&(e&o)===0){if(cr(e),i<=se)return e;se=i}if(e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Cn(e),i=1<<n,r|=t[n],e&=~i;return r}function Wd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function No(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return t=fr(24&~e),t===0?No(10,e):t;case 10:return t=fr(192&~e),t===0?No(8,e):t;case 8:return t=fr(3584&~e),t===0&&(t=fr(4186112&~e),t===0&&(t=512)),t;case 2:return e=fr(805306368&~e),e===0&&(e=268435456),e}throw Error(L(358,t))}function fr(t){return t&-t}function zl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Zo(t,e,n){t.pendingLanes|=e;var r=e-1;t.suspendedLanes&=r,t.pingedLanes&=r,t=t.eventTimes,e=31-Cn(e),t[e]=n}var Cn=Math.clz32?Math.clz32:Gm,$m=Math.log,Bm=Math.LN2;function Gm(t){return t===0?32:31-($m(t)/Bm|0)|0}var Um=Oe.unstable_UserBlockingPriority,zm=Oe.unstable_runWithPriority,po=!0;function qm(t,e,n,r){An||Mu();var i=zu,s=An;An=!0;try{Pd(i,t,e,n,r)}finally{(An=s)||$u()}}function Hm(t,e,n,r){zm(Um,zu.bind(null,t,e,n,r))}function zu(t,e,n,r){if(po){var i;if((i=(e&4)===0)&&0<xt.length&&-1<Xh.indexOf(t))t=qa(null,t,e,n,r),xt.push(t);else{var s=qu(t,e,n,r);if(s===null)i&&Yh(t,r);else{if(i){if(-1<Xh.indexOf(t)){t=qa(s,t,e,n,r),xt.push(t);return}if(Rm(s,t,e,n,r))return;Yh(t,r)}Xd(t,e,r,null,n)}}}}function qu(t,e,n,r){var i=Wu(r);if(i=Fn(i),i!==null){var s=Bn(i);if(s===null)i=null;else{var o=s.tag;if(o===13){if(i=xd(s),i!==null)return i;i=null}else if(o===3){if(s.stateNode.hydrate)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return Xd(t,e,r,i,n),null}var on=null,Hu=null,mo=null;function jd(){if(mo)return mo;var t,e=Hu,n=e.length,r,i="value"in on?on.value:on.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return mo=i.slice(t,1<r?1-r:void 0)}function go(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vs(){return!0}function ec(){return!1}function rt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(s):s[l]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Vs:ec,this.isPropagationStopped=ec,this}return ce(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vs)},persist:function(){},isPersistent:Vs}),e}var Dr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ku=rt(Dr),ls=ce({},Dr,{view:0,detail:0}),Km=rt(ls),ql,Hl,oi,el=ce({},ls,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ju,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==oi&&(oi&&t.type==="mousemove"?(ql=t.screenX-oi.screenX,Hl=t.screenY-oi.screenY):Hl=ql=0,oi=t),ql)},movementY:function(t){return"movementY"in t?t.movementY:Hl}}),tc=rt(el),Jm=ce({},el,{dataTransfer:0}),Qm=rt(Jm),Xm=ce({},ls,{relatedTarget:0}),Kl=rt(Xm),Ym=ce({},Dr,{animationName:0,elapsedTime:0,pseudoElement:0}),Zm=rt(Ym),eg=ce({},Dr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),tg=rt(eg),ng=ce({},Dr,{data:0}),nc=rt(ng),rg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ig={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function og(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=sg[t])?!!e[t]:!1}function Ju(){return og}var lg=ce({},ls,{key:function(t){if(t.key){var e=rg[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=go(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ig[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ju,charCode:function(t){return t.type==="keypress"?go(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?go(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ag=rt(lg),ug=ce({},el,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rc=rt(ug),hg=ce({},ls,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ju}),cg=rt(hg),fg=ce({},Dr,{propertyName:0,elapsedTime:0,pseudoElement:0}),dg=rt(fg),pg=ce({},el,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),mg=rt(pg),gg=[9,13,27,32],Qu=Bt&&"CompositionEvent"in window,Fi=null;Bt&&"documentMode"in document&&(Fi=document.documentMode);var vg=Bt&&"TextEvent"in window&&!Fi,Md=Bt&&(!Qu||Fi&&8<Fi&&11>=Fi),ic=String.fromCharCode(32),sc=!1;function $d(t,e){switch(t){case"keyup":return gg.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bd(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var pr=!1;function yg(t,e){switch(t){case"compositionend":return Bd(e);case"keypress":return e.which!==32?null:(sc=!0,ic);case"textInput":return t=e.data,t===ic&&sc?null:t;default:return null}}function Cg(t,e){if(pr)return t==="compositionend"||!Qu&&$d(t,e)?(t=jd(),mo=Hu=on=null,pr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Md&&e.locale!=="ko"?null:e.data;default:return null}}var Sg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Sg[t.type]:e==="textarea"}function Gd(t,e,n,r){_d(r),e=bo(e,"onChange"),0<e.length&&(n=new Ku("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ri=null,Ji=null;function wg(t){Kd(t,0)}function tl(t){var e=gr(t);if(md(e))return t}function _g(t,e){if(t==="change")return e}var Ud=!1;if(Bt){var Jl;if(Bt){var Ql="oninput"in document;if(!Ql){var lc=document.createElement("div");lc.setAttribute("oninput","return;"),Ql=typeof lc.oninput=="function"}Jl=Ql}else Jl=!1;Ud=Jl&&(!document.documentMode||9<document.documentMode)}function ac(){Ri&&(Ri.detachEvent("onpropertychange",zd),Ji=Ri=null)}function zd(t){if(t.propertyName==="value"&&tl(Ji)){var e=[];if(Gd(e,Ji,t,Wu(t)),t=wg,An)t(e);else{An=!0;try{ju(t,e)}finally{An=!1,$u()}}}}function Eg(t,e,n){t==="focusin"?(ac(),Ri=e,Ji=n,Ri.attachEvent("onpropertychange",zd)):t==="focusout"&&ac()}function Pg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return tl(Ji)}function Og(t,e){if(t==="click")return tl(e)}function xg(t,e){if(t==="input"||t==="change")return tl(e)}function Tg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var lt=typeof Object.is=="function"?Object.is:Tg,Ng=Object.prototype.hasOwnProperty;function Qi(t,e){if(lt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Ng.call(e,n[r])||!lt(t[n[r]],e[n[r]]))return!1;return!0}function uc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function hc(t,e){var n=uc(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uc(n)}}function qd(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?qd(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function cc(){for(var t=window,e=Oo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Oo(t.document)}return e}function Ha(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var bg=Bt&&"documentMode"in document&&11>=document.documentMode,mr=null,Ka=null,Li=null,Ja=!1;function fc(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ja||mr==null||mr!==Oo(r)||(r=mr,"selectionStart"in r&&Ha(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Li&&Qi(Li,r)||(Li=r,r=bo(Ka,"onSelect"),0<r.length&&(e=new Ku("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=mr)))}Uu("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Uu("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Uu(Vm,2);for(var dc="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Xl=0;Xl<dc.length;Xl++)Gu.set(dc[Xl],0);Ir("onMouseEnter",["mouseout","mouseover"]);Ir("onMouseLeave",["mouseout","mouseover"]);Ir("onPointerEnter",["pointerout","pointerover"]);Ir("onPointerLeave",["pointerout","pointerover"]);Mn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hd=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oi));function pc(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Am(r,e,void 0,t),t.currentTarget=null}function Kd(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],a=l.instance,u=l.currentTarget;if(l=l.listener,a!==s&&i.isPropagationStopped())break e;pc(i,l,u),s=a}else for(o=0;o<r.length;o++){if(l=r[o],a=l.instance,u=l.currentTarget,l=l.listener,a!==s&&i.isPropagationStopped())break e;pc(i,l,u),s=a}}}if(To)throw t=Ua,To=!1,Ua=null,t}function le(t,e){var n=Zd(e),r=t+"__bubble";n.has(r)||(Qd(e,t,2,!1),n.add(r))}var mc="_reactListening"+Math.random().toString(36).slice(2);function Jd(t){t[mc]||(t[mc]=!0,fd.forEach(function(e){Hd.has(e)||gc(e,!1,t,null),gc(e,!0,t,null)}))}function gc(t,e,n,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,s=n;if(t==="selectionchange"&&n.nodeType!==9&&(s=n.ownerDocument),r!==null&&!e&&Hd.has(t)){if(t!=="scroll")return;i|=2,s=r}var o=Zd(s),l=t+"__"+(e?"capture":"bubble");o.has(l)||(e&&(i|=4),Qd(s,t,i,e),o.add(l))}function Qd(t,e,n,r){var i=Gu.get(e);switch(i===void 0?2:i){case 0:i=qm;break;case 1:i=Hm;break;default:i=zu}n=i.bind(null,e,n,t),i=void 0,!Ga||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Xd(t,e,n,r,i){var s=r;if((e&1)===0&&(e&2)===0&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var a=o.tag;if((a===3||a===4)&&(a=o.stateNode.containerInfo,a===i||a.nodeType===8&&a.parentNode===i))return;o=o.return}for(;l!==null;){if(o=Fn(l),o===null)return;if(a=o.tag,a===5||a===6){r=s=o;continue e}l=l.parentNode}}r=r.return}Nm(function(){var u=s,h=Wu(n),S=[];e:{var d=Vd.get(t);if(d!==void 0){var C=Ku,E=t;switch(t){case"keypress":if(go(n)===0)break e;case"keydown":case"keyup":C=ag;break;case"focusin":E="focus",C=Kl;break;case"focusout":E="blur",C=Kl;break;case"beforeblur":case"afterblur":C=Kl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":C=tc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":C=Qm;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":C=cg;break;case Fd:case Rd:case Ld:C=Zm;break;case Dd:C=dg;break;case"scroll":C=Km;break;case"wheel":C=mg;break;case"copy":case"cut":case"paste":C=tg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":C=rc}var T=(e&4)!==0,p=!T&&t==="scroll",f=T?d!==null?d+"Capture":null:d;T=[];for(var g=u,y;g!==null;){y=g;var P=y.stateNode;if(y.tag===5&&P!==null&&(y=P,f!==null&&(P=zi(g,f),P!=null&&T.push(Xi(g,P,y)))),p)break;g=g.return}0<T.length&&(d=new C(d,E,null,n,h),S.push({event:d,listeners:T}))}}if((e&7)===0){e:{if(d=t==="mouseover"||t==="pointerover",C=t==="mouseout"||t==="pointerout",d&&(e&16)===0&&(E=n.relatedTarget||n.fromElement)&&(Fn(E)||E[Vr]))break e;if((C||d)&&(d=h.window===h?h:(d=h.ownerDocument)?d.defaultView||d.parentWindow:window,C?(E=n.relatedTarget||n.toElement,C=u,E=E?Fn(E):null,E!==null&&(p=Bn(E),E!==p||E.tag!==5&&E.tag!==6)&&(E=null)):(C=null,E=u),C!==E)){if(T=tc,P="onMouseLeave",f="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(T=rc,P="onPointerLeave",f="onPointerEnter",g="pointer"),p=C==null?d:gr(C),y=E==null?d:gr(E),d=new T(P,g+"leave",C,n,h),d.target=p,d.relatedTarget=y,P=null,Fn(h)===u&&(T=new T(f,g+"enter",E,n,h),T.target=y,T.relatedTarget=p,P=T),p=P,C&&E)t:{for(T=C,f=E,g=0,y=T;y;y=nr(y))g++;for(y=0,P=f;P;P=nr(P))y++;for(;0<g-y;)T=nr(T),g--;for(;0<y-g;)f=nr(f),y--;for(;g--;){if(T===f||f!==null&&T===f.alternate)break t;T=nr(T),f=nr(f)}T=null}else T=null;C!==null&&vc(S,d,C,T,!1),E!==null&&p!==null&&vc(S,p,E,T,!0)}}e:{if(d=u?gr(u):window,C=d.nodeName&&d.nodeName.toLowerCase(),C==="select"||C==="input"&&d.type==="file")var F=_g;else if(oc(d))if(Ud)F=xg;else{F=Pg;var A=Eg}else(C=d.nodeName)&&C.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(F=Og);if(F&&(F=F(t,u))){Gd(S,F,n,h);break e}A&&A(t,d,u),t==="focusout"&&(A=d._wrapperState)&&A.controlled&&d.type==="number"&&La(d,"number",d.value)}switch(A=u?gr(u):window,t){case"focusin":(oc(A)||A.contentEditable==="true")&&(mr=A,Ka=u,Li=null);break;case"focusout":Li=Ka=mr=null;break;case"mousedown":Ja=!0;break;case"contextmenu":case"mouseup":case"dragend":Ja=!1,fc(S,n,h);break;case"selectionchange":if(bg)break;case"keydown":case"keyup":fc(S,n,h)}var W;if(Qu)e:{switch(t){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else pr?$d(t,n)&&(R="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(R="onCompositionStart");R&&(Md&&n.locale!=="ko"&&(pr||R!=="onCompositionStart"?R==="onCompositionEnd"&&pr&&(W=jd()):(on=h,Hu="value"in on?on.value:on.textContent,pr=!0)),A=bo(u,R),0<A.length&&(R=new nc(R,t,null,n,h),S.push({event:R,listeners:A}),W?R.data=W:(W=Bd(n),W!==null&&(R.data=W)))),(W=vg?yg(t,n):Cg(t,n))&&(u=bo(u,"onBeforeInput"),0<u.length&&(h=new nc("onBeforeInput","beforeinput",null,n,h),S.push({event:h,listeners:u}),h.data=W))}Kd(S,e)})}function Xi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function bo(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=zi(t,n),s!=null&&r.unshift(Xi(t,s,i)),s=zi(t,e),s!=null&&r.push(Xi(t,s,i))),t=t.return}return r}function nr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function vc(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var l=n,a=l.alternate,u=l.stateNode;if(a!==null&&a===r)break;l.tag===5&&u!==null&&(l=u,i?(a=zi(n,s),a!=null&&o.unshift(Xi(n,a,l))):i||(a=zi(n,s),a!=null&&o.push(Xi(n,a,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}function Io(){}var Yl=null,Zl=null;function Yd(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function Qa(t,e){return t==="textarea"||t==="option"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var yc=typeof setTimeout=="function"?setTimeout:void 0,Ig=typeof clearTimeout=="function"?clearTimeout:void 0;function Xu(t){t.nodeType===1?t.textContent="":t.nodeType===9&&(t=t.body,t!=null&&(t.textContent=""))}function Er(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break}return t}function Cc(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ea=0;function kg(t){return{$$typeof:Du,toString:t,valueOf:t}}var nl=Math.random().toString(36).slice(2),ln="__reactFiber$"+nl,ko="__reactProps$"+nl,Vr="__reactContainer$"+nl,Sc="__reactEvents$"+nl;function Fn(t){var e=t[ln];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Vr]||n[ln]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Cc(t);t!==null;){if(n=t[ln])return n;t=Cc(t)}return e}t=n,n=t.parentNode}return null}function as(t){return t=t[ln]||t[Vr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function gr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(L(33))}function rl(t){return t[ko]||null}function Zd(t){var e=t[Sc];return e===void 0&&(e=t[Sc]=new Set),e}var Xa=[],vr=-1;function En(t){return{current:t}}function ae(t){0>vr||(t.current=Xa[vr],Xa[vr]=null,vr--)}function pe(t,e){vr++,Xa[vr]=t.current,t.current=e}var Sn={},je=En(Sn),Qe=En(!1),Vn=Sn;function kr(t,e){var n=t.type.contextTypes;if(!n)return Sn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Xe(t){return t=t.childContextTypes,t!=null}function Ao(){ae(Qe),ae(je)}function wc(t,e,n){if(je.current!==Sn)throw Error(L(168));pe(je,e),pe(Qe,n)}function ep(t,e,n){var r=t.stateNode;if(t=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(L(108,Cr(e)||"Unknown",i));return ce({},n,r)}function vo(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Sn,Vn=je.current,pe(je,t),pe(Qe,Qe.current),!0}function _c(t,e,n){var r=t.stateNode;if(!r)throw Error(L(169));n?(t=ep(t,e,Vn),r.__reactInternalMemoizedMergedChildContext=t,ae(Qe),ae(je),pe(je,t)):ae(Qe),pe(Qe,n)}var Yu=null,Dn=null,Ag=Oe.unstable_runWithPriority,Zu=Oe.unstable_scheduleCallback,Ya=Oe.unstable_cancelCallback,Fg=Oe.unstable_shouldYield,Ec=Oe.unstable_requestPaint,Za=Oe.unstable_now,Rg=Oe.unstable_getCurrentPriorityLevel,il=Oe.unstable_ImmediatePriority,tp=Oe.unstable_UserBlockingPriority,np=Oe.unstable_NormalPriority,rp=Oe.unstable_LowPriority,ip=Oe.unstable_IdlePriority,ta={},Lg=Ec!==void 0?Ec:function(){},Vt=null,yo=null,na=!1,Pc=Za(),Ve=1e4>Pc?Za:function(){return Za()-Pc};function Ar(){switch(Rg()){case il:return 99;case tp:return 98;case np:return 97;case rp:return 96;case ip:return 95;default:throw Error(L(332))}}function sp(t){switch(t){case 99:return il;case 98:return tp;case 97:return np;case 96:return rp;case 95:return ip;default:throw Error(L(332))}}function Wn(t,e){return t=sp(t),Ag(t,e)}function Yi(t,e,n){return t=sp(t),Zu(t,e,n)}function kt(){if(yo!==null){var t=yo;yo=null,Ya(t)}op()}function op(){if(!na&&Vt!==null){na=!0;var t=0;try{var e=Vt;Wn(99,function(){for(;t<e.length;t++){var n=e[t];do n=n(!0);while(n!==null)}}),Vt=null}catch(n){throw Vt!==null&&(Vt=Vt.slice(t+1)),Zu(il,kt),n}finally{na=!1}}}var Dg=$n.ReactCurrentBatchConfig;function Ct(t,e){if(t&&t.defaultProps){e=ce({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Fo=En(null),Ro=null,yr=null,Lo=null;function eh(){Lo=yr=Ro=null}function th(t){var e=Fo.current;ae(Fo),t.type._context._currentValue=e}function lp(t,e){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)===e){if(n===null||(n.childLanes&e)===e)break;n.childLanes|=e}else t.childLanes|=e,n!==null&&(n.childLanes|=e);t=t.return}}function Pr(t,e){Ro=t,Lo=yr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(St=!0),t.firstContext=null)}function ct(t,e){if(Lo!==t&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Lo=t,e=1073741823),e={context:t,observedBits:e,next:null},yr===null){if(Ro===null)throw Error(L(308));yr=e,Ro.dependencies={lanes:0,firstContext:e,responders:null}}else yr=yr.next=e;return t._currentValue}var nn=!1;function nh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ap(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function fn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function dn(t,e){if(t=t.updateQueue,t!==null){t=t.shared;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function Oc(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Zi(t,e,n,r){var i=t.updateQueue;nn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var a=l,u=a.next;a.next=null,o===null?s=u:o.next=u,o=a;var h=t.alternate;if(h!==null){h=h.updateQueue;var S=h.lastBaseUpdate;S!==o&&(S===null?h.firstBaseUpdate=u:S.next=u,h.lastBaseUpdate=a)}}if(s!==null){S=i.baseState,o=0,h=u=a=null;do{l=s.lane;var d=s.eventTime;if((r&l)===l){h!==null&&(h=h.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var C=t,E=s;switch(l=e,d=n,E.tag){case 1:if(C=E.payload,typeof C=="function"){S=C.call(d,S,l);break e}S=C;break e;case 3:C.flags=C.flags&-4097|64;case 0:if(C=E.payload,l=typeof C=="function"?C.call(d,S,l):C,l==null)break e;S=ce({},S,l);break e;case 2:nn=!0}}s.callback!==null&&(t.flags|=32,l=i.effects,l===null?i.effects=[s]:l.push(s))}else d={eventTime:d,lane:l,tag:s.tag,payload:s.payload,callback:s.callback,next:null},h===null?(u=h=d,a=S):h=h.next=d,o|=l;if(s=s.next,s===null){if(l=i.shared.pending,l===null)break;s=l.next,l.next=null,i.lastBaseUpdate=l,i.shared.pending=null}}while(1);h===null&&(a=S),i.baseState=a,i.firstBaseUpdate=u,i.lastBaseUpdate=h,hs|=o,t.lanes=o,t.memoizedState=S}}function xc(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(L(191,i));i.call(r)}}}var up=new Jo.Component().refs;function Do(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ce({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var sl={isMounted:function(t){return(t=t._reactInternals)?Bn(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=nt(),i=pn(t),s=fn(r,i);s.payload=e,n!=null&&(s.callback=n),dn(t,s),mn(t,i,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=nt(),i=pn(t),s=fn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),dn(t,s),mn(t,i,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=nt(),r=pn(t),i=fn(n,r);i.tag=2,e!=null&&(i.callback=e),dn(t,i),mn(t,r,n)}};function Tc(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Qi(n,r)||!Qi(i,s):!0}function hp(t,e,n){var r=!1,i=Sn,s=e.contextType;return typeof s=="object"&&s!==null?s=ct(s):(i=Xe(e)?Vn:je.current,r=e.contextTypes,s=(r=r!=null)?kr(t,i):Sn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=sl,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Nc(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&sl.enqueueReplaceState(e,e.state,null)}function eu(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=up,nh(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=ct(s):(s=Xe(e)?Vn:je.current,i.context=kr(t,s)),Zi(t,n,i,r),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Do(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&sl.enqueueReplaceState(i,i.state,null),Zi(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4)}var Ws=Array.isArray;function li(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(L(309));var r=n.stateNode}if(!r)throw Error(L(147,t));var i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(s){var o=r.refs;o===up&&(o=r.refs={}),s===null?delete o[i]:o[i]=s},e._stringRef=i,e)}if(typeof t!="string")throw Error(L(284));if(!n._owner)throw Error(L(290,t))}return t}function js(t,e){if(t.type!=="textarea")throw Error(L(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function cp(t){function e(p,f){if(t){var g=p.lastEffect;g!==null?(g.nextEffect=f,p.lastEffect=f):p.firstEffect=p.lastEffect=f,f.nextEffect=null,f.flags=8}}function n(p,f){if(!t)return null;for(;f!==null;)e(p,f),f=f.sibling;return null}function r(p,f){for(p=new Map;f!==null;)f.key!==null?p.set(f.key,f):p.set(f.index,f),f=f.sibling;return p}function i(p,f){return p=_n(p,f),p.index=0,p.sibling=null,p}function s(p,f,g){return p.index=g,t?(g=p.alternate,g!==null?(g=g.index,g<f?(p.flags=2,f):g):(p.flags=2,f)):f}function o(p){return t&&p.alternate===null&&(p.flags=2),p}function l(p,f,g,y){return f===null||f.tag!==6?(f=la(g,p.mode,y),f.return=p,f):(f=i(f,g),f.return=p,f)}function a(p,f,g,y){return f!==null&&f.elementType===g.type?(y=i(f,g.props),y.ref=li(p,f,g),y.return=p,y):(y=_o(g.type,g.key,g.props,null,p.mode,y),y.ref=li(p,f,g),y.return=p,y)}function u(p,f,g,y){return f===null||f.tag!==4||f.stateNode.containerInfo!==g.containerInfo||f.stateNode.implementation!==g.implementation?(f=aa(g,p.mode,y),f.return=p,f):(f=i(f,g.children||[]),f.return=p,f)}function h(p,f,g,y,P){return f===null||f.tag!==7?(f=Nr(g,p.mode,y,P),f.return=p,f):(f=i(f,g),f.return=p,f)}function S(p,f,g){if(typeof f=="string"||typeof f=="number")return f=la(""+f,p.mode,g),f.return=p,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case Ei:return g=_o(f.type,f.key,f.props,null,p.mode,g),g.ref=li(p,null,f),g.return=p,g;case kn:return f=aa(f,p.mode,g),f.return=p,f}if(Ws(f)||ti(f))return f=Nr(f,p.mode,g,null),f.return=p,f;js(p,f)}return null}function d(p,f,g,y){var P=f!==null?f.key:null;if(typeof g=="string"||typeof g=="number")return P!==null?null:l(p,f,""+g,y);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ei:return g.key===P?g.type===sn?h(p,f,g.props.children,y,P):a(p,f,g,y):null;case kn:return g.key===P?u(p,f,g,y):null}if(Ws(g)||ti(g))return P!==null?null:h(p,f,g,y,null);js(p,g)}return null}function C(p,f,g,y,P){if(typeof y=="string"||typeof y=="number")return p=p.get(g)||null,l(f,p,""+y,P);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ei:return p=p.get(y.key===null?g:y.key)||null,y.type===sn?h(f,p,y.props.children,P,y.key):a(f,p,y,P);case kn:return p=p.get(y.key===null?g:y.key)||null,u(f,p,y,P)}if(Ws(y)||ti(y))return p=p.get(g)||null,h(f,p,y,P,null);js(f,y)}return null}function E(p,f,g,y){for(var P=null,F=null,A=f,W=f=0,R=null;A!==null&&W<g.length;W++){A.index>W?(R=A,A=null):R=A.sibling;var k=d(p,A,g[W],y);if(k===null){A===null&&(A=R);break}t&&A&&k.alternate===null&&e(p,A),f=s(k,f,W),F===null?P=k:F.sibling=k,F=k,A=R}if(W===g.length)return n(p,A),P;if(A===null){for(;W<g.length;W++)A=S(p,g[W],y),A!==null&&(f=s(A,f,W),F===null?P=A:F.sibling=A,F=A);return P}for(A=r(p,A);W<g.length;W++)R=C(A,p,W,g[W],y),R!==null&&(t&&R.alternate!==null&&A.delete(R.key===null?W:R.key),f=s(R,f,W),F===null?P=R:F.sibling=R,F=R);return t&&A.forEach(function(z){return e(p,z)}),P}function T(p,f,g,y){var P=ti(g);if(typeof P!="function")throw Error(L(150));if(g=P.call(g),g==null)throw Error(L(151));for(var F=P=null,A=f,W=f=0,R=null,k=g.next();A!==null&&!k.done;W++,k=g.next()){A.index>W?(R=A,A=null):R=A.sibling;var z=d(p,A,k.value,y);if(z===null){A===null&&(A=R);break}t&&A&&z.alternate===null&&e(p,A),f=s(z,f,W),F===null?P=z:F.sibling=z,F=z,A=R}if(k.done)return n(p,A),P;if(A===null){for(;!k.done;W++,k=g.next())k=S(p,k.value,y),k!==null&&(f=s(k,f,W),F===null?P=k:F.sibling=k,F=k);return P}for(A=r(p,A);!k.done;W++,k=g.next())k=C(A,p,W,k.value,y),k!==null&&(t&&k.alternate!==null&&A.delete(k.key===null?W:k.key),f=s(k,f,W),F===null?P=k:F.sibling=k,F=k);return t&&A.forEach(function(Fe){return e(p,Fe)}),P}return function(p,f,g,y){var P=typeof g=="object"&&g!==null&&g.type===sn&&g.key===null;P&&(g=g.props.children);var F=typeof g=="object"&&g!==null;if(F)switch(g.$$typeof){case Ei:e:{for(F=g.key,P=f;P!==null;){if(P.key===F){switch(P.tag){case 7:if(g.type===sn){n(p,P.sibling),f=i(P,g.props.children),f.return=p,p=f;break e}break;default:if(P.elementType===g.type){n(p,P.sibling),f=i(P,g.props),f.ref=li(p,P,g),f.return=p,p=f;break e}}n(p,P);break}else e(p,P);P=P.sibling}g.type===sn?(f=Nr(g.props.children,p.mode,y,g.key),f.return=p,p=f):(y=_o(g.type,g.key,g.props,null,p.mode,y),y.ref=li(p,f,g),y.return=p,p=y)}return o(p);case kn:e:{for(P=g.key;f!==null;){if(f.key===P)if(f.tag===4&&f.stateNode.containerInfo===g.containerInfo&&f.stateNode.implementation===g.implementation){n(p,f.sibling),f=i(f,g.children||[]),f.return=p,p=f;break e}else{n(p,f);break}else e(p,f);f=f.sibling}f=aa(g,p.mode,y),f.return=p,p=f}return o(p)}if(typeof g=="string"||typeof g=="number")return g=""+g,f!==null&&f.tag===6?(n(p,f.sibling),f=i(f,g),f.return=p,p=f):(n(p,f),f=la(g,p.mode,y),f.return=p,p=f),o(p);if(Ws(g))return E(p,f,g,y);if(ti(g))return T(p,f,g,y);if(F&&js(p,g),typeof g=="undefined"&&!P)switch(p.tag){case 1:case 22:case 0:case 11:case 15:throw Error(L(152,Cr(p.type)||"Component"))}return n(p,f)}}var Vo=cp(!0),fp=cp(!1),us={},bt=En(us),es=En(us),ts=En(us);function Rn(t){if(t===us)throw Error(L(174));return t}function tu(t,e){switch(pe(ts,e),pe(es,t),pe(bt,us),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ja(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ja(e,t)}ae(bt),pe(bt,e)}function Fr(){ae(bt),ae(es),ae(ts)}function bc(t){Rn(ts.current);var e=Rn(bt.current),n=ja(e,t.type);e!==n&&(pe(es,t),pe(bt,n))}function rh(t){es.current===t&&(ae(bt),ae(es))}var de=En(0);function Wo(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var jt=null,an=null,It=!1;function dp(t,e){var n=at(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.flags=8,t.lastEffect!==null?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function Ic(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function nu(t){if(It){var e=an;if(e){var n=e;if(!Ic(t,e)){if(e=Er(n.nextSibling),!e||!Ic(t,e)){t.flags=t.flags&-1025|2,It=!1,jt=t;return}dp(jt,n)}jt=t,an=Er(e.firstChild)}else t.flags=t.flags&-1025|2,It=!1,jt=t}}function kc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;jt=t}function Ms(t){if(t!==jt)return!1;if(!It)return kc(t),It=!0,!1;var e=t.type;if(t.tag!==5||e!=="head"&&e!=="body"&&!Qa(e,t.memoizedProps))for(e=an;e;)dp(t,e),e=Er(e.nextSibling);if(kc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){an=Er(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}an=null}}else an=jt?Er(t.stateNode.nextSibling):null;return!0}function ra(){an=jt=null,It=!1}var Or=[];function ih(){for(var t=0;t<Or.length;t++)Or[t]._workInProgressVersionPrimary=null;Or.length=0}var Di=$n.ReactCurrentDispatcher,ut=$n.ReactCurrentBatchConfig,ns=0,ge=null,De=null,Ie=null,jo=!1,Vi=!1;function He(){throw Error(L(321))}function sh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!lt(t[n],e[n]))return!1;return!0}function oh(t,e,n,r,i,s){if(ns=s,ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Di.current=t===null||t.memoizedState===null?Wg:jg,t=n(r,i),Vi){s=0;do{if(Vi=!1,!(25>s))throw Error(L(301));s+=1,Ie=De=null,e.updateQueue=null,Di.current=Mg,t=n(r,i)}while(Vi)}if(Di.current=Go,e=De!==null&&De.next!==null,ns=0,Ie=De=ge=null,jo=!1,e)throw Error(L(300));return t}function Ln(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ie===null?ge.memoizedState=Ie=t:Ie=Ie.next=t,Ie}function Gn(){if(De===null){var t=ge.alternate;t=t!==null?t.memoizedState:null}else t=De.next;var e=Ie===null?ge.memoizedState:Ie.next;if(e!==null)Ie=e,De=t;else{if(t===null)throw Error(L(310));De=t,t={memoizedState:De.memoizedState,baseState:De.baseState,baseQueue:De.baseQueue,queue:De.queue,next:null},Ie===null?ge.memoizedState=Ie=t:Ie=Ie.next=t}return Ie}function Tt(t,e){return typeof e=="function"?e(t):e}function ai(t){var e=Gn(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var r=De,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){i=i.next,r=r.baseState;var l=o=s=null,a=i;do{var u=a.lane;if((ns&u)===u)l!==null&&(l=l.next={lane:0,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null}),r=a.eagerReducer===t?a.eagerState:t(r,a.action);else{var h={lane:u,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null};l===null?(o=l=h,s=r):l=l.next=h,ge.lanes|=u,hs|=u}a=a.next}while(a!==null&&a!==i);l===null?s=r:l.next=o,lt(r,e.memoizedState)||(St=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,n.lastRenderedState=r}return[e.memoizedState,n.dispatch]}function ui(t){var e=Gn(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);lt(s,e.memoizedState)||(St=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Ac(t,e,n){var r=e._getVersion;r=r(e._source);var i=e._workInProgressVersionPrimary;if(i!==null?t=i===r:(t=t.mutableReadLanes,(t=(ns&t)===t)&&(e._workInProgressVersionPrimary=r,Or.push(e))),t)return n(e._source);throw Or.push(e),Error(L(350))}function pp(t,e,n,r){var i=Be;if(i===null)throw Error(L(349));var s=e._getVersion,o=s(e._source),l=Di.current,a=l.useState(function(){return Ac(i,e,n)}),u=a[1],h=a[0];a=Ie;var S=t.memoizedState,d=S.refs,C=d.getSnapshot,E=S.source;S=S.subscribe;var T=ge;return t.memoizedState={refs:d,source:e,subscribe:r},l.useEffect(function(){d.getSnapshot=n,d.setSnapshot=u;var p=s(e._source);if(!lt(o,p)){p=n(e._source),lt(h,p)||(u(p),p=pn(T),i.mutableReadLanes|=p&i.pendingLanes),p=i.mutableReadLanes,i.entangledLanes|=p;for(var f=i.entanglements,g=p;0<g;){var y=31-Cn(g),P=1<<y;f[y]|=p,g&=~P}}},[n,e,r]),l.useEffect(function(){return r(e._source,function(){var p=d.getSnapshot,f=d.setSnapshot;try{f(p(e._source));var g=pn(T);i.mutableReadLanes|=g&i.pendingLanes}catch(y){f(function(){throw y})}})},[e,r]),lt(C,n)&&lt(E,e)&&lt(S,r)||(t={pending:null,dispatch:null,lastRenderedReducer:Tt,lastRenderedState:h},t.dispatch=u=uh.bind(null,ge,t),a.queue=t,a.baseQueue=null,h=Ac(i,e,n),a.memoizedState=a.baseState=h),h}function mp(t,e,n){var r=Gn();return pp(r,t,e,n)}function hi(t){var e=Ln();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t=e.queue={pending:null,dispatch:null,lastRenderedReducer:Tt,lastRenderedState:t},t=t.dispatch=uh.bind(null,ge,t),[e.memoizedState,t]}function Mo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ge.updateQueue,e===null?(e={lastEffect:null},ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Fc(t){var e=Ln();return t={current:t},e.memoizedState=t}function $o(){return Gn().memoizedState}function ru(t,e,n,r){var i=Ln();ge.flags|=t,i.memoizedState=Mo(1|e,n,void 0,r===void 0?null:r)}function lh(t,e,n,r){var i=Gn();r=r===void 0?null:r;var s=void 0;if(De!==null){var o=De.memoizedState;if(s=o.destroy,r!==null&&sh(r,o.deps)){Mo(e,n,s,r);return}}ge.flags|=t,i.memoizedState=Mo(1|e,n,s,r)}function Rc(t,e){return ru(516,4,t,e)}function Bo(t,e){return lh(516,4,t,e)}function gp(t,e){return lh(4,2,t,e)}function vp(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function yp(t,e,n){return n=n!=null?n.concat([t]):null,lh(4,2,vp.bind(null,e,t),n)}function ah(){}function Cp(t,e){var n=Gn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&sh(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Sp(t,e){var n=Gn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&sh(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Vg(t,e){var n=Ar();Wn(98>n?98:n,function(){t(!0)}),Wn(97<n?97:n,function(){var r=ut.transition;ut.transition=1;try{t(!1),e()}finally{ut.transition=r}})}function uh(t,e,n){var r=nt(),i=pn(t),s={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(o===null?s.next=s:(s.next=o.next,o.next=s),e.pending=s,o=t.alternate,t===ge||o!==null&&o===ge)Vi=jo=!0;else{if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var l=e.lastRenderedState,a=o(l,n);if(s.eagerReducer=o,s.eagerState=a,lt(a,l))return}catch{}finally{}mn(t,i,r)}}var Go={readContext:ct,useCallback:He,useContext:He,useEffect:He,useImperativeHandle:He,useLayoutEffect:He,useMemo:He,useReducer:He,useRef:He,useState:He,useDebugValue:He,useDeferredValue:He,useTransition:He,useMutableSource:He,useOpaqueIdentifier:He,unstable_isNewReconciler:!1},Wg={readContext:ct,useCallback:function(t,e){return Ln().memoizedState=[t,e===void 0?null:e],t},useContext:ct,useEffect:Rc,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ru(4,2,vp.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ru(4,2,t,e)},useMemo:function(t,e){var n=Ln();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Ln();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},t=t.dispatch=uh.bind(null,ge,t),[r.memoizedState,t]},useRef:Fc,useState:hi,useDebugValue:ah,useDeferredValue:function(t){var e=hi(t),n=e[0],r=e[1];return Rc(function(){var i=ut.transition;ut.transition=1;try{r(t)}finally{ut.transition=i}},[t]),n},useTransition:function(){var t=hi(!1),e=t[0];return t=Vg.bind(null,t[1]),Fc(t),[t,e]},useMutableSource:function(t,e,n){var r=Ln();return r.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:n},pp(r,t,e,n)},useOpaqueIdentifier:function(){if(It){var t=!1,e=kg(function(){throw t||(t=!0,n("r:"+(ea++).toString(36))),Error(L(355))}),n=hi(e)[1];return(ge.mode&2)===0&&(ge.flags|=516,Mo(5,function(){n("r:"+(ea++).toString(36))},void 0,null)),e}return e="r:"+(ea++).toString(36),hi(e),e},unstable_isNewReconciler:!1},jg={readContext:ct,useCallback:Cp,useContext:ct,useEffect:Bo,useImperativeHandle:yp,useLayoutEffect:gp,useMemo:Sp,useReducer:ai,useRef:$o,useState:function(){return ai(Tt)},useDebugValue:ah,useDeferredValue:function(t){var e=ai(Tt),n=e[0],r=e[1];return Bo(function(){var i=ut.transition;ut.transition=1;try{r(t)}finally{ut.transition=i}},[t]),n},useTransition:function(){var t=ai(Tt)[0];return[$o().current,t]},useMutableSource:mp,useOpaqueIdentifier:function(){return ai(Tt)[0]},unstable_isNewReconciler:!1},Mg={readContext:ct,useCallback:Cp,useContext:ct,useEffect:Bo,useImperativeHandle:yp,useLayoutEffect:gp,useMemo:Sp,useReducer:ui,useRef:$o,useState:function(){return ui(Tt)},useDebugValue:ah,useDeferredValue:function(t){var e=ui(Tt),n=e[0],r=e[1];return Bo(function(){var i=ut.transition;ut.transition=1;try{r(t)}finally{ut.transition=i}},[t]),n},useTransition:function(){var t=ui(Tt)[0];return[$o().current,t]},useMutableSource:mp,useOpaqueIdentifier:function(){return ui(Tt)[0]},unstable_isNewReconciler:!1},$g=$n.ReactCurrentOwner,St=!1;function Je(t,e,n,r){e.child=t===null?fp(e,null,n,r):Vo(e,t.child,n,r)}function Lc(t,e,n,r,i){n=n.render;var s=e.ref;return Pr(e,i),r=oh(t,e,n,r,s,i),t!==null&&!St?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,Mt(t,e,i)):(e.flags|=1,Je(t,e,r,i),e.child)}function Dc(t,e,n,r,i,s){if(t===null){var o=n.type;return typeof o=="function"&&!mh(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,wp(t,e,o,r,i,s)):(t=_o(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}return o=t.child,(i&s)===0&&(i=o.memoizedProps,n=n.compare,n=n!==null?n:Qi,n(i,r)&&t.ref===e.ref)?Mt(t,e,s):(e.flags|=1,t=_n(o,r),t.ref=e.ref,t.return=e,e.child=t)}function wp(t,e,n,r,i,s){if(t!==null&&Qi(t.memoizedProps,r)&&t.ref===e.ref)if(St=!1,(s&i)!==0)(t.flags&16384)!==0&&(St=!0);else return e.lanes=t.lanes,Mt(t,e,s);return iu(t,e,n,r,s)}function ia(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden"||r.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},Bs(e,n);else if((n&1073741824)!==0)e.memoizedState={baseLanes:0},Bs(e,s!==null?s.baseLanes:n);else return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},Bs(e,t),null;else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,Bs(e,r);return Je(t,e,i,n),e.child}function _p(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=128)}function iu(t,e,n,r,i){var s=Xe(n)?Vn:je.current;return s=kr(e,s),Pr(e,i),n=oh(t,e,n,r,s,i),t!==null&&!St?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,Mt(t,e,i)):(e.flags|=1,Je(t,e,n,i),e.child)}function Vc(t,e,n,r,i){if(Xe(n)){var s=!0;vo(e)}else s=!1;if(Pr(e,i),e.stateNode===null)t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),hp(e,n,r),eu(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var a=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=ct(u):(u=Xe(n)?Vn:je.current,u=kr(e,u));var h=n.getDerivedStateFromProps,S=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";S||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||a!==u)&&Nc(e,o,r,u),nn=!1;var d=e.memoizedState;o.state=d,Zi(e,r,o,i),a=e.memoizedState,l!==r||d!==a||Qe.current||nn?(typeof h=="function"&&(Do(e,n,h,r),a=e.memoizedState),(l=nn||Tc(e,n,l,r,d,a,u))?(S||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4)):(typeof o.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=r,e.memoizedState=a),o.props=r,o.state=a,o.context=u,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4),r=!1)}else{o=e.stateNode,ap(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:Ct(e.type,l),o.props=u,S=e.pendingProps,d=o.context,a=n.contextType,typeof a=="object"&&a!==null?a=ct(a):(a=Xe(n)?Vn:je.current,a=kr(e,a));var C=n.getDerivedStateFromProps;(h=typeof C=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==S||d!==a)&&Nc(e,o,r,a),nn=!1,d=e.memoizedState,o.state=d,Zi(e,r,o,i);var E=e.memoizedState;l!==S||d!==E||Qe.current||nn?(typeof C=="function"&&(Do(e,n,C,r),E=e.memoizedState),(u=nn||Tc(e,n,u,r,d,E,a))?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,E,a),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,E,a)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&d===t.memoizedState||(e.flags|=256),e.memoizedProps=r,e.memoizedState=E),o.props=r,o.state=E,o.context=a,r=u):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&d===t.memoizedState||(e.flags|=256),r=!1)}return su(t,e,n,r,s,i)}function su(t,e,n,r,i,s){_p(t,e);var o=(e.flags&64)!==0;if(!r&&!o)return i&&_c(e,n,!1),Mt(t,e,s);r=e.stateNode,$g.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Vo(e,t.child,null,s),e.child=Vo(e,null,l,s)):Je(t,e,l,s),e.memoizedState=r.state,i&&_c(e,n,!0),e.child}function Wc(t){var e=t.stateNode;e.pendingContext?wc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&wc(t,e.context,!1),tu(t,e.containerInfo)}var $s={dehydrated:null,retryLane:0};function jc(t,e,n){var r=e.pendingProps,i=de.current,s=!1,o;return(o=(e.flags&64)!==0)||(o=t!==null&&t.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-65):t!==null&&t.memoizedState===null||r.fallback===void 0||r.unstable_avoidThisFallback===!0||(i|=1),pe(de,i&1),t===null?(r.fallback!==void 0&&nu(e),t=r.children,i=r.fallback,s?(t=Mc(e,t,i,n),e.child.memoizedState={baseLanes:n},e.memoizedState=$s,t):typeof r.unstable_expectedLoadTime=="number"?(t=Mc(e,t,i,n),e.child.memoizedState={baseLanes:n},e.memoizedState=$s,e.lanes=33554432,t):(n=gh({mode:"visible",children:t},e.mode,n,null),n.return=e,e.child=n)):t.memoizedState!==null?s?(r=Bc(t,e,r.children,r.fallback,n),s=e.child,i=t.child.memoizedState,s.memoizedState=i===null?{baseLanes:n}:{baseLanes:i.baseLanes|n},s.childLanes=t.childLanes&~n,e.memoizedState=$s,r):(n=$c(t,e,r.children,n),e.memoizedState=null,n):s?(r=Bc(t,e,r.children,r.fallback,n),s=e.child,i=t.child.memoizedState,s.memoizedState=i===null?{baseLanes:n}:{baseLanes:i.baseLanes|n},s.childLanes=t.childLanes&~n,e.memoizedState=$s,r):(n=$c(t,e,r.children,n),e.memoizedState=null,n)}function Mc(t,e,n,r){var i=t.mode,s=t.child;return e={mode:"hidden",children:e},(i&2)===0&&s!==null?(s.childLanes=0,s.pendingProps=e):s=gh(e,i,0,null),n=Nr(n,i,r,null),s.return=t,n.return=t,s.sibling=n,t.child=s,n}function $c(t,e,n,r){var i=t.child;return t=i.sibling,n=_n(i,{mode:"visible",children:n}),(e.mode&2)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=n}function Bc(t,e,n,r,i){var s=e.mode,o=t.child;t=o.sibling;var l={mode:"hidden",children:n};return(s&2)===0&&e.child!==o?(n=e.child,n.childLanes=0,n.pendingProps=l,o=n.lastEffect,o!==null?(e.firstEffect=n.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null):n=_n(o,l),t!==null?r=_n(t,r):(r=Nr(r,s,i,null),r.flags|=2),r.return=e,n.return=e,n.sibling=r,e.child=n,r}function Gc(t,e){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),lp(t.return,e)}function sa(t,e,n,r,i,s){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.lastEffect=s)}function Uc(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Je(t,e,r.children,n),r=de.current,(r&2)!==0)r=r&1|2,e.flags|=64;else{if(t!==null&&(t.flags&64)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Gc(t,n);else if(t.tag===19)Gc(t,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(pe(de,r),(e.mode&2)===0)e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Wo(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),sa(e,!1,i,n,s,e.lastEffect);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Wo(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}sa(e,!0,n,null,s,e.lastEffect);break;case"together":sa(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Mt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),hs|=e.lanes,(n&e.childLanes)!==0){if(t!==null&&e.child!==t.child)throw Error(L(153));if(e.child!==null){for(t=e.child,n=_n(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=_n(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}return null}var Ep,ou,Pp,Op;Ep=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ou=function(){};Pp=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Rn(bt.current);var s=null;switch(n){case"input":i=Fa(t,i),r=Fa(t,r),s=[];break;case"option":i=Da(t,i),r=Da(t,r),s=[];break;case"select":i=ce({},i,{value:void 0}),r=ce({},r,{value:void 0}),s=[];break;case"textarea":i=Va(t,i),r=Va(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Io)}Ma(n,r);var o;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Gi.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var a=r[u];if(l=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&a!==l&&(a!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||a&&a.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in a)a.hasOwnProperty(o)&&l[o]!==a[o]&&(n||(n={}),n[o]=a[o])}else n||(s||(s=[]),s.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,l=l?l.__html:void 0,a!=null&&l!==a&&(s=s||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(s=s||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Gi.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&le("scroll",t),s||l===a||(s=[])):typeof a=="object"&&a!==null&&a.$$typeof===Du?a.toString():(s=s||[]).push(u,a))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};Op=function(t,e,n,r){n!==r&&(e.flags|=4)};function ci(t,e){if(!It)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Bg(t,e,n){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Xe(e.type)&&Ao(),null;case 3:return Fr(),ae(Qe),ae(je),ih(),r=e.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Ms(e)?e.flags|=4:r.hydrate||(e.flags|=256)),ou(e),null;case 5:rh(e);var i=Rn(ts.current);if(n=e.type,t!==null&&e.stateNode!=null)Pp(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=128);else{if(!r){if(e.stateNode===null)throw Error(L(166));return null}if(t=Rn(bt.current),Ms(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[ln]=e,r[ko]=s,n){case"dialog":le("cancel",r),le("close",r);break;case"iframe":case"object":case"embed":le("load",r);break;case"video":case"audio":for(t=0;t<Oi.length;t++)le(Oi[t],r);break;case"source":le("error",r);break;case"img":case"image":case"link":le("error",r),le("load",r);break;case"details":le("toggle",r);break;case"input":Uh(r,s),le("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},le("invalid",r);break;case"textarea":qh(r,s),le("invalid",r)}Ma(n,s),t=null;for(var o in s)s.hasOwnProperty(o)&&(i=s[o],o==="children"?typeof i=="string"?r.textContent!==i&&(t=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(t=["children",""+i]):Gi.hasOwnProperty(o)&&i!=null&&o==="onScroll"&&le("scroll",r));switch(n){case"input":Rs(r),zh(r,s,!0);break;case"textarea":Rs(r),Hh(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Io)}r=t,e.updateQueue=r,r!==null&&(e.flags|=4)}else{switch(o=i.nodeType===9?i:i.ownerDocument,t===Wa.html&&(t=yd(n)),t===Wa.html?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[ln]=e,t[ko]=r,Ep(t,e,!1,!1),e.stateNode=t,o=$a(n,r),n){case"dialog":le("cancel",t),le("close",t),i=r;break;case"iframe":case"object":case"embed":le("load",t),i=r;break;case"video":case"audio":for(i=0;i<Oi.length;i++)le(Oi[i],t);i=r;break;case"source":le("error",t),i=r;break;case"img":case"image":case"link":le("error",t),le("load",t),i=r;break;case"details":le("toggle",t),i=r;break;case"input":Uh(t,r),i=Fa(t,r),le("invalid",t);break;case"option":i=Da(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ce({},r,{value:void 0}),le("invalid",t);break;case"textarea":qh(t,r),i=Va(t,r),le("invalid",t);break;default:i=r}Ma(n,i);var l=i;for(s in l)if(l.hasOwnProperty(s)){var a=l[s];s==="style"?wd(t,a):s==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&Cd(t,a)):s==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&Ui(t,a):typeof a=="number"&&Ui(t,""+a):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Gi.hasOwnProperty(s)?a!=null&&s==="onScroll"&&le("scroll",t):a!=null&&Iu(t,s,a,o))}switch(n){case"input":Rs(t),zh(t,r,!1);break;case"textarea":Rs(t),Hh(t);break;case"option":r.value!=null&&t.setAttribute("value",""+yn(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?Sr(t,!!r.multiple,s,!1):r.defaultValue!=null&&Sr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Io)}Yd(n,r)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(t&&e.stateNode!=null)Op(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(L(166));n=Rn(ts.current),Rn(bt.current),Ms(e)?(r=e.stateNode,n=e.memoizedProps,r[ln]=e,r.nodeValue!==n&&(e.flags|=4)):(r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ln]=e,e.stateNode=r)}return null;case 13:return ae(de),r=e.memoizedState,(e.flags&64)!==0?(e.lanes=n,e):(r=r!==null,n=!1,t===null?e.memoizedProps.fallback!==void 0&&Ms(e):n=t.memoizedState!==null,r&&!n&&(e.mode&2)!==0&&(t===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(de.current&1)!==0?ke===0&&(ke=3):((ke===0||ke===3)&&(ke=4),Be===null||(hs&134217727)===0&&(jr&134217727)===0||xr(Be,We))),(r||n)&&(e.flags|=4),null);case 4:return Fr(),ou(e),t===null&&Jd(e.stateNode.containerInfo),null;case 10:return th(e),null;case 17:return Xe(e.type)&&Ao(),null;case 19:if(ae(de),r=e.memoizedState,r===null)return null;if(s=(e.flags&64)!==0,o=r.rendering,o===null)if(s)ci(r,!1);else{if(ke!==0||t!==null&&(t.flags&64)!==0)for(t=e.child;t!==null;){if(o=Wo(t),o!==null){for(e.flags|=64,ci(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),r.lastEffect===null&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return pe(de,de.current&1|2),e.child}t=t.sibling}r.tail!==null&&Ve()>fu&&(e.flags|=64,s=!0,ci(r,!1),e.lanes=33554432)}else{if(!s)if(t=Wo(o),t!==null){if(e.flags|=64,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ci(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!It)return e=e.lastEffect=r.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*Ve()-r.renderingStartTime>fu&&n!==1073741824&&(e.flags|=64,s=!0,ci(r,!1),e.lanes=33554432);r.isBackwards?(o.sibling=e.child,e.child=o):(n=r.last,n!==null?n.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=Ve(),n.sibling=null,e=de.current,pe(de,s?e&1|2:e&1),n):null;case 23:case 24:return ph(),t!==null&&t.memoizedState!==null!=(e.memoizedState!==null)&&r.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(L(156,e.tag))}function Gg(t){switch(t.tag){case 1:Xe(t.type)&&Ao();var e=t.flags;return e&4096?(t.flags=e&-4097|64,t):null;case 3:if(Fr(),ae(Qe),ae(je),ih(),e=t.flags,(e&64)!==0)throw Error(L(285));return t.flags=e&-4097|64,t;case 5:return rh(t),null;case 13:return ae(de),e=t.flags,e&4096?(t.flags=e&-4097|64,t):null;case 19:return ae(de),null;case 4:return Fr(),null;case 10:return th(t),null;case 23:case 24:return ph(),null;default:return null}}function hh(t,e){try{var n="",r=e;do n+=Em(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i}}function lu(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Ug=typeof WeakMap=="function"?WeakMap:Map;function xp(t,e,n){n=fn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){zo||(zo=!0,du=r),lu(t,e)},n}function Tp(t,e,n){n=fn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return lu(t,e),r(i)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){typeof r!="function"&&(Nt===null?Nt=new Set([this]):Nt.add(this),lu(t,e));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}var zg=typeof WeakSet=="function"?WeakSet:Set;function zc(t){var e=t.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(n){gn(t,n)}else e.current=null}function qg(t,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&t!==null){var n=t.memoizedProps,r=t.memoizedState;t=e.stateNode,e=t.getSnapshotBeforeUpdate(e.elementType===e.type?n:Ct(e.type,n),r),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&Xu(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(L(163))}function Hg(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{if((t.tag&3)===3){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{var i=t;r=i.next,i=i.tag,(i&4)!==0&&(i&1)!==0&&(Dp(n,t),tv(n,t)),t=r}while(t!==e)}return;case 1:t=n.stateNode,n.flags&4&&(e===null?t.componentDidMount():(r=n.elementType===n.type?e.memoizedProps:Ct(n.type,e.memoizedProps),t.componentDidUpdate(r,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),e=n.updateQueue,e!==null&&xc(n,e,t);return;case 3:if(e=n.updateQueue,e!==null){if(t=null,n.child!==null)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}xc(n,e,t)}return;case 5:t=n.stateNode,e===null&&n.flags&4&&Yd(n.type,n.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:n.memoizedState===null&&(n=n.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&kd(n))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(L(163))}function qc(t,e){for(var n=t;;){if(n.tag===5){var r=n.stateNode;if(e)r=r.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=i!=null&&i.hasOwnProperty("display")?i.display:null,r.style.display=Sd("display",i)}}else if(n.tag===6)n.stateNode.nodeValue=e?"":n.memoizedProps;else if((n.tag!==23&&n.tag!==24||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function Hc(t,e){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(Yu,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(t=e.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var n=t=t.next;do{var r=n,i=r.destroy;if(r=r.tag,i!==void 0)if((r&4)!==0)Dp(e,n);else{r=e;try{i()}catch(s){gn(r,s)}}n=n.next}while(n!==t)}break;case 1:if(zc(e),t=e.stateNode,typeof t.componentWillUnmount=="function")try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(s){gn(e,s)}break;case 5:zc(e);break;case 4:Np(t,e)}}function Kc(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function Jc(t){return t.tag===5||t.tag===3||t.tag===4}function Qc(t){e:{for(var e=t.return;e!==null;){if(Jc(e))break e;e=e.return}throw Error(L(160))}var n=e;switch(e=n.stateNode,n.tag){case 5:var r=!1;break;case 3:e=e.containerInfo,r=!0;break;case 4:e=e.containerInfo,r=!0;break;default:throw Error(L(161))}n.flags&16&&(Ui(e,""),n.flags&=-17);e:t:for(n=t;;){for(;n.sibling===null;){if(n.return===null||Jc(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2)){n=n.stateNode;break e}}r?au(t,n,e):uu(t,n,e)}function au(t,e,n){var r=t.tag,i=r===5||r===6;if(i)t=i?t.stateNode:t.stateNode.instance,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Io));else if(r!==4&&(t=t.child,t!==null))for(au(t,e,n),t=t.sibling;t!==null;)au(t,e,n),t=t.sibling}function uu(t,e,n){var r=t.tag,i=r===5||r===6;if(i)t=i?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(uu(t,e,n),t=t.sibling;t!==null;)uu(t,e,n),t=t.sibling}function Np(t,e){for(var n=e,r=!1,i,s;;){if(!r){r=n.return;e:for(;;){if(r===null)throw Error(L(160));switch(i=r.stateNode,r.tag){case 5:s=!1;break e;case 3:i=i.containerInfo,s=!0;break e;case 4:i=i.containerInfo,s=!0;break e}r=r.return}r=!0}if(n.tag===5||n.tag===6){e:for(var o=t,l=n,a=l;;)if(Hc(o,a),a.child!==null&&a.tag!==4)a.child.return=a,a=a.child;else{if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}s?(o=i,l=n.stateNode,o.nodeType===8?o.parentNode.removeChild(l):o.removeChild(l)):i.removeChild(n.stateNode)}else if(n.tag===4){if(n.child!==null){i=n.stateNode.containerInfo,s=!0,n.child.return=n,n=n.child;continue}}else if(Hc(t,n),n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return,n.tag===4&&(r=!1)}n.sibling.return=n.return,n=n.sibling}}function oa(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do(r.tag&3)===3&&(t=r.destroy,r.destroy=void 0,t!==void 0&&t()),r=r.next;while(r!==n)}return;case 1:return;case 5:if(n=e.stateNode,n!=null){r=e.memoizedProps;var i=t!==null?t.memoizedProps:r;t=e.type;var s=e.updateQueue;if(e.updateQueue=null,s!==null){for(n[ko]=r,t==="input"&&r.type==="radio"&&r.name!=null&&gd(n,r),$a(t,i),e=$a(t,r),i=0;i<s.length;i+=2){var o=s[i],l=s[i+1];o==="style"?wd(n,l):o==="dangerouslySetInnerHTML"?Cd(n,l):o==="children"?Ui(n,l):Iu(n,o,l,e)}switch(t){case"input":Ra(n,r);break;case"textarea":vd(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,s=r.value,s!=null?Sr(n,!!r.multiple,s,!1):t!==!!r.multiple&&(r.defaultValue!=null?Sr(n,!!r.multiple,r.defaultValue,!0):Sr(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(L(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:n=e.stateNode,n.hydrate&&(n.hydrate=!1,kd(n.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(dh=Ve(),qc(e.child,!0)),Xc(e);return;case 19:Xc(e);return;case 17:return;case 23:case 24:qc(e,e.memoizedState!==null);return}throw Error(L(163))}function Xc(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new zg),e.forEach(function(r){var i=iv.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Kg(t,e){return t!==null&&(t=t.memoizedState,t===null||t.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var Jg=Math.ceil,Uo=$n.ReactCurrentDispatcher,ch=$n.ReactCurrentOwner,H=0,Be=null,Ee=null,We=0,jn=0,hu=En(0),ke=0,ol=null,Wr=0,hs=0,jr=0,fh=0,cu=null,dh=0,fu=1/0;function Mr(){fu=Ve()+500}var j=null,zo=!1,du=null,Nt=null,wn=!1,Wi=null,xi=90,pu=[],mu=[],$t=null,ji=0,gu=null,Co=-1,Wt=0,So=0,Mi=null,wo=!1;function nt(){return(H&48)!==0?Ve():Co!==-1?Co:Co=Ve()}function pn(t){if(t=t.mode,(t&2)===0)return 1;if((t&4)===0)return Ar()===99?1:2;if(Wt===0&&(Wt=Wr),Dg.transition!==0){So!==0&&(So=cu!==null?cu.pendingLanes:0),t=Wt;var e=4186112&~So;return e&=-e,e===0&&(t=4186112&~t,e=t&-t,e===0&&(e=8192)),e}return t=Ar(),(H&4)!==0&&t===98?t=No(12,Wt):(t=jm(t),t=No(t,Wt)),t}function mn(t,e,n){if(50<ji)throw ji=0,gu=null,Error(L(185));if(t=ll(t,e),t===null)return null;Zo(t,e,n),t===Be&&(jr|=e,ke===4&&xr(t,We));var r=Ar();e===1?(H&8)!==0&&(H&48)===0?vu(t):(ft(t,n),H===0&&(Mr(),kt())):((H&4)===0||r!==98&&r!==99||($t===null?$t=new Set([t]):$t.add(t)),ft(t,n)),cu=t}function ll(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}function ft(t,e){for(var n=t.callbackNode,r=t.suspendedLanes,i=t.pingedLanes,s=t.expirationTimes,o=t.pendingLanes;0<o;){var l=31-Cn(o),a=1<<l,u=s[l];if(u===-1){if((a&r)===0||(a&i)!==0){u=e,cr(a);var h=se;s[l]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=e&&(t.expiredLanes|=a);o&=~a}if(r=Ki(t,t===Be?We:0),e=se,r===0)n!==null&&(n!==ta&&Ya(n),t.callbackNode=null,t.callbackPriority=0);else{if(n!==null){if(t.callbackPriority===e)return;n!==ta&&Ya(n)}e===15?(n=vu.bind(null,t),Vt===null?(Vt=[n],yo=Zu(il,op)):Vt.push(n),n=ta):e===14?n=Yi(99,vu.bind(null,t)):(n=Mm(e),n=Yi(n,bp.bind(null,t))),t.callbackPriority=e,t.callbackNode=n}}function bp(t){if(Co=-1,So=Wt=0,(H&48)!==0)throw Error(L(327));var e=t.callbackNode;if(Pn()&&t.callbackNode!==e)return null;var n=Ki(t,t===Be?We:0);if(n===0)return null;var r=n,i=H;H|=16;var s=Fp();(Be!==t||We!==r)&&(Mr(),Tr(t,r));do try{Yg();break}catch(l){Ap(t,l)}while(1);if(eh(),Uo.current=s,H=i,Ee!==null?r=0:(Be=null,We=0,r=ke),(Wr&jr)!==0)Tr(t,0);else if(r!==0){if(r===2&&(H|=64,t.hydrate&&(t.hydrate=!1,Xu(t.containerInfo)),n=Wd(t),n!==0&&(r=Ti(t,n))),r===1)throw e=ol,Tr(t,0),xr(t,n),ft(t,Ve()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=n,r){case 0:case 1:throw Error(L(345));case 2:In(t);break;case 3:if(xr(t,n),(n&62914560)===n&&(r=dh+500-Ve(),10<r)){if(Ki(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){nt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=yc(In.bind(null,t),r);break}In(t);break;case 4:if(xr(t,n),(n&4186112)===n)break;for(r=t.eventTimes,i=-1;0<n;){var o=31-Cn(n);s=1<<o,o=r[o],o>i&&(i=o),n&=~s}if(n=i,n=Ve()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Jg(n/1960))-n,10<n){t.timeoutHandle=yc(In.bind(null,t),n);break}In(t);break;case 5:In(t);break;default:throw Error(L(329))}}return ft(t,Ve()),t.callbackNode===e?bp.bind(null,t):null}function xr(t,e){for(e&=~fh,e&=~jr,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Cn(e),r=1<<n;t[n]=-1,e&=~r}}function vu(t){if((H&48)!==0)throw Error(L(327));if(Pn(),t===Be&&(t.expiredLanes&We)!==0){var e=We,n=Ti(t,e);(Wr&jr)!==0&&(e=Ki(t,e),n=Ti(t,e))}else e=Ki(t,0),n=Ti(t,e);if(t.tag!==0&&n===2&&(H|=64,t.hydrate&&(t.hydrate=!1,Xu(t.containerInfo)),e=Wd(t),e!==0&&(n=Ti(t,e))),n===1)throw n=ol,Tr(t,0),xr(t,e),ft(t,Ve()),n;return t.finishedWork=t.current.alternate,t.finishedLanes=e,In(t),ft(t,Ve()),null}function Qg(){if($t!==null){var t=$t;$t=null,t.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,ft(e,Ve())})}kt()}function Ip(t,e){var n=H;H|=1;try{return t(e)}finally{H=n,H===0&&(Mr(),kt())}}function kp(t,e){var n=H;H&=-2,H|=8;try{return t(e)}finally{H=n,H===0&&(Mr(),kt())}}function Bs(t,e){pe(hu,jn),jn|=e,Wr|=e}function ph(){jn=hu.current,ae(hu)}function Tr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Ig(n)),Ee!==null)for(n=Ee.return;n!==null;){var r=n;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ao();break;case 3:Fr(),ae(Qe),ae(je),ih();break;case 5:rh(r);break;case 4:Fr();break;case 13:ae(de);break;case 19:ae(de);break;case 10:th(r);break;case 23:case 24:ph()}n=n.return}Be=t,Ee=_n(t.current,null),We=jn=Wr=e,ke=0,ol=null,fh=jr=hs=0}function Ap(t,e){do{var n=Ee;try{if(eh(),Di.current=Go,jo){for(var r=ge.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}jo=!1}if(ns=0,Ie=De=ge=null,Vi=!1,ch.current=null,n===null||n.return===null){ke=1,ol=e,Ee=null;break}e:{var s=t,o=n.return,l=n,a=e;if(e=We,l.flags|=2048,l.firstEffect=l.lastEffect=null,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a;if((l.mode&2)===0){var h=l.alternate;h?(l.updateQueue=h.updateQueue,l.memoizedState=h.memoizedState,l.lanes=h.lanes):(l.updateQueue=null,l.memoizedState=null)}var S=(de.current&1)!==0,d=o;do{var C;if(C=d.tag===13){var E=d.memoizedState;if(E!==null)C=E.dehydrated!==null;else{var T=d.memoizedProps;C=T.fallback===void 0?!1:T.unstable_avoidThisFallback!==!0?!0:!S}}if(C){var p=d.updateQueue;if(p===null){var f=new Set;f.add(u),d.updateQueue=f}else p.add(u);if((d.mode&2)===0){if(d.flags|=64,l.flags|=16384,l.flags&=-2981,l.tag===1)if(l.alternate===null)l.tag=17;else{var g=fn(-1,1);g.tag=2,dn(l,g)}l.lanes|=1;break e}a=void 0,l=e;var y=s.pingCache;if(y===null?(y=s.pingCache=new Ug,a=new Set,y.set(u,a)):(a=y.get(u),a===void 0&&(a=new Set,y.set(u,a))),!a.has(l)){a.add(l);var P=rv.bind(null,s,u,l);u.then(P,P)}d.flags|=4096,d.lanes=e;break e}d=d.return}while(d!==null);a=Error((Cr(l.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}ke!==5&&(ke=2),a=hh(a,l),d=o;do{switch(d.tag){case 3:s=a,d.flags|=4096,e&=-e,d.lanes|=e;var F=xp(d,s,e);Oc(d,F);break e;case 1:s=a;var A=d.type,W=d.stateNode;if((d.flags&64)===0&&(typeof A.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Nt===null||!Nt.has(W)))){d.flags|=4096,e&=-e,d.lanes|=e;var R=Tp(d,s,e);Oc(d,R);break e}}d=d.return}while(d!==null)}Lp(n)}catch(k){e=k,Ee===n&&n!==null&&(Ee=n=n.return);continue}break}while(1)}function Fp(){var t=Uo.current;return Uo.current=Go,t===null?Go:t}function Ti(t,e){var n=H;H|=16;var r=Fp();Be===t&&We===e||Tr(t,e);do try{Xg();break}catch(i){Ap(t,i)}while(1);if(eh(),H=n,Uo.current=r,Ee!==null)throw Error(L(261));return Be=null,We=0,ke}function Xg(){for(;Ee!==null;)Rp(Ee)}function Yg(){for(;Ee!==null&&!Fg();)Rp(Ee)}function Rp(t){var e=Vp(t.alternate,t,jn);t.memoizedProps=t.pendingProps,e===null?Lp(t):Ee=e,ch.current=null}function Lp(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&2048)===0){if(n=Bg(n,e,jn),n!==null){Ee=n;return}if(n=e,n.tag!==24&&n.tag!==23||n.memoizedState===null||(jn&1073741824)!==0||(n.mode&4)===0){for(var r=0,i=n.child;i!==null;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}t!==null&&(t.flags&2048)===0&&(t.firstEffect===null&&(t.firstEffect=e.firstEffect),e.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(t.lastEffect!==null?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}else{if(n=Gg(e),n!==null){n.flags&=2047,Ee=n;return}t!==null&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(e=e.sibling,e!==null){Ee=e;return}Ee=e=t}while(e!==null);ke===0&&(ke=5)}function In(t){var e=Ar();return Wn(99,Zg.bind(null,t,e)),null}function Zg(t,e){do Pn();while(Wi!==null);if((H&48)!==0)throw Error(L(327));var n=t.finishedWork;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(L(177));t.callbackNode=null;var r=n.lanes|n.childLanes,i=r,s=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;for(var o=t.eventTimes,l=t.expirationTimes;0<s;){var a=31-Cn(s),u=1<<a;i[a]=0,o[a]=-1,l[a]=-1,s&=~u}if($t!==null&&(r&24)===0&&$t.has(t)&&$t.delete(t),t===Be&&(Ee=Be=null,We=0),1<n.flags?n.lastEffect!==null?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,r!==null){if(i=H,H|=32,ch.current=null,Yl=po,o=cc(),Ha(o)){if("selectionStart"in o)l={start:o.selectionStart,end:o.selectionEnd};else e:if(l=(l=o.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&u.rangeCount!==0){l=u.anchorNode,s=u.anchorOffset,a=u.focusNode,u=u.focusOffset;try{l.nodeType,a.nodeType}catch{l=null;break e}var h=0,S=-1,d=-1,C=0,E=0,T=o,p=null;t:for(;;){for(var f;T!==l||s!==0&&T.nodeType!==3||(S=h+s),T!==a||u!==0&&T.nodeType!==3||(d=h+u),T.nodeType===3&&(h+=T.nodeValue.length),(f=T.firstChild)!==null;)p=T,T=f;for(;;){if(T===o)break t;if(p===l&&++C===s&&(S=h),p===a&&++E===u&&(d=h),(f=T.nextSibling)!==null)break;T=p,p=T.parentNode}T=f}l=S===-1||d===-1?null:{start:S,end:d}}else l=null;l=l||{start:0,end:0}}else l=null;Zl={focusedElem:o,selectionRange:l},po=!1,Mi=null,wo=!1,j=r;do try{ev()}catch(k){if(j===null)throw Error(L(330));gn(j,k),j=j.nextEffect}while(j!==null);Mi=null,j=r;do try{for(o=t;j!==null;){var g=j.flags;if(g&16&&Ui(j.stateNode,""),g&128){var y=j.alternate;if(y!==null){var P=y.ref;P!==null&&(typeof P=="function"?P(null):P.current=null)}}switch(g&1038){case 2:Qc(j),j.flags&=-3;break;case 6:Qc(j),j.flags&=-3,oa(j.alternate,j);break;case 1024:j.flags&=-1025;break;case 1028:j.flags&=-1025,oa(j.alternate,j);break;case 4:oa(j.alternate,j);break;case 8:l=j,Np(o,l);var F=l.alternate;Kc(l),F!==null&&Kc(F)}j=j.nextEffect}}catch(k){if(j===null)throw Error(L(330));gn(j,k),j=j.nextEffect}while(j!==null);if(P=Zl,y=cc(),g=P.focusedElem,o=P.selectionRange,y!==g&&g&&g.ownerDocument&&qd(g.ownerDocument.documentElement,g)){for(o!==null&&Ha(g)&&(y=o.start,P=o.end,P===void 0&&(P=y),"selectionStart"in g?(g.selectionStart=y,g.selectionEnd=Math.min(P,g.value.length)):(P=(y=g.ownerDocument||document)&&y.defaultView||window,P.getSelection&&(P=P.getSelection(),l=g.textContent.length,F=Math.min(o.start,l),o=o.end===void 0?F:Math.min(o.end,l),!P.extend&&F>o&&(l=o,o=F,F=l),l=hc(g,F),s=hc(g,o),l&&s&&(P.rangeCount!==1||P.anchorNode!==l.node||P.anchorOffset!==l.offset||P.focusNode!==s.node||P.focusOffset!==s.offset)&&(y=y.createRange(),y.setStart(l.node,l.offset),P.removeAllRanges(),F>o?(P.addRange(y),P.extend(s.node,s.offset)):(y.setEnd(s.node,s.offset),P.addRange(y)))))),y=[],P=g;P=P.parentNode;)P.nodeType===1&&y.push({element:P,left:P.scrollLeft,top:P.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<y.length;g++)P=y[g],P.element.scrollLeft=P.left,P.element.scrollTop=P.top}po=!!Yl,Zl=Yl=null,t.current=n,j=r;do try{for(g=t;j!==null;){var A=j.flags;if(A&36&&Hg(g,j.alternate,j),A&128){y=void 0;var W=j.ref;if(W!==null){var R=j.stateNode;switch(j.tag){case 5:y=R;break;default:y=R}typeof W=="function"?W(y):W.current=y}}j=j.nextEffect}}catch(k){if(j===null)throw Error(L(330));gn(j,k),j=j.nextEffect}while(j!==null);j=null,Lg(),H=i}else t.current=n;if(wn)wn=!1,Wi=t,xi=e;else for(j=r;j!==null;)e=j.nextEffect,j.nextEffect=null,j.flags&8&&(A=j,A.sibling=null,A.stateNode=null),j=e;if(r=t.pendingLanes,r===0&&(Nt=null),r===1?t===gu?ji++:(ji=0,gu=t):ji=0,n=n.stateNode,Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(Yu,n,void 0,(n.current.flags&64)===64)}catch{}if(ft(t,Ve()),zo)throw zo=!1,t=du,du=null,t;return(H&8)!==0||kt(),null}function ev(){for(;j!==null;){var t=j.alternate;wo||Mi===null||((j.flags&8)!==0?Qh(j,Mi)&&(wo=!0):j.tag===13&&Kg(t,j)&&Qh(j,Mi)&&(wo=!0));var e=j.flags;(e&256)!==0&&qg(t,j),(e&512)===0||wn||(wn=!0,Yi(97,function(){return Pn(),null})),j=j.nextEffect}}function Pn(){if(xi!==90){var t=97<xi?97:xi;return xi=90,Wn(t,nv)}return!1}function tv(t,e){pu.push(e,t),wn||(wn=!0,Yi(97,function(){return Pn(),null}))}function Dp(t,e){mu.push(e,t),wn||(wn=!0,Yi(97,function(){return Pn(),null}))}function nv(){if(Wi===null)return!1;var t=Wi;if(Wi=null,(H&48)!==0)throw Error(L(331));var e=H;H|=32;var n=mu;mu=[];for(var r=0;r<n.length;r+=2){var i=n[r],s=n[r+1],o=i.destroy;if(i.destroy=void 0,typeof o=="function")try{o()}catch(a){if(s===null)throw Error(L(330));gn(s,a)}}for(n=pu,pu=[],r=0;r<n.length;r+=2){i=n[r],s=n[r+1];try{var l=i.create;i.destroy=l()}catch(a){if(s===null)throw Error(L(330));gn(s,a)}}for(l=t.current.firstEffect;l!==null;)t=l.nextEffect,l.nextEffect=null,l.flags&8&&(l.sibling=null,l.stateNode=null),l=t;return H=e,kt(),!0}function Yc(t,e,n){e=hh(n,e),e=xp(t,e,1),dn(t,e),e=nt(),t=ll(t,1),t!==null&&(Zo(t,1,e),ft(t,e))}function gn(t,e){if(t.tag===3)Yc(t,t,e);else for(var n=t.return;n!==null;){if(n.tag===3){Yc(n,t,e);break}else if(n.tag===1){var r=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Nt===null||!Nt.has(r))){t=hh(e,t);var i=Tp(n,t,1);if(dn(n,i),i=nt(),n=ll(n,1),n!==null)Zo(n,1,i),ft(n,i);else if(typeof r.componentDidCatch=="function"&&(Nt===null||!Nt.has(r)))try{r.componentDidCatch(e,t)}catch{}break}}n=n.return}}function rv(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=nt(),t.pingedLanes|=t.suspendedLanes&n,Be===t&&(We&n)===n&&(ke===4||ke===3&&(We&62914560)===We&&500>Ve()-dh?Tr(t,0):fh|=n),ft(t,e)}function iv(t,e){var n=t.stateNode;n!==null&&n.delete(e),e=0,e===0&&(e=t.mode,(e&2)===0?e=1:(e&4)===0?e=Ar()===99?1:2:(Wt===0&&(Wt=Wr),e=fr(62914560&~Wt),e===0&&(e=4194304))),n=nt(),t=ll(t,e),t!==null&&(Zo(t,e,n),ft(t,n))}var Vp;Vp=function(t,e,n){var r=e.lanes;if(t!==null)if(t.memoizedProps!==e.pendingProps||Qe.current)St=!0;else if((n&r)!==0)St=(t.flags&16384)!==0;else{switch(St=!1,e.tag){case 3:Wc(e),ra();break;case 5:bc(e);break;case 1:Xe(e.type)&&vo(e);break;case 4:tu(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value;var i=e.type._context;pe(Fo,i._currentValue),i._currentValue=r;break;case 13:if(e.memoizedState!==null)return(n&e.child.childLanes)!==0?jc(t,e,n):(pe(de,de.current&1),e=Mt(t,e,n),e!==null?e.sibling:null);pe(de,de.current&1);break;case 19:if(r=(n&e.childLanes)!==0,(t.flags&64)!==0){if(r)return Uc(t,e,n);e.flags|=64}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),pe(de,de.current),r)break;return null;case 23:case 24:return e.lanes=0,ia(t,e,n)}return Mt(t,e,n)}else St=!1;switch(e.lanes=0,e.tag){case 2:if(r=e.type,t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=kr(e,je.current),Pr(e,n),i=oh(null,e,r,t,i,n),e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,Xe(r)){var s=!0;vo(e)}else s=!1;e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,nh(e);var o=r.getDerivedStateFromProps;typeof o=="function"&&Do(e,r,o,t),i.updater=sl,e.stateNode=i,i._reactInternals=e,eu(e,r,t,n),e=su(null,e,r,!0,s,n)}else e.tag=0,Je(null,e,i,n),e=e.child;return e;case 16:i=e.elementType;e:{switch(t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=ov(i),t=Ct(i,t),s){case 0:e=iu(null,e,i,t,n);break e;case 1:e=Vc(null,e,i,t,n);break e;case 11:e=Lc(null,e,i,t,n);break e;case 14:e=Dc(null,e,i,Ct(i.type,t),r,n);break e}throw Error(L(306,i,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),iu(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),Vc(t,e,r,i,n);case 3:if(Wc(e),r=e.updateQueue,t===null||r===null)throw Error(L(282));if(r=e.pendingProps,i=e.memoizedState,i=i!==null?i.element:null,ap(t,e),Zi(e,r,null,n),r=e.memoizedState.element,r===i)ra(),e=Mt(t,e,n);else{if(i=e.stateNode,(s=i.hydrate)&&(an=Er(e.stateNode.containerInfo.firstChild),jt=e,s=It=!0),s){if(t=i.mutableSourceEagerHydrationData,t!=null)for(i=0;i<t.length;i+=2)s=t[i],s._workInProgressVersionPrimary=t[i+1],Or.push(s);for(n=fp(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|1024,n=n.sibling}else Je(t,e,r,n),ra();e=e.child}return e;case 5:return bc(e),t===null&&nu(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Qa(r,i)?o=null:s!==null&&Qa(r,s)&&(e.flags|=16),_p(t,e),Je(t,e,o,n),e.child;case 6:return t===null&&nu(e),null;case 13:return jc(t,e,n);case 4:return tu(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Vo(e,null,r,n):Je(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),Lc(t,e,r,i,n);case 7:return Je(t,e,e.pendingProps,n),e.child;case 8:return Je(t,e,e.pendingProps.children,n),e.child;case 12:return Je(t,e,e.pendingProps.children,n),e.child;case 10:e:{r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value;var l=e.type._context;if(pe(Fo,l._currentValue),l._currentValue=s,o!==null)if(l=o.value,s=lt(l,s)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(l,s):1073741823)|0,s===0){if(o.children===i.children&&!Qe.current){e=Mt(t,e,n);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var a=l.dependencies;if(a!==null){o=l.child;for(var u=a.firstContext;u!==null;){if(u.context===r&&(u.observedBits&s)!==0){l.tag===1&&(u=fn(-1,n&-n),u.tag=2,dn(l,u)),l.lanes|=n,u=l.alternate,u!==null&&(u.lanes|=n),lp(l.return,n),a.lanes|=n;break}u=u.next}}else o=l.tag===10&&l.type===e.type?null:l.child;if(o!==null)o.return=l;else for(o=l;o!==null;){if(o===e){o=null;break}if(l=o.sibling,l!==null){l.return=o.return,o=l;break}o=o.return}l=o}Je(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps,r=s.children,Pr(e,n),i=ct(i,s.unstable_observedBits),r=r(i),e.flags|=1,Je(t,e,r,n),e.child;case 14:return i=e.type,s=Ct(i,e.pendingProps),s=Ct(i.type,s),Dc(t,e,i,s,r,n);case 15:return wp(t,e,e.type,e.pendingProps,r,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ct(r,i),t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,Xe(r)?(t=!0,vo(e)):t=!1,Pr(e,n),hp(e,r,i),eu(e,r,i,n),su(null,e,r,!0,t,n);case 19:return Uc(t,e,n);case 23:return ia(t,e,n);case 24:return ia(t,e,n)}throw Error(L(156,e.tag))};function sv(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function at(t,e,n,r){return new sv(t,e,n,r)}function mh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ov(t){if(typeof t=="function")return mh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Qo)return 11;if(t===Xo)return 14}return 2}function _n(t,e){var n=t.alternate;return n===null?(n=at(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function _o(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")mh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case sn:return Nr(n.children,i,s,e);case dd:o=8,i|=16;break;case ku:o=8,i|=1;break;case bi:return t=at(12,n,e,i|8),t.elementType=bi,t.type=bi,t.lanes=s,t;case Ii:return t=at(13,n,e,i),t.type=Ii,t.elementType=Ii,t.lanes=s,t;case Po:return t=at(19,n,e,i),t.elementType=Po,t.lanes=s,t;case Vu:return gh(n,i,s,e);case Aa:return t=at(24,n,e,i),t.elementType=Aa,t.lanes=s,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Au:o=10;break e;case Fu:o=9;break e;case Qo:o=11;break e;case Xo:o=14;break e;case Ru:o=16,r=null;break e;case Lu:o=22;break e}throw Error(L(130,t==null?t:typeof t,""))}return e=at(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function Nr(t,e,n,r){return t=at(7,t,r,e),t.lanes=n,t}function gh(t,e,n,r){return t=at(23,t,r,e),t.elementType=Vu,t.lanes=n,t}function la(t,e,n){return t=at(6,t,null,e),t.lanes=n,t}function aa(t,e,n){return e=at(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function lv(t,e,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=zl(0),this.expirationTimes=zl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zl(0),this.mutableSourceEagerHydrationData=null}function av(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kn,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function qo(t,e,n,r){var i=e.current,s=nt(),o=pn(i);e:if(n){n=n._reactInternals;t:{if(Bn(n)!==n||n.tag!==1)throw Error(L(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(Xe(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(l!==null);throw Error(L(171))}if(n.tag===1){var a=n.type;if(Xe(a)){n=ep(n,a,l);break e}}n=l}else n=Sn;return e.context===null?e.context=n:e.pendingContext=n,e=fn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),dn(i,e),mn(i,o,s),o}function ua(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Zc(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function vh(t,e){Zc(t,e),(t=t.alternate)&&Zc(t,e)}function uv(){return null}function yh(t,e,n){var r=n!=null&&n.hydrationOptions!=null&&n.hydrationOptions.mutableSources||null;if(n=new lv(t,e,n!=null&&n.hydrate===!0),e=at(3,null,null,e===2?7:e===1?3:0),n.current=e,e.stateNode=n,nh(e),t[Vr]=n.current,Jd(t.nodeType===8?t.parentNode:t),r)for(t=0;t<r.length;t++){e=r[t];var i=e._getVersion;i=i(e._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[e,i]:n.mutableSourceEagerHydrationData.push(e,i)}this._internalRoot=n}yh.prototype.render=function(t){qo(t,this._internalRoot,null,null)};yh.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;qo(null,t,null,function(){e[Vr]=null})};function cs(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function hv(t,e){if(e||(e=t?t.nodeType===9?t.documentElement:t.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new yh(t,0,e?{hydrate:!0}:void 0)}function al(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s._internalRoot;if(typeof i=="function"){var l=i;i=function(){var u=ua(o);l.call(u)}}qo(e,o,t,i)}else{if(s=n._reactRootContainer=hv(n,r),o=s._internalRoot,typeof i=="function"){var a=i;i=function(){var u=ua(o);a.call(u)}}kp(function(){qo(e,o,t,i)})}return ua(o)}Nd=function(t){if(t.tag===13){var e=nt();mn(t,4,e),vh(t,4)}};Bu=function(t){if(t.tag===13){var e=nt();mn(t,67108864,e),vh(t,67108864)}};bd=function(t){if(t.tag===13){var e=nt(),n=pn(t);mn(t,n,e),vh(t,n)}};Id=function(t,e){return e()};Ba=function(t,e,n){switch(e){case"input":if(Ra(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=rl(r);if(!i)throw Error(L(90));md(r),Ra(r,i)}}}break;case"textarea":vd(t,n);break;case"select":e=n.value,e!=null&&Sr(t,!!n.multiple,e,!1)}};ju=Ip;Pd=function(t,e,n,r,i){var s=H;H|=4;try{return Wn(98,t.bind(null,e,n,r,i))}finally{H=s,H===0&&(Mr(),kt())}};Mu=function(){(H&49)===0&&(Qg(),Pn())};Od=function(t,e){var n=H;H|=2;try{return t(e)}finally{H=n,H===0&&(Mr(),kt())}};function Wp(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cs(e))throw Error(L(200));return av(t,e,null,n)}var cv={Events:[as,gr,rl,_d,Ed,Pn,{current:!1}]},fi={findFiberByHostInstance:Fn,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},fv={bundleType:fi.bundleType,version:fi.version,rendererPackageName:fi.rendererPackageName,rendererConfig:fi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$n.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Td(t),t===null?null:t.stateNode},findFiberByHostInstance:fi.findFiberByHostInstance||uv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Gs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gs.isDisabled&&Gs.supportsFiber)try{Yu=Gs.inject(fv),Dn=Gs}catch{}}dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cv;dt.createPortal=Wp;dt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(L(188)):Error(L(268,Object.keys(t)));return t=Td(e),t=t===null?null:t.stateNode,t};dt.flushSync=function(t,e){var n=H;if((n&48)!==0)return t(e);H|=1;try{if(t)return Wn(99,t.bind(null,e))}finally{H=n,kt()}};dt.hydrate=function(t,e,n){if(!cs(e))throw Error(L(200));return al(null,t,e,!0,n)};dt.render=function(t,e,n){if(!cs(e))throw Error(L(200));return al(null,t,e,!1,n)};dt.unmountComponentAtNode=function(t){if(!cs(t))throw Error(L(40));return t._reactRootContainer?(kp(function(){al(null,null,t,!1,function(){t._reactRootContainer=null,t[Vr]=null})}),!0):!1};dt.unstable_batchedUpdates=Ip;dt.unstable_createPortal=function(t,e){return Wp(t,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};dt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!cs(n))throw Error(L(200));if(t==null||t._reactInternals===void 0)throw Error(L(38));return al(t,e,n,!1,r)};dt.version="17.0.2";function jp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jp)}catch(t){console.error(t)}}jp(),ud.exports=dt;var Q_=ud.exports;function dv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ef(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function tf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ef(Object(n),!0).forEach(function(r){dv(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ef(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function pv(t,e){return mv(t)||gv(t,e)||vv(t,e)||yv()}function mv(t){if(Array.isArray(t))return t}function gv(t,e){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,s=void 0;try{for(var o=t[Symbol.iterator](),l;!(r=(l=o.next()).done)&&(n.push(l.value),!(e&&n.length===e));r=!0);}catch(a){i=!0,s=a}finally{try{!r&&o.return!=null&&o.return()}finally{if(i)throw s}}return n}}function vv(t,e){if(!!t){if(typeof t=="string")return nf(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nf(t,e)}}function nf(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function rf(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function sf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rf(Object(n),!0).forEach(function(r){Cv(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rf(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Sv(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){return e.reduceRight(function(i,s){return s(i)},r)}}function Ni(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return i.length>=t.length?t.apply(this,i):function(){for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return e.apply(n,[].concat(i,l))}}}function Ho(t){return{}.toString.call(t).includes("Object")}function wv(t){return!Object.keys(t).length}function rs(t){return typeof t=="function"}function _v(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ev(t,e){return Ho(e)||vn("changeType"),Object.keys(e).some(function(n){return!_v(t,n)})&&vn("changeField"),e}function Pv(t){rs(t)||vn("selectorType")}function Ov(t){rs(t)||Ho(t)||vn("handlerType"),Ho(t)&&Object.values(t).some(function(e){return!rs(e)})&&vn("handlersType")}function xv(t){t||vn("initialIsRequired"),Ho(t)||vn("initialType"),wv(t)&&vn("initialContent")}function Tv(t,e){throw new Error(t[e]||t.default)}var Nv={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},vn=Ni(Tv)(Nv),Us={changes:Ev,selector:Pv,handler:Ov,initial:xv};function bv(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Us.initial(t),Us.handler(e);var n={current:t},r=Ni(Av)(n,e),i=Ni(kv)(n),s=Ni(Us.changes)(t),o=Ni(Iv)(n);function l(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(h){return h};return Us.selector(u),u(n.current)}function a(u){Sv(r,i,s,o)(u)}return[l,a]}function Iv(t,e){return rs(e)?e(t.current):e}function kv(t,e){return t.current=sf(sf({},t.current),e),e}function Av(t,e,n){return rs(e)?e(t.current):Object.keys(n).forEach(function(r){var i;return(i=e[r])===null||i===void 0?void 0:i.call(e,t.current[r])}),n}var Fv={create:bv},Rv={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.28.1/min/vs"}};function Lv(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return i.length>=t.length?t.apply(this,i):function(){for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return e.apply(n,[].concat(i,l))}}}function Dv(t){return{}.toString.call(t).includes("Object")}function Vv(t){return t||of("configIsRequired"),Dv(t)||of("configType"),t.urls?(Wv(),{paths:{vs:t.urls.monacoBase}}):t}function Wv(){console.warn(Mp.deprecation)}function jv(t,e){throw new Error(t[e]||t.default)}var Mp={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},of=Lv(jv)(Mp),Mv={config:Vv},$v=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(i){return n.reduceRight(function(s,o){return o(s)},i)}};function $p(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],$p(t[n],e[n]))}),tf(tf({},t),e)}var Bv={type:"cancelation",msg:"operation is manually canceled"};function lf(t){var e=!1,n=new Promise(function(r,i){t.then(function(s){return e?i(Bv):r(s)}),t.catch(i)});return n.cancel=function(){return e=!0},n}var Gv=Fv.create({config:Rv,isInitialized:!1,resolve:null,reject:null,monaco:null}),Bp=pv(Gv,2),fs=Bp[0],ul=Bp[1];function Uv(t){ul(function(e){return{config:$p(e.config,Mv.config(t))}})}function zv(){var t=fs(function(e){var n=e.isInitialized;return{isInitialized:n}});if(!t.isInitialized){if(window.monaco&&window.monaco.editor)return Gp(window.monaco),lf(Promise.resolve(window.monaco));$v(qv,Kv)(Jv),ul({isInitialized:!0})}return lf(Xv)}function qv(t){return document.body.appendChild(t)}function Hv(t){var e=document.createElement("script");return t&&(e.src=t),e}function Kv(t){var e=fs(function(r){var i=r.config,s=r.reject;return{config:i,reject:s}}),n=Hv("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function Jv(){var t=fs(function(n){var r=n.config,i=n.resolve,s=n.reject;return{config:r,resolve:i,reject:s}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){Gp(n),t.resolve(n)},function(n){t.reject(n)})}function Gp(t){fs().monaco||ul({monaco:t})}function Qv(){return fs(function(t){var e=t.monaco;return e})}var Xv=new Promise(function(t,e){return ul({resolve:t,reject:e})}),yu={config:Uv,init:zv,__getMonacoInstance:Qv},Up={exports:{}},Yv="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Zv=Yv,ey=Zv;function zp(){}function qp(){}qp.resetWarningCache=zp;var ty=function(){function t(r,i,s,o,l,a){if(a!==ey){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:qp,resetWarningCache:zp};return n.PropTypes=n,n};Up.exports=ty();var M=Up.exports;function Cu(){return Cu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Cu.apply(this,arguments)}const ny={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function ry({content:t}){return co.createElement("div",{style:ny},t)}const ha={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function Hp({width:t,height:e,isEditorReady:n,loading:r,_ref:i,className:s,wrapperProps:o}){return co.createElement("section",Cu({style:Dh(ei({},ha.wrapper),{width:t,height:e})},o),!n&&co.createElement(ry,{content:r}),co.createElement("div",{ref:i,style:ei(ei({},ha.fullWidth),!n&&ha.hide),className:s}))}Hp.propTypes={width:M.oneOfType([M.number,M.string]).isRequired,height:M.oneOfType([M.number,M.string]).isRequired,loading:M.oneOfType([M.element,M.string]).isRequired,isEditorReady:M.bool.isRequired,className:M.string,wrapperProps:M.object};var iy=oe.exports.memo(Hp);function Kp(t){oe.exports.useEffect(t,[])}function rr(t,e,n=!0){const r=oe.exports.useRef(!0);oe.exports.useEffect(r.current||!n?()=>{r.current=!1}:t,e)}function ca(){}function af(t,e,n,r){return sy(t,r)||oy(t,e,n,r)}function sy(t,e){return t.editor.getModel(Jp(t,e))}function oy(t,e,n,r){return t.editor.createModel(e,n,r&&Jp(t,r))}function Jp(t,e){return t.Uri.parse(e)}function ly(t){return t===void 0}var Ch={exports:{}},ds={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ay=oe.exports,Qp=60103;ds.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var uf=Symbol.for;Qp=uf("react.element"),ds.Fragment=uf("react.fragment")}var uy=ay.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hy=Object.prototype.hasOwnProperty,cy={key:!0,ref:!0,__self:!0,__source:!0};function Xp(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)hy.call(e,r)&&!cy.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Qp,type:t,key:s,ref:o,props:i,_owner:uy.current}}ds.jsx=Xp;ds.jsxs=Xp;Ch.exports=ds;const fy=Ch.exports.jsx,X_=Ch.exports.jsxs;M.string,M.string,M.string,M.string,M.string,M.string,M.string,M.bool,M.bool,M.string,M.oneOfType([M.element,M.string]),M.object,M.oneOfType([M.number,M.string]),M.oneOfType([M.number,M.string]),M.string,M.object,M.func,M.func;function Y_(){const[t,e]=oe.exports.useState(yu.__getMonacoInstance());return Kp(()=>{let n;return t||(n=yu.init(),n.then(r=>{e(r)})),()=>{var r;return(r=n)===null||r===void 0?void 0:r.cancel()}}),t}function dy(t){const e=oe.exports.useRef();return oe.exports.useEffect(()=>{e.current=t},[t]),e.current}const zs=new Map;function Sh({defaultValue:t,defaultLanguage:e,defaultPath:n,value:r,language:i,path:s,theme:o,line:l,loading:a,options:u,overrideServices:h,saveViewState:S,keepCurrentModel:d,width:C,height:E,className:T,wrapperProps:p,beforeMount:f,onMount:g,onChange:y,onValidate:P}){const[F,A]=oe.exports.useState(!1),[W,R]=oe.exports.useState(!0),k=oe.exports.useRef(null),z=oe.exports.useRef(null),Fe=oe.exports.useRef(null),me=oe.exports.useRef(g),Q=oe.exports.useRef(f),ze=oe.exports.useRef(null),m=oe.exports.useRef(r),w=dy(s);Kp(()=>{const x=yu.init();return x.then(D=>(k.current=D)&&R(!1)).catch(D=>(D==null?void 0:D.type)!=="cancelation"&&console.error("Monaco initialization: error:",D)),()=>z.current?N():x.cancel()}),rr(()=>{const x=af(k.current,t||r,e||i,s);x!==z.current.getModel()&&(S&&zs.set(w,z.current.saveViewState()),z.current.setModel(x),S&&z.current.restoreViewState(zs.get(s)))},[s],F),rr(()=>{z.current.updateOptions(u)},[u],F),rr(()=>{z.current.getOption(k.current.editor.EditorOption.readOnly)?z.current.setValue(r):r!==z.current.getValue()&&(z.current.executeEdits("",[{range:z.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),z.current.pushUndoStop())},[r],F),rr(()=>{k.current.editor.setModelLanguage(z.current.getModel(),i)},[i],F),rr(()=>{ly(l)||z.current.revealLine(l)},[l],F),rr(()=>{k.current.editor.setTheme(o)},[o],F);const O=oe.exports.useCallback(()=>{Q.current(k.current);const x=s||n,D=af(k.current,r||t,e||i,x);z.current=k.current.editor.create(Fe.current,ei({model:D,automaticLayout:!0},u),h),S&&z.current.restoreViewState(zs.get(x)),k.current.editor.setTheme(o),A(!0)},[t,e,n,r,i,s,u,h,S,o]);oe.exports.useEffect(()=>{F&&me.current(z.current,k.current)},[F]),oe.exports.useEffect(()=>{!W&&!F&&O()},[W,F,O]),m.current=r,oe.exports.useEffect(()=>{if(F&&y){var x,D;(x=ze.current)===null||x===void 0||x.dispose(),ze.current=(D=z.current)===null||D===void 0?void 0:D.onDidChangeModelContent(b=>{const V=z.current.getValue();m.current!==V&&y(V,b)})}},[F,y]),oe.exports.useEffect(()=>{if(F){const x=k.current.editor.onDidChangeMarkers(D=>{var b;const V=(b=z.current.getModel())===null||b===void 0?void 0:b.uri;if(V&&D.find(J=>J.path===V.path)){const J=k.current.editor.getModelMarkers({resource:V});P==null||P(J)}});return()=>{x==null||x.dispose()}}},[F,P]);function N(){var x;if((x=ze.current)===null||x===void 0||x.dispose(),d)S&&zs.set(s,z.current.saveViewState());else{var D;(D=z.current.getModel())===null||D===void 0||D.dispose()}z.current.dispose()}return fy(iy,{width:C,height:E,isEditorReady:F,loading:a,_ref:Fe,className:T,wrapperProps:p})}Sh.propTypes={defaultValue:M.string,defaultPath:M.string,defaultLanguage:M.string,value:M.string,language:M.string,path:M.string,theme:M.string,line:M.number,loading:M.oneOfType([M.element,M.string]),options:M.object,overrideServices:M.object,saveViewState:M.bool,keepCurrentModel:M.bool,width:M.oneOfType([M.number,M.string]),height:M.oneOfType([M.number,M.string]),className:M.string,wrapperProps:M.object,beforeMount:M.func,onMount:M.func,onChange:M.func,onValidate:M.func};Sh.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:ca,onMount:ca,onValidate:ca};var Z_=oe.exports.memo(Sh),py={},is={};Object.defineProperty(is,"__esModule",{value:!0});is.CompilerOptions=void 0;class my{constructor(e=null,n=[],r=!1,i=null,s=null){this.sourceFilename=e,this.pluginNames=n,this.countAllVisits=r,this.errorHandler=i,this.fileHandler=s}}is.CompilerOptions=my;var hl={};Object.defineProperty(hl,"__esModule",{value:!0});hl.DebugSourceRange=void 0;class gy{constructor(e,n,r){this.length=e,this.debugMetadata=n,this.text=r}}hl.DebugSourceRange=gy;var wh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Error=1]="Error",e[e.Warning=2]="Warning"}(t.ErrorType||(t.ErrorType={}))})(wh);var Yp={},cl={};Object.defineProperty(cl,"__esModule",{value:!0});cl.Argument=void 0;class vy{constructor(e=null,n=null,r=null){this.identifier=e,this.isByReference=n,this.isDivertTarget=r}}cl.Argument=vy;var $r={},ue={},K={};Object.defineProperty(K,"__esModule",{value:!0});K.filterUndef=K.isEquatable=K.nullIfUndefined=K.asINamedContentOrNull=K.asBooleanOrThrows=K.asNumberOrThrows=K.asOrThrows=K.asOrNull=void 0;function yy(t,e){return t instanceof e?Zp(t):null}K.asOrNull=yy;function Cy(t,e){if(t instanceof e)return Zp(t);throw new Error(`${t} is not of type ${e}`)}K.asOrThrows=Cy;function Sy(t){if(typeof t=="number")return t;throw new Error(`${t} is not a number`)}K.asNumberOrThrows=Sy;function wy(t){if(typeof t=="boolean")return t;throw new Error(`${t} is not a boolean`)}K.asBooleanOrThrows=wy;function _y(t){return t.hasValidName&&t.name?t:null}K.asINamedContentOrNull=_y;function Ey(t){return typeof t=="undefined"?null:t}K.nullIfUndefined=Ey;function Py(t){return typeof t=="object"&&typeof t.Equals=="function"}K.isEquatable=Py;function Zp(t,e){return t}function Oy(t){return t!=null}K.filterUndef=Oy;Object.defineProperty(ue,"__esModule",{value:!0});ue.ParsedObject=void 0;const hf=K;class xy{constructor(){this._alreadyHadError=!1,this._alreadyHadWarning=!1,this._debugMetadata=null,this._runtimeObject=null,this.content=[],this.parent=null,this.GetType=()=>this.typeName,this.AddContent=e=>{this.content===null&&(this.content=[]);const n=Array.isArray(e)?e:[e];for(const r of n)r.hasOwnProperty("parent")&&(r.parent=this),this.content.push(r);if(!Array.isArray(e))return e},this.InsertContent=(e,n)=>(this.content===null&&(this.content=[]),n.parent=this,this.content.splice(e,0,n),n),this.Find=e=>(n=null)=>{let r=hf.asOrNull(this,e);if(r!==null&&(n===null||n(r)===!0))return r;if(this.content===null)return null;for(const i of this.content){let s=i.Find&&i.Find(e)(n);if(s)return s}return null},this.FindAll=e=>(n,r)=>{const i=Array.isArray(r)?r:[],s=hf.asOrNull(this,e);if(s!==null&&(!n||n(s)===!0)&&i.push(s),this.content===null)return[];for(const o of this.content)o.FindAll&&o.FindAll(e)(n,i);return i},this.Warning=(e,n=null)=>{this.Error(e,n,!0)}}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get hasOwnDebugMetadata(){return Boolean(this.debugMetadata)}get typeName(){return"ParsedObject"}get story(){let e=this;for(;e.parent;)e=e.parent;return e}get runtimeObject(){return this._runtimeObject||(this._runtimeObject=this.GenerateRuntimeObject(),this._runtimeObject&&(this._runtimeObject.debugMetadata=this.debugMetadata)),this._runtimeObject}set runtimeObject(e){this._runtimeObject=e}get runtimePath(){if(!this.runtimeObject.path)throw new Error;return this.runtimeObject.path}get containerForCounting(){return this.runtimeObject}get ancestry(){let e=[],n=this.parent;for(;n;)e.push(n),n=n.parent;return e=e.reverse(),e}ResolveReferences(e){if(this.content!==null)for(const n of this.content)n.ResolveReferences(e)}Error(e,n=null,r=!1){if(n===null&&(n=this),!(n._alreadyHadError&&!r||n._alreadyHadWarning&&r)){if(this.parent)this.parent.Error(e,n,r);else throw new Error(`No parent object to send error to: ${e}`);r?n._alreadyHadWarning=!0:n._alreadyHadError=!0}}}ue.ParsedObject=xy;Object.defineProperty($r,"__esModule",{value:!0});$r.AuthorWarning=void 0;const Ty=ue;class Ny extends Ty.ParsedObject{constructor(e){super();this.warningMessage=e,this.GenerateRuntimeObject=()=>(this.Warning(this.warningMessage),null)}get typeName(){return"AuthorWarning"}}$r.AuthorWarning=Ny;var ps={},Ye={},Se={},fe={},Me={},Ze={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Path=void 0;class e{constructor(){if(this._components=[],this._componentsString=null,this._isRelative=!1,typeof arguments[0]=="string"){let r=arguments[0];this.componentsString=r}else if(arguments[0]instanceof e.Component&&arguments[1]instanceof e){let r=arguments[0],i=arguments[1];this._components.push(r),this._components=this._components.concat(i._components)}else if(arguments[0]instanceof Array){let r=arguments[0],i=!!arguments[1];this._components=this._components.concat(r),this._isRelative=i}}get isRelative(){return this._isRelative}get componentCount(){return this._components.length}get head(){return this._components.length>0?this._components[0]:null}get tail(){if(this._components.length>=2){let r=this._components.slice(1,this._components.length);return new e(r)}else return e.self}get length(){return this._components.length}get lastComponent(){let r=this._components.length-1;return r>=0?this._components[r]:null}get containsNamedComponent(){for(let r=0,i=this._components.length;r<i;r++)if(!this._components[r].isIndex)return!0;return!1}static get self(){let r=new e;return r._isRelative=!0,r}GetComponent(r){return this._components[r]}PathByAppendingPath(r){let i=new e,s=0;for(let o=0;o<r._components.length&&r._components[o].isParent;++o)s++;for(let o=0;o<this._components.length-s;++o)i._components.push(this._components[o]);for(let o=s;o<r._components.length;++o)i._components.push(r._components[o]);return i}get componentsString(){return this._componentsString==null&&(this._componentsString=this._components.join("."),this.isRelative&&(this._componentsString="."+this._componentsString)),this._componentsString}set componentsString(r){if(this._components.length=0,this._componentsString=r,this._componentsString==null||this._componentsString=="")return;this._componentsString[0]=="."&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));let i=this._componentsString.split(".");for(let s of i)/^(\-|\+)?([0-9]+|Infinity)$/.test(s)?this._components.push(new e.Component(parseInt(s))):this._components.push(new e.Component(s))}toString(){return this.componentsString}Equals(r){if(r==null||r._components.length!=this._components.length||r.isRelative!=this.isRelative)return!1;for(let i=0,s=r._components.length;i<s;i++)if(!r._components[i].Equals(this._components[i]))return!1;return!0}PathByAppendingComponent(r){let i=new e;return i._components.push(...this._components),i._components.push(r),i}}t.Path=e,e.parentId="^",function(n){class r{constructor(s){this.index=-1,this.name=null,typeof s=="string"?this.name=s:this.index=s}get isIndex(){return this.index>=0}get isParent(){return this.name==n.parentId}static ToParent(){return new r(n.parentId)}toString(){return this.isIndex?this.index.toString():this.name}Equals(s){return s!=null&&s.isIndex==this.isIndex?this.isIndex?this.index==s.index:this.name==s.name:!1}}n.Component=r}(e=t.Path||(t.Path={}))})(Ze);var ms={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Debug=void 0,function(e){function n(i,s,o){r(i instanceof s,o)}e.AssertType=n;function r(i,s){if(!i)throw typeof s!="undefined"&&console.warn(s),console.trace&&console.trace(),new Error("")}e.Assert=r}(t.Debug||(t.Debug={}))})(ms);var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.throwNullException=Ce.NullException=void 0;class em extends Error{}Ce.NullException=em;function by(t){throw new em(`${t} is null or undefined`)}Ce.throwNullException=by;Object.defineProperty(Me,"__esModule",{value:!0});Me.InkObject=void 0;const ir=Ze,di=Se,fa=ms,sr=K,qs=Ce;class Iy{constructor(){this.parent=null,this._debugMetadata=null,this._path=null}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get ownDebugMetadata(){return this._debugMetadata}DebugLineNumberOfPath(e){if(e===null)return null;let n=this.rootContentContainer;if(n){let r=n.ContentAtPath(e).obj;if(r){let i=r.debugMetadata;if(i!==null)return i.startLineNumber}}return null}get path(){if(this._path==null)if(this.parent==null)this._path=new ir.Path;else{let e=[],n=this,r=sr.asOrNull(n.parent,di.Container);for(;r!==null;){let i=sr.asINamedContentOrNull(n);if(i!=null&&i.hasValidName){if(i.name===null)return qs.throwNullException("namedChild.name");e.unshift(new ir.Path.Component(i.name))}else e.unshift(new ir.Path.Component(r.content.indexOf(n)));n=r,r=sr.asOrNull(r.parent,di.Container)}this._path=new ir.Path(e)}return this._path}ResolvePath(e){if(e===null)return qs.throwNullException("path");if(e.isRelative){let n=sr.asOrNull(this,di.Container);return n===null&&(fa.Debug.Assert(this.parent!==null,"Can't resolve relative path because we don't have a parent"),n=sr.asOrNull(this.parent,di.Container),fa.Debug.Assert(n!==null,"Expected parent to be a container"),fa.Debug.Assert(e.GetComponent(0).isParent),e=e.tail),n===null?qs.throwNullException("nearestContainer"):n.ContentAtPath(e)}else{let n=this.rootContentContainer;return n===null?qs.throwNullException("contentContainer"):n.ContentAtPath(e)}}ConvertPathToRelative(e){let n=this.path,r=Math.min(e.length,n.length),i=-1;for(let a=0;a<r;++a){let u=n.GetComponent(a),h=e.GetComponent(a);if(u.Equals(h))i=a;else break}if(i==-1)return e;let s=n.componentCount-1-i,o=[];for(let a=0;a<s;++a)o.push(ir.Path.Component.ToParent());for(let a=i+1;a<e.componentCount;++a)o.push(e.GetComponent(a));return new ir.Path(o,!0)}CompactPathString(e){let n=null,r=null;return e.isRelative?(r=e.componentsString,n=this.path.PathByAppendingPath(e).componentsString):(r=this.ConvertPathToRelative(e).componentsString,n=e.componentsString),r.length<n.length?r:n}get rootContentContainer(){let e=this;for(;e.parent;)e=e.parent;return sr.asOrNull(e,di.Container)}Copy(){throw Error("Not Implemented: Doesn't support copying")}SetChild(e,n,r){e[n]&&(e[n]=null),e[n]=r,e[n]&&(e[n].parent=this)}Equals(e){return e===this}}Me.InkObject=Iy;var xe={},Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.StringBuilder=void 0;class ky{constructor(e){e=typeof e!="undefined"?e.toString():"",this.string=e}get Length(){return this.string.length}Append(e){e!==null&&(this.string+=e)}AppendLine(e){typeof e!="undefined"&&this.Append(e),this.string+=`
`}AppendFormat(e,...n){this.string+=e.replace(/{(\d+)}/g,(r,i)=>typeof n[i]!="undefined"?n[i]:r)}toString(){return this.string}}Ut.StringBuilder=ky;Object.defineProperty(xe,"__esModule",{value:!0});xe.InkList=xe.InkListItem=void 0;const _t=Ce,Ay=Ut;class _e{constructor(){if(this.originName=null,this.itemName=null,typeof arguments[1]!="undefined"){let e=arguments[0],n=arguments[1];this.originName=e,this.itemName=n}else if(arguments[0]){let n=arguments[0].toString().split(".");this.originName=n[0],this.itemName=n[1]}}static get Null(){return new _e(null,null)}get isNull(){return this.originName==null&&this.itemName==null}get fullName(){return(this.originName!==null?this.originName:"?")+"."+this.itemName}toString(){return this.fullName}Equals(e){if(e instanceof _e){let n=e;return n.itemName==this.itemName&&n.originName==this.originName}return!1}copy(){return new _e(this.originName,this.itemName)}serialized(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}static fromSerializedKey(e){let n=JSON.parse(e);if(!_e.isLikeInkListItem(n))return _e.Null;let r=n;return new _e(r.originName,r.itemName)}static isLikeInkListItem(e){return!(typeof e!="object"||!e.hasOwnProperty("originName")||!e.hasOwnProperty("itemName")||typeof e.originName!="string"&&typeof e.originName!==null||typeof e.itemName!="string"&&typeof e.itemName!==null)}}xe.InkListItem=_e;class we extends Map{constructor(){super((()=>arguments[0]instanceof we?arguments[0]:[])());if(this.origins=null,this._originNames=[],arguments[0]instanceof we){let e=arguments[0];this._originNames=e.originNames,e.origins!==null&&(this.origins=e.origins.slice())}else if(typeof arguments[0]=="string"){let e=arguments[0],n=arguments[1];if(this.SetInitialOriginName(e),n.listDefinitions===null)return _t.throwNullException("originStory.listDefinitions");let r=n.listDefinitions.TryListGetDefinition(e,null);if(r.exists){if(r.result===null)return _t.throwNullException("def.result");this.origins=[r.result]}else throw new Error("InkList origin could not be found in story when constructing new list: "+e)}else if(typeof arguments[0]=="object"&&arguments[0].hasOwnProperty("Key")&&arguments[0].hasOwnProperty("Value")){let e=arguments[0];this.Add(e.Key,e.Value)}}static FromString(e,n){var r;let i=(r=n.listDefinitions)===null||r===void 0?void 0:r.FindSingleItemListWithName(e);if(i)return i.value===null?_t.throwNullException("listValue.value"):new we(i.value);throw new Error("Could not find the InkListItem from the string '"+e+"' to create an InkList because it doesn't exist in the original list definition in ink.")}AddItem(e){if(e instanceof _e){let n=e;if(n.originName==null){this.AddItem(n.itemName);return}if(this.origins===null)return _t.throwNullException("this.origins");for(let r of this.origins)if(r.name==n.originName){let i=r.TryGetValueForItem(n,0);if(i.exists){this.Add(n,i.result);return}else throw new Error("Could not add the item "+n+" to this list because it doesn't exist in the original list definition in ink.")}throw new Error("Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.")}else{let n=e,r=null;if(this.origins===null)return _t.throwNullException("this.origins");for(let o of this.origins){if(n===null)return _t.throwNullException("itemName");if(o.ContainsItemWithName(n)){if(r!=null)throw new Error("Could not add the item "+n+" to this list because it could come from either "+o.name+" or "+r.name);r=o}}if(r==null)throw new Error("Could not add the item "+n+" to this list because it isn't known to any list definitions previously associated with this list.");let i=new _e(r.name,n),s=r.ValueForItem(i);this.Add(i,s)}}ContainsItemNamed(e){for(let[n]of this)if(_e.fromSerializedKey(n).itemName==e)return!0;return!1}ContainsKey(e){return this.has(e.serialized())}Add(e,n){let r=e.serialized();if(this.has(r))throw new Error(`The Map already contains an entry for ${e}`);this.set(r,n)}Remove(e){return this.delete(e.serialized())}get Count(){return this.size}get originOfMaxItem(){if(this.origins==null)return null;let e=this.maxItem.Key.originName,n=null;return this.origins.every(r=>r.name==e?(n=r,!1):!0),n}get originNames(){if(this.Count>0){this._originNames==null&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);for(let[e]of this){let n=_e.fromSerializedKey(e);if(n.originName===null)return _t.throwNullException("item.originName");this._originNames.push(n.originName)}}return this._originNames}SetInitialOriginName(e){this._originNames=[e]}SetInitialOriginNames(e){e==null?this._originNames=null:this._originNames=e.slice()}get maxItem(){let e={Key:_e.Null,Value:0};for(let[n,r]of this){let i=_e.fromSerializedKey(n);(e.Key.isNull||r>e.Value)&&(e={Key:i,Value:r})}return e}get minItem(){let e={Key:_e.Null,Value:0};for(let[n,r]of this){let i=_e.fromSerializedKey(n);(e.Key.isNull||r<e.Value)&&(e={Key:i,Value:r})}return e}get inverse(){let e=new we;if(this.origins!=null)for(let n of this.origins)for(let[r,i]of n.items){let s=_e.fromSerializedKey(r);this.ContainsKey(s)||e.Add(s,i)}return e}get all(){let e=new we;if(this.origins!=null)for(let n of this.origins)for(let[r,i]of n.items){let s=_e.fromSerializedKey(r);e.set(s.serialized(),i)}return e}Union(e){let n=new we(this);for(let[r,i]of e)n.set(r,i);return n}Intersect(e){let n=new we;for(let[r,i]of this)e.has(r)&&n.set(r,i);return n}Without(e){let n=new we(this);for(let[r]of e)n.delete(r);return n}Contains(e){for(let[n]of e)if(!this.has(n))return!1;return!0}GreaterThan(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>e.maxItem.Value}GreaterThanOrEquals(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>=e.minItem.Value&&this.maxItem.Value>=e.maxItem.Value}LessThan(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<e.minItem.Value}LessThanOrEquals(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<=e.maxItem.Value&&this.minItem.Value<=e.minItem.Value}MaxAsList(){return this.Count>0?new we(this.maxItem):new we}MinAsList(){return this.Count>0?new we(this.minItem):new we}ListWithSubRange(e,n){if(this.Count==0)return new we;let r=this.orderedItems,i=0,s=Number.MAX_SAFE_INTEGER;Number.isInteger(e)?i=e:e instanceof we&&e.Count>0&&(i=e.minItem.Value),Number.isInteger(n)?s=n:e instanceof we&&e.Count>0&&(s=n.maxItem.Value);let o=new we;o.SetInitialOriginNames(this.originNames);for(let l of r)l.Value>=i&&l.Value<=s&&o.Add(l.Key,l.Value);return o}Equals(e){if(!(e instanceof we)||e.Count!=this.Count)return!1;for(let[n]of this)if(!e.has(n))return!1;return!0}get orderedItems(){let e=new Array;for(let[n,r]of this){let i=_e.fromSerializedKey(n);e.push({Key:i,Value:r})}return e.sort((n,r)=>n.Key.originName===null?_t.throwNullException("x.Key.originName"):r.Key.originName===null?_t.throwNullException("y.Key.originName"):n.Value==r.Value?n.Key.originName.localeCompare(r.Key.originName):n.Value<r.Value?-1:n.Value>r.Value?1:0),e}toString(){let e=this.orderedItems,n=new Ay.StringBuilder;for(let r=0;r<e.length;r++){r>0&&n.Append(", ");let i=e[r].Key;if(i.itemName===null)return _t.throwNullException("item.itemName");n.Append(i.itemName)}return n.toString()}valueOf(){return NaN}}xe.InkList=we;var Un={};Object.defineProperty(Un,"__esModule",{value:!0});Un.StoryException=void 0;class Fy extends Error{constructor(e){super(e);this.useEndLineNumber=!1,this.message=e,this.name="StoryException"}}Un.StoryException=Fy;var ht={};Object.defineProperty(ht,"__esModule",{value:!0});ht.tryParseFloat=ht.tryParseInt=ht.tryGetValueFromMap=void 0;function Ry(t,e,n){if(t===null)return{result:n,exists:!1};let r=t.get(e);return typeof r=="undefined"?{result:n,exists:!1}:{result:r,exists:!0}}ht.tryGetValueFromMap=Ry;function Ly(t,e=0){let n=parseInt(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}ht.tryParseInt=Ly;function Dy(t,e=0){let n=parseFloat(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}ht.tryParseFloat=Dy;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=t.ListValue=t.VariablePointerValue=t.DivertTargetValue=t.StringValue=t.FloatValue=t.IntValue=t.BoolValue=t.Value=t.AbstractValue=void 0;const e=Me,n=Ze,r=xe,i=Un,s=K,o=ht,l=Ce;class a extends e.InkObject{static Create(y,P){if(P){if(P===f.Int&&Number.isInteger(Number(y)))return new S(Number(y));if(P===f.Float&&!isNaN(y))return new d(Number(y))}if(typeof y=="boolean")return new h(Boolean(y));if(typeof y=="string")return new C(String(y));if(Number.isInteger(Number(y)))return new S(Number(y));if(isNaN(y)){if(y instanceof n.Path)return new E(s.asOrThrows(y,n.Path));if(y instanceof r.InkList)return new p(s.asOrThrows(y,r.InkList))}else return new d(Number(y));return null}Copy(){return s.asOrThrows(a.Create(this.valueObject),e.InkObject)}BadCastException(y){return new i.StoryException("Can't cast "+this.valueObject+" from "+this.valueType+" to "+y)}}t.AbstractValue=a;class u extends a{constructor(y){super();this.value=y}get valueObject(){return this.value}toString(){return this.value===null?l.throwNullException("Value.value"):this.value.toString()}}t.Value=u;class h extends u{constructor(y){super(y||!1)}get isTruthy(){return Boolean(this.value)}get valueType(){return f.Bool}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Int)return new S(this.value?1:0);if(y==f.Float)return new d(this.value?1:0);if(y==f.String)return new C(this.value?"true":"false");throw this.BadCastException(y)}toString(){return this.value?"true":"false"}}t.BoolValue=h;class S extends u{constructor(y){super(y||0)}get isTruthy(){return this.value!=0}get valueType(){return f.Int}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Bool)return new h(this.value!==0);if(y==f.Float)return new d(this.value);if(y==f.String)return new C(""+this.value);throw this.BadCastException(y)}}t.IntValue=S;class d extends u{constructor(y){super(y||0)}get isTruthy(){return this.value!=0}get valueType(){return f.Float}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Bool)return new h(this.value!==0);if(y==f.Int)return new S(this.value);if(y==f.String)return new C(""+this.value);throw this.BadCastException(y)}}t.FloatValue=d;class C extends u{constructor(y){super(y||"");if(this._isNewline=this.value==`
`,this._isInlineWhitespace=!0,this.value===null)return l.throwNullException("Value.value");this.value.length>0&&this.value.split("").every(P=>P!=" "&&P!="	"?(this._isInlineWhitespace=!1,!1):!0)}get valueType(){return f.String}get isTruthy(){return this.value===null?l.throwNullException("Value.value"):this.value.length>0}get isNewline(){return this._isNewline}get isInlineWhitespace(){return this._isInlineWhitespace}get isNonWhitespace(){return!this.isNewline&&!this.isInlineWhitespace}Cast(y){if(y==this.valueType)return this;if(y==f.Int){let P=o.tryParseInt(this.value);if(P.exists)return new S(P.result);throw this.BadCastException(y)}if(y==f.Float){let P=o.tryParseFloat(this.value);if(P.exists)return new d(P.result);throw this.BadCastException(y)}throw this.BadCastException(y)}}t.StringValue=C;class E extends u{constructor(y=null){super(y)}get valueType(){return f.DivertTarget}get targetPath(){return this.value===null?l.throwNullException("Value.value"):this.value}set targetPath(y){this.value=y}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a divert target")}Cast(y){if(y==this.valueType)return this;throw this.BadCastException(y)}toString(){return"DivertTargetValue("+this.targetPath+")"}}t.DivertTargetValue=E;class T extends u{constructor(y,P=-1){super(y);this._contextIndex=P}get contextIndex(){return this._contextIndex}set contextIndex(y){this._contextIndex=y}get variableName(){return this.value===null?l.throwNullException("Value.value"):this.value}set variableName(y){this.value=y}get valueType(){return f.VariablePointer}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a variable pointer")}Cast(y){if(y==this.valueType)return this;throw this.BadCastException(y)}toString(){return"VariablePointerValue("+this.variableName+")"}Copy(){return new T(this.variableName,this.contextIndex)}}t.VariablePointerValue=T;class p extends u{get isTruthy(){return this.value===null?l.throwNullException("this.value"):this.value.Count>0}get valueType(){return f.List}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==f.Int){let P=this.value.maxItem;return P.Key.isNull?new S(0):new S(P.Value)}else if(y==f.Float){let P=this.value.maxItem;return P.Key.isNull?new d(0):new d(P.Value)}else if(y==f.String){let P=this.value.maxItem;return P.Key.isNull?new C(""):new C(P.Key.toString())}if(y==this.valueType)return this;throw this.BadCastException(y)}constructor(y,P){super(null);!y&&!P?this.value=new r.InkList:y instanceof r.InkList?this.value=new r.InkList(y):y instanceof r.InkListItem&&typeof P=="number"&&(this.value=new r.InkList({Key:y,Value:P}))}static RetainListOriginsForAssignment(y,P){let F=s.asOrNull(y,p),A=s.asOrNull(P,p);if(A&&A.value===null)return l.throwNullException("newList.value");if(F&&F.value===null)return l.throwNullException("oldList.value");F&&A&&A.value.Count==0&&A.value.SetInitialOriginNames(F.value.originNames)}}t.ListValue=p;var f;(function(g){g[g.Bool=-1]="Bool",g[g.Int=0]="Int",g[g.Float=1]="Float",g[g.List=2]="List",g[g.String=3]="String",g[g.DivertTarget=4]="DivertTarget",g[g.VariablePointer=5]="VariablePointer"})(f=t.ValueType||(t.ValueType={}))})(fe);var fl={};Object.defineProperty(fl,"__esModule",{value:!0});fl.SearchResult=void 0;const Vy=Se;class _h{constructor(){this.obj=null,this.approximate=!1}get correctObj(){return this.approximate?null:this.obj}get container(){return this.obj instanceof Vy.Container?this.obj:null}copy(){let e=new _h;return e.obj=this.obj,e.approximate=this.approximate,e}}fl.SearchResult=_h;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;const e=fe,n=Ce,r=Ut,i=Me,s=fl,o=Ze,l=ms,a=ht,u=K;class h extends i.InkObject{constructor(){super(...arguments);this.name=null,this._content=[],this.namedContent=new Map,this.visitsShouldBeCounted=!1,this.turnIndexShouldBeCounted=!1,this.countingAtStartOnly=!1,this._pathToFirstLeafContent=null}get hasValidName(){return this.name!=null&&this.name.length>0}get content(){return this._content}set content(d){this.AddContent(d)}get namedOnlyContent(){let d=new Map;for(let[C,E]of this.namedContent){let T=u.asOrThrows(E,i.InkObject);d.set(C,T)}for(let C of this.content){let E=u.asINamedContentOrNull(C);E!=null&&E.hasValidName&&d.delete(E.name)}return d.size==0&&(d=null),d}set namedOnlyContent(d){let C=this.namedOnlyContent;if(C!=null)for(let[E]of C)this.namedContent.delete(E);if(d!=null)for(let[,E]of d){let T=u.asINamedContentOrNull(E);T!=null&&this.AddToNamedContentOnly(T)}}get countFlags(){let d=0;return this.visitsShouldBeCounted&&(d|=h.CountFlags.Visits),this.turnIndexShouldBeCounted&&(d|=h.CountFlags.Turns),this.countingAtStartOnly&&(d|=h.CountFlags.CountStartOnly),d==h.CountFlags.CountStartOnly&&(d=0),d}set countFlags(d){let C=d;(C&h.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(C&h.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(C&h.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}get pathToFirstLeafContent(){return this._pathToFirstLeafContent==null&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}get internalPathToFirstLeafContent(){let d=[],C=this;for(;C instanceof h;)C.content.length>0&&(d.push(new o.Path.Component(0)),C=C.content[0]);return new o.Path(d)}AddContent(d){if(d instanceof Array){let C=d;for(let E of C)this.AddContent(E)}else{let C=d;if(this._content.push(C),C.parent)throw new Error("content is already in "+C.parent);C.parent=this,this.TryAddNamedContent(C)}}TryAddNamedContent(d){let C=u.asINamedContentOrNull(d);C!=null&&C.hasValidName&&this.AddToNamedContentOnly(C)}AddToNamedContentOnly(d){l.Debug.AssertType(d,i.InkObject,"Can only add Runtime.Objects to a Runtime.Container");let C=u.asOrThrows(d,i.InkObject);if(C.parent=this,d.name===null)return n.throwNullException("namedContentObj.name");this.namedContent.set(d.name,d)}ContentAtPath(d,C=0,E=-1){E==-1&&(E=d.length);let T=new s.SearchResult;T.approximate=!1;let p=this,f=this;for(let g=C;g<E;++g){let y=d.GetComponent(g);if(p==null){T.approximate=!0;break}let P=p.ContentWithPathComponent(y);if(P==null){T.approximate=!0;break}f=P,p=u.asOrNull(P,h)}return T.obj=f,T}InsertContent(d,C){if(this.content.splice(C,0,d),d.parent)throw new Error("content is already in "+d.parent);d.parent=this,this.TryAddNamedContent(d)}AddContentsOfContainer(d){this.content.push(...d.content);for(let C of d.content)C.parent=this,this.TryAddNamedContent(C)}ContentWithPathComponent(d){if(d.isIndex)return d.index>=0&&d.index<this.content.length?this.content[d.index]:null;if(d.isParent)return this.parent;{if(d.name===null)return n.throwNullException("component.name");let C=a.tryGetValueFromMap(this.namedContent,d.name,null);return C.exists?u.asOrThrows(C.result,i.InkObject):null}}BuildStringOfHierarchy(){let d;if(arguments.length==0)return d=new r.StringBuilder,this.BuildStringOfHierarchy(d,0,null),d.toString();d=arguments[0];let C=arguments[1],E=arguments[2];function T(){for(let g=0;g<4*C;++g)d.Append(" ")}T(),d.Append("["),this.hasValidName&&d.AppendFormat(" ({0})",this.name),this==E&&d.Append("  <---"),d.AppendLine(),C++;for(let f=0;f<this.content.length;++f){let g=this.content[f];g instanceof h?g.BuildStringOfHierarchy(d,C,E):(T(),g instanceof e.StringValue?(d.Append('"'),d.Append(g.toString().replace(`
`,"\\n")),d.Append('"')):d.Append(g.toString())),f!=this.content.length-1&&d.Append(","),!(g instanceof h)&&g==E&&d.Append("  <---"),d.AppendLine()}let p=new Map;for(let[f,g]of this.namedContent)this.content.indexOf(u.asOrThrows(g,i.InkObject))>=0||p.set(f,g);if(p.size>0){T(),d.AppendLine("-- named: --");for(let[,f]of p)l.Debug.AssertType(f,h,"Can only print out named Containers"),f.BuildStringOfHierarchy(d,C,E),d.AppendLine()}C--,T(),d.Append("]")}}t.Container=h,function(S){(function(d){d[d.Visits=1]="Visits",d[d.Turns=2]="Turns",d[d.CountStartOnly=4]="CountStartOnly"})(S.CountFlags||(S.CountFlags={}))}(h=t.Container||(t.Container={}))})(Se);var Ue={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlCommand=void 0;const e=Me;class n extends e.InkObject{constructor(i=n.CommandType.NotSet){super();this._commandType=i}get commandType(){return this._commandType}Copy(){return new n(this.commandType)}static EvalStart(){return new n(n.CommandType.EvalStart)}static EvalOutput(){return new n(n.CommandType.EvalOutput)}static EvalEnd(){return new n(n.CommandType.EvalEnd)}static Duplicate(){return new n(n.CommandType.Duplicate)}static PopEvaluatedValue(){return new n(n.CommandType.PopEvaluatedValue)}static PopFunction(){return new n(n.CommandType.PopFunction)}static PopTunnel(){return new n(n.CommandType.PopTunnel)}static BeginString(){return new n(n.CommandType.BeginString)}static EndString(){return new n(n.CommandType.EndString)}static NoOp(){return new n(n.CommandType.NoOp)}static ChoiceCount(){return new n(n.CommandType.ChoiceCount)}static Turns(){return new n(n.CommandType.Turns)}static TurnsSince(){return new n(n.CommandType.TurnsSince)}static ReadCount(){return new n(n.CommandType.ReadCount)}static Random(){return new n(n.CommandType.Random)}static SeedRandom(){return new n(n.CommandType.SeedRandom)}static VisitIndex(){return new n(n.CommandType.VisitIndex)}static SequenceShuffleIndex(){return new n(n.CommandType.SequenceShuffleIndex)}static StartThread(){return new n(n.CommandType.StartThread)}static Done(){return new n(n.CommandType.Done)}static End(){return new n(n.CommandType.End)}static ListFromInt(){return new n(n.CommandType.ListFromInt)}static ListRange(){return new n(n.CommandType.ListRange)}static ListRandom(){return new n(n.CommandType.ListRandom)}toString(){return this.commandType.toString()}}t.ControlCommand=n,function(r){(function(i){i[i.NotSet=-1]="NotSet",i[i.EvalStart=0]="EvalStart",i[i.EvalOutput=1]="EvalOutput",i[i.EvalEnd=2]="EvalEnd",i[i.Duplicate=3]="Duplicate",i[i.PopEvaluatedValue=4]="PopEvaluatedValue",i[i.PopFunction=5]="PopFunction",i[i.PopTunnel=6]="PopTunnel",i[i.BeginString=7]="BeginString",i[i.EndString=8]="EndString",i[i.NoOp=9]="NoOp",i[i.ChoiceCount=10]="ChoiceCount",i[i.Turns=11]="Turns",i[i.TurnsSince=12]="TurnsSince",i[i.Random=13]="Random",i[i.SeedRandom=14]="SeedRandom",i[i.VisitIndex=15]="VisitIndex",i[i.SequenceShuffleIndex=16]="SequenceShuffleIndex",i[i.StartThread=17]="StartThread",i[i.Done=18]="Done",i[i.End=19]="End",i[i.ListFromInt=20]="ListFromInt",i[i.ListRange=21]="ListRange",i[i.ListRandom=22]="ListRandom",i[i.ReadCount=23]="ReadCount",i[i.TOTAL_VALUES=24]="TOTAL_VALUES"})(r.CommandType||(r.CommandType={}))}(n=t.ControlCommand||(t.ControlCommand={}))})(Ue);Object.defineProperty(Ye,"__esModule",{value:!0});Ye.Expression=void 0;const cf=Se,da=Ue,Wy=ue;class jy extends Wy.ParsedObject{constructor(){super(...arguments);this._prototypeRuntimeConstantExpression=null,this.outputWhenComplete=!1,this.GenerateRuntimeObject=()=>{const e=new cf.Container;return e.AddContent(da.ControlCommand.EvalStart()),this.GenerateIntoContainer(e),this.outputWhenComplete&&e.AddContent(da.ControlCommand.EvalOutput()),e.AddContent(da.ControlCommand.EvalEnd()),e},this.GenerateConstantIntoContainer=e=>{this._prototypeRuntimeConstantExpression===null&&(this._prototypeRuntimeConstantExpression=new cf.Container,this.GenerateIntoContainer(this._prototypeRuntimeConstantExpression));for(const n of this._prototypeRuntimeConstantExpression.content){const r=n.Copy();r&&e.AddContent(r)}},this.toString=()=>"No string value in JavaScript."}get typeName(){return"Expression"}}Ye.Expression=jy;var pt={},zt={};Object.defineProperty(zt,"__esModule",{value:!0});zt.Void=void 0;const My=Me;class $y extends My.InkObject{}zt.Void=$y;Object.defineProperty(pt,"__esModule",{value:!0});pt.NativeFunctionCall=void 0;const B=fe,pi=Un,By=zt,Hs=xe,Gy=Me,it=K,Ke=Ce;class q extends Gy.InkObject{constructor(){super();if(this._name=null,this._numberOfParameters=0,this._prototype=null,this._isPrototype=!1,this._operationFuncs=null,arguments.length===0)q.GenerateNativeFunctionsIfNecessary();else if(arguments.length===1){let e=arguments[0];q.GenerateNativeFunctionsIfNecessary(),this.name=e}else if(arguments.length===2){let e=arguments[0],n=arguments[1];this._isPrototype=!0,this.name=e,this.numberOfParameters=n}}static CallWithName(e){return new q(e)}static CallExistsWithName(e){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(e)}get name(){return this._name===null?Ke.throwNullException("NativeFunctionCall._name"):this._name}set name(e){this._name=e,this._isPrototype||(q._nativeFunctions===null?Ke.throwNullException("NativeFunctionCall._nativeFunctions"):this._prototype=q._nativeFunctions.get(this._name)||null)}get numberOfParameters(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters}set numberOfParameters(e){this._numberOfParameters=e}Call(e){if(this._prototype)return this._prototype.Call(e);if(this.numberOfParameters!=e.length)throw new Error("Unexpected number of parameters");let n=!1;for(let s of e){if(s instanceof By.Void)throw new pi.StoryException('Attempting to perform operation on a void value. Did you forget to "return" a value from a function you called here?');s instanceof B.ListValue&&(n=!0)}if(e.length==2&&n)return this.CallBinaryListOperation(e);let r=this.CoerceValuesToSingleType(e),i=r[0].valueType;return i==B.ValueType.Int?this.CallType(r):i==B.ValueType.Float?this.CallType(r):i==B.ValueType.String?this.CallType(r):i==B.ValueType.DivertTarget?this.CallType(r):i==B.ValueType.List?this.CallType(r):null}CallType(e){let n=it.asOrThrows(e[0],B.Value),r=n.valueType,i=n,s=e.length;if(s==2||s==1){if(this._operationFuncs===null)return Ke.throwNullException("NativeFunctionCall._operationFuncs");let o=this._operationFuncs.get(r);if(!o){const l=B.ValueType[r];throw new pi.StoryException("Cannot perform operation "+this.name+" on "+l)}if(s==2){let a=it.asOrThrows(e[1],B.Value),u=o;if(i.value===null||a.value===null)return Ke.throwNullException("NativeFunctionCall.Call BinaryOp values");let h=u(i.value,a.value);return B.Value.Create(h)}else{let l=o;if(i.value===null)return Ke.throwNullException("NativeFunctionCall.Call UnaryOp value");let a=l(i.value);return this.name===q.Int?B.Value.Create(a,B.ValueType.Int):this.name===q.Float?B.Value.Create(a,B.ValueType.Float):B.Value.Create(a,n.valueType)}}else throw new Error("Unexpected number of parameters to NativeFunctionCall: "+e.length)}CallBinaryListOperation(e){if((this.name=="+"||this.name=="-")&&e[0]instanceof B.ListValue&&e[1]instanceof B.IntValue)return this.CallListIncrementOperation(e);let n=it.asOrThrows(e[0],B.Value),r=it.asOrThrows(e[1],B.Value);if((this.name=="&&"||this.name=="||")&&(n.valueType!=B.ValueType.List||r.valueType!=B.ValueType.List)){if(this._operationFuncs===null)return Ke.throwNullException("NativeFunctionCall._operationFuncs");let i=this._operationFuncs.get(B.ValueType.Int);if(i===null)return Ke.throwNullException("NativeFunctionCall.CallBinaryListOperation op");let s=it.asBooleanOrThrows(i(n.isTruthy?1:0,r.isTruthy?1:0));return new B.BoolValue(s)}if(n.valueType==B.ValueType.List&&r.valueType==B.ValueType.List)return this.CallType([n,r]);throw new pi.StoryException("Can not call use "+this.name+" operation on "+B.ValueType[n.valueType]+" and "+B.ValueType[r.valueType])}CallListIncrementOperation(e){let n=it.asOrThrows(e[0],B.ListValue),r=it.asOrThrows(e[1],B.IntValue),i=new Hs.InkList;if(n.value===null)return Ke.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value");for(let[s,o]of n.value){let l=Hs.InkListItem.fromSerializedKey(s);if(this._operationFuncs===null)return Ke.throwNullException("NativeFunctionCall._operationFuncs");let a=this._operationFuncs.get(B.ValueType.Int);if(r.value===null)return Ke.throwNullException("NativeFunctionCall.CallListIncrementOperation intVal.value");let u=a(o,r.value),h=null;if(n.value.origins===null)return Ke.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value.origins");for(let S of n.value.origins)if(S.name==l.originName){h=S;break}if(h!=null){let S=h.TryGetItemWithValue(u,Hs.InkListItem.Null);S.exists&&i.Add(S.result,u)}}return new B.ListValue(i)}CoerceValuesToSingleType(e){let n=B.ValueType.Int,r=null;for(let s of e){let o=it.asOrThrows(s,B.Value);o.valueType>n&&(n=o.valueType),o.valueType==B.ValueType.List&&(r=it.asOrNull(o,B.ListValue))}let i=[];if(B.ValueType[n]==B.ValueType[B.ValueType.List])for(let s of e){let o=it.asOrThrows(s,B.Value);if(o.valueType==B.ValueType.List)i.push(o);else if(o.valueType==B.ValueType.Int){let l=parseInt(o.valueObject);if(r=it.asOrThrows(r,B.ListValue),r.value===null)return Ke.throwNullException("NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value");let a=r.value.originOfMaxItem;if(a===null)return Ke.throwNullException("NativeFunctionCall.CoerceValuesToSingleType list");let u=a.TryGetItemWithValue(l,Hs.InkListItem.Null);if(u.exists){let h=new B.ListValue(u.result,l);i.push(h)}else throw new pi.StoryException("Could not find List item with the value "+l+" in "+a.name)}else{const l=B.ValueType[o.valueType];throw new pi.StoryException("Cannot mix Lists and "+l+" values in this operation")}}else for(let s of e){let l=it.asOrThrows(s,B.Value).Cast(n);i.push(l)}return i}static Identity(e){return e}static GenerateNativeFunctionsIfNecessary(){if(this._nativeFunctions==null){this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,(r,i)=>r+i),this.AddIntBinaryOp(this.Subtract,(r,i)=>r-i),this.AddIntBinaryOp(this.Multiply,(r,i)=>r*i),this.AddIntBinaryOp(this.Divide,(r,i)=>Math.floor(r/i)),this.AddIntBinaryOp(this.Mod,(r,i)=>r%i),this.AddIntUnaryOp(this.Negate,r=>-r),this.AddIntBinaryOp(this.Equal,(r,i)=>r==i),this.AddIntBinaryOp(this.Greater,(r,i)=>r>i),this.AddIntBinaryOp(this.Less,(r,i)=>r<i),this.AddIntBinaryOp(this.GreaterThanOrEquals,(r,i)=>r>=i),this.AddIntBinaryOp(this.LessThanOrEquals,(r,i)=>r<=i),this.AddIntBinaryOp(this.NotEquals,(r,i)=>r!=i),this.AddIntUnaryOp(this.Not,r=>r==0),this.AddIntBinaryOp(this.And,(r,i)=>r!=0&&i!=0),this.AddIntBinaryOp(this.Or,(r,i)=>r!=0||i!=0),this.AddIntBinaryOp(this.Max,(r,i)=>Math.max(r,i)),this.AddIntBinaryOp(this.Min,(r,i)=>Math.min(r,i)),this.AddIntBinaryOp(this.Pow,(r,i)=>Math.pow(r,i)),this.AddIntUnaryOp(this.Floor,q.Identity),this.AddIntUnaryOp(this.Ceiling,q.Identity),this.AddIntUnaryOp(this.Int,q.Identity),this.AddIntUnaryOp(this.Float,r=>r),this.AddFloatBinaryOp(this.Add,(r,i)=>r+i),this.AddFloatBinaryOp(this.Subtract,(r,i)=>r-i),this.AddFloatBinaryOp(this.Multiply,(r,i)=>r*i),this.AddFloatBinaryOp(this.Divide,(r,i)=>r/i),this.AddFloatBinaryOp(this.Mod,(r,i)=>r%i),this.AddFloatUnaryOp(this.Negate,r=>-r),this.AddFloatBinaryOp(this.Equal,(r,i)=>r==i),this.AddFloatBinaryOp(this.Greater,(r,i)=>r>i),this.AddFloatBinaryOp(this.Less,(r,i)=>r<i),this.AddFloatBinaryOp(this.GreaterThanOrEquals,(r,i)=>r>=i),this.AddFloatBinaryOp(this.LessThanOrEquals,(r,i)=>r<=i),this.AddFloatBinaryOp(this.NotEquals,(r,i)=>r!=i),this.AddFloatUnaryOp(this.Not,r=>r==0),this.AddFloatBinaryOp(this.And,(r,i)=>r!=0&&i!=0),this.AddFloatBinaryOp(this.Or,(r,i)=>r!=0||i!=0),this.AddFloatBinaryOp(this.Max,(r,i)=>Math.max(r,i)),this.AddFloatBinaryOp(this.Min,(r,i)=>Math.min(r,i)),this.AddFloatBinaryOp(this.Pow,(r,i)=>Math.pow(r,i)),this.AddFloatUnaryOp(this.Floor,r=>Math.floor(r)),this.AddFloatUnaryOp(this.Ceiling,r=>Math.ceil(r)),this.AddFloatUnaryOp(this.Int,r=>Math.floor(r)),this.AddFloatUnaryOp(this.Float,q.Identity),this.AddStringBinaryOp(this.Add,(r,i)=>r+i),this.AddStringBinaryOp(this.Equal,(r,i)=>r===i),this.AddStringBinaryOp(this.NotEquals,(r,i)=>r!==i),this.AddStringBinaryOp(this.Has,(r,i)=>r.includes(i)),this.AddStringBinaryOp(this.Hasnt,(r,i)=>!r.includes(i)),this.AddListBinaryOp(this.Add,(r,i)=>r.Union(i)),this.AddListBinaryOp(this.Subtract,(r,i)=>r.Without(i)),this.AddListBinaryOp(this.Has,(r,i)=>r.Contains(i)),this.AddListBinaryOp(this.Hasnt,(r,i)=>!r.Contains(i)),this.AddListBinaryOp(this.Intersect,(r,i)=>r.Intersect(i)),this.AddListBinaryOp(this.Equal,(r,i)=>r.Equals(i)),this.AddListBinaryOp(this.Greater,(r,i)=>r.GreaterThan(i)),this.AddListBinaryOp(this.Less,(r,i)=>r.LessThan(i)),this.AddListBinaryOp(this.GreaterThanOrEquals,(r,i)=>r.GreaterThanOrEquals(i)),this.AddListBinaryOp(this.LessThanOrEquals,(r,i)=>r.LessThanOrEquals(i)),this.AddListBinaryOp(this.NotEquals,(r,i)=>!r.Equals(i)),this.AddListBinaryOp(this.And,(r,i)=>r.Count>0&&i.Count>0),this.AddListBinaryOp(this.Or,(r,i)=>r.Count>0||i.Count>0),this.AddListUnaryOp(this.Not,r=>r.Count==0?1:0),this.AddListUnaryOp(this.Invert,r=>r.inverse),this.AddListUnaryOp(this.All,r=>r.all),this.AddListUnaryOp(this.ListMin,r=>r.MinAsList()),this.AddListUnaryOp(this.ListMax,r=>r.MaxAsList()),this.AddListUnaryOp(this.Count,r=>r.Count),this.AddListUnaryOp(this.ValueOfList,r=>r.maxItem.Value);let e=(r,i)=>r.Equals(i),n=(r,i)=>!r.Equals(i);this.AddOpToNativeFunc(this.Equal,2,B.ValueType.DivertTarget,e),this.AddOpToNativeFunc(this.NotEquals,2,B.ValueType.DivertTarget,n)}}AddOpFuncForType(e,n){this._operationFuncs==null&&(this._operationFuncs=new Map),this._operationFuncs.set(e,n)}static AddOpToNativeFunc(e,n,r,i){if(this._nativeFunctions===null)return Ke.throwNullException("NativeFunctionCall._nativeFunctions");let s=this._nativeFunctions.get(e);s||(s=new q(e,n),this._nativeFunctions.set(e,s)),s.AddOpFuncForType(r,i)}static AddIntBinaryOp(e,n){this.AddOpToNativeFunc(e,2,B.ValueType.Int,n)}static AddIntUnaryOp(e,n){this.AddOpToNativeFunc(e,1,B.ValueType.Int,n)}static AddFloatBinaryOp(e,n){this.AddOpToNativeFunc(e,2,B.ValueType.Float,n)}static AddFloatUnaryOp(e,n){this.AddOpToNativeFunc(e,1,B.ValueType.Float,n)}static AddStringBinaryOp(e,n){this.AddOpToNativeFunc(e,2,B.ValueType.String,n)}static AddListBinaryOp(e,n){this.AddOpToNativeFunc(e,2,B.ValueType.List,n)}static AddListUnaryOp(e,n){this.AddOpToNativeFunc(e,1,B.ValueType.List,n)}toString(){return'Native "'+this.name+'"'}}pt.NativeFunctionCall=q;q.Add="+";q.Subtract="-";q.Divide="/";q.Multiply="*";q.Mod="%";q.Negate="_";q.Equal="==";q.Greater=">";q.Less="<";q.GreaterThanOrEquals=">=";q.LessThanOrEquals="<=";q.NotEquals="!=";q.Not="!";q.And="&&";q.Or="||";q.Min="MIN";q.Max="MAX";q.Pow="POW";q.Floor="FLOOR";q.Ceiling="CEILING";q.Int="INT";q.Float="FLOAT";q.Has="?";q.Hasnt="!?";q.Intersect="^";q.ListMin="LIST_MIN";q.ListMax="LIST_MAX";q.All="LIST_ALL";q.Count="LIST_COUNT";q.ValueOfList="LIST_VALUE";q.Invert="LIST_INVERT";q._nativeFunctions=null;var gs={},Br={};Object.defineProperty(Br,"__esModule",{value:!0});Br.NumberExpression=void 0;const Uy=Ye,pa=fe;class zy extends Uy.Expression{constructor(e,n){super();if(this.isInt=()=>this.subtype=="int",this.isFloat=()=>this.subtype=="float",this.isBool=()=>this.subtype=="bool",this.GenerateIntoContainer=r=>{this.isInt()?r.AddContent(new pa.IntValue(this.value)):this.isFloat()?r.AddContent(new pa.FloatValue(this.value)):this.isBool()&&r.AddContent(new pa.BoolValue(this.value))},this.toString=()=>String(this.value),typeof e=="number"&&!Number.isNaN(e)||typeof e=="boolean")this.value=e,this.subtype=n;else throw new Error("Unexpected object type in NumberExpression.")}get typeName(){return"Number"}}Br.NumberExpression=zy;Object.defineProperty(gs,"__esModule",{value:!0});gs.UnaryExpression=void 0;const qy=Ye,Hy=pt,or=Br,Ky=K;class Su extends qy.Expression{constructor(e,n){super();this.op=n,this.GenerateIntoContainer=r=>{this.innerExpression.GenerateIntoContainer(r),r.AddContent(Hy.NativeFunctionCall.CallWithName(this.nativeNameForOp))},this.toString=()=>this.nativeNameForOp+this.innerExpression,this.innerExpression=this.AddContent(e)}get nativeNameForOp(){return this.op==="-"?"_":this.op==="not"?"!":this.op}get typeName(){return"UnaryExpression"}}gs.UnaryExpression=Su;Su.WithInner=(t,e)=>{const n=Ky.asOrNull(t,or.NumberExpression);if(n){if(e==="-"){if(n.isInt())return new or.NumberExpression(-n.value,"int");if(n.isFloat())return new or.NumberExpression(-n.value,"float")}else if(e=="!"||e=="not"){if(n.isInt())return new or.NumberExpression(n.value==0,"bool");if(n.isFloat())return new or.NumberExpression(n.value==0,"bool");if(n.isBool())return new or.NumberExpression(!n.value,"bool")}throw new Error("Unexpected operation or number type")}return new Su(t,e)};Object.defineProperty(ps,"__esModule",{value:!0});ps.BinaryExpression=void 0;const Jy=Ye,Qy=pt,Xy=gs,Yy=K;class Zy extends Jy.Expression{constructor(e,n,r){super();this.opName=r,this.GenerateIntoContainer=i=>{this.leftExpression.GenerateIntoContainer(i),this.rightExpression.GenerateIntoContainer(i),this.opName=this.NativeNameForOp(this.opName),i.AddContent(Qy.NativeFunctionCall.CallWithName(this.opName))},this.NativeNameForOp=i=>i==="and"?"&&":i==="or"?"||":i==="mod"?"%":i==="has"?"?":i==="hasnt"?"!?":i,this.toString=()=>`(${this.leftExpression} ${this.opName} ${this.rightExpression})`,this.leftExpression=this.AddContent(e),this.rightExpression=this.AddContent(n),this.opName=r}get typeName(){return"BinaryExpression"}ResolveReferences(e){if(super.ResolveReferences(e),this.NativeNameForOp(this.opName)==="?"){const n=Yy.asOrNull(this.leftExpression,Xy.UnaryExpression);n!==null&&(n.op==="not"||n.op==="!")&&this.Error(`Using 'not' or '!' here negates '${n.innerExpression}' rather than the result of the '?' or 'has' operator. You need to add parentheses around the (A ? B) expression.`)}}}ps.BinaryExpression=Zy;var dl={},zn={};Object.defineProperty(zn,"__esModule",{value:!0});zn.CharacterSet=void 0;class wu{constructor(e){this.set=new Set,this.Add=n=>this.set.add(n),this.AddRange=(n,r)=>{for(let i=n.charCodeAt(0);i<=r.charCodeAt(0);++i)this.Add(String.fromCharCode(i));return this},this.AddCharacters=n=>{if(typeof n=="string"||Array.isArray(n))for(const r of n)this.Add(r);else for(const r of n.set)this.Add(r);return this},e&&this.AddCharacters(e)}}zn.CharacterSet=wu;wu.FromRange=(t,e)=>new wu().AddRange(t,e);Object.defineProperty(dl,"__esModule",{value:!0});dl.CharacterRange=void 0;const ff=zn;class _u{constructor(e,n,r=[]){if(this._start=e,this._end=n,this._correspondingCharSet=new ff.CharacterSet,this._excludes=new Set,this.ToCharacterSet=()=>{if(this._correspondingCharSet.set.size===0)for(let i=this.start.charCodeAt(0),s=String.fromCharCode(i);i<=this.end.charCodeAt(0);i+=1)this._excludes.has(s)||this._correspondingCharSet.AddCharacters(s);return this._correspondingCharSet},r instanceof ff.CharacterSet)this._excludes=r.set;else for(const i of r)this._excludes.add(i)}get start(){return this._start}get end(){return this._end}}dl.CharacterRange=_u;_u.Define=(t,e,n=[])=>new _u(t,e,n);var qn={},Gr={};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.ChoicePoint=void 0;const eC=Me,tC=Ze,ma=Ce;class nC extends eC.InkObject{constructor(e=!0){super();this._pathOnChoice=null,this.hasCondition=!1,this.hasStartContent=!1,this.hasChoiceOnlyContent=!1,this.isInvisibleDefault=!1,this.onceOnly=!0,this.onceOnly=e}get pathOnChoice(){if(this._pathOnChoice!=null&&this._pathOnChoice.isRelative){let e=this.choiceTarget;e&&(this._pathOnChoice=e.path)}return this._pathOnChoice}set pathOnChoice(e){this._pathOnChoice=e}get choiceTarget(){return this._pathOnChoice===null?ma.throwNullException("ChoicePoint._pathOnChoice"):this.ResolvePath(this._pathOnChoice).container}get pathStringOnChoice(){return this.pathOnChoice===null?ma.throwNullException("ChoicePoint.pathOnChoice"):this.CompactPathString(this.pathOnChoice)}set pathStringOnChoice(e){this.pathOnChoice=new tC.Path(e)}get flags(){let e=0;return this.hasCondition&&(e|=1),this.hasStartContent&&(e|=2),this.hasChoiceOnlyContent&&(e|=4),this.isInvisibleDefault&&(e|=8),this.onceOnly&&(e|=16),e}set flags(e){this.hasCondition=(e&1)>0,this.hasStartContent=(e&2)>0,this.hasChoiceOnlyContent=(e&4)>0,this.isInvisibleDefault=(e&8)>0,this.onceOnly=(e&16)>0}toString(){if(this.pathOnChoice===null)return ma.throwNullException("ChoicePoint.pathOnChoice");let e=this.pathOnChoice.toString();return"Choice: -> "+e}}Gr.ChoicePoint=nC;var wt={},Hn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PushPopType=void 0,function(e){e[e.Tunnel=0]="Tunnel",e[e.Function=1]="Function",e[e.FunctionEvaluationFromGame=2]="FunctionEvaluationFromGame"}(t.PushPopType||(t.PushPopType={}))})(Hn);var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0});Kn.Pointer=void 0;const rC=Ze;class $i{constructor(){this.container=null,this.index=-1,arguments.length===2&&(this.container=arguments[0],this.index=arguments[1])}Resolve(){return this.index<0?this.container:this.container==null?null:this.container.content.length==0?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}get isNull(){return this.container==null}get path(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new rC.Path.Component(this.index)):this.container.path}toString(){return this.container?"Ink Pointer -> "+this.container.path.toString()+" -- index "+this.index:"Ink Pointer (null)"}copy(){return new $i(this.container,this.index)}static StartOf(e){return new $i(e,0)}static get Null(){return new $i(null,-1)}}Kn.Pointer=$i;Object.defineProperty(wt,"__esModule",{value:!0});wt.Divert=void 0;const iC=Ze,sC=Hn,oC=Ut,lC=Me,ga=Kn,df=Se,Ks=Ce;class Eh extends lC.InkObject{constructor(e){super();this._targetPath=null,this._targetPointer=ga.Pointer.Null,this.variableDivertName=null,this.pushesToStack=!1,this.stackPushType=0,this.isExternal=!1,this.externalArgs=0,this.isConditional=!1,this.pushesToStack=!1,typeof e!="undefined"&&(this.pushesToStack=!0,this.stackPushType=e)}get targetPath(){if(this._targetPath!=null&&this._targetPath.isRelative){let e=this.targetPointer.Resolve();e&&(this._targetPath=e.path)}return this._targetPath}set targetPath(e){this._targetPath=e,this._targetPointer=ga.Pointer.Null}get targetPointer(){if(this._targetPointer.isNull){let e=this.ResolvePath(this._targetPath).obj;if(this._targetPath===null)return Ks.throwNullException("this._targetPath");if(this._targetPath.lastComponent===null)return Ks.throwNullException("this._targetPath.lastComponent");if(this._targetPath.lastComponent.isIndex){if(e===null)return Ks.throwNullException("targetObj");this._targetPointer.container=e.parent instanceof df.Container?e.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=ga.Pointer.StartOf(e instanceof df.Container?e:null)}return this._targetPointer.copy()}get targetPathString(){return this.targetPath==null?null:this.CompactPathString(this.targetPath)}set targetPathString(e){e==null?this.targetPath=null:this.targetPath=new iC.Path(e)}get hasVariableTarget(){return this.variableDivertName!=null}Equals(e){let n=e;return n instanceof Eh&&this.hasVariableTarget==n.hasVariableTarget?this.hasVariableTarget?this.variableDivertName==n.variableDivertName:this.targetPath===null?Ks.throwNullException("this.targetPath"):this.targetPath.Equals(n.targetPath):!1}toString(){if(this.hasVariableTarget)return"Divert(variable: "+this.variableDivertName+")";if(this.targetPath==null)return"Divert(null)";{let e=new oC.StringBuilder,n=this.targetPath.toString();return e.Append("Divert"),this.isConditional&&e.Append("?"),this.pushesToStack&&(this.stackPushType==sC.PushPopType.Function?e.Append(" function"):e.Append(" tunnel")),e.Append(" -> "),e.Append(this.targetPathString),e.Append(" ("),e.Append(n),e.Append(")"),e.toString()}}}wt.Divert=Eh;var qt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolType=void 0,function(e){e[e.Arg=0]="Arg",e[e.Knot=1]="Knot",e[e.List=2]="List",e[e.ListItem=3]="ListItem",e[e.SubFlowAndWeave=4]="SubFlowAndWeave",e[e.Temp=5]="Temp",e[e.Var=6]="Var"}(t.SymbolType||(t.SymbolType={}))})(qt);var At={};Object.defineProperty(At,"__esModule",{value:!0});At.VariableAssignment=void 0;const aC=Me;class uC extends aC.InkObject{constructor(e,n){super();this.variableName=e||null,this.isNewDeclaration=!!n,this.isGlobal=!1}toString(){return"VarAssign to "+this.variableName}}At.VariableAssignment=uC;Object.defineProperty(qn,"__esModule",{value:!0});qn.Choice=void 0;const hC=Gr,Js=Se,Zt=Ue,va=wt,pf=fe,cC=ue,fC=qt,mf=At;class dC extends cC.ParsedObject{constructor(e,n,r){super();this._condition=null,this._innerContentContainer=null,this._outerContainer=null,this._runtimeChoice=null,this._returnToR1=null,this._returnToR2=null,this._r1Label=null,this._r2Label=null,this._divertToStartContentOuter=null,this._divertToStartContentInner=null,this._startContentRuntimeContainer=null,this.isInvisibleDefault=!1,this.hasWeaveStyleInlineBrackets=!1,this.GenerateRuntimeObject=()=>{if(this._outerContainer=new Js.Container,this._runtimeChoice=new hC.ChoicePoint(this.onceOnly),this._runtimeChoice.isInvisibleDefault=this.isInvisibleDefault,(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(Zt.ControlCommand.EvalStart()),this.startContent){this._returnToR1=new pf.DivertTargetValue,this._outerContainer.AddContent(this._returnToR1);const i=new mf.VariableAssignment("$r",!0);this._outerContainer.AddContent(i),this._outerContainer.AddContent(Zt.ControlCommand.BeginString()),this._divertToStartContentOuter=new va.Divert,this._outerContainer.AddContent(this._divertToStartContentOuter),this._startContentRuntimeContainer=this.startContent.GenerateRuntimeObject(),this._startContentRuntimeContainer.name="s";const s=new va.Divert;s.variableDivertName="$r",this._startContentRuntimeContainer.AddContent(s),this._outerContainer.AddToNamedContentOnly(this._startContentRuntimeContainer),this._r1Label=new Js.Container,this._r1Label.name="$r1",this._outerContainer.AddContent(this._r1Label),this._outerContainer.AddContent(Zt.ControlCommand.EndString()),this._runtimeChoice.hasStartContent=!0}if(this.choiceOnlyContent){this._outerContainer.AddContent(Zt.ControlCommand.BeginString());const i=this.choiceOnlyContent.GenerateRuntimeObject();this._outerContainer.AddContentsOfContainer(i),this._outerContainer.AddContent(Zt.ControlCommand.EndString()),this._runtimeChoice.hasChoiceOnlyContent=!0}if(this.condition&&(this.condition.GenerateIntoContainer(this._outerContainer),this._runtimeChoice.hasCondition=!0),(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(Zt.ControlCommand.EvalEnd()),this._outerContainer.AddContent(this._runtimeChoice),this._innerContentContainer=new Js.Container,this.startContent){this._returnToR2=new pf.DivertTargetValue,this._innerContentContainer.AddContent(Zt.ControlCommand.EvalStart()),this._innerContentContainer.AddContent(this._returnToR2),this._innerContentContainer.AddContent(Zt.ControlCommand.EvalEnd());const i=new mf.VariableAssignment("$r",!0);this._innerContentContainer.AddContent(i),this._divertToStartContentInner=new va.Divert,this._innerContentContainer.AddContent(this._divertToStartContentInner),this._r2Label=new Js.Container,this._r2Label.name="$r2",this._innerContentContainer.AddContent(this._r2Label)}if(this.innerContent){const i=this.innerContent.GenerateRuntimeObject();this._innerContentContainer.AddContentsOfContainer(i)}return this.story.countAllVisits&&(this._innerContentContainer.visitsShouldBeCounted=!0),this._innerContentContainer.countingAtStartOnly=!0,this._outerContainer},this.toString=()=>this.choiceOnlyContent!==null?`* ${this.startContent}[${this.choiceOnlyContent}]...`:`* ${this.startContent}...`,this.startContent=e,this.choiceOnlyContent=n,this.innerContent=r,this.indentationDepth=1,e&&this.AddContent(this.startContent),n&&this.AddContent(this.choiceOnlyContent),r&&this.AddContent(this.innerContent),this.onceOnly=!0}get runtimeChoice(){if(!this._runtimeChoice)throw new Error;return this._runtimeChoice}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get condition(){return this._condition}set condition(e){this._condition=e,e&&this.AddContent(e)}get runtimeContainer(){return this._innerContentContainer}get innerContentContainer(){return this._innerContentContainer}get containerForCounting(){return this._innerContentContainer}get runtimePath(){if(!this.innerContentContainer||!this.innerContentContainer.path)throw new Error;return this.innerContentContainer.path}get typeName(){return"Choice"}ResolveReferences(e){var n;if(this._innerContentContainer&&(this.runtimeChoice.pathOnChoice=this._innerContentContainer.path,this.onceOnly&&(this._innerContentContainer.visitsShouldBeCounted=!0)),this._returnToR1){if(!this._r1Label)throw new Error;this._returnToR1.targetPath=this._r1Label.path}if(this._returnToR2){if(!this._r2Label)throw new Error;this._returnToR2.targetPath=this._r2Label.path}if(this._divertToStartContentOuter){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentOuter.targetPath=this._startContentRuntimeContainer.path}if(this._divertToStartContentInner){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentInner.targetPath=this._startContentRuntimeContainer.path}super.ResolveReferences(e),this.identifier&&(((n=this.identifier)===null||n===void 0?void 0:n.name)||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,fC.SymbolType.SubFlowAndWeave)}}qn.Choice=dC;var pl={},Ph={},ml={},gl={};Object.defineProperty(gl,"__esModule",{value:!0});gl.StringParserElement=void 0;class ss{constructor(){this.characterIndex=0,this.characterInLineIndex=0,this.lineIndex=0,this.reportedErrorInScope=!1,this.uniqueId=0,this.customFlags=0,this.CopyFrom=e=>{ss._uniqueIdCounter++,this.uniqueId=ss._uniqueIdCounter,this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.customFlags=e.customFlags,this.reportedErrorInScope=!1},this.SquashFrom=e=>{this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.reportedErrorInScope=e.reportedErrorInScope}}}gl.StringParserElement=ss;ss._uniqueIdCounter=1e3;Object.defineProperty(ml,"__esModule",{value:!0});ml.StringParserState=void 0;const gf=gl;class pC{constructor(){this._stack=[],this._numElements=0,this.StringParserState=()=>{this._stack=new Array(200);for(let r=0;r<200;++r)this._stack[r]=new gf.StringParserElement;this._numElements=1},this.Push=()=>{if(this._numElements>=this._stack.length&&this._numElements>0)throw new Error("Stack overflow in parser state.");const n=this._stack[this._numElements-1],r=this._stack[this._numElements];return this._numElements++,r.CopyFrom(n),r.uniqueId},this.Pop=n=>{if(this._numElements==1)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");if(this.currentElement.uniqueId!=n)throw new Error("Mismatched rule IDs while Poping - do you have mismatched Begin/Succeed/Fail?");this._numElements-=1},this.Peek=n=>{if(this.currentElement.uniqueId!=n)throw new Error("Mismatched rule IDs while Peeking - do you have mismatched Begin/Succeed/Fail?");return this._stack[this._numElements-1]},this.PeekPenultimate=()=>this._numElements>=2?this._stack[this._numElements-2]:null,this.Squash=()=>{if(this._numElements<2)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");const n=this._stack[this._numElements-2],r=this._stack[this._numElements-1];n.SquashFrom(r),this._numElements-=1},this.NoteErrorReported=()=>{for(const n of this._stack)n.reportedErrorInScope=!0};const e=200;for(let n=0;n<e;n++)this._stack[n]=new gf.StringParserElement;this._numElements=1}get currentElement(){return this._stack[this._numElements-1]}get lineIndex(){return this.currentElement.lineIndex}set lineIndex(e){this.currentElement.lineIndex=e}get characterIndex(){return this.currentElement.characterIndex}set characterIndex(e){this.currentElement.characterIndex=e}get characterInLineIndex(){return this.currentElement.characterInLineIndex}set characterInLineIndex(e){this.currentElement.characterInLineIndex=e}get customFlags(){return this.currentElement.customFlags}set customFlags(e){this.currentElement.customFlags=e}get errorReportedAlreadyInScope(){return this.currentElement.reportedErrorInScope}get stackHeight(){return this._numElements}}ml.StringParserState=pC;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StringParser=t.ParseSuccess=void 0;const e=zn,n=ml;t.ParseSuccess=Symbol("ParseSuccessStruct");class r{constructor(s){this.ParseRule=null,this.errorHandler=null,this.hadError=!1,this.BeginRule=()=>this.state.Push(),this.FailRule=l=>(this.state.Pop(l),null),this.CancelRule=l=>{this.state.Pop(l)},this.SucceedRule=(l,a=null)=>{const u=this.state.Peek(l),h=this.state.PeekPenultimate();this.RuleDidSucceed&&this.RuleDidSucceed(a,h,u),this.state.Squash();let S=a;return S===null&&(S=r.ParseSuccess),S},this.Expect=(l,a=null,u=null)=>{let h=this.ParseObject(l);if(h===null){a===null&&(a=l.name);let S;const d=this.LineRemainder();d===null||d.length===0?S="end of line":S=`'${d}'`,this.Error(`Expected ${a} but saw ${S}`),u!==null&&(h=u())}return h},this.Error=(l,a=!1)=>{this.ErrorOnLine(l,this.lineIndex+1,a)},this.ErrorWithParsedObject=(l,a,u=!1)=>{this.ErrorOnLine(l,a.debugMetadata?a.debugMetadata.startLineNumber:-1,u)},this.ErrorOnLine=(l,a,u)=>{if(!this.state.errorReportedAlreadyInScope){const h=u?"Warning":"Error";if(this.errorHandler)this.errorHandler(l,this.index,a-1,u);else throw new Error(`${h} on line ${a}: ${l}`);this.state.NoteErrorReported()}u||(this.hadError=!0)},this.Warning=l=>this.Error(l,!0),this.LineRemainder=()=>this.Peek(()=>this.ParseUntilCharactersFromString(`
\r`)),this.SetFlag=(l,a)=>{a?this.state.customFlags|=l:this.state.customFlags&=~l},this.GetFlag=l=>Boolean(this.state.customFlags&l),this.ParseObject=l=>{const a=this.BeginRule(),u=this.state.stackHeight,h=l();if(u!==this.state.stackHeight)throw new Error("Mismatched Begin/Fail/Succeed rules");return h===null?this.FailRule(a):(this.SucceedRule(a,h),h)},this.Parse=l=>{const a=this.BeginRule(),u=l();return u===null?(this.FailRule(a),null):(this.SucceedRule(a,u),u)},this.OneOf=l=>{for(const a of l){const u=this.ParseObject(a);if(u!==null)return u}return null},this.OneOrMore=l=>{const a=[];let u=null;do u=this.ParseObject(l),u!==null&&a.push(u);while(u!==null);return a.length>0?a:null},this.Optional=l=>()=>this.ParseObject(l)||r.ParseSuccess,this.Exclude=l=>()=>this.ParseObject(l)&&r.ParseSuccess,this.OptionalExclude=l=>()=>(this.ParseObject(l),r.ParseSuccess),this.String=l=>()=>this.ParseString(l),this.TryAddResultToList=(l,a,u=!0)=>{if(l!==r.ParseSuccess){if(u&&Array.isArray(l)){const h=l;if(h!==null){for(const S of h)a.push(S);return}}a.push(l)}},this.Interleave=(l,a,u=null,h=!0)=>{const S=this.BeginRule(),d=[],C=this.ParseObject(l);if(C===null)return this.FailRule(S);this.TryAddResultToList(C,d,h);let E=null,T=null;do{if(u!==null&&this.Peek(u)!==null||(E=this.ParseObject(a),E===null))break;if(this.TryAddResultToList(E,d,h),T=null,E!==null){if(T=this.ParseObject(l),T===null)break;this.TryAddResultToList(T,d,h)}}while((E!==null||T!==null)&&!(E===r.ParseSuccess&&T==r.ParseSuccess)&&this.remainingLength>0);return d.length===0?this.FailRule(S):this.SucceedRule(S,d)},this.ParseString=l=>{if(l.length>this.remainingLength)return null;const a=this.BeginRule();let u=this.index,h=this.characterInLineIndex,S=this.lineIndex,d=!0;for(let C=0;C<l.length;C+=1){const E=l[C];if(this._chars[u]!==E){d=!1;break}E===`
`&&(S++,h=-1),u++,h++}return this.index=u,this.characterInLineIndex=h,this.lineIndex=S,d?this.SucceedRule(a,l):this.FailRule(a)},this.ParseSingleCharacter=()=>{if(this.remainingLength>0){const l=this._chars[this.index];return l===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1,l}return"0"},this.ParseUntilCharactersFromString=(l,a=-1)=>this.ParseCharactersFromString(l,!1,a),this.ParseUntilCharactersFromCharSet=(l,a=-1)=>this.ParseCharactersFromCharSet(l,!1,a),this.ParseCharactersFromString=(l,a=-1,u=-1)=>{const h=new e.CharacterSet(l);return typeof a=="number"?this.ParseCharactersFromCharSet(h,!0,a):this.ParseCharactersFromCharSet(h,a,u)},this.ParseCharactersFromCharSet=(l,a=!0,u=-1)=>{u===-1&&(u=Number.MAX_SAFE_INTEGER);const h=this.index;let S=this.index,d=this.characterInLineIndex,C=this.lineIndex,E=0;for(;S<this._chars.length&&l.set.has(this._chars[S])===a&&E<u;)this._chars[S]===`
`&&(C+=1,d=-1),S+=1,d+=1,E+=1;return this.index=S,this.characterInLineIndex=d,this.lineIndex=C,this.index>h?this._chars.slice(h,this.index).join(""):null},this.Peek=l=>{const a=this.BeginRule(),u=l();return this.CancelRule(a),u},this.ParseInt=()=>{const l=this.index,a=this.characterInLineIndex,u=this.ParseString("-")!==null;this.ParseCharactersFromString(" 	");const h=this.ParseCharactersFromCharSet(r.numbersCharacterSet);if(h===null)return this.index=l,this.characterInLineIndex=a,null;let S;return Number.isNaN(Number(h))?(this.Error("Failed to read integer value: "+h+". Perhaps it's out of the range of acceptable numbers ink supports? ("+Number.MIN_SAFE_INTEGER+" to "+Number.MAX_SAFE_INTEGER+")"),null):(S=Number(h),u?-S:S)},this.ParseFloat=()=>{const l=this.index,a=this.characterInLineIndex,u=this.ParseInt();if(u!==null&&this.ParseString(".")!==null){const h=this.ParseCharactersFromCharSet(r.numbersCharacterSet);return Number(`${u}.${h}`)}return this.index=l,this.characterInLineIndex=a,null},this.ParseNewline=()=>{const l=this.BeginRule();return this.ParseString("\r"),this.ParseString(`
`)===null?this.FailRule(l):this.SucceedRule(l,`
`)};const o=this.PreProcessInputString(s);this.state=new n.StringParserState,s?this._chars=o.split(""):this._chars=[],this.inputString=o}get currentCharacter(){return this.index>=0&&this.remainingLength>0?this._chars[this.index]:"0"}PreProcessInputString(s){return s}get endOfInput(){return this.index>=this._chars.length}get remainingString(){return this._chars.slice(this.index,this.index+this.remainingLength).join("")}get remainingLength(){return this._chars.length-this.index}get lineIndex(){return this.state.lineIndex}set lineIndex(s){this.state.lineIndex=s}set characterInLineIndex(s){this.state.characterInLineIndex=s}get characterInLineIndex(){return this.state.characterInLineIndex}get index(){return this.state.characterIndex}set index(s){this.state.characterIndex=s}ParseUntil(s,o=null,l=null){const a=this.BeginRule(),u=new e.CharacterSet;o!==null&&(u.set=new Set([...u.set.values(),...o.set.values()])),l!==null&&(u.set=new Set([...u.set.values(),...l.set.values()]));let h="",S=null;do{const d=this.ParseUntilCharactersFromCharSet(u);if(d&&(h+=d),S=this.Peek(s),S!==null)break;{if(this.endOfInput)break;const C=this.currentCharacter;if(o!==null&&o.set.has(C)){h+=C,C===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1;continue}else break}}while(!0);return h.length>0?this.SucceedRule(a,String(h)):this.FailRule(a)}}t.StringParser=r,r.ParseSuccess=t.ParseSuccess,r.numbersCharacterSet=new e.CharacterSet("0123456789")})(Ph);Object.defineProperty(pl,"__esModule",{value:!0});pl.CommentEliminator=void 0;const ya=zn,mC=Ph;class gC extends mC.StringParser{constructor(){super(...arguments);this._commentOrNewlineStartCharacter=new ya.CharacterSet(`/\r
`),this._commentBlockEndCharacter=new ya.CharacterSet("*"),this._newlineCharacters=new ya.CharacterSet(`
\r`),this.Process=()=>{const e=this.Interleave(this.Optional(this.CommentsAndNewlines),this.Optional(this.MainInk));return e!==null?e.join(""):""},this.MainInk=()=>this.ParseUntil(this.CommentsAndNewlines,this._commentOrNewlineStartCharacter,null),this.CommentsAndNewlines=()=>{let e=this.Interleave(this.Optional(this.ParseNewline),this.Optional(this.ParseSingleComment));return e!==null?e.join(""):null},this.ParseSingleComment=()=>this.OneOf([this.EndOfLineComment,this.BlockComment]),this.EndOfLineComment=()=>this.ParseString("//")===null?null:(this.ParseUntilCharactersFromCharSet(this._newlineCharacters),""),this.BlockComment=()=>{if(this.ParseString("/*")===null)return null;const e=this.lineIndex,n=this.ParseUntil(this.String("*/"),this._commentBlockEndCharacter,null);return this.endOfInput||this.ParseString("*/"),n!=null?`
`.repeat(this.lineIndex-e):null}}PreProcessInputString(e){return e}}pl.CommentEliminator=gC;var Ur={};Object.defineProperty(Ur,"__esModule",{value:!0});Ur.Conditional=void 0;const vC=Se,vf=Ue,yC=ue;class CC extends yC.ParsedObject{constructor(e,n){super();this.initialCondition=e,this.branches=n,this._reJoinTarget=null,this.GenerateRuntimeObject=()=>{const r=new vC.Container;this.initialCondition&&r.AddContent(this.initialCondition.runtimeObject);for(const i of this.branches){const s=i.runtimeObject;r.AddContent(s)}return this.initialCondition!==null&&this.branches[0].ownExpression!==null&&!this.branches[this.branches.length-1].isElse&&r.AddContent(vf.ControlCommand.PopEvaluatedValue()),this._reJoinTarget=vf.ControlCommand.NoOp(),r.AddContent(this._reJoinTarget),r},this.initialCondition&&this.AddContent(this.initialCondition),this.branches!==null&&this.AddContent(this.branches)}get typeName(){return"Conditional"}ResolveReferences(e){const n=this._reJoinTarget.path;for(const r of this.branches){if(!r.returnDivert)throw new Error;r.returnDivert.targetPath=n}super.ResolveReferences(e)}}Ur.Conditional=CC;var vs={},Ht={};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.Text=void 0;const SC=ue,wC=fe;class _C extends SC.ParsedObject{constructor(e){super();this.text=e,this.GenerateRuntimeObject=()=>new wC.StringValue(this.text),this.toString=()=>this.text}get typeName(){return"Text"}}Ht.Text=_C;var Kt={},zr={};Object.defineProperty(zr,"__esModule",{value:!0});zr.ConstantDeclaration=void 0;const EC=ue,PC=qt;class OC extends EC.ParsedObject{constructor(e,n){super();this._expression=null,this.GenerateRuntimeObject=()=>null,this.constantIdentifier=e,n&&(this._expression=this.AddContent(n))}get constantName(){var e;return(e=this.constantIdentifier)===null||e===void 0?void 0:e.name}get expression(){if(!this._expression)throw new Error;return this._expression}get typeName(){return"CONST"}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.constantIdentifier,PC.SymbolType.Var)}}zr.ConstantDeclaration=OC;var Jn={},On={},mt={},qr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.FlowLevel=void 0,function(e){e[e.Story=0]="Story",e[e.Knot=1]="Knot",e[e.Stitch=2]="Stitch",e[e.WeavePoint=3]="WeavePoint"}(t.FlowLevel||(t.FlowLevel={}))})(qr);var Hr={};Object.defineProperty(Hr,"__esModule",{value:!0});Hr.Gather=void 0;const xC=Se,TC=ue,NC=qt;class bC extends TC.ParsedObject{constructor(e,n){super();this.indentationDepth=n,this.GenerateRuntimeObject=()=>{const r=new xC.Container;if(r.name=this.name,this.story.countAllVisits&&(r.visitsShouldBeCounted=!0),r.countingAtStartOnly=!0,this.content)for(const i of this.content)r.AddContent(i.runtimeObject);return r},this.toString=()=>{var r,i;return`- ${((r=this.identifier)===null||r===void 0?void 0:r.name)?"("+((i=this.identifier)===null||i===void 0?void 0:i.name)+")":"gather"}`},e&&(this.identifier=e)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get runtimeContainer(){return this.runtimeObject}get typeName(){return"Gather"}ResolveReferences(e){super.ResolveReferences(e),this.identifier&&(this.identifier.name||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,NC.SymbolType.SubFlowAndWeave)}}Hr.Gather=bC;var Jt={};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.Path=void 0;const Qs=K,yf=mt,lr=qr,IC=Kt;class kC{constructor(e,n){this._dotSeparatedComponents=null,this.toString=()=>this.components===null||this.components.length===0?this.baseTargetLevel===lr.FlowLevel.WeavePoint?"-> <next gather point>":"<invalid Path>":`-> ${this.dotSeparatedComponents}`,this.ResolveFromContext=r=>{if(this.components==null||this.components.length==0)return null;let i=this.ResolveBaseTarget(r);return i===null?null:this.components.length>1?this.ResolveTailComponents(i):i},this.ResolveBaseTarget=r=>{const i=this.firstComponent;let s=r;for(;s;){const o=s===r,l=this.GetChildFromContext(s,i,null,o);if(l)return l;s=s.parent}return null},this.ResolveTailComponents=r=>{let i=r;if(!this.components)return null;for(let s=1;s<this.components.length;++s){const o=this.components[s].name;let l,a=Qs.asOrNull(i,yf.FlowBase);if(a!==null?l=a.flowLevel+1:l=lr.FlowLevel.WeavePoint,i=this.GetChildFromContext(i,o,l),i===null)break}return i},this.GetChildFromContext=(r,i,s,o=!1)=>{const l=s===null,a=Qs.asOrNull(r,IC.Weave);if(i&&a!==null&&(l||s===lr.FlowLevel.WeavePoint))return a.WeavePointNamed(i);let u=Qs.asOrNull(r,yf.FlowBase);if(i&&u!==null){const h=o||u.flowLevel===lr.FlowLevel.Knot;return u.ContentWithNameAtLevel(i,s,h)}return null},Object.values(lr.FlowLevel).includes(e)?(this._baseTargetLevel=e,this.components=n||[]):Array.isArray(e)?(this._baseTargetLevel=null,this.components=e||[]):(this._baseTargetLevel=null,this.components=[e])}get baseTargetLevel(){return this.baseLevelIsAmbiguous?lr.FlowLevel.Story:this._baseTargetLevel}get baseLevelIsAmbiguous(){return!this._baseTargetLevel}get firstComponent(){return this.components==null||!this.components.length?null:this.components[0].name}get numberOfComponents(){return this.components?this.components.length:0}get dotSeparatedComponents(){return this._dotSeparatedComponents==null&&(this._dotSeparatedComponents=(this.components?this.components:[]).map(e=>e.name).filter(Qs.filterUndef).join(".")),this._dotSeparatedComponents}get typeName(){return"Path"}}Jt.Path=kC;var ys={};Object.defineProperty(ys,"__esModule",{value:!0});ys.ReturnType=void 0;const AC=ue,FC=Se,Ca=Ue,RC=zt;class LC extends AC.ParsedObject{constructor(e=null){super();this.returnedExpression=null,this.GenerateRuntimeObject=()=>{const n=new FC.Container;return this.returnedExpression?n.AddContent(this.returnedExpression.runtimeObject):(n.AddContent(Ca.ControlCommand.EvalStart()),n.AddContent(new RC.Void),n.AddContent(Ca.ControlCommand.EvalEnd())),n.AddContent(Ca.ControlCommand.PopFunction()),n},e&&(this.returnedExpression=this.AddContent(e))}get typeName(){return"ReturnType"}}ys.ReturnType=LC;var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.ClosestFlowBase=void 0;function DC(t){let e=t.parent;for(;e;){if(e.hasOwnProperty("iamFlowbase")&&e.iamFlowbase())return e;e=e.parent}return null}Qn.ClosestFlowBase=DC;var Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});Kr.Identifier=void 0;class Oh{constructor(e){this.debugMetadata=null,this.toString=()=>this.name||"undefined identifer",this.name=e}get typeName(){return"Identifier"}static Done(){return new Oh("DONE")}}Kr.Identifier=Oh;Object.defineProperty(mt,"__esModule",{value:!0});mt.FlowBase=void 0;const VC=qn,Sa=Jn,WC=On,Et=qr,jC=Hr,MC=ue,$C=Jt,BC=ys,GC=Se,UC=wt,zC=At,wa=qt,qC=Kt,HC=Qn,KC=Kr,Cf=K;class Ko extends MC.ParsedObject{constructor(e,n=null,r=null,i=!1,s=!1){super();this.isFunction=i,this._rootWeave=null,this._subFlowsByName=new Map,this._startingSubFlowDivert=null,this._startingSubFlowRuntime=null,this._firstChildFlow=null,this.variableDeclarations=new Map,this.identifier=null,this.args=null,this.iamFlowbase=()=>!0,this.SplitWeaveAndSubFlowContent=(o,l)=>{var a,u;const h=[],S=[];this._subFlowsByName=new Map;for(const C of o){const E=Cf.asOrNull(C,Ko);E?(this._firstChildFlow===null&&(this._firstChildFlow=E),S.push(C),((a=E.identifier)===null||a===void 0?void 0:a.name)&&this._subFlowsByName.set((u=E.identifier)===null||u===void 0?void 0:u.name,E)):h.push(C)}l&&h.push(new jC.Gather(null,1),new Sa.Divert(new $C.Path(KC.Identifier.Done())));const d=[];return h.length>0&&(this._rootWeave=new qC.Weave(h,0),d.push(this._rootWeave)),S.length>0&&d.push(...S),d},this.ResolveVariableWithName=(o,l)=>{var a;const u={},h=l===null?this:HC.ClosestFlowBase(l);if(h){if(h.args!==null){for(const S of h.args)if(((a=S.identifier)===null||a===void 0?void 0:a.name)===o)return u.found=!0,u.isArgument=!0,u.ownerFlow=h,u}if(h!==this.story&&h.variableDeclarations.has(o))return u.found=!0,u.ownerFlow=h,u.isTemporary=!0,u}return this.story.variableDeclarations.has(o)?(u.found=!0,u.ownerFlow=this.story,u.isGlobal=!0,u):(u.found=!1,u)},this.AddNewVariableDeclaration=o=>{const l=o.variableName;if(this.variableDeclarations.has(l)){const a=this.variableDeclarations.get(l);let u="";a.debugMetadata&&(u=` (${a.debugMetadata})`),this.Error(`found declaration variable '${l}' that was already declared${u}`,o,!1);return}this.variableDeclarations.set(o.variableName,o)},this.ResolveWeavePointNaming=()=>{this._rootWeave&&this._rootWeave.ResolveWeavePointNaming();for(const[,o]of this._subFlowsByName)o.hasOwnProperty("ResolveWeavePointNaming")&&o.ResolveWeavePointNaming()},this.GenerateRuntimeObject=()=>{var o;let l=null;this.isFunction?this.CheckForDisallowedFunctionFlowControl():(this.flowLevel===Et.FlowLevel.Knot||this.flowLevel===Et.FlowLevel.Stitch)&&(l=this.Find(BC.ReturnType)(),l!==null&&this.Error(`Return statements can only be used in knots that are declared as functions: == function ${this.identifier} ==`,l));const a=new GC.Container;a.name=(o=this.identifier)===null||o===void 0?void 0:o.name,this.story.countAllVisits&&(a.visitsShouldBeCounted=!0),this.GenerateArgumentVariableAssignments(a);let u=0;for(;this.content!==null&&u<this.content.length;){const h=this.content[u];if(h instanceof Ko){const S=h,d=S.runtimeObject;u===0&&!S.hasParameters&&this.flowLevel===Et.FlowLevel.Knot&&(this._startingSubFlowDivert=new UC.Divert,a.AddContent(this._startingSubFlowDivert),this._startingSubFlowRuntime=d);const C=d,E=a.namedContent.get(C.name)||null;if(E){const T=`${this.GetType()} already contains flow named '${C.name}' (at ${E.debugMetadata})`;this.Error(T,S)}a.AddToNamedContentOnly(C)}else h&&a.AddContent(h.runtimeObject);u+=1}return this.flowLevel!==Et.FlowLevel.Story&&!this.isFunction&&this._rootWeave!==null&&l===null&&this._rootWeave.ValidateTermination(this.WarningInTermination),a},this.GenerateArgumentVariableAssignments=o=>{var l;if(!(this.args===null||this.args.length===0))for(let a=this.args.length-1;a>=0;--a){const u=((l=this.args[a].identifier)===null||l===void 0?void 0:l.name)||null,h=new zC.VariableAssignment(u,!0);o.AddContent(h)}},this.ContentWithNameAtLevel=(o,l=null,a=!1)=>{var u;if((l===this.flowLevel||l===null)&&o===((u=this.identifier)===null||u===void 0?void 0:u.name))return this;if(l===Et.FlowLevel.WeavePoint||l===null){let S=null;if(this._rootWeave&&(S=this._rootWeave.WeavePointNamed(o),S))return S;if(l===Et.FlowLevel.WeavePoint)return a?this.DeepSearchForAnyLevelContent(o):null}if(l!==null&&l<this.flowLevel)return null;let h=this._subFlowsByName.get(o)||null;return h&&(l===null||l===h.flowLevel)?h:a?this.DeepSearchForAnyLevelContent(o):null},this.DeepSearchForAnyLevelContent=o=>{const l=this.ContentWithNameAtLevel(o,Et.FlowLevel.WeavePoint,!1);if(l)return l;for(const[,a]of this._subFlowsByName){const u=a.ContentWithNameAtLevel(o,null,!0);if(u)return u}return null},this.CheckForDisallowedFunctionFlowControl=()=>{this.flowLevel!==Et.FlowLevel.Knot&&this.Error("Functions cannot be stitches - i.e. they should be defined as '== function myFunc ==' rather than internal to another knot.");for(const[a,u]of this._subFlowsByName)this.Error(`Functions may not contain stitches, but saw '${a}' within the function '${this.identifier}'`,u);if(!this._rootWeave)throw new Error;const o=this._rootWeave.FindAll(Sa.Divert)();for(const a of o)!a.isFunctionCall&&!(a.parent instanceof WC.DivertTarget)&&this.Error(`Functions may not contain diverts, but saw '${a}'`,a);const l=this._rootWeave.FindAll(VC.Choice)();for(const a of l)this.Error(`Functions may not contain choices, but saw '${a}'`,a)},this.WarningInTermination=o=>{let l="Apparent loose end exists where the flow runs out. Do you need a '-> DONE' statement, choice or divert?";o.parent===this._rootWeave&&this._firstChildFlow&&(l=`${l} Note that if you intend to enter '${this._firstChildFlow.identifier}' next, you need to divert to it explicitly.`);const a=Cf.asOrNull(o,Sa.Divert);a&&a.isTunnel&&(l+=` When final tunnel to '${a.target} ->' returns it won't have anywhere to go.`),this.Warning(l,o)},this.toString=()=>`${this.typeName} '${this.identifier}'`,this.identifier=e,this.args=r,n===null&&(n=[]),this.PreProcessTopLevelObjects(n),n=this.SplitWeaveAndSubFlowContent(n,this.GetType()=="Story"&&!s),this.AddContent(n)}get hasParameters(){return this.args!==null&&this.args.length>0}get subFlowsByName(){return this._subFlowsByName}get typeName(){return this.isFunction?"Function":String(this.flowLevel)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}PreProcessTopLevelObjects(e){}ResolveReferences(e){var n,r;if(this._startingSubFlowDivert){if(!this._startingSubFlowRuntime)throw new Error;this._startingSubFlowDivert.targetPath=this._startingSubFlowRuntime.path}if(super.ResolveReferences(e),this.args!==null){for(const i of this.args)e.CheckForNamingCollisions(this,i.identifier,wa.SymbolType.Arg,"argument");for(let i=0;i<this.args.length;i+=1)for(let s=i+1;s<this.args.length;s+=1)((n=this.args[i].identifier)===null||n===void 0?void 0:n.name)==((r=this.args[s].identifier)===null||r===void 0?void 0:r.name)&&this.Error(`Multiple arguments with the same name: '${this.args[i].identifier}'`)}if(this.flowLevel!==Et.FlowLevel.Story){const i=this.flowLevel===Et.FlowLevel.Knot?wa.SymbolType.Knot:wa.SymbolType.SubFlowAndWeave;e.CheckForNamingCollisions(this,this.identifier,i)}}}mt.FlowBase=Ko;var Xn={},xn={},Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.ContentList=void 0;const JC=Se,QC=ue,XC=Ht,YC=K;class ZC extends QC.ParsedObject{constructor(e,...n){super();this.dontFlatten=!1,this.TrimTrailingWhitespace=()=>{for(let r=this.content.length-1;r>=0;--r){const i=YC.asOrNull(this.content[r],XC.Text);if(i===null)break;if(i.text=i.text.replace(new RegExp(/[ \t]/g),""),i.text.length===0)this.content.splice(r,1);else break}},this.GenerateRuntimeObject=()=>{const r=new JC.Container;if(this.content!==null)for(const i of this.content){const s=i.runtimeObject;s&&r.AddContent(s)}return this.dontFlatten&&this.story.DontFlattenContainer(r),r},this.toString=()=>`ContentList(${this.content.join(", ")})`,e&&this.AddContent(e),n&&this.AddContent(n)}get runtimeContainer(){return this.runtimeObject}get typeName(){return"ContentList"}}Jr.ContentList=ZC;var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0});Yn.VariableReference=void 0;const eS=Me,tS=Ze;class nS extends eS.InkObject{constructor(e=null){super();this.pathForCount=null,this.name=e}get containerForCount(){return this.pathForCount===null?null:this.ResolvePath(this.pathForCount).container}get pathStringForCount(){return this.pathForCount===null?null:this.CompactPathString(this.pathForCount)}set pathStringForCount(e){e===null?this.pathForCount=null:this.pathForCount=new tS.Path(e)}toString(){if(this.name!=null)return"var("+this.name+")";{let e=this.pathStringForCount;return"read_count("+e+")"}}}Yn.VariableReference=nS;Object.defineProperty(xn,"__esModule",{value:!0});xn.VariableReference=void 0;const rS=Jr,iS=Ye,Sf=mt,sS=Jt,oS=Yn,lS=Kt,aS=Kr,wf=K;class uS extends iS.Expression{constructor(e){super();this.pathIdentifiers=e,this._runtimeVarRef=null,this.isConstantReference=!1,this.isListItemReference=!1,this.GenerateIntoContainer=n=>{let r=this.story.constants.get(this.name);if(r){r.GenerateConstantIntoContainer(n),this.isConstantReference=!0;return}if(this._runtimeVarRef=new oS.VariableReference(this.name),this.path.length===1||this.path.length===2){let i="",s="";this.path.length===1?i=this.path[0]:(s=this.path[0],i=this.path[1]),this.story.ResolveListItem(s,i,this)&&(this.isListItemReference=!0)}n.AddContent(this._runtimeVarRef)},this.toString=()=>`{${this.path.join(".")}}`}get name(){return this.path.join(".")}get path(){return this.pathIdentifiers.map(e=>e.name).filter(wf.filterUndef)}get identifier(){if(!this.pathIdentifiers||this.pathIdentifiers.length==0)return null;const e=this.path.join(".");return new aS.Identifier(e)}get runtimeVarRef(){return this._runtimeVarRef}get typeName(){return"ref"}ResolveReferences(e){if(super.ResolveReferences(e),this.isConstantReference||this.isListItemReference)return;const n=new sS.Path(this.pathIdentifiers),r=n.ResolveFromContext(this);if(r){if(!r.containerForCounting)throw new Error;if(r.containerForCounting.visitsShouldBeCounted=!0,this._runtimeVarRef===null)return;this._runtimeVarRef.pathForCount=r.runtimePath,this._runtimeVarRef.name=null;let i=wf.asOrNull(r,Sf.FlowBase);i&&i.isFunction&&(parent instanceof lS.Weave||parent instanceof rS.ContentList||parent instanceof Sf.FlowBase)&&this.Warning(`'${i.identifier}' being used as read count rather than being called as function. Perhaps you intended to write ${i.identifier}()`);return}if(this.path.length>1){let i=`Could not find target for read count: ${n}`;this.path.length<=2&&(i+=`, or couldn't find list item with the name ${this.path.join(",")}`),this.Error(i);return}e.ResolveVariableWithName(this.name,this).found||this.Error(`Unresolved variable: ${this}`,this)}}xn.VariableReference=uS;Object.defineProperty(Xn,"__esModule",{value:!0});Xn.FunctionCall=void 0;const Pt=Ue,hS=Jn,cS=On,fS=Ye,dS=xe,pS=fe,Eo=pt,_f=Br,mS=Jt,gS=fe,vS=xn,Xs=K;class tm extends fS.Expression{constructor(e,n){super();this._divertTargetToCount=null,this._variableReferenceToCount=null,this.shouldPopReturnedValue=!1,this.GenerateIntoContainer=r=>{const i=this.story.ResolveList(this.name);let s=!1;if(this.isChoiceCount)this.args.length>0&&this.Error("The CHOICE_COUNT() function shouldn't take any arguments"),r.AddContent(Pt.ControlCommand.ChoiceCount());else if(this.isTurns)this.args.length>0&&this.Error("The TURNS() function shouldn't take any arguments"),r.AddContent(Pt.ControlCommand.Turns());else if(this.isTurnsSince||this.isReadCount){const o=Xs.asOrNull(this.args[0],cS.DivertTarget),l=Xs.asOrNull(this.args[0],vS.VariableReference);if(this.args.length!==1||o===null&&l===null){this.Error(`The ${this.name}() function should take one argument: a divert target to the target knot, stitch, gather or choice you want to check. e.g. TURNS_SINCE(-> myKnot)`);return}o?(this._divertTargetToCount=o,this.AddContent(this._divertTargetToCount),this._divertTargetToCount.GenerateIntoContainer(r)):l&&(this._variableReferenceToCount=l,this.AddContent(this._variableReferenceToCount),this._variableReferenceToCount.GenerateIntoContainer(r)),this.isTurnsSince?r.AddContent(Pt.ControlCommand.TurnsSince()):r.AddContent(Pt.ControlCommand.ReadCount())}else if(this.isRandom){this.args.length!==2&&this.Error("RANDOM should take 2 parameters: a minimum and a maximum integer");for(let o=0;o<this.args.length;o+=1){const l=Xs.asOrNull(this.args[o],_f.NumberExpression);if(l&&!l.isInt()){const a=o===0?"minimum":"maximum";this.Error(`RANDOM's ${a} parameter should be an integer`)}this.args[o].GenerateIntoContainer(r)}r.AddContent(Pt.ControlCommand.Random())}else if(this.isSeedRandom){this.args.length!==1&&this.Error("SEED_RANDOM should take 1 parameter - an integer seed");const o=Xs.asOrNull(this.args[0],_f.NumberExpression);o&&!o.isInt()&&this.Error("SEED_RANDOM's parameter should be an integer seed"),this.args[0].GenerateIntoContainer(r),r.AddContent(Pt.ControlCommand.SeedRandom())}else if(this.isListRange){this.args.length!==3&&this.Error("LIST_RANGE should take 3 parameters - a list, a min and a max");for(let o=0;o<this.args.length;o+=1)this.args[o].GenerateIntoContainer(r);r.AddContent(Pt.ControlCommand.ListRange())}else if(this.isListRandom)this.args.length!==1&&this.Error("LIST_RANDOM should take 1 parameter - a list"),this.args[0].GenerateIntoContainer(r),r.AddContent(Pt.ControlCommand.ListRandom());else if(Eo.NativeFunctionCall.CallExistsWithName(this.name)){const o=Eo.NativeFunctionCall.CallWithName(this.name);if(o.numberOfParameters!==this.args.length){let l=`${name} should take ${o.numberOfParameters} parameter`;o.numberOfParameters>1&&(l+="s"),this.Error(l)}for(let l=0;l<this.args.length;l+=1)this.args[l].GenerateIntoContainer(r);r.AddContent(Eo.NativeFunctionCall.CallWithName(this.name))}else if(i!==null)if(this.args.length>1&&this.Error("Can currently only construct a list from one integer (or an empty list from a given list definition)"),this.args.length===1)r.AddContent(new gS.StringValue(this.name)),this.args[0].GenerateIntoContainer(r),r.AddContent(Pt.ControlCommand.ListFromInt());else{const o=new dS.InkList;o.SetInitialOriginName(this.name),r.AddContent(new pS.ListValue(o))}else r.AddContent(this._proxyDivert.runtimeObject),s=!0;s||this.content.splice(this.content.indexOf(this._proxyDivert),1),this.shouldPopReturnedValue&&r.AddContent(Pt.ControlCommand.PopEvaluatedValue())},this.toString=()=>{const r=this.args.join(", ");return`${this.name}(${r})`},this._proxyDivert=new hS.Divert(new mS.Path(e),n),this._proxyDivert.isFunctionCall=!0,this.AddContent(this._proxyDivert)}get proxyDivert(){return this._proxyDivert}get name(){return this._proxyDivert.target.firstComponent||""}get args(){return this._proxyDivert.args}get runtimeDivert(){return this._proxyDivert.runtimeDivert}get isChoiceCount(){return this.name==="CHOICE_COUNT"}get isTurns(){return this.name==="TURNS"}get isTurnsSince(){return this.name==="TURNS_SINCE"}get isRandom(){return this.name==="RANDOM"}get isSeedRandom(){return this.name==="SEED_RANDOM"}get isListRange(){return this.name==="LIST_RANGE"}get isListRandom(){return this.name==="LIST_RANDOM"}get isReadCount(){return this.name==="READ_COUNT"}get typeName(){return"FunctionCall"}ResolveReferences(e){if(super.ResolveReferences(e),!this.content.includes(this._proxyDivert)&&this.args!==null)for(const n of this.args)n.ResolveReferences(e);if(this._divertTargetToCount){const n=this._divertTargetToCount.divert,r=n.runtimeDivert.variableDivertName!=null;if(r){this.Error(`When getting the TURNS_SINCE() of a variable target, remove the '->' - i.e. it should just be TURNS_SINCE(${n.runtimeDivert.variableDivertName})`);return}const i=n.targetContent;if(i===null)r||this.Error(`Failed to find target for TURNS_SINCE: '${n.target}'`);else{if(!i.containerForCounting)throw new Error;i.containerForCounting.turnIndexShouldBeCounted=!0}}else if(this._variableReferenceToCount){const n=this._variableReferenceToCount.runtimeVarRef;if(!n)throw new Error;n.pathForCount!==null&&this.Error(`Should be '${name}'(-> '${this._variableReferenceToCount.name}). Usage without the '->' only makes sense for variable targets.`)}}}Xn.FunctionCall=tm;tm.IsBuiltIn=t=>Eo.NativeFunctionCall.CallExistsWithName(t)?!0:t==="CHOICE_COUNT"||t==="TURNS_SINCE"||t==="TURNS"||t==="RANDOM"||t==="SEED_RANDOM"||t==="LIST_VALUE"||t==="LIST_RANDOM"||t==="READ_COUNT";var Cs={};Object.defineProperty(Cs,"__esModule",{value:!0});Cs.MultipleConditionExpression=void 0;const yS=Ye,CS=pt;class SS extends yS.Expression{constructor(e){super();this.GenerateIntoContainer=n=>{let r=!0;for(const i of this.subExpressions)i.GenerateIntoContainer(n),r||n.AddContent(CS.NativeFunctionCall.CallWithName("&&")),r=!1},this.AddContent(e)}get subExpressions(){return this.content}get typeName(){return"MultipleConditionExpression"}}Cs.MultipleConditionExpression=SS;Object.defineProperty(On,"__esModule",{value:!0});On.DivertTarget=void 0;const wS=ps,_S=qn,ES=Ur,PS=vs,OS=fe,_a=Ye,xS=mt,Ef=Xn,TS=Cs,Pf=xn,Ea=K;class Bi extends _a.Expression{constructor(e){super();this._runtimeDivert=null,this._runtimeDivertTargetValue=null,this.GenerateIntoContainer=n=>{this.divert.GenerateRuntimeObject(),this._runtimeDivert=this.divert.runtimeDivert,this._runtimeDivertTargetValue=new OS.DivertTargetValue,n.AddContent(this.runtimeDivertTargetValue)},this.Equals=n=>{const r=Ea.asOrNull(n,Bi);if(!r||!this.divert.target||!r.divert.target)return!1;const i=this.divert.target.dotSeparatedComponents,s=r.divert.target.dotSeparatedComponents;return i===s},this.divert=this.AddContent(e)}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}get runtimeDivertTargetValue(){if(!this._runtimeDivertTargetValue)throw new Error;return this._runtimeDivertTargetValue}get typeName(){return"DivertTarget"}ResolveReferences(e){if(super.ResolveReferences(e),this.divert.isDone||this.divert.isEnd){this.Error("Can't use -> DONE or -> END as variable divert targets",this);return}let n=this;for(;n&&n instanceof _a.Expression;){let i=!1,s=!1;const o=n.parent;if(o instanceof wS.BinaryExpression){const l=o;l.opName!=="=="&&l.opName!=="!="?i=!0:(l.leftExpression instanceof Bi||l.leftExpression instanceof Pf.VariableReference)&&(l.rightExpression instanceof Bi||l.rightExpression instanceof Pf.VariableReference)||(i=!0),s=!0}else if(o instanceof Ef.FunctionCall){const l=o;!l.isTurnsSince&&!l.isReadCount&&(i=!0),s=!0}else(o instanceof _a.Expression||o instanceof TS.MultipleConditionExpression||o instanceof _S.Choice&&o.condition===n||o instanceof ES.Conditional||o instanceof PS.ConditionalSingleBranch)&&(i=!0,s=!0);if(i&&this.Error(`Can't use a divert target like that. Did you intend to call '${this.divert.target}' as a function: likeThis(), or check the read count: likeThis, with no arrows?`,this),s)break;n=o}if(this.runtimeDivert.hasVariableTarget){if(!this.divert.target)throw new Error;this.Error(`Since '${this.divert.target.dotSeparatedComponents}' is a variable, it shouldn't be preceded by '->' here.`)}this.runtimeDivert.targetPath&&(this.runtimeDivertTargetValue.targetPath=this.runtimeDivert.targetPath);let r=this.divert.targetContent;if(r!==null){let i=r.containerForCounting;if(i!==null){const o=Ea.asOrNull(this.parent,Ef.FunctionCall);o&&o.isTurnsSince||(i.visitsShouldBeCounted=!0),i.turnIndexShouldBeCounted=!0}let s=Ea.asOrNull(r,xS.FlowBase);if(s!=null&&s.args!==null)for(const o of s.args)o.isByReference&&this.Error(`Can't store a divert target to a knot or function that has by-reference arguments ('${s.identifier}' has 'ref ${o.identifier}').`)}}}On.DivertTarget=Bi;Object.defineProperty(Jn,"__esModule",{value:!0});Jn.Divert=void 0;const NS=Se,mi=Ue,bS=wt,Pa=On,Oa=mt,IS=Xn,kS=ue,Of=Jt,AS=Ze,xf=Hn,FS=fe,Tf=xn,RS=Qn,gi=K;class LS extends kS.ParsedObject{constructor(e,n){super();this.args=[],this.target=null,this.targetContent=null,this._runtimeDivert=null,this.isFunctionCall=!1,this.isEmpty=!1,this.isTunnel=!1,this.isThread=!1,this.GenerateRuntimeObject=()=>{if(this.isEnd)return mi.ControlCommand.End();if(this.isDone)return mi.ControlCommand.Done();this.runtimeDivert=new bS.Divert,this.ResolveTargetContent(),this.CheckArgumentValidity();const r=this.args!==null&&this.args.length>0;if(r||this.isFunctionCall||this.isTunnel||this.isThread){const i=new NS.Container;if(r){this.isFunctionCall||i.AddContent(mi.ControlCommand.EvalStart());let s=null;this.targetContent&&(s=this.targetContent.args);for(let o=0;o<this.args.length;++o){const l=this.args[o];let a=null;if(s&&o<s.length&&(a=s[o]),a&&a.isByReference){const u=gi.asOrNull(l,Tf.VariableReference);if(!u){this.Error(`Expected variable name to pass by reference to 'ref ${a.identifier}' but saw ${l}`);break}const h=new Of.Path(u.pathIdentifiers);if(h.ResolveFromContext(this)){this.Error(`can't pass a read count by reference. '${h.dotSeparatedComponents}' is a knot/stitch/label, but '${this.target.dotSeparatedComponents}' requires the name of a VAR to be passed.`);break}const d=new FS.VariablePointerValue(u.name);i.AddContent(d)}else l.GenerateIntoContainer(i)}this.isFunctionCall||i.AddContent(mi.ControlCommand.EvalEnd())}return this.isThread?i.AddContent(mi.ControlCommand.StartThread()):(this.isFunctionCall||this.isTunnel)&&(this.runtimeDivert.pushesToStack=!0,this.runtimeDivert.stackPushType=this.isFunctionCall?xf.PushPopType.Function:xf.PushPopType.Tunnel),i.AddContent(this.runtimeDivert),i}return this.runtimeDivert},this.PathAsVariableName=()=>this.target?this.target.firstComponent:null,this.ResolveTargetContent=()=>{if(!(this.isEmpty||this.isEnd)&&this.targetContent===null){let r=this.PathAsVariableName();if(r!==null){const i=gi.asOrNull(RS.ClosestFlowBase(this),Oa.FlowBase);if(i){const s=i.ResolveVariableWithName(r,this);if(s.found){if(s.isArgument&&s.ownerFlow&&s.ownerFlow.args){let o=s.ownerFlow.args.find(l=>{var a;return((a=l.identifier)===null||a===void 0?void 0:a.name)==r});o&&!o.isDivertTarget&&this.Error(`Since '${o.identifier}' is used as a variable divert target (on ${this.debugMetadata}), it should be marked as: -> ${o.identifier}`,s.ownerFlow)}this.runtimeDivert.variableDivertName=r;return}}}if(!this.target)throw new Error;this.targetContent=this.target.ResolveFromContext(this)}},this.CheckArgumentValidity=()=>{if(this.isEmpty)return;let r=0;if(this.args!==null&&this.args.length>0&&(r=this.args.length),this.targetContent===null)return;const i=gi.asOrNull(this.targetContent,Oa.FlowBase);if(r===0&&(i===null||!i.hasParameters))return;if(i===null&&r>0){this.Error("target needs to be a knot or stitch in order to pass arguments");return}else if(i!==null&&(i.args===null||!i.args&&r>0)){this.Error(`target (${i.name}) doesn't take parameters`);return}else if(this.parent instanceof Pa.DivertTarget){r>0&&this.Error("can't store arguments in a divert target variable");return}const s=i.args.length;if(s!==r){let o;r===0?o="but there weren't any passed to it":r<s?o=`but only got ${r}`:o=`but got ${r}`,this.Error(`to '${i.identifier}' requires ${s} arguments, ${o}`);return}for(let o=0;o<s;++o){const l=i.args[o],a=this.args[o];if(l.isDivertTarget){let u=gi.asOrNull(a,Tf.VariableReference);if(!(a instanceof Pa.DivertTarget)&&u===null)this.Error(`Target '${i.identifier}' expects a divert target for the parameter named -> ${l.identifier} but saw ${a}`,a);else if(u){const h=new Of.Path(u.pathIdentifiers);h.ResolveFromContext(u)&&this.Error(`Passing read count of '${h.dotSeparatedComponents}' instead of a divert target. You probably meant '${h}'`)}}}if(i===null){this.Error("Can't call as a function or with arguments unless it's a knot or stitch");return}},this.CheckExternalArgumentValidity=r=>{const i=this.target?this.target.firstComponent:null,s=r.externals.get(i);if(!s)throw new Error("external not found");const o=s.argumentNames.length;let l=0;this.args&&(l=this.args.length),l!==o&&this.Error(`incorrect number of arguments sent to external function '${i}'. Expected ${o} but got ${l}`)},this.toString=()=>{let r="";if(this.target!==null)r+=this.target.toString();else return"-> <empty divert>";return this.isTunnel&&(r+=" ->"),this.isFunctionCall&&(r+=" ()"),r},e&&(this.target=e),n&&(this.args=n,this.AddContent(n))}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}set runtimeDivert(e){this._runtimeDivert=e}get isEnd(){return Boolean(this.target&&this.target.dotSeparatedComponents==="END")}get isDone(){return Boolean(this.target&&this.target.dotSeparatedComponents==="DONE")}get typeName(){return"Divert"}ResolveReferences(e){if(this.isEmpty||this.isEnd||this.isDone)return;if(!this.runtimeDivert)throw new Error;this.targetContent&&(this.runtimeDivert.targetPath=this.targetContent.runtimePath),super.ResolveReferences(e);let n=gi.asOrNull(this.targetContent,Oa.FlowBase);n&&(!n.isFunction&&this.isFunctionCall?super.Error(`${n.identifier} hasn't been marked as a function, but it's being called as one. Do you need to delcare the knot as '== function ${n.identifier} =='?`):n.isFunction&&!this.isFunctionCall&&!(this.parent instanceof Pa.DivertTarget)&&super.Error(n.identifier+" can't be diverted to. It can only be called as a function since it's been marked as such: '"+n.identifier+"(...)'"));const r=this.targetContent!==null;let i=!1,s=!1;if(this.target){if(this.target.numberOfComponents===1){if(!this.target.firstComponent)throw new Error;if(i=IS.FunctionCall.IsBuiltIn(this.target.firstComponent),s=e.IsExternal(this.target.firstComponent),i||s){this.isFunctionCall||super.Error(`${this.target.firstComponent} must be called as a function: ~ ${this.target.firstComponent}()`),s&&(this.runtimeDivert.isExternal=!0,this.args!==null&&(this.runtimeDivert.externalArgs=this.args.length),this.runtimeDivert.pushesToStack=!1,this.runtimeDivert.targetPath=new AS.Path(this.target.firstComponent),this.CheckExternalArgumentValidity(e));return}}}else throw new Error;this.runtimeDivert.variableDivertName==null&&!r&&!i&&!s&&this.Error(`target not found: '${this.target}'`)}Error(e,n=null,r=!1){if(n!==this&&n){super.Error(e,n);return}this.isFunctionCall?super.Error(`Function call ${e}`,n,r):super.Error(`Divert ${e}`,n,r)}}Jn.Divert=LS;var vl={};Object.defineProperty(vl,"__esModule",{value:!0});vl.GatherPointToResolve=void 0;class DS{constructor(e,n){this.divert=e,this.targetRuntimeObj=n}}vl.GatherPointToResolve=DS;var Ss={},yl={};Object.defineProperty(yl,"__esModule",{value:!0});yl.SequenceDivertToResolve=void 0;class VS{constructor(e,n){this.divert=e,this.targetContent=n}}yl.SequenceDivertToResolve=VS;var xh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SequenceType=void 0,function(e){e[e.Stopping=1]="Stopping",e[e.Cycle=2]="Cycle",e[e.Shuffle=4]="Shuffle",e[e.Once=8]="Once"}(t.SequenceType||(t.SequenceType={}))})(xh);Object.defineProperty(Ss,"__esModule",{value:!0});Ss.Sequence=void 0;const Nf=Se,vt=Ue,xa=wt,vi=fe,Ys=pt,WS=ue,jS=yl,Zs=xh,MS=Kt;class $S extends WS.ParsedObject{constructor(e,n){super();this.sequenceType=n,this._sequenceDivertsToResolve=[],this.GenerateRuntimeObject=()=>{const r=new Nf.Container;r.visitsShouldBeCounted=!0,r.countingAtStartOnly=!0,this._sequenceDivertsToResolve=[],r.AddContent(vt.ControlCommand.EvalStart()),r.AddContent(vt.ControlCommand.VisitIndex());const i=(this.sequenceType&Zs.SequenceType.Once)>0,s=(this.sequenceType&Zs.SequenceType.Cycle)>0,o=(this.sequenceType&Zs.SequenceType.Stopping)>0,l=(this.sequenceType&Zs.SequenceType.Shuffle)>0;let a=this.sequenceElements.length;if(i&&(a+=1),o||i?(r.AddContent(new vi.IntValue(a-1)),r.AddContent(Ys.NativeFunctionCall.CallWithName("MIN"))):s&&(r.AddContent(new vi.IntValue(this.sequenceElements.length)),r.AddContent(Ys.NativeFunctionCall.CallWithName("%"))),l){const h=vt.ControlCommand.NoOp();if(i||o){const d=o?this.sequenceElements.length-1:this.sequenceElements.length;r.AddContent(vt.ControlCommand.Duplicate()),r.AddContent(new vi.IntValue(d)),r.AddContent(Ys.NativeFunctionCall.CallWithName("=="));const C=new xa.Divert;C.isConditional=!0,r.AddContent(C),this.AddDivertToResolve(C,h)}let S=this.sequenceElements.length;o&&(S-=1),r.AddContent(new vi.IntValue(S)),r.AddContent(vt.ControlCommand.SequenceShuffleIndex()),(i||o)&&r.AddContent(h)}r.AddContent(vt.ControlCommand.EvalEnd());const u=vt.ControlCommand.NoOp();for(let h=0;h<a;h+=1){r.AddContent(vt.ControlCommand.EvalStart()),r.AddContent(vt.ControlCommand.Duplicate()),r.AddContent(new vi.IntValue(h)),r.AddContent(Ys.NativeFunctionCall.CallWithName("==")),r.AddContent(vt.ControlCommand.EvalEnd());const S=new xa.Divert;S.isConditional=!0,r.AddContent(S);let d;h<this.sequenceElements.length?d=this.sequenceElements[h].runtimeObject:d=new Nf.Container,d.name=`s${h}`,d.InsertContent(vt.ControlCommand.PopEvaluatedValue(),0);const C=new xa.Divert;d.AddContent(C),r.AddToNamedContentOnly(d),this.AddDivertToResolve(S,d),this.AddDivertToResolve(C,u)}return r.AddContent(u),r},this.AddDivertToResolve=(r,i)=>{this._sequenceDivertsToResolve.push(new jS.SequenceDivertToResolve(r,i))},this.sequenceType=n,this.sequenceElements=[];for(const r of e){const i=r.content;let s=null;i===null||i.length===0?s=r:s=new MS.Weave(i),this.sequenceElements.push(s),this.AddContent(s)}}get typeName(){return"Sequence"}ResolveReferences(e){super.ResolveReferences(e);for(const n of this._sequenceDivertsToResolve)n.divert.targetPath=n.targetContent.path}}Ss.Sequence=$S;var ws={};Object.defineProperty(ws,"__esModule",{value:!0});ws.TunnelOnwards=void 0;const BS=Se,yi=Ue,GS=fe,US=ue,zS=zt;class qS extends US.ParsedObject{constructor(){super(...arguments);this._overrideDivertTarget=null,this._divertAfter=null,this.GenerateRuntimeObject=()=>{const e=new BS.Container;if(e.AddContent(yi.ControlCommand.EvalStart()),this.divertAfter){const r=this.divertAfter.GenerateRuntimeObject();if(r){const i=this.divertAfter.args;if(i!==null&&i.length>0){let s=-1,o=-1;for(let l=0;l<r.content.length;l+=1){const a=r.content[l];a&&(s==-1&&a.commandType===yi.ControlCommand.CommandType.EvalStart?s=l:a.commandType===yi.ControlCommand.CommandType.EvalEnd&&(o=l))}for(let l=s+1;l<o;l+=1){const a=r.content[l];a.parent=null,e.AddContent(r.content[l])}}}this._overrideDivertTarget=new GS.DivertTargetValue,e.AddContent(this._overrideDivertTarget)}else e.AddContent(new zS.Void);return e.AddContent(yi.ControlCommand.EvalEnd()),e.AddContent(yi.ControlCommand.PopTunnel()),e},this.toString=()=>` -> ${this._divertAfter}`}get divertAfter(){return this._divertAfter}set divertAfter(e){this._divertAfter=e,this._divertAfter&&this.AddContent(this._divertAfter)}get typeName(){return"TunnelOnwards"}ResolveReferences(e){super.ResolveReferences(e),this.divertAfter&&this.divertAfter.targetContent&&(this._overrideDivertTarget.targetPath=this.divertAfter.targetContent.runtimePath)}}ws.TunnelOnwards=qS;var _s={},Qr={},Es={};Object.defineProperty(Es,"__esModule",{value:!0});Es.ListDefinition=void 0;const Ta=xe;class HS{constructor(e,n){this._name=e||"",this._items=null,this._itemNameToValues=n||new Map}get name(){return this._name}get items(){if(this._items==null){this._items=new Map;for(let[e,n]of this._itemNameToValues){let r=new Ta.InkListItem(this.name,e);this._items.set(r.serialized(),n)}}return this._items}ValueForItem(e){if(!e.itemName)return 0;let n=this._itemNameToValues.get(e.itemName);return typeof n!="undefined"?n:0}ContainsItem(e){return!e.itemName||e.originName!=this.name?!1:this._itemNameToValues.has(e.itemName)}ContainsItemWithName(e){return this._itemNameToValues.has(e)}TryGetItemWithValue(e,n){for(let[r,i]of this._itemNameToValues)if(i==e)return n=new Ta.InkListItem(this.name,r),{result:n,exists:!0};return n=Ta.InkListItem.Null,{result:n,exists:!1}}TryGetValueForItem(e,n){if(!e.itemName)return{result:0,exists:!1};let r=this._itemNameToValues.get(e.itemName);return r?{result:r,exists:!0}:{result:0,exists:!1}}}Es.ListDefinition=HS;Object.defineProperty(Qr,"__esModule",{value:!0});Qr.ListDefinition=void 0;const KS=xe,JS=xe,QS=Es,XS=fe,YS=ue,ZS=qt;class ew extends YS.ParsedObject{constructor(e){super();this.itemDefinitions=e,this.identifier=null,this.variableAssignment=null,this._elementsByName=null,this.ItemNamed=r=>{if(this._elementsByName===null){this._elementsByName=new Map;for(const s of this.itemDefinitions)this._elementsByName.set(s.name,s)}return this._elementsByName.get(r)||null},this.GenerateRuntimeObject=()=>{var r,i;const s=new KS.InkList;for(const o of this.itemDefinitions)if(o.inInitialList){const l=new JS.InkListItem(((r=this.identifier)===null||r===void 0?void 0:r.name)||null,o.name||null);s.Add(l,o.seriesValue)}return s.SetInitialOriginName(((i=this.identifier)===null||i===void 0?void 0:i.name)||""),new XS.ListValue(s)};let n=1;for(const r of this.itemDefinitions)r.explicitValue!==null&&(n=r.explicitValue),r.seriesValue=n,n+=1;this.AddContent(e)}get typeName(){return"ListDefinition"}get runtimeListDefinition(){var e;const n=new Map;for(const r of this.itemDefinitions)n.has(r.name)?this.Error(`List '${this.identifier}' contains duplicate items called '${r.name}'`):n.set(r.name,r.seriesValue);return new QS.ListDefinition(((e=this.identifier)===null||e===void 0?void 0:e.name)||"",n)}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.identifier,ZS.SymbolType.List)}}Qr.ListDefinition=ew;Object.defineProperty(_s,"__esModule",{value:!0});_s.VariableAssignment=void 0;const tw=Se,nw=Qn,rw=Qr,iw=ue,bf=qt,sw=At,ow=xn,lw=K;class aw extends iw.ParsedObject{constructor({assignedExpression:e,isGlobalDeclaration:n,isTemporaryNewDeclaration:r,listDef:i,variableIdentifier:s}){super();this._runtimeAssignment=null,this.expression=null,this.listDefinition=null,this.GenerateRuntimeObject=()=>{let o=null;if(this.isGlobalDeclaration?o=this.story:this.isNewTemporaryDeclaration&&(o=nw.ClosestFlowBase(this)),o&&o.AddNewVariableDeclaration(this),this.isGlobalDeclaration)return null;const l=new tw.Container;return this.expression?l.AddContent(this.expression.runtimeObject):this.listDefinition&&l.AddContent(this.listDefinition.runtimeObject),this._runtimeAssignment=new sw.VariableAssignment(this.variableName,this.isNewTemporaryDeclaration),l.AddContent(this._runtimeAssignment),l},this.toString=()=>`${this.isGlobalDeclaration?"VAR":this.isNewTemporaryDeclaration?"~ temp":""} ${this.variableName}`,this.variableIdentifier=s,this.isGlobalDeclaration=Boolean(n),this.isNewTemporaryDeclaration=Boolean(r),i instanceof rw.ListDefinition?(this.listDefinition=this.AddContent(i),this.listDefinition.variableAssignment=this,this.isGlobalDeclaration=!0):e&&(this.expression=this.AddContent(e))}get variableName(){return this.variableIdentifier.name}get typeName(){return this.isNewTemporaryDeclaration?"temp":this.isGlobalDeclaration?"VAR":"variable assignment"}get isDeclaration(){return this.isGlobalDeclaration||this.isNewTemporaryDeclaration}ResolveReferences(e){if(super.ResolveReferences(e),this.isDeclaration&&this.listDefinition===null&&e.CheckForNamingCollisions(this,this.variableIdentifier,this.isGlobalDeclaration?bf.SymbolType.Var:bf.SymbolType.Temp),this.isGlobalDeclaration){const n=lw.asOrNull(this.expression,ow.VariableReference);n&&!n.isConstantReference&&!n.isListItemReference&&this.Error("global variable assignments cannot refer to other variables, only literal values, constants and list items")}if(!this.isNewTemporaryDeclaration){const n=e.ResolveVariableWithName(this.variableName,this);n.found||(this.variableName in this.story.constants?this.Error(`Can't re-assign to a constant (do you need to use VAR when declaring '${this.variableName}'?)`,this):this.Error(`Variable could not be found to assign to: '${this.variableName}'`,this)),this._runtimeAssignment&&(this._runtimeAssignment.isGlobal=n.isGlobal)}}}_s.VariableAssignment=aw;Object.defineProperty(Kt,"__esModule",{value:!0});Kt.Weave=void 0;const If=$r,st=qn,eo=Ur,uw=zr,hw=Se,to=Jn,cw=wt,fw=On,dw=mt,Ot=Hr,pw=vl,mw=ue,Na=Ss,gw=Ht,vw=ws,yw=_s,ot=K;class rn extends mw.ParsedObject{constructor(e,n=-1){super();this.previousWeavePoint=null,this.addContentToPreviousWeavePoint=!1,this.hasSeenChoiceInSection=!1,this.currentContainer=null,this._unnamedGatherCount=0,this._choiceCount=0,this._rootContainer=null,this._namedWeavePoints=new Map,this.looseEnds=[],this.gatherPointsToResolve=[],this.ResolveWeavePointNaming=()=>{var r,i,s;const o=[...this.FindAll(Ot.Gather)(l=>!(l.name===null||l.name===void 0)),...this.FindAll(st.Choice)(l=>!(l.name===null||l.name===void 0))];this._namedWeavePoints=new Map;for(const l of o){const a=this.namedWeavePoints.get(((r=l.identifier)===null||r===void 0?void 0:r.name)||"");if(a){const u=a instanceof Ot.Gather?"gather":"choice",h=a;this.Error(`A ${u} with the same label name '${l.name}' already exists in this context on line ${h.debugMetadata?h.debugMetadata.startLineNumber:"NO DEBUG METADATA AVAILABLE"}`,l)}((i=l.identifier)===null||i===void 0?void 0:i.name)&&this.namedWeavePoints.set((s=l.identifier)===null||s===void 0?void 0:s.name,l)}},this.ConstructWeaveHierarchyFromIndentation=()=>{let r=0;for(;r<this.content.length;){const i=this.content[r];if(i instanceof st.Choice||i instanceof Ot.Gather){const o=i.indentationDepth-1;if(o>this.baseIndentIndex){let l=r;for(;r<this.content.length;){const S=ot.asOrNull(this.content[r],st.Choice)||ot.asOrNull(this.content[r],Ot.Gather);if(S!==null&&S.indentationDepth-1<=this.baseIndentIndex)break;r+=1}const a=r-l,u=this.content.slice(l,l+a);this.content.splice(l,a);const h=new rn(u,o);this.InsertContent(l,h),r=l}}r+=1}},this.DetermineBaseIndentationFromContent=r=>{for(const i of r)if(i instanceof st.Choice||i instanceof Ot.Gather)return i.indentationDepth-1;return 0},this.GenerateRuntimeObject=()=>{this._rootContainer=new hw.Container,this.currentContainer=this._rootContainer,this.looseEnds=[],this.gatherPointsToResolve=[];for(const r of this.content)if(r instanceof st.Choice||r instanceof Ot.Gather)this.AddRuntimeForWeavePoint(r);else if(r instanceof rn){const i=r;this.AddRuntimeForNestedWeave(i),this.gatherPointsToResolve.splice(0,0,...i.gatherPointsToResolve)}else this.AddGeneralRuntimeContent(r.runtimeObject);return this.PassLooseEndsToAncestors(),this._rootContainer},this.AddRuntimeForGather=r=>{const i=!this.hasSeenChoiceInSection;this.hasSeenChoiceInSection=!1;const s=r.runtimeContainer;if(r.name||(s.name=`g-${this._unnamedGatherCount}`,this._unnamedGatherCount+=1),i){if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(s)}else this.rootContainer.AddToNamedContentOnly(s);for(const o of this.looseEnds){const l=o;if(l instanceof Ot.Gather&&l.indentationDepth==r.indentationDepth)continue;let a=null;if(l instanceof to.Divert)a=l.runtimeObject;else{a=new cw.Divert;const u=l;if(!u.runtimeContainer)throw new Error;u.runtimeContainer.AddContent(a)}this.gatherPointsToResolve.push(new pw.GatherPointToResolve(a,s))}this.looseEnds=[],this.currentContainer=s},this.AddRuntimeForWeavePoint=r=>{if(r instanceof Ot.Gather)this.AddRuntimeForGather(r);else if(r instanceof st.Choice){if(!this.currentContainer)throw new Error;this.previousWeavePoint instanceof Ot.Gather&&this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1);const i=r;if(this.currentContainer.AddContent(i.runtimeObject),!i.innerContentContainer)throw new Error;i.innerContentContainer.name=`c-${this._choiceCount}`,this.currentContainer.AddToNamedContentOnly(i.innerContentContainer),this._choiceCount+=1,this.hasSeenChoiceInSection=!0}this.addContentToPreviousWeavePoint=!1,this.WeavePointHasLooseEnd(r)&&(this.looseEnds.push(r),ot.asOrNull(r,st.Choice)&&(this.addContentToPreviousWeavePoint=!0)),this.previousWeavePoint=r},this.AddRuntimeForNestedWeave=r=>{this.AddGeneralRuntimeContent(r.rootContainer),this.previousWeavePoint!==null&&(this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1),this.addContentToPreviousWeavePoint=!1)},this.AddGeneralRuntimeContent=r=>{if(r!==null)if(this.addContentToPreviousWeavePoint){if(!this.previousWeavePoint||!this.previousWeavePoint.runtimeContainer)throw new Error;this.previousWeavePoint.runtimeContainer.AddContent(r)}else{if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(r)}},this.PassLooseEndsToAncestors=()=>{if(this.looseEnds.length===0)return;let r=null,i=null,s=!1;for(let o=this.parent;o!==null;o=o.parent){const l=ot.asOrNull(o,rn);l&&(!s&&r===null&&(r=l),s&&i===null&&(i=l)),(o instanceof Na.Sequence||o instanceof eo.Conditional)&&(s=!0)}if(!(r===null&&i===null))for(let o=this.looseEnds.length-1;o>=0;o-=1){const l=this.looseEnds[o];let a=!1;if(s){if(l instanceof st.Choice&&r!==null)r.ReceiveLooseEnd(l),a=!0;else if(!(l instanceof st.Choice)){const u=r||i;u!==null&&(u.ReceiveLooseEnd(l),a=!0)}}else(r==null?void 0:r.hasOwnProperty("ReceiveLooseEnd"))&&r.ReceiveLooseEnd(l),a=!0;a&&this.looseEnds.splice(o,1)}},this.ReceiveLooseEnd=r=>{this.looseEnds.push(r)},this.WeavePointNamed=r=>{if(!this.namedWeavePoints)return null;let i=this.namedWeavePoints.get(r);return i||null},this.IsGlobalDeclaration=r=>{const i=ot.asOrNull(r,yw.VariableAssignment);return!!(i&&i.isGlobalDeclaration&&i.isDeclaration||ot.asOrNull(r,uw.ConstantDeclaration))},this.ContentThatFollowsWeavePoint=r=>{const i=[],s=r;if(s.content!==null)for(const a of s.content)this.IsGlobalDeclaration(a)||i.push(a);const o=ot.asOrNull(s.parent,rn);if(o===null)throw new Error("Expected weave point parent to be weave?");const l=o.content.indexOf(s);for(let a=l+1;a<o.content.length;a+=1){const u=o.content[a];if(!this.IsGlobalDeclaration(u)){if(u instanceof st.Choice||u instanceof Ot.Gather||u instanceof rn)break;i.push(u)}}return i},this.ValidateTermination=r=>{if(this.lastParsedSignificantObject instanceof If.AuthorWarning)return;if(this.looseEnds!==null&&this.looseEnds.length>0)for(const s of this.looseEnds){const o=this.ContentThatFollowsWeavePoint(s);this.ValidateFlowOfObjectsTerminates(o,s,r)}else{for(const s of this.content)if(s instanceof st.Choice||s instanceof to.Divert)return;this.ValidateFlowOfObjectsTerminates(this.content,this,r)}},this.BadNestedTerminationHandler=r=>{let i=null;for(let o=r.parent;o!==null;o=o.parent)if(o instanceof Na.Sequence||o instanceof eo.Conditional){i=ot.asOrNull(o,eo.Conditional);break}let s="Choices nested in conditionals or sequences need to explicitly divert afterwards.";i!==null&&i.FindAll(st.Choice)().length===1&&(s=`Choices with conditions should be written: '* {condition} choice'. Otherwise, ${s.toLowerCase()}`),this.Error(s,r)},this.ValidateFlowOfObjectsTerminates=(r,i,s)=>{let o=!1,l=i;for(const a of r){if(a.Find(to.Divert)(h=>!h.isThread&&!h.isTunnel&&!h.isFunctionCall&&!(h.parent instanceof fw.DivertTarget))!==null&&(o=!0),a.Find(vw.TunnelOnwards)()!=null){o=!0;break}l=a}if(!o){if(l instanceof If.AuthorWarning)return;s(l)}},this.WeavePointHasLooseEnd=r=>{if(r.content===null)return!0;for(let i=r.content.length-1;i>=0;--i){let s=ot.asOrNull(r.content[i],to.Divert);if(s&&!(s.isThread||s.isTunnel||s.isFunctionCall))return!1}return!0},this.CheckForWeavePointNamingCollisions=()=>{if(!this.namedWeavePoints)return;const r=[];for(const i of this.ancestry){const s=ot.asOrNull(i,dw.FlowBase);if(s)r.push(s);else break}for(const[i,s]of this.namedWeavePoints)for(const o of r){const l=o.ContentWithNameAtLevel(i);if(l&&l!==s){const a=`${s.GetType()} '${i}' has the same label name as a ${l.GetType()} (on ${l.debugMetadata})`;this.Error(a,s)}}},n==-1?this.baseIndentIndex=this.DetermineBaseIndentationFromContent(e):this.baseIndentIndex=n,this.AddContent(e),this.ConstructWeaveHierarchyFromIndentation()}get rootContainer(){return this._rootContainer||(this._rootContainer=this.GenerateRuntimeObject()),this._rootContainer}get namedWeavePoints(){return this._namedWeavePoints}get lastParsedSignificantObject(){if(this.content.length===0)return null;let e=null;for(let r=this.content.length-1;r>=0;--r){e=this.content[r];let i=ot.asOrNull(e,gw.Text);if(!(i&&i.text===`
`)&&!this.IsGlobalDeclaration(e))break}const n=ot.asOrNull(e,rn);return n&&(e=n.lastParsedSignificantObject),e}get typeName(){return"Weave"}ResolveReferences(e){if(super.ResolveReferences(e),this.looseEnds!==null&&this.looseEnds.length>0){let n=!1;for(let r=this.parent;r!==null;r=r.parent)if(r instanceof Na.Sequence||r instanceof eo.Conditional){n=!0;break}n&&this.ValidateTermination(this.BadNestedTerminationHandler)}for(const n of this.gatherPointsToResolve)n.divert.targetPath=n.targetRuntimeObj.path;this.CheckForWeavePointNamingCollisions()}}Kt.Weave=rn;Object.defineProperty(vs,"__esModule",{value:!0});vs.ConditionalSingleBranch=void 0;const kf=Se,no=Ue,Af=wt,Cw=ue,Sw=pt,ww=fe,_w=Ht,Ew=Kt,Pw=K;class Ow extends Cw.ParsedObject{constructor(e){super();this._contentContainer=null,this._conditionalDivert=null,this._ownExpression=null,this._innerWeave=null,this.isTrueBranch=!1,this.matchingEquality=!1,this.isElse=!1,this.isInline=!1,this.returnDivert=null,this.GenerateRuntimeObject=()=>{if(this._innerWeave)for(const i of this._innerWeave.content){const s=Pw.asOrNull(i,_w.Text);s&&s.text.startsWith("else:")&&this.Warning("Saw the text 'else:' which is being treated as content. Did you mean '- else:'?",s)}const n=new kf.Container,r=this.matchingEquality&&!this.isElse;if(r&&n.AddContent(no.ControlCommand.Duplicate()),this._conditionalDivert=new Af.Divert,this._conditionalDivert.isConditional=!this.isElse,!this.isTrueBranch&&!this.isElse){const i=this.ownExpression!==null;i&&n.AddContent(no.ControlCommand.EvalStart()),this.ownExpression&&this.ownExpression.GenerateIntoContainer(n),this.matchingEquality&&n.AddContent(Sw.NativeFunctionCall.CallWithName("==")),i&&n.AddContent(no.ControlCommand.EvalEnd())}return n.AddContent(this._conditionalDivert),this._contentContainer=this.GenerateRuntimeForContent(),this._contentContainer.name="b",this.isInline||this._contentContainer.InsertContent(new ww.StringValue(`
`),0),(r||this.isElse&&this.matchingEquality)&&this._contentContainer.InsertContent(no.ControlCommand.PopEvaluatedValue(),0),n.AddToNamedContentOnly(this._contentContainer),this.returnDivert=new Af.Divert,this._contentContainer.AddContent(this.returnDivert),n},this.GenerateRuntimeForContent=()=>this._innerWeave===null?new kf.Container:this._innerWeave.rootContainer,e&&(this._innerWeave=new Ew.Weave(e),this.AddContent(this._innerWeave))}get ownExpression(){return this._ownExpression}set ownExpression(e){this._ownExpression=e,this._ownExpression&&this.AddContent(this._ownExpression)}get typeName(){return"ConditionalSingleBranch"}ResolveReferences(e){if(!this._conditionalDivert||!this._contentContainer)throw new Error;this._conditionalDivert.targetPath=this._contentContainer.path,super.ResolveReferences(e)}}vs.ConditionalSingleBranch=Ow;var nm={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFlags=void 0,function(e){e[e.ParsingString=1]="ParsingString"}(t.CustomFlags||(t.CustomFlags={}))})(nm);var Cl={};Object.defineProperty(Cl,"__esModule",{value:!0});Cl.DebugMetadata=void 0;class Th{constructor(){this.startLineNumber=0,this.endLineNumber=0,this.startCharacterNumber=0,this.endCharacterNumber=0,this.fileName=null,this.sourceName=null}Merge(e){let n=new Th;return n.fileName=this.fileName,n.sourceName=this.sourceName,this.startLineNumber<e.startLineNumber?(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=this.startCharacterNumber):this.startLineNumber>e.startLineNumber?(n.startLineNumber=e.startLineNumber,n.startCharacterNumber=e.startCharacterNumber):(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=Math.min(this.startCharacterNumber,e.startCharacterNumber)),this.endLineNumber>e.endLineNumber?(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=this.endCharacterNumber):this.endLineNumber<e.endLineNumber?(n.endLineNumber=e.endLineNumber,n.endCharacterNumber=e.endCharacterNumber):(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=Math.max(this.endCharacterNumber,e.endCharacterNumber)),n}toString(){return this.fileName!==null?`line ${this.startLineNumber} of ${this.fileName}"`:"line "+this.startLineNumber}}Cl.DebugMetadata=Th;var Sl={};Object.defineProperty(Sl,"__esModule",{value:!0});Sl.ExternalDeclaration=void 0;const xw=ue;class Tw extends xw.ParsedObject{constructor(e,n){super();this.identifier=e,this.argumentNames=n,this.GenerateRuntimeObject=()=>(this.story.AddExternal(this),null)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get typeName(){return"EXTERNAL"}toString(){var e;return`EXTERNAL ${(e=this.identifier)===null||e===void 0?void 0:e.name}`}}Sl.ExternalDeclaration=Tw;var wl={};Object.defineProperty(wl,"__esModule",{value:!0});wl.FlowDecl=void 0;class Nw{constructor(e,n,r){this.name=e,this.args=n,this.isFunction=r}}wl.FlowDecl=Nw;var _l={},Ps={};Object.defineProperty(Ps,"__esModule",{value:!0});Ps.Wrap=void 0;const bw=ue;class Iw extends bw.ParsedObject{constructor(e){super();this._objToWrap=e,this.GenerateRuntimeObject=()=>this._objToWrap}}Ps.Wrap=Iw;Object.defineProperty(_l,"__esModule",{value:!0});_l.Glue=void 0;const kw=Ps;class Aw extends kw.Wrap{constructor(e){super(e)}get typeName(){return"Glue"}}_l.Glue=Aw;var Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.Glue=void 0;const Fw=Me;class Rw extends Fw.InkObject{toString(){return"Glue"}}Xr.Glue=Rw;var El={};Object.defineProperty(El,"__esModule",{value:!0});El.IncDecExpression=void 0;const Lw=Jr,Ff=Ye,Dw=mt,Vw=pt,Ww=fe,jw=At,Mw=Yn,$w=Kt;class Bw extends Ff.Expression{constructor(e,n,r){super();this.varIdentifier=e,this._runtimeAssignment=null,this.expression=null,this.GenerateIntoContainer=i=>{var s,o;i.AddContent(new Mw.VariableReference(((s=this.varIdentifier)===null||s===void 0?void 0:s.name)||null)),this.expression?this.expression.GenerateIntoContainer(i):i.AddContent(new Ww.IntValue(1)),i.AddContent(Vw.NativeFunctionCall.CallWithName(this.isInc?"+":"-")),this._runtimeAssignment=new jw.VariableAssignment(((o=this.varIdentifier)===null||o===void 0?void 0:o.name)||null,!1),i.AddContent(this._runtimeAssignment)},this.toString=()=>{var i,s;return this.expression?`${(i=this.varIdentifier)===null||i===void 0?void 0:i.name}${this.isInc?" += ":" -= "}${this.expression}`:`${(s=this.varIdentifier)===null||s===void 0?void 0:s.name}`+(this.isInc?"++":"--")},n instanceof Ff.Expression?(this.expression=n,this.AddContent(this.expression),this.isInc=Boolean(r)):this.isInc=n}get typeName(){return"IncDecExpression"}ResolveReferences(e){var n;super.ResolveReferences(e);const r=e.ResolveVariableWithName(((n=this.varIdentifier)===null||n===void 0?void 0:n.name)||"",this);if(r.found||this.Error(`variable for ${this.incrementDecrementWord} could not be found: '${this.varIdentifier}' after searching: {this.descriptionOfScope}`),!this._runtimeAssignment)throw new Error;this._runtimeAssignment.isGlobal=r.isGlobal,!(this.parent instanceof $w.Weave)&&!(this.parent instanceof Dw.FlowBase)&&!(this.parent instanceof Lw.ContentList)&&this.Error(`Can't use ${this.incrementDecrementWord} as sub-expression`)}get incrementDecrementWord(){return this.isInc?"increment":"decrement"}}El.IncDecExpression=Bw;var Os={};Object.defineProperty(Os,"__esModule",{value:!0});Os.IncludedFile=void 0;const Gw=ue;class Uw extends Gw.ParsedObject{constructor(e){super();this.includedStory=e,this.GenerateRuntimeObject=()=>null}}Os.IncludedFile=Uw;var Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});Pl.InfixOperator=void 0;class zw{constructor(e,n,r){this.type=e,this.precedence=n,this.requireWhitespace=r,this.toString=()=>this.type}}Pl.InfixOperator=zw;var Ol={};Object.defineProperty(Ol,"__esModule",{value:!0});Ol.Knot=void 0;const qw=mt,Rf=qr;class Hw extends qw.FlowBase{get flowLevel(){return Rf.FlowLevel.Knot}constructor(e,n,r,i){super(e,n,r,i)}get typeName(){return"Knot"}ResolveReferences(e){super.ResolveReferences(e);let n=this.story;for(const r in this.subFlowsByName){const i=n.ContentWithNameAtLevel(r,Rf.FlowLevel.Knot,!1);if(i){const s=this.subFlowsByName.get(r),o=`Stitch '${s?s.name:"NO STITCH FOUND"}' has the same name as a knot (on ${i.debugMetadata})`;this.Error(o,s)}}}}Ol.Knot=Hw;var xl={};Object.defineProperty(xl,"__esModule",{value:!0});xl.List=void 0;const Kw=Ye,Jw=xe,Qw=xe,Xw=fe;class Yw extends Kw.Expression{constructor(e){super();this.itemIdentifierList=e,this.GenerateIntoContainer=n=>{var r,i;const s=new Jw.InkList;if(this.itemIdentifierList!=null)for(const o of this.itemIdentifierList){const l=((r=o==null?void 0:o.name)===null||r===void 0?void 0:r.split("."))||[];let a=null,u="";l.length>1?(a=l[0],u=l[1]):u=l[0];const h=this.story.ResolveListItem(a,u,this);if(h===null)a===null?this.Error(`Could not find list definition that contains item '${o}'`):this.Error(`Could not find list item ${o}`);else{if(h.parent==null){this.Error(`Could not find list definition for item ${o}`);return}a||(a=((i=h.parent.identifier)===null||i===void 0?void 0:i.name)||null);const S=new Qw.InkListItem(a,h.name||null);s.has(S.serialized())?this.Warning(`Duplicate of item '${o}' in list.`):s.Add(S,h.seriesValue)}}n.AddContent(new Xw.ListValue(s))}}get typeName(){return"List"}}xl.List=Yw;var xs={};Object.defineProperty(xs,"__esModule",{value:!0});xs.ListElementDefinition=void 0;const Zw=ue,e_=qt;class t_ extends Zw.ParsedObject{constructor(e,n,r=null){super();this.indentifier=e,this.inInitialList=n,this.explicitValue=r,this.seriesValue=0,this.parent=null,this.GenerateRuntimeObject=()=>{throw new Error("Not implemented.")},this.toString=()=>this.fullName,this.parent=super.parent}get fullName(){var e;const n=this.parent;if(n===null)throw new Error("Can't get full name without a parent list.");return`${(e=n.identifier)===null||e===void 0?void 0:e.name}.${this.name}`}get typeName(){return"ListElement"}get name(){var e;return((e=this.indentifier)===null||e===void 0?void 0:e.name)||null}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.indentifier,e_.SymbolType.ListItem)}}xs.ListElementDefinition=t_;var rm={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StatementLevel=void 0,function(e){e[e.InnerBlock=0]="InnerBlock",e[e.Stitch=1]="Stitch",e[e.Knot=2]="Knot",e[e.Top=3]="Top"}(t.StatementLevel||(t.StatementLevel={}))})(rm);var Tl={};Object.defineProperty(Tl,"__esModule",{value:!0});Tl.Stitch=void 0;const n_=mt,r_=qr;class i_ extends n_.FlowBase{constructor(e,n,r,i){super(e,n,r,i);this.toString=()=>`${this.parent!==null?this.parent+" > ":""}${super.toString()}`}get flowLevel(){return r_.FlowLevel.Stitch}get typeName(){return"Stitch"}}Tl.Stitch=i_;var Nl={},Ts={},Tn={},Zn={};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.Tag=void 0;const s_=Me;class o_ extends s_.InkObject{constructor(e){super();this.text=e.toString()||""}toString(){return"# "+this.text}}Zn.Tag=o_;var Ns={};Object.defineProperty(Ns,"__esModule",{value:!0});Ns.Choice=void 0;const l_=Ze,a_=Ce,u_=Me;class h_ extends u_.InkObject{constructor(){super(...arguments);this.text="",this.index=0,this.threadAtGeneration=null,this.sourcePath="",this.targetPath=null,this.isInvisibleDefault=!1,this.originalThreadIndex=0}get pathStringOnChoice(){return this.targetPath===null?a_.throwNullException("Choice.targetPath"):this.targetPath.toString()}set pathStringOnChoice(e){this.targetPath=new l_.Path(e)}}Ns.Choice=h_;var bs={};Object.defineProperty(bs,"__esModule",{value:!0});bs.ListDefinitionsOrigin=void 0;const c_=xe,f_=fe,d_=Ce;class p_{constructor(e){this._lists=new Map,this._allUnambiguousListValueCache=new Map;for(let n of e){this._lists.set(n.name,n);for(let[r,i]of n.items){let s=c_.InkListItem.fromSerializedKey(r),o=new f_.ListValue(s,i);if(!s.itemName)throw new Error("item.itemName is null or undefined.");this._allUnambiguousListValueCache.set(s.itemName,o),this._allUnambiguousListValueCache.set(s.fullName,o)}}}get lists(){let e=[];for(let[,n]of this._lists)e.push(n);return e}TryListGetDefinition(e,n){if(e===null)return{result:n,exists:!1};let r=this._lists.get(e);return r?{result:r,exists:!0}:{result:n,exists:!1}}FindSingleItemListWithName(e){if(e===null)return d_.throwNullException("name");let n=this._allUnambiguousListValueCache.get(e);return typeof n!="undefined"?n:null}}bs.ListDefinitionsOrigin=p_;Object.defineProperty(Tn,"__esModule",{value:!0});Tn.JsonSerialisation=void 0;const ro=Se,tt=fe,Lf=Xr,te=Ue,ar=Hn,Df=wt,Vf=Gr,ba=Yn,Wf=At,Ia=pt,jf=zt,Mf=Zn,m_=Ze,$f=Ns,g_=Es,v_=bs,io=xe,ye=K,bn=Ce;class br{static JArrayToRuntimeObjList(e,n=!1){let r=e.length;n&&r--;let i=[];for(let s=0;s<r;s++){let o=e[s],l=this.JTokenToRuntimeObject(o);if(l===null)return bn.throwNullException("runtimeObj");i.push(l)}return i}static WriteDictionaryRuntimeObjs(e,n){e.WriteObjectStart();for(let[r,i]of n)e.WritePropertyStart(r),this.WriteRuntimeObject(e,i),e.WritePropertyEnd();e.WriteObjectEnd()}static WriteListRuntimeObjs(e,n){e.WriteArrayStart();for(let r of n)this.WriteRuntimeObject(e,r);e.WriteArrayEnd()}static WriteIntDictionary(e,n){e.WriteObjectStart();for(let[r,i]of n)e.WriteIntProperty(r,i);e.WriteObjectEnd()}static WriteRuntimeObject(e,n){let r=ye.asOrNull(n,ro.Container);if(r){this.WriteRuntimeContainer(e,r);return}let i=ye.asOrNull(n,Df.Divert);if(i){let F="->";i.isExternal?F="x()":i.pushesToStack&&(i.stackPushType==ar.PushPopType.Function?F="f()":i.stackPushType==ar.PushPopType.Tunnel&&(F="->t->"));let A;i.hasVariableTarget?A=i.variableDivertName:A=i.targetPathString,e.WriteObjectStart(),e.WriteProperty(F,A),i.hasVariableTarget&&e.WriteProperty("var",!0),i.isConditional&&e.WriteProperty("c",!0),i.externalArgs>0&&e.WriteIntProperty("exArgs",i.externalArgs),e.WriteObjectEnd();return}let s=ye.asOrNull(n,Vf.ChoicePoint);if(s){e.WriteObjectStart(),e.WriteProperty("*",s.pathStringOnChoice),e.WriteIntProperty("flg",s.flags),e.WriteObjectEnd();return}let o=ye.asOrNull(n,tt.BoolValue);if(o){e.WriteBool(o.value);return}let l=ye.asOrNull(n,tt.IntValue);if(l){e.WriteInt(l.value);return}let a=ye.asOrNull(n,tt.FloatValue);if(a){e.WriteFloat(a.value);return}let u=ye.asOrNull(n,tt.StringValue);if(u){u.isNewline?e.Write(`
`,!1):(e.WriteStringStart(),e.WriteStringInner("^"),e.WriteStringInner(u.value),e.WriteStringEnd());return}let h=ye.asOrNull(n,tt.ListValue);if(h){this.WriteInkList(e,h);return}let S=ye.asOrNull(n,tt.DivertTargetValue);if(S){if(e.WriteObjectStart(),S.value===null)return bn.throwNullException("divTargetVal.value");e.WriteProperty("^->",S.value.componentsString),e.WriteObjectEnd();return}let d=ye.asOrNull(n,tt.VariablePointerValue);if(d){e.WriteObjectStart(),e.WriteProperty("^var",d.value),e.WriteIntProperty("ci",d.contextIndex),e.WriteObjectEnd();return}if(ye.asOrNull(n,Lf.Glue)){e.Write("<>");return}let E=ye.asOrNull(n,te.ControlCommand);if(E){e.Write(br._controlCommandNames[E.commandType]);return}let T=ye.asOrNull(n,Ia.NativeFunctionCall);if(T){let F=T.name;F=="^"&&(F="L^"),e.Write(F);return}let p=ye.asOrNull(n,ba.VariableReference);if(p){e.WriteObjectStart();let F=p.pathStringForCount;F!=null?e.WriteProperty("CNT?",F):e.WriteProperty("VAR?",p.name),e.WriteObjectEnd();return}let f=ye.asOrNull(n,Wf.VariableAssignment);if(f){e.WriteObjectStart();let F=f.isGlobal?"VAR=":"temp=";e.WriteProperty(F,f.variableName),f.isNewDeclaration||e.WriteProperty("re",!0),e.WriteObjectEnd();return}if(ye.asOrNull(n,jf.Void)){e.Write("void");return}let y=ye.asOrNull(n,Mf.Tag);if(y){e.WriteObjectStart(),e.WriteProperty("#",y.text),e.WriteObjectEnd();return}let P=ye.asOrNull(n,$f.Choice);if(P){this.WriteChoice(e,P);return}throw new Error("Failed to convert runtime object to Json token: "+n)}static JObjectToDictionaryRuntimeObjs(e){let n=new Map;for(let r in e)if(e.hasOwnProperty(r)){let i=this.JTokenToRuntimeObject(e[r]);if(i===null)return bn.throwNullException("inkObject");n.set(r,i)}return n}static JObjectToIntDictionary(e){let n=new Map;for(let r in e)e.hasOwnProperty(r)&&n.set(r,parseInt(e[r]));return n}static JTokenToRuntimeObject(e){if(typeof e=="number"&&!isNaN(e)||typeof e=="boolean")return tt.Value.Create(e);if(typeof e=="string"){let n=e.toString(),r=n[0];if(r=="^")return new tt.StringValue(n.substring(1));if(r==`
`&&n.length==1)return new tt.StringValue(`
`);if(n=="<>")return new Lf.Glue;for(let i=0;i<br._controlCommandNames.length;++i){let s=br._controlCommandNames[i];if(n==s)return new te.ControlCommand(i)}if(n=="L^"&&(n="^"),Ia.NativeFunctionCall.CallExistsWithName(n))return Ia.NativeFunctionCall.CallWithName(n);if(n=="->->")return te.ControlCommand.PopTunnel();if(n=="~ret")return te.ControlCommand.PopFunction();if(n=="void")return new jf.Void}if(typeof e=="object"&&!Array.isArray(e)){let n=e,r;if(n["^->"])return r=n["^->"],new tt.DivertTargetValue(new m_.Path(r.toString()));if(n["^var"]){r=n["^var"];let h=new tt.VariablePointerValue(r.toString());return"ci"in n&&(r=n.ci,h.contextIndex=parseInt(r)),h}let i=!1,s=!1,o=ar.PushPopType.Function,l=!1;if((r=n["->"])?i=!0:(r=n["f()"])?(i=!0,s=!0,o=ar.PushPopType.Function):(r=n["->t->"])?(i=!0,s=!0,o=ar.PushPopType.Tunnel):(r=n["x()"])&&(i=!0,l=!0,s=!1,o=ar.PushPopType.Function),i){let h=new Df.Divert;h.pushesToStack=s,h.stackPushType=o,h.isExternal=l;let S=r.toString();return(r=n.var)?h.variableDivertName=S:h.targetPathString=S,h.isConditional=!!n.c,l&&(r=n.exArgs)&&(h.externalArgs=parseInt(r)),h}if(r=n["*"]){let h=new Vf.ChoicePoint;return h.pathStringOnChoice=r.toString(),(r=n.flg)&&(h.flags=parseInt(r)),h}if(r=n["VAR?"])return new ba.VariableReference(r.toString());if(r=n["CNT?"]){let h=new ba.VariableReference;return h.pathStringForCount=r.toString(),h}let a=!1,u=!1;if((r=n["VAR="])?(a=!0,u=!0):(r=n["temp="])&&(a=!0,u=!1),a){let h=r.toString(),S=!n.re,d=new Wf.VariableAssignment(h,S);return d.isGlobal=u,d}if(n["#"]!==void 0)return r=n["#"],new Mf.Tag(r.toString());if(r=n.list){let h=r,S=new io.InkList;if(r=n.origins){let d=r;S.SetInitialOriginNames(d)}for(let d in h)if(h.hasOwnProperty(d)){let C=h[d],E=new io.InkListItem(d),T=parseInt(C);S.Add(E,T)}return new tt.ListValue(S)}if(n.originalChoicePath!=null)return this.JObjectToChoice(n)}if(Array.isArray(e))return this.JArrayToContainer(e);if(e==null)return null;throw new Error("Failed to convert token to runtime object: "+this.toJson(e,["parent"]))}static toJson(e,n,r){return JSON.stringify(e,(i,s)=>(n==null?void 0:n.some(o=>o===i))?void 0:s,r)}static WriteRuntimeContainer(e,n,r=!1){if(e.WriteArrayStart(),n===null)return bn.throwNullException("container");for(let a of n.content)this.WriteRuntimeObject(e,a);let i=n.namedOnlyContent,s=n.countFlags,o=n.name!=null&&!r,l=i!=null||s>0||o;if(l&&e.WriteObjectStart(),i!=null)for(let[a,u]of i){let h=a,S=ye.asOrNull(u,ro.Container);e.WritePropertyStart(h),this.WriteRuntimeContainer(e,S,!0),e.WritePropertyEnd()}s>0&&e.WriteIntProperty("#f",s),o&&e.WriteProperty("#n",n.name),l?e.WriteObjectEnd():e.WriteNull(),e.WriteArrayEnd()}static JArrayToContainer(e){let n=new ro.Container;n.content=this.JArrayToRuntimeObjList(e,!0);let r=e[e.length-1];if(r!=null){let i=new Map;for(let s in r)if(s=="#f")n.countFlags=parseInt(r[s]);else if(s=="#n")n.name=r[s].toString();else{let o=this.JTokenToRuntimeObject(r[s]),l=ye.asOrNull(o,ro.Container);l&&(l.name=s),i.set(s,o)}n.namedOnlyContent=i}return n}static JObjectToChoice(e){let n=new $f.Choice;return n.text=e.text.toString(),n.index=parseInt(e.index),n.sourcePath=e.originalChoicePath.toString(),n.originalThreadIndex=parseInt(e.originalThreadIndex),n.pathStringOnChoice=e.targetPath.toString(),n}static WriteChoice(e,n){e.WriteObjectStart(),e.WriteProperty("text",n.text),e.WriteIntProperty("index",n.index),e.WriteProperty("originalChoicePath",n.sourcePath),e.WriteIntProperty("originalThreadIndex",n.originalThreadIndex),e.WriteProperty("targetPath",n.pathStringOnChoice),e.WriteObjectEnd()}static WriteInkList(e,n){let r=n.value;if(r===null)return bn.throwNullException("rawList");e.WriteObjectStart(),e.WritePropertyStart("list"),e.WriteObjectStart();for(let[i,s]of r){let o=io.InkListItem.fromSerializedKey(i),l=s;if(o.itemName===null)return bn.throwNullException("item.itemName");e.WritePropertyNameStart(),e.WritePropertyNameInner(o.originName?o.originName:"?"),e.WritePropertyNameInner("."),e.WritePropertyNameInner(o.itemName),e.WritePropertyNameEnd(),e.Write(l),e.WritePropertyEnd()}if(e.WriteObjectEnd(),e.WritePropertyEnd(),r.Count==0&&r.originNames!=null&&r.originNames.length>0){e.WritePropertyStart("origins"),e.WriteArrayStart();for(let i of r.originNames)e.Write(i);e.WriteArrayEnd(),e.WritePropertyEnd()}e.WriteObjectEnd()}static ListDefinitionsToJToken(e){let n={};for(let r of e.lists){let i={};for(let[s,o]of r.items){let l=io.InkListItem.fromSerializedKey(s);if(l.itemName===null)return bn.throwNullException("item.itemName");i[l.itemName]=o}n[r.name]=i}return n}static JTokenToListDefinitions(e){let n=e,r=[];for(let i in n)if(n.hasOwnProperty(i)){let s=i.toString(),o=n[i],l=new Map;for(let u in o)if(n.hasOwnProperty(i)){let h=o[u];l.set(u,parseInt(h))}let a=new g_.ListDefinition(s,l);r.push(a)}return new v_.ListDefinitionsOrigin(r)}}Tn.JsonSerialisation=br;br._controlCommandNames=(()=>{let t=[];t[te.ControlCommand.CommandType.EvalStart]="ev",t[te.ControlCommand.CommandType.EvalOutput]="out",t[te.ControlCommand.CommandType.EvalEnd]="/ev",t[te.ControlCommand.CommandType.Duplicate]="du",t[te.ControlCommand.CommandType.PopEvaluatedValue]="pop",t[te.ControlCommand.CommandType.PopFunction]="~ret",t[te.ControlCommand.CommandType.PopTunnel]="->->",t[te.ControlCommand.CommandType.BeginString]="str",t[te.ControlCommand.CommandType.EndString]="/str",t[te.ControlCommand.CommandType.NoOp]="nop",t[te.ControlCommand.CommandType.ChoiceCount]="choiceCnt",t[te.ControlCommand.CommandType.Turns]="turn",t[te.ControlCommand.CommandType.TurnsSince]="turns",t[te.ControlCommand.CommandType.ReadCount]="readc",t[te.ControlCommand.CommandType.Random]="rnd",t[te.ControlCommand.CommandType.SeedRandom]="srnd",t[te.ControlCommand.CommandType.VisitIndex]="visit",t[te.ControlCommand.CommandType.SequenceShuffleIndex]="seq",t[te.ControlCommand.CommandType.StartThread]="thread",t[te.ControlCommand.CommandType.Done]="done",t[te.ControlCommand.CommandType.End]="end",t[te.ControlCommand.CommandType.ListFromInt]="listInt",t[te.ControlCommand.CommandType.ListRange]="range",t[te.ControlCommand.CommandType.ListRandom]="lrnd";for(let e=0;e<te.ControlCommand.CommandType.TOTAL_VALUES;++e)if(t[e]==null)throw new Error("Control command not accounted for in serialisation");return t})();var bl={},Nh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CallStack=void 0;const e=Hn,n=Ze,r=Ts,i=Tn,s=fe,o=Ut,l=Kn,a=ms,u=ht,h=Ce;class S{constructor(){if(this._threadCounter=0,this._startOfRoot=l.Pointer.Null,arguments[0]instanceof r.Story){let C=arguments[0];this._startOfRoot=l.Pointer.StartOf(C.rootContentContainer),this.Reset()}else{let C=arguments[0];this._threads=[];for(let E of C._threads)this._threads.push(E.Copy());this._threadCounter=C._threadCounter,this._startOfRoot=C._startOfRoot.copy()}}get elements(){return this.callStack}get depth(){return this.elements.length}get currentElement(){let E=this._threads[this._threads.length-1].callstack;return E[E.length-1]}get currentElementIndex(){return this.callStack.length-1}get currentThread(){return this._threads[this._threads.length-1]}set currentThread(C){a.Debug.Assert(this._threads.length==1,"Shouldn't be directly setting the current thread when we have a stack of them"),this._threads.length=0,this._threads.push(C)}get canPop(){return this.callStack.length>1}Reset(){this._threads=[],this._threads.push(new S.Thread),this._threads[0].callstack.push(new S.Element(e.PushPopType.Tunnel,this._startOfRoot))}SetJsonToken(C,E){this._threads.length=0;let T=C.threads;for(let p of T){let f=p,g=new S.Thread(f,E);this._threads.push(g)}this._threadCounter=parseInt(C.threadCounter),this._startOfRoot=l.Pointer.StartOf(E.rootContentContainer)}WriteJson(C){C.WriteObject(E=>{E.WritePropertyStart("threads"),E.WriteArrayStart();for(let T of this._threads)T.WriteJson(E);E.WriteArrayEnd(),E.WritePropertyEnd(),E.WritePropertyStart("threadCounter"),E.WriteInt(this._threadCounter),E.WritePropertyEnd()})}PushThread(){let C=this.currentThread.Copy();this._threadCounter++,C.threadIndex=this._threadCounter,this._threads.push(C)}ForkThread(){let C=this.currentThread.Copy();return this._threadCounter++,C.threadIndex=this._threadCounter,C}PopThread(){if(this.canPopThread)this._threads.splice(this._threads.indexOf(this.currentThread),1);else throw new Error("Can't pop thread")}get canPopThread(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}get elementIsEvaluateFromGame(){return this.currentElement.type==e.PushPopType.FunctionEvaluationFromGame}Push(C,E=0,T=0){let p=new S.Element(C,this.currentElement.currentPointer,!1);p.evaluationStackHeightWhenPushed=E,p.functionStartInOutputStream=T,this.callStack.push(p)}CanPop(C=null){return this.canPop?C==null?!0:this.currentElement.type==C:!1}Pop(C=null){if(this.CanPop(C)){this.callStack.pop();return}else throw new Error("Mismatched push/pop in Callstack")}GetTemporaryVariableWithName(C,E=-1){E==-1&&(E=this.currentElementIndex+1);let T=this.callStack[E-1],p=u.tryGetValueFromMap(T.temporaryVariables,C,null);return p.exists?p.result:null}SetTemporaryVariable(C,E,T,p=-1){p==-1&&(p=this.currentElementIndex+1);let f=this.callStack[p-1];if(!T&&!f.temporaryVariables.get(C))throw new Error("Could not find temporary variable to set: "+C);let g=u.tryGetValueFromMap(f.temporaryVariables,C,null);g.exists&&s.ListValue.RetainListOriginsForAssignment(g.result,E),f.temporaryVariables.set(C,E)}ContextForVariableNamed(C){return this.currentElement.temporaryVariables.get(C)?this.currentElementIndex+1:0}ThreadWithIndex(C){let E=this._threads.filter(T=>{if(T.threadIndex==C)return T});return E.length>0?E[0]:null}get callStack(){return this.currentThread.callstack}get callStackTrace(){let C=new o.StringBuilder;for(let E=0;E<this._threads.length;E++){let T=this._threads[E],p=E==this._threads.length-1;C.AppendFormat(`=== THREAD {0}/{1} {2}===
`,E+1,this._threads.length,p?"(current) ":"");for(let f=0;f<T.callstack.length;f++){T.callstack[f].type==e.PushPopType.Function?C.Append("  [FUNCTION] "):C.Append("  [TUNNEL] ");let g=T.callstack[f].currentPointer;if(!g.isNull){if(C.Append("<SOMEWHERE IN "),g.container===null)return h.throwNullException("pointer.container");C.Append(g.container.path.toString()),C.AppendLine(">")}}}return C.toString()}}t.CallStack=S,function(d){class C{constructor(p,f,g=!1){this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=f.copy(),this.inExpressionEvaluation=g,this.temporaryVariables=new Map,this.type=p}Copy(){let p=new C(this.type,this.currentPointer,this.inExpressionEvaluation);return p.temporaryVariables=new Map(this.temporaryVariables),p.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,p.functionStartInOutputStream=this.functionStartInOutputStream,p}}d.Element=C;class E{constructor(){if(this.threadIndex=0,this.previousPointer=l.Pointer.Null,this.callstack=[],arguments[0]&&arguments[1]){let p=arguments[0],f=arguments[1];this.threadIndex=parseInt(p.threadIndex);let g=p.callstack;for(let P of g){let F=P,A=parseInt(F.type),W=l.Pointer.Null,R,k=F.cPath;if(typeof k!="undefined"){R=k.toString();let Q=f.ContentAtPath(new n.Path(R));if(W.container=Q.container,W.index=parseInt(F.idx),Q.obj==null)throw new Error("When loading state, internal story location couldn't be found: "+R+". Has the story changed since this save data was created?");if(Q.approximate){if(W.container===null)return h.throwNullException("pointer.container");f.Warning("When loading state, exact internal story location couldn't be found: '"+R+"', so it was approximated to '"+W.container.path.toString()+"' to recover. Has the story changed since this save data was created?")}}let z=!!F.exp,Fe=new C(A,W,z),me=F.temp;typeof me!="undefined"?Fe.temporaryVariables=i.JsonSerialisation.JObjectToDictionaryRuntimeObjs(me):Fe.temporaryVariables.clear(),this.callstack.push(Fe)}let y=p.previousContentObject;if(typeof y!="undefined"){let P=new n.Path(y.toString());this.previousPointer=f.PointerAtPath(P)}}}Copy(){let p=new E;p.threadIndex=this.threadIndex;for(let f of this.callstack)p.callstack.push(f.Copy());return p.previousPointer=this.previousPointer.copy(),p}WriteJson(p){p.WriteObjectStart(),p.WritePropertyStart("callstack"),p.WriteArrayStart();for(let f of this.callstack){if(p.WriteObjectStart(),!f.currentPointer.isNull){if(f.currentPointer.container===null)return h.throwNullException("el.currentPointer.container");p.WriteProperty("cPath",f.currentPointer.container.path.componentsString),p.WriteIntProperty("idx",f.currentPointer.index)}p.WriteProperty("exp",f.inExpressionEvaluation),p.WriteIntProperty("type",f.type),f.temporaryVariables.size>0&&(p.WritePropertyStart("temp"),i.JsonSerialisation.WriteDictionaryRuntimeObjs(p,f.temporaryVariables),p.WritePropertyEnd()),p.WriteObjectEnd()}if(p.WriteArrayEnd(),p.WritePropertyEnd(),p.WriteIntProperty("threadIndex",this.threadIndex),!this.previousPointer.isNull){let f=this.previousPointer.Resolve();if(f===null)return h.throwNullException("this.previousPointer.Resolve()");p.WriteProperty("previousContentObject",f.path.toString())}p.WriteObjectEnd()}}d.Thread=E}(S=t.CallStack||(t.CallStack={}))})(Nh);var Il={};Object.defineProperty(Il,"__esModule",{value:!0});Il.VariablesState=void 0;const Ne=fe,y_=Un,Bf=Tn,Re=K,Ci=ht,Lt=Ce;class kl{constructor(e,n){this.variableChangedEventCallbacks=[],this.patch=null,this._batchObservingVariableChanges=!1,this._defaultGlobalVariables=new Map,this._changedVariablesForBatchObs=new Set,this._globalVariables=new Map,this._callStack=e,this._listDefsOrigin=n;try{return new Proxy(this,{get(i,s){return s in i?i[s]:i.$(s)},set(i,s,o){return s in i?i[s]=o:i.$(s,o),!0}})}catch{}}variableChangedEvent(e,n){for(let r of this.variableChangedEventCallbacks)r(e,n)}get batchObservingVariableChanges(){return this._batchObservingVariableChanges}set batchObservingVariableChanges(e){if(this._batchObservingVariableChanges=e,e)this._changedVariablesForBatchObs=new Set;else if(this._changedVariablesForBatchObs!=null){for(let n of this._changedVariablesForBatchObs){let r=this._globalVariables.get(n);r?this.variableChangedEvent(n,r):Lt.throwNullException("currentValue")}this._changedVariablesForBatchObs=null}}get callStack(){return this._callStack}set callStack(e){this._callStack=e}$(e,n){if(typeof n=="undefined"){let r=null;return this.patch!==null&&(r=this.patch.TryGetGlobal(e,null),r.exists)?r.result.valueObject:(r=this._globalVariables.get(e),typeof r=="undefined"&&(r=this._defaultGlobalVariables.get(e)),typeof r!="undefined"?r.valueObject:null)}else{if(typeof this._defaultGlobalVariables.get(e)=="undefined")throw new y_.StoryException("Cannot assign to a variable ("+e+") that hasn't been declared in the story");let r=Ne.Value.Create(n);if(r==null)throw n==null?new Error("Cannot pass null to VariableState"):new Error("Invalid value passed to VariableState: "+n.toString());this.SetGlobal(e,r)}}ApplyPatch(){if(this.patch===null)return Lt.throwNullException("this.patch");for(let[e,n]of this.patch.globals)this._globalVariables.set(e,n);if(this._changedVariablesForBatchObs!==null)for(let e of this.patch.changedVariables)this._changedVariablesForBatchObs.add(e);this.patch=null}SetJsonToken(e){this._globalVariables.clear();for(let[n,r]of this._defaultGlobalVariables){let i=e[n];if(typeof i!="undefined"){let s=Bf.JsonSerialisation.JTokenToRuntimeObject(i);if(s===null)return Lt.throwNullException("tokenInkObject");this._globalVariables.set(n,s)}else this._globalVariables.set(n,r)}}WriteJson(e){e.WriteObjectStart();for(let[n,r]of this._globalVariables){let i=n,s=r;if(kl.dontSaveDefaultValues&&this._defaultGlobalVariables.has(i)){let o=this._defaultGlobalVariables.get(i);if(this.RuntimeObjectsEqual(s,o))continue}e.WritePropertyStart(i),Bf.JsonSerialisation.WriteRuntimeObject(e,s),e.WritePropertyEnd()}e.WriteObjectEnd()}RuntimeObjectsEqual(e,n){if(e===null)return Lt.throwNullException("obj1");if(n===null)return Lt.throwNullException("obj2");if(e.constructor!==n.constructor)return!1;let r=Re.asOrNull(e,Ne.BoolValue);if(r!==null)return r.value===Re.asOrThrows(n,Ne.BoolValue).value;let i=Re.asOrNull(e,Ne.IntValue);if(i!==null)return i.value===Re.asOrThrows(n,Ne.IntValue).value;let s=Re.asOrNull(e,Ne.FloatValue);if(s!==null)return s.value===Re.asOrThrows(n,Ne.FloatValue).value;let o=Re.asOrNull(e,Ne.Value),l=Re.asOrNull(n,Ne.Value);if(o!==null&&l!==null)return Re.isEquatable(o.valueObject)&&Re.isEquatable(l.valueObject)?o.valueObject.Equals(l.valueObject):o.valueObject===l.valueObject;throw new Error("FastRoughDefinitelyEquals: Unsupported runtime object type: "+e.constructor.name)}GetVariableWithName(e,n=-1){let r=this.GetRawVariableWithName(e,n),i=Re.asOrNull(r,Ne.VariablePointerValue);return i!==null&&(r=this.ValueAtVariablePointer(i)),r}TryGetDefaultVariableValue(e){let n=Ci.tryGetValueFromMap(this._defaultGlobalVariables,e,null);return n.exists?n.result:null}GlobalVariableExistsWithName(e){return this._globalVariables.has(e)||this._defaultGlobalVariables!==null&&this._defaultGlobalVariables.has(e)}GetRawVariableWithName(e,n){let r=null;if(n==0||n==-1){let i=null;if(this.patch!==null&&(i=this.patch.TryGetGlobal(e,null),i.exists)||(i=Ci.tryGetValueFromMap(this._globalVariables,e,null),i.exists)||this._defaultGlobalVariables!==null&&(i=Ci.tryGetValueFromMap(this._defaultGlobalVariables,e,null),i.exists))return i.result;if(this._listDefsOrigin===null)return Lt.throwNullException("VariablesState._listDefsOrigin");let s=this._listDefsOrigin.FindSingleItemListWithName(e);if(s)return s}return r=this._callStack.GetTemporaryVariableWithName(e,n),r}ValueAtVariablePointer(e){return this.GetVariableWithName(e.variableName,e.contextIndex)}Assign(e,n){let r=e.variableName;if(r===null)return Lt.throwNullException("name");let i=-1,s=!1;if(e.isNewDeclaration?s=e.isGlobal:s=this.GlobalVariableExistsWithName(r),e.isNewDeclaration){let o=Re.asOrNull(n,Ne.VariablePointerValue);o!==null&&(n=this.ResolveVariablePointer(o))}else{let o=null;do o=Re.asOrNull(this.GetRawVariableWithName(r,i),Ne.VariablePointerValue),o!=null&&(r=o.variableName,i=o.contextIndex,s=i==0);while(o!=null)}s?this.SetGlobal(r,n):this._callStack.SetTemporaryVariable(r,n,e.isNewDeclaration,i)}SnapshotDefaultGlobals(){this._defaultGlobalVariables=new Map(this._globalVariables)}RetainListOriginsForAssignment(e,n){let r=Re.asOrThrows(e,Ne.ListValue),i=Re.asOrThrows(n,Ne.ListValue);r.value&&i.value&&i.value.Count==0&&i.value.SetInitialOriginNames(r.value.originNames)}SetGlobal(e,n){let r=null;if(this.patch===null&&(r=Ci.tryGetValueFromMap(this._globalVariables,e,null)),this.patch!==null&&(r=this.patch.TryGetGlobal(e,null),r.exists||(r=Ci.tryGetValueFromMap(this._globalVariables,e,null))),Ne.ListValue.RetainListOriginsForAssignment(r.result,n),e===null)return Lt.throwNullException("variableName");if(this.patch!==null?this.patch.SetGlobal(e,n):this._globalVariables.set(e,n),this.variableChangedEvent!==null&&r!==null&&n!==r.result)if(this.batchObservingVariableChanges){if(this._changedVariablesForBatchObs===null)return Lt.throwNullException("this._changedVariablesForBatchObs");this.patch!==null?this.patch.AddChangedVariable(e):this._changedVariablesForBatchObs!==null&&this._changedVariablesForBatchObs.add(e)}else this.variableChangedEvent(e,n)}ResolveVariablePointer(e){let n=e.contextIndex;n==-1&&(n=this.GetContextIndexOfVariableNamed(e.variableName));let r=this.GetRawVariableWithName(e.variableName,n),i=Re.asOrNull(r,Ne.VariablePointerValue);return i!=null?i:new Ne.VariablePointerValue(e.variableName,n)}GetContextIndexOfVariableNamed(e){return this.GlobalVariableExistsWithName(e)?0:this._callStack.currentElementIndex}ObserveVariableChange(e){this.variableChangedEventCallbacks.push(e)}}Il.VariablesState=kl;kl.dontSaveDefaultValues=!0;var Is={};Object.defineProperty(Is,"__esModule",{value:!0});Is.PRNG=void 0;class C_{constructor(e){this.seed=e%2147483647,this.seed<=0&&(this.seed+=2147483646)}next(){return this.seed=this.seed*16807%2147483647}nextFloat(){return(this.next()-1)/2147483646}}Is.PRNG=C_;var Al={};Object.defineProperty(Al,"__esModule",{value:!0});Al.StatePatch=void 0;class S_{constructor(){if(this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,arguments.length===1&&arguments[0]!==null){let e=arguments[0];this._globals=new Map(e._globals),this._changedVariables=new Set(e._changedVariables),this._visitCounts=new Map(e._visitCounts),this._turnIndices=new Map(e._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}get globals(){return this._globals}get changedVariables(){return this._changedVariables}get visitCounts(){return this._visitCounts}get turnIndices(){return this._turnIndices}TryGetGlobal(e,n){return e!==null&&this._globals.has(e)?{result:this._globals.get(e),exists:!0}:{result:n,exists:!1}}SetGlobal(e,n){this._globals.set(e,n)}AddChangedVariable(e){return this._changedVariables.add(e)}TryGetVisitCount(e,n){return this._visitCounts.has(e)?{result:this._visitCounts.get(e),exists:!0}:{result:n,exists:!1}}SetVisitCount(e,n){this._visitCounts.set(e,n)}SetTurnIndex(e,n){this._turnIndices.set(e,n)}TryGetTurnIndex(e,n){return this._turnIndices.has(e)?{result:this._turnIndices.get(e),exists:!0}:{result:n,exists:!1}}}Al.StatePatch=S_;var bh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleJson=void 0;class e{static TextToDictionary(r){return new e.Reader(r).ToDictionary()}static TextToArray(r){return new e.Reader(r).ToArray()}}t.SimpleJson=e,function(n){class r{constructor(o){this._rootObject=JSON.parse(o)}ToDictionary(){return this._rootObject}ToArray(){return this._rootObject}}n.Reader=r;class i{constructor(){this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}WriteObject(o){this.WriteObjectStart(),o(this),this.WriteObjectEnd()}WriteObjectStart(){this.StartNewObject(!0);let o={};if(this.state===n.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let l=this._propertyNameStack.pop();this.currentCollection[l]=o,this._collectionStack.push(o)}else this.state===n.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(o),this._collectionStack.push(o)):(this.Assert(this.state===n.Writer.State.None),this._jsonObject=o,this._collectionStack.push(o));this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Object))}WriteObjectEnd(){this.Assert(this.state===n.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}WriteProperty(o,l){if(this.WritePropertyStart(o),arguments[1]instanceof Function)arguments[1](this);else{let a=arguments[1];this.Write(a)}this.WritePropertyEnd()}WriteIntProperty(o,l){this.WritePropertyStart(o),this.WriteInt(l),this.WritePropertyEnd()}WriteFloatProperty(o,l){this.WritePropertyStart(o),this.WriteFloat(l),this.WritePropertyEnd()}WritePropertyStart(o){this.Assert(this.state===n.Writer.State.Object),this._propertyNameStack.push(o),this.IncrementChildCount(),this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Property))}WritePropertyEnd(){this.Assert(this.state===n.Writer.State.Property),this.Assert(this.childCount===1),this._stateStack.pop()}WritePropertyNameStart(){this.Assert(this.state===n.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName="",this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Property)),this._stateStack.push(new n.Writer.StateElement(n.Writer.State.PropertyName))}WritePropertyNameEnd(){this.Assert(this.state===n.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}WritePropertyNameInner(o){this.Assert(this.state===n.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._currentPropertyName+=o}WriteArrayStart(){this.StartNewObject(!0);let o=[];if(this.state===n.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let l=this._propertyNameStack.pop();this.currentCollection[l]=o,this._collectionStack.push(o)}else this.state===n.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(o),this._collectionStack.push(o)):(this.Assert(this.state===n.Writer.State.None),this._jsonObject=o,this._collectionStack.push(o));this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Array))}WriteArrayEnd(){this.Assert(this.state===n.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}Write(o,l=!0){if(o===null){console.error("Warning: trying to write a null value");return}this.StartNewObject(!1),this._addToCurrentObject(o)}WriteBool(o){o!==null&&(this.StartNewObject(!1),this._addToCurrentObject(o))}WriteInt(o){o!==null&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(o)))}WriteFloat(o){o!==null&&(this.StartNewObject(!1),o==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):o==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(o)?this._addToCurrentObject(0):this._addToCurrentObject(o))}WriteNull(){this.StartNewObject(!1),this._addToCurrentObject(null)}WriteStringStart(){this.StartNewObject(!1),this._currentString="",this._stateStack.push(new n.Writer.StateElement(n.Writer.State.String))}WriteStringEnd(){this.Assert(this.state==n.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}WriteStringInner(o,l=!0){if(this.Assert(this.state===n.Writer.State.String),o===null){console.error("Warning: trying to write a null string");return}this._currentString+=o}toString(){return this._jsonObject===null?"":JSON.stringify(this._jsonObject)}StartNewObject(o){o?this.Assert(this.state===n.Writer.State.None||this.state===n.Writer.State.Property||this.state===n.Writer.State.Array):this.Assert(this.state===n.Writer.State.Property||this.state===n.Writer.State.Array),this.state===n.Writer.State.Property&&this.Assert(this.childCount===0),(this.state===n.Writer.State.Array||this.state===n.Writer.State.Property)&&this.IncrementChildCount()}get state(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:n.Writer.State.None}get childCount(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}get currentCollection(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}get currentPropertyName(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}IncrementChildCount(){this.Assert(this._stateStack.length>0);let o=this._stateStack.pop();o.childCount++,this._stateStack.push(o)}Assert(o){if(!o)throw Error("Assert failed while writing JSON")}_addToCurrentObject(o){this.Assert(this.currentCollection!==null),this.state===n.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(o)):this.state===n.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(this.currentPropertyName!==null),this.currentCollection[this.currentPropertyName]=o,this._propertyNameStack.pop())}}n.Writer=i,function(s){(function(l){l[l.None=0]="None",l[l.Object=1]="Object",l[l.Array=2]="Array",l[l.Property=3]="Property",l[l.PropertyName=4]="PropertyName",l[l.String=5]="String"})(s.State||(s.State={}));class o{constructor(a){this.type=n.Writer.State.None,this.childCount=0,this.type=a}}s.StateElement=o}(i=n.Writer||(n.Writer={}))}(e=t.SimpleJson||(t.SimpleJson={}))})(bh);var Fl={};Object.defineProperty(Fl,"__esModule",{value:!0});Fl.Flow=void 0;const Gf=Nh,so=Tn,w_=Ce;class __{constructor(){let e=arguments[0],n=arguments[1];if(this.name=e,this.callStack=new Gf.CallStack(n),arguments[2]){let r=arguments[2];this.callStack.SetJsonToken(r.callstack,n),this.outputStream=so.JsonSerialisation.JArrayToRuntimeObjList(r.outputStream),this.currentChoices=so.JsonSerialisation.JArrayToRuntimeObjList(r.currentChoices);let i=r.choiceThreads;typeof i!="undefined"&&this.LoadFlowChoiceThreads(i,n)}else this.outputStream=[],this.currentChoices=[]}WriteJson(e){e.WriteObjectStart(),e.WriteProperty("callstack",r=>this.callStack.WriteJson(r)),e.WriteProperty("outputStream",r=>so.JsonSerialisation.WriteListRuntimeObjs(r,this.outputStream));let n=!1;for(let r of this.currentChoices){if(r.threadAtGeneration===null)return w_.throwNullException("c.threadAtGeneration");r.originalThreadIndex=r.threadAtGeneration.threadIndex,this.callStack.ThreadWithIndex(r.originalThreadIndex)===null&&(n||(n=!0,e.WritePropertyStart("choiceThreads"),e.WriteObjectStart()),e.WritePropertyStart(r.originalThreadIndex),r.threadAtGeneration.WriteJson(e),e.WritePropertyEnd())}n&&(e.WriteObjectEnd(),e.WritePropertyEnd()),e.WriteProperty("currentChoices",r=>{r.WriteArrayStart();for(let i of this.currentChoices)so.JsonSerialisation.WriteChoice(r,i);r.WriteArrayEnd()}),e.WriteObjectEnd()}LoadFlowChoiceThreads(e,n){for(let r of this.currentChoices){let i=this.callStack.ThreadWithIndex(r.originalThreadIndex);if(i!==null)r.threadAtGeneration=i.Copy();else{let s=e[`${r.originalThreadIndex}`];r.threadAtGeneration=new Gf.CallStack.Thread(s,n)}}}}Fl.Flow=__;Object.defineProperty(bl,"__esModule",{value:!0});bl.StoryState=void 0;const E_=Nh,P_=Il,be=fe,en=Hn,O_=Zn,ka=Xr,Uf=Ze,Dt=Ue,zf=Ut,tn=Tn,x_=Is,T_=zt,ur=Kn,Si=ht,Le=K,N_=ms,yt=Ce,b_=Ts,I_=Al,qf=bh,oo=Fl,k_=xe;class Ih{constructor(e){this.kInkSaveStateVersion=9,this.kMinCompatibleLoadVersion=8,this.onDidLoadState=null,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=ur.Pointer.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this._namedFlows=null,this.kDefaultFlowName="DEFAULT_FLOW",this.story=e,this._currentFlow=new oo.Flow(this.kDefaultFlowName,e),this.OutputStreamDirty(),this._evaluationStack=[],this._variablesState=new P_.VariablesState(this.callStack,e.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;let n=new Date().getTime();this.storySeed=new x_.PRNG(n).next()%100,this.previousRandom=0,this.GoToStart()}ToJson(e=!1){let n=new qf.SimpleJson.Writer;return this.WriteJson(n),n.toString()}toJson(e=!1){return this.ToJson(e)}LoadJson(e){let n=qf.SimpleJson.TextToDictionary(e);this.LoadJsonObj(n),this.onDidLoadState!==null&&this.onDidLoadState()}VisitCountAtPathString(e){let n;if(this._patch!==null){let r=this.story.ContentAtPath(new Uf.Path(e)).container;if(r===null)throw new Error("Content at path not found: "+e);if(n=this._patch.TryGetVisitCount(r,0),n.exists)return n.result}return n=Si.tryGetValueFromMap(this._visitCounts,e,null),n.exists?n.result:0}VisitCountForContainer(e){if(e===null)return yt.throwNullException("container");if(!e.visitsShouldBeCounted)return this.story.Error("Read count for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),0;if(this._patch!==null){let i=this._patch.TryGetVisitCount(e,0);if(i.exists)return i.result}let n=e.path.toString(),r=Si.tryGetValueFromMap(this._visitCounts,n,null);return r.exists?r.result:0}IncrementVisitCountForContainer(e){if(this._patch!==null){let i=this.VisitCountForContainer(e);i++,this._patch.SetVisitCount(e,i);return}let n=e.path.toString(),r=Si.tryGetValueFromMap(this._visitCounts,n,null);r.exists?this._visitCounts.set(n,r.result+1):this._visitCounts.set(n,1)}RecordTurnIndexVisitToContainer(e){if(this._patch!==null){this._patch.SetTurnIndex(e,this.currentTurnIndex);return}let n=e.path.toString();this._turnIndices.set(n,this.currentTurnIndex)}TurnsSinceForContainer(e){if(e.turnIndexShouldBeCounted||this.story.Error("TURNS_SINCE() for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),this._patch!==null){let i=this._patch.TryGetTurnIndex(e,0);if(i.exists)return this.currentTurnIndex-i.result}let n=e.path.toString(),r=Si.tryGetValueFromMap(this._turnIndices,n,0);return r.exists?this.currentTurnIndex-r.result:-1}get callstackDepth(){return this.callStack.depth}get outputStream(){return this._currentFlow.outputStream}get currentChoices(){return this.canContinue?[]:this._currentFlow.currentChoices}get generatedChoices(){return this._currentFlow.currentChoices}get currentErrors(){return this._currentErrors}get currentWarnings(){return this._currentWarnings}get variablesState(){return this._variablesState}set variablesState(e){this._variablesState=e}get callStack(){return this._currentFlow.callStack}get evaluationStack(){return this._evaluationStack}get currentTurnIndex(){return this._currentTurnIndex}set currentTurnIndex(e){this._currentTurnIndex=e}get currentPathString(){let e=this.currentPointer;return e.isNull?null:e.path===null?yt.throwNullException("pointer.path"):e.path.toString()}get currentPointer(){return this.callStack.currentElement.currentPointer.copy()}set currentPointer(e){this.callStack.currentElement.currentPointer=e.copy()}get previousPointer(){return this.callStack.currentThread.previousPointer.copy()}set previousPointer(e){this.callStack.currentThread.previousPointer=e.copy()}get canContinue(){return!this.currentPointer.isNull&&!this.hasError}get hasError(){return this.currentErrors!=null&&this.currentErrors.length>0}get hasWarning(){return this.currentWarnings!=null&&this.currentWarnings.length>0}get currentText(){if(this._outputStreamTextDirty){let e=new zf.StringBuilder;for(let n of this.outputStream){let r=Le.asOrNull(n,be.StringValue);r!==null&&e.Append(r.value)}this._currentText=this.CleanOutputWhitespace(e.toString()),this._outputStreamTextDirty=!1}return this._currentText}CleanOutputWhitespace(e){let n=new zf.StringBuilder,r=-1,i=0;for(let s=0;s<e.length;s++){let o=e.charAt(s),l=o==" "||o=="	";l&&r==-1&&(r=s),l||(o!=`
`&&r>0&&r!=i&&n.Append(" "),r=-1),o==`
`&&(i=s+1),l||n.Append(o)}return n.toString()}get currentTags(){if(this._outputStreamTagsDirty){this._currentTags=[];for(let e of this.outputStream){let n=Le.asOrNull(e,O_.Tag);n!==null&&this._currentTags.push(n.text)}this._outputStreamTagsDirty=!1}return this._currentTags}get currentFlowName(){return this._currentFlow.name}get inExpressionEvaluation(){return this.callStack.currentElement.inExpressionEvaluation}set inExpressionEvaluation(e){this.callStack.currentElement.inExpressionEvaluation=e}GoToStart(){this.callStack.currentElement.currentPointer=ur.Pointer.StartOf(this.story.mainContentContainer)}SwitchFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.SwitchFlow");if(this._namedFlows===null&&(this._namedFlows=new Map,this._namedFlows.set(this.kDefaultFlowName,this._currentFlow)),e===this._currentFlow.name)return;let n,r=Si.tryGetValueFromMap(this._namedFlows,e,null);r.exists?n=r.result:(n=new oo.Flow(e,this.story),this._namedFlows.set(e,n)),this._currentFlow=n,this.variablesState.callStack=this._currentFlow.callStack,this.OutputStreamDirty()}SwitchToDefaultFlow_Internal(){this._namedFlows!==null&&this.SwitchFlow_Internal(this.kDefaultFlowName)}RemoveFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.DestroyFlow");if(e===this.kDefaultFlowName)throw new Error("Cannot destroy default flow");if(this._currentFlow.name===e&&this.SwitchToDefaultFlow_Internal(),this._namedFlows===null)return yt.throwNullException("this._namedFlows");this._namedFlows.delete(e)}CopyAndStartPatching(){let e=new Ih(this.story);if(e._patch=new I_.StatePatch(this._patch),e._currentFlow.name=this._currentFlow.name,e._currentFlow.callStack=new E_.CallStack(this._currentFlow.callStack),e._currentFlow.currentChoices.push(...this._currentFlow.currentChoices),e._currentFlow.outputStream.push(...this._currentFlow.outputStream),e.OutputStreamDirty(),this._namedFlows!==null){e._namedFlows=new Map;for(let[n,r]of this._namedFlows)e._namedFlows.set(n,r);e._namedFlows.set(this._currentFlow.name,e._currentFlow)}return this.hasError&&(e._currentErrors=[],e._currentErrors.push(...this.currentErrors||[])),this.hasWarning&&(e._currentWarnings=[],e._currentWarnings.push(...this.currentWarnings||[])),e.variablesState=this.variablesState,e.variablesState.callStack=e.callStack,e.variablesState.patch=e._patch,e.evaluationStack.push(...this.evaluationStack),this.divertedPointer.isNull||(e.divertedPointer=this.divertedPointer.copy()),e.previousPointer=this.previousPointer.copy(),e._visitCounts=this._visitCounts,e._turnIndices=this._turnIndices,e.currentTurnIndex=this.currentTurnIndex,e.storySeed=this.storySeed,e.previousRandom=this.previousRandom,e.didSafeExit=this.didSafeExit,e}RestoreAfterPatch(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}ApplyAnyPatch(){if(this._patch!==null){this.variablesState.ApplyPatch();for(let[e,n]of this._patch.visitCounts)this.ApplyCountChanges(e,n,!0);for(let[e,n]of this._patch.turnIndices)this.ApplyCountChanges(e,n,!1);this._patch=null}}ApplyCountChanges(e,n,r){(r?this._visitCounts:this._turnIndices).set(e.path.toString(),n)}WriteJson(e){if(e.WriteObjectStart(),e.WritePropertyStart("flows"),e.WriteObjectStart(),this._namedFlows!==null)for(let[n,r]of this._namedFlows)e.WriteProperty(n,i=>r.WriteJson(i));else e.WriteProperty(this._currentFlow.name,n=>this._currentFlow.WriteJson(n));if(e.WriteObjectEnd(),e.WritePropertyEnd(),e.WriteProperty("currentFlowName",this._currentFlow.name),e.WriteProperty("variablesState",n=>this.variablesState.WriteJson(n)),e.WriteProperty("evalStack",n=>tn.JsonSerialisation.WriteListRuntimeObjs(n,this.evaluationStack)),!this.divertedPointer.isNull){if(this.divertedPointer.path===null)return yt.throwNullException("divertedPointer");e.WriteProperty("currentDivertTarget",this.divertedPointer.path.componentsString)}e.WriteProperty("visitCounts",n=>tn.JsonSerialisation.WriteIntDictionary(n,this._visitCounts)),e.WriteProperty("turnIndices",n=>tn.JsonSerialisation.WriteIntDictionary(n,this._turnIndices)),e.WriteIntProperty("turnIdx",this.currentTurnIndex),e.WriteIntProperty("storySeed",this.storySeed),e.WriteIntProperty("previousRandom",this.previousRandom),e.WriteIntProperty("inkSaveVersion",this.kInkSaveStateVersion),e.WriteIntProperty("inkFormatVersion",b_.Story.inkVersionCurrent),e.WriteObjectEnd()}LoadJsonObj(e){let n=e,r=n.inkSaveVersion;if(r==null)throw new Error("ink save format incorrect, can't load.");if(parseInt(r)<this.kMinCompatibleLoadVersion)throw new Error("Ink save format isn't compatible with the current version (saw '"+r+"', but minimum is "+this.kMinCompatibleLoadVersion+"), so can't load.");let i=n.flows;if(i!=null){let o=i;Object.keys(o).length===1?this._namedFlows=null:this._namedFlows===null?this._namedFlows=new Map:this._namedFlows.clear();let l=Object.entries(o);for(let[a,u]of l){let h=a,S=u,d=new oo.Flow(h,this.story,S);if(Object.keys(o).length===1)this._currentFlow=new oo.Flow(h,this.story,S);else{if(this._namedFlows===null)return yt.throwNullException("this._namedFlows");this._namedFlows.set(h,d)}}if(this._namedFlows!=null&&this._namedFlows.size>1){let a=n.currentFlowName;this._currentFlow=this._namedFlows.get(a)}}else{this._namedFlows=null,this._currentFlow.name=this.kDefaultFlowName,this._currentFlow.callStack.SetJsonToken(n.callstackThreads,this.story),this._currentFlow.outputStream=tn.JsonSerialisation.JArrayToRuntimeObjList(n.outputStream),this._currentFlow.currentChoices=tn.JsonSerialisation.JArrayToRuntimeObjList(n.currentChoices);let o=n.choiceThreads;this._currentFlow.LoadFlowChoiceThreads(o,this.story)}this.OutputStreamDirty(),this.variablesState.SetJsonToken(n.variablesState),this.variablesState.callStack=this._currentFlow.callStack,this._evaluationStack=tn.JsonSerialisation.JArrayToRuntimeObjList(n.evalStack);let s=n.currentDivertTarget;if(s!=null){let o=new Uf.Path(s.toString());this.divertedPointer=this.story.PointerAtPath(o)}this._visitCounts=tn.JsonSerialisation.JObjectToIntDictionary(n.visitCounts),this._turnIndices=tn.JsonSerialisation.JObjectToIntDictionary(n.turnIndices),this.currentTurnIndex=parseInt(n.turnIdx),this.storySeed=parseInt(n.storySeed),this.previousRandom=parseInt(n.previousRandom)}ResetErrors(){this._currentErrors=null,this._currentWarnings=null}ResetOutput(e=null){this.outputStream.length=0,e!==null&&this.outputStream.push(...e),this.OutputStreamDirty()}PushToOutputStream(e){let n=Le.asOrNull(e,be.StringValue);if(n!==null){let r=this.TrySplittingHeadTailWhitespace(n);if(r!==null){for(let i of r)this.PushToOutputStreamIndividual(i);this.OutputStreamDirty();return}}this.PushToOutputStreamIndividual(e),this.OutputStreamDirty()}PopFromOutputStream(e){this.outputStream.splice(this.outputStream.length-e,e),this.OutputStreamDirty()}TrySplittingHeadTailWhitespace(e){let n=e.value;if(n===null)return yt.throwNullException("single.value");let r=-1,i=-1;for(let h=0;h<n.length;h++){let S=n[h];if(S==`
`)r==-1&&(r=h),i=h;else{if(S==" "||S=="	")continue;break}}let s=-1,o=-1;for(let h=n.length-1;h>=0;h--){let S=n[h];if(S==`
`)s==-1&&(s=h),o=h;else{if(S==" "||S=="	")continue;break}}if(r==-1&&s==-1)return null;let l=[],a=0,u=n.length;if(r!=-1){if(r>0){let h=new be.StringValue(n.substring(0,r));l.push(h)}l.push(new be.StringValue(`
`)),a=i+1}if(s!=-1&&(u=o),u>a){let h=n.substring(a,u-a);l.push(new be.StringValue(h))}if(s!=-1&&o>i&&(l.push(new be.StringValue(`
`)),s<n.length-1)){let h=n.length-s-1,S=new be.StringValue(n.substring(s+1,h));l.push(S)}return l}PushToOutputStreamIndividual(e){let n=Le.asOrNull(e,ka.Glue),r=Le.asOrNull(e,be.StringValue),i=!0;if(n)this.TrimNewlinesFromOutputStream(),i=!0;else if(r){let s=-1,o=this.callStack.currentElement;o.type==en.PushPopType.Function&&(s=o.functionStartInOutputStream);let l=-1;for(let u=this.outputStream.length-1;u>=0;u--){let h=this.outputStream[u],S=h instanceof Dt.ControlCommand?h:null;if((h instanceof ka.Glue?h:null)!=null){l=u;break}else if(S!=null&&S.commandType==Dt.ControlCommand.CommandType.BeginString){u>=s&&(s=-1);break}}let a=-1;if(l!=-1&&s!=-1?a=Math.min(s,l):l!=-1?a=l:a=s,a!=-1){if(r.isNewline)i=!1;else if(r.isNonWhitespace&&(l>-1&&this.RemoveExistingGlue(),s>-1)){let u=this.callStack.elements;for(let h=u.length-1;h>=0;h--){let S=u[h];if(S.type==en.PushPopType.Function)S.functionStartInOutputStream=-1;else break}}}else r.isNewline&&(this.outputStreamEndsInNewline||!this.outputStreamContainsContent)&&(i=!1)}if(i){if(e===null)return yt.throwNullException("obj");this.outputStream.push(e),this.OutputStreamDirty()}}TrimNewlinesFromOutputStream(){let e=-1,n=this.outputStream.length-1;for(;n>=0;){let r=this.outputStream[n],i=Le.asOrNull(r,Dt.ControlCommand),s=Le.asOrNull(r,be.StringValue);if(i!=null||s!=null&&s.isNonWhitespace)break;s!=null&&s.isNewline&&(e=n),n--}if(e>=0)for(n=e;n<this.outputStream.length;)Le.asOrNull(this.outputStream[n],be.StringValue)?this.outputStream.splice(n,1):n++;this.OutputStreamDirty()}RemoveExistingGlue(){for(let e=this.outputStream.length-1;e>=0;e--){let n=this.outputStream[e];if(n instanceof ka.Glue)this.outputStream.splice(e,1);else if(n instanceof Dt.ControlCommand)break}this.OutputStreamDirty()}get outputStreamEndsInNewline(){if(this.outputStream.length>0)for(let e=this.outputStream.length-1;e>=0&&!(this.outputStream[e]instanceof Dt.ControlCommand);e--){let r=this.outputStream[e];if(r instanceof be.StringValue){if(r.isNewline)return!0;if(r.isNonWhitespace)break}}return!1}get outputStreamContainsContent(){for(let e of this.outputStream)if(e instanceof be.StringValue)return!0;return!1}get inStringEvaluation(){for(let e=this.outputStream.length-1;e>=0;e--){let n=Le.asOrNull(this.outputStream[e],Dt.ControlCommand);if(n instanceof Dt.ControlCommand&&n.commandType==Dt.ControlCommand.CommandType.BeginString)return!0}return!1}PushEvaluationStack(e){let n=Le.asOrNull(e,be.ListValue);if(n){let r=n.value;if(r===null)return yt.throwNullException("rawList");if(r.originNames!=null){r.origins||(r.origins=[]),r.origins.length=0;for(let i of r.originNames){if(this.story.listDefinitions===null)return yt.throwNullException("StoryState.story.listDefinitions");let s=this.story.listDefinitions.TryListGetDefinition(i,null);if(s.result===null)return yt.throwNullException("StoryState def.result");r.origins.indexOf(s.result)<0&&r.origins.push(s.result)}}}if(e===null)return yt.throwNullException("obj");this.evaluationStack.push(e)}PopEvaluationStack(e){if(typeof e=="undefined"){let n=this.evaluationStack.pop();return Le.nullIfUndefined(n)}else{if(e>this.evaluationStack.length)throw new Error("trying to pop too many objects");let n=this.evaluationStack.splice(this.evaluationStack.length-e,e);return Le.nullIfUndefined(n)}}PeekEvaluationStack(){return this.evaluationStack[this.evaluationStack.length-1]}ForceEnd(){this.callStack.Reset(),this._currentFlow.currentChoices.length=0,this.currentPointer=ur.Pointer.Null,this.previousPointer=ur.Pointer.Null,this.didSafeExit=!0}TrimWhitespaceFromFunctionEnd(){N_.Debug.Assert(this.callStack.currentElement.type==en.PushPopType.Function);let e=this.callStack.currentElement.functionStartInOutputStream;e==-1&&(e=0);for(let n=this.outputStream.length-1;n>=e;n--){let r=this.outputStream[n],i=Le.asOrNull(r,be.StringValue),s=Le.asOrNull(r,Dt.ControlCommand);if(i!=null){if(s)break;if(i.isNewline||i.isInlineWhitespace)this.outputStream.splice(n,1),this.OutputStreamDirty();else break}}}PopCallStack(e=null){this.callStack.currentElement.type==en.PushPopType.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(e)}SetChosenPath(e,n){this._currentFlow.currentChoices.length=0;let r=this.story.PointerAtPath(e);!r.isNull&&r.index==-1&&(r.index=0),this.currentPointer=r,n&&this.currentTurnIndex++}StartFunctionEvaluationFromGame(e,n){this.callStack.Push(en.PushPopType.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=ur.Pointer.StartOf(e),this.PassArgumentsToEvaluationStack(n)}PassArgumentsToEvaluationStack(e){if(e!==null)for(let n=0;n<e.length;n++){if(!(typeof e[n]=="number"||typeof e[n]=="string")||e[n]instanceof k_.InkList)throw new Error("ink arguments when calling EvaluateFunction / ChoosePathStringWithParameters must benumber, string or InkList. Argument was "+(Le.nullIfUndefined(arguments[n])===null)?"null":arguments[n].constructor.name);this.PushEvaluationStack(be.Value.Create(e[n]))}}TryExitFunctionEvaluationFromGame(){return this.callStack.currentElement.type==en.PushPopType.FunctionEvaluationFromGame?(this.currentPointer=ur.Pointer.Null,this.didSafeExit=!0,!0):!1}CompleteFunctionEvaluationFromGame(){if(this.callStack.currentElement.type!=en.PushPopType.FunctionEvaluationFromGame)throw new Error("Expected external function evaluation to be complete. Stack trace: "+this.callStack.callStackTrace);let e=this.callStack.currentElement.evaluationStackHeightWhenPushed,n=null;for(;this.evaluationStack.length>e;){let r=this.PopEvaluationStack();n===null&&(n=r)}if(this.PopCallStack(en.PushPopType.FunctionEvaluationFromGame),n){if(n instanceof T_.Void)return null;let r=Le.asOrThrows(n,be.Value);return r.valueType==be.ValueType.DivertTarget?r.valueObject.toString():r.valueObject}return null}AddError(e,n){n?(this._currentWarnings==null&&(this._currentWarnings=[]),this._currentWarnings.push(e)):(this._currentErrors==null&&(this._currentErrors=[]),this._currentErrors.push(e))}OutputStreamDirty(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}bl.StoryState=Ih;var Rl={};Object.defineProperty(Rl,"__esModule",{value:!0});Rl.Stopwatch=void 0;class A_{constructor(){this.startTime=void 0}get ElapsedMilliseconds(){return typeof this.startTime=="undefined"?0:new Date().getTime()-this.startTime}Start(){this.startTime=new Date().getTime()}Stop(){this.startTime=void 0}}Rl.Stopwatch=A_;var im={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(t.ErrorType||(t.ErrorType={}))})(im);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Story=t.InkList=void 0;const e=Se,n=Me,r=Tn,i=bl,s=Ue,o=Hn,l=Gr,a=Ns,u=wt,h=fe,S=Ze,d=zt,C=Zn,E=At,T=Yn,p=pt,f=Un,g=Is,y=Ut,P=bs,F=Rl,A=Kn,W=xe,R=K,k=Ce,z=bh,Fe=im;var me=xe;Object.defineProperty(t,"InkList",{enumerable:!0,get:function(){return me.InkList}}),Number.isInteger||(Number.isInteger=function(m){return typeof m=="number"&&isFinite(m)&&m>-9007199254740992&&m<9007199254740992&&Math.floor(m)===m});class Q extends n.InkObject{constructor(){super();this.inkVersionMinimumCompatible=18,this.onError=null,this.onDidContinue=null,this.onMakeChoice=null,this.onEvaluateFunction=null,this.onCompleteEvaluateFunction=null,this.onChoosePathString=null,this._prevContainers=[],this.allowExternalFunctionFallbacks=!1,this._listDefinitions=null,this._variableObservers=null,this._hasValidatedExternals=!1,this._temporaryEvaluationContainer=null,this._asyncContinueActive=!1,this._stateSnapshotAtLastNewline=null,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount=0,this._asyncSaving=!1,this._profiler=null;let m,w=null,O=null;if(arguments[0]instanceof e.Container)m=arguments[0],typeof arguments[1]!="undefined"&&(w=arguments[1]),this._mainContentContainer=m;else if(typeof arguments[0]=="string"){let N=arguments[0];O=z.SimpleJson.TextToDictionary(N)}else O=arguments[0];if(w!=null&&(this._listDefinitions=new P.ListDefinitionsOrigin(w)),this._externals=new Map,O!==null){let N=O,x=N.inkVersion;if(x==null)throw new Error("ink version number not found. Are you sure it's a valid .ink.json file?");let D=parseInt(x);if(D>Q.inkVersionCurrent)throw new Error("Version of ink used to build story was newer than the current version of the engine");if(D<this.inkVersionMinimumCompatible)throw new Error("Version of ink used to build story is too old to be loaded by this version of the engine");D!=Q.inkVersionCurrent&&console.warn("WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.");let b=N.root;if(b==null)throw new Error("Root node for ink not found. Are you sure it's a valid .ink.json file?");let V;(V=N.listDefs)&&(this._listDefinitions=r.JsonSerialisation.JTokenToListDefinitions(V)),this._mainContentContainer=R.asOrThrows(r.JsonSerialisation.JTokenToRuntimeObject(b),e.Container),this.ResetState()}}get currentChoices(){let m=[];if(this._state===null)return k.throwNullException("this._state");for(let w of this._state.currentChoices)w.isInvisibleDefault||(w.index=m.length,m.push(w));return m}get currentText(){return this.IfAsyncWeCant("call currentText since it's a work in progress"),this.state.currentText}get currentTags(){return this.IfAsyncWeCant("call currentTags since it's a work in progress"),this.state.currentTags}get currentErrors(){return this.state.currentErrors}get currentWarnings(){return this.state.currentWarnings}get currentFlowName(){return this.state.currentFlowName}get hasError(){return this.state.hasError}get hasWarning(){return this.state.hasWarning}get variablesState(){return this.state.variablesState}get listDefinitions(){return this._listDefinitions}get state(){return this._state}StartProfiling(){}EndProfiling(){}ToJson(m){let w=!1;if(m||(w=!0,m=new z.SimpleJson.Writer),m.WriteObjectStart(),m.WriteIntProperty("inkVersion",Q.inkVersionCurrent),m.WriteProperty("root",O=>r.JsonSerialisation.WriteRuntimeContainer(O,this._mainContentContainer)),this._listDefinitions!=null){m.WritePropertyStart("listDefs"),m.WriteObjectStart();for(let O of this._listDefinitions.lists){m.WritePropertyStart(O.name),m.WriteObjectStart();for(let[N,x]of O.items){let D=W.InkListItem.fromSerializedKey(N),b=x;m.WriteIntProperty(D.itemName,b)}m.WriteObjectEnd(),m.WritePropertyEnd()}m.WriteObjectEnd(),m.WritePropertyEnd()}if(m.WriteObjectEnd(),w)return m.toString()}ResetState(){this.IfAsyncWeCant("ResetState"),this._state=new i.StoryState(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}ResetErrors(){if(this._state===null)return k.throwNullException("this._state");this._state.ResetErrors()}ResetCallstack(){if(this.IfAsyncWeCant("ResetCallstack"),this._state===null)return k.throwNullException("this._state");this._state.ForceEnd()}ResetGlobals(){if(this._mainContentContainer.namedContent.get("global decl")){let m=this.state.currentPointer.copy();this.ChoosePath(new S.Path("global decl"),!1),this.ContinueInternal(),this.state.currentPointer=m}this.state.variablesState.SnapshotDefaultGlobals()}SwitchFlow(m){if(this.IfAsyncWeCant("switch flow"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't switch flow to "+m);this.state.SwitchFlow_Internal(m)}RemoveFlow(m){this.state.RemoveFlow_Internal(m)}SwitchToDefaultFlow(){this.state.SwitchToDefaultFlow_Internal()}Continue(){return this.ContinueAsync(0),this.currentText}get canContinue(){return this.state.canContinue}get asyncContinueComplete(){return!this._asyncContinueActive}ContinueAsync(m){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(m)}ContinueInternal(m=0){this._profiler!=null&&this._profiler.PreContinue();let w=m>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=w,!this.canContinue)throw new Error("Can't continue - should check canContinue before calling Continue");this._state.didSafeExit=!1,this._state.ResetOutput(),this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!0)}let O=new F.Stopwatch;O.Start();let N=!1;this._sawLookaheadUnsafeFunctionAfterNewline=!1;do{try{N=this.ContinueSingleStep()}catch(x){if(!(x instanceof f.StoryException))throw x;this.AddError(x.message,void 0,x.useEndLineNumber);break}if(N||this._asyncContinueActive&&O.ElapsedMilliseconds>m)break}while(this.canContinue);if(O.Stop(),(N||!this.canContinue)&&(this._stateSnapshotAtLastNewline!==null&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError("Thread available to pop, threads should always be flat by the end of evaluation?"),this.state.generatedChoices.length==0&&!this.state.didSafeExit&&this._temporaryEvaluationContainer==null&&(this.state.callStack.CanPop(o.PushPopType.Tunnel)?this.AddError("unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?"):this.state.callStack.CanPop(o.PushPopType.Function)?this.AddError("unexpectedly reached end of content. Do you need a '~ return'?"):this.state.callStack.canPop?this.AddError("unexpectedly reached end of content for unknown reason. Please debug compiler!"):this.AddError("ran out of content. Do you need a '-> DONE' or '-> END'?"))),this.state.didSafeExit=!1,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1,this.onDidContinue!==null&&this.onDidContinue()),this._recursiveContinueCount--,this._profiler!=null&&this._profiler.PostContinue(),this.state.hasError||this.state.hasWarning)if(this.onError!==null){if(this.state.hasError)for(let x of this.state.currentErrors)this.onError(x,Fe.ErrorType.Error);if(this.state.hasWarning)for(let x of this.state.currentWarnings)this.onError(x,Fe.ErrorType.Warning);this.ResetErrors()}else{let x=new y.StringBuilder;throw x.Append("Ink had "),this.state.hasError&&(x.Append(`${this.state.currentErrors.length}`),x.Append(this.state.currentErrors.length==1?" error":"errors"),this.state.hasWarning&&x.Append(" and ")),this.state.hasWarning&&(x.Append(`${this.state.currentWarnings.length}`),x.Append(this.state.currentWarnings.length==1?" warning":"warnings"),this.state.hasWarning&&x.Append(" and ")),x.Append(". It is strongly suggested that you assign an error handler to story.onError. The first issue was: "),x.Append(this.state.hasError?this.state.currentErrors[0]:this.state.currentWarnings[0]),new f.StoryException(x.toString())}}ContinueSingleStep(){if(this._profiler!=null&&this._profiler.PreStep(),this.Step(),this._profiler!=null&&this._profiler.PostStep(),!this.canContinue&&!this.state.callStack.elementIsEvaluateFromGame&&this.TryFollowDefaultInvisibleChoice(),this._profiler!=null&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(this._stateSnapshotAtLastNewline!==null){if(this._stateSnapshotAtLastNewline.currentTags===null)return k.throwNullException("this._stateAtLastNewline.currentTags");if(this.state.currentTags===null)return k.throwNullException("this.state.currentTags");let m=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(m==Q.OutputStateChange.ExtendedBeyondNewline||this._sawLookaheadUnsafeFunctionAfterNewline)return this.RestoreStateSnapshot(),!0;m==Q.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?this._stateSnapshotAtLastNewline==null&&this.StateSnapshot():this.DiscardSnapshot())}return this._profiler!=null&&this._profiler.PostSnapshot(),!1}CalculateNewlineOutputStateChange(m,w,O,N){if(m===null)return k.throwNullException("prevText");if(w===null)return k.throwNullException("currText");let x=w.length>=m.length&&w.charAt(m.length-1)==`
`;if(O==N&&m.length==w.length&&x)return Q.OutputStateChange.NoChange;if(!x)return Q.OutputStateChange.NewlineRemoved;if(N>O)return Q.OutputStateChange.ExtendedBeyondNewline;for(let D=m.length;D<w.length;D++){let b=w.charAt(D);if(b!=" "&&b!="	")return Q.OutputStateChange.ExtendedBeyondNewline}return Q.OutputStateChange.NoChange}ContinueMaximally(){this.IfAsyncWeCant("ContinueMaximally");let m=new y.StringBuilder;for(;this.canContinue;)m.Append(this.Continue());return m.toString()}ContentAtPath(m){return this.mainContentContainer.ContentAtPath(m)}KnotContainerWithName(m){let w=this.mainContentContainer.namedContent.get(m);return w instanceof e.Container?w:null}PointerAtPath(m){if(m.length==0)return A.Pointer.Null;let w=new A.Pointer,O=m.length,N=null;return m.lastComponent===null?k.throwNullException("path.lastComponent"):(m.lastComponent.isIndex?(O=m.length-1,N=this.mainContentContainer.ContentAtPath(m,void 0,O),w.container=N.container,w.index=m.lastComponent.index):(N=this.mainContentContainer.ContentAtPath(m),w.container=N.container,w.index=-1),N.obj==null||N.obj==this.mainContentContainer&&O>0?this.Error("Failed to find content at path '"+m+"', and no approximation of it was possible."):N.approximate&&this.Warning("Failed to find content at path '"+m+"', so it was approximated to: '"+N.obj.path+"'."),w)}StateSnapshot(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}RestoreStateSnapshot(){this._stateSnapshotAtLastNewline===null&&k.throwNullException("_stateSnapshotAtLastNewline"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}DiscardSnapshot(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}CopyStateForBackgroundThreadSave(){if(this.IfAsyncWeCant("start saving on a background thread"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!");let m=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,m}BackgroundSaveComplete(){this._stateSnapshotAtLastNewline===null&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}Step(){let m=!0,w=this.state.currentPointer.copy();if(w.isNull)return;let O=R.asOrNull(w.Resolve(),e.Container);for(;O&&(this.VisitContainer(O,!0),O.content.length!=0);)w=A.Pointer.StartOf(O),O=R.asOrNull(w.Resolve(),e.Container);this.state.currentPointer=w.copy(),this._profiler!=null&&this._profiler.Step(this.state.callStack);let N=w.Resolve(),x=this.PerformLogicAndFlowControl(N);if(this.state.currentPointer.isNull)return;x&&(m=!1);let D=R.asOrNull(N,l.ChoicePoint);if(D){let V=this.ProcessChoice(D);V&&this.state.generatedChoices.push(V),N=null,m=!1}if(N instanceof e.Container&&(m=!1),m){let V=R.asOrNull(N,h.VariablePointerValue);if(V&&V.contextIndex==-1){let $=this.state.callStack.ContextForVariableNamed(V.variableName);N=new h.VariablePointerValue(V.variableName,$)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(N):this.state.PushToOutputStream(N)}this.NextContent();let b=R.asOrNull(N,s.ControlCommand);b&&b.commandType==s.ControlCommand.CommandType.StartThread&&this.state.callStack.PushThread()}VisitContainer(m,w){(!m.countingAtStartOnly||w)&&(m.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(m),m.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(m))}VisitChangedContainersDueToDivert(){let m=this.state.previousPointer.copy(),w=this.state.currentPointer.copy();if(w.isNull||w.index==-1)return;if(this._prevContainers.length=0,!m.isNull){let D=m.Resolve(),b=R.asOrNull(D,e.Container)||R.asOrNull(m.container,e.Container);for(;b;)this._prevContainers.push(b),b=R.asOrNull(b.parent,e.Container)}let O=w.Resolve();if(O==null)return;let N=R.asOrNull(O.parent,e.Container),x=!0;for(;N&&(this._prevContainers.indexOf(N)<0||N.countingAtStartOnly);){let D=N.content.length>0&&O==N.content[0]&&x;D||(x=!1),this.VisitContainer(N,D),O=N,N=R.asOrNull(N.parent,e.Container)}}ProcessChoice(m){let w=!0;if(m.hasCondition){let D=this.state.PopEvaluationStack();this.IsTruthy(D)||(w=!1)}let O="",N="";if(m.hasChoiceOnlyContent&&(N=R.asOrThrows(this.state.PopEvaluationStack(),h.StringValue).value||""),m.hasStartContent&&(O=R.asOrThrows(this.state.PopEvaluationStack(),h.StringValue).value||""),m.onceOnly&&this.state.VisitCountForContainer(m.choiceTarget)>0&&(w=!1),!w)return null;let x=new a.Choice;return x.targetPath=m.pathOnChoice,x.sourcePath=m.path.toString(),x.isInvisibleDefault=m.isInvisibleDefault,x.threadAtGeneration=this.state.callStack.ForkThread(),x.text=(O+N).replace(/^[ \t]+|[ \t]+$/g,""),x}IsTruthy(m){let w=!1;if(m instanceof h.Value){let O=m;if(O instanceof h.DivertTargetValue){let N=O;return this.Error("Shouldn't use a divert target (to "+N.targetPath+") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)"),!1}return O.isTruthy}return w}PerformLogicAndFlowControl(m){if(m==null)return!1;if(m instanceof u.Divert){let w=m;if(w.isConditional){let O=this.state.PopEvaluationStack();if(!this.IsTruthy(O))return!0}if(w.hasVariableTarget){let O=w.variableDivertName,N=this.state.variablesState.GetVariableWithName(O);if(N==null)this.Error("Tried to divert using a target from a variable that could not be found ("+O+")");else if(!(N instanceof h.DivertTargetValue)){let D=R.asOrNull(N,h.IntValue),b="Tried to divert to a target from a variable, but the variable ("+O+") didn't contain a divert target, it ";D instanceof h.IntValue&&D.value==0?b+="was empty/null (the value 0).":b+="contained '"+N+"'.",this.Error(b)}let x=R.asOrThrows(N,h.DivertTargetValue);this.state.divertedPointer=this.PointerAtPath(x.targetPath)}else{if(w.isExternal)return this.CallExternalFunction(w.targetPathString,w.externalArgs),!0;this.state.divertedPointer=w.targetPointer.copy()}return w.pushesToStack&&this.state.callStack.Push(w.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!w.isExternal&&(w&&w.debugMetadata&&w.debugMetadata.sourceName!=null?this.Error("Divert target doesn't exist: "+w.debugMetadata.sourceName):this.Error("Divert resolution failed: "+w)),!0}else if(m instanceof s.ControlCommand){let w=m;switch(w.commandType){case s.ControlCommand.CommandType.EvalStart:this.Assert(this.state.inExpressionEvaluation===!1,"Already in expression evaluation?"),this.state.inExpressionEvaluation=!0;break;case s.ControlCommand.CommandType.EvalEnd:this.Assert(this.state.inExpressionEvaluation===!0,"Not in expression evaluation mode"),this.state.inExpressionEvaluation=!1;break;case s.ControlCommand.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){let X=this.state.PopEvaluationStack();if(!(X instanceof d.Void)){let he=new h.StringValue(X.toString());this.state.PushToOutputStream(he)}}break;case s.ControlCommand.CommandType.NoOp:break;case s.ControlCommand.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case s.ControlCommand.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case s.ControlCommand.CommandType.PopFunction:case s.ControlCommand.CommandType.PopTunnel:let O=w.commandType==s.ControlCommand.CommandType.PopFunction?o.PushPopType.Function:o.PushPopType.Tunnel,N=null;if(O==o.PushPopType.Tunnel){let X=this.state.PopEvaluationStack();N=R.asOrNull(X,h.DivertTargetValue),N===null&&this.Assert(X instanceof d.Void,"Expected void if ->-> doesn't override target")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type!=O||!this.state.callStack.canPop){let X=new Map;X.set(o.PushPopType.Function,"function return statement (~ return)"),X.set(o.PushPopType.Tunnel,"tunnel onwards statement (->->)");let he=X.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(he="end of flow (-> END or choice)");let Te="Found "+X.get(O)+", when expected "+he;this.Error(Te)}else this.state.PopCallStack(),N&&(this.state.divertedPointer=this.PointerAtPath(N.targetPath));break;case s.ControlCommand.CommandType.BeginString:this.state.PushToOutputStream(w),this.Assert(this.state.inExpressionEvaluation===!0,"Expected to be in an expression when evaluating a string"),this.state.inExpressionEvaluation=!1;break;case s.ControlCommand.CommandType.EndString:let x=[],D=0;for(let X=this.state.outputStream.length-1;X>=0;--X){let he=this.state.outputStream[X];D++;let Te=R.asOrNull(he,s.ControlCommand);if(Te&&Te.commandType==s.ControlCommand.CommandType.BeginString)break;he instanceof h.StringValue&&x.push(he)}this.state.PopFromOutputStream(D),x=x.reverse();let b=new y.StringBuilder;for(let X of x)b.Append(X.toString());this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new h.StringValue(b.toString()));break;case s.ControlCommand.CommandType.ChoiceCount:let V=this.state.generatedChoices.length;this.state.PushEvaluationStack(new h.IntValue(V));break;case s.ControlCommand.CommandType.Turns:this.state.PushEvaluationStack(new h.IntValue(this.state.currentTurnIndex+1));break;case s.ControlCommand.CommandType.TurnsSince:case s.ControlCommand.CommandType.ReadCount:let $=this.state.PopEvaluationStack();if(!($ instanceof h.DivertTargetValue)){let X="";$ instanceof h.IntValue&&(X=". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?"),this.Error("TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw "+$+X);break}let J=R.asOrThrows($,h.DivertTargetValue),ne=R.asOrNull(this.ContentAtPath(J.targetPath).correctObj,e.Container),ve;ne!=null?w.commandType==s.ControlCommand.CommandType.TurnsSince?ve=this.state.TurnsSinceForContainer(ne):ve=this.state.VisitCountForContainer(ne):(w.commandType==s.ControlCommand.CommandType.TurnsSince?ve=-1:ve=0,this.Warning("Failed to find container for "+w.toString()+" lookup at "+J.targetPath.toString())),this.state.PushEvaluationStack(new h.IntValue(ve));break;case s.ControlCommand.CommandType.Random:{let X=R.asOrNull(this.state.PopEvaluationStack(),h.IntValue),he=R.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(he==null||!(he instanceof h.IntValue))return this.Error("Invalid value for minimum parameter of RANDOM(min, max)");if(X==null||!(he instanceof h.IntValue))return this.Error("Invalid value for maximum parameter of RANDOM(min, max)");if(X.value===null)return k.throwNullException("maxInt.value");if(he.value===null)return k.throwNullException("minInt.value");let Te=X.value-he.value+1;(!isFinite(Te)||Te>Number.MAX_SAFE_INTEGER)&&(Te=Number.MAX_SAFE_INTEGER,this.Error("RANDOM was called with a range that exceeds the size that ink numbers can use.")),Te<=0&&this.Error("RANDOM was called with minimum as "+he.value+" and maximum as "+X.value+". The maximum must be larger");let tr=this.state.storySeed+this.state.previousRandom,c=new g.PRNG(tr).next(),v=c%Te+he.value;this.state.PushEvaluationStack(new h.IntValue(v)),this.state.previousRandom=c;break}case s.ControlCommand.CommandType.SeedRandom:let Y=R.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(Y==null||!(Y instanceof h.IntValue))return this.Error("Invalid value passed to SEED_RANDOM");if(Y.value===null)return k.throwNullException("minInt.value");this.state.storySeed=Y.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new d.Void);break;case s.ControlCommand.CommandType.VisitIndex:let $e=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new h.IntValue($e));break;case s.ControlCommand.CommandType.SequenceShuffleIndex:let qe=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new h.IntValue(qe));break;case s.ControlCommand.CommandType.StartThread:break;case s.ControlCommand.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=A.Pointer.Null);break;case s.ControlCommand.CommandType.End:this.state.ForceEnd();break;case s.ControlCommand.CommandType.ListFromInt:let Qt=R.asOrNull(this.state.PopEvaluationStack(),h.IntValue),ks=R.asOrThrows(this.state.PopEvaluationStack(),h.StringValue);if(Qt===null)throw new f.StoryException("Passed non-integer when creating a list element from a numerical value.");let et=null;if(this.listDefinitions===null)return k.throwNullException("this.listDefinitions");let Xt=this.listDefinitions.TryListGetDefinition(ks.value,null);if(Xt.exists){if(Qt.value===null)return k.throwNullException("minInt.value");let X=Xt.result.TryGetItemWithValue(Qt.value,W.InkListItem.Null);X.exists&&(et=new h.ListValue(X.result,Qt.value))}else throw new f.StoryException("Failed to find LIST called "+ks.value);et==null&&(et=new h.ListValue),this.state.PushEvaluationStack(et);break;case s.ControlCommand.CommandType.ListRange:let Ft=R.asOrNull(this.state.PopEvaluationStack(),h.Value),er=R.asOrNull(this.state.PopEvaluationStack(),h.Value),re=R.asOrNull(this.state.PopEvaluationStack(),h.ListValue);if(re===null||er===null||Ft===null)throw new f.StoryException("Expected list, minimum and maximum for LIST_RANGE");if(re.value===null)return k.throwNullException("targetList.value");let Yt=re.value.ListWithSubRange(er.valueObject,Ft.valueObject);this.state.PushEvaluationStack(new h.ListValue(Yt));break;case s.ControlCommand.CommandType.ListRandom:{let X=this.state.PopEvaluationStack();if(X===null)throw new f.StoryException("Expected list for LIST_RANDOM");let he=X.value,Te=null;if(he===null)throw k.throwNullException("list");if(he.Count==0)Te=new W.InkList;else{let tr=this.state.storySeed+this.state.previousRandom,c=new g.PRNG(tr).next(),v=c%he.Count,_=he.entries();for(let G=0;G<=v-1;G++)_.next();let I=_.next().value,U={Key:W.InkListItem.fromSerializedKey(I[0]),Value:I[1]};if(U.Key.originName===null)return k.throwNullException("randomItem.Key.originName");Te=new W.InkList(U.Key.originName,this),Te.Add(U.Key,U.Value),this.state.previousRandom=c}this.state.PushEvaluationStack(new h.ListValue(Te));break}default:this.Error("unhandled ControlCommand: "+w);break}return!0}else if(m instanceof E.VariableAssignment){let w=m,O=this.state.PopEvaluationStack();return this.state.variablesState.Assign(w,O),!0}else if(m instanceof T.VariableReference){let w=m,O=null;if(w.pathForCount!=null){let N=w.containerForCount,x=this.state.VisitCountForContainer(N);O=new h.IntValue(x)}else O=this.state.variablesState.GetVariableWithName(w.name),O==null&&(this.Warning("Variable not found: '"+w.name+"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state."),O=new h.IntValue(0));return this.state.PushEvaluationStack(O),!0}else if(m instanceof p.NativeFunctionCall){let w=m,O=this.state.PopEvaluationStack(w.numberOfParameters),N=w.Call(O);return this.state.PushEvaluationStack(N),!0}return!1}ChoosePathString(m,w=!0,O=[]){if(this.IfAsyncWeCant("call ChoosePathString right now"),this.onChoosePathString!==null&&this.onChoosePathString(m,O),w)this.ResetCallstack();else if(this.state.callStack.currentElement.type==o.PushPopType.Function){let N="",x=this.state.callStack.currentElement.currentPointer.container;throw x!=null&&(N="("+x.path.toString()+") "),new Error("Story was running a function "+N+"when you called ChoosePathString("+m+`) - this is almost certainly not not what you want! Full stack trace: 
`+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(O),this.ChoosePath(new S.Path(m))}IfAsyncWeCant(m){if(this._asyncContinueActive)throw new Error("Can't "+m+". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.")}ChoosePath(m,w=!0){this.state.SetChosenPath(m,w),this.VisitChangedContainersDueToDivert()}ChooseChoiceIndex(m){m=m;let w=this.currentChoices;this.Assert(m>=0&&m<w.length,"choice out of range");let O=w[m];if(this.onMakeChoice!==null&&this.onMakeChoice(O),O.threadAtGeneration===null)return k.throwNullException("choiceToChoose.threadAtGeneration");if(O.targetPath===null)return k.throwNullException("choiceToChoose.targetPath");this.state.callStack.currentThread=O.threadAtGeneration,this.ChoosePath(O.targetPath)}HasFunction(m){try{return this.KnotContainerWithName(m)!=null}catch{return!1}}EvaluateFunction(m,w=[],O=!1){if(this.onEvaluateFunction!==null&&this.onEvaluateFunction(m,w),this.IfAsyncWeCant("evaluate a function"),m==null)throw new Error("Function is null");if(m==""||m.trim()=="")throw new Error("Function is empty or white space.");let N=this.KnotContainerWithName(m);if(N==null)throw new Error("Function doesn't exist: '"+m+"'");let x=[];x.push(...this.state.outputStream),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(N,w);let D=new y.StringBuilder;for(;this.canContinue;)D.Append(this.Continue());let b=D.toString();this._state.ResetOutput(x);let V=this.state.CompleteFunctionEvaluationFromGame();return this.onCompleteEvaluateFunction!=null&&this.onCompleteEvaluateFunction(m,w,b,V),O?{returned:V,output:b}:V}EvaluateExpression(m){let w=this.state.callStack.elements.length;this.state.callStack.Push(o.PushPopType.Tunnel),this._temporaryEvaluationContainer=m,this.state.GoToStart();let O=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>w&&this.state.PopCallStack(),this.state.evaluationStack.length>O?this.state.PopEvaluationStack():null}CallExternalFunction(m,w){if(m===null)return k.throwNullException("funcName");let O=this._externals.get(m),N=null,x=typeof O!="undefined";if(x&&!O.lookAheadSafe&&this._stateSnapshotAtLastNewline!==null){this._sawLookaheadUnsafeFunctionAfterNewline=!0;return}if(!x)if(this.allowExternalFunctionFallbacks){N=this.KnotContainerWithName(m),this.Assert(N!==null,"Trying to call EXTERNAL function '"+m+"' which has not been bound, and fallback ink function could not be found."),this.state.callStack.Push(o.PushPopType.Function,void 0,this.state.outputStream.length),this.state.divertedPointer=A.Pointer.StartOf(N);return}else this.Assert(!1,"Trying to call EXTERNAL function '"+m+"' which has not been bound (and ink fallbacks disabled).");let D=[];for(let $=0;$<w;++$){let ne=R.asOrThrows(this.state.PopEvaluationStack(),h.Value).valueObject;D.push(ne)}D.reverse();let b=O.function(D),V=null;b!=null?(V=h.Value.Create(b),this.Assert(V!==null,"Could not create ink value from returned object of type "+typeof b)):V=new d.Void,this.state.PushEvaluationStack(V)}BindExternalFunctionGeneral(m,w,O){this.IfAsyncWeCant("bind an external function"),this.Assert(!this._externals.has(m),"Function '"+m+"' has already been bound."),this._externals.set(m,{function:w,lookAheadSafe:O})}TryCoerce(m){return m}BindExternalFunction(m,w,O){this.Assert(w!=null,"Can't bind a null function"),this.BindExternalFunctionGeneral(m,N=>{this.Assert(N.length>=w.length,"External function expected "+w.length+" arguments");let x=[];for(let D=0,b=N.length;D<b;D++)x[D]=this.TryCoerce(N[D]);return w.apply(null,x)},O)}UnbindExternalFunction(m){this.IfAsyncWeCant("unbind an external a function"),this.Assert(this._externals.has(m),"Function '"+m+"' has not been bound."),this._externals.delete(m)}ValidateExternalBindings(){let m=null,w=null,O=arguments[1]||new Set;if(arguments[0]instanceof e.Container&&(m=arguments[0]),arguments[0]instanceof n.InkObject&&(w=arguments[0]),m===null&&w===null)if(this.ValidateExternalBindings(this._mainContentContainer,O),this._hasValidatedExternals=!0,O.size==0)this._hasValidatedExternals=!0;else{let N="Error: Missing function binding for external";N+=O.size>1?"s":"",N+=": '",N+=Array.from(O).join("', '"),N+="' ",N+=this.allowExternalFunctionFallbacks?", and no fallback ink function found.":" (ink fallbacks disabled)",this.Error(N)}else if(m!=null){for(let N of m.content){let x=N;(x==null||!x.hasValidName)&&this.ValidateExternalBindings(N,O)}for(let[,N]of m.namedContent)this.ValidateExternalBindings(R.asOrNull(N,n.InkObject),O)}else if(w!=null){let N=R.asOrNull(w,u.Divert);if(N&&N.isExternal){let x=N.targetPathString;if(x===null)return k.throwNullException("name");this._externals.has(x)||this.allowExternalFunctionFallbacks&&this.mainContentContainer.namedContent.has(x)||O.add(x)}}}ObserveVariable(m,w){if(this.IfAsyncWeCant("observe a new variable"),this._variableObservers===null&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(m))throw new Error("Cannot observe variable '"+m+"' because it wasn't declared in the ink story.");this._variableObservers.has(m)?this._variableObservers.get(m).push(w):this._variableObservers.set(m,[w])}ObserveVariables(m,w){for(let O=0,N=m.length;O<N;O++)this.ObserveVariable(m[O],w[O])}RemoveVariableObserver(m,w){if(this.IfAsyncWeCant("remove a variable observer"),this._variableObservers!==null){if(w!=null){if(this._variableObservers.has(w))if(m!=null){let O=this._variableObservers.get(w);O!=null&&(O.splice(O.indexOf(m),1),O.length===0&&this._variableObservers.delete(w))}else this._variableObservers.delete(w)}else if(m!=null){let O=this._variableObservers.keys();for(let N of O){let x=this._variableObservers.get(N);x!=null&&(x.splice(x.indexOf(m),1),x.length===0&&this._variableObservers.delete(N))}}}}VariableStateDidChangeEvent(m,w){if(this._variableObservers===null)return;let O=this._variableObservers.get(m);if(typeof O!="undefined"){if(!(w instanceof h.Value))throw new Error("Tried to get the value of a variable that isn't a standard type");let N=R.asOrThrows(w,h.Value);for(let x of O)x(m,N.valueObject)}}get globalTags(){return this.TagsAtStartOfFlowContainerWithPathString("")}TagsForContentAtPath(m){return this.TagsAtStartOfFlowContainerWithPathString(m)}TagsAtStartOfFlowContainerWithPathString(m){let w=new S.Path(m),O=this.ContentAtPath(w).container;if(O===null)return k.throwNullException("flowContainer");for(;;){let x=O.content[0];if(x instanceof e.Container)O=x;else break}let N=null;for(let x of O.content){let D=R.asOrNull(x,C.Tag);if(D)N==null&&(N=[]),N.push(D.text);else break}return N}BuildStringOfHierarchy(){let m=new y.StringBuilder;return this.mainContentContainer.BuildStringOfHierarchy(m,0,this.state.currentPointer.Resolve()),m.toString()}BuildStringOfContainer(m){let w=new y.StringBuilder;return m.BuildStringOfHierarchy(w,0,this.state.currentPointer.Resolve()),w.toString()}NextContent(){if(this.state.previousPointer=this.state.currentPointer.copy(),!this.state.divertedPointer.isNull&&(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=A.Pointer.Null,this.VisitChangedContainersDueToDivert(),!this.state.currentPointer.isNull))return;if(!this.IncrementContentPointer()){let w=!1;this.state.callStack.CanPop(o.PushPopType.Function)?(this.state.PopCallStack(o.PushPopType.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new d.Void),w=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),w=!0):this.state.TryExitFunctionEvaluationFromGame(),w&&!this.state.currentPointer.isNull&&this.NextContent()}}IncrementContentPointer(){let m=!0,w=this.state.callStack.currentElement.currentPointer.copy();if(w.index++,w.container===null)return k.throwNullException("pointer.container");for(;w.index>=w.container.content.length;){m=!1;let O=R.asOrNull(w.container.parent,e.Container);if(!(O instanceof e.Container))break;let N=O.content.indexOf(w.container);if(N==-1)break;if(w=new A.Pointer(O,N),w.index++,m=!0,w.container===null)return k.throwNullException("pointer.container")}return m||(w=A.Pointer.Null),this.state.callStack.currentElement.currentPointer=w.copy(),m}TryFollowDefaultInvisibleChoice(){let m=this._state.currentChoices,w=m.filter(N=>N.isInvisibleDefault);if(w.length==0||m.length>w.length)return!1;let O=w[0];return O.targetPath===null?k.throwNullException("choice.targetPath"):O.threadAtGeneration===null?k.throwNullException("choice.threadAtGeneration"):(this.state.callStack.currentThread=O.threadAtGeneration,this._stateSnapshotAtLastNewline!==null&&(this.state.callStack.currentThread=this.state.callStack.ForkThread()),this.ChoosePath(O.targetPath,!1),!0)}NextSequenceShuffleIndex(){let m=R.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(!(m instanceof h.IntValue))return this.Error("expected number of elements in sequence for shuffle index"),0;let w=this.state.currentPointer.container;if(w===null)return k.throwNullException("seqContainer");if(m.value===null)return k.throwNullException("numElementsIntVal.value");let O=m.value,x=R.asOrThrows(this.state.PopEvaluationStack(),h.IntValue).value;if(x===null)return k.throwNullException("seqCount");let D=x/O,b=x%O,V=w.path.toString(),$=0;for(let Y=0,$e=V.length;Y<$e;Y++)$+=V.charCodeAt(Y)||0;let J=$+D+this.state.storySeed,ne=new g.PRNG(Math.floor(J)),ve=[];for(let Y=0;Y<O;++Y)ve.push(Y);for(let Y=0;Y<=b;++Y){let $e=ne.next()%ve.length,qe=ve[$e];if(ve.splice($e,1),Y==b)return qe}throw new Error("Should never reach here")}Error(m,w=!1){let O=new f.StoryException(m);throw O.useEndLineNumber=w,O}Warning(m){this.AddError(m,!0)}AddError(m,w=!1,O=!1){let N=this.currentDebugMetadata,x=w?"WARNING":"ERROR";if(N!=null){let D=O?N.endLineNumber:N.startLineNumber;m="RUNTIME "+x+": '"+N.fileName+"' line "+D+": "+m}else this.state.currentPointer.isNull?m="RUNTIME "+x+": "+m:m="RUNTIME "+x+": ("+this.state.currentPointer+"): "+m;this.state.AddError(m,w),w||this.state.ForceEnd()}Assert(m,w=null){if(m==!1)throw w==null&&(w="Story assert"),new Error(w+" "+this.currentDebugMetadata)}get currentDebugMetadata(){let m,w=this.state.currentPointer;if(!w.isNull&&w.Resolve()!==null&&(m=w.Resolve().debugMetadata,m!==null))return m;for(let O=this.state.callStack.elements.length-1;O>=0;--O)if(w=this.state.callStack.elements[O].currentPointer,!w.isNull&&w.Resolve()!==null&&(m=w.Resolve().debugMetadata,m!==null))return m;for(let O=this.state.outputStream.length-1;O>=0;--O)if(m=this.state.outputStream[O].debugMetadata,m!==null)return m;return null}get mainContentContainer(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}t.Story=Q,Q.inkVersionCurrent=20,function(ze){(function(m){m[m.NoChange=0]="NoChange",m[m.ExtendedBeyondNewline=1]="ExtendedBeyondNewline",m[m.NewlineRemoved=2]="NewlineRemoved"})(ze.OutputStateChange||(ze.OutputStateChange={}))}(Q=t.Story||(t.Story={}))})(Ts);Object.defineProperty(Nl,"__esModule",{value:!0});Nl.Story=void 0;const F_=$r,R_=zr,lo=Se,ao=Ue,wi=wh,uo=mt,Hf=qr,L_=Os,D_=Qr,V_=xs,W_=Ts,hr=qt,j_=Ht,M_=At,_i=K,$_=Qn,B_=Xn,G_=Jt;class Ll extends uo.FlowBase{constructor(e,n=!1){super(null,e,null,!1,n);this._errorHandler=null,this._hadError=!1,this._hadWarning=!1,this._dontFlattenContainers=new Set,this._listDefs=new Map,this.constants=new Map,this.externals=new Map,this.countAllVisits=!1,this.ExportRuntime=(r=null)=>{var i,s;this._errorHandler=r,this.constants=new Map;for(const h of this.FindAll(R_.ConstantDeclaration)()){const S=this.constants.get(h.constantName);if(S&&!(S.GenerateRuntimeObject()||{Equals:()=>!1}).Equals(h.expression)){const C=`CONST '${h.constantName}' has been redefined with a different value. Multiple definitions of the same CONST are valid so long as they contain the same value. Initial definition was on ${S.debugMetadata}.`;this.Error(C,h,!1)}this.constants.set(h.constantName,h.expression)}this._listDefs=new Map;for(const h of this.FindAll(D_.ListDefinition)())((i=h.identifier)===null||i===void 0?void 0:i.name)&&this._listDefs.set((s=h.identifier)===null||s===void 0?void 0:s.name,h);this.externals=new Map,this.ResolveWeavePointNaming();const o=this.runtimeObject,l=new lo.Container;l.AddContent(ao.ControlCommand.EvalStart());const a=[];for(const[h,S]of this.variableDeclarations)if(S.isGlobalDeclaration){if(S.listDefinition)this._listDefs.set(h,S.listDefinition),l.AddContent(S.listDefinition.runtimeObject),a.push(S.listDefinition.runtimeListDefinition);else{if(!S.expression)throw new Error;S.expression.GenerateIntoContainer(l)}const d=new M_.VariableAssignment(h,!0);d.isGlobal=!0,l.AddContent(d)}l.AddContent(ao.ControlCommand.EvalEnd()),l.AddContent(ao.ControlCommand.End()),this.variableDeclarations.size>0&&(l.name="global decl",o.AddToNamedContentOnly(l)),o.AddContent(ao.ControlCommand.Done());const u=new W_.Story(o,a);return this.runtimeObject=u,this.hadError||(this.FlattenContainersIn(o),this.ResolveReferences(this),this.hadError)?null:(u.ResetState(),u)},this.ResolveList=r=>{let i=this._listDefs.get(r);return i||null},this.ResolveListItem=(r,i,s=null)=>{let o=null;if(r)return(o=this._listDefs.get(r))?o.ItemNamed(i):null;{let l=null,a=null;for(const[u,h]of this._listDefs.entries()){const S=h.ItemNamed(i);S&&(l?this.Error(`Ambiguous item name '${i}' found in multiple sets, including ${a.identifier} and ${h.identifier}`,s,!1):(l=S,a=h))}return l}},this.FlattenContainersIn=r=>{const i=new Set;if(r.content)for(const s of r.content){const o=_i.asOrNull(s,lo.Container);o&&i.add(o)}if(r.namedContent)for(const[s,o]of r.namedContent){const l=_i.asOrNull(o,lo.Container);l&&i.add(l)}for(const s of i)this.TryFlattenContainer(s),this.FlattenContainersIn(s)},this.TryFlattenContainer=r=>{if(r.namedContent&&r.namedContent.size>0||r.hasValidName||this._dontFlattenContainers.has(r))return;const i=_i.asOrNull(r.parent,lo.Container);if(i){let s=i.content.indexOf(r);i.content.splice(s,1);const o=r.ownDebugMetadata;if(r.content)for(const l of r.content)l.parent=null,o!==null&&l.ownDebugMetadata===null&&(l.debugMetadata=o),i.InsertContent(l,s),s+=1}},this.Error=(r,i,s)=>{let o=s?wi.ErrorType.Warning:wi.ErrorType.Error,l="";if(i instanceof F_.AuthorWarning?(l+="TODO: ",o=wi.ErrorType.Author):s?l+="WARNING: ":l+="ERROR: ",i&&i.debugMetadata!==null&&i.debugMetadata.startLineNumber>=1&&(i.debugMetadata.fileName!=null&&(l+=`'${i.debugMetadata.fileName}' `),l+=`line ${i.debugMetadata.startLineNumber}: `),l+=r,r=l,this._errorHandler!==null)this._errorHandler(r,o);else throw new Error(r);this._hadError=o===wi.ErrorType.Error,this._hadWarning=o===wi.ErrorType.Warning},this.ResetError=()=>{this._hadError=!1,this._hadWarning=!1},this.IsExternal=r=>this.externals.has(r),this.AddExternal=r=>{this.externals.has(r.name)?this.Error(`Duplicate EXTERNAL definition of '${r.name}'`,r,!1):r.name&&this.externals.set(r.name,r)},this.DontFlattenContainer=r=>{this._dontFlattenContainers.add(r)},this.NameConflictError=(r,i,s,o)=>{r.Error(`${o} '${i}': name has already been used for a ${s.typeName.toLowerCase()} on ${s.debugMetadata}`)},this.CheckForNamingCollisions=(r,i,s,o="")=>{var l;const a=o||r.typeName;if(Ll.IsReservedKeyword(i==null?void 0:i.name)){r.Error(`'${i}' cannot be used for the name of a ${a.toLowerCase()} because it's a reserved keyword`);return}else if(B_.FunctionCall.IsBuiltIn((i==null?void 0:i.name)||"")){r.Error(`'${i}' cannot be used for the name of a ${a.toLowerCase()} because it's a built in function`);return}const u=this.ContentWithNameAtLevel((i==null?void 0:i.name)||"",Hf.FlowLevel.Knot),h=_i.asOrNull(u,uo.FlowBase);if(h&&(h!==r||s===hr.SymbolType.Arg)){this.NameConflictError(r,(i==null?void 0:i.name)||"",h,a);return}if(s<hr.SymbolType.List)return;for(const[E,T]of this._listDefs)if((i==null?void 0:i.name)===E&&r!==T&&T.variableAssignment!==r&&this.NameConflictError(r,i==null?void 0:i.name,T,a),!(r instanceof V_.ListElementDefinition))for(const p of T.itemDefinitions)(i==null?void 0:i.name)===p.name&&this.NameConflictError(r,(i==null?void 0:i.name)||"",p,a);if(s<=hr.SymbolType.Var)return;const S=(i==null?void 0:i.name)&&this.variableDeclarations.get(i==null?void 0:i.name)||null;if(S&&S!==r&&S.isGlobalDeclaration&&S.listDefinition==null&&this.NameConflictError(r,(i==null?void 0:i.name)||"",S,a),s<hr.SymbolType.SubFlowAndWeave)return;const C=new G_.Path(this.identifier).ResolveFromContext(r);if(C&&C!==r){this.NameConflictError(r,(i==null?void 0:i.name)||"",C,a);return}if(!(s<hr.SymbolType.Arg)&&s!==hr.SymbolType.Arg){let E=_i.asOrNull(r,uo.FlowBase);if(E||(E=$_.ClosestFlowBase(r)),E&&E.hasParameters&&E.args){for(const T of E.args)if(((l=T.identifier)===null||l===void 0?void 0:l.name)===(i==null?void 0:i.name)){r.Error(`${a} '${i}': Name has already been used for a argument to ${E.identifier} on ${E.debugMetadata}`);return}}}}}get flowLevel(){return Hf.FlowLevel.Story}get hadError(){return this._hadError}get hadWarning(){return this._hadWarning}get typeName(){return"Story"}PreProcessTopLevelObjects(e){super.PreProcessTopLevelObjects(e);const n=[];for(let r of e)if(r instanceof L_.IncludedFile){const i=r,s=e.indexOf(r);if(e.splice(s,1),i.includedStory){const o=[],l=i.includedStory;if(l.content!=null){for(const a of l.content)a instanceof uo.FlowBase?n.push(a):o.push(a);o.push(new j_.Text(`
`)),e.splice(s,0,...o)}}continue}e.splice(0,0,...n)}}Nl.Story=Ll;Ll.IsReservedKeyword=t=>{switch(t){case"true":case"false":case"not":case"return":case"else":case"VAR":case"CONST":case"temp":case"LIST":case"function":return!0}return!1};var Dl={};Object.defineProperty(Dl,"__esModule",{value:!0});Dl.StringExpression=void 0;const Kf=Ue,U_=Ye,z_=Ht,q_=K;class kh extends U_.Expression{constructor(e){super();this.GenerateIntoContainer=n=>{n.AddContent(Kf.ControlCommand.BeginString());for(const r of this.content)n.AddContent(r.runtimeObject);n.AddContent(Kf.ControlCommand.EndString())},this.toString=()=>{let n="";for(const r of this.content)n+=r;return n},this.Equals=n=>{const r=q_.asOrNull(n,kh);if(r===null||!this.isSingleString||!r.isSingleString)return!1;const i=this.toString(),s=r.toString();return i===s},this.AddContent(e)}get isSingleString(){return!(this.content.length!==1||!(this.content[0]instanceof z_.Text))}get typeName(){return"String"}}Dl.StringExpression=kh;var Vl={};Object.defineProperty(Vl,"__esModule",{value:!0});Vl.Tag=void 0;const H_=Ps;class K_ extends H_.Wrap{constructor(e){super(e)}get typeName(){return"Tag"}}Vl.Tag=K_;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.InkParser=t.ErrorType=void 0;const e=cl,n=$r,r=ps,i=dl,s=zn,o=qn,l=pl,a=Ur,u=vs,h=Jr,S=zr,d=nm,C=Cl,E=Jn,T=On,p=Ye,f=Sl,g=wl,y=Xn,P=Hr,F=_l,A=Xr,W=El,R=Os,k=Pl,z=Ol,Fe=xl,me=Qr,Q=xs,ze=Cs,m=ue,w=Jt,O=ys,N=Ss,x=xh,D=rm,b=Tl,V=Nl,$=Dl,J=Ph,ne=Vl,ve=Zn,Y=Ht,$e=ws,qe=_s,Qt=xn,ks=gs,et=K,Xt=Kr,Ft=Br;var er;(function(Yt){Yt[Yt.Author=0]="Author",Yt[Yt.Error=1]="Error",Yt[Yt.Warning=2]="Warning"})(er=t.ErrorType||(t.ErrorType={}));class re extends J.StringParser{constructor(X,he=null,Te=null,tr=null,Wl=null){super(X);if(this._filename=he,this._externalErrorHandler=Te,this._fileHandler=Wl,this.ParseStory=()=>{const c=this.StatementsAtLevel(D.StatementLevel.Top);return new V.Story(c,this._rootParser!==this)},this.SeparatedList=(c,v)=>{const _=this.Parse(c);if(_===null)return null;const I=[];I.push(_);do{const U=this.BeginRule();if(v()===null){this.FailRule(U);break}const ee=this.Parse(c);if(ee===null){this.FailRule(U);break}this.SucceedRule(U),I.push(ee)}while(!0);return I},this.CreateDebugMetadata=(c,v)=>{const _=new C.DebugMetadata;return _.startLineNumber=((c==null?void 0:c.lineIndex)||0)+1,_.endLineNumber=v.lineIndex+1,_.startCharacterNumber=((c==null?void 0:c.characterInLineIndex)||0)+1,_.endCharacterNumber=v.characterInLineIndex+1,_.fileName=this._filename,_},this.RuleDidSucceed=(c,v,_)=>{const I=et.asOrNull(c,m.ParsedObject);I&&(I.debugMetadata=this.CreateDebugMetadata(v,_));const U=Array.isArray(c)?c:null;if(U!==null)for(const ee of U)!et.asOrNull(ee,m.ParsedObject)||ee.hasOwnDebugMetadata||(ee.debugMetadata=this.CreateDebugMetadata(v,_));const G=et.asOrNull(c,Xt.Identifier);G!=null&&(G.debugMetadata=this.CreateDebugMetadata(v,_))},this.OnStringParserError=(c,v,_=0,I=!1)=>{let G=I?"WARNING:":"ERROR:";if(this._filename!==null&&(G+=` '${this._filename}'`),G+=` line ${_+1}: ${c}`,this._externalErrorHandler!==null)this._externalErrorHandler(G,I?er.Warning:er.Error);else throw new Error(G)},this.AuthorWarning=()=>{this.Whitespace();const c=this.Parse(this.IdentifierWithMetadata);if(c===null||c.name!=="TODO")return null;this.Whitespace(),this.ParseString(":"),this.Whitespace();const v=this.ParseUntilCharactersFromString(`
\r`);return v?new n.AuthorWarning(v):null},this.ExtendIdentifierCharacterRanges=c=>{const v=re.ListAllCharacterRanges();for(const _ of v)c.AddCharacters(_.ToCharacterSet())},this._parsingChoice=!1,this.Choice=()=>{let c=!0,v=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("*"));if(!v){if(v=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("+")),v===null)return null;c=!1}const _=this.Parse(this.BracketedName);this.Whitespace();const I=this.Parse(this.ChoiceCondition);if(this.Whitespace(),this._parsingChoice)throw new Error("Already parsing a choice - shouldn't have nested choices");this._parsingChoice=!0;let U=null;const G=this.Parse(this.MixedTextAndLogic);G&&(U=new h.ContentList(G));let ee=null,ie=null;const Rt=this.ParseString("[")!==null;if(Rt){const Yr=this.Parse(this.MixedTextAndLogic);Yr!==null&&(ee=new h.ContentList(Yr)),this.Expect(this.String("]"),"closing ']' for weave-style option");let Zr=this.Parse(this.MixedTextAndLogic);Zr!==null&&(ie=new h.ContentList(Zr))}this.Whitespace();const jl=this.Parse(this.MultiDivert);this._parsingChoice=!1,this.Whitespace();const Ah=!U&&!ie&&!ee;Ah&&jl===null&&this.Warning("Choice is completely empty. Interpretting as a default fallback choice. Add a divert arrow to remove this warning: * ->"),!U&&Rt&&!ee&&this.Warning("Blank choice - if you intended a default fallback choice, use the `* ->` syntax"),ie||(ie=new h.ContentList);const Fh=this.Parse(this.Tags);if(Fh!==null&&ie.AddContent(Fh),jl!==null)for(const Yr of jl){const Zr=et.asOrNull(Yr,E.Divert);Zr&&Zr.isEmpty||ie.AddContent(Yr)}ie.AddContent(new Y.Text(`
`));const Nn=new o.Choice(U,ee,ie);return _&&(Nn.identifier=_),Nn.indentationDepth=v.length,Nn.hasWeaveStyleInlineBrackets=Rt,Nn.condition=I,Nn.onceOnly=c,Nn.isInvisibleDefault=Ah,Nn},this.ChoiceCondition=()=>{const c=this.Interleave(this.ChoiceSingleCondition,this.ChoiceConditionsSpace);return c===null?null:c.length===1?c[0]:new ze.MultipleConditionExpression(c)},this.ChoiceConditionsSpace=()=>(this.Newline(),this.Whitespace(),J.ParseSuccess),this.ChoiceSingleCondition=()=>{if(this.ParseString("{")===null)return null;const c=this.Expect(this.Expression,"choice condition inside { }");return this.DisallowIncrement(c),this.Expect(this.String("}"),"closing '}' for choice condition"),c},this.Gather=()=>{const c=this.Parse(this.GatherDashes);if(c===null)return null;const v=Number(c),_=this.Parse(this.BracketedName),I=new P.Gather(_,v);return this.Newline(),I},this.GatherDashes=()=>{this.Whitespace();let c=0;for(;this.ParseDashNotArrow()!==null;)c+=1,this.Whitespace();return c===0?null:c},this.ParseDashNotArrow=()=>{const c=this.BeginRule();return this.ParseString("->")===null&&this.ParseSingleCharacter()==="-"?this.SucceedRule(c):this.FailRule(c)},this.BracketedName=()=>{if(this.ParseString("(")===null)return null;this.Whitespace();const c=this.Parse(this.IdentifierWithMetadata);return c===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing ')' for bracketed name"),c)},this.InnerConditionalContent=c=>{if(c===void 0){const G=this.Parse(this.ConditionExpression),ee=this.Parse(()=>this.InnerConditionalContent(G));return ee===null?null:ee}let v;const _=c!==null,I=this.Parse(this.Newline)===null;if(I&&!_)return null;if(I)v=this.InlineConditionalBranches();else{if(v=this.MultilineConditionalBranches(),v===null){if(c){let G=this.StatementsAtLevel(D.StatementLevel.InnerBlock);if(G!==null){v=[new u.ConditionalSingleBranch(G)];const ie=this.Parse(this.SingleMultilineCondition);ie&&(ie.isElse||(this.ErrorWithParsedObject("Expected an '- else:' clause here rather than an extra condition",ie),ie.isElse=!0),v.push(ie))}}if(v===null)return null}else if(v.length===1&&v[0].isElse&&c){const G=new u.ConditionalSingleBranch(null);G.isTrueBranch=!0,v.unshift(G)}if(c){let G=!1;for(let ee=0;ee<v.length;++ee){const ie=v[ee],Rt=ee===v.length-1;ie.ownExpression?(ie.matchingEquality=!0,G=!0):G&&Rt?(ie.matchingEquality=!0,ie.isElse=!0):!Rt&&v.length>2?this.ErrorWithParsedObject("Only final branch can be an 'else'. Did you miss a ':'?",ie):ee===0?ie.isTrueBranch=!0:ie.isElse=!0}}else{for(let G=0;G<v.length;++G){const ee=v[G],ie=G===v.length-1;if(ee.ownExpression===null)if(ie)ee.isElse=!0;else if(ee.isElse){const Rt=v[v.length-1];Rt.isElse?this.ErrorWithParsedObject("Multiple 'else' cases. Can have a maximum of one, at the end.",Rt):this.ErrorWithParsedObject("'else' case in conditional should always be the final one",ee)}else this.ErrorWithParsedObject("Branch doesn't have condition. Are you missing a ':'? ",ee)}v.length===1&&v[0].ownExpression===null&&this.ErrorWithParsedObject("Condition block with no conditions",v[0])}}if(v===null)return null;for(const G of v)G.isInline=I;return new a.Conditional(c,v)},this.InlineConditionalBranches=()=>{const c=this.Interleave(this.MixedTextAndLogic,this.Exclude(this.String("|")),null,!1);if(c===null||c.length===0)return null;const v=[];if(c.length>2)this.Error("Expected one or two alternatives separated by '|' in inline conditional");else{const _=new u.ConditionalSingleBranch(c[0]);if(_.isTrueBranch=!0,v.push(_),c.length>1){const I=new u.ConditionalSingleBranch(c[1]);I.isElse=!0,v.push(I)}}return v},this.MultilineConditionalBranches=()=>{this.MultilineWhitespace();const c=this.OneOrMore(this.SingleMultilineCondition);return c===null?null:(this.MultilineWhitespace(),c)},this.SingleMultilineCondition=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();let c=null;const v=this.Parse(this.ElseExpression)!==null;v||(c=this.Parse(this.ConditionExpression));let _=this.StatementsAtLevel(D.StatementLevel.InnerBlock);c===null&&_===null&&(this.Error("expected content for the conditional branch following '-'"),_=[new Y.Text("")]),this.MultilineWhitespace();const I=new u.ConditionalSingleBranch(_);return I.ownExpression=c,I.isElse=v,I},this.ConditionExpression=()=>{const c=this.Parse(this.Expression);return c===null||(this.DisallowIncrement(c),this.Whitespace(),this.ParseString(":")===null)?null:c},this.ElseExpression=()=>this.ParseString("else")===null||(this.Whitespace(),this.ParseString(":")===null)?null:J.ParseSuccess,this._nonTextPauseCharacters=null,this._nonTextEndCharacters=null,this._notTextEndCharactersChoice=null,this._notTextEndCharactersString=null,this.TrimEndWhitespace=(c,v)=>{if(c.length>0){const _=c.length-1,I=c[_];if(I instanceof Y.Text){const U=I;U.text=U.text.replace(new RegExp(/[ \t]+$/g),""),v?U.text+=" ":U.text.length===0&&(c.splice(_,1),this.TrimEndWhitespace(c,!1))}}},this.LineOfMixedTextAndLogic=()=>{this.Parse(this.Whitespace);let c=this.Parse(this.MixedTextAndLogic),v=!1;const _=this.Parse(this.Tags);if(_)if(!c)c=_,v=!0;else for(const G of _)c.push(G);if(!c||!c.length)return null;const I=c[0];return I&&I.text&&I.text.startsWith("return")&&this.Warning("Do you need a '~' before 'return'? If not, perhaps use a glue: <> (since it's lowercase) or rewrite somehow?"),c.length===0?null:(c[c.length-1]instanceof E.Divert||this.TrimEndWhitespace(c,!1),v||c.push(new Y.Text(`
`)),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),c)},this.MixedTextAndLogic=()=>{this.ParseObject(this.Spaced(this.String("~")))!==null&&this.Error("You shouldn't use a '~' here - tildas are for logic that's on its own line. To do inline logic, use { curly braces } instead");let v=this.Interleave(this.Optional(this.ContentText),this.Optional(this.InlineLogicOrGlue));if(!this._parsingChoice){const _=this.Parse(this.MultiDivert);_!==null&&(v===null&&(v=[]),this.TrimEndWhitespace(v,!0),v.push(..._))}return v||null},this.ContentText=()=>this.ContentTextAllowingEscapeChar(),this.ContentTextAllowingEscapeChar=()=>{let c=null;do{let v=this.Parse(this.ContentTextNoEscape);const _=this.ParseString("\\")!==null;if(_||v!==null)c===null&&(c=""),v!==null&&(c+=String(v)),_&&(c+=this.ParseSingleCharacter());else break}while(!0);return c!==null?new Y.Text(c):null},this.ContentTextNoEscape=()=>{this._nonTextPauseCharacters===null&&(this._nonTextPauseCharacters=new s.CharacterSet("-<")),this._nonTextEndCharacters===null&&(this._nonTextEndCharacters=new s.CharacterSet(`{}|
\r\\#`),this._notTextEndCharactersChoice=new s.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersChoice.AddCharacters("[]"),this._notTextEndCharactersString=new s.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersString.AddCharacters('"'));const c=()=>this.OneOf([this.ParseDivertArrow,this.ParseThreadArrow,this.EndOfLine,this.Glue]);let v=null;this.parsingStringExpression?v=this._notTextEndCharactersString:this._parsingChoice?v=this._notTextEndCharactersChoice:v=this._nonTextEndCharacters;const _=this.ParseUntil(c,this._nonTextPauseCharacters,v);return _!==null?_:null},this.MultiDivert=()=>{this.Whitespace();let c=[];const v=this.Parse(this.StartThread);if(v)return c=[v],c;const _=this.Interleave(this.ParseDivertArrowOrTunnelOnwards,this.DivertIdentifierWithArguments);if(!_)return null;c=[];for(let I=0;I<_.length;++I)if(I%2===0){if(_[I]==="->->"){I===0||I===_.length-1||I===_.length-2||this.Error("Tunnel onwards '->->' must only come at the begining or the start of a divert");const ee=new $e.TunnelOnwards;if(I<_.length-1){const ie=et.asOrNull(_[I+1],E.Divert);ee.divertAfter=ie}c.push(ee);break}}else{const G=_[I];I<_.length-1&&(G.isTunnel=!0),c.push(G)}if(c.length===0&&_.length===1){const I=new E.Divert(null);I.isEmpty=!0,c.push(I),this._parsingChoice||this.Error("Empty diverts (->) are only valid on choices")}return c},this.StartThread=()=>{if(this.Whitespace(),this.ParseThreadArrow()===null)return null;this.Whitespace();const c=this.Expect(this.DivertIdentifierWithArguments,"target for new thread",()=>new E.Divert(null));return c.isThread=!0,c},this.DivertIdentifierWithArguments=()=>{this.Whitespace();const c=this.Parse(this.DotSeparatedDivertPathComponents);if(!c)return null;this.Whitespace();const v=this.Parse(this.ExpressionFunctionCallArguments);this.Whitespace();const _=new w.Path(c);return new E.Divert(_,v)},this.SingleDivert=()=>{const c=this.Parse(this.MultiDivert);if(!c||c.length!==1||c[0]instanceof $e.TunnelOnwards)return null;const _=c[0];return _.isTunnel?null:_},this.DotSeparatedDivertPathComponents=()=>this.Interleave(this.Spaced(this.IdentifierWithMetadata),this.Exclude(this.String("."))),this.ParseDivertArrowOrTunnelOnwards=()=>{let c=0;for(;this.ParseString("->")!==null;)c+=1;return c===0?null:c===1?"->":(c===2||this.Error("Unexpected number of arrows in divert. Should only have '->' or '->->'"),"->->")},this.ParseDivertArrow=()=>this.ParseString("->"),this.ParseThreadArrow=()=>this.ParseString("<-"),this._binaryOperators=[],this._maxBinaryOpLength=0,this.TempDeclarationOrAssignment=()=>{this.Whitespace();const c=this.ParseTempKeyword();this.Whitespace();let v=null;if(c?v=this.Expect(this.IdentifierWithMetadata,"variable name"):v=this.Parse(this.IdentifierWithMetadata),v===null)return null;this.Whitespace();const _=this.ParseString("+")!==null,I=this.ParseString("-")!==null;if(_&&I&&this.Error("Unexpected sequence '+-'"),this.ParseString("=")===null)return c&&this.Error("Expected '='"),null;const U=this.Expect(this.Expression,"value expression to be assigned");return _||I?new W.IncDecExpression(v,U,_):new qe.VariableAssignment({variableIdentifier:v,assignedExpression:U,isTemporaryNewDeclaration:c})},this.DisallowIncrement=c=>{c instanceof W.IncDecExpression&&this.Error("Can't use increment/decrement here. It can only be used on a ~ line")},this.ParseTempKeyword=()=>{const c=this.BeginRule();return this.Parse(this.Identifier)==="temp"?(this.SucceedRule(c),!0):(this.FailRule(c),!1)},this.ReturnStatement=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="return")return null;this.Whitespace();const v=this.Parse(this.Expression);return new O.ReturnType(v)},this.Expression=(c=0)=>{this.Whitespace();let v=this.ExpressionUnary();if(v===null)return null;for(this.Whitespace();;){const _=this.BeginRule(),I=this.ParseInfixOperator();if(I!==null&&I.precedence>c){const U=`right side of '${I.type}' expression`,G=this.Expect(()=>this.ExpressionInfixRight(v,I),U);if(G===null)return this.FailRule(_),null;v=this.SucceedRule(_,G);continue}this.FailRule(_);break}return this.Whitespace(),v},this.ExpressionUnary=()=>{const c=this.Parse(this.ExpressionDivertTarget);if(c!==null)return c;let v=this.OneOf([this.String("-"),this.String("!")]);v===null&&(v=this.Parse(this.ExpressionNot)),this.Whitespace();let _=this.OneOf([this.ExpressionList,this.ExpressionParen,this.ExpressionFunctionCall,this.ExpressionVariableName,this.ExpressionLiteral]);if(_===null&&v!==null&&(_=this.ExpressionUnary()),_===null)return null;v!==null&&(_=ks.UnaryExpression.WithInner(_,v)),this.Whitespace();const I=this.OneOf([this.String("++"),this.String("--")]);if(I!==null){const U=I==="++";if(!(_ instanceof Qt.VariableReference))this.Error(`can only increment and decrement variables, but saw '${_}'.`);else{const G=_;_=new W.IncDecExpression(G.identifier,U)}}return _},this.ExpressionNot=()=>{const c=this.Identifier();return c==="not"?c:null},this.ExpressionLiteral=()=>this.OneOf([this.ExpressionFloat,this.ExpressionInt,this.ExpressionBool,this.ExpressionString]),this.ExpressionDivertTarget=()=>{this.Whitespace();const c=this.Parse(this.SingleDivert);return!c||c&&c.isThread?null:(this.Whitespace(),new T.DivertTarget(c))},this.ExpressionInt=()=>{const c=this.ParseInt();return c===null?null:new Ft.NumberExpression(c,"int")},this.ExpressionFloat=()=>{const c=this.ParseFloat();return c===null?null:new Ft.NumberExpression(c,"float")},this.ExpressionString=()=>{if(this.ParseString('"')===null)return null;this.parsingStringExpression=!0;let v=this.Parse(this.MixedTextAndLogic);return this.Expect(this.String('"'),"close quote for string expression"),this.parsingStringExpression=!1,v===null?v=[new Y.Text("")]:v.find(_=>_ instanceof E.Divert)&&this.Error("String expressions cannot contain diverts (->)"),new $.StringExpression(v)},this.ExpressionBool=()=>{const c=this.Parse(this.Identifier);return c==="true"?new Ft.NumberExpression(!0,"bool"):c==="false"?new Ft.NumberExpression(!1,"bool"):null},this.ExpressionFunctionCall=()=>{const c=this.Parse(this.IdentifierWithMetadata);if(c===null)return null;this.Whitespace();const v=this.Parse(this.ExpressionFunctionCallArguments);return v===null?null:new y.FunctionCall(c,v)},this.ExpressionFunctionCallArguments=()=>{if(this.ParseString("(")===null)return null;const c=this.Exclude(this.String(","));let v=this.Interleave(this.Expression,c);return v===null&&(v=[]),this.Whitespace(),this.Expect(this.String(")"),"closing ')' for function call"),v},this.ExpressionVariableName=()=>{const c=this.Interleave(this.IdentifierWithMetadata,this.Exclude(this.Spaced(this.String("."))));return c===null||V.Story.IsReservedKeyword(c[0].name)?null:new Qt.VariableReference(c)},this.ExpressionParen=()=>{if(this.ParseString("(")===null)return null;const c=this.Parse(this.Expression);return c===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing parenthesis ')' for expression"),c)},this.ExpressionInfixRight=(c,v)=>{if(!c)return null;this.Whitespace();const _=this.Parse(()=>this.Expression(v.precedence));return _?new r.BinaryExpression(c,_,v.type):null},this.ParseInfixOperator=()=>{for(const c of this._binaryOperators){const v=this.BeginRule();if(this.ParseString(c.type)!==null){if(c.requireWhitespace&&this.Whitespace()===null){this.FailRule(v);continue}return this.SucceedRule(v,c)}this.FailRule(v)}return null},this.ExpressionList=()=>{if(this.Whitespace(),this.ParseString("(")===null)return null;this.Whitespace();const c=this.SeparatedList(this.ListMember,this.Spaced(this.String(",")));return this.Whitespace(),this.ParseString(")")===null?null:new Fe.List(c)},this.ListMember=()=>{this.Whitespace();let c=this.Parse(this.IdentifierWithMetadata);if(c===null)return null;if(this.ParseString(".")!==null){const _=this.Expect(this.IdentifierWithMetadata,`element name within the set ${c}`);c.name+=`.${_==null?void 0:_.name}`}return this.Whitespace(),c},this.RegisterExpressionOperators=()=>{this.RegisterBinaryOperator("&&",1),this.RegisterBinaryOperator("||",1),this.RegisterBinaryOperator("and",1,!0),this.RegisterBinaryOperator("or",1,!0),this.RegisterBinaryOperator("==",2),this.RegisterBinaryOperator(">=",2),this.RegisterBinaryOperator("<=",2),this.RegisterBinaryOperator("<",2),this.RegisterBinaryOperator(">",2),this.RegisterBinaryOperator("!=",2),this.RegisterBinaryOperator("?",3),this.RegisterBinaryOperator("has",3,!0),this.RegisterBinaryOperator("!?",3),this.RegisterBinaryOperator("hasnt",3,!0),this.RegisterBinaryOperator("^",3),this.RegisterBinaryOperator("+",4),this.RegisterBinaryOperator("-",5),this.RegisterBinaryOperator("*",6),this.RegisterBinaryOperator("/",7),this.RegisterBinaryOperator("%",8),this.RegisterBinaryOperator("mod",8,!0)},this.RegisterBinaryOperator=(c,v,_=!1)=>{const I=new k.InfixOperator(c,v,_);this._binaryOperators.push(I),this._maxBinaryOpLength=Math.max(this._maxBinaryOpLength,c.length)},this._openFilenames=[],this.IncludeStatement=()=>{if(this.Whitespace(),this.ParseString("INCLUDE")===null)return null;this.Whitespace();let c=this.Expect(()=>this.ParseUntilCharactersFromString(`
\r`),"filename for include statement");c=c.replace(new RegExp(/[ \t]+$/g),"");const v=this.fileHandler.ResolveInkFilename(c);if(this.FilenameIsAlreadyOpen(v))return this.Error(`Recursive INCLUDE detected: '${v}' is already open.`),this.ParseUntilCharactersFromString(`\r
`),new R.IncludedFile(null);this.AddOpenFilename(v);let _=null,I="";try{I=this._rootParser.fileHandler.LoadInkFileContents(v)}catch(U){this.Error(`Failed to load: '${c}'.
Error:${U}`)}return I&&(_=new re(I,c,this._externalErrorHandler,this._rootParser,this.fileHandler).ParseStory()),this.RemoveOpenFilename(v),new R.IncludedFile(_)},this.FilenameIsAlreadyOpen=c=>this._rootParser._openFilenames.includes(c),this.AddOpenFilename=c=>{this._rootParser._openFilenames.push(c)},this.RemoveOpenFilename=c=>{this._rootParser._openFilenames.splice(this._rootParser._openFilenames.indexOf(c),1)},this.KnotDefinition=()=>{const c=this.Parse(this.KnotDeclaration);if(c===null)return null;this.Expect(this.EndOfLine,"end of line after knot name definition",this.SkipToNextLine);const v=()=>this.StatementsAtLevel(D.StatementLevel.Knot),_=this.Expect(v,"at least one line within the knot",this.KnotStitchNoContentRecoveryRule);return new z.Knot(c.name,_,c.args,c.isFunction)},this.KnotDeclaration=()=>{if(this.Whitespace(),this.KnotTitleEquals()===null)return null;this.Whitespace();const c=this.Parse(this.IdentifierWithMetadata);let v;const _=(c==null?void 0:c.name)==="function";_?(this.Expect(this.Whitespace,"whitespace after the 'function' keyword"),v=this.Parse(this.IdentifierWithMetadata)):v=c,v===null&&(this.Error(`Expected the name of the ${_?"function":"knot"}`),v=new Xt.Identifier("")),this.Whitespace();const I=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),this.Parse(this.KnotTitleEquals),new g.FlowDecl(v,I,_)},this.KnotTitleEquals=()=>{const c=this.ParseCharactersFromString("=");return c===null||c.length<=1?null:c},this.StitchDefinition=()=>{const c=this.Parse(this.StitchDeclaration);if(c===null)return null;this.Expect(this.EndOfLine,"end of line after stitch name",this.SkipToNextLine);const v=()=>this.StatementsAtLevel(D.StatementLevel.Stitch),_=this.Expect(v,"at least one line within the stitch",this.KnotStitchNoContentRecoveryRule);return new b.Stitch(c.name,_,c.args,c.isFunction)},this.StitchDeclaration=()=>{if(this.Whitespace(),this.ParseString("=")===null||this.ParseString("=")!==null)return null;this.Whitespace();const c=this.ParseString("function")!==null;c&&this.Whitespace();const v=this.Parse(this.IdentifierWithMetadata);if(v===null)return null;this.Whitespace();const _=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),new g.FlowDecl(v,_,c)},this.KnotStitchNoContentRecoveryRule=()=>(this.ParseUntil(this.KnotDeclaration,new s.CharacterSet("="),null),[new Y.Text("<ERROR IN FLOW>")]),this.BracketedKnotDeclArguments=()=>{if(this.ParseString("(")===null)return null;let c=this.Interleave(this.Spaced(this.FlowDeclArgument),this.Exclude(this.String(",")));return this.Expect(this.String(")"),"closing ')' for parameter list"),c===null&&(c=[]),c},this.FlowDeclArgument=()=>{const c=this.Parse(this.IdentifierWithMetadata);this.Whitespace();const v=this.ParseDivertArrow();this.Whitespace();const _=this.Parse(this.IdentifierWithMetadata);if(c==null&&_===null)return null;const I=new e.Argument;return v!==null&&(I.isDivertTarget=!0),c!==null&&c.name==="ref"?(_===null&&this.Error("Expected an parameter name after 'ref'"),I.identifier=_,I.isByReference=!0):(I.isDivertTarget?I.identifier=_:I.identifier=c,I.identifier===null&&this.Error("Expected an parameter name"),I.isByReference=!1),I},this.ExternalDeclaration=()=>{this.Whitespace();const c=this.Parse(this.IdentifierWithMetadata);if(c===null||c.name!="EXTERNAL")return null;this.Whitespace();const v=this.Expect(this.IdentifierWithMetadata,"name of external function")||new Xt.Identifier("");this.Whitespace();let _=this.Expect(this.BracketedKnotDeclArguments,`declaration of arguments for EXTERNAL, even if empty, i.e. 'EXTERNAL ${v}()'`);_===null&&(_=[]);const I=_.map(U=>{var G;return(G=U.identifier)===null||G===void 0?void 0:G.name}).filter(et.filterUndef);return new f.ExternalDeclaration(v,I)},this._identifierCharSet=null,this.LogicLine=()=>{if(this.Whitespace(),this.ParseString("~")===null)return null;this.Whitespace();const c=()=>this.OneOf([this.ReturnStatement,this.TempDeclarationOrAssignment,this.Expression]);let v=this.Expect(c,"expression after '~'",this.SkipToNextLine);if(v===null)return new h.ContentList;v instanceof p.Expression&&!(v instanceof y.FunctionCall||v instanceof W.IncDecExpression)&&this.Error(`Logic following a '~' can't be that type of expression. It can only be something like:
	~ return
	~ var x = blah
	~ x++
	~ myFunction()`);const _=et.asOrNull(v,y.FunctionCall);return _&&(_.shouldPopReturnedValue=!0),v.Find(y.FunctionCall)()!==null&&(v=new h.ContentList(v,new Y.Text(`
`))),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),v},this.VariableDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="VAR")return null;this.Whitespace();const v=this.Expect(this.IdentifierWithMetadata,"variable name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const I=this.Expect(this.Expression,"initial value for ");return I?(I instanceof Ft.NumberExpression||I instanceof $.StringExpression||I instanceof T.DivertTarget||I instanceof Qt.VariableReference||I instanceof Fe.List||this.Error("initial value for a variable must be a number, constant, list or divert target"),this.Parse(this.ListElementDefinitionSeparator)!==null?this.Error("Unexpected ','. If you're trying to declare a new list, use the LIST keyword, not VAR"):I instanceof $.StringExpression&&(I.isSingleString||this.Error("Constant strings cannot contain any logic.")),new qe.VariableAssignment({assignedExpression:I,isGlobalDeclaration:!0,variableIdentifier:v})):null},this.ListDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!="LIST")return null;this.Whitespace();const v=this.Expect(this.IdentifierWithMetadata,"list name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of the list definition"),this.Whitespace();const _=this.Expect(this.ListDefinition,"list item names");return _?(_.identifier=new Xt.Identifier(v.name),new qe.VariableAssignment({variableIdentifier:v,listDef:_})):null},this.ListDefinition=()=>{this.AnyWhitespace();const c=this.SeparatedList(this.ListElementDefinition,this.ListElementDefinitionSeparator);return c===null?null:new me.ListDefinition(c)},this.ListElementDefinitionSeparator=()=>(this.AnyWhitespace(),this.ParseString(",")===null?null:(this.AnyWhitespace(),",")),this.ListElementDefinition=()=>{const c=this.ParseString("(")!==null;let v=c;this.Whitespace();const _=this.Parse(this.IdentifierWithMetadata);if(_===null)return null;this.Whitespace(),c&&this.ParseString(")")!=null&&(v=!1,this.Whitespace());let I=null;if(this.ParseString("=")!==null){this.Whitespace();const U=this.Expect(this.ExpressionInt,"value to be assigned to list item");U!==null&&(I=U.value),v&&(this.Whitespace(),this.ParseString(")")!==null&&(v=!1))}return v&&this.Error("Expected closing ')'"),new Q.ListElementDefinition(_,c,I)},this.ConstDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="CONST")return null;this.Whitespace();const v=this.Expect(this.IdentifierWithMetadata,"constant name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const _=this.Expect(this.Expression,"initial value for ");return _ instanceof Ft.NumberExpression||_ instanceof T.DivertTarget||_ instanceof $.StringExpression?_ instanceof $.StringExpression&&(_.isSingleString||this.Error("Constant strings cannot contain any logic.")):this.Error("initial value for a constant must be a number or divert target"),new S.ConstantDeclaration(v,_)},this.InlineLogicOrGlue=()=>this.OneOf([this.InlineLogic,this.Glue]),this.Glue=()=>this.ParseString("<>")!==null?new F.Glue(new A.Glue):null,this.InlineLogic=()=>{if(this.ParseString("{")===null)return null;this.Whitespace();const c=this.Expect(this.InnerLogic,"some kind of logic, conditional or sequence within braces: { ... }");if(c===null)return null;this.DisallowIncrement(c);let v=et.asOrNull(c,h.ContentList);return v||(v=new h.ContentList(c)),this.Whitespace(),this.Expect(this.String("}"),"closing brace '}' for inline logic"),v},this.InnerLogic=()=>{this.Whitespace();const c=this.ParseObject(this.SequenceTypeAnnotation);if(c!==null){const I=this.Expect(this.InnerSequenceObjects,"sequence elements (for cycle/stoping etc)");return I===null?null:new N.Sequence(I,c)}const v=this.Parse(this.ConditionExpression);if(v)return this.Expect(()=>this.InnerConditionalContent(v),"conditional content following query");const _=[this.InnerConditionalContent,this.InnerSequence,this.InnerExpression];for(const I of _){const U=this.BeginRule(),G=this.ParseObject(I);if(G)if(this.Peek(this.Spaced(this.String("}")))===null)this.FailRule(U);else return this.SucceedRule(U,G);else this.FailRule(U)}return null},this.InnerExpression=()=>{const c=this.Parse(this.Expression);return c&&(c.outputWhenComplete=!0),c},this.IdentifierWithMetadata=()=>{const c=this.Identifier();return c===null?null:new Xt.Identifier(c)},this.Identifier=()=>{const c=this.ParseCharactersFromCharSet(this.identifierCharSet);if(c===null)return null;let v=!0;for(let _ of c)if(!(_>="0"&&_<="9")){v=!1;break}return v?null:c},this._sequenceTypeSymbols=new s.CharacterSet("!&~$"),this.InnerSequence=()=>{this.Whitespace();let c=x.SequenceType.Stopping;const v=this.Parse(this.SequenceTypeAnnotation);v!==null&&(c=v);const _=this.Parse(this.InnerSequenceObjects);return _===null||_.length<=1?null:new N.Sequence(_,c)},this.SequenceTypeAnnotation=()=>{let c=this.Parse(this.SequenceTypeSymbolAnnotation);if(c===null&&(c=this.Parse(this.SequenceTypeWordAnnotation)),c===null)return null;switch(c){case x.SequenceType.Once:case x.SequenceType.Cycle:case x.SequenceType.Stopping:case x.SequenceType.Shuffle:case x.SequenceType.Shuffle|x.SequenceType.Stopping:case x.SequenceType.Shuffle|x.SequenceType.Once:break;default:return this.Error(`Sequence type combination not supported: ${c}`),x.SequenceType.Stopping}return c},this.SequenceTypeSymbolAnnotation=()=>{this._sequenceTypeSymbols===null&&(this._sequenceTypeSymbols=new s.CharacterSet("!&~$ "));let c=0;const v=this.ParseCharactersFromCharSet(this._sequenceTypeSymbols);if(v===null)return null;for(const _ of v)switch(_){case"!":c|=x.SequenceType.Once;break;case"&":c|=x.SequenceType.Cycle;break;case"~":c|=x.SequenceType.Shuffle;break;case"$":c|=x.SequenceType.Stopping;break}return c===0?null:c},this.SequenceTypeWordAnnotation=()=>{const c=this.Interleave(this.SequenceTypeSingleWord,this.Exclude(this.Whitespace));if(c===null||c.length===0||this.ParseString(":")===null)return null;let v=0;for(const _ of c)v|=_;return v},this.SequenceTypeSingleWord=()=>{let c=null;const v=this.Parse(this.IdentifierWithMetadata);if(v!==null)switch(v.name){case"once":c=x.SequenceType.Once;break;case"cycle":c=x.SequenceType.Cycle;break;case"shuffle":c=x.SequenceType.Shuffle;break;case"stopping":c=x.SequenceType.Stopping;break}return c===null?null:c},this.InnerSequenceObjects=()=>{const c=this.Parse(this.Newline)!==null;let v=null;return c?v=this.Parse(this.InnerMultilineSequenceObjects):v=this.Parse(this.InnerInlineSequenceObjects),v},this.InnerInlineSequenceObjects=()=>{const c=this.Interleave(this.Optional(this.MixedTextAndLogic),this.String("|"),null,!1);if(c===null)return null;const v=[];let _=!1;for(const I of c)if(I==="|")_||v.push(new h.ContentList),_=!1;else{const U=I;U===null?this.Error(`Expected content, but got ${I} (this is an ink compiler bug!)`):v.push(new h.ContentList(U)),_=!0}return _||v.push(new h.ContentList),v},this.InnerMultilineSequenceObjects=()=>{this.MultilineWhitespace();const c=this.OneOrMore(this.SingleMultilineSequenceElement);return c===null?null:c},this.SingleMultilineSequenceElement=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();const c=this.StatementsAtLevel(D.StatementLevel.InnerBlock);return c===null?this.MultilineWhitespace():c.unshift(new Y.Text(`
`)),new h.ContentList(c)},this._statementRulesAtLevel=[],this._statementBreakRulesAtLevel=[],this.StatementsAtLevel=c=>(c===D.StatementLevel.InnerBlock&&this.Parse(this.GatherDashes)!==null&&this.Error("You can't use a gather (the dashes) within the { curly braces } context. For multi-line sequences and conditions, you should only use one dash."),this.Interleave(this.Optional(this.MultilineWhitespace),()=>this.StatementAtLevel(c),()=>this.StatementsBreakForLevel(c))),this.StatementAtLevel=c=>{const v=this._statementRulesAtLevel[c],_=this.OneOf(v);return c===D.StatementLevel.Top&&_ instanceof O.ReturnType&&this.Error("should not have return statement outside of a knot"),_},this.StatementsBreakForLevel=c=>{this.Whitespace();const v=this._statementBreakRulesAtLevel[c],_=this.OneOf(v);return _===null?null:_},this.GenerateStatementLevelRules=()=>{const c=Object.values(D.StatementLevel);this._statementRulesAtLevel="f".repeat(c.length).split("f").map(()=>[]),this._statementBreakRulesAtLevel="f".repeat(c.length).split("f").map(()=>[]);for(const v of c){const _=[],I=[];_.push(this.Line(this.MultiDivert)),v>=D.StatementLevel.Top&&_.push(this.KnotDefinition),_.push(this.Line(this.Choice)),_.push(this.Line(this.AuthorWarning)),v>D.StatementLevel.InnerBlock&&_.push(this.Gather),v>=D.StatementLevel.Knot&&_.push(this.StitchDefinition),_.push(this.Line(this.ListDeclaration)),_.push(this.Line(this.VariableDeclaration)),_.push(this.Line(this.ConstDeclaration)),_.push(this.Line(this.ExternalDeclaration)),_.push(this.Line(this.IncludeStatement)),_.push(this.LogicLine),_.push(this.LineOfMixedTextAndLogic),v<=D.StatementLevel.Knot&&I.push(this.KnotDeclaration),v<=D.StatementLevel.Stitch&&I.push(this.StitchDeclaration),v<=D.StatementLevel.InnerBlock&&(I.push(this.ParseDashNotArrow),I.push(this.String("}"))),this._statementRulesAtLevel[v]=_,this._statementBreakRulesAtLevel[v]=I}},this.SkipToNextLine=()=>(this.ParseUntilCharactersFromString(`
\r`),this.ParseNewline(),J.ParseSuccess),this.Line=c=>()=>{const v=this.ParseObject(c);return v===null?null:(this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),v)},this._endOfTagCharSet=new s.CharacterSet(`#
\r\\`),this.Tag=()=>{if(this.Whitespace(),this.ParseString("#")===null)return null;this.Whitespace();let c="";do{if(c+=this.ParseUntilCharactersFromCharSet(this._endOfTagCharSet)||"",this.ParseString("\\")!==null){const I=this.ParseSingleCharacter();I!=="\0"&&(c+=I);continue}break}while(!0);const v=c.trim();return new ne.Tag(new ve.Tag(v))},this.Tags=()=>{const c=this.OneOrMore(this.Tag);return c===null?null:c},this._inlineWhitespaceChars=new s.CharacterSet(" 	"),this.EndOfLine=()=>this.OneOf([this.Newline,this.EndOfFile]),this.Newline=()=>(this.Whitespace(),this.ParseNewline()!==null?J.ParseSuccess:null),this.EndOfFile=()=>(this.Whitespace(),this.endOfInput?J.ParseSuccess:null),this.MultilineWhitespace=()=>{let c=this.OneOrMore(this.Newline);return c===null?null:c.length>=1?J.ParseSuccess:null},this.Whitespace=()=>this.ParseCharactersFromCharSet(this._inlineWhitespaceChars)!==null?J.ParseSuccess:null,this.Spaced=c=>()=>{this.Whitespace();const v=this.ParseObject(c);return v===null?null:(this.Whitespace(),v)},this.AnyWhitespace=()=>{let c=!1;for(;this.OneOf([this.Whitespace,this.MultilineWhitespace])!==null;)c=!0;return c?J.ParseSuccess:null},this.MultiSpaced=c=>()=>{this.AnyWhitespace();const v=this.ParseObject(c);return v===null?null:(this.AnyWhitespace(),v)},this.RegisterExpressionOperators(),this.GenerateStatementLevelRules(),this.errorHandler=this.OnStringParserError,tr===null){if(this._rootParser=this,this._openFilenames=[],this._filename!==null){const c=this.fileHandler.ResolveInkFilename(this._filename);this._openFilenames.push(c)}}else this._rootParser=tr}get fileHandler(){if(!this._fileHandler)throw new Error("No FileHandler defined");return this._fileHandler}set fileHandler(X){this._fileHandler=X}PreProcessInputString(X){return new l.CommentEliminator(X).Process()}get parsingStringExpression(){return this.GetFlag(Number(d.CustomFlags.ParsingString))}set parsingStringExpression(X){this.SetFlag(Number(d.CustomFlags.ParsingString),X)}get identifierCharSet(){return this._identifierCharSet===null&&((this._identifierCharSet=new s.CharacterSet).AddRange("A","Z").AddRange("a","z").AddRange("0","9").Add("_"),this.ExtendIdentifierCharacterRanges(this._identifierCharSet)),this._identifierCharSet}}t.InkParser=re,re.LatinBasic=i.CharacterRange.Define("A","z",new s.CharacterSet().AddRange("[","`")),re.LatinExtendedA=i.CharacterRange.Define("\u0100","\u017F"),re.LatinExtendedB=i.CharacterRange.Define("\u0180","\u024F"),re.Greek=i.CharacterRange.Define("\u0370","\u03FF",new s.CharacterSet().AddRange("\u0378","\u0385").AddCharacters("\u0374\u0375\u0378\u0387\u038B\u038D\u03A2")),re.Cyrillic=i.CharacterRange.Define("\u0400","\u04FF",new s.CharacterSet().AddRange("\u0482","\u0489")),re.Armenian=i.CharacterRange.Define("\u0530","\u058F",new s.CharacterSet().AddCharacters("\u0530").AddRange("\u0557","\u0560").AddRange("\u0588","\u058E")),re.Hebrew=i.CharacterRange.Define("\u0590","\u05FF",new s.CharacterSet),re.Arabic=i.CharacterRange.Define("\u0600","\u06FF",new s.CharacterSet),re.Korean=i.CharacterRange.Define("\uAC00","\uD7AF",new s.CharacterSet),re.ListAllCharacterRanges=()=>[re.LatinBasic,re.LatinExtendedA,re.LatinExtendedB,re.Arabic,re.Armenian,re.Cyrillic,re.Greek,re.Hebrew,re.Korean]})(Yp);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Compiler=t.Story=t.InkList=t.CompilerOptions=void 0;const e=is,n=hl,r=wh,i=Yp,s=fe,o=K;var l=is;Object.defineProperty(t,"CompilerOptions",{enumerable:!0,get:function(){return l.CompilerOptions}});var a=Ts;Object.defineProperty(t,"InkList",{enumerable:!0,get:function(){return a.InkList}}),Object.defineProperty(t,"Story",{enumerable:!0,get:function(){return a.Story}});class u{constructor(S,d=null){this._errors=[],this._warnings=[],this._authorMessages=[],this._parsedStory=null,this._runtimeStory=null,this._parser=null,this._debugSourceRanges=[],this.Compile=()=>(this._parser=new i.InkParser(this.inputString,this.options.sourceFilename||null,this.OnError,null,this.options.fileHandler),this._parsedStory=this.parser.ParseStory(),this.errors.length===0?(this.parsedStory.countAllVisits=this.options.countAllVisits,this._runtimeStory=this.parsedStory.ExportRuntime(this.OnError)):this._runtimeStory=null,this.runtimeStory),this.RetrieveDebugSourceForLatestContent=()=>{var C;for(const E of this.runtimeStory.state.outputStream){const T=o.asOrNull(E,s.StringValue);if(T!==null){const p=new n.DebugSourceRange(((C=T.value)===null||C===void 0?void 0:C.length)||0,T.debugMetadata,T.value||"unknown");this.debugSourceRanges.push(p)}}},this.DebugMetadataForContentAtOffset=C=>{let E=0,T=null;for(const p of this.debugSourceRanges){if(p.debugMetadata!==null&&(T=p.debugMetadata),C>=E&&C<E+p.length)return T;E+=p.length}return null},this.OnError=(C,E)=>{switch(E){case r.ErrorType.Author:this._authorMessages.push(C);break;case r.ErrorType.Warning:this._warnings.push(C);break;case r.ErrorType.Error:this._errors.push(C);break}this.options.errorHandler!==null&&this.options.errorHandler(C,E)},this._inputString=S,this._options=d||new e.CompilerOptions}get errors(){return this._errors}get warnings(){return this._warnings}get authorMessages(){return this._authorMessages}get inputString(){return this._inputString}get options(){return this._options}get parsedStory(){if(!this._parsedStory)throw new Error;return this._parsedStory}get runtimeStory(){if(!this._runtimeStory)throw new Error("Compilation failed.");return this._runtimeStory}get parser(){if(!this._parser)throw new Error;return this._parser}get debugSourceRanges(){return this._debugSourceRanges}}t.Compiler=u})(py);export{py as C,Q_ as R,X_ as a,co as b,Z_ as i,fy as j,oe as r,Y_ as u};
