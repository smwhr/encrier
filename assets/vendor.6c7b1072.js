var xm=Object.defineProperty,Tm=Object.defineProperties;var Nm=Object.getOwnPropertyDescriptors;var Uh=Object.getOwnPropertySymbols;var bm=Object.prototype.hasOwnProperty,Im=Object.prototype.propertyIsEnumerable;var zh=(t,e,n)=>e in t?xm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,qr=(t,e)=>{for(var n in e||(e={}))bm.call(e,n)&&zh(t,n,e[n]);if(Uh)for(var n of Uh(e))Im.call(e,n)&&zh(t,n,e[n]);return t},qh=(t,e)=>Tm(t,Nm(e));var J={exports:{}},U={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Hh=Object.getOwnPropertySymbols,km=Object.prototype.hasOwnProperty,Am=Object.prototype.propertyIsEnumerable;function Fm(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function Rm(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map(function(o){return e[o]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(o){i[o]=o}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var md=Rm()?Object.assign:function(t,e){for(var n,r=Fm(t),i,o=1;o<arguments.length;o++){n=Object(arguments[o]);for(var s in n)km.call(n,s)&&(r[s]=n[s]);if(Hh){i=Hh(n);for(var l=0;l<i.length;l++)Am.call(n,i[l])&&(r[i[l]]=n[i[l]])}}return r};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nu=md,Tr=60103,gd=60106;U.Fragment=60107;U.StrictMode=60108;U.Profiler=60114;var vd=60109,yd=60110,Cd=60112;U.Suspense=60113;var Sd=60115,wd=60116;if(typeof Symbol=="function"&&Symbol.for){var ht=Symbol.for;Tr=ht("react.element"),gd=ht("react.portal"),U.Fragment=ht("react.fragment"),U.StrictMode=ht("react.strict_mode"),U.Profiler=ht("react.profiler"),vd=ht("react.provider"),yd=ht("react.context"),Cd=ht("react.forward_ref"),U.Suspense=ht("react.suspense"),Sd=ht("react.memo"),wd=ht("react.lazy")}var Kh=typeof Symbol=="function"&&Symbol.iterator;function Lm(t){return t===null||typeof t!="object"?null:(t=Kh&&t[Kh]||t["@@iterator"],typeof t=="function"?t:null)}function ts(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ed={};function Nr(t,e,n){this.props=t,this.context=e,this.refs=Ed,this.updater=n||_d}Nr.prototype.isReactComponent={};Nr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(ts(85));this.updater.enqueueSetState(this,t,e,"setState")};Nr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Pd(){}Pd.prototype=Nr.prototype;function bu(t,e,n){this.props=t,this.context=e,this.refs=Ed,this.updater=n||_d}var Iu=bu.prototype=new Pd;Iu.constructor=bu;Nu(Iu,Nr.prototype);Iu.isPureReactComponent=!0;var ku={current:null},Od=Object.prototype.hasOwnProperty,xd={key:!0,ref:!0,__self:!0,__source:!0};function Td(t,e,n){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)Od.call(e,r)&&!xd.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){for(var a=Array(l),u=0;u<l;u++)a[u]=arguments[u+2];i.children=a}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:Tr,type:t,key:o,ref:s,props:i,_owner:ku.current}}function Dm(t,e){return{$$typeof:Tr,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Au(t){return typeof t=="object"&&t!==null&&t.$$typeof===Tr}function Vm(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Jh=/\/+/g;function Bl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Vm(""+t.key):e.toString(36)}function uo(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case Tr:case gd:s=!0}}if(s)return s=t,i=i(s),t=r===""?"."+Bl(s,0):r,Array.isArray(i)?(n="",t!=null&&(n=t.replace(Jh,"$&/")+"/"),uo(i,e,n,"",function(u){return u})):i!=null&&(Au(i)&&(i=Dm(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(Jh,"$&/")+"/")+t)),e.push(i)),1;if(s=0,r=r===""?".":r+":",Array.isArray(t))for(var l=0;l<t.length;l++){o=t[l];var a=r+Bl(o,l);s+=uo(o,e,n,a,i)}else if(a=Lm(t),typeof a=="function")for(t=a.call(t),l=0;!(o=t.next()).done;)o=o.value,a=r+Bl(o,l++),s+=uo(o,e,n,a,i);else if(o==="object")throw e=""+t,Error(ts(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e));return s}function bs(t,e,n){if(t==null)return t;var r=[],i=0;return uo(t,r,"","",function(o){return e.call(n,o,i++)}),r}function Wm(t){if(t._status===-1){var e=t._result;e=e(),t._status=0,t._result=e,e.then(function(n){t._status===0&&(n=n.default,t._status=1,t._result=n)},function(n){t._status===0&&(t._status=2,t._result=n)})}if(t._status===1)return t._result;throw t._result}var Nd={current:null};function Wt(){var t=Nd.current;if(t===null)throw Error(ts(321));return t}var jm={ReactCurrentDispatcher:Nd,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:ku,IsSomeRendererActing:{current:!1},assign:Nu};U.Children={map:bs,forEach:function(t,e,n){bs(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return bs(t,function(){e++}),e},toArray:function(t){return bs(t,function(e){return e})||[]},only:function(t){if(!Au(t))throw Error(ts(143));return t}};U.Component=Nr;U.PureComponent=bu;U.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jm;U.cloneElement=function(t,e,n){if(t==null)throw Error(ts(267,t));var r=Nu({},t.props),i=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=ku.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(a in e)Od.call(e,a)&&!xd.hasOwnProperty(a)&&(r[a]=e[a]===void 0&&l!==void 0?l[a]:e[a])}var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){l=Array(a);for(var u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:Tr,type:t.type,key:i,ref:o,props:r,_owner:s}};U.createContext=function(t,e){return e===void 0&&(e=null),t={$$typeof:yd,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:vd,_context:t},t.Consumer=t};U.createElement=Td;U.createFactory=function(t){var e=Td.bind(null,t);return e.type=t,e};U.createRef=function(){return{current:null}};U.forwardRef=function(t){return{$$typeof:Cd,render:t}};U.isValidElement=Au;U.lazy=function(t){return{$$typeof:wd,_payload:{_status:-1,_result:t},_init:Wm}};U.memo=function(t,e){return{$$typeof:Sd,type:t,compare:e===void 0?null:e}};U.useCallback=function(t,e){return Wt().useCallback(t,e)};U.useContext=function(t,e){return Wt().useContext(t,e)};U.useDebugValue=function(){};U.useEffect=function(t,e){return Wt().useEffect(t,e)};U.useImperativeHandle=function(t,e,n){return Wt().useImperativeHandle(t,e,n)};U.useLayoutEffect=function(t,e){return Wt().useLayoutEffect(t,e)};U.useMemo=function(t,e){return Wt().useMemo(t,e)};U.useReducer=function(t,e,n){return Wt().useReducer(t,e,n)};U.useRef=function(t){return Wt().useRef(t)};U.useState=function(t){return Wt().useState(t)};U.version="17.0.2";J.exports=U;var ho=J.exports,bd={exports:{}},lt={},Id={exports:{}},kd={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var e,n,r,i;if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var a=null,u=null,h=function(){if(a!==null)try{var x=t.unstable_now();a(!0,x),a=null}catch(A){throw setTimeout(h,0),A}};e=function(x){a!==null?setTimeout(e,0,x):(a=x,setTimeout(h,0))},n=function(x,A){u=setTimeout(x,A)},r=function(){clearTimeout(u)},t.unstable_shouldYield=function(){return!1},i=t.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,c=window.clearTimeout;if(typeof console!="undefined"){var m=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof m!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var S=!1,E=null,d=-1,f=5,g=0;t.unstable_shouldYield=function(){return t.unstable_now()>=g},i=function(){},t.unstable_forceFrameRate=function(x){0>x||125<x?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):f=0<x?Math.floor(1e3/x):5};var y=new MessageChannel,w=y.port2;y.port1.onmessage=function(){if(E!==null){var x=t.unstable_now();g=x+f;try{E(!0,x)?w.postMessage(null):(S=!1,E=null)}catch(A){throw w.postMessage(null),A}}else S=!1},e=function(x){E=x,S||(S=!0,w.postMessage(null))},n=function(x,A){d=p(function(){x(t.unstable_now())},A)},r=function(){c(d),d=-1}}function b(x,A){var W=x.length;x.push(A);e:for(;;){var z=W-1>>>1,Q=x[z];if(Q!==void 0&&0<k(Q,A))x[z]=A,x[W]=Q,W=z;else break e}}function N(x){return x=x[0],x===void 0?null:x}function L(x){var A=x[0];if(A!==void 0){var W=x.pop();if(W!==A){x[0]=W;e:for(var z=0,Q=x.length;z<Q;){var me=2*(z+1)-1,ee=x[me],Qe=me+1,gt=x[Qe];if(ee!==void 0&&0>k(ee,W))gt!==void 0&&0>k(gt,ee)?(x[z]=gt,x[Qe]=W,z=Qe):(x[z]=ee,x[me]=W,z=me);else if(gt!==void 0&&0>k(gt,W))x[z]=gt,x[Qe]=W,z=Qe;else break e}}return A}return null}function k(x,A){var W=x.sortIndex-A.sortIndex;return W!==0?W:x.id-A.id}var T=[],j=[],ze=1,ce=null,G=3,Je=!1,v=!1,C=!1;function _(x){for(var A=N(j);A!==null;){if(A.callback===null)L(j);else if(A.startTime<=x)L(j),A.sortIndex=A.expirationTime,b(T,A);else break;A=N(j)}}function P(x){if(C=!1,_(x),!v)if(N(T)!==null)v=!0,e(O);else{var A=N(j);A!==null&&n(P,A.startTime-x)}}function O(x,A){v=!1,C&&(C=!1,r()),Je=!0;var W=G;try{for(_(A),ce=N(T);ce!==null&&(!(ce.expirationTime>A)||x&&!t.unstable_shouldYield());){var z=ce.callback;if(typeof z=="function"){ce.callback=null,G=ce.priorityLevel;var Q=z(ce.expirationTime<=A);A=t.unstable_now(),typeof Q=="function"?ce.callback=Q:ce===N(T)&&L(T),_(A)}else L(T);ce=N(T)}if(ce!==null)var me=!0;else{var ee=N(j);ee!==null&&n(P,ee.startTime-A),me=!1}return me}finally{ce=null,G=W,Je=!1}}var F=i;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(x){x.callback=null},t.unstable_continueExecution=function(){v||Je||(v=!0,e(O))},t.unstable_getCurrentPriorityLevel=function(){return G},t.unstable_getFirstCallbackNode=function(){return N(T)},t.unstable_next=function(x){switch(G){case 1:case 2:case 3:var A=3;break;default:A=G}var W=G;G=A;try{return x()}finally{G=W}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=F,t.unstable_runWithPriority=function(x,A){switch(x){case 1:case 2:case 3:case 4:case 5:break;default:x=3}var W=G;G=x;try{return A()}finally{G=W}},t.unstable_scheduleCallback=function(x,A,W){var z=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?z+W:z):W=z,x){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=W+Q,x={id:ze++,callback:A,priorityLevel:x,startTime:W,expirationTime:Q,sortIndex:-1},W>z?(x.sortIndex=W,b(j,x),N(T)===null&&x===N(j)&&(C?r():C=!0,n(P,W-z))):(x.sortIndex=Q,b(T,x),v||Je||(v=!0,e(O))),x},t.unstable_wrapCallback=function(x){var A=G;return function(){var W=G;G=A;try{return x.apply(this,arguments)}finally{G=W}}}})(kd);Id.exports=kd;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ko=J.exports,te=md,ye=Id.exports;function I(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Ko)throw Error(I(227));var Ad=new Set,Wi={};function Rn(t,e){Er(t,e),Er(t+"Capture",e)}function Er(t,e){for(Wi[t]=e,t=0;t<e.length;t++)Ad.add(e[t])}var Vt=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Mm=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qh=Object.prototype.hasOwnProperty,Xh={},Yh={};function $m(t){return Qh.call(Yh,t)?!0:Qh.call(Xh,t)?!1:Mm.test(t)?Yh[t]=!0:(Xh[t]=!0,!1)}function Bm(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Gm(t,e,n,r){if(e===null||typeof e=="undefined"||Bm(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function De(t,e,n,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Oe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Oe[t]=new De(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Oe[e]=new De(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Oe[t]=new De(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Oe[t]=new De(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Oe[t]=new De(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Oe[t]=new De(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Oe[t]=new De(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Oe[t]=new De(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Oe[t]=new De(t,5,!1,t.toLowerCase(),null,!1,!1)});var Fu=/[\-:]([a-z])/g;function Ru(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Fu,Ru);Oe[e]=new De(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Fu,Ru);Oe[e]=new De(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Fu,Ru);Oe[e]=new De(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Oe[t]=new De(t,1,!1,t.toLowerCase(),null,!1,!1)});Oe.xlinkHref=new De("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Oe[t]=new De(t,1,!1,t.toLowerCase(),null,!0,!0)});function Lu(t,e,n,r){var i=Oe.hasOwnProperty(e)?Oe[e]:null,o=i!==null?i.type===0:r?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");o||(Gm(e,n,i,r)&&(n=null),r||i===null?$m(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ln=Ko.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yi=60103,On=60106,Yt=60107,Du=60108,Pi=60114,Vu=60109,Wu=60110,Jo=60112,Oi=60113,Eo=60120,Qo=60115,ju=60116,Mu=60121,$u=60128,Fd=60129,Bu=60130,Va=60131;if(typeof Symbol=="function"&&Symbol.for){var ge=Symbol.for;yi=ge("react.element"),On=ge("react.portal"),Yt=ge("react.fragment"),Du=ge("react.strict_mode"),Pi=ge("react.profiler"),Vu=ge("react.provider"),Wu=ge("react.context"),Jo=ge("react.forward_ref"),Oi=ge("react.suspense"),Eo=ge("react.suspense_list"),Qo=ge("react.memo"),ju=ge("react.lazy"),Mu=ge("react.block"),ge("react.scope"),$u=ge("react.opaque.id"),Fd=ge("react.debug_trace_mode"),Bu=ge("react.offscreen"),Va=ge("react.legacy_hidden")}var Zh=typeof Symbol=="function"&&Symbol.iterator;function Hr(t){return t===null||typeof t!="object"?null:(t=Zh&&t[Zh]||t["@@iterator"],typeof t=="function"?t:null)}var Gl;function Ci(t){if(Gl===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Gl=e&&e[1]||""}return`
`+Gl+t}var Ul=!1;function Is(t,e){if(!t||Ul)return"";Ul=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(a){var r=a}Reflect.construct(t,[],e)}else{try{e.call()}catch(a){r=a}t.call(e.prototype)}else{try{throw Error()}catch(a){r=a}t()}}catch(a){if(a&&r&&typeof a.stack=="string"){for(var i=a.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,l=o.length-1;1<=s&&0<=l&&i[s]!==o[l];)l--;for(;1<=s&&0<=l;s--,l--)if(i[s]!==o[l]){if(s!==1||l!==1)do if(s--,l--,0>l||i[s]!==o[l])return`
`+i[s].replace(" at new "," at ");while(1<=s&&0<=l);break}}}finally{Ul=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ci(t):""}function Um(t){switch(t.tag){case 5:return Ci(t.type);case 16:return Ci("Lazy");case 13:return Ci("Suspense");case 19:return Ci("SuspenseList");case 0:case 2:case 15:return t=Is(t.type,!1),t;case 11:return t=Is(t.type.render,!1),t;case 22:return t=Is(t.type._render,!1),t;case 1:return t=Is(t.type,!0),t;default:return""}}function fr(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Yt:return"Fragment";case On:return"Portal";case Pi:return"Profiler";case Du:return"StrictMode";case Oi:return"Suspense";case Eo:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Wu:return(t.displayName||"Context")+".Consumer";case Vu:return(t._context.displayName||"Context")+".Provider";case Jo:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case Qo:return fr(t.type);case Mu:return fr(t._render);case ju:e=t._payload,t=t._init;try{return fr(t(e))}catch{}}return null}function fn(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function Rd(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function zm(t){var e=Rd(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ks(t){t._valueTracker||(t._valueTracker=zm(t))}function Ld(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Rd(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Po(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function Wa(t,e){var n=e.checked;return te({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function ec(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=fn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Dd(t,e){e=e.checked,e!=null&&Lu(t,"checked",e,!1)}function ja(t,e){Dd(t,e);var n=fn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Ma(t,e.type,n):e.hasOwnProperty("defaultValue")&&Ma(t,e.type,fn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tc(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Ma(t,e,n){(e!=="number"||Po(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function qm(t){var e="";return Ko.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}function $a(t,e){return t=te({children:void 0},e),(e=qm(e.children))&&(t.children=e),t}function dr(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+fn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Ba(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(I(91));return te({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function nc(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(I(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(I(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:fn(n)}}function Vd(t,e){var n=fn(e.value),r=fn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function rc(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}var Ga={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Wd(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ua(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Wd(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var As,jd=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!==Ga.svg||"innerHTML"in t)t.innerHTML=e;else{for(As=As||document.createElement("div"),As.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=As.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ji(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var xi={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Hm=["Webkit","ms","Moz","O"];Object.keys(xi).forEach(function(t){Hm.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),xi[e]=xi[t]})});function Md(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||xi.hasOwnProperty(t)&&xi[t]?(""+e).trim():e+"px"}function $d(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Md(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Km=te({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function za(t,e){if(e){if(Km[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(I(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(I(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(I(61))}if(e.style!=null&&typeof e.style!="object")throw Error(I(62))}}function qa(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Gu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ha=null,pr=null,mr=null;function ic(t){if(t=rs(t)){if(typeof Ha!="function")throw Error(I(280));var e=t.stateNode;e&&(e=nl(e),Ha(t.stateNode,t.type,e))}}function Bd(t){pr?mr?mr.push(t):mr=[t]:pr=t}function Gd(){if(pr){var t=pr,e=mr;if(mr=pr=null,ic(t),e)for(t=0;t<e.length;t++)ic(e[t])}}function Uu(t,e){return t(e)}function Ud(t,e,n,r,i){return t(e,n,r,i)}function zu(){}var zd=Uu,xn=!1,zl=!1;function qu(){(pr!==null||mr!==null)&&(zu(),Gd())}function Jm(t,e,n){if(zl)return t(e,n);zl=!0;try{return zd(t,e,n)}finally{zl=!1,qu()}}function Mi(t,e){var n=t.stateNode;if(n===null)return null;var r=nl(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(I(231,e,typeof n));return n}var Ka=!1;if(Vt)try{var Kr={};Object.defineProperty(Kr,"passive",{get:function(){Ka=!0}}),window.addEventListener("test",Kr,Kr),window.removeEventListener("test",Kr,Kr)}catch{Ka=!1}function Qm(t,e,n,r,i,o,s,l,a){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var Ti=!1,Oo=null,xo=!1,Ja=null,Xm={onError:function(t){Ti=!0,Oo=t}};function Ym(t,e,n,r,i,o,s,l,a){Ti=!1,Oo=null,Qm.apply(Xm,arguments)}function Zm(t,e,n,r,i,o,s,l,a){if(Ym.apply(this,arguments),Ti){if(Ti){var u=Oo;Ti=!1,Oo=null}else throw Error(I(198));xo||(xo=!0,Ja=u)}}function Dn(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&1026)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function qd(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function sc(t){if(Dn(t)!==t)throw Error(I(188))}function eg(t){var e=t.alternate;if(!e){if(e=Dn(t),e===null)throw Error(I(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return sc(i),t;if(o===r)return sc(i),e;o=o.sibling}throw Error(I(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s)throw Error(I(189))}}if(n.alternate!==r)throw Error(I(190))}if(n.tag!==3)throw Error(I(188));return n.stateNode.current===n?t:e}function Hd(t){if(t=eg(t),!t)return null;for(var e=t;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function oc(t,e){for(var n=t.alternate;e!==null;){if(e===t||e===n)return!0;e=e.return}return!1}var Kd,Hu,Jd,Qd,Qa=!1,wt=[],nn=null,rn=null,sn=null,$i=new Map,Bi=new Map,Jr=[],lc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xa(t,e,n,r,i){return{blockedOn:t,domEventName:e,eventSystemFlags:n|16,nativeEvent:i,targetContainers:[r]}}function ac(t,e){switch(t){case"focusin":case"focusout":nn=null;break;case"dragenter":case"dragleave":rn=null;break;case"mouseover":case"mouseout":sn=null;break;case"pointerover":case"pointerout":$i.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bi.delete(e.pointerId)}}function Qr(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t=Xa(e,n,r,i,o),e!==null&&(e=rs(e),e!==null&&Hu(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function tg(t,e,n,r,i){switch(e){case"focusin":return nn=Qr(nn,t,e,n,r,i),!0;case"dragenter":return rn=Qr(rn,t,e,n,r,i),!0;case"mouseover":return sn=Qr(sn,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return $i.set(o,Qr($i.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Bi.set(o,Qr(Bi.get(o)||null,t,e,n,r,i)),!0}return!1}function ng(t){var e=Tn(t.target);if(e!==null){var n=Dn(e);if(n!==null){if(e=n.tag,e===13){if(e=qd(n),e!==null){t.blockedOn=e,Qd(t.lanePriority,function(){ye.unstable_runWithPriority(t.priority,function(){Jd(n)})});return}}else if(e===3&&n.stateNode.hydrate){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function co(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Xu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null)return e=rs(n),e!==null&&Hu(e),t.blockedOn=n,!1;e.shift()}return!0}function uc(t,e,n){co(t)&&n.delete(e)}function rg(){for(Qa=!1;0<wt.length;){var t=wt[0];if(t.blockedOn!==null){t=rs(t.blockedOn),t!==null&&Kd(t);break}for(var e=t.targetContainers;0<e.length;){var n=Xu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null){t.blockedOn=n;break}e.shift()}t.blockedOn===null&&wt.shift()}nn!==null&&co(nn)&&(nn=null),rn!==null&&co(rn)&&(rn=null),sn!==null&&co(sn)&&(sn=null),$i.forEach(uc),Bi.forEach(uc)}function Xr(t,e){t.blockedOn===e&&(t.blockedOn=null,Qa||(Qa=!0,ye.unstable_scheduleCallback(ye.unstable_NormalPriority,rg)))}function Xd(t){function e(i){return Xr(i,t)}if(0<wt.length){Xr(wt[0],t);for(var n=1;n<wt.length;n++){var r=wt[n];r.blockedOn===t&&(r.blockedOn=null)}}for(nn!==null&&Xr(nn,t),rn!==null&&Xr(rn,t),sn!==null&&Xr(sn,t),$i.forEach(e),Bi.forEach(e),n=0;n<Jr.length;n++)r=Jr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Jr.length&&(n=Jr[0],n.blockedOn===null);)ng(n),n.blockedOn===null&&Jr.shift()}function Fs(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var or={animationend:Fs("Animation","AnimationEnd"),animationiteration:Fs("Animation","AnimationIteration"),animationstart:Fs("Animation","AnimationStart"),transitionend:Fs("Transition","TransitionEnd")},ql={},Yd={};Vt&&(Yd=document.createElement("div").style,"AnimationEvent"in window||(delete or.animationend.animation,delete or.animationiteration.animation,delete or.animationstart.animation),"TransitionEvent"in window||delete or.transitionend.transition);function Xo(t){if(ql[t])return ql[t];if(!or[t])return t;var e=or[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Yd)return ql[t]=e[n];return t}var Zd=Xo("animationend"),ep=Xo("animationiteration"),tp=Xo("animationstart"),np=Xo("transitionend"),rp=new Map,Ku=new Map,ig=["abort","abort",Zd,"animationEnd",ep,"animationIteration",tp,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",np,"transitionEnd","waiting","waiting"];function Ju(t,e){for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Ku.set(r,e),rp.set(r,i),Rn(i,[r])}}var sg=ye.unstable_now;sg();var K=8;function ir(t){if((1&t)!==0)return K=15,1;if((2&t)!==0)return K=14,2;if((4&t)!==0)return K=13,4;var e=24&t;return e!==0?(K=12,e):(t&32)!==0?(K=11,32):(e=192&t,e!==0?(K=10,e):(t&256)!==0?(K=9,256):(e=3584&t,e!==0?(K=8,e):(t&4096)!==0?(K=7,4096):(e=4186112&t,e!==0?(K=6,e):(e=62914560&t,e!==0?(K=5,e):t&67108864?(K=4,67108864):(t&134217728)!==0?(K=3,134217728):(e=805306368&t,e!==0?(K=2,e):(1073741824&t)!==0?(K=1,1073741824):(K=8,t))))))}function og(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function lg(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(I(358,t))}}function Gi(t,e){var n=t.pendingLanes;if(n===0)return K=0;var r=0,i=0,o=t.expiredLanes,s=t.suspendedLanes,l=t.pingedLanes;if(o!==0)r=o,i=K=15;else if(o=n&134217727,o!==0){var a=o&~s;a!==0?(r=ir(a),i=K):(l&=o,l!==0&&(r=ir(l),i=K))}else o=n&~s,o!==0?(r=ir(o),i=K):l!==0&&(r=ir(l),i=K);if(r===0)return 0;if(r=31-dn(r),r=n&((0>r?0:1<<r)<<1)-1,e!==0&&e!==r&&(e&s)===0){if(ir(e),i<=K)return e;K=i}if(e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-dn(e),i=1<<n,r|=t[n],e&=~i;return r}function ip(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function To(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return t=sr(24&~e),t===0?To(10,e):t;case 10:return t=sr(192&~e),t===0?To(8,e):t;case 8:return t=sr(3584&~e),t===0&&(t=sr(4186112&~e),t===0&&(t=512)),t;case 2:return e=sr(805306368&~e),e===0&&(e=268435456),e}throw Error(I(358,t))}function sr(t){return t&-t}function Hl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Yo(t,e,n){t.pendingLanes|=e;var r=e-1;t.suspendedLanes&=r,t.pingedLanes&=r,t=t.eventTimes,e=31-dn(e),t[e]=n}var dn=Math.clz32?Math.clz32:hg,ag=Math.log,ug=Math.LN2;function hg(t){return t===0?32:31-(ag(t)/ug|0)|0}var cg=ye.unstable_UserBlockingPriority,fg=ye.unstable_runWithPriority,fo=!0;function dg(t,e,n,r){xn||zu();var i=Qu,o=xn;xn=!0;try{Ud(i,t,e,n,r)}finally{(xn=o)||qu()}}function pg(t,e,n,r){fg(cg,Qu.bind(null,t,e,n,r))}function Qu(t,e,n,r){if(fo){var i;if((i=(e&4)===0)&&0<wt.length&&-1<lc.indexOf(t))t=Xa(null,t,e,n,r),wt.push(t);else{var o=Xu(t,e,n,r);if(o===null)i&&ac(t,r);else{if(i){if(-1<lc.indexOf(t)){t=Xa(o,t,e,n,r),wt.push(t);return}if(tg(o,t,e,n,r))return;ac(t,r)}vp(t,e,r,null,n)}}}}function Xu(t,e,n,r){var i=Gu(r);if(i=Tn(i),i!==null){var o=Dn(i);if(o===null)i=null;else{var s=o.tag;if(s===13){if(i=qd(o),i!==null)return i;i=null}else if(s===3){if(o.stateNode.hydrate)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return vp(t,e,r,i,n),null}var Zt=null,Yu=null,po=null;function sp(){if(po)return po;var t,e=Yu,n=e.length,r,i="value"in Zt?Zt.value:Zt.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===i[o-r];r++);return po=i.slice(t,1<r?1-r:void 0)}function mo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Rs(){return!0}function hc(){return!1}function Ke(t){function e(n,r,i,o,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Rs:hc,this.isPropagationStopped=hc,this}return te(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Rs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Rs)},persist:function(){},isPersistent:Rs}),e}var br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zu=Ke(br),ns=te({},br,{view:0,detail:0}),mg=Ke(ns),Kl,Jl,Yr,Zo=te({},ns,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Yr&&(Yr&&t.type==="mousemove"?(Kl=t.screenX-Yr.screenX,Jl=t.screenY-Yr.screenY):Jl=Kl=0,Yr=t),Kl)},movementY:function(t){return"movementY"in t?t.movementY:Jl}}),cc=Ke(Zo),gg=te({},Zo,{dataTransfer:0}),vg=Ke(gg),yg=te({},ns,{relatedTarget:0}),Ql=Ke(yg),Cg=te({},br,{animationName:0,elapsedTime:0,pseudoElement:0}),Sg=Ke(Cg),wg=te({},br,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),_g=Ke(wg),Eg=te({},br,{data:0}),fc=Ke(Eg),Pg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Og={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tg(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=xg[t])?!!e[t]:!1}function eh(){return Tg}var Ng=te({},ns,{key:function(t){if(t.key){var e=Pg[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=mo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Og[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eh,charCode:function(t){return t.type==="keypress"?mo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?mo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),bg=Ke(Ng),Ig=te({},Zo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dc=Ke(Ig),kg=te({},ns,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eh}),Ag=Ke(kg),Fg=te({},br,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rg=Ke(Fg),Lg=te({},Zo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Dg=Ke(Lg),Vg=[9,13,27,32],th=Vt&&"CompositionEvent"in window,Ni=null;Vt&&"documentMode"in document&&(Ni=document.documentMode);var Wg=Vt&&"TextEvent"in window&&!Ni,op=Vt&&(!th||Ni&&8<Ni&&11>=Ni),pc=String.fromCharCode(32),mc=!1;function lp(t,e){switch(t){case"keyup":return Vg.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ap(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var lr=!1;function jg(t,e){switch(t){case"compositionend":return ap(e);case"keypress":return e.which!==32?null:(mc=!0,pc);case"textInput":return t=e.data,t===pc&&mc?null:t;default:return null}}function Mg(t,e){if(lr)return t==="compositionend"||!th&&lp(t,e)?(t=sp(),po=Yu=Zt=null,lr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return op&&e.locale!=="ko"?null:e.data;default:return null}}var $g={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!$g[t.type]:e==="textarea"}function up(t,e,n,r){Bd(r),e=No(e,"onChange"),0<e.length&&(n=new Zu("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var bi=null,Ui=null;function Bg(t){pp(t,0)}function el(t){var e=ur(t);if(Ld(e))return t}function Gg(t,e){if(t==="change")return e}var hp=!1;if(Vt){var Xl;if(Vt){var Yl="oninput"in document;if(!Yl){var vc=document.createElement("div");vc.setAttribute("oninput","return;"),Yl=typeof vc.oninput=="function"}Xl=Yl}else Xl=!1;hp=Xl&&(!document.documentMode||9<document.documentMode)}function yc(){bi&&(bi.detachEvent("onpropertychange",cp),Ui=bi=null)}function cp(t){if(t.propertyName==="value"&&el(Ui)){var e=[];if(up(e,Ui,t,Gu(t)),t=Bg,xn)t(e);else{xn=!0;try{Uu(t,e)}finally{xn=!1,qu()}}}}function Ug(t,e,n){t==="focusin"?(yc(),bi=e,Ui=n,bi.attachEvent("onpropertychange",cp)):t==="focusout"&&yc()}function zg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return el(Ui)}function qg(t,e){if(t==="click")return el(e)}function Hg(t,e){if(t==="input"||t==="change")return el(e)}function Kg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var tt=typeof Object.is=="function"?Object.is:Kg,Jg=Object.prototype.hasOwnProperty;function zi(t,e){if(tt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Jg.call(e,n[r])||!tt(t[n[r]],e[n[r]]))return!1;return!0}function Cc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sc(t,e){var n=Cc(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Cc(n)}}function fp(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?fp(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function wc(){for(var t=window,e=Po();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Po(t.document)}return e}function Ya(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var Qg=Vt&&"documentMode"in document&&11>=document.documentMode,ar=null,Za=null,Ii=null,eu=!1;function _c(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;eu||ar==null||ar!==Po(r)||(r=ar,"selectionStart"in r&&Ya(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ii&&zi(Ii,r)||(Ii=r,r=No(Za,"onSelect"),0<r.length&&(e=new Zu("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ar)))}Ju("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Ju("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Ju(ig,2);for(var Ec="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Zl=0;Zl<Ec.length;Zl++)Ku.set(Ec[Zl],0);Er("onMouseEnter",["mouseout","mouseover"]);Er("onMouseLeave",["mouseout","mouseover"]);Er("onPointerEnter",["pointerout","pointerover"]);Er("onPointerLeave",["pointerout","pointerover"]);Rn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Rn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Rn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Rn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Rn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Rn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Si="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dp=new Set("cancel close invalid load scroll toggle".split(" ").concat(Si));function Pc(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Zm(r,e,void 0,t),t.currentTarget=null}function pp(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var l=r[s],a=l.instance,u=l.currentTarget;if(l=l.listener,a!==o&&i.isPropagationStopped())break e;Pc(i,l,u),o=a}else for(s=0;s<r.length;s++){if(l=r[s],a=l.instance,u=l.currentTarget,l=l.listener,a!==o&&i.isPropagationStopped())break e;Pc(i,l,u),o=a}}}if(xo)throw t=Ja,xo=!1,Ja=null,t}function X(t,e){var n=Cp(e),r=t+"__bubble";n.has(r)||(gp(e,t,2,!1),n.add(r))}var Oc="_reactListening"+Math.random().toString(36).slice(2);function mp(t){t[Oc]||(t[Oc]=!0,Ad.forEach(function(e){dp.has(e)||xc(e,!1,t,null),xc(e,!0,t,null)}))}function xc(t,e,n,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,o=n;if(t==="selectionchange"&&n.nodeType!==9&&(o=n.ownerDocument),r!==null&&!e&&dp.has(t)){if(t!=="scroll")return;i|=2,o=r}var s=Cp(o),l=t+"__"+(e?"capture":"bubble");s.has(l)||(e&&(i|=4),gp(o,t,i,e),s.add(l))}function gp(t,e,n,r){var i=Ku.get(e);switch(i===void 0?2:i){case 0:i=dg;break;case 1:i=pg;break;default:i=Qu}n=i.bind(null,e,n,t),i=void 0,!Ka||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function vp(t,e,n,r,i){var o=r;if((e&1)===0&&(e&2)===0&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var a=s.tag;if((a===3||a===4)&&(a=s.stateNode.containerInfo,a===i||a.nodeType===8&&a.parentNode===i))return;s=s.return}for(;l!==null;){if(s=Tn(l),s===null)return;if(a=s.tag,a===5||a===6){r=o=s;continue e}l=l.parentNode}}r=r.return}Jm(function(){var u=o,h=Gu(n),p=[];e:{var c=rp.get(t);if(c!==void 0){var m=Zu,S=t;switch(t){case"keypress":if(mo(n)===0)break e;case"keydown":case"keyup":m=bg;break;case"focusin":S="focus",m=Ql;break;case"focusout":S="blur",m=Ql;break;case"beforeblur":case"afterblur":m=Ql;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=cc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=vg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Ag;break;case Zd:case ep:case tp:m=Sg;break;case np:m=Rg;break;case"scroll":m=mg;break;case"wheel":m=Dg;break;case"copy":case"cut":case"paste":m=_g;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=dc}var E=(e&4)!==0,d=!E&&t==="scroll",f=E?c!==null?c+"Capture":null:c;E=[];for(var g=u,y;g!==null;){y=g;var w=y.stateNode;if(y.tag===5&&w!==null&&(y=w,f!==null&&(w=Mi(g,f),w!=null&&E.push(qi(g,w,y)))),d)break;g=g.return}0<E.length&&(c=new m(c,S,null,n,h),p.push({event:c,listeners:E}))}}if((e&7)===0){e:{if(c=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",c&&(e&16)===0&&(S=n.relatedTarget||n.fromElement)&&(Tn(S)||S[Ir]))break e;if((m||c)&&(c=h.window===h?h:(c=h.ownerDocument)?c.defaultView||c.parentWindow:window,m?(S=n.relatedTarget||n.toElement,m=u,S=S?Tn(S):null,S!==null&&(d=Dn(S),S!==d||S.tag!==5&&S.tag!==6)&&(S=null)):(m=null,S=u),m!==S)){if(E=cc,w="onMouseLeave",f="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(E=dc,w="onPointerLeave",f="onPointerEnter",g="pointer"),d=m==null?c:ur(m),y=S==null?c:ur(S),c=new E(w,g+"leave",m,n,h),c.target=d,c.relatedTarget=y,w=null,Tn(h)===u&&(E=new E(f,g+"enter",S,n,h),E.target=y,E.relatedTarget=d,w=E),d=w,m&&S)t:{for(E=m,f=S,g=0,y=E;y;y=Kn(y))g++;for(y=0,w=f;w;w=Kn(w))y++;for(;0<g-y;)E=Kn(E),g--;for(;0<y-g;)f=Kn(f),y--;for(;g--;){if(E===f||f!==null&&E===f.alternate)break t;E=Kn(E),f=Kn(f)}E=null}else E=null;m!==null&&Tc(p,c,m,E,!1),S!==null&&d!==null&&Tc(p,d,S,E,!0)}}e:{if(c=u?ur(u):window,m=c.nodeName&&c.nodeName.toLowerCase(),m==="select"||m==="input"&&c.type==="file")var b=Gg;else if(gc(c))if(hp)b=Hg;else{b=zg;var N=Ug}else(m=c.nodeName)&&m.toLowerCase()==="input"&&(c.type==="checkbox"||c.type==="radio")&&(b=qg);if(b&&(b=b(t,u))){up(p,b,n,h);break e}N&&N(t,c,u),t==="focusout"&&(N=c._wrapperState)&&N.controlled&&c.type==="number"&&Ma(c,"number",c.value)}switch(N=u?ur(u):window,t){case"focusin":(gc(N)||N.contentEditable==="true")&&(ar=N,Za=u,Ii=null);break;case"focusout":Ii=Za=ar=null;break;case"mousedown":eu=!0;break;case"contextmenu":case"mouseup":case"dragend":eu=!1,_c(p,n,h);break;case"selectionchange":if(Qg)break;case"keydown":case"keyup":_c(p,n,h)}var L;if(th)e:{switch(t){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else lr?lp(t,n)&&(k="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(op&&n.locale!=="ko"&&(lr||k!=="onCompositionStart"?k==="onCompositionEnd"&&lr&&(L=sp()):(Zt=h,Yu="value"in Zt?Zt.value:Zt.textContent,lr=!0)),N=No(u,k),0<N.length&&(k=new fc(k,t,null,n,h),p.push({event:k,listeners:N}),L?k.data=L:(L=ap(n),L!==null&&(k.data=L)))),(L=Wg?jg(t,n):Mg(t,n))&&(u=No(u,"onBeforeInput"),0<u.length&&(h=new fc("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:u}),h.data=L))}pp(p,e)})}function qi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function No(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Mi(t,n),o!=null&&r.unshift(qi(t,o,i)),o=Mi(t,e),o!=null&&r.push(qi(t,o,i))),t=t.return}return r}function Kn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Tc(t,e,n,r,i){for(var o=e._reactName,s=[];n!==null&&n!==r;){var l=n,a=l.alternate,u=l.stateNode;if(a!==null&&a===r)break;l.tag===5&&u!==null&&(l=u,i?(a=Mi(n,o),a!=null&&s.unshift(qi(n,a,l))):i||(a=Mi(n,o),a!=null&&s.push(qi(n,a,l)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}function bo(){}var ea=null,ta=null;function yp(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function tu(t,e){return t==="textarea"||t==="option"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Nc=typeof setTimeout=="function"?setTimeout:void 0,Xg=typeof clearTimeout=="function"?clearTimeout:void 0;function nh(t){t.nodeType===1?t.textContent="":t.nodeType===9&&(t=t.body,t!=null&&(t.textContent=""))}function gr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break}return t}function bc(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var na=0;function Yg(t){return{$$typeof:$u,toString:t,valueOf:t}}var tl=Math.random().toString(36).slice(2),en="__reactFiber$"+tl,Io="__reactProps$"+tl,Ir="__reactContainer$"+tl,Ic="__reactEvents$"+tl;function Tn(t){var e=t[en];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ir]||n[en]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=bc(t);t!==null;){if(n=t[en])return n;t=bc(t)}return e}t=n,n=t.parentNode}return null}function rs(t){return t=t[en]||t[Ir],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ur(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(I(33))}function nl(t){return t[Io]||null}function Cp(t){var e=t[Ic];return e===void 0&&(e=t[Ic]=new Set),e}var nu=[],hr=-1;function vn(t){return{current:t}}function Y(t){0>hr||(t.current=nu[hr],nu[hr]=null,hr--)}function se(t,e){hr++,nu[hr]=t.current,t.current=e}var pn={},ke=vn(pn),$e=vn(!1),kn=pn;function Pr(t,e){var n=t.type.contextTypes;if(!n)return pn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Be(t){return t=t.childContextTypes,t!=null}function ko(){Y($e),Y(ke)}function kc(t,e,n){if(ke.current!==pn)throw Error(I(168));se(ke,e),se($e,n)}function Sp(t,e,n){var r=t.stateNode;if(t=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(I(108,fr(e)||"Unknown",i));return te({},n,r)}function go(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||pn,kn=ke.current,se(ke,t),se($e,$e.current),!0}function Ac(t,e,n){var r=t.stateNode;if(!r)throw Error(I(169));n?(t=Sp(t,e,kn),r.__reactInternalMemoizedMergedChildContext=t,Y($e),Y(ke),se(ke,t)):Y($e),se($e,n)}var rh=null,In=null,Zg=ye.unstable_runWithPriority,ih=ye.unstable_scheduleCallback,ru=ye.unstable_cancelCallback,ev=ye.unstable_shouldYield,Fc=ye.unstable_requestPaint,iu=ye.unstable_now,tv=ye.unstable_getCurrentPriorityLevel,rl=ye.unstable_ImmediatePriority,wp=ye.unstable_UserBlockingPriority,_p=ye.unstable_NormalPriority,Ep=ye.unstable_LowPriority,Pp=ye.unstable_IdlePriority,ra={},nv=Fc!==void 0?Fc:function(){},At=null,vo=null,ia=!1,Rc=iu(),be=1e4>Rc?iu:function(){return iu()-Rc};function Or(){switch(tv()){case rl:return 99;case wp:return 98;case _p:return 97;case Ep:return 96;case Pp:return 95;default:throw Error(I(332))}}function Op(t){switch(t){case 99:return rl;case 98:return wp;case 97:return _p;case 96:return Ep;case 95:return Pp;default:throw Error(I(332))}}function An(t,e){return t=Op(t),Zg(t,e)}function Hi(t,e,n){return t=Op(t),ih(t,e,n)}function xt(){if(vo!==null){var t=vo;vo=null,ru(t)}xp()}function xp(){if(!ia&&At!==null){ia=!0;var t=0;try{var e=At;An(99,function(){for(;t<e.length;t++){var n=e[t];do n=n(!0);while(n!==null)}}),At=null}catch(n){throw At!==null&&(At=At.slice(t+1)),ih(rl,xt),n}finally{ia=!1}}}var rv=Ln.ReactCurrentBatchConfig;function dt(t,e){if(t&&t.defaultProps){e=te({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Ao=vn(null),Fo=null,cr=null,Ro=null;function sh(){Ro=cr=Fo=null}function oh(t){var e=Ao.current;Y(Ao),t.type._context._currentValue=e}function Tp(t,e){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)===e){if(n===null||(n.childLanes&e)===e)break;n.childLanes|=e}else t.childLanes|=e,n!==null&&(n.childLanes|=e);t=t.return}}function vr(t,e){Fo=t,Ro=cr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(pt=!0),t.firstContext=null)}function st(t,e){if(Ro!==t&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Ro=t,e=1073741823),e={context:t,observedBits:e,next:null},cr===null){if(Fo===null)throw Error(I(308));cr=e,Fo.dependencies={lanes:0,firstContext:e,responders:null}}else cr=cr.next=e;return t._currentValue}var Qt=!1;function lh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Np(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function on(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ln(t,e){if(t=t.updateQueue,t!==null){t=t.shared;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function Lc(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ki(t,e,n,r){var i=t.updateQueue;Qt=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var a=l,u=a.next;a.next=null,s===null?o=u:s.next=u,s=a;var h=t.alternate;if(h!==null){h=h.updateQueue;var p=h.lastBaseUpdate;p!==s&&(p===null?h.firstBaseUpdate=u:p.next=u,h.lastBaseUpdate=a)}}if(o!==null){p=i.baseState,s=0,h=u=a=null;do{l=o.lane;var c=o.eventTime;if((r&l)===l){h!==null&&(h=h.next={eventTime:c,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=t,S=o;switch(l=e,c=n,S.tag){case 1:if(m=S.payload,typeof m=="function"){p=m.call(c,p,l);break e}p=m;break e;case 3:m.flags=m.flags&-4097|64;case 0:if(m=S.payload,l=typeof m=="function"?m.call(c,p,l):m,l==null)break e;p=te({},p,l);break e;case 2:Qt=!0}}o.callback!==null&&(t.flags|=32,l=i.effects,l===null?i.effects=[o]:l.push(o))}else c={eventTime:c,lane:l,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=c,a=p):h=h.next=c,s|=l;if(o=o.next,o===null){if(l=i.shared.pending,l===null)break;o=l.next,l.next=null,i.lastBaseUpdate=l,i.shared.pending=null}}while(1);h===null&&(a=p),i.baseState=a,i.firstBaseUpdate=u,i.lastBaseUpdate=h,ss|=s,t.lanes=s,t.memoizedState=p}}function Dc(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(I(191,i));i.call(r)}}}var bp=new Ko.Component().refs;function Lo(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:te({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var il={isMounted:function(t){return(t=t._reactInternals)?Dn(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=He(),i=an(t),o=on(r,i);o.payload=e,n!=null&&(o.callback=n),ln(t,o),un(t,i,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=He(),i=an(t),o=on(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),ln(t,o),un(t,i,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=He(),r=an(t),i=on(n,r);i.tag=2,e!=null&&(i.callback=e),ln(t,i),un(t,r,n)}};function Vc(t,e,n,r,i,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!zi(n,r)||!zi(i,o):!0}function Ip(t,e,n){var r=!1,i=pn,o=e.contextType;return typeof o=="object"&&o!==null?o=st(o):(i=Be(e)?kn:ke.current,r=e.contextTypes,o=(r=r!=null)?Pr(t,i):pn),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=il,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function Wc(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&il.enqueueReplaceState(e,e.state,null)}function su(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=bp,lh(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=st(o):(o=Be(e)?kn:ke.current,i.context=Pr(t,o)),Ki(t,n,i,r),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Lo(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&il.enqueueReplaceState(i,i.state,null),Ki(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4)}var Ls=Array.isArray;function Zr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(I(309));var r=n.stateNode}if(!r)throw Error(I(147,t));var i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var s=r.refs;s===bp&&(s=r.refs={}),o===null?delete s[i]:s[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(I(284));if(!n._owner)throw Error(I(290,t))}return t}function Ds(t,e){if(t.type!=="textarea")throw Error(I(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function kp(t){function e(d,f){if(t){var g=d.lastEffect;g!==null?(g.nextEffect=f,d.lastEffect=f):d.firstEffect=d.lastEffect=f,f.nextEffect=null,f.flags=8}}function n(d,f){if(!t)return null;for(;f!==null;)e(d,f),f=f.sibling;return null}function r(d,f){for(d=new Map;f!==null;)f.key!==null?d.set(f.key,f):d.set(f.index,f),f=f.sibling;return d}function i(d,f){return d=gn(d,f),d.index=0,d.sibling=null,d}function o(d,f,g){return d.index=g,t?(g=d.alternate,g!==null?(g=g.index,g<f?(d.flags=2,f):g):(d.flags=2,f)):f}function s(d){return t&&d.alternate===null&&(d.flags=2),d}function l(d,f,g,y){return f===null||f.tag!==6?(f=ua(g,d.mode,y),f.return=d,f):(f=i(f,g),f.return=d,f)}function a(d,f,g,y){return f!==null&&f.elementType===g.type?(y=i(f,g.props),y.ref=Zr(d,f,g),y.return=d,y):(y=wo(g.type,g.key,g.props,null,d.mode,y),y.ref=Zr(d,f,g),y.return=d,y)}function u(d,f,g,y){return f===null||f.tag!==4||f.stateNode.containerInfo!==g.containerInfo||f.stateNode.implementation!==g.implementation?(f=ha(g,d.mode,y),f.return=d,f):(f=i(f,g.children||[]),f.return=d,f)}function h(d,f,g,y,w){return f===null||f.tag!==7?(f=wr(g,d.mode,y,w),f.return=d,f):(f=i(f,g),f.return=d,f)}function p(d,f,g){if(typeof f=="string"||typeof f=="number")return f=ua(""+f,d.mode,g),f.return=d,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case yi:return g=wo(f.type,f.key,f.props,null,d.mode,g),g.ref=Zr(d,null,f),g.return=d,g;case On:return f=ha(f,d.mode,g),f.return=d,f}if(Ls(f)||Hr(f))return f=wr(f,d.mode,g,null),f.return=d,f;Ds(d,f)}return null}function c(d,f,g,y){var w=f!==null?f.key:null;if(typeof g=="string"||typeof g=="number")return w!==null?null:l(d,f,""+g,y);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case yi:return g.key===w?g.type===Yt?h(d,f,g.props.children,y,w):a(d,f,g,y):null;case On:return g.key===w?u(d,f,g,y):null}if(Ls(g)||Hr(g))return w!==null?null:h(d,f,g,y,null);Ds(d,g)}return null}function m(d,f,g,y,w){if(typeof y=="string"||typeof y=="number")return d=d.get(g)||null,l(f,d,""+y,w);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case yi:return d=d.get(y.key===null?g:y.key)||null,y.type===Yt?h(f,d,y.props.children,w,y.key):a(f,d,y,w);case On:return d=d.get(y.key===null?g:y.key)||null,u(f,d,y,w)}if(Ls(y)||Hr(y))return d=d.get(g)||null,h(f,d,y,w,null);Ds(f,y)}return null}function S(d,f,g,y){for(var w=null,b=null,N=f,L=f=0,k=null;N!==null&&L<g.length;L++){N.index>L?(k=N,N=null):k=N.sibling;var T=c(d,N,g[L],y);if(T===null){N===null&&(N=k);break}t&&N&&T.alternate===null&&e(d,N),f=o(T,f,L),b===null?w=T:b.sibling=T,b=T,N=k}if(L===g.length)return n(d,N),w;if(N===null){for(;L<g.length;L++)N=p(d,g[L],y),N!==null&&(f=o(N,f,L),b===null?w=N:b.sibling=N,b=N);return w}for(N=r(d,N);L<g.length;L++)k=m(N,d,L,g[L],y),k!==null&&(t&&k.alternate!==null&&N.delete(k.key===null?L:k.key),f=o(k,f,L),b===null?w=k:b.sibling=k,b=k);return t&&N.forEach(function(j){return e(d,j)}),w}function E(d,f,g,y){var w=Hr(g);if(typeof w!="function")throw Error(I(150));if(g=w.call(g),g==null)throw Error(I(151));for(var b=w=null,N=f,L=f=0,k=null,T=g.next();N!==null&&!T.done;L++,T=g.next()){N.index>L?(k=N,N=null):k=N.sibling;var j=c(d,N,T.value,y);if(j===null){N===null&&(N=k);break}t&&N&&j.alternate===null&&e(d,N),f=o(j,f,L),b===null?w=j:b.sibling=j,b=j,N=k}if(T.done)return n(d,N),w;if(N===null){for(;!T.done;L++,T=g.next())T=p(d,T.value,y),T!==null&&(f=o(T,f,L),b===null?w=T:b.sibling=T,b=T);return w}for(N=r(d,N);!T.done;L++,T=g.next())T=m(N,d,L,T.value,y),T!==null&&(t&&T.alternate!==null&&N.delete(T.key===null?L:T.key),f=o(T,f,L),b===null?w=T:b.sibling=T,b=T);return t&&N.forEach(function(ze){return e(d,ze)}),w}return function(d,f,g,y){var w=typeof g=="object"&&g!==null&&g.type===Yt&&g.key===null;w&&(g=g.props.children);var b=typeof g=="object"&&g!==null;if(b)switch(g.$$typeof){case yi:e:{for(b=g.key,w=f;w!==null;){if(w.key===b){switch(w.tag){case 7:if(g.type===Yt){n(d,w.sibling),f=i(w,g.props.children),f.return=d,d=f;break e}break;default:if(w.elementType===g.type){n(d,w.sibling),f=i(w,g.props),f.ref=Zr(d,w,g),f.return=d,d=f;break e}}n(d,w);break}else e(d,w);w=w.sibling}g.type===Yt?(f=wr(g.props.children,d.mode,y,g.key),f.return=d,d=f):(y=wo(g.type,g.key,g.props,null,d.mode,y),y.ref=Zr(d,f,g),y.return=d,d=y)}return s(d);case On:e:{for(w=g.key;f!==null;){if(f.key===w)if(f.tag===4&&f.stateNode.containerInfo===g.containerInfo&&f.stateNode.implementation===g.implementation){n(d,f.sibling),f=i(f,g.children||[]),f.return=d,d=f;break e}else{n(d,f);break}else e(d,f);f=f.sibling}f=ha(g,d.mode,y),f.return=d,d=f}return s(d)}if(typeof g=="string"||typeof g=="number")return g=""+g,f!==null&&f.tag===6?(n(d,f.sibling),f=i(f,g),f.return=d,d=f):(n(d,f),f=ua(g,d.mode,y),f.return=d,d=f),s(d);if(Ls(g))return S(d,f,g,y);if(Hr(g))return E(d,f,g,y);if(b&&Ds(d,g),typeof g=="undefined"&&!w)switch(d.tag){case 1:case 22:case 0:case 11:case 15:throw Error(I(152,fr(d.type)||"Component"))}return n(d,f)}}var Do=kp(!0),Ap=kp(!1),is={},Pt=vn(is),Ji=vn(is),Qi=vn(is);function Nn(t){if(t===is)throw Error(I(174));return t}function ou(t,e){switch(se(Qi,e),se(Ji,t),se(Pt,is),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ua(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ua(e,t)}Y(Pt),se(Pt,e)}function xr(){Y(Pt),Y(Ji),Y(Qi)}function jc(t){Nn(Qi.current);var e=Nn(Pt.current),n=Ua(e,t.type);e!==n&&(se(Ji,t),se(Pt,n))}function ah(t){Ji.current===t&&(Y(Pt),Y(Ji))}var ie=vn(0);function Vo(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Rt=null,tn=null,Ot=!1;function Fp(t,e){var n=nt(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.flags=8,t.lastEffect!==null?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function Mc(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function lu(t){if(Ot){var e=tn;if(e){var n=e;if(!Mc(t,e)){if(e=gr(n.nextSibling),!e||!Mc(t,e)){t.flags=t.flags&-1025|2,Ot=!1,Rt=t;return}Fp(Rt,n)}Rt=t,tn=gr(e.firstChild)}else t.flags=t.flags&-1025|2,Ot=!1,Rt=t}}function $c(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Rt=t}function Vs(t){if(t!==Rt)return!1;if(!Ot)return $c(t),Ot=!0,!1;var e=t.type;if(t.tag!==5||e!=="head"&&e!=="body"&&!tu(e,t.memoizedProps))for(e=tn;e;)Fp(t,e),e=gr(e.nextSibling);if($c(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(I(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){tn=gr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}tn=null}}else tn=Rt?gr(t.stateNode.nextSibling):null;return!0}function sa(){tn=Rt=null,Ot=!1}var yr=[];function uh(){for(var t=0;t<yr.length;t++)yr[t]._workInProgressVersionPrimary=null;yr.length=0}var ki=Ln.ReactCurrentDispatcher,rt=Ln.ReactCurrentBatchConfig,Xi=0,le=null,Ne=null,Ee=null,Wo=!1,Ai=!1;function We(){throw Error(I(321))}function hh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!tt(t[n],e[n]))return!1;return!0}function ch(t,e,n,r,i,o){if(Xi=o,le=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ki.current=t===null||t.memoizedState===null?sv:ov,t=n(r,i),Ai){o=0;do{if(Ai=!1,!(25>o))throw Error(I(301));o+=1,Ee=Ne=null,e.updateQueue=null,ki.current=lv,t=n(r,i)}while(Ai)}if(ki.current=Bo,e=Ne!==null&&Ne.next!==null,Xi=0,Ee=Ne=le=null,Wo=!1,e)throw Error(I(300));return t}function bn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ee===null?le.memoizedState=Ee=t:Ee=Ee.next=t,Ee}function Vn(){if(Ne===null){var t=le.alternate;t=t!==null?t.memoizedState:null}else t=Ne.next;var e=Ee===null?le.memoizedState:Ee.next;if(e!==null)Ee=e,Ne=t;else{if(t===null)throw Error(I(310));Ne=t,t={memoizedState:Ne.memoizedState,baseState:Ne.baseState,baseQueue:Ne.baseQueue,queue:Ne.queue,next:null},Ee===null?le.memoizedState=Ee=t:Ee=Ee.next=t}return Ee}function _t(t,e){return typeof e=="function"?e(t):e}function ei(t){var e=Vn(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var r=Ne,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(i!==null){i=i.next,r=r.baseState;var l=s=o=null,a=i;do{var u=a.lane;if((Xi&u)===u)l!==null&&(l=l.next={lane:0,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null}),r=a.eagerReducer===t?a.eagerState:t(r,a.action);else{var h={lane:u,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null};l===null?(s=l=h,o=r):l=l.next=h,le.lanes|=u,ss|=u}a=a.next}while(a!==null&&a!==i);l===null?o=r:l.next=s,tt(r,e.memoizedState)||(pt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}return[e.memoizedState,n.dispatch]}function ti(t){var e=Vn(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=t(o,s.action),s=s.next;while(s!==i);tt(o,e.memoizedState)||(pt=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function Bc(t,e,n){var r=e._getVersion;r=r(e._source);var i=e._workInProgressVersionPrimary;if(i!==null?t=i===r:(t=t.mutableReadLanes,(t=(Xi&t)===t)&&(e._workInProgressVersionPrimary=r,yr.push(e))),t)return n(e._source);throw yr.push(e),Error(I(350))}function Rp(t,e,n,r){var i=Le;if(i===null)throw Error(I(349));var o=e._getVersion,s=o(e._source),l=ki.current,a=l.useState(function(){return Bc(i,e,n)}),u=a[1],h=a[0];a=Ee;var p=t.memoizedState,c=p.refs,m=c.getSnapshot,S=p.source;p=p.subscribe;var E=le;return t.memoizedState={refs:c,source:e,subscribe:r},l.useEffect(function(){c.getSnapshot=n,c.setSnapshot=u;var d=o(e._source);if(!tt(s,d)){d=n(e._source),tt(h,d)||(u(d),d=an(E),i.mutableReadLanes|=d&i.pendingLanes),d=i.mutableReadLanes,i.entangledLanes|=d;for(var f=i.entanglements,g=d;0<g;){var y=31-dn(g),w=1<<y;f[y]|=d,g&=~w}}},[n,e,r]),l.useEffect(function(){return r(e._source,function(){var d=c.getSnapshot,f=c.setSnapshot;try{f(d(e._source));var g=an(E);i.mutableReadLanes|=g&i.pendingLanes}catch(y){f(function(){throw y})}})},[e,r]),tt(m,n)&&tt(S,e)&&tt(p,r)||(t={pending:null,dispatch:null,lastRenderedReducer:_t,lastRenderedState:h},t.dispatch=u=ph.bind(null,le,t),a.queue=t,a.baseQueue=null,h=Bc(i,e,n),a.memoizedState=a.baseState=h),h}function Lp(t,e,n){var r=Vn();return Rp(r,t,e,n)}function ni(t){var e=bn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t=e.queue={pending:null,dispatch:null,lastRenderedReducer:_t,lastRenderedState:t},t=t.dispatch=ph.bind(null,le,t),[e.memoizedState,t]}function jo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=le.updateQueue,e===null?(e={lastEffect:null},le.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Gc(t){var e=bn();return t={current:t},e.memoizedState=t}function Mo(){return Vn().memoizedState}function au(t,e,n,r){var i=bn();le.flags|=t,i.memoizedState=jo(1|e,n,void 0,r===void 0?null:r)}function fh(t,e,n,r){var i=Vn();r=r===void 0?null:r;var o=void 0;if(Ne!==null){var s=Ne.memoizedState;if(o=s.destroy,r!==null&&hh(r,s.deps)){jo(e,n,o,r);return}}le.flags|=t,i.memoizedState=jo(1|e,n,o,r)}function Uc(t,e){return au(516,4,t,e)}function $o(t,e){return fh(516,4,t,e)}function Dp(t,e){return fh(4,2,t,e)}function Vp(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Wp(t,e,n){return n=n!=null?n.concat([t]):null,fh(4,2,Vp.bind(null,e,t),n)}function dh(){}function jp(t,e){var n=Vn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&hh(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Mp(t,e){var n=Vn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&hh(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function iv(t,e){var n=Or();An(98>n?98:n,function(){t(!0)}),An(97<n?97:n,function(){var r=rt.transition;rt.transition=1;try{t(!1),e()}finally{rt.transition=r}})}function ph(t,e,n){var r=He(),i=an(t),o={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},s=e.pending;if(s===null?o.next=o:(o.next=s.next,s.next=o),e.pending=o,s=t.alternate,t===le||s!==null&&s===le)Ai=Wo=!0;else{if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var l=e.lastRenderedState,a=s(l,n);if(o.eagerReducer=s,o.eagerState=a,tt(a,l))return}catch{}finally{}un(t,i,r)}}var Bo={readContext:st,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useLayoutEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useMutableSource:We,useOpaqueIdentifier:We,unstable_isNewReconciler:!1},sv={readContext:st,useCallback:function(t,e){return bn().memoizedState=[t,e===void 0?null:e],t},useContext:st,useEffect:Uc,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,au(4,2,Vp.bind(null,e,t),n)},useLayoutEffect:function(t,e){return au(4,2,t,e)},useMemo:function(t,e){var n=bn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=bn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},t=t.dispatch=ph.bind(null,le,t),[r.memoizedState,t]},useRef:Gc,useState:ni,useDebugValue:dh,useDeferredValue:function(t){var e=ni(t),n=e[0],r=e[1];return Uc(function(){var i=rt.transition;rt.transition=1;try{r(t)}finally{rt.transition=i}},[t]),n},useTransition:function(){var t=ni(!1),e=t[0];return t=iv.bind(null,t[1]),Gc(t),[t,e]},useMutableSource:function(t,e,n){var r=bn();return r.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:n},Rp(r,t,e,n)},useOpaqueIdentifier:function(){if(Ot){var t=!1,e=Yg(function(){throw t||(t=!0,n("r:"+(na++).toString(36))),Error(I(355))}),n=ni(e)[1];return(le.mode&2)===0&&(le.flags|=516,jo(5,function(){n("r:"+(na++).toString(36))},void 0,null)),e}return e="r:"+(na++).toString(36),ni(e),e},unstable_isNewReconciler:!1},ov={readContext:st,useCallback:jp,useContext:st,useEffect:$o,useImperativeHandle:Wp,useLayoutEffect:Dp,useMemo:Mp,useReducer:ei,useRef:Mo,useState:function(){return ei(_t)},useDebugValue:dh,useDeferredValue:function(t){var e=ei(_t),n=e[0],r=e[1];return $o(function(){var i=rt.transition;rt.transition=1;try{r(t)}finally{rt.transition=i}},[t]),n},useTransition:function(){var t=ei(_t)[0];return[Mo().current,t]},useMutableSource:Lp,useOpaqueIdentifier:function(){return ei(_t)[0]},unstable_isNewReconciler:!1},lv={readContext:st,useCallback:jp,useContext:st,useEffect:$o,useImperativeHandle:Wp,useLayoutEffect:Dp,useMemo:Mp,useReducer:ti,useRef:Mo,useState:function(){return ti(_t)},useDebugValue:dh,useDeferredValue:function(t){var e=ti(_t),n=e[0],r=e[1];return $o(function(){var i=rt.transition;rt.transition=1;try{r(t)}finally{rt.transition=i}},[t]),n},useTransition:function(){var t=ti(_t)[0];return[Mo().current,t]},useMutableSource:Lp,useOpaqueIdentifier:function(){return ti(_t)[0]},unstable_isNewReconciler:!1},av=Ln.ReactCurrentOwner,pt=!1;function Me(t,e,n,r){e.child=t===null?Ap(e,null,n,r):Do(e,t.child,n,r)}function zc(t,e,n,r,i){n=n.render;var o=e.ref;return vr(e,i),r=ch(t,e,n,r,o,i),t!==null&&!pt?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,Lt(t,e,i)):(e.flags|=1,Me(t,e,r,i),e.child)}function qc(t,e,n,r,i,o){if(t===null){var s=n.type;return typeof s=="function"&&!Sh(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,$p(t,e,s,r,i,o)):(t=wo(n.type,null,r,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}return s=t.child,(i&o)===0&&(i=s.memoizedProps,n=n.compare,n=n!==null?n:zi,n(i,r)&&t.ref===e.ref)?Lt(t,e,o):(e.flags|=1,t=gn(s,r),t.ref=e.ref,t.return=e,e.child=t)}function $p(t,e,n,r,i,o){if(t!==null&&zi(t.memoizedProps,r)&&t.ref===e.ref)if(pt=!1,(o&i)!==0)(t.flags&16384)!==0&&(pt=!0);else return e.lanes=t.lanes,Lt(t,e,o);return uu(t,e,n,r,o)}function oa(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden"||r.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},js(e,n);else if((n&1073741824)!==0)e.memoizedState={baseLanes:0},js(e,o!==null?o.baseLanes:n);else return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},js(e,t),null;else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,js(e,r);return Me(t,e,i,n),e.child}function Bp(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=128)}function uu(t,e,n,r,i){var o=Be(n)?kn:ke.current;return o=Pr(e,o),vr(e,i),n=ch(t,e,n,r,o,i),t!==null&&!pt?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,Lt(t,e,i)):(e.flags|=1,Me(t,e,n,i),e.child)}function Hc(t,e,n,r,i){if(Be(n)){var o=!0;go(e)}else o=!1;if(vr(e,i),e.stateNode===null)t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),Ip(e,n,r),su(e,n,r,i),r=!0;else if(t===null){var s=e.stateNode,l=e.memoizedProps;s.props=l;var a=s.context,u=n.contextType;typeof u=="object"&&u!==null?u=st(u):(u=Be(n)?kn:ke.current,u=Pr(e,u));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||a!==u)&&Wc(e,s,r,u),Qt=!1;var c=e.memoizedState;s.state=c,Ki(e,r,s,i),a=e.memoizedState,l!==r||c!==a||$e.current||Qt?(typeof h=="function"&&(Lo(e,n,h,r),a=e.memoizedState),(l=Qt||Vc(e,n,l,r,c,a,u))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4)):(typeof s.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=r,e.memoizedState=a),s.props=r,s.state=a,s.context=u,r=l):(typeof s.componentDidMount=="function"&&(e.flags|=4),r=!1)}else{s=e.stateNode,Np(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:dt(e.type,l),s.props=u,p=e.pendingProps,c=s.context,a=n.contextType,typeof a=="object"&&a!==null?a=st(a):(a=Be(n)?kn:ke.current,a=Pr(e,a));var m=n.getDerivedStateFromProps;(h=typeof m=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==p||c!==a)&&Wc(e,s,r,a),Qt=!1,c=e.memoizedState,s.state=c,Ki(e,r,s,i);var S=e.memoizedState;l!==p||c!==S||$e.current||Qt?(typeof m=="function"&&(Lo(e,n,m,r),S=e.memoizedState),(u=Qt||Vc(e,n,u,r,c,S,a))?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,S,a),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,S,a)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof s.componentDidUpdate!="function"||l===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),e.memoizedProps=r,e.memoizedState=S),s.props=r,s.state=S,s.context=a,r=u):(typeof s.componentDidUpdate!="function"||l===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),r=!1)}return hu(t,e,n,r,o,i)}function hu(t,e,n,r,i,o){Bp(t,e);var s=(e.flags&64)!==0;if(!r&&!s)return i&&Ac(e,n,!1),Lt(t,e,o);r=e.stateNode,av.current=e;var l=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=Do(e,t.child,null,o),e.child=Do(e,null,l,o)):Me(t,e,l,o),e.memoizedState=r.state,i&&Ac(e,n,!0),e.child}function Kc(t){var e=t.stateNode;e.pendingContext?kc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&kc(t,e.context,!1),ou(t,e.containerInfo)}var Ws={dehydrated:null,retryLane:0};function Jc(t,e,n){var r=e.pendingProps,i=ie.current,o=!1,s;return(s=(e.flags&64)!==0)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(o=!0,e.flags&=-65):t!==null&&t.memoizedState===null||r.fallback===void 0||r.unstable_avoidThisFallback===!0||(i|=1),se(ie,i&1),t===null?(r.fallback!==void 0&&lu(e),t=r.children,i=r.fallback,o?(t=Qc(e,t,i,n),e.child.memoizedState={baseLanes:n},e.memoizedState=Ws,t):typeof r.unstable_expectedLoadTime=="number"?(t=Qc(e,t,i,n),e.child.memoizedState={baseLanes:n},e.memoizedState=Ws,e.lanes=33554432,t):(n=wh({mode:"visible",children:t},e.mode,n,null),n.return=e,e.child=n)):t.memoizedState!==null?o?(r=Yc(t,e,r.children,r.fallback,n),o=e.child,i=t.child.memoizedState,o.memoizedState=i===null?{baseLanes:n}:{baseLanes:i.baseLanes|n},o.childLanes=t.childLanes&~n,e.memoizedState=Ws,r):(n=Xc(t,e,r.children,n),e.memoizedState=null,n):o?(r=Yc(t,e,r.children,r.fallback,n),o=e.child,i=t.child.memoizedState,o.memoizedState=i===null?{baseLanes:n}:{baseLanes:i.baseLanes|n},o.childLanes=t.childLanes&~n,e.memoizedState=Ws,r):(n=Xc(t,e,r.children,n),e.memoizedState=null,n)}function Qc(t,e,n,r){var i=t.mode,o=t.child;return e={mode:"hidden",children:e},(i&2)===0&&o!==null?(o.childLanes=0,o.pendingProps=e):o=wh(e,i,0,null),n=wr(n,i,r,null),o.return=t,n.return=t,o.sibling=n,t.child=o,n}function Xc(t,e,n,r){var i=t.child;return t=i.sibling,n=gn(i,{mode:"visible",children:n}),(e.mode&2)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=n}function Yc(t,e,n,r,i){var o=e.mode,s=t.child;t=s.sibling;var l={mode:"hidden",children:n};return(o&2)===0&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=l,s=n.lastEffect,s!==null?(e.firstEffect=n.firstEffect,e.lastEffect=s,s.nextEffect=null):e.firstEffect=e.lastEffect=null):n=gn(s,l),t!==null?r=gn(t,r):(r=wr(r,o,i,null),r.flags|=2),r.return=e,n.return=e,n.sibling=r,e.child=n,r}function Zc(t,e){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Tp(t.return,e)}function la(t,e,n,r,i,o){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:o}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i,s.lastEffect=o)}function ef(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Me(t,e,r.children,n),r=ie.current,(r&2)!==0)r=r&1|2,e.flags|=64;else{if(t!==null&&(t.flags&64)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Zc(t,n);else if(t.tag===19)Zc(t,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(se(ie,r),(e.mode&2)===0)e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Vo(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),la(e,!1,i,n,o,e.lastEffect);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Vo(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}la(e,!0,n,null,o,e.lastEffect);break;case"together":la(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Lt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ss|=e.lanes,(n&e.childLanes)!==0){if(t!==null&&e.child!==t.child)throw Error(I(153));if(e.child!==null){for(t=e.child,n=gn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=gn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}return null}var Gp,cu,Up,zp;Gp=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};cu=function(){};Up=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Nn(Pt.current);var o=null;switch(n){case"input":i=Wa(t,i),r=Wa(t,r),o=[];break;case"option":i=$a(t,i),r=$a(t,r),o=[];break;case"select":i=te({},i,{value:void 0}),r=te({},r,{value:void 0}),o=[];break;case"textarea":i=Ba(t,i),r=Ba(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=bo)}za(n,r);var s;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var l=i[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Wi.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var a=r[u];if(l=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&a!==l&&(a!=null||l!=null))if(u==="style")if(l){for(s in l)!l.hasOwnProperty(s)||a&&a.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in a)a.hasOwnProperty(s)&&l[s]!==a[s]&&(n||(n={}),n[s]=a[s])}else n||(o||(o=[]),o.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,l=l?l.__html:void 0,a!=null&&l!==a&&(o=o||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(o=o||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Wi.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&X("scroll",t),o||l===a||(o=[])):typeof a=="object"&&a!==null&&a.$$typeof===$u?a.toString():(o=o||[]).push(u,a))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}};zp=function(t,e,n,r){n!==r&&(e.flags|=4)};function ri(t,e){if(!Ot)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function uv(t,e,n){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Be(e.type)&&ko(),null;case 3:return xr(),Y($e),Y(ke),uh(),r=e.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Vs(e)?e.flags|=4:r.hydrate||(e.flags|=256)),cu(e),null;case 5:ah(e);var i=Nn(Qi.current);if(n=e.type,t!==null&&e.stateNode!=null)Up(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=128);else{if(!r){if(e.stateNode===null)throw Error(I(166));return null}if(t=Nn(Pt.current),Vs(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[en]=e,r[Io]=o,n){case"dialog":X("cancel",r),X("close",r);break;case"iframe":case"object":case"embed":X("load",r);break;case"video":case"audio":for(t=0;t<Si.length;t++)X(Si[t],r);break;case"source":X("error",r);break;case"img":case"image":case"link":X("error",r),X("load",r);break;case"details":X("toggle",r);break;case"input":ec(r,o),X("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},X("invalid",r);break;case"textarea":nc(r,o),X("invalid",r)}za(n,o),t=null;for(var s in o)o.hasOwnProperty(s)&&(i=o[s],s==="children"?typeof i=="string"?r.textContent!==i&&(t=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(t=["children",""+i]):Wi.hasOwnProperty(s)&&i!=null&&s==="onScroll"&&X("scroll",r));switch(n){case"input":ks(r),tc(r,o,!0);break;case"textarea":ks(r),rc(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=bo)}r=t,e.updateQueue=r,r!==null&&(e.flags|=4)}else{switch(s=i.nodeType===9?i:i.ownerDocument,t===Ga.html&&(t=Wd(n)),t===Ga.html?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[en]=e,t[Io]=r,Gp(t,e,!1,!1),e.stateNode=t,s=qa(n,r),n){case"dialog":X("cancel",t),X("close",t),i=r;break;case"iframe":case"object":case"embed":X("load",t),i=r;break;case"video":case"audio":for(i=0;i<Si.length;i++)X(Si[i],t);i=r;break;case"source":X("error",t),i=r;break;case"img":case"image":case"link":X("error",t),X("load",t),i=r;break;case"details":X("toggle",t),i=r;break;case"input":ec(t,r),i=Wa(t,r),X("invalid",t);break;case"option":i=$a(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=te({},r,{value:void 0}),X("invalid",t);break;case"textarea":nc(t,r),i=Ba(t,r),X("invalid",t);break;default:i=r}za(n,i);var l=i;for(o in l)if(l.hasOwnProperty(o)){var a=l[o];o==="style"?$d(t,a):o==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&jd(t,a)):o==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&ji(t,a):typeof a=="number"&&ji(t,""+a):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Wi.hasOwnProperty(o)?a!=null&&o==="onScroll"&&X("scroll",t):a!=null&&Lu(t,o,a,s))}switch(n){case"input":ks(t),tc(t,r,!1);break;case"textarea":ks(t),rc(t);break;case"option":r.value!=null&&t.setAttribute("value",""+fn(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?dr(t,!!r.multiple,o,!1):r.defaultValue!=null&&dr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=bo)}yp(n,r)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(t&&e.stateNode!=null)zp(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(I(166));n=Nn(Qi.current),Nn(Pt.current),Vs(e)?(r=e.stateNode,n=e.memoizedProps,r[en]=e,r.nodeValue!==n&&(e.flags|=4)):(r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[en]=e,e.stateNode=r)}return null;case 13:return Y(ie),r=e.memoizedState,(e.flags&64)!==0?(e.lanes=n,e):(r=r!==null,n=!1,t===null?e.memoizedProps.fallback!==void 0&&Vs(e):n=t.memoizedState!==null,r&&!n&&(e.mode&2)!==0&&(t===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(ie.current&1)!==0?Pe===0&&(Pe=3):((Pe===0||Pe===3)&&(Pe=4),Le===null||(ss&134217727)===0&&(Ar&134217727)===0||Cr(Le,Ie))),(r||n)&&(e.flags|=4),null);case 4:return xr(),cu(e),t===null&&mp(e.stateNode.containerInfo),null;case 10:return oh(e),null;case 17:return Be(e.type)&&ko(),null;case 19:if(Y(ie),r=e.memoizedState,r===null)return null;if(o=(e.flags&64)!==0,s=r.rendering,s===null)if(o)ri(r,!1);else{if(Pe!==0||t!==null&&(t.flags&64)!==0)for(t=e.child;t!==null;){if(s=Vo(t),s!==null){for(e.flags|=64,ri(r,!1),o=s.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),r.lastEffect===null&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return se(ie,ie.current&1|2),e.child}t=t.sibling}r.tail!==null&&be()>vu&&(e.flags|=64,o=!0,ri(r,!1),e.lanes=33554432)}else{if(!o)if(t=Vo(s),t!==null){if(e.flags|=64,o=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ri(r,!0),r.tail===null&&r.tailMode==="hidden"&&!s.alternate&&!Ot)return e=e.lastEffect=r.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*be()-r.renderingStartTime>vu&&n!==1073741824&&(e.flags|=64,o=!0,ri(r,!1),e.lanes=33554432);r.isBackwards?(s.sibling=e.child,e.child=s):(n=r.last,n!==null?n.sibling=s:e.child=s,r.last=s)}return r.tail!==null?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=be(),n.sibling=null,e=ie.current,se(ie,o?e&1|2:e&1),n):null;case 23:case 24:return Ch(),t!==null&&t.memoizedState!==null!=(e.memoizedState!==null)&&r.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(I(156,e.tag))}function hv(t){switch(t.tag){case 1:Be(t.type)&&ko();var e=t.flags;return e&4096?(t.flags=e&-4097|64,t):null;case 3:if(xr(),Y($e),Y(ke),uh(),e=t.flags,(e&64)!==0)throw Error(I(285));return t.flags=e&-4097|64,t;case 5:return ah(t),null;case 13:return Y(ie),e=t.flags,e&4096?(t.flags=e&-4097|64,t):null;case 19:return Y(ie),null;case 4:return xr(),null;case 10:return oh(t),null;case 23:case 24:return Ch(),null;default:return null}}function mh(t,e){try{var n="",r=e;do n+=Um(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i}}function fu(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var cv=typeof WeakMap=="function"?WeakMap:Map;function qp(t,e,n){n=on(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Uo||(Uo=!0,yu=r),fu(t,e)},n}function Hp(t,e,n){n=on(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return fu(t,e),r(i)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){typeof r!="function"&&(Et===null?Et=new Set([this]):Et.add(this),fu(t,e));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}var fv=typeof WeakSet=="function"?WeakSet:Set;function tf(t){var e=t.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(n){hn(t,n)}else e.current=null}function dv(t,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&t!==null){var n=t.memoizedProps,r=t.memoizedState;t=e.stateNode,e=t.getSnapshotBeforeUpdate(e.elementType===e.type?n:dt(e.type,n),r),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&nh(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(I(163))}function pv(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{if((t.tag&3)===3){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{var i=t;r=i.next,i=i.tag,(i&4)!==0&&(i&1)!==0&&(nm(n,t),_v(n,t)),t=r}while(t!==e)}return;case 1:t=n.stateNode,n.flags&4&&(e===null?t.componentDidMount():(r=n.elementType===n.type?e.memoizedProps:dt(n.type,e.memoizedProps),t.componentDidUpdate(r,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),e=n.updateQueue,e!==null&&Dc(n,e,t);return;case 3:if(e=n.updateQueue,e!==null){if(t=null,n.child!==null)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}Dc(n,e,t)}return;case 5:t=n.stateNode,e===null&&n.flags&4&&yp(n.type,n.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:n.memoizedState===null&&(n=n.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&Xd(n))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(I(163))}function nf(t,e){for(var n=t;;){if(n.tag===5){var r=n.stateNode;if(e)r=r.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=i!=null&&i.hasOwnProperty("display")?i.display:null,r.style.display=Md("display",i)}}else if(n.tag===6)n.stateNode.nodeValue=e?"":n.memoizedProps;else if((n.tag!==23&&n.tag!==24||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function rf(t,e){if(In&&typeof In.onCommitFiberUnmount=="function")try{In.onCommitFiberUnmount(rh,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(t=e.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var n=t=t.next;do{var r=n,i=r.destroy;if(r=r.tag,i!==void 0)if((r&4)!==0)nm(e,n);else{r=e;try{i()}catch(o){hn(r,o)}}n=n.next}while(n!==t)}break;case 1:if(tf(e),t=e.stateNode,typeof t.componentWillUnmount=="function")try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(o){hn(e,o)}break;case 5:tf(e);break;case 4:Kp(t,e)}}function sf(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function of(t){return t.tag===5||t.tag===3||t.tag===4}function lf(t){e:{for(var e=t.return;e!==null;){if(of(e))break e;e=e.return}throw Error(I(160))}var n=e;switch(e=n.stateNode,n.tag){case 5:var r=!1;break;case 3:e=e.containerInfo,r=!0;break;case 4:e=e.containerInfo,r=!0;break;default:throw Error(I(161))}n.flags&16&&(ji(e,""),n.flags&=-17);e:t:for(n=t;;){for(;n.sibling===null;){if(n.return===null||of(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2)){n=n.stateNode;break e}}r?du(t,n,e):pu(t,n,e)}function du(t,e,n){var r=t.tag,i=r===5||r===6;if(i)t=i?t.stateNode:t.stateNode.instance,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=bo));else if(r!==4&&(t=t.child,t!==null))for(du(t,e,n),t=t.sibling;t!==null;)du(t,e,n),t=t.sibling}function pu(t,e,n){var r=t.tag,i=r===5||r===6;if(i)t=i?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(pu(t,e,n),t=t.sibling;t!==null;)pu(t,e,n),t=t.sibling}function Kp(t,e){for(var n=e,r=!1,i,o;;){if(!r){r=n.return;e:for(;;){if(r===null)throw Error(I(160));switch(i=r.stateNode,r.tag){case 5:o=!1;break e;case 3:i=i.containerInfo,o=!0;break e;case 4:i=i.containerInfo,o=!0;break e}r=r.return}r=!0}if(n.tag===5||n.tag===6){e:for(var s=t,l=n,a=l;;)if(rf(s,a),a.child!==null&&a.tag!==4)a.child.return=a,a=a.child;else{if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}o?(s=i,l=n.stateNode,s.nodeType===8?s.parentNode.removeChild(l):s.removeChild(l)):i.removeChild(n.stateNode)}else if(n.tag===4){if(n.child!==null){i=n.stateNode.containerInfo,o=!0,n.child.return=n,n=n.child;continue}}else if(rf(t,n),n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return,n.tag===4&&(r=!1)}n.sibling.return=n.return,n=n.sibling}}function aa(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do(r.tag&3)===3&&(t=r.destroy,r.destroy=void 0,t!==void 0&&t()),r=r.next;while(r!==n)}return;case 1:return;case 5:if(n=e.stateNode,n!=null){r=e.memoizedProps;var i=t!==null?t.memoizedProps:r;t=e.type;var o=e.updateQueue;if(e.updateQueue=null,o!==null){for(n[Io]=r,t==="input"&&r.type==="radio"&&r.name!=null&&Dd(n,r),qa(t,i),e=qa(t,r),i=0;i<o.length;i+=2){var s=o[i],l=o[i+1];s==="style"?$d(n,l):s==="dangerouslySetInnerHTML"?jd(n,l):s==="children"?ji(n,l):Lu(n,s,l,e)}switch(t){case"input":ja(n,r);break;case"textarea":Vd(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,o=r.value,o!=null?dr(n,!!r.multiple,o,!1):t!==!!r.multiple&&(r.defaultValue!=null?dr(n,!!r.multiple,r.defaultValue,!0):dr(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(I(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:n=e.stateNode,n.hydrate&&(n.hydrate=!1,Xd(n.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(yh=be(),nf(e.child,!0)),af(e);return;case 19:af(e);return;case 17:return;case 23:case 24:nf(e,e.memoizedState!==null);return}throw Error(I(163))}function af(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new fv),e.forEach(function(r){var i=Ov.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function mv(t,e){return t!==null&&(t=t.memoizedState,t===null||t.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var gv=Math.ceil,Go=Ln.ReactCurrentDispatcher,gh=Ln.ReactCurrentOwner,$=0,Le=null,pe=null,Ie=0,Fn=0,mu=vn(0),Pe=0,sl=null,kr=0,ss=0,Ar=0,vh=0,gu=null,yh=0,vu=1/0;function Fr(){vu=be()+500}var R=null,Uo=!1,yu=null,Et=null,mn=!1,Fi=null,wi=90,Cu=[],Su=[],Dt=null,Ri=0,wu=null,yo=-1,Ft=0,Co=0,Li=null,So=!1;function He(){return($&48)!==0?be():yo!==-1?yo:yo=be()}function an(t){if(t=t.mode,(t&2)===0)return 1;if((t&4)===0)return Or()===99?1:2;if(Ft===0&&(Ft=kr),rv.transition!==0){Co!==0&&(Co=gu!==null?gu.pendingLanes:0),t=Ft;var e=4186112&~Co;return e&=-e,e===0&&(t=4186112&~t,e=t&-t,e===0&&(e=8192)),e}return t=Or(),($&4)!==0&&t===98?t=To(12,Ft):(t=og(t),t=To(t,Ft)),t}function un(t,e,n){if(50<Ri)throw Ri=0,wu=null,Error(I(185));if(t=ol(t,e),t===null)return null;Yo(t,e,n),t===Le&&(Ar|=e,Pe===4&&Cr(t,Ie));var r=Or();e===1?($&8)!==0&&($&48)===0?_u(t):(ot(t,n),$===0&&(Fr(),xt())):(($&4)===0||r!==98&&r!==99||(Dt===null?Dt=new Set([t]):Dt.add(t)),ot(t,n)),gu=t}function ol(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}function ot(t,e){for(var n=t.callbackNode,r=t.suspendedLanes,i=t.pingedLanes,o=t.expirationTimes,s=t.pendingLanes;0<s;){var l=31-dn(s),a=1<<l,u=o[l];if(u===-1){if((a&r)===0||(a&i)!==0){u=e,ir(a);var h=K;o[l]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=e&&(t.expiredLanes|=a);s&=~a}if(r=Gi(t,t===Le?Ie:0),e=K,r===0)n!==null&&(n!==ra&&ru(n),t.callbackNode=null,t.callbackPriority=0);else{if(n!==null){if(t.callbackPriority===e)return;n!==ra&&ru(n)}e===15?(n=_u.bind(null,t),At===null?(At=[n],vo=ih(rl,xp)):At.push(n),n=ra):e===14?n=Hi(99,_u.bind(null,t)):(n=lg(e),n=Hi(n,Jp.bind(null,t))),t.callbackPriority=e,t.callbackNode=n}}function Jp(t){if(yo=-1,Co=Ft=0,($&48)!==0)throw Error(I(327));var e=t.callbackNode;if(yn()&&t.callbackNode!==e)return null;var n=Gi(t,t===Le?Ie:0);if(n===0)return null;var r=n,i=$;$|=16;var o=Zp();(Le!==t||Ie!==r)&&(Fr(),Sr(t,r));do try{Cv();break}catch(l){Yp(t,l)}while(1);if(sh(),Go.current=o,$=i,pe!==null?r=0:(Le=null,Ie=0,r=Pe),(kr&Ar)!==0)Sr(t,0);else if(r!==0){if(r===2&&($|=64,t.hydrate&&(t.hydrate=!1,nh(t.containerInfo)),n=ip(t),n!==0&&(r=_i(t,n))),r===1)throw e=sl,Sr(t,0),Cr(t,n),ot(t,be()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=n,r){case 0:case 1:throw Error(I(345));case 2:Pn(t);break;case 3:if(Cr(t,n),(n&62914560)===n&&(r=yh+500-be(),10<r)){if(Gi(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){He(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Nc(Pn.bind(null,t),r);break}Pn(t);break;case 4:if(Cr(t,n),(n&4186112)===n)break;for(r=t.eventTimes,i=-1;0<n;){var s=31-dn(n);o=1<<s,s=r[s],s>i&&(i=s),n&=~o}if(n=i,n=be()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*gv(n/1960))-n,10<n){t.timeoutHandle=Nc(Pn.bind(null,t),n);break}Pn(t);break;case 5:Pn(t);break;default:throw Error(I(329))}}return ot(t,be()),t.callbackNode===e?Jp.bind(null,t):null}function Cr(t,e){for(e&=~vh,e&=~Ar,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-dn(e),r=1<<n;t[n]=-1,e&=~r}}function _u(t){if(($&48)!==0)throw Error(I(327));if(yn(),t===Le&&(t.expiredLanes&Ie)!==0){var e=Ie,n=_i(t,e);(kr&Ar)!==0&&(e=Gi(t,e),n=_i(t,e))}else e=Gi(t,0),n=_i(t,e);if(t.tag!==0&&n===2&&($|=64,t.hydrate&&(t.hydrate=!1,nh(t.containerInfo)),e=ip(t),e!==0&&(n=_i(t,e))),n===1)throw n=sl,Sr(t,0),Cr(t,e),ot(t,be()),n;return t.finishedWork=t.current.alternate,t.finishedLanes=e,Pn(t),ot(t,be()),null}function vv(){if(Dt!==null){var t=Dt;Dt=null,t.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,ot(e,be())})}xt()}function Qp(t,e){var n=$;$|=1;try{return t(e)}finally{$=n,$===0&&(Fr(),xt())}}function Xp(t,e){var n=$;$&=-2,$|=8;try{return t(e)}finally{$=n,$===0&&(Fr(),xt())}}function js(t,e){se(mu,Fn),Fn|=e,kr|=e}function Ch(){Fn=mu.current,Y(mu)}function Sr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Xg(n)),pe!==null)for(n=pe.return;n!==null;){var r=n;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&ko();break;case 3:xr(),Y($e),Y(ke),uh();break;case 5:ah(r);break;case 4:xr();break;case 13:Y(ie);break;case 19:Y(ie);break;case 10:oh(r);break;case 23:case 24:Ch()}n=n.return}Le=t,pe=gn(t.current,null),Ie=Fn=kr=e,Pe=0,sl=null,vh=Ar=ss=0}function Yp(t,e){do{var n=pe;try{if(sh(),ki.current=Bo,Wo){for(var r=le.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Wo=!1}if(Xi=0,Ee=Ne=le=null,Ai=!1,gh.current=null,n===null||n.return===null){Pe=1,sl=e,pe=null;break}e:{var o=t,s=n.return,l=n,a=e;if(e=Ie,l.flags|=2048,l.firstEffect=l.lastEffect=null,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a;if((l.mode&2)===0){var h=l.alternate;h?(l.updateQueue=h.updateQueue,l.memoizedState=h.memoizedState,l.lanes=h.lanes):(l.updateQueue=null,l.memoizedState=null)}var p=(ie.current&1)!==0,c=s;do{var m;if(m=c.tag===13){var S=c.memoizedState;if(S!==null)m=S.dehydrated!==null;else{var E=c.memoizedProps;m=E.fallback===void 0?!1:E.unstable_avoidThisFallback!==!0?!0:!p}}if(m){var d=c.updateQueue;if(d===null){var f=new Set;f.add(u),c.updateQueue=f}else d.add(u);if((c.mode&2)===0){if(c.flags|=64,l.flags|=16384,l.flags&=-2981,l.tag===1)if(l.alternate===null)l.tag=17;else{var g=on(-1,1);g.tag=2,ln(l,g)}l.lanes|=1;break e}a=void 0,l=e;var y=o.pingCache;if(y===null?(y=o.pingCache=new cv,a=new Set,y.set(u,a)):(a=y.get(u),a===void 0&&(a=new Set,y.set(u,a))),!a.has(l)){a.add(l);var w=Pv.bind(null,o,u,l);u.then(w,w)}c.flags|=4096,c.lanes=e;break e}c=c.return}while(c!==null);a=Error((fr(l.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Pe!==5&&(Pe=2),a=mh(a,l),c=s;do{switch(c.tag){case 3:o=a,c.flags|=4096,e&=-e,c.lanes|=e;var b=qp(c,o,e);Lc(c,b);break e;case 1:o=a;var N=c.type,L=c.stateNode;if((c.flags&64)===0&&(typeof N.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(Et===null||!Et.has(L)))){c.flags|=4096,e&=-e,c.lanes|=e;var k=Hp(c,o,e);Lc(c,k);break e}}c=c.return}while(c!==null)}tm(n)}catch(T){e=T,pe===n&&n!==null&&(pe=n=n.return);continue}break}while(1)}function Zp(){var t=Go.current;return Go.current=Bo,t===null?Bo:t}function _i(t,e){var n=$;$|=16;var r=Zp();Le===t&&Ie===e||Sr(t,e);do try{yv();break}catch(i){Yp(t,i)}while(1);if(sh(),$=n,Go.current=r,pe!==null)throw Error(I(261));return Le=null,Ie=0,Pe}function yv(){for(;pe!==null;)em(pe)}function Cv(){for(;pe!==null&&!ev();)em(pe)}function em(t){var e=rm(t.alternate,t,Fn);t.memoizedProps=t.pendingProps,e===null?tm(t):pe=e,gh.current=null}function tm(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&2048)===0){if(n=uv(n,e,Fn),n!==null){pe=n;return}if(n=e,n.tag!==24&&n.tag!==23||n.memoizedState===null||(Fn&1073741824)!==0||(n.mode&4)===0){for(var r=0,i=n.child;i!==null;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}t!==null&&(t.flags&2048)===0&&(t.firstEffect===null&&(t.firstEffect=e.firstEffect),e.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(t.lastEffect!==null?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}else{if(n=hv(e),n!==null){n.flags&=2047,pe=n;return}t!==null&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(e=e.sibling,e!==null){pe=e;return}pe=e=t}while(e!==null);Pe===0&&(Pe=5)}function Pn(t){var e=Or();return An(99,Sv.bind(null,t,e)),null}function Sv(t,e){do yn();while(Fi!==null);if(($&48)!==0)throw Error(I(327));var n=t.finishedWork;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(I(177));t.callbackNode=null;var r=n.lanes|n.childLanes,i=r,o=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;for(var s=t.eventTimes,l=t.expirationTimes;0<o;){var a=31-dn(o),u=1<<a;i[a]=0,s[a]=-1,l[a]=-1,o&=~u}if(Dt!==null&&(r&24)===0&&Dt.has(t)&&Dt.delete(t),t===Le&&(pe=Le=null,Ie=0),1<n.flags?n.lastEffect!==null?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,r!==null){if(i=$,$|=32,gh.current=null,ea=fo,s=wc(),Ya(s)){if("selectionStart"in s)l={start:s.selectionStart,end:s.selectionEnd};else e:if(l=(l=s.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&u.rangeCount!==0){l=u.anchorNode,o=u.anchorOffset,a=u.focusNode,u=u.focusOffset;try{l.nodeType,a.nodeType}catch{l=null;break e}var h=0,p=-1,c=-1,m=0,S=0,E=s,d=null;t:for(;;){for(var f;E!==l||o!==0&&E.nodeType!==3||(p=h+o),E!==a||u!==0&&E.nodeType!==3||(c=h+u),E.nodeType===3&&(h+=E.nodeValue.length),(f=E.firstChild)!==null;)d=E,E=f;for(;;){if(E===s)break t;if(d===l&&++m===o&&(p=h),d===a&&++S===u&&(c=h),(f=E.nextSibling)!==null)break;E=d,d=E.parentNode}E=f}l=p===-1||c===-1?null:{start:p,end:c}}else l=null;l=l||{start:0,end:0}}else l=null;ta={focusedElem:s,selectionRange:l},fo=!1,Li=null,So=!1,R=r;do try{wv()}catch(T){if(R===null)throw Error(I(330));hn(R,T),R=R.nextEffect}while(R!==null);Li=null,R=r;do try{for(s=t;R!==null;){var g=R.flags;if(g&16&&ji(R.stateNode,""),g&128){var y=R.alternate;if(y!==null){var w=y.ref;w!==null&&(typeof w=="function"?w(null):w.current=null)}}switch(g&1038){case 2:lf(R),R.flags&=-3;break;case 6:lf(R),R.flags&=-3,aa(R.alternate,R);break;case 1024:R.flags&=-1025;break;case 1028:R.flags&=-1025,aa(R.alternate,R);break;case 4:aa(R.alternate,R);break;case 8:l=R,Kp(s,l);var b=l.alternate;sf(l),b!==null&&sf(b)}R=R.nextEffect}}catch(T){if(R===null)throw Error(I(330));hn(R,T),R=R.nextEffect}while(R!==null);if(w=ta,y=wc(),g=w.focusedElem,s=w.selectionRange,y!==g&&g&&g.ownerDocument&&fp(g.ownerDocument.documentElement,g)){for(s!==null&&Ya(g)&&(y=s.start,w=s.end,w===void 0&&(w=y),"selectionStart"in g?(g.selectionStart=y,g.selectionEnd=Math.min(w,g.value.length)):(w=(y=g.ownerDocument||document)&&y.defaultView||window,w.getSelection&&(w=w.getSelection(),l=g.textContent.length,b=Math.min(s.start,l),s=s.end===void 0?b:Math.min(s.end,l),!w.extend&&b>s&&(l=s,s=b,b=l),l=Sc(g,b),o=Sc(g,s),l&&o&&(w.rangeCount!==1||w.anchorNode!==l.node||w.anchorOffset!==l.offset||w.focusNode!==o.node||w.focusOffset!==o.offset)&&(y=y.createRange(),y.setStart(l.node,l.offset),w.removeAllRanges(),b>s?(w.addRange(y),w.extend(o.node,o.offset)):(y.setEnd(o.node,o.offset),w.addRange(y)))))),y=[],w=g;w=w.parentNode;)w.nodeType===1&&y.push({element:w,left:w.scrollLeft,top:w.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<y.length;g++)w=y[g],w.element.scrollLeft=w.left,w.element.scrollTop=w.top}fo=!!ea,ta=ea=null,t.current=n,R=r;do try{for(g=t;R!==null;){var N=R.flags;if(N&36&&pv(g,R.alternate,R),N&128){y=void 0;var L=R.ref;if(L!==null){var k=R.stateNode;switch(R.tag){case 5:y=k;break;default:y=k}typeof L=="function"?L(y):L.current=y}}R=R.nextEffect}}catch(T){if(R===null)throw Error(I(330));hn(R,T),R=R.nextEffect}while(R!==null);R=null,nv(),$=i}else t.current=n;if(mn)mn=!1,Fi=t,wi=e;else for(R=r;R!==null;)e=R.nextEffect,R.nextEffect=null,R.flags&8&&(N=R,N.sibling=null,N.stateNode=null),R=e;if(r=t.pendingLanes,r===0&&(Et=null),r===1?t===wu?Ri++:(Ri=0,wu=t):Ri=0,n=n.stateNode,In&&typeof In.onCommitFiberRoot=="function")try{In.onCommitFiberRoot(rh,n,void 0,(n.current.flags&64)===64)}catch{}if(ot(t,be()),Uo)throw Uo=!1,t=yu,yu=null,t;return($&8)!==0||xt(),null}function wv(){for(;R!==null;){var t=R.alternate;So||Li===null||((R.flags&8)!==0?oc(R,Li)&&(So=!0):R.tag===13&&mv(t,R)&&oc(R,Li)&&(So=!0));var e=R.flags;(e&256)!==0&&dv(t,R),(e&512)===0||mn||(mn=!0,Hi(97,function(){return yn(),null})),R=R.nextEffect}}function yn(){if(wi!==90){var t=97<wi?97:wi;return wi=90,An(t,Ev)}return!1}function _v(t,e){Cu.push(e,t),mn||(mn=!0,Hi(97,function(){return yn(),null}))}function nm(t,e){Su.push(e,t),mn||(mn=!0,Hi(97,function(){return yn(),null}))}function Ev(){if(Fi===null)return!1;var t=Fi;if(Fi=null,($&48)!==0)throw Error(I(331));var e=$;$|=32;var n=Su;Su=[];for(var r=0;r<n.length;r+=2){var i=n[r],o=n[r+1],s=i.destroy;if(i.destroy=void 0,typeof s=="function")try{s()}catch(a){if(o===null)throw Error(I(330));hn(o,a)}}for(n=Cu,Cu=[],r=0;r<n.length;r+=2){i=n[r],o=n[r+1];try{var l=i.create;i.destroy=l()}catch(a){if(o===null)throw Error(I(330));hn(o,a)}}for(l=t.current.firstEffect;l!==null;)t=l.nextEffect,l.nextEffect=null,l.flags&8&&(l.sibling=null,l.stateNode=null),l=t;return $=e,xt(),!0}function uf(t,e,n){e=mh(n,e),e=qp(t,e,1),ln(t,e),e=He(),t=ol(t,1),t!==null&&(Yo(t,1,e),ot(t,e))}function hn(t,e){if(t.tag===3)uf(t,t,e);else for(var n=t.return;n!==null;){if(n.tag===3){uf(n,t,e);break}else if(n.tag===1){var r=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Et===null||!Et.has(r))){t=mh(e,t);var i=Hp(n,t,1);if(ln(n,i),i=He(),n=ol(n,1),n!==null)Yo(n,1,i),ot(n,i);else if(typeof r.componentDidCatch=="function"&&(Et===null||!Et.has(r)))try{r.componentDidCatch(e,t)}catch{}break}}n=n.return}}function Pv(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=He(),t.pingedLanes|=t.suspendedLanes&n,Le===t&&(Ie&n)===n&&(Pe===4||Pe===3&&(Ie&62914560)===Ie&&500>be()-yh?Sr(t,0):vh|=n),ot(t,e)}function Ov(t,e){var n=t.stateNode;n!==null&&n.delete(e),e=0,e===0&&(e=t.mode,(e&2)===0?e=1:(e&4)===0?e=Or()===99?1:2:(Ft===0&&(Ft=kr),e=sr(62914560&~Ft),e===0&&(e=4194304))),n=He(),t=ol(t,e),t!==null&&(Yo(t,e,n),ot(t,n))}var rm;rm=function(t,e,n){var r=e.lanes;if(t!==null)if(t.memoizedProps!==e.pendingProps||$e.current)pt=!0;else if((n&r)!==0)pt=(t.flags&16384)!==0;else{switch(pt=!1,e.tag){case 3:Kc(e),sa();break;case 5:jc(e);break;case 1:Be(e.type)&&go(e);break;case 4:ou(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value;var i=e.type._context;se(Ao,i._currentValue),i._currentValue=r;break;case 13:if(e.memoizedState!==null)return(n&e.child.childLanes)!==0?Jc(t,e,n):(se(ie,ie.current&1),e=Lt(t,e,n),e!==null?e.sibling:null);se(ie,ie.current&1);break;case 19:if(r=(n&e.childLanes)!==0,(t.flags&64)!==0){if(r)return ef(t,e,n);e.flags|=64}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),se(ie,ie.current),r)break;return null;case 23:case 24:return e.lanes=0,oa(t,e,n)}return Lt(t,e,n)}else pt=!1;switch(e.lanes=0,e.tag){case 2:if(r=e.type,t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=Pr(e,ke.current),vr(e,n),i=ch(null,e,r,t,i,n),e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,Be(r)){var o=!0;go(e)}else o=!1;e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,lh(e);var s=r.getDerivedStateFromProps;typeof s=="function"&&Lo(e,r,s,t),i.updater=il,e.stateNode=i,i._reactInternals=e,su(e,r,t,n),e=hu(null,e,r,!0,o,n)}else e.tag=0,Me(null,e,i,n),e=e.child;return e;case 16:i=e.elementType;e:{switch(t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,o=i._init,i=o(i._payload),e.type=i,o=e.tag=Tv(i),t=dt(i,t),o){case 0:e=uu(null,e,i,t,n);break e;case 1:e=Hc(null,e,i,t,n);break e;case 11:e=zc(null,e,i,t,n);break e;case 14:e=qc(null,e,i,dt(i.type,t),r,n);break e}throw Error(I(306,i,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:dt(r,i),uu(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:dt(r,i),Hc(t,e,r,i,n);case 3:if(Kc(e),r=e.updateQueue,t===null||r===null)throw Error(I(282));if(r=e.pendingProps,i=e.memoizedState,i=i!==null?i.element:null,Np(t,e),Ki(e,r,null,n),r=e.memoizedState.element,r===i)sa(),e=Lt(t,e,n);else{if(i=e.stateNode,(o=i.hydrate)&&(tn=gr(e.stateNode.containerInfo.firstChild),Rt=e,o=Ot=!0),o){if(t=i.mutableSourceEagerHydrationData,t!=null)for(i=0;i<t.length;i+=2)o=t[i],o._workInProgressVersionPrimary=t[i+1],yr.push(o);for(n=Ap(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|1024,n=n.sibling}else Me(t,e,r,n),sa();e=e.child}return e;case 5:return jc(e),t===null&&lu(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,s=i.children,tu(r,i)?s=null:o!==null&&tu(r,o)&&(e.flags|=16),Bp(t,e),Me(t,e,s,n),e.child;case 6:return t===null&&lu(e),null;case 13:return Jc(t,e,n);case 4:return ou(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Do(e,null,r,n):Me(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:dt(r,i),zc(t,e,r,i,n);case 7:return Me(t,e,e.pendingProps,n),e.child;case 8:return Me(t,e,e.pendingProps.children,n),e.child;case 12:return Me(t,e,e.pendingProps.children,n),e.child;case 10:e:{r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value;var l=e.type._context;if(se(Ao,l._currentValue),l._currentValue=o,s!==null)if(l=s.value,o=tt(l,o)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(l,o):1073741823)|0,o===0){if(s.children===i.children&&!$e.current){e=Lt(t,e,n);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var a=l.dependencies;if(a!==null){s=l.child;for(var u=a.firstContext;u!==null;){if(u.context===r&&(u.observedBits&o)!==0){l.tag===1&&(u=on(-1,n&-n),u.tag=2,ln(l,u)),l.lanes|=n,u=l.alternate,u!==null&&(u.lanes|=n),Tp(l.return,n),a.lanes|=n;break}u=u.next}}else s=l.tag===10&&l.type===e.type?null:l.child;if(s!==null)s.return=l;else for(s=l;s!==null;){if(s===e){s=null;break}if(l=s.sibling,l!==null){l.return=s.return,s=l;break}s=s.return}l=s}Me(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,o=e.pendingProps,r=o.children,vr(e,n),i=st(i,o.unstable_observedBits),r=r(i),e.flags|=1,Me(t,e,r,n),e.child;case 14:return i=e.type,o=dt(i,e.pendingProps),o=dt(i.type,o),qc(t,e,i,o,r,n);case 15:return $p(t,e,e.type,e.pendingProps,r,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:dt(r,i),t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,Be(r)?(t=!0,go(e)):t=!1,vr(e,n),Ip(e,r,i),su(e,r,i,n),hu(null,e,r,!0,t,n);case 19:return ef(t,e,n);case 23:return oa(t,e,n);case 24:return oa(t,e,n)}throw Error(I(156,e.tag))};function xv(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function nt(t,e,n,r){return new xv(t,e,n,r)}function Sh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Tv(t){if(typeof t=="function")return Sh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Jo)return 11;if(t===Qo)return 14}return 2}function gn(t,e){var n=t.alternate;return n===null?(n=nt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function wo(t,e,n,r,i,o){var s=2;if(r=t,typeof t=="function")Sh(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case Yt:return wr(n.children,i,o,e);case Fd:s=8,i|=16;break;case Du:s=8,i|=1;break;case Pi:return t=nt(12,n,e,i|8),t.elementType=Pi,t.type=Pi,t.lanes=o,t;case Oi:return t=nt(13,n,e,i),t.type=Oi,t.elementType=Oi,t.lanes=o,t;case Eo:return t=nt(19,n,e,i),t.elementType=Eo,t.lanes=o,t;case Bu:return wh(n,i,o,e);case Va:return t=nt(24,n,e,i),t.elementType=Va,t.lanes=o,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Vu:s=10;break e;case Wu:s=9;break e;case Jo:s=11;break e;case Qo:s=14;break e;case ju:s=16,r=null;break e;case Mu:s=22;break e}throw Error(I(130,t==null?t:typeof t,""))}return e=nt(s,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function wr(t,e,n,r){return t=nt(7,t,r,e),t.lanes=n,t}function wh(t,e,n,r){return t=nt(23,t,r,e),t.elementType=Bu,t.lanes=n,t}function ua(t,e,n){return t=nt(6,t,null,e),t.lanes=n,t}function ha(t,e,n){return e=nt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Nv(t,e,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Hl(0),this.expirationTimes=Hl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hl(0),this.mutableSourceEagerHydrationData=null}function bv(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:On,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function zo(t,e,n,r){var i=e.current,o=He(),s=an(i);e:if(n){n=n._reactInternals;t:{if(Dn(n)!==n||n.tag!==1)throw Error(I(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(Be(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(l!==null);throw Error(I(171))}if(n.tag===1){var a=n.type;if(Be(a)){n=Sp(n,a,l);break e}}n=l}else n=pn;return e.context===null?e.context=n:e.pendingContext=n,e=on(o,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),ln(i,e),un(i,s,o),s}function ca(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function hf(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function _h(t,e){hf(t,e),(t=t.alternate)&&hf(t,e)}function Iv(){return null}function Eh(t,e,n){var r=n!=null&&n.hydrationOptions!=null&&n.hydrationOptions.mutableSources||null;if(n=new Nv(t,e,n!=null&&n.hydrate===!0),e=nt(3,null,null,e===2?7:e===1?3:0),n.current=e,e.stateNode=n,lh(e),t[Ir]=n.current,mp(t.nodeType===8?t.parentNode:t),r)for(t=0;t<r.length;t++){e=r[t];var i=e._getVersion;i=i(e._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[e,i]:n.mutableSourceEagerHydrationData.push(e,i)}this._internalRoot=n}Eh.prototype.render=function(t){zo(t,this._internalRoot,null,null)};Eh.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;zo(null,t,null,function(){e[Ir]=null})};function os(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function kv(t,e){if(e||(e=t?t.nodeType===9?t.documentElement:t.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new Eh(t,0,e?{hydrate:!0}:void 0)}function ll(t,e,n,r,i){var o=n._reactRootContainer;if(o){var s=o._internalRoot;if(typeof i=="function"){var l=i;i=function(){var u=ca(s);l.call(u)}}zo(e,s,t,i)}else{if(o=n._reactRootContainer=kv(n,r),s=o._internalRoot,typeof i=="function"){var a=i;i=function(){var u=ca(s);a.call(u)}}Xp(function(){zo(e,s,t,i)})}return ca(s)}Kd=function(t){if(t.tag===13){var e=He();un(t,4,e),_h(t,4)}};Hu=function(t){if(t.tag===13){var e=He();un(t,67108864,e),_h(t,67108864)}};Jd=function(t){if(t.tag===13){var e=He(),n=an(t);un(t,n,e),_h(t,n)}};Qd=function(t,e){return e()};Ha=function(t,e,n){switch(e){case"input":if(ja(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=nl(r);if(!i)throw Error(I(90));Ld(r),ja(r,i)}}}break;case"textarea":Vd(t,n);break;case"select":e=n.value,e!=null&&dr(t,!!n.multiple,e,!1)}};Uu=Qp;Ud=function(t,e,n,r,i){var o=$;$|=4;try{return An(98,t.bind(null,e,n,r,i))}finally{$=o,$===0&&(Fr(),xt())}};zu=function(){($&49)===0&&(vv(),yn())};zd=function(t,e){var n=$;$|=2;try{return t(e)}finally{$=n,$===0&&(Fr(),xt())}};function im(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!os(e))throw Error(I(200));return bv(t,e,null,n)}var Av={Events:[rs,ur,nl,Bd,Gd,yn,{current:!1}]},ii={findFiberByHostInstance:Tn,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},Fv={bundleType:ii.bundleType,version:ii.version,rendererPackageName:ii.rendererPackageName,rendererConfig:ii.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ln.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Hd(t),t===null?null:t.stateNode},findFiberByHostInstance:ii.findFiberByHostInstance||Iv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Ms=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ms.isDisabled&&Ms.supportsFiber)try{rh=Ms.inject(Fv),In=Ms}catch{}}lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Av;lt.createPortal=im;lt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(I(188)):Error(I(268,Object.keys(t)));return t=Hd(e),t=t===null?null:t.stateNode,t};lt.flushSync=function(t,e){var n=$;if((n&48)!==0)return t(e);$|=1;try{if(t)return An(99,t.bind(null,e))}finally{$=n,xt()}};lt.hydrate=function(t,e,n){if(!os(e))throw Error(I(200));return ll(null,t,e,!0,n)};lt.render=function(t,e,n){if(!os(e))throw Error(I(200));return ll(null,t,e,!1,n)};lt.unmountComponentAtNode=function(t){if(!os(t))throw Error(I(40));return t._reactRootContainer?(Xp(function(){ll(null,null,t,!1,function(){t._reactRootContainer=null,t[Ir]=null})}),!0):!1};lt.unstable_batchedUpdates=Qp;lt.unstable_createPortal=function(t,e){return im(t,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};lt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!os(n))throw Error(I(200));if(t==null||t._reactInternals===void 0)throw Error(I(38));return ll(t,e,n,!1,r)};lt.version="17.0.2";function sm(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(sm)}catch(t){console.error(t)}}sm(),bd.exports=lt;var ME=bd.exports;function Rv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function cf(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ff(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?cf(Object(n),!0).forEach(function(r){Rv(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cf(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Lv(t,e){return Dv(t)||Vv(t,e)||Wv(t,e)||jv()}function Dv(t){if(Array.isArray(t))return t}function Vv(t,e){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var s=t[Symbol.iterator](),l;!(r=(l=s.next()).done)&&(n.push(l.value),!(e&&n.length===e));r=!0);}catch(a){i=!0,o=a}finally{try{!r&&s.return!=null&&s.return()}finally{if(i)throw o}}return n}}function Wv(t,e){if(!!t){if(typeof t=="string")return df(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return df(t,e)}}function df(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function jv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pf(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function mf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pf(Object(n),!0).forEach(function(r){Mv(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pf(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function $v(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){return e.reduceRight(function(i,o){return o(i)},r)}}function Ei(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return i.length>=t.length?t.apply(this,i):function(){for(var s=arguments.length,l=new Array(s),a=0;a<s;a++)l[a]=arguments[a];return e.apply(n,[].concat(i,l))}}}function qo(t){return{}.toString.call(t).includes("Object")}function Bv(t){return!Object.keys(t).length}function Yi(t){return typeof t=="function"}function Gv(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Uv(t,e){return qo(e)||cn("changeType"),Object.keys(e).some(function(n){return!Gv(t,n)})&&cn("changeField"),e}function zv(t){Yi(t)||cn("selectorType")}function qv(t){Yi(t)||qo(t)||cn("handlerType"),qo(t)&&Object.values(t).some(function(e){return!Yi(e)})&&cn("handlersType")}function Hv(t){t||cn("initialIsRequired"),qo(t)||cn("initialType"),Bv(t)&&cn("initialContent")}function Kv(t,e){throw new Error(t[e]||t.default)}var Jv={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},cn=Ei(Kv)(Jv),$s={changes:Uv,selector:zv,handler:qv,initial:Hv};function Qv(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$s.initial(t),$s.handler(e);var n={current:t},r=Ei(Zv)(n,e),i=Ei(Yv)(n),o=Ei($s.changes)(t),s=Ei(Xv)(n);function l(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(h){return h};return $s.selector(u),u(n.current)}function a(u){$v(r,i,o,s)(u)}return[l,a]}function Xv(t,e){return Yi(e)?e(t.current):e}function Yv(t,e){return t.current=mf(mf({},t.current),e),e}function Zv(t,e,n){return Yi(e)?e(t.current):Object.keys(n).forEach(function(r){var i;return(i=e[r])===null||i===void 0?void 0:i.call(e,t.current[r])}),n}var ey={create:Qv},ty={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.28.1/min/vs"}};function ny(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return i.length>=t.length?t.apply(this,i):function(){for(var s=arguments.length,l=new Array(s),a=0;a<s;a++)l[a]=arguments[a];return e.apply(n,[].concat(i,l))}}}function ry(t){return{}.toString.call(t).includes("Object")}function iy(t){return t||gf("configIsRequired"),ry(t)||gf("configType"),t.urls?(sy(),{paths:{vs:t.urls.monacoBase}}):t}function sy(){console.warn(om.deprecation)}function oy(t,e){throw new Error(t[e]||t.default)}var om={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},gf=ny(oy)(om),ly={config:iy},ay=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(i){return n.reduceRight(function(o,s){return s(o)},i)}};function lm(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],lm(t[n],e[n]))}),ff(ff({},t),e)}var uy={type:"cancelation",msg:"operation is manually canceled"};function vf(t){var e=!1,n=new Promise(function(r,i){t.then(function(o){return e?i(uy):r(o)}),t.catch(i)});return n.cancel=function(){return e=!0},n}var hy=ey.create({config:ty,isInitialized:!1,resolve:null,reject:null,monaco:null}),am=Lv(hy,2),ls=am[0],al=am[1];function cy(t){al(function(e){return{config:lm(e.config,ly.config(t))}})}function fy(){var t=ls(function(e){var n=e.isInitialized;return{isInitialized:n}});if(!t.isInitialized){if(window.monaco&&window.monaco.editor)return um(window.monaco),vf(Promise.resolve(window.monaco));ay(dy,my)(gy),al({isInitialized:!0})}return vf(yy)}function dy(t){return document.body.appendChild(t)}function py(t){var e=document.createElement("script");return t&&(e.src=t),e}function my(t){var e=ls(function(r){var i=r.config,o=r.reject;return{config:i,reject:o}}),n=py("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function gy(){var t=ls(function(n){var r=n.config,i=n.resolve,o=n.reject;return{config:r,resolve:i,reject:o}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){um(n),t.resolve(n)},function(n){t.reject(n)})}function um(t){ls().monaco||al({monaco:t})}function vy(){return ls(function(t){var e=t.monaco;return e})}var yy=new Promise(function(t,e){return al({resolve:t,reject:e})}),Eu={config:cy,init:fy,__getMonacoInstance:vy},hm={exports:{}},Cy="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Sy=Cy,wy=Sy;function cm(){}function fm(){}fm.resetWarningCache=cm;var _y=function(){function t(r,i,o,s,l,a){if(a!==wy){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:fm,resetWarningCache:cm};return n.PropTypes=n,n};hm.exports=_y();var D=hm.exports;function Pu(){return Pu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Pu.apply(this,arguments)}const Ey={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function Py({content:t}){return ho.createElement("div",{style:Ey},t)}const fa={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function dm({width:t,height:e,isEditorReady:n,loading:r,_ref:i,className:o,wrapperProps:s}){return ho.createElement("section",Pu({style:qh(qr({},fa.wrapper),{width:t,height:e})},s),!n&&ho.createElement(Py,{content:r}),ho.createElement("div",{ref:i,style:qr(qr({},fa.fullWidth),!n&&fa.hide),className:o}))}dm.propTypes={width:D.oneOfType([D.number,D.string]).isRequired,height:D.oneOfType([D.number,D.string]).isRequired,loading:D.oneOfType([D.element,D.string]).isRequired,isEditorReady:D.bool.isRequired,className:D.string,wrapperProps:D.object};var Oy=J.exports.memo(dm);function pm(t){J.exports.useEffect(t,[])}function Jn(t,e,n=!0){const r=J.exports.useRef(!0);J.exports.useEffect(r.current||!n?()=>{r.current=!1}:t,e)}function da(){}function yf(t,e,n,r){return xy(t,r)||Ty(t,e,n,r)}function xy(t,e){return t.editor.getModel(mm(t,e))}function Ty(t,e,n,r){return t.editor.createModel(e,n,r&&mm(t,r))}function mm(t,e){return t.Uri.parse(e)}function Ny(t){return t===void 0}var Ph={exports:{}},as={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var by=J.exports,gm=60103;as.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var Cf=Symbol.for;gm=Cf("react.element"),as.Fragment=Cf("react.fragment")}var Iy=by.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ky=Object.prototype.hasOwnProperty,Ay={key:!0,ref:!0,__self:!0,__source:!0};function vm(t,e,n){var r,i={},o=null,s=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)ky.call(e,r)&&!Ay.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:gm,type:t,key:o,ref:s,props:i,_owner:Iy.current}}as.jsx=vm;as.jsxs=vm;Ph.exports=as;const Fy=Ph.exports.jsx,$E=Ph.exports.jsxs;D.string,D.string,D.string,D.string,D.string,D.string,D.string,D.bool,D.bool,D.string,D.oneOfType([D.element,D.string]),D.object,D.oneOfType([D.number,D.string]),D.oneOfType([D.number,D.string]),D.string,D.object,D.func,D.func;function BE(){const[t,e]=J.exports.useState(Eu.__getMonacoInstance());return pm(()=>{let n;return t||(n=Eu.init(),n.then(r=>{e(r)})),()=>{var r;return(r=n)===null||r===void 0?void 0:r.cancel()}}),t}function Ry(t){const e=J.exports.useRef();return J.exports.useEffect(()=>{e.current=t},[t]),e.current}const Bs=new Map;function Oh({defaultValue:t,defaultLanguage:e,defaultPath:n,value:r,language:i,path:o,theme:s,line:l,loading:a,options:u,overrideServices:h,saveViewState:p,keepCurrentModel:c,width:m,height:S,className:E,wrapperProps:d,beforeMount:f,onMount:g,onChange:y,onValidate:w}){const[b,N]=J.exports.useState(!1),[L,k]=J.exports.useState(!0),T=J.exports.useRef(null),j=J.exports.useRef(null),ze=J.exports.useRef(null),ce=J.exports.useRef(g),G=J.exports.useRef(f),Je=J.exports.useRef(null),v=J.exports.useRef(r),C=Ry(o);pm(()=>{const O=Eu.init();return O.then(F=>(T.current=F)&&k(!1)).catch(F=>(F==null?void 0:F.type)!=="cancelation"&&console.error("Monaco initialization: error:",F)),()=>j.current?P():O.cancel()}),Jn(()=>{const O=yf(T.current,t||r,e||i,o);O!==j.current.getModel()&&(p&&Bs.set(C,j.current.saveViewState()),j.current.setModel(O),p&&j.current.restoreViewState(Bs.get(o)))},[o],b),Jn(()=>{j.current.updateOptions(u)},[u],b),Jn(()=>{j.current.getOption(T.current.editor.EditorOption.readOnly)?j.current.setValue(r):r!==j.current.getValue()&&(j.current.executeEdits("",[{range:j.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),j.current.pushUndoStop())},[r],b),Jn(()=>{T.current.editor.setModelLanguage(j.current.getModel(),i)},[i],b),Jn(()=>{Ny(l)||j.current.revealLine(l)},[l],b),Jn(()=>{T.current.editor.setTheme(s)},[s],b);const _=J.exports.useCallback(()=>{G.current(T.current);const O=o||n,F=yf(T.current,r||t,e||i,O);j.current=T.current.editor.create(ze.current,qr({model:F,automaticLayout:!0},u),h),p&&j.current.restoreViewState(Bs.get(O)),T.current.editor.setTheme(s),N(!0)},[t,e,n,r,i,o,u,h,p,s]);J.exports.useEffect(()=>{b&&ce.current(j.current,T.current)},[b]),J.exports.useEffect(()=>{!L&&!b&&_()},[L,b,_]),v.current=r,J.exports.useEffect(()=>{if(b&&y){var O,F;(O=Je.current)===null||O===void 0||O.dispose(),Je.current=(F=j.current)===null||F===void 0?void 0:F.onDidChangeModelContent(x=>{const A=j.current.getValue();v.current!==A&&y(A,x)})}},[b,y]),J.exports.useEffect(()=>{if(b){const O=T.current.editor.onDidChangeMarkers(F=>{var x;const A=(x=j.current.getModel())===null||x===void 0?void 0:x.uri;if(A&&F.find(z=>z.path===A.path)){const z=T.current.editor.getModelMarkers({resource:A});w==null||w(z)}});return()=>{O==null||O.dispose()}}},[b,w]);function P(){var O;if((O=Je.current)===null||O===void 0||O.dispose(),c)p&&Bs.set(o,j.current.saveViewState());else{var F;(F=j.current.getModel())===null||F===void 0||F.dispose()}j.current.dispose()}return Fy(Oy,{width:m,height:S,isEditorReady:b,loading:a,_ref:ze,className:E,wrapperProps:d})}Oh.propTypes={defaultValue:D.string,defaultPath:D.string,defaultLanguage:D.string,value:D.string,language:D.string,path:D.string,theme:D.string,line:D.number,loading:D.oneOfType([D.element,D.string]),options:D.object,overrideServices:D.object,saveViewState:D.bool,keepCurrentModel:D.bool,width:D.oneOfType([D.number,D.string]),height:D.oneOfType([D.number,D.string]),className:D.string,wrapperProps:D.object,beforeMount:D.func,onMount:D.func,onChange:D.func,onValidate:D.func};Oh.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:da,onMount:da,onValidate:da};var GE=J.exports.memo(Oh),Ly={},Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.CompilerOptions=void 0;class Dy{constructor(e=null,n=[],r=!1,i=null,o=null){this.sourceFilename=e,this.pluginNames=n,this.countAllVisits=r,this.errorHandler=i,this.fileHandler=o}}Zi.CompilerOptions=Dy;var ul={};Object.defineProperty(ul,"__esModule",{value:!0});ul.DebugSourceRange=void 0;class Vy{constructor(e,n,r){this.length=e,this.debugMetadata=n,this.text=r}}ul.DebugSourceRange=Vy;var hl={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(t.ErrorType||(t.ErrorType={}))})(hl);var cl={},fl={};Object.defineProperty(fl,"__esModule",{value:!0});fl.Argument=void 0;class Wy{constructor(e=null,n=null,r=null){this.identifier=e,this.isByReference=n,this.isDivertTarget=r}}fl.Argument=Wy;var Rr={},Z={},B={};Object.defineProperty(B,"__esModule",{value:!0});B.filterUndef=B.isEquatable=B.nullIfUndefined=B.asINamedContentOrNull=B.asBooleanOrThrows=B.asNumberOrThrows=B.asOrThrows=B.asOrNull=void 0;function jy(t,e){return t instanceof e?ym(t):null}B.asOrNull=jy;function My(t,e){if(t instanceof e)return ym(t);throw new Error(`${t} is not of type ${e}`)}B.asOrThrows=My;function $y(t){if(typeof t=="number")return t;throw new Error(`${t} is not a number`)}B.asNumberOrThrows=$y;function By(t){if(typeof t=="boolean")return t;throw new Error(`${t} is not a boolean`)}B.asBooleanOrThrows=By;function Gy(t){return t.hasValidName&&t.name?t:null}B.asINamedContentOrNull=Gy;function Uy(t){return typeof t=="undefined"?null:t}B.nullIfUndefined=Uy;function zy(t){return typeof t=="object"&&typeof t.Equals=="function"}B.isEquatable=zy;function ym(t,e){return t}function qy(t){return t!=null}B.filterUndef=qy;Object.defineProperty(Z,"__esModule",{value:!0});Z.ParsedObject=void 0;const Sf=B;class Hy{constructor(){this._alreadyHadError=!1,this._alreadyHadWarning=!1,this._debugMetadata=null,this._runtimeObject=null,this.content=[],this.parent=null,this.GetType=()=>this.typeName,this.AddContent=e=>{this.content===null&&(this.content=[]);const n=Array.isArray(e)?e:[e];for(const r of n)r.hasOwnProperty("parent")&&(r.parent=this),this.content.push(r);if(!Array.isArray(e))return e},this.InsertContent=(e,n)=>(this.content===null&&(this.content=[]),n.parent=this,this.content.splice(e,0,n),n),this.Find=e=>(n=null)=>{let r=Sf.asOrNull(this,e);if(r!==null&&(n===null||n(r)===!0))return r;if(this.content===null)return null;for(const i of this.content){let o=i.Find&&i.Find(e)(n);if(o)return o}return null},this.FindAll=e=>(n,r)=>{const i=Array.isArray(r)?r:[],o=Sf.asOrNull(this,e);if(o!==null&&(!n||n(o)===!0)&&i.push(o),this.content===null)return[];for(const s of this.content)s.FindAll&&s.FindAll(e)(n,i);return i},this.Warning=(e,n=null)=>{this.Error(e,n,!0)}}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get hasOwnDebugMetadata(){return Boolean(this.debugMetadata)}get typeName(){return"ParsedObject"}get story(){let e=this;for(;e.parent;)e=e.parent;return e}get runtimeObject(){return this._runtimeObject||(this._runtimeObject=this.GenerateRuntimeObject(),this._runtimeObject&&(this._runtimeObject.debugMetadata=this.debugMetadata)),this._runtimeObject}set runtimeObject(e){this._runtimeObject=e}get runtimePath(){if(!this.runtimeObject.path)throw new Error;return this.runtimeObject.path}get containerForCounting(){return this.runtimeObject}get ancestry(){let e=[],n=this.parent;for(;n;)e.push(n),n=n.parent;return e=e.reverse(),e}ResolveReferences(e){if(this.content!==null)for(const n of this.content)n.ResolveReferences(e)}Error(e,n=null,r=!1){if(n===null&&(n=this),!(n._alreadyHadError&&!r||n._alreadyHadWarning&&r)){if(this.parent)this.parent.Error(e,n,r);else throw new Error(`No parent object to send error to: ${e}`);r?n._alreadyHadWarning=!0:n._alreadyHadError=!0}}}Z.ParsedObject=Hy;Object.defineProperty(Rr,"__esModule",{value:!0});Rr.AuthorWarning=void 0;const Ky=Z;class Jy extends Ky.ParsedObject{constructor(e){super();this.warningMessage=e,this.GenerateRuntimeObject=()=>(this.Warning(this.warningMessage),null)}get typeName(){return"AuthorWarning"}}Rr.AuthorWarning=Jy;var us={},Ge={},he={},re={},Ae={},Ue={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Path=void 0;class e{constructor(){if(this._components=[],this._componentsString=null,this._isRelative=!1,typeof arguments[0]=="string"){let r=arguments[0];this.componentsString=r}else if(arguments[0]instanceof e.Component&&arguments[1]instanceof e){let r=arguments[0],i=arguments[1];this._components.push(r),this._components=this._components.concat(i._components)}else if(arguments[0]instanceof Array){let r=arguments[0],i=!!arguments[1];this._components=this._components.concat(r),this._isRelative=i}}get isRelative(){return this._isRelative}get componentCount(){return this._components.length}get head(){return this._components.length>0?this._components[0]:null}get tail(){if(this._components.length>=2){let r=this._components.slice(1,this._components.length);return new e(r)}else return e.self}get length(){return this._components.length}get lastComponent(){let r=this._components.length-1;return r>=0?this._components[r]:null}get containsNamedComponent(){for(let r=0,i=this._components.length;r<i;r++)if(!this._components[r].isIndex)return!0;return!1}static get self(){let r=new e;return r._isRelative=!0,r}GetComponent(r){return this._components[r]}PathByAppendingPath(r){let i=new e,o=0;for(let s=0;s<r._components.length&&r._components[s].isParent;++s)o++;for(let s=0;s<this._components.length-o;++s)i._components.push(this._components[s]);for(let s=o;s<r._components.length;++s)i._components.push(r._components[s]);return i}get componentsString(){return this._componentsString==null&&(this._componentsString=this._components.join("."),this.isRelative&&(this._componentsString="."+this._componentsString)),this._componentsString}set componentsString(r){if(this._components.length=0,this._componentsString=r,this._componentsString==null||this._componentsString=="")return;this._componentsString[0]=="."&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));let i=this._componentsString.split(".");for(let o of i)/^(\-|\+)?([0-9]+|Infinity)$/.test(o)?this._components.push(new e.Component(parseInt(o))):this._components.push(new e.Component(o))}toString(){return this.componentsString}Equals(r){if(r==null||r._components.length!=this._components.length||r.isRelative!=this.isRelative)return!1;for(let i=0,o=r._components.length;i<o;i++)if(!r._components[i].Equals(this._components[i]))return!1;return!0}PathByAppendingComponent(r){let i=new e;return i._components.push(...this._components),i._components.push(r),i}}t.Path=e,e.parentId="^",function(n){class r{constructor(o){this.index=-1,this.name=null,typeof o=="string"?this.name=o:this.index=o}get isIndex(){return this.index>=0}get isParent(){return this.name==n.parentId}static ToParent(){return new r(n.parentId)}toString(){return this.isIndex?this.index.toString():this.name}Equals(o){return o!=null&&o.isIndex==this.isIndex?this.isIndex?this.index==o.index:this.name==o.name:!1}}n.Component=r}(e=t.Path||(t.Path={}))})(Ue);var hs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Debug=void 0,function(e){function n(i,o,s){r(i instanceof o,s)}e.AssertType=n;function r(i,o){if(!i)throw typeof o!="undefined"&&console.warn(o),console.trace&&console.trace(),new Error("")}e.Assert=r}(t.Debug||(t.Debug={}))})(hs);var ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.throwNullException=ue.NullException=void 0;class Cm extends Error{}ue.NullException=Cm;function Qy(t){throw new Cm(`${t} is null or undefined`)}ue.throwNullException=Qy;Object.defineProperty(Ae,"__esModule",{value:!0});Ae.InkObject=void 0;const Qn=Ue,si=he,pa=hs,Xn=B,Gs=ue;class Xy{constructor(){this.parent=null,this._debugMetadata=null,this._path=null}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get ownDebugMetadata(){return this._debugMetadata}DebugLineNumberOfPath(e){if(e===null)return null;let n=this.rootContentContainer;if(n){let r=n.ContentAtPath(e).obj;if(r){let i=r.debugMetadata;if(i!==null)return i.startLineNumber}}return null}get path(){if(this._path==null)if(this.parent==null)this._path=new Qn.Path;else{let e=[],n=this,r=Xn.asOrNull(n.parent,si.Container);for(;r!==null;){let i=Xn.asINamedContentOrNull(n);if(i!=null&&i.hasValidName){if(i.name===null)return Gs.throwNullException("namedChild.name");e.unshift(new Qn.Path.Component(i.name))}else e.unshift(new Qn.Path.Component(r.content.indexOf(n)));n=r,r=Xn.asOrNull(r.parent,si.Container)}this._path=new Qn.Path(e)}return this._path}ResolvePath(e){if(e===null)return Gs.throwNullException("path");if(e.isRelative){let n=Xn.asOrNull(this,si.Container);return n===null&&(pa.Debug.Assert(this.parent!==null,"Can't resolve relative path because we don't have a parent"),n=Xn.asOrNull(this.parent,si.Container),pa.Debug.Assert(n!==null,"Expected parent to be a container"),pa.Debug.Assert(e.GetComponent(0).isParent),e=e.tail),n===null?Gs.throwNullException("nearestContainer"):n.ContentAtPath(e)}else{let n=this.rootContentContainer;return n===null?Gs.throwNullException("contentContainer"):n.ContentAtPath(e)}}ConvertPathToRelative(e){let n=this.path,r=Math.min(e.length,n.length),i=-1;for(let a=0;a<r;++a){let u=n.GetComponent(a),h=e.GetComponent(a);if(u.Equals(h))i=a;else break}if(i==-1)return e;let o=n.componentCount-1-i,s=[];for(let a=0;a<o;++a)s.push(Qn.Path.Component.ToParent());for(let a=i+1;a<e.componentCount;++a)s.push(e.GetComponent(a));return new Qn.Path(s,!0)}CompactPathString(e){let n=null,r=null;return e.isRelative?(r=e.componentsString,n=this.path.PathByAppendingPath(e).componentsString):(r=this.ConvertPathToRelative(e).componentsString,n=e.componentsString),r.length<n.length?r:n}get rootContentContainer(){let e=this;for(;e.parent;)e=e.parent;return Xn.asOrNull(e,si.Container)}Copy(){throw Error("Not Implemented: Doesn't support copying")}SetChild(e,n,r){e[n]&&(e[n]=null),e[n]=r,e[n]&&(e[n].parent=this)}Equals(e){return e===this}}Ae.InkObject=Xy;var Ce={},jt={};Object.defineProperty(jt,"__esModule",{value:!0});jt.StringBuilder=void 0;class Yy{constructor(e){e=typeof e!="undefined"?e.toString():"",this.string=e}get Length(){return this.string.length}Append(e){e!==null&&(this.string+=e)}AppendLine(e){typeof e!="undefined"&&this.Append(e),this.string+=`
`}AppendFormat(e,...n){this.string+=e.replace(/{(\d+)}/g,(r,i)=>typeof n[i]!="undefined"?n[i]:r)}toString(){return this.string}}jt.StringBuilder=Yy;Object.defineProperty(Ce,"__esModule",{value:!0});Ce.InkList=Ce.InkListItem=void 0;const vt=ue,Zy=jt;class de{constructor(){if(this.originName=null,this.itemName=null,typeof arguments[1]!="undefined"){let e=arguments[0],n=arguments[1];this.originName=e,this.itemName=n}else if(arguments[0]){let n=arguments[0].toString().split(".");this.originName=n[0],this.itemName=n[1]}}static get Null(){return new de(null,null)}get isNull(){return this.originName==null&&this.itemName==null}get fullName(){return(this.originName!==null?this.originName:"?")+"."+this.itemName}toString(){return this.fullName}Equals(e){if(e instanceof de){let n=e;return n.itemName==this.itemName&&n.originName==this.originName}return!1}copy(){return new de(this.originName,this.itemName)}serialized(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}static fromSerializedKey(e){let n=JSON.parse(e);if(!de.isLikeInkListItem(n))return de.Null;let r=n;return new de(r.originName,r.itemName)}static isLikeInkListItem(e){return!(typeof e!="object"||!e.hasOwnProperty("originName")||!e.hasOwnProperty("itemName")||typeof e.originName!="string"&&typeof e.originName!==null||typeof e.itemName!="string"&&typeof e.itemName!==null)}}Ce.InkListItem=de;class fe extends Map{constructor(){super((()=>arguments[0]instanceof fe?arguments[0]:[])());if(this.origins=null,this._originNames=[],arguments[0]instanceof fe){let e=arguments[0];this._originNames=e.originNames,e.origins!==null&&(this.origins=e.origins.slice())}else if(typeof arguments[0]=="string"){let e=arguments[0],n=arguments[1];if(this.SetInitialOriginName(e),n.listDefinitions===null)return vt.throwNullException("originStory.listDefinitions");let r=n.listDefinitions.TryListGetDefinition(e,null);if(r.exists){if(r.result===null)return vt.throwNullException("def.result");this.origins=[r.result]}else throw new Error("InkList origin could not be found in story when constructing new list: "+e)}else if(typeof arguments[0]=="object"&&arguments[0].hasOwnProperty("Key")&&arguments[0].hasOwnProperty("Value")){let e=arguments[0];this.Add(e.Key,e.Value)}}static FromString(e,n){var r;let i=(r=n.listDefinitions)===null||r===void 0?void 0:r.FindSingleItemListWithName(e);if(i)return i.value===null?vt.throwNullException("listValue.value"):new fe(i.value);throw new Error("Could not find the InkListItem from the string '"+e+"' to create an InkList because it doesn't exist in the original list definition in ink.")}AddItem(e){if(e instanceof de){let n=e;if(n.originName==null){this.AddItem(n.itemName);return}if(this.origins===null)return vt.throwNullException("this.origins");for(let r of this.origins)if(r.name==n.originName){let i=r.TryGetValueForItem(n,0);if(i.exists){this.Add(n,i.result);return}else throw new Error("Could not add the item "+n+" to this list because it doesn't exist in the original list definition in ink.")}throw new Error("Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.")}else{let n=e,r=null;if(this.origins===null)return vt.throwNullException("this.origins");for(let s of this.origins){if(n===null)return vt.throwNullException("itemName");if(s.ContainsItemWithName(n)){if(r!=null)throw new Error("Could not add the item "+n+" to this list because it could come from either "+s.name+" or "+r.name);r=s}}if(r==null)throw new Error("Could not add the item "+n+" to this list because it isn't known to any list definitions previously associated with this list.");let i=new de(r.name,n),o=r.ValueForItem(i);this.Add(i,o)}}ContainsItemNamed(e){for(let[n]of this)if(de.fromSerializedKey(n).itemName==e)return!0;return!1}ContainsKey(e){return this.has(e.serialized())}Add(e,n){let r=e.serialized();if(this.has(r))throw new Error(`The Map already contains an entry for ${e}`);this.set(r,n)}Remove(e){return this.delete(e.serialized())}get Count(){return this.size}get originOfMaxItem(){if(this.origins==null)return null;let e=this.maxItem.Key.originName,n=null;return this.origins.every(r=>r.name==e?(n=r,!1):!0),n}get originNames(){if(this.Count>0){this._originNames==null&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);for(let[e]of this){let n=de.fromSerializedKey(e);if(n.originName===null)return vt.throwNullException("item.originName");this._originNames.push(n.originName)}}return this._originNames}SetInitialOriginName(e){this._originNames=[e]}SetInitialOriginNames(e){e==null?this._originNames=null:this._originNames=e.slice()}get maxItem(){let e={Key:de.Null,Value:0};for(let[n,r]of this){let i=de.fromSerializedKey(n);(e.Key.isNull||r>e.Value)&&(e={Key:i,Value:r})}return e}get minItem(){let e={Key:de.Null,Value:0};for(let[n,r]of this){let i=de.fromSerializedKey(n);(e.Key.isNull||r<e.Value)&&(e={Key:i,Value:r})}return e}get inverse(){let e=new fe;if(this.origins!=null)for(let n of this.origins)for(let[r,i]of n.items){let o=de.fromSerializedKey(r);this.ContainsKey(o)||e.Add(o,i)}return e}get all(){let e=new fe;if(this.origins!=null)for(let n of this.origins)for(let[r,i]of n.items){let o=de.fromSerializedKey(r);e.set(o.serialized(),i)}return e}Union(e){let n=new fe(this);for(let[r,i]of e)n.set(r,i);return n}Intersect(e){let n=new fe;for(let[r,i]of this)e.has(r)&&n.set(r,i);return n}Without(e){let n=new fe(this);for(let[r]of e)n.delete(r);return n}Contains(e){for(let[n]of e)if(!this.has(n))return!1;return!0}GreaterThan(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>e.maxItem.Value}GreaterThanOrEquals(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>=e.minItem.Value&&this.maxItem.Value>=e.maxItem.Value}LessThan(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<e.minItem.Value}LessThanOrEquals(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<=e.maxItem.Value&&this.minItem.Value<=e.minItem.Value}MaxAsList(){return this.Count>0?new fe(this.maxItem):new fe}MinAsList(){return this.Count>0?new fe(this.minItem):new fe}ListWithSubRange(e,n){if(this.Count==0)return new fe;let r=this.orderedItems,i=0,o=Number.MAX_SAFE_INTEGER;Number.isInteger(e)?i=e:e instanceof fe&&e.Count>0&&(i=e.minItem.Value),Number.isInteger(n)?o=n:e instanceof fe&&e.Count>0&&(o=n.maxItem.Value);let s=new fe;s.SetInitialOriginNames(this.originNames);for(let l of r)l.Value>=i&&l.Value<=o&&s.Add(l.Key,l.Value);return s}Equals(e){if(!(e instanceof fe)||e.Count!=this.Count)return!1;for(let[n]of this)if(!e.has(n))return!1;return!0}get orderedItems(){let e=new Array;for(let[n,r]of this){let i=de.fromSerializedKey(n);e.push({Key:i,Value:r})}return e.sort((n,r)=>n.Key.originName===null?vt.throwNullException("x.Key.originName"):r.Key.originName===null?vt.throwNullException("y.Key.originName"):n.Value==r.Value?n.Key.originName.localeCompare(r.Key.originName):n.Value<r.Value?-1:n.Value>r.Value?1:0),e}toString(){let e=this.orderedItems,n=new Zy.StringBuilder;for(let r=0;r<e.length;r++){r>0&&n.Append(", ");let i=e[r].Key;if(i.itemName===null)return vt.throwNullException("item.itemName");n.Append(i.itemName)}return n.toString()}valueOf(){return NaN}}Ce.InkList=fe;var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});Wn.StoryException=void 0;class eC extends Error{constructor(e){super(e);this.useEndLineNumber=!1,this.message=e,this.name="StoryException"}}Wn.StoryException=eC;var it={};Object.defineProperty(it,"__esModule",{value:!0});it.tryParseFloat=it.tryParseInt=it.tryGetValueFromMap=void 0;function tC(t,e,n){if(t===null)return{result:n,exists:!1};let r=t.get(e);return typeof r=="undefined"?{result:n,exists:!1}:{result:r,exists:!0}}it.tryGetValueFromMap=tC;function nC(t,e=0){let n=parseInt(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}it.tryParseInt=nC;function rC(t,e=0){let n=parseFloat(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}it.tryParseFloat=rC;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=t.ListValue=t.VariablePointerValue=t.DivertTargetValue=t.StringValue=t.FloatValue=t.IntValue=t.BoolValue=t.Value=t.AbstractValue=void 0;const e=Ae,n=Ue,r=Ce,i=Wn,o=B,s=it,l=ue;class a extends e.InkObject{static Create(y,w){if(w){if(w===f.Int&&Number.isInteger(Number(y)))return new p(Number(y));if(w===f.Float&&!isNaN(y))return new c(Number(y))}if(typeof y=="boolean")return new h(Boolean(y));if(typeof y=="string")return new m(String(y));if(Number.isInteger(Number(y)))return new p(Number(y));if(isNaN(y)){if(y instanceof n.Path)return new S(o.asOrThrows(y,n.Path));if(y instanceof r.InkList)return new d(o.asOrThrows(y,r.InkList))}else return new c(Number(y));return null}Copy(){return o.asOrThrows(a.Create(this.valueObject),e.InkObject)}BadCastException(y){return new i.StoryException("Can't cast "+this.valueObject+" from "+this.valueType+" to "+y)}}t.AbstractValue=a;class u extends a{constructor(y){super();this.value=y}get valueObject(){return this.value}toString(){return this.value===null?l.throwNullException("Value.value"):this.value.toString()}}t.Value=u;class h extends u{constructor(y){super(y||!1)}get isTruthy(){return Boolean(this.value)}get valueType(){return f.Bool}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Int)return new p(this.value?1:0);if(y==f.Float)return new c(this.value?1:0);if(y==f.String)return new m(this.value?"true":"false");throw this.BadCastException(y)}toString(){return this.value?"true":"false"}}t.BoolValue=h;class p extends u{constructor(y){super(y||0)}get isTruthy(){return this.value!=0}get valueType(){return f.Int}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Bool)return new h(this.value!==0);if(y==f.Float)return new c(this.value);if(y==f.String)return new m(""+this.value);throw this.BadCastException(y)}}t.IntValue=p;class c extends u{constructor(y){super(y||0)}get isTruthy(){return this.value!=0}get valueType(){return f.Float}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Bool)return new h(this.value!==0);if(y==f.Int)return new p(this.value);if(y==f.String)return new m(""+this.value);throw this.BadCastException(y)}}t.FloatValue=c;class m extends u{constructor(y){super(y||"");if(this._isNewline=this.value==`
`,this._isInlineWhitespace=!0,this.value===null)return l.throwNullException("Value.value");this.value.length>0&&this.value.split("").every(w=>w!=" "&&w!="	"?(this._isInlineWhitespace=!1,!1):!0)}get valueType(){return f.String}get isTruthy(){return this.value===null?l.throwNullException("Value.value"):this.value.length>0}get isNewline(){return this._isNewline}get isInlineWhitespace(){return this._isInlineWhitespace}get isNonWhitespace(){return!this.isNewline&&!this.isInlineWhitespace}Cast(y){if(y==this.valueType)return this;if(y==f.Int){let w=s.tryParseInt(this.value);if(w.exists)return new p(w.result);throw this.BadCastException(y)}if(y==f.Float){let w=s.tryParseFloat(this.value);if(w.exists)return new c(w.result);throw this.BadCastException(y)}throw this.BadCastException(y)}}t.StringValue=m;class S extends u{constructor(y=null){super(y)}get valueType(){return f.DivertTarget}get targetPath(){return this.value===null?l.throwNullException("Value.value"):this.value}set targetPath(y){this.value=y}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a divert target")}Cast(y){if(y==this.valueType)return this;throw this.BadCastException(y)}toString(){return"DivertTargetValue("+this.targetPath+")"}}t.DivertTargetValue=S;class E extends u{constructor(y,w=-1){super(y);this._contextIndex=w}get contextIndex(){return this._contextIndex}set contextIndex(y){this._contextIndex=y}get variableName(){return this.value===null?l.throwNullException("Value.value"):this.value}set variableName(y){this.value=y}get valueType(){return f.VariablePointer}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a variable pointer")}Cast(y){if(y==this.valueType)return this;throw this.BadCastException(y)}toString(){return"VariablePointerValue("+this.variableName+")"}Copy(){return new E(this.variableName,this.contextIndex)}}t.VariablePointerValue=E;class d extends u{get isTruthy(){return this.value===null?l.throwNullException("this.value"):this.value.Count>0}get valueType(){return f.List}Cast(y){if(this.value===null)return l.throwNullException("Value.value");if(y==f.Int){let w=this.value.maxItem;return w.Key.isNull?new p(0):new p(w.Value)}else if(y==f.Float){let w=this.value.maxItem;return w.Key.isNull?new c(0):new c(w.Value)}else if(y==f.String){let w=this.value.maxItem;return w.Key.isNull?new m(""):new m(w.Key.toString())}if(y==this.valueType)return this;throw this.BadCastException(y)}constructor(y,w){super(null);!y&&!w?this.value=new r.InkList:y instanceof r.InkList?this.value=new r.InkList(y):y instanceof r.InkListItem&&typeof w=="number"&&(this.value=new r.InkList({Key:y,Value:w}))}static RetainListOriginsForAssignment(y,w){let b=o.asOrNull(y,d),N=o.asOrNull(w,d);if(N&&N.value===null)return l.throwNullException("newList.value");if(b&&b.value===null)return l.throwNullException("oldList.value");b&&N&&N.value.Count==0&&N.value.SetInitialOriginNames(b.value.originNames)}}t.ListValue=d;var f;(function(g){g[g.Bool=-1]="Bool",g[g.Int=0]="Int",g[g.Float=1]="Float",g[g.List=2]="List",g[g.String=3]="String",g[g.DivertTarget=4]="DivertTarget",g[g.VariablePointer=5]="VariablePointer"})(f=t.ValueType||(t.ValueType={}))})(re);var dl={};Object.defineProperty(dl,"__esModule",{value:!0});dl.SearchResult=void 0;const iC=he;class xh{constructor(){this.obj=null,this.approximate=!1}get correctObj(){return this.approximate?null:this.obj}get container(){return this.obj instanceof iC.Container?this.obj:null}copy(){let e=new xh;return e.obj=this.obj,e.approximate=this.approximate,e}}dl.SearchResult=xh;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;const e=re,n=ue,r=jt,i=Ae,o=dl,s=Ue,l=hs,a=it,u=B;class h extends i.InkObject{constructor(){super(...arguments);this.name=null,this._content=[],this.namedContent=new Map,this.visitsShouldBeCounted=!1,this.turnIndexShouldBeCounted=!1,this.countingAtStartOnly=!1,this._pathToFirstLeafContent=null}get hasValidName(){return this.name!=null&&this.name.length>0}get content(){return this._content}set content(c){this.AddContent(c)}get namedOnlyContent(){let c=new Map;for(let[m,S]of this.namedContent){let E=u.asOrThrows(S,i.InkObject);c.set(m,E)}for(let m of this.content){let S=u.asINamedContentOrNull(m);S!=null&&S.hasValidName&&c.delete(S.name)}return c.size==0&&(c=null),c}set namedOnlyContent(c){let m=this.namedOnlyContent;if(m!=null)for(let[S]of m)this.namedContent.delete(S);if(c!=null)for(let[,S]of c){let E=u.asINamedContentOrNull(S);E!=null&&this.AddToNamedContentOnly(E)}}get countFlags(){let c=0;return this.visitsShouldBeCounted&&(c|=h.CountFlags.Visits),this.turnIndexShouldBeCounted&&(c|=h.CountFlags.Turns),this.countingAtStartOnly&&(c|=h.CountFlags.CountStartOnly),c==h.CountFlags.CountStartOnly&&(c=0),c}set countFlags(c){let m=c;(m&h.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(m&h.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(m&h.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}get pathToFirstLeafContent(){return this._pathToFirstLeafContent==null&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}get internalPathToFirstLeafContent(){let c=[],m=this;for(;m instanceof h;)m.content.length>0&&(c.push(new s.Path.Component(0)),m=m.content[0]);return new s.Path(c)}AddContent(c){if(c instanceof Array){let m=c;for(let S of m)this.AddContent(S)}else{let m=c;if(this._content.push(m),m.parent)throw new Error("content is already in "+m.parent);m.parent=this,this.TryAddNamedContent(m)}}TryAddNamedContent(c){let m=u.asINamedContentOrNull(c);m!=null&&m.hasValidName&&this.AddToNamedContentOnly(m)}AddToNamedContentOnly(c){l.Debug.AssertType(c,i.InkObject,"Can only add Runtime.Objects to a Runtime.Container");let m=u.asOrThrows(c,i.InkObject);if(m.parent=this,c.name===null)return n.throwNullException("namedContentObj.name");this.namedContent.set(c.name,c)}ContentAtPath(c,m=0,S=-1){S==-1&&(S=c.length);let E=new o.SearchResult;E.approximate=!1;let d=this,f=this;for(let g=m;g<S;++g){let y=c.GetComponent(g);if(d==null){E.approximate=!0;break}let w=d.ContentWithPathComponent(y);if(w==null){E.approximate=!0;break}f=w,d=u.asOrNull(w,h)}return E.obj=f,E}InsertContent(c,m){if(this.content.splice(m,0,c),c.parent)throw new Error("content is already in "+c.parent);c.parent=this,this.TryAddNamedContent(c)}AddContentsOfContainer(c){this.content.push(...c.content);for(let m of c.content)m.parent=this,this.TryAddNamedContent(m)}ContentWithPathComponent(c){if(c.isIndex)return c.index>=0&&c.index<this.content.length?this.content[c.index]:null;if(c.isParent)return this.parent;{if(c.name===null)return n.throwNullException("component.name");let m=a.tryGetValueFromMap(this.namedContent,c.name,null);return m.exists?u.asOrThrows(m.result,i.InkObject):null}}BuildStringOfHierarchy(){let c;if(arguments.length==0)return c=new r.StringBuilder,this.BuildStringOfHierarchy(c,0,null),c.toString();c=arguments[0];let m=arguments[1],S=arguments[2];function E(){for(let g=0;g<4*m;++g)c.Append(" ")}E(),c.Append("["),this.hasValidName&&c.AppendFormat(" ({0})",this.name),this==S&&c.Append("  <---"),c.AppendLine(),m++;for(let f=0;f<this.content.length;++f){let g=this.content[f];g instanceof h?g.BuildStringOfHierarchy(c,m,S):(E(),g instanceof e.StringValue?(c.Append('"'),c.Append(g.toString().replace(`
`,"\\n")),c.Append('"')):c.Append(g.toString())),f!=this.content.length-1&&c.Append(","),!(g instanceof h)&&g==S&&c.Append("  <---"),c.AppendLine()}let d=new Map;for(let[f,g]of this.namedContent)this.content.indexOf(u.asOrThrows(g,i.InkObject))>=0||d.set(f,g);if(d.size>0){E(),c.AppendLine("-- named: --");for(let[,f]of d)l.Debug.AssertType(f,h,"Can only print out named Containers"),f.BuildStringOfHierarchy(c,m,S),c.AppendLine()}m--,E(),c.Append("]")}}t.Container=h,function(p){(function(c){c[c.Visits=1]="Visits",c[c.Turns=2]="Turns",c[c.CountStartOnly=4]="CountStartOnly"})(p.CountFlags||(p.CountFlags={}))}(h=t.Container||(t.Container={}))})(he);var Ve={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlCommand=void 0;const e=Ae;class n extends e.InkObject{constructor(i=n.CommandType.NotSet){super();this._commandType=i}get commandType(){return this._commandType}Copy(){return new n(this.commandType)}static EvalStart(){return new n(n.CommandType.EvalStart)}static EvalOutput(){return new n(n.CommandType.EvalOutput)}static EvalEnd(){return new n(n.CommandType.EvalEnd)}static Duplicate(){return new n(n.CommandType.Duplicate)}static PopEvaluatedValue(){return new n(n.CommandType.PopEvaluatedValue)}static PopFunction(){return new n(n.CommandType.PopFunction)}static PopTunnel(){return new n(n.CommandType.PopTunnel)}static BeginString(){return new n(n.CommandType.BeginString)}static EndString(){return new n(n.CommandType.EndString)}static NoOp(){return new n(n.CommandType.NoOp)}static ChoiceCount(){return new n(n.CommandType.ChoiceCount)}static Turns(){return new n(n.CommandType.Turns)}static TurnsSince(){return new n(n.CommandType.TurnsSince)}static ReadCount(){return new n(n.CommandType.ReadCount)}static Random(){return new n(n.CommandType.Random)}static SeedRandom(){return new n(n.CommandType.SeedRandom)}static VisitIndex(){return new n(n.CommandType.VisitIndex)}static SequenceShuffleIndex(){return new n(n.CommandType.SequenceShuffleIndex)}static StartThread(){return new n(n.CommandType.StartThread)}static Done(){return new n(n.CommandType.Done)}static End(){return new n(n.CommandType.End)}static ListFromInt(){return new n(n.CommandType.ListFromInt)}static ListRange(){return new n(n.CommandType.ListRange)}static ListRandom(){return new n(n.CommandType.ListRandom)}toString(){return this.commandType.toString()}}t.ControlCommand=n,function(r){(function(i){i[i.NotSet=-1]="NotSet",i[i.EvalStart=0]="EvalStart",i[i.EvalOutput=1]="EvalOutput",i[i.EvalEnd=2]="EvalEnd",i[i.Duplicate=3]="Duplicate",i[i.PopEvaluatedValue=4]="PopEvaluatedValue",i[i.PopFunction=5]="PopFunction",i[i.PopTunnel=6]="PopTunnel",i[i.BeginString=7]="BeginString",i[i.EndString=8]="EndString",i[i.NoOp=9]="NoOp",i[i.ChoiceCount=10]="ChoiceCount",i[i.Turns=11]="Turns",i[i.TurnsSince=12]="TurnsSince",i[i.Random=13]="Random",i[i.SeedRandom=14]="SeedRandom",i[i.VisitIndex=15]="VisitIndex",i[i.SequenceShuffleIndex=16]="SequenceShuffleIndex",i[i.StartThread=17]="StartThread",i[i.Done=18]="Done",i[i.End=19]="End",i[i.ListFromInt=20]="ListFromInt",i[i.ListRange=21]="ListRange",i[i.ListRandom=22]="ListRandom",i[i.ReadCount=23]="ReadCount",i[i.TOTAL_VALUES=24]="TOTAL_VALUES"})(r.CommandType||(r.CommandType={}))}(n=t.ControlCommand||(t.ControlCommand={}))})(Ve);Object.defineProperty(Ge,"__esModule",{value:!0});Ge.Expression=void 0;const wf=he,ma=Ve,sC=Z;class oC extends sC.ParsedObject{constructor(){super(...arguments);this._prototypeRuntimeConstantExpression=null,this.outputWhenComplete=!1,this.GenerateRuntimeObject=()=>{const e=new wf.Container;return e.AddContent(ma.ControlCommand.EvalStart()),this.GenerateIntoContainer(e),this.outputWhenComplete&&e.AddContent(ma.ControlCommand.EvalOutput()),e.AddContent(ma.ControlCommand.EvalEnd()),e},this.GenerateConstantIntoContainer=e=>{this._prototypeRuntimeConstantExpression===null&&(this._prototypeRuntimeConstantExpression=new wf.Container,this.GenerateIntoContainer(this._prototypeRuntimeConstantExpression));for(const n of this._prototypeRuntimeConstantExpression.content){const r=n.Copy();r&&e.AddContent(r)}},this.toString=()=>"No string value in JavaScript."}get typeName(){return"Expression"}Equals(e){return!1}}Ge.Expression=oC;var at={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Void=void 0;const lC=Ae;class aC extends lC.InkObject{}Mt.Void=aC;Object.defineProperty(at,"__esModule",{value:!0});at.NativeFunctionCall=void 0;const V=re,oi=Wn,uC=Mt,Us=Ce,hC=Ae,Xe=B,je=ue;class M extends hC.InkObject{constructor(){super();if(this._name=null,this._numberOfParameters=0,this._prototype=null,this._isPrototype=!1,this._operationFuncs=null,arguments.length===0)M.GenerateNativeFunctionsIfNecessary();else if(arguments.length===1){let e=arguments[0];M.GenerateNativeFunctionsIfNecessary(),this.name=e}else if(arguments.length===2){let e=arguments[0],n=arguments[1];this._isPrototype=!0,this.name=e,this.numberOfParameters=n}}static CallWithName(e){return new M(e)}static CallExistsWithName(e){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(e)}get name(){return this._name===null?je.throwNullException("NativeFunctionCall._name"):this._name}set name(e){this._name=e,this._isPrototype||(M._nativeFunctions===null?je.throwNullException("NativeFunctionCall._nativeFunctions"):this._prototype=M._nativeFunctions.get(this._name)||null)}get numberOfParameters(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters}set numberOfParameters(e){this._numberOfParameters=e}Call(e){if(this._prototype)return this._prototype.Call(e);if(this.numberOfParameters!=e.length)throw new Error("Unexpected number of parameters");let n=!1;for(let o of e){if(o instanceof uC.Void)throw new oi.StoryException('Attempting to perform operation on a void value. Did you forget to "return" a value from a function you called here?');o instanceof V.ListValue&&(n=!0)}if(e.length==2&&n)return this.CallBinaryListOperation(e);let r=this.CoerceValuesToSingleType(e),i=r[0].valueType;return i==V.ValueType.Int?this.CallType(r):i==V.ValueType.Float?this.CallType(r):i==V.ValueType.String?this.CallType(r):i==V.ValueType.DivertTarget?this.CallType(r):i==V.ValueType.List?this.CallType(r):null}CallType(e){let n=Xe.asOrThrows(e[0],V.Value),r=n.valueType,i=n,o=e.length;if(o==2||o==1){if(this._operationFuncs===null)return je.throwNullException("NativeFunctionCall._operationFuncs");let s=this._operationFuncs.get(r);if(!s){const l=V.ValueType[r];throw new oi.StoryException("Cannot perform operation "+this.name+" on "+l)}if(o==2){let a=Xe.asOrThrows(e[1],V.Value),u=s;if(i.value===null||a.value===null)return je.throwNullException("NativeFunctionCall.Call BinaryOp values");let h=u(i.value,a.value);return V.Value.Create(h)}else{let l=s;if(i.value===null)return je.throwNullException("NativeFunctionCall.Call UnaryOp value");let a=l(i.value);return this.name===M.Int?V.Value.Create(a,V.ValueType.Int):this.name===M.Float?V.Value.Create(a,V.ValueType.Float):V.Value.Create(a,n.valueType)}}else throw new Error("Unexpected number of parameters to NativeFunctionCall: "+e.length)}CallBinaryListOperation(e){if((this.name=="+"||this.name=="-")&&e[0]instanceof V.ListValue&&e[1]instanceof V.IntValue)return this.CallListIncrementOperation(e);let n=Xe.asOrThrows(e[0],V.Value),r=Xe.asOrThrows(e[1],V.Value);if((this.name=="&&"||this.name=="||")&&(n.valueType!=V.ValueType.List||r.valueType!=V.ValueType.List)){if(this._operationFuncs===null)return je.throwNullException("NativeFunctionCall._operationFuncs");let i=this._operationFuncs.get(V.ValueType.Int);if(i===null)return je.throwNullException("NativeFunctionCall.CallBinaryListOperation op");let o=Xe.asBooleanOrThrows(i(n.isTruthy?1:0,r.isTruthy?1:0));return new V.BoolValue(o)}if(n.valueType==V.ValueType.List&&r.valueType==V.ValueType.List)return this.CallType([n,r]);throw new oi.StoryException("Can not call use "+this.name+" operation on "+V.ValueType[n.valueType]+" and "+V.ValueType[r.valueType])}CallListIncrementOperation(e){let n=Xe.asOrThrows(e[0],V.ListValue),r=Xe.asOrThrows(e[1],V.IntValue),i=new Us.InkList;if(n.value===null)return je.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value");for(let[o,s]of n.value){let l=Us.InkListItem.fromSerializedKey(o);if(this._operationFuncs===null)return je.throwNullException("NativeFunctionCall._operationFuncs");let a=this._operationFuncs.get(V.ValueType.Int);if(r.value===null)return je.throwNullException("NativeFunctionCall.CallListIncrementOperation intVal.value");let u=a(s,r.value),h=null;if(n.value.origins===null)return je.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value.origins");for(let p of n.value.origins)if(p.name==l.originName){h=p;break}if(h!=null){let p=h.TryGetItemWithValue(u,Us.InkListItem.Null);p.exists&&i.Add(p.result,u)}}return new V.ListValue(i)}CoerceValuesToSingleType(e){let n=V.ValueType.Int,r=null;for(let o of e){let s=Xe.asOrThrows(o,V.Value);s.valueType>n&&(n=s.valueType),s.valueType==V.ValueType.List&&(r=Xe.asOrNull(s,V.ListValue))}let i=[];if(V.ValueType[n]==V.ValueType[V.ValueType.List])for(let o of e){let s=Xe.asOrThrows(o,V.Value);if(s.valueType==V.ValueType.List)i.push(s);else if(s.valueType==V.ValueType.Int){let l=parseInt(s.valueObject);if(r=Xe.asOrThrows(r,V.ListValue),r.value===null)return je.throwNullException("NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value");let a=r.value.originOfMaxItem;if(a===null)return je.throwNullException("NativeFunctionCall.CoerceValuesToSingleType list");let u=a.TryGetItemWithValue(l,Us.InkListItem.Null);if(u.exists){let h=new V.ListValue(u.result,l);i.push(h)}else throw new oi.StoryException("Could not find List item with the value "+l+" in "+a.name)}else{const l=V.ValueType[s.valueType];throw new oi.StoryException("Cannot mix Lists and "+l+" values in this operation")}}else for(let o of e){let l=Xe.asOrThrows(o,V.Value).Cast(n);i.push(l)}return i}static Identity(e){return e}static GenerateNativeFunctionsIfNecessary(){if(this._nativeFunctions==null){this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,(r,i)=>r+i),this.AddIntBinaryOp(this.Subtract,(r,i)=>r-i),this.AddIntBinaryOp(this.Multiply,(r,i)=>r*i),this.AddIntBinaryOp(this.Divide,(r,i)=>Math.floor(r/i)),this.AddIntBinaryOp(this.Mod,(r,i)=>r%i),this.AddIntUnaryOp(this.Negate,r=>-r),this.AddIntBinaryOp(this.Equal,(r,i)=>r==i),this.AddIntBinaryOp(this.Greater,(r,i)=>r>i),this.AddIntBinaryOp(this.Less,(r,i)=>r<i),this.AddIntBinaryOp(this.GreaterThanOrEquals,(r,i)=>r>=i),this.AddIntBinaryOp(this.LessThanOrEquals,(r,i)=>r<=i),this.AddIntBinaryOp(this.NotEquals,(r,i)=>r!=i),this.AddIntUnaryOp(this.Not,r=>r==0),this.AddIntBinaryOp(this.And,(r,i)=>r!=0&&i!=0),this.AddIntBinaryOp(this.Or,(r,i)=>r!=0||i!=0),this.AddIntBinaryOp(this.Max,(r,i)=>Math.max(r,i)),this.AddIntBinaryOp(this.Min,(r,i)=>Math.min(r,i)),this.AddIntBinaryOp(this.Pow,(r,i)=>Math.pow(r,i)),this.AddIntUnaryOp(this.Floor,M.Identity),this.AddIntUnaryOp(this.Ceiling,M.Identity),this.AddIntUnaryOp(this.Int,M.Identity),this.AddIntUnaryOp(this.Float,r=>r),this.AddFloatBinaryOp(this.Add,(r,i)=>r+i),this.AddFloatBinaryOp(this.Subtract,(r,i)=>r-i),this.AddFloatBinaryOp(this.Multiply,(r,i)=>r*i),this.AddFloatBinaryOp(this.Divide,(r,i)=>r/i),this.AddFloatBinaryOp(this.Mod,(r,i)=>r%i),this.AddFloatUnaryOp(this.Negate,r=>-r),this.AddFloatBinaryOp(this.Equal,(r,i)=>r==i),this.AddFloatBinaryOp(this.Greater,(r,i)=>r>i),this.AddFloatBinaryOp(this.Less,(r,i)=>r<i),this.AddFloatBinaryOp(this.GreaterThanOrEquals,(r,i)=>r>=i),this.AddFloatBinaryOp(this.LessThanOrEquals,(r,i)=>r<=i),this.AddFloatBinaryOp(this.NotEquals,(r,i)=>r!=i),this.AddFloatUnaryOp(this.Not,r=>r==0),this.AddFloatBinaryOp(this.And,(r,i)=>r!=0&&i!=0),this.AddFloatBinaryOp(this.Or,(r,i)=>r!=0||i!=0),this.AddFloatBinaryOp(this.Max,(r,i)=>Math.max(r,i)),this.AddFloatBinaryOp(this.Min,(r,i)=>Math.min(r,i)),this.AddFloatBinaryOp(this.Pow,(r,i)=>Math.pow(r,i)),this.AddFloatUnaryOp(this.Floor,r=>Math.floor(r)),this.AddFloatUnaryOp(this.Ceiling,r=>Math.ceil(r)),this.AddFloatUnaryOp(this.Int,r=>Math.floor(r)),this.AddFloatUnaryOp(this.Float,M.Identity),this.AddStringBinaryOp(this.Add,(r,i)=>r+i),this.AddStringBinaryOp(this.Equal,(r,i)=>r===i),this.AddStringBinaryOp(this.NotEquals,(r,i)=>r!==i),this.AddStringBinaryOp(this.Has,(r,i)=>r.includes(i)),this.AddStringBinaryOp(this.Hasnt,(r,i)=>!r.includes(i)),this.AddListBinaryOp(this.Add,(r,i)=>r.Union(i)),this.AddListBinaryOp(this.Subtract,(r,i)=>r.Without(i)),this.AddListBinaryOp(this.Has,(r,i)=>r.Contains(i)),this.AddListBinaryOp(this.Hasnt,(r,i)=>!r.Contains(i)),this.AddListBinaryOp(this.Intersect,(r,i)=>r.Intersect(i)),this.AddListBinaryOp(this.Equal,(r,i)=>r.Equals(i)),this.AddListBinaryOp(this.Greater,(r,i)=>r.GreaterThan(i)),this.AddListBinaryOp(this.Less,(r,i)=>r.LessThan(i)),this.AddListBinaryOp(this.GreaterThanOrEquals,(r,i)=>r.GreaterThanOrEquals(i)),this.AddListBinaryOp(this.LessThanOrEquals,(r,i)=>r.LessThanOrEquals(i)),this.AddListBinaryOp(this.NotEquals,(r,i)=>!r.Equals(i)),this.AddListBinaryOp(this.And,(r,i)=>r.Count>0&&i.Count>0),this.AddListBinaryOp(this.Or,(r,i)=>r.Count>0||i.Count>0),this.AddListUnaryOp(this.Not,r=>r.Count==0?1:0),this.AddListUnaryOp(this.Invert,r=>r.inverse),this.AddListUnaryOp(this.All,r=>r.all),this.AddListUnaryOp(this.ListMin,r=>r.MinAsList()),this.AddListUnaryOp(this.ListMax,r=>r.MaxAsList()),this.AddListUnaryOp(this.Count,r=>r.Count),this.AddListUnaryOp(this.ValueOfList,r=>r.maxItem.Value);let e=(r,i)=>r.Equals(i),n=(r,i)=>!r.Equals(i);this.AddOpToNativeFunc(this.Equal,2,V.ValueType.DivertTarget,e),this.AddOpToNativeFunc(this.NotEquals,2,V.ValueType.DivertTarget,n)}}AddOpFuncForType(e,n){this._operationFuncs==null&&(this._operationFuncs=new Map),this._operationFuncs.set(e,n)}static AddOpToNativeFunc(e,n,r,i){if(this._nativeFunctions===null)return je.throwNullException("NativeFunctionCall._nativeFunctions");let o=this._nativeFunctions.get(e);o||(o=new M(e,n),this._nativeFunctions.set(e,o)),o.AddOpFuncForType(r,i)}static AddIntBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.Int,n)}static AddIntUnaryOp(e,n){this.AddOpToNativeFunc(e,1,V.ValueType.Int,n)}static AddFloatBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.Float,n)}static AddFloatUnaryOp(e,n){this.AddOpToNativeFunc(e,1,V.ValueType.Float,n)}static AddStringBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.String,n)}static AddListBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.List,n)}static AddListUnaryOp(e,n){this.AddOpToNativeFunc(e,1,V.ValueType.List,n)}toString(){return'Native "'+this.name+'"'}}at.NativeFunctionCall=M;M.Add="+";M.Subtract="-";M.Divide="/";M.Multiply="*";M.Mod="%";M.Negate="_";M.Equal="==";M.Greater=">";M.Less="<";M.GreaterThanOrEquals=">=";M.LessThanOrEquals="<=";M.NotEquals="!=";M.Not="!";M.And="&&";M.Or="||";M.Min="MIN";M.Max="MAX";M.Pow="POW";M.Floor="FLOOR";M.Ceiling="CEILING";M.Int="INT";M.Float="FLOAT";M.Has="?";M.Hasnt="!?";M.Intersect="^";M.ListMin="LIST_MIN";M.ListMax="LIST_MAX";M.All="LIST_ALL";M.Count="LIST_COUNT";M.ValueOfList="LIST_VALUE";M.Invert="LIST_INVERT";M._nativeFunctions=null;var cs={},Lr={};Object.defineProperty(Lr,"__esModule",{value:!0});Lr.NumberExpression=void 0;const cC=Ge,ga=re,fC=B;class Th extends cC.Expression{constructor(e,n){super();if(this.isInt=()=>this.subtype=="int",this.isFloat=()=>this.subtype=="float",this.isBool=()=>this.subtype=="bool",this.GenerateIntoContainer=r=>{this.isInt()?r.AddContent(new ga.IntValue(this.value)):this.isFloat()?r.AddContent(new ga.FloatValue(this.value)):this.isBool()&&r.AddContent(new ga.BoolValue(this.value))},this.toString=()=>String(this.value),typeof e=="number"&&!Number.isNaN(e)||typeof e=="boolean")this.value=e,this.subtype=n;else throw new Error("Unexpected object type in NumberExpression.")}get typeName(){return"Number"}Equals(e){const n=fC.asOrNull(e,Th);return n?n.subtype==this.subtype&&n.value==this.value:!1}}Lr.NumberExpression=Th;Object.defineProperty(cs,"__esModule",{value:!0});cs.UnaryExpression=void 0;const dC=Ge,pC=at,Yn=Lr,mC=B;class Ou extends dC.Expression{constructor(e,n){super();this.op=n,this.GenerateIntoContainer=r=>{this.innerExpression.GenerateIntoContainer(r),r.AddContent(pC.NativeFunctionCall.CallWithName(this.nativeNameForOp))},this.toString=()=>this.nativeNameForOp+this.innerExpression,this.innerExpression=this.AddContent(e)}get nativeNameForOp(){return this.op==="-"?"_":this.op==="not"?"!":this.op}get typeName(){return"UnaryExpression"}}cs.UnaryExpression=Ou;Ou.WithInner=(t,e)=>{const n=mC.asOrNull(t,Yn.NumberExpression);if(n){if(e==="-"){if(n.isInt())return new Yn.NumberExpression(-n.value,"int");if(n.isFloat())return new Yn.NumberExpression(-n.value,"float")}else if(e=="!"||e=="not"){if(n.isInt())return new Yn.NumberExpression(n.value==0,"bool");if(n.isFloat())return new Yn.NumberExpression(n.value==0,"bool");if(n.isBool())return new Yn.NumberExpression(!n.value,"bool")}throw new Error("Unexpected operation or number type")}return new Ou(t,e)};Object.defineProperty(us,"__esModule",{value:!0});us.BinaryExpression=void 0;const gC=Ge,vC=at,yC=cs,CC=B;class SC extends gC.Expression{constructor(e,n,r){super();this.opName=r,this.GenerateIntoContainer=i=>{this.leftExpression.GenerateIntoContainer(i),this.rightExpression.GenerateIntoContainer(i),this.opName=this.NativeNameForOp(this.opName),i.AddContent(vC.NativeFunctionCall.CallWithName(this.opName))},this.NativeNameForOp=i=>i==="and"?"&&":i==="or"?"||":i==="mod"?"%":i==="has"?"?":i==="hasnt"?"!?":i,this.toString=()=>`(${this.leftExpression} ${this.opName} ${this.rightExpression})`,this.leftExpression=this.AddContent(e),this.rightExpression=this.AddContent(n),this.opName=r}get typeName(){return"BinaryExpression"}ResolveReferences(e){if(super.ResolveReferences(e),this.NativeNameForOp(this.opName)==="?"){const n=CC.asOrNull(this.leftExpression,yC.UnaryExpression);n!==null&&(n.op==="not"||n.op==="!")&&this.Error(`Using 'not' or '!' here negates '${n.innerExpression}' rather than the result of the '?' or 'has' operator. You need to add parentheses around the (A ? B) expression.`)}}}us.BinaryExpression=SC;var pl={},jn={};Object.defineProperty(jn,"__esModule",{value:!0});jn.CharacterSet=void 0;class xu{constructor(e){this.set=new Set,this.Add=n=>this.set.add(n),this.AddRange=(n,r)=>{for(let i=n.charCodeAt(0);i<=r.charCodeAt(0);++i)this.Add(String.fromCharCode(i));return this},this.AddCharacters=n=>{if(typeof n=="string"||Array.isArray(n))for(const r of n)this.Add(r);else for(const r of n.set)this.Add(r);return this},e&&this.AddCharacters(e)}}jn.CharacterSet=xu;xu.FromRange=(t,e)=>new xu().AddRange(t,e);Object.defineProperty(pl,"__esModule",{value:!0});pl.CharacterRange=void 0;const _f=jn;class Tu{constructor(e,n,r=[]){if(this._start=e,this._end=n,this._correspondingCharSet=new _f.CharacterSet,this._excludes=new Set,this.ToCharacterSet=()=>{if(this._correspondingCharSet.set.size===0)for(let i=this.start.charCodeAt(0),o=String.fromCharCode(i);i<=this.end.charCodeAt(0);i+=1)this._excludes.has(o)||this._correspondingCharSet.AddCharacters(o);return this._correspondingCharSet},r instanceof _f.CharacterSet)this._excludes=r.set;else for(const i of r)this._excludes.add(i)}get start(){return this._start}get end(){return this._end}}pl.CharacterRange=Tu;Tu.Define=(t,e,n=[])=>new Tu(t,e,n);var Mn={},Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});Dr.ChoicePoint=void 0;const wC=Ae,_C=Ue,va=ue;class EC extends wC.InkObject{constructor(e=!0){super();this._pathOnChoice=null,this.hasCondition=!1,this.hasStartContent=!1,this.hasChoiceOnlyContent=!1,this.isInvisibleDefault=!1,this.onceOnly=!0,this.onceOnly=e}get pathOnChoice(){if(this._pathOnChoice!=null&&this._pathOnChoice.isRelative){let e=this.choiceTarget;e&&(this._pathOnChoice=e.path)}return this._pathOnChoice}set pathOnChoice(e){this._pathOnChoice=e}get choiceTarget(){return this._pathOnChoice===null?va.throwNullException("ChoicePoint._pathOnChoice"):this.ResolvePath(this._pathOnChoice).container}get pathStringOnChoice(){return this.pathOnChoice===null?va.throwNullException("ChoicePoint.pathOnChoice"):this.CompactPathString(this.pathOnChoice)}set pathStringOnChoice(e){this.pathOnChoice=new _C.Path(e)}get flags(){let e=0;return this.hasCondition&&(e|=1),this.hasStartContent&&(e|=2),this.hasChoiceOnlyContent&&(e|=4),this.isInvisibleDefault&&(e|=8),this.onceOnly&&(e|=16),e}set flags(e){this.hasCondition=(e&1)>0,this.hasStartContent=(e&2)>0,this.hasChoiceOnlyContent=(e&4)>0,this.isInvisibleDefault=(e&8)>0,this.onceOnly=(e&16)>0}toString(){if(this.pathOnChoice===null)return va.throwNullException("ChoicePoint.pathOnChoice");let e=this.pathOnChoice.toString();return"Choice: -> "+e}}Dr.ChoicePoint=EC;var mt={},$n={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PushPopType=void 0,function(e){e[e.Tunnel=0]="Tunnel",e[e.Function=1]="Function",e[e.FunctionEvaluationFromGame=2]="FunctionEvaluationFromGame"}(t.PushPopType||(t.PushPopType={}))})($n);var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.Pointer=void 0;const PC=Ue;class Di{constructor(){this.container=null,this.index=-1,arguments.length===2&&(this.container=arguments[0],this.index=arguments[1])}Resolve(){return this.index<0?this.container:this.container==null?null:this.container.content.length==0?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}get isNull(){return this.container==null}get path(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new PC.Path.Component(this.index)):this.container.path}toString(){return this.container?"Ink Pointer -> "+this.container.path.toString()+" -- index "+this.index:"Ink Pointer (null)"}copy(){return new Di(this.container,this.index)}static StartOf(e){return new Di(e,0)}static get Null(){return new Di(null,-1)}}Bn.Pointer=Di;Object.defineProperty(mt,"__esModule",{value:!0});mt.Divert=void 0;const OC=Ue,xC=$n,TC=jt,NC=Ae,ya=Bn,Ef=he,zs=ue;class Nh extends NC.InkObject{constructor(e){super();this._targetPath=null,this._targetPointer=ya.Pointer.Null,this.variableDivertName=null,this.pushesToStack=!1,this.stackPushType=0,this.isExternal=!1,this.externalArgs=0,this.isConditional=!1,this.pushesToStack=!1,typeof e!="undefined"&&(this.pushesToStack=!0,this.stackPushType=e)}get targetPath(){if(this._targetPath!=null&&this._targetPath.isRelative){let e=this.targetPointer.Resolve();e&&(this._targetPath=e.path)}return this._targetPath}set targetPath(e){this._targetPath=e,this._targetPointer=ya.Pointer.Null}get targetPointer(){if(this._targetPointer.isNull){let e=this.ResolvePath(this._targetPath).obj;if(this._targetPath===null)return zs.throwNullException("this._targetPath");if(this._targetPath.lastComponent===null)return zs.throwNullException("this._targetPath.lastComponent");if(this._targetPath.lastComponent.isIndex){if(e===null)return zs.throwNullException("targetObj");this._targetPointer.container=e.parent instanceof Ef.Container?e.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=ya.Pointer.StartOf(e instanceof Ef.Container?e:null)}return this._targetPointer.copy()}get targetPathString(){return this.targetPath==null?null:this.CompactPathString(this.targetPath)}set targetPathString(e){e==null?this.targetPath=null:this.targetPath=new OC.Path(e)}get hasVariableTarget(){return this.variableDivertName!=null}Equals(e){let n=e;return n instanceof Nh&&this.hasVariableTarget==n.hasVariableTarget?this.hasVariableTarget?this.variableDivertName==n.variableDivertName:this.targetPath===null?zs.throwNullException("this.targetPath"):this.targetPath.Equals(n.targetPath):!1}toString(){if(this.hasVariableTarget)return"Divert(variable: "+this.variableDivertName+")";if(this.targetPath==null)return"Divert(null)";{let e=new TC.StringBuilder,n=this.targetPath.toString();return e.Append("Divert"),this.isConditional&&e.Append("?"),this.pushesToStack&&(this.stackPushType==xC.PushPopType.Function?e.Append(" function"):e.Append(" tunnel")),e.Append(" -> "),e.Append(this.targetPathString),e.Append(" ("),e.Append(n),e.Append(")"),e.toString()}}}mt.Divert=Nh;var $t={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolType=void 0,function(e){e[e.Knot=0]="Knot",e[e.List=1]="List",e[e.ListItem=2]="ListItem",e[e.Var=3]="Var",e[e.SubFlowAndWeave=4]="SubFlowAndWeave",e[e.Arg=5]="Arg",e[e.Temp=6]="Temp"}(t.SymbolType||(t.SymbolType={}))})($t);var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.VariableAssignment=void 0;const bC=Ae;class IC extends bC.InkObject{constructor(e,n){super();this.variableName=e||null,this.isNewDeclaration=!!n,this.isGlobal=!1}toString(){return"VarAssign to "+this.variableName}}Tt.VariableAssignment=IC;Object.defineProperty(Mn,"__esModule",{value:!0});Mn.Choice=void 0;const kC=Dr,qs=he,qt=Ve,Ca=mt,Pf=re,AC=Z,FC=$t,Of=Tt;class RC extends AC.ParsedObject{constructor(e,n,r){super();this._condition=null,this._innerContentContainer=null,this._outerContainer=null,this._runtimeChoice=null,this._returnToR1=null,this._returnToR2=null,this._r1Label=null,this._r2Label=null,this._divertToStartContentOuter=null,this._divertToStartContentInner=null,this._startContentRuntimeContainer=null,this.isInvisibleDefault=!1,this.hasWeaveStyleInlineBrackets=!1,this.GenerateRuntimeObject=()=>{if(this._outerContainer=new qs.Container,this._runtimeChoice=new kC.ChoicePoint(this.onceOnly),this._runtimeChoice.isInvisibleDefault=this.isInvisibleDefault,(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(qt.ControlCommand.EvalStart()),this.startContent){this._returnToR1=new Pf.DivertTargetValue,this._outerContainer.AddContent(this._returnToR1);const i=new Of.VariableAssignment("$r",!0);this._outerContainer.AddContent(i),this._outerContainer.AddContent(qt.ControlCommand.BeginString()),this._divertToStartContentOuter=new Ca.Divert,this._outerContainer.AddContent(this._divertToStartContentOuter),this._startContentRuntimeContainer=this.startContent.GenerateRuntimeObject(),this._startContentRuntimeContainer.name="s";const o=new Ca.Divert;o.variableDivertName="$r",this._startContentRuntimeContainer.AddContent(o),this._outerContainer.AddToNamedContentOnly(this._startContentRuntimeContainer),this._r1Label=new qs.Container,this._r1Label.name="$r1",this._outerContainer.AddContent(this._r1Label),this._outerContainer.AddContent(qt.ControlCommand.EndString()),this._runtimeChoice.hasStartContent=!0}if(this.choiceOnlyContent){this._outerContainer.AddContent(qt.ControlCommand.BeginString());const i=this.choiceOnlyContent.GenerateRuntimeObject();this._outerContainer.AddContentsOfContainer(i),this._outerContainer.AddContent(qt.ControlCommand.EndString()),this._runtimeChoice.hasChoiceOnlyContent=!0}if(this.condition&&(this.condition.GenerateIntoContainer(this._outerContainer),this._runtimeChoice.hasCondition=!0),(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(qt.ControlCommand.EvalEnd()),this._outerContainer.AddContent(this._runtimeChoice),this._innerContentContainer=new qs.Container,this.startContent){this._returnToR2=new Pf.DivertTargetValue,this._innerContentContainer.AddContent(qt.ControlCommand.EvalStart()),this._innerContentContainer.AddContent(this._returnToR2),this._innerContentContainer.AddContent(qt.ControlCommand.EvalEnd());const i=new Of.VariableAssignment("$r",!0);this._innerContentContainer.AddContent(i),this._divertToStartContentInner=new Ca.Divert,this._innerContentContainer.AddContent(this._divertToStartContentInner),this._r2Label=new qs.Container,this._r2Label.name="$r2",this._innerContentContainer.AddContent(this._r2Label)}if(this.innerContent){const i=this.innerContent.GenerateRuntimeObject();this._innerContentContainer.AddContentsOfContainer(i)}return this.story.countAllVisits&&(this._innerContentContainer.visitsShouldBeCounted=!0),this._innerContentContainer.countingAtStartOnly=!0,this._outerContainer},this.toString=()=>this.choiceOnlyContent!==null?`* ${this.startContent}[${this.choiceOnlyContent}]...`:`* ${this.startContent}...`,this.startContent=e,this.choiceOnlyContent=n,this.innerContent=r,this.indentationDepth=1,e&&this.AddContent(this.startContent),n&&this.AddContent(this.choiceOnlyContent),r&&this.AddContent(this.innerContent),this.onceOnly=!0}get runtimeChoice(){if(!this._runtimeChoice)throw new Error;return this._runtimeChoice}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get condition(){return this._condition}set condition(e){this._condition=e,e&&this.AddContent(e)}get runtimeContainer(){return this._innerContentContainer}get innerContentContainer(){return this._innerContentContainer}get containerForCounting(){return this._innerContentContainer}get runtimePath(){if(!this.innerContentContainer||!this.innerContentContainer.path)throw new Error;return this.innerContentContainer.path}get typeName(){return"Choice"}ResolveReferences(e){var n;if(this._innerContentContainer&&(this.runtimeChoice.pathOnChoice=this._innerContentContainer.path,this.onceOnly&&(this._innerContentContainer.visitsShouldBeCounted=!0)),this._returnToR1){if(!this._r1Label)throw new Error;this._returnToR1.targetPath=this._r1Label.path}if(this._returnToR2){if(!this._r2Label)throw new Error;this._returnToR2.targetPath=this._r2Label.path}if(this._divertToStartContentOuter){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentOuter.targetPath=this._startContentRuntimeContainer.path}if(this._divertToStartContentInner){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentInner.targetPath=this._startContentRuntimeContainer.path}super.ResolveReferences(e),this.identifier&&(((n=this.identifier)===null||n===void 0?void 0:n.name)||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,FC.SymbolType.SubFlowAndWeave)}}Mn.Choice=RC;var ml={},bh={},gl={},vl={};Object.defineProperty(vl,"__esModule",{value:!0});vl.StringParserElement=void 0;class es{constructor(){this.characterIndex=0,this.characterInLineIndex=0,this.lineIndex=0,this.reportedErrorInScope=!1,this.uniqueId=0,this.customFlags=0,this.CopyFrom=e=>{es._uniqueIdCounter++,this.uniqueId=es._uniqueIdCounter,this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.customFlags=e.customFlags,this.reportedErrorInScope=!1},this.SquashFrom=e=>{this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.reportedErrorInScope=e.reportedErrorInScope}}}vl.StringParserElement=es;es._uniqueIdCounter=1e3;Object.defineProperty(gl,"__esModule",{value:!0});gl.StringParserState=void 0;const xf=vl;class LC{constructor(){this._stack=[],this._numElements=0,this.StringParserState=()=>{this._stack=new Array(200);for(let r=0;r<200;++r)this._stack[r]=new xf.StringParserElement;this._numElements=1},this.Push=()=>{if(this._numElements>=this._stack.length&&this._numElements>0)throw new Error("Stack overflow in parser state.");const n=this._stack[this._numElements-1],r=this._stack[this._numElements];return this._numElements++,r.CopyFrom(n),r.uniqueId},this.Pop=n=>{if(this._numElements==1)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");if(this.currentElement.uniqueId!=n)throw new Error("Mismatched rule IDs while Poping - do you have mismatched Begin/Succeed/Fail?");this._numElements-=1},this.Peek=n=>{if(this.currentElement.uniqueId!=n)throw new Error("Mismatched rule IDs while Peeking - do you have mismatched Begin/Succeed/Fail?");return this._stack[this._numElements-1]},this.PeekPenultimate=()=>this._numElements>=2?this._stack[this._numElements-2]:null,this.Squash=()=>{if(this._numElements<2)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");const n=this._stack[this._numElements-2],r=this._stack[this._numElements-1];n.SquashFrom(r),this._numElements-=1},this.NoteErrorReported=()=>{for(const n of this._stack)n.reportedErrorInScope=!0};const e=200;for(let n=0;n<e;n++)this._stack[n]=new xf.StringParserElement;this._numElements=1}get currentElement(){return this._stack[this._numElements-1]}get lineIndex(){return this.currentElement.lineIndex}set lineIndex(e){this.currentElement.lineIndex=e}get characterIndex(){return this.currentElement.characterIndex}set characterIndex(e){this.currentElement.characterIndex=e}get characterInLineIndex(){return this.currentElement.characterInLineIndex}set characterInLineIndex(e){this.currentElement.characterInLineIndex=e}get customFlags(){return this.currentElement.customFlags}set customFlags(e){this.currentElement.customFlags=e}get errorReportedAlreadyInScope(){return this.currentElement.reportedErrorInScope}get stackHeight(){return this._numElements}}gl.StringParserState=LC;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StringParser=t.ParseSuccess=void 0;const e=jn,n=gl;t.ParseSuccess=Symbol("ParseSuccessStruct");class r{constructor(o){this.ParseRule=null,this.errorHandler=null,this.hadError=!1,this.BeginRule=()=>this.state.Push(),this.FailRule=l=>(this.state.Pop(l),null),this.CancelRule=l=>{this.state.Pop(l)},this.SucceedRule=(l,a=null)=>{const u=this.state.Peek(l),h=this.state.PeekPenultimate();this.RuleDidSucceed&&this.RuleDidSucceed(a,h,u),this.state.Squash();let p=a;return p===null&&(p=r.ParseSuccess),p},this.Expect=(l,a=null,u=null)=>{let h=this.ParseObject(l);if(h===null){a===null&&(a=l.name);let p;const c=this.LineRemainder();c===null||c.length===0?p="end of line":p=`'${c}'`,this.Error(`Expected ${a} but saw ${p}`),u!==null&&(h=u())}return h},this.Error=(l,a=!1)=>{this.ErrorOnLine(l,this.lineIndex+1,a)},this.ErrorWithParsedObject=(l,a,u=!1)=>{this.ErrorOnLine(l,a.debugMetadata?a.debugMetadata.startLineNumber:-1,u)},this.ErrorOnLine=(l,a,u)=>{if(!this.state.errorReportedAlreadyInScope){const h=u?"Warning":"Error";if(this.errorHandler)this.errorHandler(l,this.index,a-1,u);else throw new Error(`${h} on line ${a}: ${l}`);this.state.NoteErrorReported()}u||(this.hadError=!0)},this.Warning=l=>this.Error(l,!0),this.LineRemainder=()=>this.Peek(()=>this.ParseUntilCharactersFromString(`
\r`)),this.SetFlag=(l,a)=>{a?this.state.customFlags|=l:this.state.customFlags&=~l},this.GetFlag=l=>Boolean(this.state.customFlags&l),this.ParseObject=l=>{const a=this.BeginRule(),u=this.state.stackHeight,h=l();if(u!==this.state.stackHeight)throw new Error("Mismatched Begin/Fail/Succeed rules");return h===null?this.FailRule(a):(this.SucceedRule(a,h),h)},this.Parse=l=>{const a=this.BeginRule(),u=l();return u===null?(this.FailRule(a),null):(this.SucceedRule(a,u),u)},this.OneOf=l=>{for(const a of l){const u=this.ParseObject(a);if(u!==null)return u}return null},this.OneOrMore=l=>{const a=[];let u=null;do u=this.ParseObject(l),u!==null&&a.push(u);while(u!==null);return a.length>0?a:null},this.Optional=l=>()=>{const a=this.ParseObject(l);return a===null?r.ParseSuccess:a},this.Exclude=l=>()=>this.ParseObject(l)&&r.ParseSuccess,this.OptionalExclude=l=>()=>(this.ParseObject(l),r.ParseSuccess),this.String=l=>()=>this.ParseString(l),this.TryAddResultToList=(l,a,u=!0)=>{if(l!==r.ParseSuccess){if(u&&Array.isArray(l)){const h=l;if(h!==null){for(const p of h)a.push(p);return}}a.push(l)}},this.Interleave=(l,a,u=null,h=!0)=>{const p=this.BeginRule(),c=[],m=this.ParseObject(l);if(m===null)return this.FailRule(p);this.TryAddResultToList(m,c,h);let S=null,E=null;do{if(u!==null&&this.Peek(u)!==null||(S=this.ParseObject(a),S===null))break;if(this.TryAddResultToList(S,c,h),E=null,S!==null){if(E=this.ParseObject(l),E===null)break;this.TryAddResultToList(E,c,h)}}while((S!==null||E!==null)&&!(S===r.ParseSuccess&&E==r.ParseSuccess)&&this.remainingLength>0);return c.length===0?this.FailRule(p):this.SucceedRule(p,c)},this.ParseString=l=>{if(l.length>this.remainingLength)return null;const a=this.BeginRule();let u=this.index,h=this.characterInLineIndex,p=this.lineIndex,c=!0;for(let m=0;m<l.length;m+=1){const S=l[m];if(this._chars[u]!==S){c=!1;break}S===`
`&&(p++,h=-1),u++,h++}return this.index=u,this.characterInLineIndex=h,this.lineIndex=p,c?this.SucceedRule(a,l):this.FailRule(a)},this.ParseSingleCharacter=()=>{if(this.remainingLength>0){const l=this._chars[this.index];return l===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1,l}return"0"},this.ParseUntilCharactersFromString=(l,a=-1)=>this.ParseCharactersFromString(l,!1,a),this.ParseUntilCharactersFromCharSet=(l,a=-1)=>this.ParseCharactersFromCharSet(l,!1,a),this.ParseCharactersFromString=(l,a=-1,u=-1)=>{const h=new e.CharacterSet(l);return typeof a=="number"?this.ParseCharactersFromCharSet(h,!0,a):this.ParseCharactersFromCharSet(h,a,u)},this.ParseCharactersFromCharSet=(l,a=!0,u=-1)=>{u===-1&&(u=Number.MAX_SAFE_INTEGER);const h=this.index;let p=this.index,c=this.characterInLineIndex,m=this.lineIndex,S=0;for(;p<this._chars.length&&l.set.has(this._chars[p])===a&&S<u;)this._chars[p]===`
`&&(m+=1,c=-1),p+=1,c+=1,S+=1;return this.index=p,this.characterInLineIndex=c,this.lineIndex=m,this.index>h?this._chars.slice(h,this.index).join(""):null},this.Peek=l=>{const a=this.BeginRule(),u=l();return this.CancelRule(a),u},this.ParseInt=()=>{const l=this.index,a=this.characterInLineIndex,u=this.ParseString("-")!==null;this.ParseCharactersFromString(" 	");const h=this.ParseCharactersFromCharSet(r.numbersCharacterSet);if(h===null)return this.index=l,this.characterInLineIndex=a,null;let p;return Number.isNaN(Number(h))?(this.Error("Failed to read integer value: "+h+". Perhaps it's out of the range of acceptable numbers ink supports? ("+Number.MIN_SAFE_INTEGER+" to "+Number.MAX_SAFE_INTEGER+")"),null):(p=Number(h),u?-p:p)},this.ParseFloat=()=>{const l=this.index,a=this.characterInLineIndex,u=this.ParseInt();if(u!==null&&this.ParseString(".")!==null){const h=this.ParseCharactersFromCharSet(r.numbersCharacterSet);return Number(`${u}.${h}`)}return this.index=l,this.characterInLineIndex=a,null},this.ParseNewline=()=>{const l=this.BeginRule();return this.ParseString("\r"),this.ParseString(`
`)===null?this.FailRule(l):this.SucceedRule(l,`
`)};const s=this.PreProcessInputString(o);this.state=new n.StringParserState,o?this._chars=s.split(""):this._chars=[],this.inputString=s}get currentCharacter(){return this.index>=0&&this.remainingLength>0?this._chars[this.index]:"0"}PreProcessInputString(o){return o}get endOfInput(){return this.index>=this._chars.length}get remainingString(){return this._chars.slice(this.index,this.index+this.remainingLength).join("")}get remainingLength(){return this._chars.length-this.index}get lineIndex(){return this.state.lineIndex}set lineIndex(o){this.state.lineIndex=o}set characterInLineIndex(o){this.state.characterInLineIndex=o}get characterInLineIndex(){return this.state.characterInLineIndex}get index(){return this.state.characterIndex}set index(o){this.state.characterIndex=o}ParseUntil(o,s=null,l=null){const a=this.BeginRule(),u=new e.CharacterSet;s!==null&&(u.set=new Set([...u.set.values(),...s.set.values()])),l!==null&&(u.set=new Set([...u.set.values(),...l.set.values()]));let h="",p=null;do{const c=this.ParseUntilCharactersFromCharSet(u);if(c&&(h+=c),p=this.Peek(o),p!==null)break;{if(this.endOfInput)break;const m=this.currentCharacter;if(s!==null&&s.set.has(m)){h+=m,m===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1;continue}else break}}while(!0);return h.length>0?this.SucceedRule(a,String(h)):this.FailRule(a)}}t.StringParser=r,r.ParseSuccess=t.ParseSuccess,r.numbersCharacterSet=new e.CharacterSet("0123456789")})(bh);Object.defineProperty(ml,"__esModule",{value:!0});ml.CommentEliminator=void 0;const Sa=jn,DC=bh;class VC extends DC.StringParser{constructor(){super(...arguments);this._commentOrNewlineStartCharacter=new Sa.CharacterSet(`/\r
`),this._commentBlockEndCharacter=new Sa.CharacterSet("*"),this._newlineCharacters=new Sa.CharacterSet(`
\r`),this.Process=()=>{const e=this.Interleave(this.Optional(this.CommentsAndNewlines),this.Optional(this.MainInk));return e!==null?e.join(""):""},this.MainInk=()=>this.ParseUntil(this.CommentsAndNewlines,this._commentOrNewlineStartCharacter,null),this.CommentsAndNewlines=()=>{let e=this.Interleave(this.Optional(this.ParseNewline),this.Optional(this.ParseSingleComment));return e!==null?e.join(""):null},this.ParseSingleComment=()=>this.OneOf([this.EndOfLineComment,this.BlockComment]),this.EndOfLineComment=()=>this.ParseString("//")===null?null:(this.ParseUntilCharactersFromCharSet(this._newlineCharacters),""),this.BlockComment=()=>{if(this.ParseString("/*")===null)return null;const e=this.lineIndex,n=this.ParseUntil(this.String("*/"),this._commentBlockEndCharacter,null);return this.endOfInput||this.ParseString("*/"),n!=null?`
`.repeat(this.lineIndex-e):null}}PreProcessInputString(e){return e}}ml.CommentEliminator=VC;var Vr={};Object.defineProperty(Vr,"__esModule",{value:!0});Vr.Conditional=void 0;const WC=he,Tf=Ve,jC=Z;class MC extends jC.ParsedObject{constructor(e,n){super();this.initialCondition=e,this.branches=n,this._reJoinTarget=null,this.GenerateRuntimeObject=()=>{const r=new WC.Container;this.initialCondition&&r.AddContent(this.initialCondition.runtimeObject);for(const i of this.branches){const o=i.runtimeObject;r.AddContent(o)}return this.initialCondition!==null&&this.branches[0].ownExpression!==null&&!this.branches[this.branches.length-1].isElse&&r.AddContent(Tf.ControlCommand.PopEvaluatedValue()),this._reJoinTarget=Tf.ControlCommand.NoOp(),r.AddContent(this._reJoinTarget),r},this.initialCondition&&this.AddContent(this.initialCondition),this.branches!==null&&this.AddContent(this.branches)}get typeName(){return"Conditional"}ResolveReferences(e){const n=this._reJoinTarget.path;for(const r of this.branches){if(!r.returnDivert)throw new Error;r.returnDivert.targetPath=n}super.ResolveReferences(e)}}Vr.Conditional=MC;var fs={},Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.Text=void 0;const $C=Z,BC=re;class GC extends $C.ParsedObject{constructor(e){super();this.text=e,this.GenerateRuntimeObject=()=>new BC.StringValue(this.text),this.toString=()=>this.text}get typeName(){return"Text"}}Bt.Text=GC;var Gt={},Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.ConstantDeclaration=void 0;const UC=Z,zC=$t;class qC extends UC.ParsedObject{constructor(e,n){super();this._expression=null,this.GenerateRuntimeObject=()=>null,this.constantIdentifier=e,n&&(this._expression=this.AddContent(n))}get constantName(){var e;return(e=this.constantIdentifier)===null||e===void 0?void 0:e.name}get expression(){if(!this._expression)throw new Error;return this._expression}get typeName(){return"CONST"}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.constantIdentifier,zC.SymbolType.Var)}}Wr.ConstantDeclaration=qC;var Gn={},Cn={},ut={},jr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.FlowLevel=void 0,function(e){e[e.Story=0]="Story",e[e.Knot=1]="Knot",e[e.Stitch=2]="Stitch",e[e.WeavePoint=3]="WeavePoint"}(t.FlowLevel||(t.FlowLevel={}))})(jr);var Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});Mr.Gather=void 0;const HC=he,KC=Z,JC=$t;class QC extends KC.ParsedObject{constructor(e,n){super();this.indentationDepth=n,this.GenerateRuntimeObject=()=>{const r=new HC.Container;if(r.name=this.name,this.story.countAllVisits&&(r.visitsShouldBeCounted=!0),r.countingAtStartOnly=!0,this.content)for(const i of this.content)r.AddContent(i.runtimeObject);return r},this.toString=()=>{var r,i;return`- ${((r=this.identifier)===null||r===void 0?void 0:r.name)?"("+((i=this.identifier)===null||i===void 0?void 0:i.name)+")":"gather"}`},e&&(this.identifier=e)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get runtimeContainer(){return this.runtimeObject}get typeName(){return"Gather"}ResolveReferences(e){super.ResolveReferences(e),this.identifier&&(this.identifier.name||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,JC.SymbolType.SubFlowAndWeave)}}Mr.Gather=QC;var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.Path=void 0;const Hs=B,Nf=ut,Zn=jr,XC=Gt;class YC{constructor(e,n){this._dotSeparatedComponents=null,this.toString=()=>this.components===null||this.components.length===0?this.baseTargetLevel===Zn.FlowLevel.WeavePoint?"-> <next gather point>":"<invalid Path>":`-> ${this.dotSeparatedComponents}`,this.ResolveFromContext=r=>{if(this.components==null||this.components.length==0)return null;let i=this.ResolveBaseTarget(r);return i===null?null:this.components.length>1?this.ResolveTailComponents(i):i},this.ResolveBaseTarget=r=>{const i=this.firstComponent;let o=r;for(;o;){const s=o===r,l=this.GetChildFromContext(o,i,null,s);if(l)return l;o=o.parent}return null},this.ResolveTailComponents=r=>{let i=r;if(!this.components)return null;for(let o=1;o<this.components.length;++o){const s=this.components[o].name;let l,a=Hs.asOrNull(i,Nf.FlowBase);if(a!==null?l=a.flowLevel+1:l=Zn.FlowLevel.WeavePoint,i=this.GetChildFromContext(i,s,l),i===null)break}return i},this.GetChildFromContext=(r,i,o,s=!1)=>{const l=o===null,a=Hs.asOrNull(r,XC.Weave);if(i&&a!==null&&(l||o===Zn.FlowLevel.WeavePoint))return a.WeavePointNamed(i);let u=Hs.asOrNull(r,Nf.FlowBase);if(i&&u!==null){const h=s||u.flowLevel===Zn.FlowLevel.Knot;return u.ContentWithNameAtLevel(i,o,h)}return null},Object.values(Zn.FlowLevel).includes(e)?(this._baseTargetLevel=e,this.components=n||[]):Array.isArray(e)?(this._baseTargetLevel=null,this.components=e||[]):(this._baseTargetLevel=null,this.components=[e])}get baseTargetLevel(){return this.baseLevelIsAmbiguous?Zn.FlowLevel.Story:this._baseTargetLevel}get baseLevelIsAmbiguous(){return!this._baseTargetLevel}get firstComponent(){return this.components==null||!this.components.length?null:this.components[0].name}get numberOfComponents(){return this.components?this.components.length:0}get dotSeparatedComponents(){return this._dotSeparatedComponents==null&&(this._dotSeparatedComponents=(this.components?this.components:[]).map(e=>e.name).filter(Hs.filterUndef).join(".")),this._dotSeparatedComponents}get typeName(){return"Path"}}Ut.Path=YC;var ds={};Object.defineProperty(ds,"__esModule",{value:!0});ds.ReturnType=void 0;const ZC=Z,eS=he,wa=Ve,tS=Mt;class nS extends ZC.ParsedObject{constructor(e=null){super();this.returnedExpression=null,this.GenerateRuntimeObject=()=>{const n=new eS.Container;return this.returnedExpression?n.AddContent(this.returnedExpression.runtimeObject):(n.AddContent(wa.ControlCommand.EvalStart()),n.AddContent(new tS.Void),n.AddContent(wa.ControlCommand.EvalEnd())),n.AddContent(wa.ControlCommand.PopFunction()),n},e&&(this.returnedExpression=this.AddContent(e))}get typeName(){return"ReturnType"}}ds.ReturnType=nS;var Un={};Object.defineProperty(Un,"__esModule",{value:!0});Un.ClosestFlowBase=void 0;function rS(t){let e=t.parent;for(;e;){if(e.hasOwnProperty("iamFlowbase")&&e.iamFlowbase())return e;e=e.parent}return null}Un.ClosestFlowBase=rS;var $r={};Object.defineProperty($r,"__esModule",{value:!0});$r.Identifier=void 0;class Ih{constructor(e){this.debugMetadata=null,this.toString=()=>this.name||"undefined identifer",this.name=e}get typeName(){return"Identifier"}static Done(){return new Ih("DONE")}}$r.Identifier=Ih;Object.defineProperty(ut,"__esModule",{value:!0});ut.FlowBase=void 0;const iS=Mn,_a=Gn,sS=Cn,yt=jr,oS=Mr,lS=Z,aS=Ut,uS=ds,hS=he,cS=mt,fS=Tt,Ea=$t,dS=Gt,pS=Un,mS=$r,bf=B;class Ho extends lS.ParsedObject{constructor(e,n=null,r=null,i=!1,o=!1){super();this.isFunction=i,this._rootWeave=null,this._subFlowsByName=new Map,this._startingSubFlowDivert=null,this._startingSubFlowRuntime=null,this._firstChildFlow=null,this.variableDeclarations=new Map,this.identifier=null,this.args=null,this.iamFlowbase=()=>!0,this.SplitWeaveAndSubFlowContent=(s,l)=>{var a,u;const h=[],p=[];this._subFlowsByName=new Map;for(const m of s){const S=bf.asOrNull(m,Ho);S?(this._firstChildFlow===null&&(this._firstChildFlow=S),p.push(m),((a=S.identifier)===null||a===void 0?void 0:a.name)&&this._subFlowsByName.set((u=S.identifier)===null||u===void 0?void 0:u.name,S)):h.push(m)}l&&h.push(new oS.Gather(null,1),new _a.Divert(new aS.Path(mS.Identifier.Done())));const c=[];return h.length>0&&(this._rootWeave=new dS.Weave(h,0),c.push(this._rootWeave)),p.length>0&&c.push(...p),c},this.ResolveVariableWithName=(s,l)=>{var a;const u={},h=l===null?this:pS.ClosestFlowBase(l);if(h){if(h.args!==null){for(const p of h.args)if(((a=p.identifier)===null||a===void 0?void 0:a.name)===s)return u.found=!0,u.isArgument=!0,u.ownerFlow=h,u}if(h!==this.story&&h.variableDeclarations.has(s))return u.found=!0,u.ownerFlow=h,u.isTemporary=!0,u}return this.story.variableDeclarations.has(s)?(u.found=!0,u.ownerFlow=this.story,u.isGlobal=!0,u):(u.found=!1,u)},this.AddNewVariableDeclaration=s=>{const l=s.variableName;if(this.variableDeclarations.has(l)){const a=this.variableDeclarations.get(l);let u="";a.debugMetadata&&(u=` (${a.debugMetadata})`),this.Error(`found declaration variable '${l}' that was already declared${u}`,s,!1);return}this.variableDeclarations.set(s.variableName,s)},this.ResolveWeavePointNaming=()=>{this._rootWeave&&this._rootWeave.ResolveWeavePointNaming();for(const[,s]of this._subFlowsByName)s.hasOwnProperty("ResolveWeavePointNaming")&&s.ResolveWeavePointNaming()},this.GenerateRuntimeObject=()=>{var s;let l=null;this.isFunction?this.CheckForDisallowedFunctionFlowControl():(this.flowLevel===yt.FlowLevel.Knot||this.flowLevel===yt.FlowLevel.Stitch)&&(l=this.Find(uS.ReturnType)(),l!==null&&this.Error(`Return statements can only be used in knots that are declared as functions: == function ${this.identifier} ==`,l));const a=new hS.Container;a.name=(s=this.identifier)===null||s===void 0?void 0:s.name,this.story.countAllVisits&&(a.visitsShouldBeCounted=!0),this.GenerateArgumentVariableAssignments(a);let u=0;for(;this.content!==null&&u<this.content.length;){const h=this.content[u];if(h instanceof Ho){const p=h,c=p.runtimeObject;u===0&&!p.hasParameters&&this.flowLevel===yt.FlowLevel.Knot&&(this._startingSubFlowDivert=new cS.Divert,a.AddContent(this._startingSubFlowDivert),this._startingSubFlowRuntime=c);const m=c,S=a.namedContent.get(m.name)||null;if(S){const E=`${this.GetType()} already contains flow named '${m.name}' (at ${S.debugMetadata})`;this.Error(E,p)}a.AddToNamedContentOnly(m)}else h&&a.AddContent(h.runtimeObject);u+=1}return this.flowLevel!==yt.FlowLevel.Story&&!this.isFunction&&this._rootWeave!==null&&l===null&&this._rootWeave.ValidateTermination(this.WarningInTermination),a},this.GenerateArgumentVariableAssignments=s=>{var l;if(!(this.args===null||this.args.length===0))for(let a=this.args.length-1;a>=0;--a){const u=((l=this.args[a].identifier)===null||l===void 0?void 0:l.name)||null,h=new fS.VariableAssignment(u,!0);s.AddContent(h)}},this.ContentWithNameAtLevel=(s,l=null,a=!1)=>{var u;if((l===this.flowLevel||l===null)&&s===((u=this.identifier)===null||u===void 0?void 0:u.name))return this;if(l===yt.FlowLevel.WeavePoint||l===null){let p=null;if(this._rootWeave&&(p=this._rootWeave.WeavePointNamed(s),p))return p;if(l===yt.FlowLevel.WeavePoint)return a?this.DeepSearchForAnyLevelContent(s):null}if(l!==null&&l<this.flowLevel)return null;let h=this._subFlowsByName.get(s)||null;return h&&(l===null||l===h.flowLevel)?h:a?this.DeepSearchForAnyLevelContent(s):null},this.DeepSearchForAnyLevelContent=s=>{const l=this.ContentWithNameAtLevel(s,yt.FlowLevel.WeavePoint,!1);if(l)return l;for(const[,a]of this._subFlowsByName){const u=a.ContentWithNameAtLevel(s,null,!0);if(u)return u}return null},this.CheckForDisallowedFunctionFlowControl=()=>{this.flowLevel!==yt.FlowLevel.Knot&&this.Error("Functions cannot be stitches - i.e. they should be defined as '== function myFunc ==' rather than internal to another knot.");for(const[a,u]of this._subFlowsByName)this.Error(`Functions may not contain stitches, but saw '${a}' within the function '${this.identifier}'`,u);if(!this._rootWeave)throw new Error;const s=this._rootWeave.FindAll(_a.Divert)();for(const a of s)!a.isFunctionCall&&!(a.parent instanceof sS.DivertTarget)&&this.Error(`Functions may not contain diverts, but saw '${a}'`,a);const l=this._rootWeave.FindAll(iS.Choice)();for(const a of l)this.Error(`Functions may not contain choices, but saw '${a}'`,a)},this.WarningInTermination=s=>{let l="Apparent loose end exists where the flow runs out. Do you need a '-> DONE' statement, choice or divert?";s.parent===this._rootWeave&&this._firstChildFlow&&(l=`${l} Note that if you intend to enter '${this._firstChildFlow.identifier}' next, you need to divert to it explicitly.`);const a=bf.asOrNull(s,_a.Divert);a&&a.isTunnel&&(l+=` When final tunnel to '${a.target} ->' returns it won't have anywhere to go.`),this.Warning(l,s)},this.toString=()=>`${this.typeName} '${this.identifier}'`,this.identifier=e,this.args=r,n===null&&(n=[]),this.PreProcessTopLevelObjects(n),n=this.SplitWeaveAndSubFlowContent(n,this.GetType()=="Story"&&!o),this.AddContent(n)}get hasParameters(){return this.args!==null&&this.args.length>0}get subFlowsByName(){return this._subFlowsByName}get typeName(){return this.isFunction?"Function":String(this.flowLevel)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}PreProcessTopLevelObjects(e){}ResolveReferences(e){var n,r;if(this._startingSubFlowDivert){if(!this._startingSubFlowRuntime)throw new Error;this._startingSubFlowDivert.targetPath=this._startingSubFlowRuntime.path}if(super.ResolveReferences(e),this.args!==null){for(const i of this.args)e.CheckForNamingCollisions(this,i.identifier,Ea.SymbolType.Arg,"argument");for(let i=0;i<this.args.length;i+=1)for(let o=i+1;o<this.args.length;o+=1)((n=this.args[i].identifier)===null||n===void 0?void 0:n.name)==((r=this.args[o].identifier)===null||r===void 0?void 0:r.name)&&this.Error(`Multiple arguments with the same name: '${this.args[i].identifier}'`)}if(this.flowLevel!==yt.FlowLevel.Story){const i=this.flowLevel===yt.FlowLevel.Knot?Ea.SymbolType.Knot:Ea.SymbolType.SubFlowAndWeave;e.CheckForNamingCollisions(this,this.identifier,i)}}}ut.FlowBase=Ho;var zn={},Sn={},Br={};Object.defineProperty(Br,"__esModule",{value:!0});Br.ContentList=void 0;const gS=he,vS=Z,yS=Bt,CS=B;class SS extends vS.ParsedObject{constructor(e,...n){super();this.dontFlatten=!1,this.TrimTrailingWhitespace=()=>{for(let r=this.content.length-1;r>=0;--r){const i=CS.asOrNull(this.content[r],yS.Text);if(i===null)break;if(i.text=i.text.replace(new RegExp(/[ \t]/g),""),i.text.length===0)this.content.splice(r,1);else break}},this.GenerateRuntimeObject=()=>{const r=new gS.Container;if(this.content!==null)for(const i of this.content){const o=i.runtimeObject;o&&r.AddContent(o)}return this.dontFlatten&&this.story.DontFlattenContainer(r),r},this.toString=()=>`ContentList(${this.content.join(", ")})`,e&&this.AddContent(e),n&&this.AddContent(n)}get runtimeContainer(){return this.runtimeObject}get typeName(){return"ContentList"}}Br.ContentList=SS;var qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.VariableReference=void 0;const wS=Ae,_S=Ue;class ES extends wS.InkObject{constructor(e=null){super();this.pathForCount=null,this.name=e}get containerForCount(){return this.pathForCount===null?null:this.ResolvePath(this.pathForCount).container}get pathStringForCount(){return this.pathForCount===null?null:this.CompactPathString(this.pathForCount)}set pathStringForCount(e){e===null?this.pathForCount=null:this.pathForCount=new _S.Path(e)}toString(){if(this.name!=null)return"var("+this.name+")";{let e=this.pathStringForCount;return"read_count("+e+")"}}}qn.VariableReference=ES;Object.defineProperty(Sn,"__esModule",{value:!0});Sn.VariableReference=void 0;const PS=Br,OS=Ge,If=ut,xS=Ut,TS=qn,NS=Gt,bS=$r,kf=B;class IS extends OS.Expression{constructor(e){super();this.pathIdentifiers=e,this._runtimeVarRef=null,this.isConstantReference=!1,this.isListItemReference=!1,this.GenerateIntoContainer=n=>{let r=this.story.constants.get(this.name);if(r){r.GenerateConstantIntoContainer(n),this.isConstantReference=!0;return}if(this._runtimeVarRef=new TS.VariableReference(this.name),this.path.length===1||this.path.length===2){let i="",o="";this.path.length===1?i=this.path[0]:(o=this.path[0],i=this.path[1]),this.story.ResolveListItem(o,i,this)&&(this.isListItemReference=!0)}n.AddContent(this._runtimeVarRef)},this.toString=()=>`{${this.path.join(".")}}`}get name(){return this.path.join(".")}get path(){return this.pathIdentifiers.map(e=>e.name).filter(kf.filterUndef)}get identifier(){if(!this.pathIdentifiers||this.pathIdentifiers.length==0)return null;const e=this.path.join(".");return new bS.Identifier(e)}get runtimeVarRef(){return this._runtimeVarRef}get typeName(){return"ref"}ResolveReferences(e){if(super.ResolveReferences(e),this.isConstantReference||this.isListItemReference)return;const n=new xS.Path(this.pathIdentifiers),r=n.ResolveFromContext(this);if(r){if(!r.containerForCounting)throw new Error;if(r.containerForCounting.visitsShouldBeCounted=!0,this._runtimeVarRef===null)return;this._runtimeVarRef.pathForCount=r.runtimePath,this._runtimeVarRef.name=null;let i=kf.asOrNull(r,If.FlowBase);i&&i.isFunction&&(this.parent instanceof NS.Weave||this.parent instanceof PS.ContentList||this.parent instanceof If.FlowBase)&&this.Warning(`'${i.identifier}' being used as read count rather than being called as function. Perhaps you intended to write ${i.identifier}()`);return}if(this.path.length>1){let i=`Could not find target for read count: ${n}`;this.path.length<=2&&(i+=`, or couldn't find list item with the name ${this.path.join(",")}`),this.Error(i);return}e.ResolveVariableWithName(this.name,this).found||this.Error(`Unresolved variable: ${this.name}`,this)}}Sn.VariableReference=IS;Object.defineProperty(zn,"__esModule",{value:!0});zn.FunctionCall=void 0;const Ct=Ve,kS=Gn,AS=Cn,FS=Ge,RS=Ce,LS=re,_o=at,Af=Lr,DS=Ut,VS=re,WS=Sn,Ks=B;class Sm extends FS.Expression{constructor(e,n){super();this._divertTargetToCount=null,this._variableReferenceToCount=null,this.shouldPopReturnedValue=!1,this.GenerateIntoContainer=r=>{const i=this.story.ResolveList(this.name);let o=!1;if(this.isChoiceCount)this.args.length>0&&this.Error("The CHOICE_COUNT() function shouldn't take any arguments"),r.AddContent(Ct.ControlCommand.ChoiceCount());else if(this.isTurns)this.args.length>0&&this.Error("The TURNS() function shouldn't take any arguments"),r.AddContent(Ct.ControlCommand.Turns());else if(this.isTurnsSince||this.isReadCount){const s=Ks.asOrNull(this.args[0],AS.DivertTarget),l=Ks.asOrNull(this.args[0],WS.VariableReference);if(this.args.length!==1||s===null&&l===null){this.Error(`The ${this.name}() function should take one argument: a divert target to the target knot, stitch, gather or choice you want to check. e.g. TURNS_SINCE(-> myKnot)`);return}s?(this._divertTargetToCount=s,this.AddContent(this._divertTargetToCount),this._divertTargetToCount.GenerateIntoContainer(r)):l&&(this._variableReferenceToCount=l,this.AddContent(this._variableReferenceToCount),this._variableReferenceToCount.GenerateIntoContainer(r)),this.isTurnsSince?r.AddContent(Ct.ControlCommand.TurnsSince()):r.AddContent(Ct.ControlCommand.ReadCount())}else if(this.isRandom){this.args.length!==2&&this.Error("RANDOM should take 2 parameters: a minimum and a maximum integer");for(let s=0;s<this.args.length;s+=1){const l=Ks.asOrNull(this.args[s],Af.NumberExpression);if(l&&!l.isInt()){const a=s===0?"minimum":"maximum";this.Error(`RANDOM's ${a} parameter should be an integer`)}this.args[s].GenerateIntoContainer(r)}r.AddContent(Ct.ControlCommand.Random())}else if(this.isSeedRandom){this.args.length!==1&&this.Error("SEED_RANDOM should take 1 parameter - an integer seed");const s=Ks.asOrNull(this.args[0],Af.NumberExpression);s&&!s.isInt()&&this.Error("SEED_RANDOM's parameter should be an integer seed"),this.args[0].GenerateIntoContainer(r),r.AddContent(Ct.ControlCommand.SeedRandom())}else if(this.isListRange){this.args.length!==3&&this.Error("LIST_RANGE should take 3 parameters - a list, a min and a max");for(let s=0;s<this.args.length;s+=1)this.args[s].GenerateIntoContainer(r);r.AddContent(Ct.ControlCommand.ListRange())}else if(this.isListRandom)this.args.length!==1&&this.Error("LIST_RANDOM should take 1 parameter - a list"),this.args[0].GenerateIntoContainer(r),r.AddContent(Ct.ControlCommand.ListRandom());else if(_o.NativeFunctionCall.CallExistsWithName(this.name)){const s=_o.NativeFunctionCall.CallWithName(this.name);if(s.numberOfParameters!==this.args.length){let l=`${name} should take ${s.numberOfParameters} parameter`;s.numberOfParameters>1&&(l+="s"),this.Error(l)}for(let l=0;l<this.args.length;l+=1)this.args[l].GenerateIntoContainer(r);r.AddContent(_o.NativeFunctionCall.CallWithName(this.name))}else if(i!==null)if(this.args.length>1&&this.Error("Can currently only construct a list from one integer (or an empty list from a given list definition)"),this.args.length===1)r.AddContent(new VS.StringValue(this.name)),this.args[0].GenerateIntoContainer(r),r.AddContent(Ct.ControlCommand.ListFromInt());else{const s=new RS.InkList;s.SetInitialOriginName(this.name),r.AddContent(new LS.ListValue(s))}else r.AddContent(this._proxyDivert.runtimeObject),o=!0;o||this.content.splice(this.content.indexOf(this._proxyDivert),1),this.shouldPopReturnedValue&&r.AddContent(Ct.ControlCommand.PopEvaluatedValue())},this.toString=()=>{const r=this.args.join(", ");return`${this.name}(${r})`},this._proxyDivert=new kS.Divert(new DS.Path(e),n),this._proxyDivert.isFunctionCall=!0,this.AddContent(this._proxyDivert)}get proxyDivert(){return this._proxyDivert}get name(){return this._proxyDivert.target.firstComponent||""}get args(){return this._proxyDivert.args}get runtimeDivert(){return this._proxyDivert.runtimeDivert}get isChoiceCount(){return this.name==="CHOICE_COUNT"}get isTurns(){return this.name==="TURNS"}get isTurnsSince(){return this.name==="TURNS_SINCE"}get isRandom(){return this.name==="RANDOM"}get isSeedRandom(){return this.name==="SEED_RANDOM"}get isListRange(){return this.name==="LIST_RANGE"}get isListRandom(){return this.name==="LIST_RANDOM"}get isReadCount(){return this.name==="READ_COUNT"}get typeName(){return"FunctionCall"}ResolveReferences(e){if(super.ResolveReferences(e),!this.content.includes(this._proxyDivert)&&this.args!==null)for(const n of this.args)n.ResolveReferences(e);if(this._divertTargetToCount){const n=this._divertTargetToCount.divert,r=n.runtimeDivert.variableDivertName!=null;if(r){this.Error(`When getting the TURNS_SINCE() of a variable target, remove the '->' - i.e. it should just be TURNS_SINCE(${n.runtimeDivert.variableDivertName})`);return}const i=n.targetContent;if(i===null)r||this.Error(`Failed to find target for TURNS_SINCE: '${n.target}'`);else{if(!i.containerForCounting)throw new Error;i.containerForCounting.turnIndexShouldBeCounted=!0}}else if(this._variableReferenceToCount){const n=this._variableReferenceToCount.runtimeVarRef;if(!n)throw new Error;n.pathForCount!==null&&this.Error(`Should be '${name}'(-> '${this._variableReferenceToCount.name}). Usage without the '->' only makes sense for variable targets.`)}}}zn.FunctionCall=Sm;Sm.IsBuiltIn=t=>_o.NativeFunctionCall.CallExistsWithName(t)?!0:t==="CHOICE_COUNT"||t==="TURNS_SINCE"||t==="TURNS"||t==="RANDOM"||t==="SEED_RANDOM"||t==="LIST_VALUE"||t==="LIST_RANDOM"||t==="READ_COUNT";var ps={};Object.defineProperty(ps,"__esModule",{value:!0});ps.MultipleConditionExpression=void 0;const jS=Ge,MS=at;class $S extends jS.Expression{constructor(e){super();this.GenerateIntoContainer=n=>{let r=!0;for(const i of this.subExpressions)i.GenerateIntoContainer(n),r||n.AddContent(MS.NativeFunctionCall.CallWithName("&&")),r=!1},this.AddContent(e)}get subExpressions(){return this.content}get typeName(){return"MultipleConditionExpression"}}ps.MultipleConditionExpression=$S;Object.defineProperty(Cn,"__esModule",{value:!0});Cn.DivertTarget=void 0;const BS=us,GS=Mn,US=Vr,zS=fs,qS=re,Pa=Ge,HS=ut,Ff=zn,KS=ps,Rf=Sn,Oa=B;class Vi extends Pa.Expression{constructor(e){super();this._runtimeDivert=null,this._runtimeDivertTargetValue=null,this.GenerateIntoContainer=n=>{this.divert.GenerateRuntimeObject(),this._runtimeDivert=this.divert.runtimeDivert,this._runtimeDivertTargetValue=new qS.DivertTargetValue,n.AddContent(this.runtimeDivertTargetValue)},this.Equals=n=>{const r=Oa.asOrNull(n,Vi);if(!r||!this.divert.target||!r.divert.target)return!1;const i=this.divert.target.dotSeparatedComponents,o=r.divert.target.dotSeparatedComponents;return i===o},this.divert=this.AddContent(e)}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}get runtimeDivertTargetValue(){if(!this._runtimeDivertTargetValue)throw new Error;return this._runtimeDivertTargetValue}get typeName(){return"DivertTarget"}ResolveReferences(e){if(super.ResolveReferences(e),this.divert.isDone||this.divert.isEnd){this.Error("Can't use -> DONE or -> END as variable divert targets",this);return}let n=this;for(;n&&n instanceof Pa.Expression;){let i=!1,o=!1;const s=n.parent;if(s instanceof BS.BinaryExpression){const l=s;l.opName!=="=="&&l.opName!=="!="?i=!0:(l.leftExpression instanceof Vi||l.leftExpression instanceof Rf.VariableReference)&&(l.rightExpression instanceof Vi||l.rightExpression instanceof Rf.VariableReference)||(i=!0),o=!0}else if(s instanceof Ff.FunctionCall){const l=s;!l.isTurnsSince&&!l.isReadCount&&(i=!0),o=!0}else(s instanceof Pa.Expression||s instanceof KS.MultipleConditionExpression||s instanceof GS.Choice&&s.condition===n||s instanceof US.Conditional||s instanceof zS.ConditionalSingleBranch)&&(i=!0,o=!0);if(i&&this.Error(`Can't use a divert target like that. Did you intend to call '${this.divert.target}' as a function: likeThis(), or check the read count: likeThis, with no arrows?`,this),o)break;n=s}if(this.runtimeDivert.hasVariableTarget){if(!this.divert.target)throw new Error;this.Error(`Since '${this.divert.target.dotSeparatedComponents}' is a variable, it shouldn't be preceded by '->' here.`)}this.runtimeDivert.targetPath&&(this.runtimeDivertTargetValue.targetPath=this.runtimeDivert.targetPath);let r=this.divert.targetContent;if(r!==null){let i=r.containerForCounting;if(i!==null){const s=Oa.asOrNull(this.parent,Ff.FunctionCall);s&&s.isTurnsSince||(i.visitsShouldBeCounted=!0),i.turnIndexShouldBeCounted=!0}let o=Oa.asOrNull(r,HS.FlowBase);if(o!=null&&o.args!==null)for(const s of o.args)s.isByReference&&this.Error(`Can't store a divert target to a knot or function that has by-reference arguments ('${o.identifier}' has 'ref ${s.identifier}').`)}}}Cn.DivertTarget=Vi;Object.defineProperty(Gn,"__esModule",{value:!0});Gn.Divert=void 0;const JS=he,li=Ve,QS=mt,xa=Cn,Ta=ut,XS=zn,YS=Z,Lf=Ut,ZS=Ue,Df=$n,ew=re,Vf=Sn,tw=Un,ai=B;class nw extends YS.ParsedObject{constructor(e,n){super();this.args=[],this.target=null,this.targetContent=null,this._runtimeDivert=null,this.isFunctionCall=!1,this.isEmpty=!1,this.isTunnel=!1,this.isThread=!1,this.GenerateRuntimeObject=()=>{if(this.isEnd)return li.ControlCommand.End();if(this.isDone)return li.ControlCommand.Done();this.runtimeDivert=new QS.Divert,this.ResolveTargetContent(),this.CheckArgumentValidity();const r=this.args!==null&&this.args.length>0;if(r||this.isFunctionCall||this.isTunnel||this.isThread){const i=new JS.Container;if(r){this.isFunctionCall||i.AddContent(li.ControlCommand.EvalStart());let o=null;this.targetContent&&(o=this.targetContent.args);for(let s=0;s<this.args.length;++s){const l=this.args[s];let a=null;if(o&&s<o.length&&(a=o[s]),a&&a.isByReference){const u=ai.asOrNull(l,Vf.VariableReference);if(!u){this.Error(`Expected variable name to pass by reference to 'ref ${a.identifier}' but saw ${l}`);break}const h=new Lf.Path(u.pathIdentifiers);if(h.ResolveFromContext(this)){this.Error(`can't pass a read count by reference. '${h.dotSeparatedComponents}' is a knot/stitch/label, but '${this.target.dotSeparatedComponents}' requires the name of a VAR to be passed.`);break}const c=new ew.VariablePointerValue(u.name);i.AddContent(c)}else l.GenerateIntoContainer(i)}this.isFunctionCall||i.AddContent(li.ControlCommand.EvalEnd())}return this.isThread?i.AddContent(li.ControlCommand.StartThread()):(this.isFunctionCall||this.isTunnel)&&(this.runtimeDivert.pushesToStack=!0,this.runtimeDivert.stackPushType=this.isFunctionCall?Df.PushPopType.Function:Df.PushPopType.Tunnel),i.AddContent(this.runtimeDivert),i}return this.runtimeDivert},this.PathAsVariableName=()=>this.target?this.target.firstComponent:null,this.ResolveTargetContent=()=>{if(!(this.isEmpty||this.isEnd)&&this.targetContent===null){let r=this.PathAsVariableName();if(r!==null){const i=ai.asOrNull(tw.ClosestFlowBase(this),Ta.FlowBase);if(i){const o=i.ResolveVariableWithName(r,this);if(o.found){if(o.isArgument&&o.ownerFlow&&o.ownerFlow.args){let s=o.ownerFlow.args.find(l=>{var a;return((a=l.identifier)===null||a===void 0?void 0:a.name)==r});s&&!s.isDivertTarget&&this.Error(`Since '${s.identifier}' is used as a variable divert target (on ${this.debugMetadata}), it should be marked as: -> ${s.identifier}`,o.ownerFlow)}this.runtimeDivert.variableDivertName=r;return}}}if(!this.target)throw new Error;this.targetContent=this.target.ResolveFromContext(this)}},this.CheckArgumentValidity=()=>{if(this.isEmpty)return;let r=0;if(this.args!==null&&this.args.length>0&&(r=this.args.length),this.targetContent===null)return;const i=ai.asOrNull(this.targetContent,Ta.FlowBase);if(r===0&&(i===null||!i.hasParameters))return;if(i===null&&r>0){this.Error("target needs to be a knot or stitch in order to pass arguments");return}else if(i!==null&&(i.args===null||!i.args&&r>0)){this.Error(`target (${i.name}) doesn't take parameters`);return}else if(this.parent instanceof xa.DivertTarget){r>0&&this.Error("can't store arguments in a divert target variable");return}const o=i.args.length;if(o!==r){let s;r===0?s="but there weren't any passed to it":r<o?s=`but only got ${r}`:s=`but got ${r}`,this.Error(`to '${i.identifier}' requires ${o} arguments, ${s}`);return}for(let s=0;s<o;++s){const l=i.args[s],a=this.args[s];if(l.isDivertTarget){let u=ai.asOrNull(a,Vf.VariableReference);if(!(a instanceof xa.DivertTarget)&&u===null)this.Error(`Target '${i.identifier}' expects a divert target for the parameter named -> ${l.identifier} but saw ${a}`,a);else if(u){const h=new Lf.Path(u.pathIdentifiers);h.ResolveFromContext(u)&&this.Error(`Passing read count of '${h.dotSeparatedComponents}' instead of a divert target. You probably meant '${h}'`)}}}if(i===null){this.Error("Can't call as a function or with arguments unless it's a knot or stitch");return}},this.CheckExternalArgumentValidity=r=>{const i=this.target?this.target.firstComponent:null,o=r.externals.get(i);if(!o)throw new Error("external not found");const s=o.argumentNames.length;let l=0;this.args&&(l=this.args.length),l!==s&&this.Error(`incorrect number of arguments sent to external function '${i}'. Expected ${s} but got ${l}`)},this.toString=()=>{let r="";if(this.target!==null)r+=this.target.toString();else return"-> <empty divert>";return this.isTunnel&&(r+=" ->"),this.isFunctionCall&&(r+=" ()"),r},e&&(this.target=e),n&&(this.args=n,this.AddContent(n))}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}set runtimeDivert(e){this._runtimeDivert=e}get isEnd(){return Boolean(this.target&&this.target.dotSeparatedComponents==="END")}get isDone(){return Boolean(this.target&&this.target.dotSeparatedComponents==="DONE")}get typeName(){return"Divert"}ResolveReferences(e){if(this.isEmpty||this.isEnd||this.isDone)return;if(!this.runtimeDivert)throw new Error;this.targetContent&&(this.runtimeDivert.targetPath=this.targetContent.runtimePath),super.ResolveReferences(e);let n=ai.asOrNull(this.targetContent,Ta.FlowBase);n&&(!n.isFunction&&this.isFunctionCall?super.Error(`${n.identifier} hasn't been marked as a function, but it's being called as one. Do you need to delcare the knot as '== function ${n.identifier} =='?`):n.isFunction&&!this.isFunctionCall&&!(this.parent instanceof xa.DivertTarget)&&super.Error(n.identifier+" can't be diverted to. It can only be called as a function since it's been marked as such: '"+n.identifier+"(...)'"));const r=this.targetContent!==null;let i=!1,o=!1;if(this.target){if(this.target.numberOfComponents===1){if(!this.target.firstComponent)throw new Error;if(i=XS.FunctionCall.IsBuiltIn(this.target.firstComponent),o=e.IsExternal(this.target.firstComponent),i||o){this.isFunctionCall||super.Error(`${this.target.firstComponent} must be called as a function: ~ ${this.target.firstComponent}()`),o&&(this.runtimeDivert.isExternal=!0,this.args!==null&&(this.runtimeDivert.externalArgs=this.args.length),this.runtimeDivert.pushesToStack=!1,this.runtimeDivert.targetPath=new ZS.Path(this.target.firstComponent),this.CheckExternalArgumentValidity(e));return}}}else throw new Error;this.runtimeDivert.variableDivertName==null&&!r&&!i&&!o&&this.Error(`target not found: '${this.target}'`)}Error(e,n=null,r=!1){if(n!==this&&n){super.Error(e,n);return}this.isFunctionCall?super.Error(`Function call ${e}`,n,r):super.Error(`Divert ${e}`,n,r)}}Gn.Divert=nw;var yl={};Object.defineProperty(yl,"__esModule",{value:!0});yl.GatherPointToResolve=void 0;class rw{constructor(e,n){this.divert=e,this.targetRuntimeObj=n}}yl.GatherPointToResolve=rw;var ms={},Cl={};Object.defineProperty(Cl,"__esModule",{value:!0});Cl.SequenceDivertToResolve=void 0;class iw{constructor(e,n){this.divert=e,this.targetContent=n}}Cl.SequenceDivertToResolve=iw;var kh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SequenceType=void 0,function(e){e[e.Stopping=1]="Stopping",e[e.Cycle=2]="Cycle",e[e.Shuffle=4]="Shuffle",e[e.Once=8]="Once"}(t.SequenceType||(t.SequenceType={}))})(kh);Object.defineProperty(ms,"__esModule",{value:!0});ms.Sequence=void 0;const Wf=he,ct=Ve,Na=mt,ui=re,Js=at,sw=Z,ow=Cl,Qs=kh,lw=Gt;class aw extends sw.ParsedObject{constructor(e,n){super();this.sequenceType=n,this._sequenceDivertsToResolve=[],this.GenerateRuntimeObject=()=>{const r=new Wf.Container;r.visitsShouldBeCounted=!0,r.countingAtStartOnly=!0,this._sequenceDivertsToResolve=[],r.AddContent(ct.ControlCommand.EvalStart()),r.AddContent(ct.ControlCommand.VisitIndex());const i=(this.sequenceType&Qs.SequenceType.Once)>0,o=(this.sequenceType&Qs.SequenceType.Cycle)>0,s=(this.sequenceType&Qs.SequenceType.Stopping)>0,l=(this.sequenceType&Qs.SequenceType.Shuffle)>0;let a=this.sequenceElements.length;if(i&&(a+=1),s||i?(r.AddContent(new ui.IntValue(a-1)),r.AddContent(Js.NativeFunctionCall.CallWithName("MIN"))):o&&(r.AddContent(new ui.IntValue(this.sequenceElements.length)),r.AddContent(Js.NativeFunctionCall.CallWithName("%"))),l){const h=ct.ControlCommand.NoOp();if(i||s){const c=s?this.sequenceElements.length-1:this.sequenceElements.length;r.AddContent(ct.ControlCommand.Duplicate()),r.AddContent(new ui.IntValue(c)),r.AddContent(Js.NativeFunctionCall.CallWithName("=="));const m=new Na.Divert;m.isConditional=!0,r.AddContent(m),this.AddDivertToResolve(m,h)}let p=this.sequenceElements.length;s&&(p-=1),r.AddContent(new ui.IntValue(p)),r.AddContent(ct.ControlCommand.SequenceShuffleIndex()),(i||s)&&r.AddContent(h)}r.AddContent(ct.ControlCommand.EvalEnd());const u=ct.ControlCommand.NoOp();for(let h=0;h<a;h+=1){r.AddContent(ct.ControlCommand.EvalStart()),r.AddContent(ct.ControlCommand.Duplicate()),r.AddContent(new ui.IntValue(h)),r.AddContent(Js.NativeFunctionCall.CallWithName("==")),r.AddContent(ct.ControlCommand.EvalEnd());const p=new Na.Divert;p.isConditional=!0,r.AddContent(p);let c;h<this.sequenceElements.length?c=this.sequenceElements[h].runtimeObject:c=new Wf.Container,c.name=`s${h}`,c.InsertContent(ct.ControlCommand.PopEvaluatedValue(),0);const m=new Na.Divert;c.AddContent(m),r.AddToNamedContentOnly(c),this.AddDivertToResolve(p,c),this.AddDivertToResolve(m,u)}return r.AddContent(u),r},this.AddDivertToResolve=(r,i)=>{this._sequenceDivertsToResolve.push(new ow.SequenceDivertToResolve(r,i))},this.sequenceType=n,this.sequenceElements=[];for(const r of e){const i=r.content;let o=null;i===null||i.length===0?o=r:o=new lw.Weave(i),this.sequenceElements.push(o),this.AddContent(o)}}get typeName(){return"Sequence"}ResolveReferences(e){super.ResolveReferences(e);for(const n of this._sequenceDivertsToResolve)n.divert.targetPath=n.targetContent.path}}ms.Sequence=aw;var gs={};Object.defineProperty(gs,"__esModule",{value:!0});gs.TunnelOnwards=void 0;const uw=he,hi=Ve,hw=re,cw=Z,fw=Mt;class dw extends cw.ParsedObject{constructor(){super(...arguments);this._overrideDivertTarget=null,this._divertAfter=null,this.GenerateRuntimeObject=()=>{const e=new uw.Container;if(e.AddContent(hi.ControlCommand.EvalStart()),this.divertAfter){const r=this.divertAfter.GenerateRuntimeObject();if(r){const i=this.divertAfter.args;if(i!==null&&i.length>0){let o=-1,s=-1;for(let l=0;l<r.content.length;l+=1){const a=r.content[l];a&&(o==-1&&a.commandType===hi.ControlCommand.CommandType.EvalStart?o=l:a.commandType===hi.ControlCommand.CommandType.EvalEnd&&(s=l))}for(let l=o+1;l<s;l+=1){const a=r.content[l];a.parent=null,e.AddContent(r.content[l])}}}this._overrideDivertTarget=new hw.DivertTargetValue,e.AddContent(this._overrideDivertTarget)}else e.AddContent(new fw.Void);return e.AddContent(hi.ControlCommand.EvalEnd()),e.AddContent(hi.ControlCommand.PopTunnel()),e},this.toString=()=>` -> ${this._divertAfter}`}get divertAfter(){return this._divertAfter}set divertAfter(e){this._divertAfter=e,this._divertAfter&&this.AddContent(this._divertAfter)}get typeName(){return"TunnelOnwards"}ResolveReferences(e){super.ResolveReferences(e),this.divertAfter&&this.divertAfter.targetContent&&(this._overrideDivertTarget.targetPath=this.divertAfter.targetContent.runtimePath)}}gs.TunnelOnwards=dw;var vs={},Gr={},ys={};Object.defineProperty(ys,"__esModule",{value:!0});ys.ListDefinition=void 0;const ba=Ce;class pw{constructor(e,n){this._name=e||"",this._items=null,this._itemNameToValues=n||new Map}get name(){return this._name}get items(){if(this._items==null){this._items=new Map;for(let[e,n]of this._itemNameToValues){let r=new ba.InkListItem(this.name,e);this._items.set(r.serialized(),n)}}return this._items}ValueForItem(e){if(!e.itemName)return 0;let n=this._itemNameToValues.get(e.itemName);return typeof n!="undefined"?n:0}ContainsItem(e){return!e.itemName||e.originName!=this.name?!1:this._itemNameToValues.has(e.itemName)}ContainsItemWithName(e){return this._itemNameToValues.has(e)}TryGetItemWithValue(e,n){for(let[r,i]of this._itemNameToValues)if(i==e)return n=new ba.InkListItem(this.name,r),{result:n,exists:!0};return n=ba.InkListItem.Null,{result:n,exists:!1}}TryGetValueForItem(e,n){if(!e.itemName)return{result:0,exists:!1};let r=this._itemNameToValues.get(e.itemName);return r?{result:r,exists:!0}:{result:0,exists:!1}}}ys.ListDefinition=pw;Object.defineProperty(Gr,"__esModule",{value:!0});Gr.ListDefinition=void 0;const mw=Ce,gw=Ce,vw=ys,yw=re,Cw=Z,Sw=$t;class ww extends Cw.ParsedObject{constructor(e){super();this.itemDefinitions=e,this.identifier=null,this.variableAssignment=null,this._elementsByName=null,this.ItemNamed=r=>{if(this._elementsByName===null){this._elementsByName=new Map;for(const o of this.itemDefinitions)this._elementsByName.set(o.name,o)}return this._elementsByName.get(r)||null},this.GenerateRuntimeObject=()=>{var r,i;const o=new mw.InkList;for(const s of this.itemDefinitions)if(s.inInitialList){const l=new gw.InkListItem(((r=this.identifier)===null||r===void 0?void 0:r.name)||null,s.name||null);o.Add(l,s.seriesValue)}return o.SetInitialOriginName(((i=this.identifier)===null||i===void 0?void 0:i.name)||""),new yw.ListValue(o)};let n=1;for(const r of this.itemDefinitions)r.explicitValue!==null&&(n=r.explicitValue),r.seriesValue=n,n+=1;this.AddContent(e)}get typeName(){return"ListDefinition"}get runtimeListDefinition(){var e;const n=new Map;for(const r of this.itemDefinitions)n.has(r.name)?this.Error(`List '${this.identifier}' contains duplicate items called '${r.name}'`):n.set(r.name,r.seriesValue);return new vw.ListDefinition(((e=this.identifier)===null||e===void 0?void 0:e.name)||"",n)}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.identifier,Sw.SymbolType.List)}}Gr.ListDefinition=ww;Object.defineProperty(vs,"__esModule",{value:!0});vs.VariableAssignment=void 0;const _w=he,Ew=Un,Pw=Gr,Ow=Z,jf=$t,xw=Tt,Tw=Sn,Nw=B;class bw extends Ow.ParsedObject{constructor({assignedExpression:e,isGlobalDeclaration:n,isTemporaryNewDeclaration:r,listDef:i,variableIdentifier:o}){super();this._runtimeAssignment=null,this.expression=null,this.listDefinition=null,this.GenerateRuntimeObject=()=>{let s=null;if(this.isGlobalDeclaration?s=this.story:this.isNewTemporaryDeclaration&&(s=Ew.ClosestFlowBase(this)),s&&s.AddNewVariableDeclaration(this),this.isGlobalDeclaration)return null;const l=new _w.Container;return this.expression?l.AddContent(this.expression.runtimeObject):this.listDefinition&&l.AddContent(this.listDefinition.runtimeObject),this._runtimeAssignment=new xw.VariableAssignment(this.variableName,this.isNewTemporaryDeclaration),l.AddContent(this._runtimeAssignment),l},this.toString=()=>`${this.isGlobalDeclaration?"VAR":this.isNewTemporaryDeclaration?"~ temp":""} ${this.variableName}`,this.variableIdentifier=o,this.isGlobalDeclaration=Boolean(n),this.isNewTemporaryDeclaration=Boolean(r),i instanceof Pw.ListDefinition?(this.listDefinition=this.AddContent(i),this.listDefinition.variableAssignment=this,this.isGlobalDeclaration=!0):e&&(this.expression=this.AddContent(e))}get variableName(){return this.variableIdentifier.name}get typeName(){return this.isNewTemporaryDeclaration?"temp":this.isGlobalDeclaration?this.listDefinition!==null?"LIST":"VAR":"variable assignment"}get isDeclaration(){return this.isGlobalDeclaration||this.isNewTemporaryDeclaration}ResolveReferences(e){if(super.ResolveReferences(e),this.isDeclaration&&this.listDefinition===null&&e.CheckForNamingCollisions(this,this.variableIdentifier,this.isGlobalDeclaration?jf.SymbolType.Var:jf.SymbolType.Temp),this.isGlobalDeclaration){const n=Nw.asOrNull(this.expression,Tw.VariableReference);n&&!n.isConstantReference&&!n.isListItemReference&&this.Error("global variable assignments cannot refer to other variables, only literal values, constants and list items")}if(!this.isNewTemporaryDeclaration){const n=e.ResolveVariableWithName(this.variableName,this);n.found||(this.variableName in this.story.constants?this.Error(`Can't re-assign to a constant (do you need to use VAR when declaring '${this.variableName}'?)`,this):this.Error(`Variable could not be found to assign to: '${this.variableName}'`,this)),this._runtimeAssignment&&(this._runtimeAssignment.isGlobal=n.isGlobal)}}}vs.VariableAssignment=bw;Object.defineProperty(Gt,"__esModule",{value:!0});Gt.Weave=void 0;const Mf=Rr,Ye=Mn,Xs=Vr,Iw=Wr,kw=he,Ys=Gn,Aw=mt,Fw=Cn,Rw=ut,St=Mr,Lw=yl,Dw=Z,Ia=ms,Vw=Bt,Ww=gs,jw=vs,Ze=B;class Xt extends Dw.ParsedObject{constructor(e,n=-1){super();this.previousWeavePoint=null,this.addContentToPreviousWeavePoint=!1,this.hasSeenChoiceInSection=!1,this.currentContainer=null,this._unnamedGatherCount=0,this._choiceCount=0,this._rootContainer=null,this._namedWeavePoints=new Map,this.looseEnds=[],this.gatherPointsToResolve=[],this.ResolveWeavePointNaming=()=>{var r,i,o;const s=[...this.FindAll(St.Gather)(l=>!(l.name===null||l.name===void 0)),...this.FindAll(Ye.Choice)(l=>!(l.name===null||l.name===void 0))];this._namedWeavePoints=new Map;for(const l of s){const a=this.namedWeavePoints.get(((r=l.identifier)===null||r===void 0?void 0:r.name)||"");if(a){const u=a instanceof St.Gather?"gather":"choice",h=a;this.Error(`A ${u} with the same label name '${l.name}' already exists in this context on line ${h.debugMetadata?h.debugMetadata.startLineNumber:"NO DEBUG METADATA AVAILABLE"}`,l)}((i=l.identifier)===null||i===void 0?void 0:i.name)&&this.namedWeavePoints.set((o=l.identifier)===null||o===void 0?void 0:o.name,l)}},this.ConstructWeaveHierarchyFromIndentation=()=>{let r=0;for(;r<this.content.length;){const i=this.content[r];if(i instanceof Ye.Choice||i instanceof St.Gather){const s=i.indentationDepth-1;if(s>this.baseIndentIndex){let l=r;for(;r<this.content.length;){const p=Ze.asOrNull(this.content[r],Ye.Choice)||Ze.asOrNull(this.content[r],St.Gather);if(p!==null&&p.indentationDepth-1<=this.baseIndentIndex)break;r+=1}const a=r-l,u=this.content.slice(l,l+a);this.content.splice(l,a);const h=new Xt(u,s);this.InsertContent(l,h),r=l}}r+=1}},this.DetermineBaseIndentationFromContent=r=>{for(const i of r)if(i instanceof Ye.Choice||i instanceof St.Gather)return i.indentationDepth-1;return 0},this.GenerateRuntimeObject=()=>{this._rootContainer=new kw.Container,this.currentContainer=this._rootContainer,this.looseEnds=[],this.gatherPointsToResolve=[];for(const r of this.content)if(r instanceof Ye.Choice||r instanceof St.Gather)this.AddRuntimeForWeavePoint(r);else if(r instanceof Xt){const i=r;this.AddRuntimeForNestedWeave(i),this.gatherPointsToResolve.splice(0,0,...i.gatherPointsToResolve)}else this.AddGeneralRuntimeContent(r.runtimeObject);return this.PassLooseEndsToAncestors(),this._rootContainer},this.AddRuntimeForGather=r=>{const i=!this.hasSeenChoiceInSection;this.hasSeenChoiceInSection=!1;const o=r.runtimeContainer;if(r.name||(o.name=`g-${this._unnamedGatherCount}`,this._unnamedGatherCount+=1),i){if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(o)}else this.rootContainer.AddToNamedContentOnly(o);for(const s of this.looseEnds){const l=s;if(l instanceof St.Gather&&l.indentationDepth==r.indentationDepth)continue;let a=null;if(l instanceof Ys.Divert)a=l.runtimeObject;else{a=new Aw.Divert;const u=l;if(!u.runtimeContainer)throw new Error;u.runtimeContainer.AddContent(a)}this.gatherPointsToResolve.push(new Lw.GatherPointToResolve(a,o))}this.looseEnds=[],this.currentContainer=o},this.AddRuntimeForWeavePoint=r=>{if(r instanceof St.Gather)this.AddRuntimeForGather(r);else if(r instanceof Ye.Choice){if(!this.currentContainer)throw new Error;this.previousWeavePoint instanceof St.Gather&&this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1);const i=r;if(this.currentContainer.AddContent(i.runtimeObject),!i.innerContentContainer)throw new Error;i.innerContentContainer.name=`c-${this._choiceCount}`,this.currentContainer.AddToNamedContentOnly(i.innerContentContainer),this._choiceCount+=1,this.hasSeenChoiceInSection=!0}this.addContentToPreviousWeavePoint=!1,this.WeavePointHasLooseEnd(r)&&(this.looseEnds.push(r),Ze.asOrNull(r,Ye.Choice)&&(this.addContentToPreviousWeavePoint=!0)),this.previousWeavePoint=r},this.AddRuntimeForNestedWeave=r=>{this.AddGeneralRuntimeContent(r.rootContainer),this.previousWeavePoint!==null&&(this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1),this.addContentToPreviousWeavePoint=!1)},this.AddGeneralRuntimeContent=r=>{if(r!==null)if(this.addContentToPreviousWeavePoint){if(!this.previousWeavePoint||!this.previousWeavePoint.runtimeContainer)throw new Error;this.previousWeavePoint.runtimeContainer.AddContent(r)}else{if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(r)}},this.PassLooseEndsToAncestors=()=>{if(this.looseEnds.length===0)return;let r=null,i=null,o=!1;for(let s=this.parent;s!==null;s=s.parent){const l=Ze.asOrNull(s,Xt);l&&(!o&&r===null&&(r=l),o&&i===null&&(i=l)),(s instanceof Ia.Sequence||s instanceof Xs.Conditional)&&(o=!0)}if(!(r===null&&i===null))for(let s=this.looseEnds.length-1;s>=0;s-=1){const l=this.looseEnds[s];let a=!1;if(o){if(l instanceof Ye.Choice&&r!==null)r.ReceiveLooseEnd(l),a=!0;else if(!(l instanceof Ye.Choice)){const u=r||i;u!==null&&(u.ReceiveLooseEnd(l),a=!0)}}else(r==null?void 0:r.hasOwnProperty("ReceiveLooseEnd"))&&r.ReceiveLooseEnd(l),a=!0;a&&this.looseEnds.splice(s,1)}},this.ReceiveLooseEnd=r=>{this.looseEnds.push(r)},this.WeavePointNamed=r=>{if(!this.namedWeavePoints)return null;let i=this.namedWeavePoints.get(r);return i||null},this.IsGlobalDeclaration=r=>{const i=Ze.asOrNull(r,jw.VariableAssignment);return!!(i&&i.isGlobalDeclaration&&i.isDeclaration||Ze.asOrNull(r,Iw.ConstantDeclaration))},this.ContentThatFollowsWeavePoint=r=>{const i=[],o=r;if(o.content!==null)for(const a of o.content)this.IsGlobalDeclaration(a)||i.push(a);const s=Ze.asOrNull(o.parent,Xt);if(s===null)throw new Error("Expected weave point parent to be weave?");const l=s.content.indexOf(o);for(let a=l+1;a<s.content.length;a+=1){const u=s.content[a];if(!this.IsGlobalDeclaration(u)){if(u instanceof Ye.Choice||u instanceof St.Gather||u instanceof Xt)break;i.push(u)}}return i},this.ValidateTermination=r=>{if(this.lastParsedSignificantObject instanceof Mf.AuthorWarning)return;if(this.looseEnds!==null&&this.looseEnds.length>0)for(const o of this.looseEnds){const s=this.ContentThatFollowsWeavePoint(o);this.ValidateFlowOfObjectsTerminates(s,o,r)}else{for(const o of this.content)if(o instanceof Ye.Choice||o instanceof Ys.Divert)return;this.ValidateFlowOfObjectsTerminates(this.content,this,r)}},this.BadNestedTerminationHandler=r=>{let i=null;for(let s=r.parent;s!==null;s=s.parent)if(s instanceof Ia.Sequence||s instanceof Xs.Conditional){i=Ze.asOrNull(s,Xs.Conditional);break}let o="Choices nested in conditionals or sequences need to explicitly divert afterwards.";i!==null&&i.FindAll(Ye.Choice)().length===1&&(o=`Choices with conditions should be written: '* {condition} choice'. Otherwise, ${o.toLowerCase()}`),this.Error(o,r)},this.ValidateFlowOfObjectsTerminates=(r,i,o)=>{let s=!1,l=i;for(const a of r){if(a.Find(Ys.Divert)(h=>!h.isThread&&!h.isTunnel&&!h.isFunctionCall&&!(h.parent instanceof Fw.DivertTarget))!==null&&(s=!0),a.Find(Ww.TunnelOnwards)()!=null){s=!0;break}l=a}if(!s){if(l instanceof Mf.AuthorWarning)return;o(l)}},this.WeavePointHasLooseEnd=r=>{if(r.content===null)return!0;for(let i=r.content.length-1;i>=0;--i){let o=Ze.asOrNull(r.content[i],Ys.Divert);if(o&&!(o.isThread||o.isTunnel||o.isFunctionCall))return!1}return!0},this.CheckForWeavePointNamingCollisions=()=>{if(!this.namedWeavePoints)return;const r=[];for(const i of this.ancestry){const o=Ze.asOrNull(i,Rw.FlowBase);if(o)r.push(o);else break}for(const[i,o]of this.namedWeavePoints)for(const s of r){const l=s.ContentWithNameAtLevel(i);if(l&&l!==o){const a=`${o.GetType()} '${i}' has the same label name as a ${l.GetType()} (on ${l.debugMetadata})`;this.Error(a,o)}}},n==-1?this.baseIndentIndex=this.DetermineBaseIndentationFromContent(e):this.baseIndentIndex=n,this.AddContent(e),this.ConstructWeaveHierarchyFromIndentation()}get rootContainer(){return this._rootContainer||(this._rootContainer=this.GenerateRuntimeObject()),this._rootContainer}get namedWeavePoints(){return this._namedWeavePoints}get lastParsedSignificantObject(){if(this.content.length===0)return null;let e=null;for(let r=this.content.length-1;r>=0;--r){e=this.content[r];let i=Ze.asOrNull(e,Vw.Text);if(!(i&&i.text===`
`)&&!this.IsGlobalDeclaration(e))break}const n=Ze.asOrNull(e,Xt);return n&&(e=n.lastParsedSignificantObject),e}get typeName(){return"Weave"}ResolveReferences(e){if(super.ResolveReferences(e),this.looseEnds!==null&&this.looseEnds.length>0){let n=!1;for(let r=this.parent;r!==null;r=r.parent)if(r instanceof Ia.Sequence||r instanceof Xs.Conditional){n=!0;break}n&&this.ValidateTermination(this.BadNestedTerminationHandler)}for(const n of this.gatherPointsToResolve)n.divert.targetPath=n.targetRuntimeObj.path;this.CheckForWeavePointNamingCollisions()}}Gt.Weave=Xt;Object.defineProperty(fs,"__esModule",{value:!0});fs.ConditionalSingleBranch=void 0;const $f=he,Zs=Ve,Bf=mt,Mw=Z,$w=at,Bw=re,Gw=Bt,Uw=Gt,zw=B;class qw extends Mw.ParsedObject{constructor(e){super();this._contentContainer=null,this._conditionalDivert=null,this._ownExpression=null,this._innerWeave=null,this.isTrueBranch=!1,this.matchingEquality=!1,this.isElse=!1,this.isInline=!1,this.returnDivert=null,this.GenerateRuntimeObject=()=>{if(this._innerWeave)for(const i of this._innerWeave.content){const o=zw.asOrNull(i,Gw.Text);o&&o.text.startsWith("else:")&&this.Warning("Saw the text 'else:' which is being treated as content. Did you mean '- else:'?",o)}const n=new $f.Container,r=this.matchingEquality&&!this.isElse;if(r&&n.AddContent(Zs.ControlCommand.Duplicate()),this._conditionalDivert=new Bf.Divert,this._conditionalDivert.isConditional=!this.isElse,!this.isTrueBranch&&!this.isElse){const i=this.ownExpression!==null;i&&n.AddContent(Zs.ControlCommand.EvalStart()),this.ownExpression&&this.ownExpression.GenerateIntoContainer(n),this.matchingEquality&&n.AddContent($w.NativeFunctionCall.CallWithName("==")),i&&n.AddContent(Zs.ControlCommand.EvalEnd())}return n.AddContent(this._conditionalDivert),this._contentContainer=this.GenerateRuntimeForContent(),this._contentContainer.name="b",this.isInline||this._contentContainer.InsertContent(new Bw.StringValue(`
`),0),(r||this.isElse&&this.matchingEquality)&&this._contentContainer.InsertContent(Zs.ControlCommand.PopEvaluatedValue(),0),n.AddToNamedContentOnly(this._contentContainer),this.returnDivert=new Bf.Divert,this._contentContainer.AddContent(this.returnDivert),n},this.GenerateRuntimeForContent=()=>this._innerWeave===null?new $f.Container:this._innerWeave.rootContainer,e&&(this._innerWeave=new Uw.Weave(e),this.AddContent(this._innerWeave))}get ownExpression(){return this._ownExpression}set ownExpression(e){this._ownExpression=e,this._ownExpression&&this.AddContent(this._ownExpression)}get typeName(){return"ConditionalSingleBranch"}ResolveReferences(e){if(!this._conditionalDivert||!this._contentContainer)throw new Error;this._conditionalDivert.targetPath=this._contentContainer.path,super.ResolveReferences(e)}}fs.ConditionalSingleBranch=qw;var wm={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFlags=void 0,function(e){e[e.ParsingString=1]="ParsingString"}(t.CustomFlags||(t.CustomFlags={}))})(wm);var Sl={};Object.defineProperty(Sl,"__esModule",{value:!0});Sl.DebugMetadata=void 0;class Ah{constructor(){this.startLineNumber=0,this.endLineNumber=0,this.startCharacterNumber=0,this.endCharacterNumber=0,this.fileName=null,this.sourceName=null}Merge(e){let n=new Ah;return n.fileName=this.fileName,n.sourceName=this.sourceName,this.startLineNumber<e.startLineNumber?(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=this.startCharacterNumber):this.startLineNumber>e.startLineNumber?(n.startLineNumber=e.startLineNumber,n.startCharacterNumber=e.startCharacterNumber):(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=Math.min(this.startCharacterNumber,e.startCharacterNumber)),this.endLineNumber>e.endLineNumber?(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=this.endCharacterNumber):this.endLineNumber<e.endLineNumber?(n.endLineNumber=e.endLineNumber,n.endCharacterNumber=e.endCharacterNumber):(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=Math.max(this.endCharacterNumber,e.endCharacterNumber)),n}toString(){return this.fileName!==null?`line ${this.startLineNumber} of ${this.fileName}"`:"line "+this.startLineNumber}}Sl.DebugMetadata=Ah;var wl={};Object.defineProperty(wl,"__esModule",{value:!0});wl.ExternalDeclaration=void 0;const Hw=Z;class Kw extends Hw.ParsedObject{constructor(e,n){super();this.identifier=e,this.argumentNames=n,this.GenerateRuntimeObject=()=>(this.story.AddExternal(this),null)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get typeName(){return"EXTERNAL"}toString(){var e;return`EXTERNAL ${(e=this.identifier)===null||e===void 0?void 0:e.name}`}}wl.ExternalDeclaration=Kw;var _l={};Object.defineProperty(_l,"__esModule",{value:!0});_l.FlowDecl=void 0;class Jw{constructor(e,n,r){this.name=e,this.args=n,this.isFunction=r}}_l.FlowDecl=Jw;var El={},Cs={};Object.defineProperty(Cs,"__esModule",{value:!0});Cs.Wrap=void 0;const Qw=Z;class Xw extends Qw.ParsedObject{constructor(e){super();this._objToWrap=e,this.GenerateRuntimeObject=()=>this._objToWrap}}Cs.Wrap=Xw;Object.defineProperty(El,"__esModule",{value:!0});El.Glue=void 0;const Yw=Cs;class Zw extends Yw.Wrap{constructor(e){super(e)}get typeName(){return"Glue"}}El.Glue=Zw;var Ur={};Object.defineProperty(Ur,"__esModule",{value:!0});Ur.Glue=void 0;const e_=Ae;class t_ extends e_.InkObject{toString(){return"Glue"}}Ur.Glue=t_;var Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});Pl.IncDecExpression=void 0;const n_=Br,Gf=Ge,r_=ut,i_=at,s_=re,o_=Tt,l_=qn,a_=Gt;class u_ extends Gf.Expression{constructor(e,n,r){super();this.varIdentifier=e,this._runtimeAssignment=null,this.expression=null,this.GenerateIntoContainer=i=>{var o,s;i.AddContent(new l_.VariableReference(((o=this.varIdentifier)===null||o===void 0?void 0:o.name)||null)),this.expression?this.expression.GenerateIntoContainer(i):i.AddContent(new s_.IntValue(1)),i.AddContent(i_.NativeFunctionCall.CallWithName(this.isInc?"+":"-")),this._runtimeAssignment=new o_.VariableAssignment(((s=this.varIdentifier)===null||s===void 0?void 0:s.name)||null,!1),i.AddContent(this._runtimeAssignment)},this.toString=()=>{var i,o;return this.expression?`${(i=this.varIdentifier)===null||i===void 0?void 0:i.name}${this.isInc?" += ":" -= "}${this.expression}`:`${(o=this.varIdentifier)===null||o===void 0?void 0:o.name}`+(this.isInc?"++":"--")},n instanceof Gf.Expression?(this.expression=n,this.AddContent(this.expression),this.isInc=Boolean(r)):this.isInc=n}get typeName(){return"IncDecExpression"}ResolveReferences(e){var n;super.ResolveReferences(e);const r=e.ResolveVariableWithName(((n=this.varIdentifier)===null||n===void 0?void 0:n.name)||"",this);if(r.found||this.Error(`variable for ${this.incrementDecrementWord} could not be found: '${this.varIdentifier}' after searching: {this.descriptionOfScope}`),!this._runtimeAssignment)throw new Error;this._runtimeAssignment.isGlobal=r.isGlobal,!(this.parent instanceof a_.Weave)&&!(this.parent instanceof r_.FlowBase)&&!(this.parent instanceof n_.ContentList)&&this.Error(`Can't use ${this.incrementDecrementWord} as sub-expression`)}get incrementDecrementWord(){return this.isInc?"increment":"decrement"}}Pl.IncDecExpression=u_;var Ss={};Object.defineProperty(Ss,"__esModule",{value:!0});Ss.IncludedFile=void 0;const h_=Z;class c_ extends h_.ParsedObject{constructor(e){super();this.includedStory=e,this.GenerateRuntimeObject=()=>null}}Ss.IncludedFile=c_;var Ol={};Object.defineProperty(Ol,"__esModule",{value:!0});Ol.InfixOperator=void 0;class f_{constructor(e,n,r){this.type=e,this.precedence=n,this.requireWhitespace=r,this.toString=()=>this.type}}Ol.InfixOperator=f_;var xl={};Object.defineProperty(xl,"__esModule",{value:!0});xl.Knot=void 0;const d_=ut,Uf=jr;class p_ extends d_.FlowBase{get flowLevel(){return Uf.FlowLevel.Knot}constructor(e,n,r,i){super(e,n,r,i)}get typeName(){return this.isFunction?"Function":"Knot"}ResolveReferences(e){super.ResolveReferences(e);let n=this.story;for(const r in this.subFlowsByName){const i=n.ContentWithNameAtLevel(r,Uf.FlowLevel.Knot,!1);if(i){const o=this.subFlowsByName.get(r),s=`Stitch '${o?o.name:"NO STITCH FOUND"}' has the same name as a knot (on ${i.debugMetadata})`;this.Error(s,o)}}}}xl.Knot=p_;var Tl={};Object.defineProperty(Tl,"__esModule",{value:!0});Tl.List=void 0;const m_=Ge,g_=Ce,v_=Ce,y_=re;class C_ extends m_.Expression{constructor(e){super();this.itemIdentifierList=e,this.GenerateIntoContainer=n=>{var r,i;const o=new g_.InkList;if(this.itemIdentifierList!=null)for(const s of this.itemIdentifierList){const l=((r=s==null?void 0:s.name)===null||r===void 0?void 0:r.split("."))||[];let a=null,u="";l.length>1?(a=l[0],u=l[1]):u=l[0];const h=this.story.ResolveListItem(a,u,this);if(h===null)a===null?this.Error(`Could not find list definition that contains item '${s}'`):this.Error(`Could not find list item ${s}`);else{if(h.parent==null){this.Error(`Could not find list definition for item ${s}`);return}a||(a=((i=h.parent.identifier)===null||i===void 0?void 0:i.name)||null);const p=new v_.InkListItem(a,h.name||null);o.has(p.serialized())?this.Warning(`Duplicate of item '${s}' in list.`):o.Add(p,h.seriesValue)}}n.AddContent(new y_.ListValue(o))}}get typeName(){return"List"}}Tl.List=C_;var ws={};Object.defineProperty(ws,"__esModule",{value:!0});ws.ListElementDefinition=void 0;const S_=Z,w_=$t;class __ extends S_.ParsedObject{constructor(e,n,r=null){super();this.indentifier=e,this.inInitialList=n,this.explicitValue=r,this.seriesValue=0,this.parent=null,this.GenerateRuntimeObject=()=>{throw new Error("Not implemented.")},this.toString=()=>this.fullName,this.parent=super.parent}get fullName(){var e;const n=this.parent;if(n===null)throw new Error("Can't get full name without a parent list.");return`${(e=n.identifier)===null||e===void 0?void 0:e.name}.${this.name}`}get typeName(){return"ListElement"}get name(){var e;return((e=this.indentifier)===null||e===void 0?void 0:e.name)||null}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.indentifier,w_.SymbolType.ListItem)}}ws.ListElementDefinition=__;var _m={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StatementLevel=void 0,function(e){e[e.InnerBlock=0]="InnerBlock",e[e.Stitch=1]="Stitch",e[e.Knot=2]="Knot",e[e.Top=3]="Top"}(t.StatementLevel||(t.StatementLevel={}))})(_m);var Nl={};Object.defineProperty(Nl,"__esModule",{value:!0});Nl.Stitch=void 0;const E_=ut,P_=jr;class O_ extends E_.FlowBase{constructor(e,n,r,i){super(e,n,r,i);this.toString=()=>`${this.parent!==null?this.parent+" > ":""}${super.toString()}`}get flowLevel(){return P_.FlowLevel.Stitch}get typeName(){return"Stitch"}}Nl.Stitch=O_;var bl={},_s={},wn={},Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.Tag=void 0;const x_=Ae;class T_ extends x_.InkObject{constructor(e){super();this.text=e.toString()||""}toString(){return"# "+this.text}}Hn.Tag=T_;var Es={};Object.defineProperty(Es,"__esModule",{value:!0});Es.Choice=void 0;const N_=Ue,b_=ue,I_=Ae;class k_ extends I_.InkObject{constructor(){super(...arguments);this.text="",this.index=0,this.threadAtGeneration=null,this.sourcePath="",this.targetPath=null,this.isInvisibleDefault=!1,this.originalThreadIndex=0}get pathStringOnChoice(){return this.targetPath===null?b_.throwNullException("Choice.targetPath"):this.targetPath.toString()}set pathStringOnChoice(e){this.targetPath=new N_.Path(e)}}Es.Choice=k_;var Ps={};Object.defineProperty(Ps,"__esModule",{value:!0});Ps.ListDefinitionsOrigin=void 0;const A_=Ce,F_=re,R_=ue;class L_{constructor(e){this._lists=new Map,this._allUnambiguousListValueCache=new Map;for(let n of e){this._lists.set(n.name,n);for(let[r,i]of n.items){let o=A_.InkListItem.fromSerializedKey(r),s=new F_.ListValue(o,i);if(!o.itemName)throw new Error("item.itemName is null or undefined.");this._allUnambiguousListValueCache.set(o.itemName,s),this._allUnambiguousListValueCache.set(o.fullName,s)}}}get lists(){let e=[];for(let[,n]of this._lists)e.push(n);return e}TryListGetDefinition(e,n){if(e===null)return{result:n,exists:!1};let r=this._lists.get(e);return r?{result:r,exists:!0}:{result:n,exists:!1}}FindSingleItemListWithName(e){if(e===null)return R_.throwNullException("name");let n=this._allUnambiguousListValueCache.get(e);return typeof n!="undefined"?n:null}}Ps.ListDefinitionsOrigin=L_;Object.defineProperty(wn,"__esModule",{value:!0});wn.JsonSerialisation=void 0;const eo=he,qe=re,zf=Ur,H=Ve,er=$n,qf=mt,Hf=Dr,ka=qn,Kf=Tt,Aa=at,Jf=Mt,Qf=Hn,D_=Ue,Xf=Es,V_=ys,W_=Ps,to=Ce,ae=B,_n=ue;class _r{static JArrayToRuntimeObjList(e,n=!1){let r=e.length;n&&r--;let i=[];for(let o=0;o<r;o++){let s=e[o],l=this.JTokenToRuntimeObject(s);if(l===null)return _n.throwNullException("runtimeObj");i.push(l)}return i}static WriteDictionaryRuntimeObjs(e,n){e.WriteObjectStart();for(let[r,i]of n)e.WritePropertyStart(r),this.WriteRuntimeObject(e,i),e.WritePropertyEnd();e.WriteObjectEnd()}static WriteListRuntimeObjs(e,n){e.WriteArrayStart();for(let r of n)this.WriteRuntimeObject(e,r);e.WriteArrayEnd()}static WriteIntDictionary(e,n){e.WriteObjectStart();for(let[r,i]of n)e.WriteIntProperty(r,i);e.WriteObjectEnd()}static WriteRuntimeObject(e,n){let r=ae.asOrNull(n,eo.Container);if(r){this.WriteRuntimeContainer(e,r);return}let i=ae.asOrNull(n,qf.Divert);if(i){let b="->";i.isExternal?b="x()":i.pushesToStack&&(i.stackPushType==er.PushPopType.Function?b="f()":i.stackPushType==er.PushPopType.Tunnel&&(b="->t->"));let N;i.hasVariableTarget?N=i.variableDivertName:N=i.targetPathString,e.WriteObjectStart(),e.WriteProperty(b,N),i.hasVariableTarget&&e.WriteProperty("var",!0),i.isConditional&&e.WriteProperty("c",!0),i.externalArgs>0&&e.WriteIntProperty("exArgs",i.externalArgs),e.WriteObjectEnd();return}let o=ae.asOrNull(n,Hf.ChoicePoint);if(o){e.WriteObjectStart(),e.WriteProperty("*",o.pathStringOnChoice),e.WriteIntProperty("flg",o.flags),e.WriteObjectEnd();return}let s=ae.asOrNull(n,qe.BoolValue);if(s){e.WriteBool(s.value);return}let l=ae.asOrNull(n,qe.IntValue);if(l){e.WriteInt(l.value);return}let a=ae.asOrNull(n,qe.FloatValue);if(a){e.WriteFloat(a.value);return}let u=ae.asOrNull(n,qe.StringValue);if(u){u.isNewline?e.Write(`
`,!1):(e.WriteStringStart(),e.WriteStringInner("^"),e.WriteStringInner(u.value),e.WriteStringEnd());return}let h=ae.asOrNull(n,qe.ListValue);if(h){this.WriteInkList(e,h);return}let p=ae.asOrNull(n,qe.DivertTargetValue);if(p){if(e.WriteObjectStart(),p.value===null)return _n.throwNullException("divTargetVal.value");e.WriteProperty("^->",p.value.componentsString),e.WriteObjectEnd();return}let c=ae.asOrNull(n,qe.VariablePointerValue);if(c){e.WriteObjectStart(),e.WriteProperty("^var",c.value),e.WriteIntProperty("ci",c.contextIndex),e.WriteObjectEnd();return}if(ae.asOrNull(n,zf.Glue)){e.Write("<>");return}let S=ae.asOrNull(n,H.ControlCommand);if(S){e.Write(_r._controlCommandNames[S.commandType]);return}let E=ae.asOrNull(n,Aa.NativeFunctionCall);if(E){let b=E.name;b=="^"&&(b="L^"),e.Write(b);return}let d=ae.asOrNull(n,ka.VariableReference);if(d){e.WriteObjectStart();let b=d.pathStringForCount;b!=null?e.WriteProperty("CNT?",b):e.WriteProperty("VAR?",d.name),e.WriteObjectEnd();return}let f=ae.asOrNull(n,Kf.VariableAssignment);if(f){e.WriteObjectStart();let b=f.isGlobal?"VAR=":"temp=";e.WriteProperty(b,f.variableName),f.isNewDeclaration||e.WriteProperty("re",!0),e.WriteObjectEnd();return}if(ae.asOrNull(n,Jf.Void)){e.Write("void");return}let y=ae.asOrNull(n,Qf.Tag);if(y){e.WriteObjectStart(),e.WriteProperty("#",y.text),e.WriteObjectEnd();return}let w=ae.asOrNull(n,Xf.Choice);if(w){this.WriteChoice(e,w);return}throw new Error("Failed to convert runtime object to Json token: "+n)}static JObjectToDictionaryRuntimeObjs(e){let n=new Map;for(let r in e)if(e.hasOwnProperty(r)){let i=this.JTokenToRuntimeObject(e[r]);if(i===null)return _n.throwNullException("inkObject");n.set(r,i)}return n}static JObjectToIntDictionary(e){let n=new Map;for(let r in e)e.hasOwnProperty(r)&&n.set(r,parseInt(e[r]));return n}static JTokenToRuntimeObject(e){if(typeof e=="number"&&!isNaN(e)||typeof e=="boolean")return qe.Value.Create(e);if(typeof e=="string"){let n=e.toString(),r=n[0];if(r=="^")return new qe.StringValue(n.substring(1));if(r==`
`&&n.length==1)return new qe.StringValue(`
`);if(n=="<>")return new zf.Glue;for(let i=0;i<_r._controlCommandNames.length;++i){let o=_r._controlCommandNames[i];if(n==o)return new H.ControlCommand(i)}if(n=="L^"&&(n="^"),Aa.NativeFunctionCall.CallExistsWithName(n))return Aa.NativeFunctionCall.CallWithName(n);if(n=="->->")return H.ControlCommand.PopTunnel();if(n=="~ret")return H.ControlCommand.PopFunction();if(n=="void")return new Jf.Void}if(typeof e=="object"&&!Array.isArray(e)){let n=e,r;if(n["^->"])return r=n["^->"],new qe.DivertTargetValue(new D_.Path(r.toString()));if(n["^var"]){r=n["^var"];let h=new qe.VariablePointerValue(r.toString());return"ci"in n&&(r=n.ci,h.contextIndex=parseInt(r)),h}let i=!1,o=!1,s=er.PushPopType.Function,l=!1;if((r=n["->"])?i=!0:(r=n["f()"])?(i=!0,o=!0,s=er.PushPopType.Function):(r=n["->t->"])?(i=!0,o=!0,s=er.PushPopType.Tunnel):(r=n["x()"])&&(i=!0,l=!0,o=!1,s=er.PushPopType.Function),i){let h=new qf.Divert;h.pushesToStack=o,h.stackPushType=s,h.isExternal=l;let p=r.toString();return(r=n.var)?h.variableDivertName=p:h.targetPathString=p,h.isConditional=!!n.c,l&&(r=n.exArgs)&&(h.externalArgs=parseInt(r)),h}if(r=n["*"]){let h=new Hf.ChoicePoint;return h.pathStringOnChoice=r.toString(),(r=n.flg)&&(h.flags=parseInt(r)),h}if(r=n["VAR?"])return new ka.VariableReference(r.toString());if(r=n["CNT?"]){let h=new ka.VariableReference;return h.pathStringForCount=r.toString(),h}let a=!1,u=!1;if((r=n["VAR="])?(a=!0,u=!0):(r=n["temp="])&&(a=!0,u=!1),a){let h=r.toString(),p=!n.re,c=new Kf.VariableAssignment(h,p);return c.isGlobal=u,c}if(n["#"]!==void 0)return r=n["#"],new Qf.Tag(r.toString());if(r=n.list){let h=r,p=new to.InkList;if(r=n.origins){let c=r;p.SetInitialOriginNames(c)}for(let c in h)if(h.hasOwnProperty(c)){let m=h[c],S=new to.InkListItem(c),E=parseInt(m);p.Add(S,E)}return new qe.ListValue(p)}if(n.originalChoicePath!=null)return this.JObjectToChoice(n)}if(Array.isArray(e))return this.JArrayToContainer(e);if(e==null)return null;throw new Error("Failed to convert token to runtime object: "+this.toJson(e,["parent"]))}static toJson(e,n,r){return JSON.stringify(e,(i,o)=>(n==null?void 0:n.some(s=>s===i))?void 0:o,r)}static WriteRuntimeContainer(e,n,r=!1){if(e.WriteArrayStart(),n===null)return _n.throwNullException("container");for(let a of n.content)this.WriteRuntimeObject(e,a);let i=n.namedOnlyContent,o=n.countFlags,s=n.name!=null&&!r,l=i!=null||o>0||s;if(l&&e.WriteObjectStart(),i!=null)for(let[a,u]of i){let h=a,p=ae.asOrNull(u,eo.Container);e.WritePropertyStart(h),this.WriteRuntimeContainer(e,p,!0),e.WritePropertyEnd()}o>0&&e.WriteIntProperty("#f",o),s&&e.WriteProperty("#n",n.name),l?e.WriteObjectEnd():e.WriteNull(),e.WriteArrayEnd()}static JArrayToContainer(e){let n=new eo.Container;n.content=this.JArrayToRuntimeObjList(e,!0);let r=e[e.length-1];if(r!=null){let i=new Map;for(let o in r)if(o=="#f")n.countFlags=parseInt(r[o]);else if(o=="#n")n.name=r[o].toString();else{let s=this.JTokenToRuntimeObject(r[o]),l=ae.asOrNull(s,eo.Container);l&&(l.name=o),i.set(o,s)}n.namedOnlyContent=i}return n}static JObjectToChoice(e){let n=new Xf.Choice;return n.text=e.text.toString(),n.index=parseInt(e.index),n.sourcePath=e.originalChoicePath.toString(),n.originalThreadIndex=parseInt(e.originalThreadIndex),n.pathStringOnChoice=e.targetPath.toString(),n}static WriteChoice(e,n){e.WriteObjectStart(),e.WriteProperty("text",n.text),e.WriteIntProperty("index",n.index),e.WriteProperty("originalChoicePath",n.sourcePath),e.WriteIntProperty("originalThreadIndex",n.originalThreadIndex),e.WriteProperty("targetPath",n.pathStringOnChoice),e.WriteObjectEnd()}static WriteInkList(e,n){let r=n.value;if(r===null)return _n.throwNullException("rawList");e.WriteObjectStart(),e.WritePropertyStart("list"),e.WriteObjectStart();for(let[i,o]of r){let s=to.InkListItem.fromSerializedKey(i),l=o;if(s.itemName===null)return _n.throwNullException("item.itemName");e.WritePropertyNameStart(),e.WritePropertyNameInner(s.originName?s.originName:"?"),e.WritePropertyNameInner("."),e.WritePropertyNameInner(s.itemName),e.WritePropertyNameEnd(),e.Write(l),e.WritePropertyEnd()}if(e.WriteObjectEnd(),e.WritePropertyEnd(),r.Count==0&&r.originNames!=null&&r.originNames.length>0){e.WritePropertyStart("origins"),e.WriteArrayStart();for(let i of r.originNames)e.Write(i);e.WriteArrayEnd(),e.WritePropertyEnd()}e.WriteObjectEnd()}static ListDefinitionsToJToken(e){let n={};for(let r of e.lists){let i={};for(let[o,s]of r.items){let l=to.InkListItem.fromSerializedKey(o);if(l.itemName===null)return _n.throwNullException("item.itemName");i[l.itemName]=s}n[r.name]=i}return n}static JTokenToListDefinitions(e){let n=e,r=[];for(let i in n)if(n.hasOwnProperty(i)){let o=i.toString(),s=n[i],l=new Map;for(let u in s)if(n.hasOwnProperty(i)){let h=s[u];l.set(u,parseInt(h))}let a=new V_.ListDefinition(o,l);r.push(a)}return new W_.ListDefinitionsOrigin(r)}}wn.JsonSerialisation=_r;_r._controlCommandNames=(()=>{let t=[];t[H.ControlCommand.CommandType.EvalStart]="ev",t[H.ControlCommand.CommandType.EvalOutput]="out",t[H.ControlCommand.CommandType.EvalEnd]="/ev",t[H.ControlCommand.CommandType.Duplicate]="du",t[H.ControlCommand.CommandType.PopEvaluatedValue]="pop",t[H.ControlCommand.CommandType.PopFunction]="~ret",t[H.ControlCommand.CommandType.PopTunnel]="->->",t[H.ControlCommand.CommandType.BeginString]="str",t[H.ControlCommand.CommandType.EndString]="/str",t[H.ControlCommand.CommandType.NoOp]="nop",t[H.ControlCommand.CommandType.ChoiceCount]="choiceCnt",t[H.ControlCommand.CommandType.Turns]="turn",t[H.ControlCommand.CommandType.TurnsSince]="turns",t[H.ControlCommand.CommandType.ReadCount]="readc",t[H.ControlCommand.CommandType.Random]="rnd",t[H.ControlCommand.CommandType.SeedRandom]="srnd",t[H.ControlCommand.CommandType.VisitIndex]="visit",t[H.ControlCommand.CommandType.SequenceShuffleIndex]="seq",t[H.ControlCommand.CommandType.StartThread]="thread",t[H.ControlCommand.CommandType.Done]="done",t[H.ControlCommand.CommandType.End]="end",t[H.ControlCommand.CommandType.ListFromInt]="listInt",t[H.ControlCommand.CommandType.ListRange]="range",t[H.ControlCommand.CommandType.ListRandom]="lrnd";for(let e=0;e<H.ControlCommand.CommandType.TOTAL_VALUES;++e)if(t[e]==null)throw new Error("Control command not accounted for in serialisation");return t})();var Il={},Fh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CallStack=void 0;const e=$n,n=Ue,r=_s,i=wn,o=re,s=jt,l=Bn,a=hs,u=it,h=ue;class p{constructor(){if(this._threadCounter=0,this._startOfRoot=l.Pointer.Null,arguments[0]instanceof r.Story){let m=arguments[0];this._startOfRoot=l.Pointer.StartOf(m.rootContentContainer),this.Reset()}else{let m=arguments[0];this._threads=[];for(let S of m._threads)this._threads.push(S.Copy());this._threadCounter=m._threadCounter,this._startOfRoot=m._startOfRoot.copy()}}get elements(){return this.callStack}get depth(){return this.elements.length}get currentElement(){let S=this._threads[this._threads.length-1].callstack;return S[S.length-1]}get currentElementIndex(){return this.callStack.length-1}get currentThread(){return this._threads[this._threads.length-1]}set currentThread(m){a.Debug.Assert(this._threads.length==1,"Shouldn't be directly setting the current thread when we have a stack of them"),this._threads.length=0,this._threads.push(m)}get canPop(){return this.callStack.length>1}Reset(){this._threads=[],this._threads.push(new p.Thread),this._threads[0].callstack.push(new p.Element(e.PushPopType.Tunnel,this._startOfRoot))}SetJsonToken(m,S){this._threads.length=0;let E=m.threads;for(let d of E){let f=d,g=new p.Thread(f,S);this._threads.push(g)}this._threadCounter=parseInt(m.threadCounter),this._startOfRoot=l.Pointer.StartOf(S.rootContentContainer)}WriteJson(m){m.WriteObject(S=>{S.WritePropertyStart("threads"),S.WriteArrayStart();for(let E of this._threads)E.WriteJson(S);S.WriteArrayEnd(),S.WritePropertyEnd(),S.WritePropertyStart("threadCounter"),S.WriteInt(this._threadCounter),S.WritePropertyEnd()})}PushThread(){let m=this.currentThread.Copy();this._threadCounter++,m.threadIndex=this._threadCounter,this._threads.push(m)}ForkThread(){let m=this.currentThread.Copy();return this._threadCounter++,m.threadIndex=this._threadCounter,m}PopThread(){if(this.canPopThread)this._threads.splice(this._threads.indexOf(this.currentThread),1);else throw new Error("Can't pop thread")}get canPopThread(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}get elementIsEvaluateFromGame(){return this.currentElement.type==e.PushPopType.FunctionEvaluationFromGame}Push(m,S=0,E=0){let d=new p.Element(m,this.currentElement.currentPointer,!1);d.evaluationStackHeightWhenPushed=S,d.functionStartInOutputStream=E,this.callStack.push(d)}CanPop(m=null){return this.canPop?m==null?!0:this.currentElement.type==m:!1}Pop(m=null){if(this.CanPop(m)){this.callStack.pop();return}else throw new Error("Mismatched push/pop in Callstack")}GetTemporaryVariableWithName(m,S=-1){S==-1&&(S=this.currentElementIndex+1);let E=this.callStack[S-1],d=u.tryGetValueFromMap(E.temporaryVariables,m,null);return d.exists?d.result:null}SetTemporaryVariable(m,S,E,d=-1){d==-1&&(d=this.currentElementIndex+1);let f=this.callStack[d-1];if(!E&&!f.temporaryVariables.get(m))throw new Error("Could not find temporary variable to set: "+m);let g=u.tryGetValueFromMap(f.temporaryVariables,m,null);g.exists&&o.ListValue.RetainListOriginsForAssignment(g.result,S),f.temporaryVariables.set(m,S)}ContextForVariableNamed(m){return this.currentElement.temporaryVariables.get(m)?this.currentElementIndex+1:0}ThreadWithIndex(m){let S=this._threads.filter(E=>{if(E.threadIndex==m)return E});return S.length>0?S[0]:null}get callStack(){return this.currentThread.callstack}get callStackTrace(){let m=new s.StringBuilder;for(let S=0;S<this._threads.length;S++){let E=this._threads[S],d=S==this._threads.length-1;m.AppendFormat(`=== THREAD {0}/{1} {2}===
`,S+1,this._threads.length,d?"(current) ":"");for(let f=0;f<E.callstack.length;f++){E.callstack[f].type==e.PushPopType.Function?m.Append("  [FUNCTION] "):m.Append("  [TUNNEL] ");let g=E.callstack[f].currentPointer;if(!g.isNull){if(m.Append("<SOMEWHERE IN "),g.container===null)return h.throwNullException("pointer.container");m.Append(g.container.path.toString()),m.AppendLine(">")}}}return m.toString()}}t.CallStack=p,function(c){class m{constructor(d,f,g=!1){this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=f.copy(),this.inExpressionEvaluation=g,this.temporaryVariables=new Map,this.type=d}Copy(){let d=new m(this.type,this.currentPointer,this.inExpressionEvaluation);return d.temporaryVariables=new Map(this.temporaryVariables),d.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,d.functionStartInOutputStream=this.functionStartInOutputStream,d}}c.Element=m;class S{constructor(){if(this.threadIndex=0,this.previousPointer=l.Pointer.Null,this.callstack=[],arguments[0]&&arguments[1]){let d=arguments[0],f=arguments[1];this.threadIndex=parseInt(d.threadIndex);let g=d.callstack;for(let w of g){let b=w,N=parseInt(b.type),L=l.Pointer.Null,k,T=b.cPath;if(typeof T!="undefined"){k=T.toString();let G=f.ContentAtPath(new n.Path(k));if(L.container=G.container,L.index=parseInt(b.idx),G.obj==null)throw new Error("When loading state, internal story location couldn't be found: "+k+". Has the story changed since this save data was created?");if(G.approximate){if(L.container===null)return h.throwNullException("pointer.container");f.Warning("When loading state, exact internal story location couldn't be found: '"+k+"', so it was approximated to '"+L.container.path.toString()+"' to recover. Has the story changed since this save data was created?")}}let j=!!b.exp,ze=new m(N,L,j),ce=b.temp;typeof ce!="undefined"?ze.temporaryVariables=i.JsonSerialisation.JObjectToDictionaryRuntimeObjs(ce):ze.temporaryVariables.clear(),this.callstack.push(ze)}let y=d.previousContentObject;if(typeof y!="undefined"){let w=new n.Path(y.toString());this.previousPointer=f.PointerAtPath(w)}}}Copy(){let d=new S;d.threadIndex=this.threadIndex;for(let f of this.callstack)d.callstack.push(f.Copy());return d.previousPointer=this.previousPointer.copy(),d}WriteJson(d){d.WriteObjectStart(),d.WritePropertyStart("callstack"),d.WriteArrayStart();for(let f of this.callstack){if(d.WriteObjectStart(),!f.currentPointer.isNull){if(f.currentPointer.container===null)return h.throwNullException("el.currentPointer.container");d.WriteProperty("cPath",f.currentPointer.container.path.componentsString),d.WriteIntProperty("idx",f.currentPointer.index)}d.WriteProperty("exp",f.inExpressionEvaluation),d.WriteIntProperty("type",f.type),f.temporaryVariables.size>0&&(d.WritePropertyStart("temp"),i.JsonSerialisation.WriteDictionaryRuntimeObjs(d,f.temporaryVariables),d.WritePropertyEnd()),d.WriteObjectEnd()}if(d.WriteArrayEnd(),d.WritePropertyEnd(),d.WriteIntProperty("threadIndex",this.threadIndex),!this.previousPointer.isNull){let f=this.previousPointer.Resolve();if(f===null)return h.throwNullException("this.previousPointer.Resolve()");d.WriteProperty("previousContentObject",f.path.toString())}d.WriteObjectEnd()}}c.Thread=S}(p=t.CallStack||(t.CallStack={}))})(Fh);var kl={};Object.defineProperty(kl,"__esModule",{value:!0});kl.VariablesState=void 0;const Se=re,j_=Wn,Yf=wn,xe=B,ci=it,Nt=ue;class Al{constructor(e,n){this.variableChangedEventCallbacks=[],this.patch=null,this._batchObservingVariableChanges=!1,this._defaultGlobalVariables=new Map,this._changedVariablesForBatchObs=new Set,this._globalVariables=new Map,this._callStack=e,this._listDefsOrigin=n;try{return new Proxy(this,{get(i,o){return o in i?i[o]:i.$(o)},set(i,o,s){return o in i?i[o]=s:i.$(o,s),!0}})}catch{}}variableChangedEvent(e,n){for(let r of this.variableChangedEventCallbacks)r(e,n)}get batchObservingVariableChanges(){return this._batchObservingVariableChanges}set batchObservingVariableChanges(e){if(this._batchObservingVariableChanges=e,e)this._changedVariablesForBatchObs=new Set;else if(this._changedVariablesForBatchObs!=null){for(let n of this._changedVariablesForBatchObs){let r=this._globalVariables.get(n);r?this.variableChangedEvent(n,r):Nt.throwNullException("currentValue")}this._changedVariablesForBatchObs=null}}get callStack(){return this._callStack}set callStack(e){this._callStack=e}$(e,n){if(typeof n=="undefined"){let r=null;return this.patch!==null&&(r=this.patch.TryGetGlobal(e,null),r.exists)?r.result.valueObject:(r=this._globalVariables.get(e),typeof r=="undefined"&&(r=this._defaultGlobalVariables.get(e)),typeof r!="undefined"?r.valueObject:null)}else{if(typeof this._defaultGlobalVariables.get(e)=="undefined")throw new j_.StoryException("Cannot assign to a variable ("+e+") that hasn't been declared in the story");let r=Se.Value.Create(n);if(r==null)throw n==null?new Error("Cannot pass null to VariableState"):new Error("Invalid value passed to VariableState: "+n.toString());this.SetGlobal(e,r)}}ApplyPatch(){if(this.patch===null)return Nt.throwNullException("this.patch");for(let[e,n]of this.patch.globals)this._globalVariables.set(e,n);if(this._changedVariablesForBatchObs!==null)for(let e of this.patch.changedVariables)this._changedVariablesForBatchObs.add(e);this.patch=null}SetJsonToken(e){this._globalVariables.clear();for(let[n,r]of this._defaultGlobalVariables){let i=e[n];if(typeof i!="undefined"){let o=Yf.JsonSerialisation.JTokenToRuntimeObject(i);if(o===null)return Nt.throwNullException("tokenInkObject");this._globalVariables.set(n,o)}else this._globalVariables.set(n,r)}}WriteJson(e){e.WriteObjectStart();for(let[n,r]of this._globalVariables){let i=n,o=r;if(Al.dontSaveDefaultValues&&this._defaultGlobalVariables.has(i)){let s=this._defaultGlobalVariables.get(i);if(this.RuntimeObjectsEqual(o,s))continue}e.WritePropertyStart(i),Yf.JsonSerialisation.WriteRuntimeObject(e,o),e.WritePropertyEnd()}e.WriteObjectEnd()}RuntimeObjectsEqual(e,n){if(e===null)return Nt.throwNullException("obj1");if(n===null)return Nt.throwNullException("obj2");if(e.constructor!==n.constructor)return!1;let r=xe.asOrNull(e,Se.BoolValue);if(r!==null)return r.value===xe.asOrThrows(n,Se.BoolValue).value;let i=xe.asOrNull(e,Se.IntValue);if(i!==null)return i.value===xe.asOrThrows(n,Se.IntValue).value;let o=xe.asOrNull(e,Se.FloatValue);if(o!==null)return o.value===xe.asOrThrows(n,Se.FloatValue).value;let s=xe.asOrNull(e,Se.Value),l=xe.asOrNull(n,Se.Value);if(s!==null&&l!==null)return xe.isEquatable(s.valueObject)&&xe.isEquatable(l.valueObject)?s.valueObject.Equals(l.valueObject):s.valueObject===l.valueObject;throw new Error("FastRoughDefinitelyEquals: Unsupported runtime object type: "+e.constructor.name)}GetVariableWithName(e,n=-1){let r=this.GetRawVariableWithName(e,n),i=xe.asOrNull(r,Se.VariablePointerValue);return i!==null&&(r=this.ValueAtVariablePointer(i)),r}TryGetDefaultVariableValue(e){let n=ci.tryGetValueFromMap(this._defaultGlobalVariables,e,null);return n.exists?n.result:null}GlobalVariableExistsWithName(e){return this._globalVariables.has(e)||this._defaultGlobalVariables!==null&&this._defaultGlobalVariables.has(e)}GetRawVariableWithName(e,n){let r=null;if(n==0||n==-1){let i=null;if(this.patch!==null&&(i=this.patch.TryGetGlobal(e,null),i.exists)||(i=ci.tryGetValueFromMap(this._globalVariables,e,null),i.exists)||this._defaultGlobalVariables!==null&&(i=ci.tryGetValueFromMap(this._defaultGlobalVariables,e,null),i.exists))return i.result;if(this._listDefsOrigin===null)return Nt.throwNullException("VariablesState._listDefsOrigin");let o=this._listDefsOrigin.FindSingleItemListWithName(e);if(o)return o}return r=this._callStack.GetTemporaryVariableWithName(e,n),r}ValueAtVariablePointer(e){return this.GetVariableWithName(e.variableName,e.contextIndex)}Assign(e,n){let r=e.variableName;if(r===null)return Nt.throwNullException("name");let i=-1,o=!1;if(e.isNewDeclaration?o=e.isGlobal:o=this.GlobalVariableExistsWithName(r),e.isNewDeclaration){let s=xe.asOrNull(n,Se.VariablePointerValue);s!==null&&(n=this.ResolveVariablePointer(s))}else{let s=null;do s=xe.asOrNull(this.GetRawVariableWithName(r,i),Se.VariablePointerValue),s!=null&&(r=s.variableName,i=s.contextIndex,o=i==0);while(s!=null)}o?this.SetGlobal(r,n):this._callStack.SetTemporaryVariable(r,n,e.isNewDeclaration,i)}SnapshotDefaultGlobals(){this._defaultGlobalVariables=new Map(this._globalVariables)}RetainListOriginsForAssignment(e,n){let r=xe.asOrThrows(e,Se.ListValue),i=xe.asOrThrows(n,Se.ListValue);r.value&&i.value&&i.value.Count==0&&i.value.SetInitialOriginNames(r.value.originNames)}SetGlobal(e,n){let r=null;if(this.patch===null&&(r=ci.tryGetValueFromMap(this._globalVariables,e,null)),this.patch!==null&&(r=this.patch.TryGetGlobal(e,null),r.exists||(r=ci.tryGetValueFromMap(this._globalVariables,e,null))),Se.ListValue.RetainListOriginsForAssignment(r.result,n),e===null)return Nt.throwNullException("variableName");if(this.patch!==null?this.patch.SetGlobal(e,n):this._globalVariables.set(e,n),this.variableChangedEvent!==null&&r!==null&&n!==r.result)if(this.batchObservingVariableChanges){if(this._changedVariablesForBatchObs===null)return Nt.throwNullException("this._changedVariablesForBatchObs");this.patch!==null?this.patch.AddChangedVariable(e):this._changedVariablesForBatchObs!==null&&this._changedVariablesForBatchObs.add(e)}else this.variableChangedEvent(e,n)}ResolveVariablePointer(e){let n=e.contextIndex;n==-1&&(n=this.GetContextIndexOfVariableNamed(e.variableName));let r=this.GetRawVariableWithName(e.variableName,n),i=xe.asOrNull(r,Se.VariablePointerValue);return i!=null?i:new Se.VariablePointerValue(e.variableName,n)}GetContextIndexOfVariableNamed(e){return this.GlobalVariableExistsWithName(e)?0:this._callStack.currentElementIndex}ObserveVariableChange(e){this.variableChangedEventCallbacks.push(e)}}kl.VariablesState=Al;Al.dontSaveDefaultValues=!0;var Os={};Object.defineProperty(Os,"__esModule",{value:!0});Os.PRNG=void 0;class M_{constructor(e){this.seed=e%2147483647,this.seed<=0&&(this.seed+=2147483646)}next(){return this.seed=this.seed*16807%2147483647}nextFloat(){return(this.next()-1)/2147483646}}Os.PRNG=M_;var Fl={};Object.defineProperty(Fl,"__esModule",{value:!0});Fl.StatePatch=void 0;class $_{constructor(){if(this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,arguments.length===1&&arguments[0]!==null){let e=arguments[0];this._globals=new Map(e._globals),this._changedVariables=new Set(e._changedVariables),this._visitCounts=new Map(e._visitCounts),this._turnIndices=new Map(e._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}get globals(){return this._globals}get changedVariables(){return this._changedVariables}get visitCounts(){return this._visitCounts}get turnIndices(){return this._turnIndices}TryGetGlobal(e,n){return e!==null&&this._globals.has(e)?{result:this._globals.get(e),exists:!0}:{result:n,exists:!1}}SetGlobal(e,n){this._globals.set(e,n)}AddChangedVariable(e){return this._changedVariables.add(e)}TryGetVisitCount(e,n){return this._visitCounts.has(e)?{result:this._visitCounts.get(e),exists:!0}:{result:n,exists:!1}}SetVisitCount(e,n){this._visitCounts.set(e,n)}SetTurnIndex(e,n){this._turnIndices.set(e,n)}TryGetTurnIndex(e,n){return this._turnIndices.has(e)?{result:this._turnIndices.get(e),exists:!0}:{result:n,exists:!1}}}Fl.StatePatch=$_;var Rh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleJson=void 0;class e{static TextToDictionary(r){return new e.Reader(r).ToDictionary()}static TextToArray(r){return new e.Reader(r).ToArray()}}t.SimpleJson=e,function(n){class r{constructor(s){this._rootObject=JSON.parse(s)}ToDictionary(){return this._rootObject}ToArray(){return this._rootObject}}n.Reader=r;class i{constructor(){this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}WriteObject(s){this.WriteObjectStart(),s(this),this.WriteObjectEnd()}WriteObjectStart(){this.StartNewObject(!0);let s={};if(this.state===n.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let l=this._propertyNameStack.pop();this.currentCollection[l]=s,this._collectionStack.push(s)}else this.state===n.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(s),this._collectionStack.push(s)):(this.Assert(this.state===n.Writer.State.None),this._jsonObject=s,this._collectionStack.push(s));this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Object))}WriteObjectEnd(){this.Assert(this.state===n.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}WriteProperty(s,l){if(this.WritePropertyStart(s),arguments[1]instanceof Function)arguments[1](this);else{let a=arguments[1];this.Write(a)}this.WritePropertyEnd()}WriteIntProperty(s,l){this.WritePropertyStart(s),this.WriteInt(l),this.WritePropertyEnd()}WriteFloatProperty(s,l){this.WritePropertyStart(s),this.WriteFloat(l),this.WritePropertyEnd()}WritePropertyStart(s){this.Assert(this.state===n.Writer.State.Object),this._propertyNameStack.push(s),this.IncrementChildCount(),this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Property))}WritePropertyEnd(){this.Assert(this.state===n.Writer.State.Property),this.Assert(this.childCount===1),this._stateStack.pop()}WritePropertyNameStart(){this.Assert(this.state===n.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName="",this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Property)),this._stateStack.push(new n.Writer.StateElement(n.Writer.State.PropertyName))}WritePropertyNameEnd(){this.Assert(this.state===n.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}WritePropertyNameInner(s){this.Assert(this.state===n.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._currentPropertyName+=s}WriteArrayStart(){this.StartNewObject(!0);let s=[];if(this.state===n.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let l=this._propertyNameStack.pop();this.currentCollection[l]=s,this._collectionStack.push(s)}else this.state===n.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(s),this._collectionStack.push(s)):(this.Assert(this.state===n.Writer.State.None),this._jsonObject=s,this._collectionStack.push(s));this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Array))}WriteArrayEnd(){this.Assert(this.state===n.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}Write(s,l=!0){if(s===null){console.error("Warning: trying to write a null value");return}this.StartNewObject(!1),this._addToCurrentObject(s)}WriteBool(s){s!==null&&(this.StartNewObject(!1),this._addToCurrentObject(s))}WriteInt(s){s!==null&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(s)))}WriteFloat(s){s!==null&&(this.StartNewObject(!1),s==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):s==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(s)?this._addToCurrentObject(0):this._addToCurrentObject(s))}WriteNull(){this.StartNewObject(!1),this._addToCurrentObject(null)}WriteStringStart(){this.StartNewObject(!1),this._currentString="",this._stateStack.push(new n.Writer.StateElement(n.Writer.State.String))}WriteStringEnd(){this.Assert(this.state==n.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}WriteStringInner(s,l=!0){if(this.Assert(this.state===n.Writer.State.String),s===null){console.error("Warning: trying to write a null string");return}this._currentString+=s}toString(){return this._jsonObject===null?"":JSON.stringify(this._jsonObject)}StartNewObject(s){s?this.Assert(this.state===n.Writer.State.None||this.state===n.Writer.State.Property||this.state===n.Writer.State.Array):this.Assert(this.state===n.Writer.State.Property||this.state===n.Writer.State.Array),this.state===n.Writer.State.Property&&this.Assert(this.childCount===0),(this.state===n.Writer.State.Array||this.state===n.Writer.State.Property)&&this.IncrementChildCount()}get state(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:n.Writer.State.None}get childCount(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}get currentCollection(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}get currentPropertyName(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}IncrementChildCount(){this.Assert(this._stateStack.length>0);let s=this._stateStack.pop();s.childCount++,this._stateStack.push(s)}Assert(s){if(!s)throw Error("Assert failed while writing JSON")}_addToCurrentObject(s){this.Assert(this.currentCollection!==null),this.state===n.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(s)):this.state===n.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(this.currentPropertyName!==null),this.currentCollection[this.currentPropertyName]=s,this._propertyNameStack.pop())}}n.Writer=i,function(o){(function(l){l[l.None=0]="None",l[l.Object=1]="Object",l[l.Array=2]="Array",l[l.Property=3]="Property",l[l.PropertyName=4]="PropertyName",l[l.String=5]="String"})(o.State||(o.State={}));class s{constructor(a){this.type=n.Writer.State.None,this.childCount=0,this.type=a}}o.StateElement=s}(i=n.Writer||(n.Writer={}))}(e=t.SimpleJson||(t.SimpleJson={}))})(Rh);var Rl={};Object.defineProperty(Rl,"__esModule",{value:!0});Rl.Flow=void 0;const Zf=Fh,no=wn,B_=ue;class G_{constructor(){let e=arguments[0],n=arguments[1];if(this.name=e,this.callStack=new Zf.CallStack(n),arguments[2]){let r=arguments[2];this.callStack.SetJsonToken(r.callstack,n),this.outputStream=no.JsonSerialisation.JArrayToRuntimeObjList(r.outputStream),this.currentChoices=no.JsonSerialisation.JArrayToRuntimeObjList(r.currentChoices);let i=r.choiceThreads;typeof i!="undefined"&&this.LoadFlowChoiceThreads(i,n)}else this.outputStream=[],this.currentChoices=[]}WriteJson(e){e.WriteObjectStart(),e.WriteProperty("callstack",r=>this.callStack.WriteJson(r)),e.WriteProperty("outputStream",r=>no.JsonSerialisation.WriteListRuntimeObjs(r,this.outputStream));let n=!1;for(let r of this.currentChoices){if(r.threadAtGeneration===null)return B_.throwNullException("c.threadAtGeneration");r.originalThreadIndex=r.threadAtGeneration.threadIndex,this.callStack.ThreadWithIndex(r.originalThreadIndex)===null&&(n||(n=!0,e.WritePropertyStart("choiceThreads"),e.WriteObjectStart()),e.WritePropertyStart(r.originalThreadIndex),r.threadAtGeneration.WriteJson(e),e.WritePropertyEnd())}n&&(e.WriteObjectEnd(),e.WritePropertyEnd()),e.WriteProperty("currentChoices",r=>{r.WriteArrayStart();for(let i of this.currentChoices)no.JsonSerialisation.WriteChoice(r,i);r.WriteArrayEnd()}),e.WriteObjectEnd()}LoadFlowChoiceThreads(e,n){for(let r of this.currentChoices){let i=this.callStack.ThreadWithIndex(r.originalThreadIndex);if(i!==null)r.threadAtGeneration=i.Copy();else{let o=e[`${r.originalThreadIndex}`];r.threadAtGeneration=new Zf.CallStack.Thread(o,n)}}}}Rl.Flow=G_;Object.defineProperty(Il,"__esModule",{value:!0});Il.StoryState=void 0;const U_=Fh,z_=kl,we=re,Ht=$n,q_=Hn,Fa=Ur,ed=Ue,bt=Ve,td=jt,Kt=wn,H_=Os,K_=Mt,tr=Bn,fi=it,Te=B,J_=hs,ft=ue,Q_=_s,X_=Fl,nd=Rh,ro=Rl,Y_=Ce;class Lh{constructor(e){this.kInkSaveStateVersion=9,this.kMinCompatibleLoadVersion=8,this.onDidLoadState=null,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=tr.Pointer.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this._namedFlows=null,this.kDefaultFlowName="DEFAULT_FLOW",this.story=e,this._currentFlow=new ro.Flow(this.kDefaultFlowName,e),this.OutputStreamDirty(),this._evaluationStack=[],this._variablesState=new z_.VariablesState(this.callStack,e.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;let n=new Date().getTime();this.storySeed=new H_.PRNG(n).next()%100,this.previousRandom=0,this.GoToStart()}ToJson(e=!1){let n=new nd.SimpleJson.Writer;return this.WriteJson(n),n.toString()}toJson(e=!1){return this.ToJson(e)}LoadJson(e){let n=nd.SimpleJson.TextToDictionary(e);this.LoadJsonObj(n),this.onDidLoadState!==null&&this.onDidLoadState()}VisitCountAtPathString(e){let n;if(this._patch!==null){let r=this.story.ContentAtPath(new ed.Path(e)).container;if(r===null)throw new Error("Content at path not found: "+e);if(n=this._patch.TryGetVisitCount(r,0),n.exists)return n.result}return n=fi.tryGetValueFromMap(this._visitCounts,e,null),n.exists?n.result:0}VisitCountForContainer(e){if(e===null)return ft.throwNullException("container");if(!e.visitsShouldBeCounted)return this.story.Error("Read count for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),0;if(this._patch!==null){let i=this._patch.TryGetVisitCount(e,0);if(i.exists)return i.result}let n=e.path.toString(),r=fi.tryGetValueFromMap(this._visitCounts,n,null);return r.exists?r.result:0}IncrementVisitCountForContainer(e){if(this._patch!==null){let i=this.VisitCountForContainer(e);i++,this._patch.SetVisitCount(e,i);return}let n=e.path.toString(),r=fi.tryGetValueFromMap(this._visitCounts,n,null);r.exists?this._visitCounts.set(n,r.result+1):this._visitCounts.set(n,1)}RecordTurnIndexVisitToContainer(e){if(this._patch!==null){this._patch.SetTurnIndex(e,this.currentTurnIndex);return}let n=e.path.toString();this._turnIndices.set(n,this.currentTurnIndex)}TurnsSinceForContainer(e){if(e.turnIndexShouldBeCounted||this.story.Error("TURNS_SINCE() for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),this._patch!==null){let i=this._patch.TryGetTurnIndex(e,0);if(i.exists)return this.currentTurnIndex-i.result}let n=e.path.toString(),r=fi.tryGetValueFromMap(this._turnIndices,n,0);return r.exists?this.currentTurnIndex-r.result:-1}get callstackDepth(){return this.callStack.depth}get outputStream(){return this._currentFlow.outputStream}get currentChoices(){return this.canContinue?[]:this._currentFlow.currentChoices}get generatedChoices(){return this._currentFlow.currentChoices}get currentErrors(){return this._currentErrors}get currentWarnings(){return this._currentWarnings}get variablesState(){return this._variablesState}set variablesState(e){this._variablesState=e}get callStack(){return this._currentFlow.callStack}get evaluationStack(){return this._evaluationStack}get currentTurnIndex(){return this._currentTurnIndex}set currentTurnIndex(e){this._currentTurnIndex=e}get currentPathString(){let e=this.currentPointer;return e.isNull?null:e.path===null?ft.throwNullException("pointer.path"):e.path.toString()}get currentPointer(){return this.callStack.currentElement.currentPointer.copy()}set currentPointer(e){this.callStack.currentElement.currentPointer=e.copy()}get previousPointer(){return this.callStack.currentThread.previousPointer.copy()}set previousPointer(e){this.callStack.currentThread.previousPointer=e.copy()}get canContinue(){return!this.currentPointer.isNull&&!this.hasError}get hasError(){return this.currentErrors!=null&&this.currentErrors.length>0}get hasWarning(){return this.currentWarnings!=null&&this.currentWarnings.length>0}get currentText(){if(this._outputStreamTextDirty){let e=new td.StringBuilder;for(let n of this.outputStream){let r=Te.asOrNull(n,we.StringValue);r!==null&&e.Append(r.value)}this._currentText=this.CleanOutputWhitespace(e.toString()),this._outputStreamTextDirty=!1}return this._currentText}CleanOutputWhitespace(e){let n=new td.StringBuilder,r=-1,i=0;for(let o=0;o<e.length;o++){let s=e.charAt(o),l=s==" "||s=="	";l&&r==-1&&(r=o),l||(s!=`
`&&r>0&&r!=i&&n.Append(" "),r=-1),s==`
`&&(i=o+1),l||n.Append(s)}return n.toString()}get currentTags(){if(this._outputStreamTagsDirty){this._currentTags=[];for(let e of this.outputStream){let n=Te.asOrNull(e,q_.Tag);n!==null&&this._currentTags.push(n.text)}this._outputStreamTagsDirty=!1}return this._currentTags}get currentFlowName(){return this._currentFlow.name}get inExpressionEvaluation(){return this.callStack.currentElement.inExpressionEvaluation}set inExpressionEvaluation(e){this.callStack.currentElement.inExpressionEvaluation=e}GoToStart(){this.callStack.currentElement.currentPointer=tr.Pointer.StartOf(this.story.mainContentContainer)}SwitchFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.SwitchFlow");if(this._namedFlows===null&&(this._namedFlows=new Map,this._namedFlows.set(this.kDefaultFlowName,this._currentFlow)),e===this._currentFlow.name)return;let n,r=fi.tryGetValueFromMap(this._namedFlows,e,null);r.exists?n=r.result:(n=new ro.Flow(e,this.story),this._namedFlows.set(e,n)),this._currentFlow=n,this.variablesState.callStack=this._currentFlow.callStack,this.OutputStreamDirty()}SwitchToDefaultFlow_Internal(){this._namedFlows!==null&&this.SwitchFlow_Internal(this.kDefaultFlowName)}RemoveFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.DestroyFlow");if(e===this.kDefaultFlowName)throw new Error("Cannot destroy default flow");if(this._currentFlow.name===e&&this.SwitchToDefaultFlow_Internal(),this._namedFlows===null)return ft.throwNullException("this._namedFlows");this._namedFlows.delete(e)}CopyAndStartPatching(){let e=new Lh(this.story);if(e._patch=new X_.StatePatch(this._patch),e._currentFlow.name=this._currentFlow.name,e._currentFlow.callStack=new U_.CallStack(this._currentFlow.callStack),e._currentFlow.currentChoices.push(...this._currentFlow.currentChoices),e._currentFlow.outputStream.push(...this._currentFlow.outputStream),e.OutputStreamDirty(),this._namedFlows!==null){e._namedFlows=new Map;for(let[n,r]of this._namedFlows)e._namedFlows.set(n,r);e._namedFlows.set(this._currentFlow.name,e._currentFlow)}return this.hasError&&(e._currentErrors=[],e._currentErrors.push(...this.currentErrors||[])),this.hasWarning&&(e._currentWarnings=[],e._currentWarnings.push(...this.currentWarnings||[])),e.variablesState=this.variablesState,e.variablesState.callStack=e.callStack,e.variablesState.patch=e._patch,e.evaluationStack.push(...this.evaluationStack),this.divertedPointer.isNull||(e.divertedPointer=this.divertedPointer.copy()),e.previousPointer=this.previousPointer.copy(),e._visitCounts=this._visitCounts,e._turnIndices=this._turnIndices,e.currentTurnIndex=this.currentTurnIndex,e.storySeed=this.storySeed,e.previousRandom=this.previousRandom,e.didSafeExit=this.didSafeExit,e}RestoreAfterPatch(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}ApplyAnyPatch(){if(this._patch!==null){this.variablesState.ApplyPatch();for(let[e,n]of this._patch.visitCounts)this.ApplyCountChanges(e,n,!0);for(let[e,n]of this._patch.turnIndices)this.ApplyCountChanges(e,n,!1);this._patch=null}}ApplyCountChanges(e,n,r){(r?this._visitCounts:this._turnIndices).set(e.path.toString(),n)}WriteJson(e){if(e.WriteObjectStart(),e.WritePropertyStart("flows"),e.WriteObjectStart(),this._namedFlows!==null)for(let[n,r]of this._namedFlows)e.WriteProperty(n,i=>r.WriteJson(i));else e.WriteProperty(this._currentFlow.name,n=>this._currentFlow.WriteJson(n));if(e.WriteObjectEnd(),e.WritePropertyEnd(),e.WriteProperty("currentFlowName",this._currentFlow.name),e.WriteProperty("variablesState",n=>this.variablesState.WriteJson(n)),e.WriteProperty("evalStack",n=>Kt.JsonSerialisation.WriteListRuntimeObjs(n,this.evaluationStack)),!this.divertedPointer.isNull){if(this.divertedPointer.path===null)return ft.throwNullException("divertedPointer");e.WriteProperty("currentDivertTarget",this.divertedPointer.path.componentsString)}e.WriteProperty("visitCounts",n=>Kt.JsonSerialisation.WriteIntDictionary(n,this._visitCounts)),e.WriteProperty("turnIndices",n=>Kt.JsonSerialisation.WriteIntDictionary(n,this._turnIndices)),e.WriteIntProperty("turnIdx",this.currentTurnIndex),e.WriteIntProperty("storySeed",this.storySeed),e.WriteIntProperty("previousRandom",this.previousRandom),e.WriteIntProperty("inkSaveVersion",this.kInkSaveStateVersion),e.WriteIntProperty("inkFormatVersion",Q_.Story.inkVersionCurrent),e.WriteObjectEnd()}LoadJsonObj(e){let n=e,r=n.inkSaveVersion;if(r==null)throw new Error("ink save format incorrect, can't load.");if(parseInt(r)<this.kMinCompatibleLoadVersion)throw new Error("Ink save format isn't compatible with the current version (saw '"+r+"', but minimum is "+this.kMinCompatibleLoadVersion+"), so can't load.");let i=n.flows;if(i!=null){let s=i;Object.keys(s).length===1?this._namedFlows=null:this._namedFlows===null?this._namedFlows=new Map:this._namedFlows.clear();let l=Object.entries(s);for(let[a,u]of l){let h=a,p=u,c=new ro.Flow(h,this.story,p);if(Object.keys(s).length===1)this._currentFlow=new ro.Flow(h,this.story,p);else{if(this._namedFlows===null)return ft.throwNullException("this._namedFlows");this._namedFlows.set(h,c)}}if(this._namedFlows!=null&&this._namedFlows.size>1){let a=n.currentFlowName;this._currentFlow=this._namedFlows.get(a)}}else{this._namedFlows=null,this._currentFlow.name=this.kDefaultFlowName,this._currentFlow.callStack.SetJsonToken(n.callstackThreads,this.story),this._currentFlow.outputStream=Kt.JsonSerialisation.JArrayToRuntimeObjList(n.outputStream),this._currentFlow.currentChoices=Kt.JsonSerialisation.JArrayToRuntimeObjList(n.currentChoices);let s=n.choiceThreads;this._currentFlow.LoadFlowChoiceThreads(s,this.story)}this.OutputStreamDirty(),this.variablesState.SetJsonToken(n.variablesState),this.variablesState.callStack=this._currentFlow.callStack,this._evaluationStack=Kt.JsonSerialisation.JArrayToRuntimeObjList(n.evalStack);let o=n.currentDivertTarget;if(o!=null){let s=new ed.Path(o.toString());this.divertedPointer=this.story.PointerAtPath(s)}this._visitCounts=Kt.JsonSerialisation.JObjectToIntDictionary(n.visitCounts),this._turnIndices=Kt.JsonSerialisation.JObjectToIntDictionary(n.turnIndices),this.currentTurnIndex=parseInt(n.turnIdx),this.storySeed=parseInt(n.storySeed),this.previousRandom=parseInt(n.previousRandom)}ResetErrors(){this._currentErrors=null,this._currentWarnings=null}ResetOutput(e=null){this.outputStream.length=0,e!==null&&this.outputStream.push(...e),this.OutputStreamDirty()}PushToOutputStream(e){let n=Te.asOrNull(e,we.StringValue);if(n!==null){let r=this.TrySplittingHeadTailWhitespace(n);if(r!==null){for(let i of r)this.PushToOutputStreamIndividual(i);this.OutputStreamDirty();return}}this.PushToOutputStreamIndividual(e),this.OutputStreamDirty()}PopFromOutputStream(e){this.outputStream.splice(this.outputStream.length-e,e),this.OutputStreamDirty()}TrySplittingHeadTailWhitespace(e){let n=e.value;if(n===null)return ft.throwNullException("single.value");let r=-1,i=-1;for(let h=0;h<n.length;h++){let p=n[h];if(p==`
`)r==-1&&(r=h),i=h;else{if(p==" "||p=="	")continue;break}}let o=-1,s=-1;for(let h=n.length-1;h>=0;h--){let p=n[h];if(p==`
`)o==-1&&(o=h),s=h;else{if(p==" "||p=="	")continue;break}}if(r==-1&&o==-1)return null;let l=[],a=0,u=n.length;if(r!=-1){if(r>0){let h=new we.StringValue(n.substring(0,r));l.push(h)}l.push(new we.StringValue(`
`)),a=i+1}if(o!=-1&&(u=s),u>a){let h=n.substring(a,u-a);l.push(new we.StringValue(h))}if(o!=-1&&s>i&&(l.push(new we.StringValue(`
`)),o<n.length-1)){let h=n.length-o-1,p=new we.StringValue(n.substring(o+1,h));l.push(p)}return l}PushToOutputStreamIndividual(e){let n=Te.asOrNull(e,Fa.Glue),r=Te.asOrNull(e,we.StringValue),i=!0;if(n)this.TrimNewlinesFromOutputStream(),i=!0;else if(r){let o=-1,s=this.callStack.currentElement;s.type==Ht.PushPopType.Function&&(o=s.functionStartInOutputStream);let l=-1;for(let u=this.outputStream.length-1;u>=0;u--){let h=this.outputStream[u],p=h instanceof bt.ControlCommand?h:null;if((h instanceof Fa.Glue?h:null)!=null){l=u;break}else if(p!=null&&p.commandType==bt.ControlCommand.CommandType.BeginString){u>=o&&(o=-1);break}}let a=-1;if(l!=-1&&o!=-1?a=Math.min(o,l):l!=-1?a=l:a=o,a!=-1){if(r.isNewline)i=!1;else if(r.isNonWhitespace&&(l>-1&&this.RemoveExistingGlue(),o>-1)){let u=this.callStack.elements;for(let h=u.length-1;h>=0;h--){let p=u[h];if(p.type==Ht.PushPopType.Function)p.functionStartInOutputStream=-1;else break}}}else r.isNewline&&(this.outputStreamEndsInNewline||!this.outputStreamContainsContent)&&(i=!1)}if(i){if(e===null)return ft.throwNullException("obj");this.outputStream.push(e),this.OutputStreamDirty()}}TrimNewlinesFromOutputStream(){let e=-1,n=this.outputStream.length-1;for(;n>=0;){let r=this.outputStream[n],i=Te.asOrNull(r,bt.ControlCommand),o=Te.asOrNull(r,we.StringValue);if(i!=null||o!=null&&o.isNonWhitespace)break;o!=null&&o.isNewline&&(e=n),n--}if(e>=0)for(n=e;n<this.outputStream.length;)Te.asOrNull(this.outputStream[n],we.StringValue)?this.outputStream.splice(n,1):n++;this.OutputStreamDirty()}RemoveExistingGlue(){for(let e=this.outputStream.length-1;e>=0;e--){let n=this.outputStream[e];if(n instanceof Fa.Glue)this.outputStream.splice(e,1);else if(n instanceof bt.ControlCommand)break}this.OutputStreamDirty()}get outputStreamEndsInNewline(){if(this.outputStream.length>0)for(let e=this.outputStream.length-1;e>=0&&!(this.outputStream[e]instanceof bt.ControlCommand);e--){let r=this.outputStream[e];if(r instanceof we.StringValue){if(r.isNewline)return!0;if(r.isNonWhitespace)break}}return!1}get outputStreamContainsContent(){for(let e of this.outputStream)if(e instanceof we.StringValue)return!0;return!1}get inStringEvaluation(){for(let e=this.outputStream.length-1;e>=0;e--){let n=Te.asOrNull(this.outputStream[e],bt.ControlCommand);if(n instanceof bt.ControlCommand&&n.commandType==bt.ControlCommand.CommandType.BeginString)return!0}return!1}PushEvaluationStack(e){let n=Te.asOrNull(e,we.ListValue);if(n){let r=n.value;if(r===null)return ft.throwNullException("rawList");if(r.originNames!=null){r.origins||(r.origins=[]),r.origins.length=0;for(let i of r.originNames){if(this.story.listDefinitions===null)return ft.throwNullException("StoryState.story.listDefinitions");let o=this.story.listDefinitions.TryListGetDefinition(i,null);if(o.result===null)return ft.throwNullException("StoryState def.result");r.origins.indexOf(o.result)<0&&r.origins.push(o.result)}}}if(e===null)return ft.throwNullException("obj");this.evaluationStack.push(e)}PopEvaluationStack(e){if(typeof e=="undefined"){let n=this.evaluationStack.pop();return Te.nullIfUndefined(n)}else{if(e>this.evaluationStack.length)throw new Error("trying to pop too many objects");let n=this.evaluationStack.splice(this.evaluationStack.length-e,e);return Te.nullIfUndefined(n)}}PeekEvaluationStack(){return this.evaluationStack[this.evaluationStack.length-1]}ForceEnd(){this.callStack.Reset(),this._currentFlow.currentChoices.length=0,this.currentPointer=tr.Pointer.Null,this.previousPointer=tr.Pointer.Null,this.didSafeExit=!0}TrimWhitespaceFromFunctionEnd(){J_.Debug.Assert(this.callStack.currentElement.type==Ht.PushPopType.Function);let e=this.callStack.currentElement.functionStartInOutputStream;e==-1&&(e=0);for(let n=this.outputStream.length-1;n>=e;n--){let r=this.outputStream[n],i=Te.asOrNull(r,we.StringValue),o=Te.asOrNull(r,bt.ControlCommand);if(i!=null){if(o)break;if(i.isNewline||i.isInlineWhitespace)this.outputStream.splice(n,1),this.OutputStreamDirty();else break}}}PopCallStack(e=null){this.callStack.currentElement.type==Ht.PushPopType.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(e)}SetChosenPath(e,n){this._currentFlow.currentChoices.length=0;let r=this.story.PointerAtPath(e);!r.isNull&&r.index==-1&&(r.index=0),this.currentPointer=r,n&&this.currentTurnIndex++}StartFunctionEvaluationFromGame(e,n){this.callStack.Push(Ht.PushPopType.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=tr.Pointer.StartOf(e),this.PassArgumentsToEvaluationStack(n)}PassArgumentsToEvaluationStack(e){if(e!==null)for(let n=0;n<e.length;n++){if(!(typeof e[n]=="number"||typeof e[n]=="string")||e[n]instanceof Y_.InkList)throw new Error("ink arguments when calling EvaluateFunction / ChoosePathStringWithParameters must benumber, string or InkList. Argument was "+(Te.nullIfUndefined(arguments[n])===null)?"null":arguments[n].constructor.name);this.PushEvaluationStack(we.Value.Create(e[n]))}}TryExitFunctionEvaluationFromGame(){return this.callStack.currentElement.type==Ht.PushPopType.FunctionEvaluationFromGame?(this.currentPointer=tr.Pointer.Null,this.didSafeExit=!0,!0):!1}CompleteFunctionEvaluationFromGame(){if(this.callStack.currentElement.type!=Ht.PushPopType.FunctionEvaluationFromGame)throw new Error("Expected external function evaluation to be complete. Stack trace: "+this.callStack.callStackTrace);let e=this.callStack.currentElement.evaluationStackHeightWhenPushed,n=null;for(;this.evaluationStack.length>e;){let r=this.PopEvaluationStack();n===null&&(n=r)}if(this.PopCallStack(Ht.PushPopType.FunctionEvaluationFromGame),n){if(n instanceof K_.Void)return null;let r=Te.asOrThrows(n,we.Value);return r.valueType==we.ValueType.DivertTarget?r.valueObject.toString():r.valueObject}return null}AddError(e,n){n?(this._currentWarnings==null&&(this._currentWarnings=[]),this._currentWarnings.push(e)):(this._currentErrors==null&&(this._currentErrors=[]),this._currentErrors.push(e))}OutputStreamDirty(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}Il.StoryState=Lh;var Ll={};Object.defineProperty(Ll,"__esModule",{value:!0});Ll.Stopwatch=void 0;class Z_{constructor(){this.startTime=void 0}get ElapsedMilliseconds(){return typeof this.startTime=="undefined"?0:new Date().getTime()-this.startTime}Start(){this.startTime=new Date().getTime()}Stop(){this.startTime=void 0}}Ll.Stopwatch=Z_;var Em={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(t.ErrorType||(t.ErrorType={}))})(Em);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Story=t.InkList=void 0;const e=he,n=Ae,r=wn,i=Il,o=Ve,s=$n,l=Dr,a=Es,u=mt,h=re,p=Ue,c=Mt,m=Hn,S=Tt,E=qn,d=at,f=Wn,g=Os,y=jt,w=Ps,b=Ll,N=Bn,L=Ce,k=B,T=ue,j=Rh,ze=Em;var ce=Ce;Object.defineProperty(t,"InkList",{enumerable:!0,get:function(){return ce.InkList}}),Number.isInteger||(Number.isInteger=function(v){return typeof v=="number"&&isFinite(v)&&v>-9007199254740992&&v<9007199254740992&&Math.floor(v)===v});class G extends n.InkObject{constructor(){super();this.inkVersionMinimumCompatible=18,this.onError=null,this.onDidContinue=null,this.onMakeChoice=null,this.onEvaluateFunction=null,this.onCompleteEvaluateFunction=null,this.onChoosePathString=null,this._prevContainers=[],this.allowExternalFunctionFallbacks=!1,this._listDefinitions=null,this._variableObservers=null,this._hasValidatedExternals=!1,this._temporaryEvaluationContainer=null,this._asyncContinueActive=!1,this._stateSnapshotAtLastNewline=null,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount=0,this._asyncSaving=!1,this._profiler=null;let v,C=null,_=null;if(arguments[0]instanceof e.Container)v=arguments[0],typeof arguments[1]!="undefined"&&(C=arguments[1]),this._mainContentContainer=v;else if(typeof arguments[0]=="string"){let P=arguments[0];_=j.SimpleJson.TextToDictionary(P)}else _=arguments[0];if(C!=null&&(this._listDefinitions=new w.ListDefinitionsOrigin(C)),this._externals=new Map,_!==null){let P=_,O=P.inkVersion;if(O==null)throw new Error("ink version number not found. Are you sure it's a valid .ink.json file?");let F=parseInt(O);if(F>G.inkVersionCurrent)throw new Error("Version of ink used to build story was newer than the current version of the engine");if(F<this.inkVersionMinimumCompatible)throw new Error("Version of ink used to build story is too old to be loaded by this version of the engine");F!=G.inkVersionCurrent&&console.warn("WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.");let x=P.root;if(x==null)throw new Error("Root node for ink not found. Are you sure it's a valid .ink.json file?");let A;(A=P.listDefs)&&(this._listDefinitions=r.JsonSerialisation.JTokenToListDefinitions(A)),this._mainContentContainer=k.asOrThrows(r.JsonSerialisation.JTokenToRuntimeObject(x),e.Container),this.ResetState()}}get currentChoices(){let v=[];if(this._state===null)return T.throwNullException("this._state");for(let C of this._state.currentChoices)C.isInvisibleDefault||(C.index=v.length,v.push(C));return v}get currentText(){return this.IfAsyncWeCant("call currentText since it's a work in progress"),this.state.currentText}get currentTags(){return this.IfAsyncWeCant("call currentTags since it's a work in progress"),this.state.currentTags}get currentErrors(){return this.state.currentErrors}get currentWarnings(){return this.state.currentWarnings}get currentFlowName(){return this.state.currentFlowName}get hasError(){return this.state.hasError}get hasWarning(){return this.state.hasWarning}get variablesState(){return this.state.variablesState}get listDefinitions(){return this._listDefinitions}get state(){return this._state}StartProfiling(){}EndProfiling(){}ToJson(v){let C=!1;if(v||(C=!0,v=new j.SimpleJson.Writer),v.WriteObjectStart(),v.WriteIntProperty("inkVersion",G.inkVersionCurrent),v.WriteProperty("root",_=>r.JsonSerialisation.WriteRuntimeContainer(_,this._mainContentContainer)),this._listDefinitions!=null){v.WritePropertyStart("listDefs"),v.WriteObjectStart();for(let _ of this._listDefinitions.lists){v.WritePropertyStart(_.name),v.WriteObjectStart();for(let[P,O]of _.items){let F=L.InkListItem.fromSerializedKey(P),x=O;v.WriteIntProperty(F.itemName,x)}v.WriteObjectEnd(),v.WritePropertyEnd()}v.WriteObjectEnd(),v.WritePropertyEnd()}if(v.WriteObjectEnd(),C)return v.toString()}ResetState(){this.IfAsyncWeCant("ResetState"),this._state=new i.StoryState(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}ResetErrors(){if(this._state===null)return T.throwNullException("this._state");this._state.ResetErrors()}ResetCallstack(){if(this.IfAsyncWeCant("ResetCallstack"),this._state===null)return T.throwNullException("this._state");this._state.ForceEnd()}ResetGlobals(){if(this._mainContentContainer.namedContent.get("global decl")){let v=this.state.currentPointer.copy();this.ChoosePath(new p.Path("global decl"),!1),this.ContinueInternal(),this.state.currentPointer=v}this.state.variablesState.SnapshotDefaultGlobals()}SwitchFlow(v){if(this.IfAsyncWeCant("switch flow"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't switch flow to "+v);this.state.SwitchFlow_Internal(v)}RemoveFlow(v){this.state.RemoveFlow_Internal(v)}SwitchToDefaultFlow(){this.state.SwitchToDefaultFlow_Internal()}Continue(){return this.ContinueAsync(0),this.currentText}get canContinue(){return this.state.canContinue}get asyncContinueComplete(){return!this._asyncContinueActive}ContinueAsync(v){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(v)}ContinueInternal(v=0){this._profiler!=null&&this._profiler.PreContinue();let C=v>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=C,!this.canContinue)throw new Error("Can't continue - should check canContinue before calling Continue");this._state.didSafeExit=!1,this._state.ResetOutput(),this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!0)}let _=new b.Stopwatch;_.Start();let P=!1;this._sawLookaheadUnsafeFunctionAfterNewline=!1;do{try{P=this.ContinueSingleStep()}catch(O){if(!(O instanceof f.StoryException))throw O;this.AddError(O.message,void 0,O.useEndLineNumber);break}if(P||this._asyncContinueActive&&_.ElapsedMilliseconds>v)break}while(this.canContinue);if(_.Stop(),(P||!this.canContinue)&&(this._stateSnapshotAtLastNewline!==null&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError("Thread available to pop, threads should always be flat by the end of evaluation?"),this.state.generatedChoices.length==0&&!this.state.didSafeExit&&this._temporaryEvaluationContainer==null&&(this.state.callStack.CanPop(s.PushPopType.Tunnel)?this.AddError("unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?"):this.state.callStack.CanPop(s.PushPopType.Function)?this.AddError("unexpectedly reached end of content. Do you need a '~ return'?"):this.state.callStack.canPop?this.AddError("unexpectedly reached end of content for unknown reason. Please debug compiler!"):this.AddError("ran out of content. Do you need a '-> DONE' or '-> END'?"))),this.state.didSafeExit=!1,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1,this.onDidContinue!==null&&this.onDidContinue()),this._recursiveContinueCount--,this._profiler!=null&&this._profiler.PostContinue(),this.state.hasError||this.state.hasWarning)if(this.onError!==null){if(this.state.hasError)for(let O of this.state.currentErrors)this.onError(O,ze.ErrorType.Error);if(this.state.hasWarning)for(let O of this.state.currentWarnings)this.onError(O,ze.ErrorType.Warning);this.ResetErrors()}else{let O=new y.StringBuilder;throw O.Append("Ink had "),this.state.hasError&&(O.Append(`${this.state.currentErrors.length}`),O.Append(this.state.currentErrors.length==1?" error":"errors"),this.state.hasWarning&&O.Append(" and ")),this.state.hasWarning&&(O.Append(`${this.state.currentWarnings.length}`),O.Append(this.state.currentWarnings.length==1?" warning":"warnings"),this.state.hasWarning&&O.Append(" and ")),O.Append(". It is strongly suggested that you assign an error handler to story.onError. The first issue was: "),O.Append(this.state.hasError?this.state.currentErrors[0]:this.state.currentWarnings[0]),new f.StoryException(O.toString())}}ContinueSingleStep(){if(this._profiler!=null&&this._profiler.PreStep(),this.Step(),this._profiler!=null&&this._profiler.PostStep(),!this.canContinue&&!this.state.callStack.elementIsEvaluateFromGame&&this.TryFollowDefaultInvisibleChoice(),this._profiler!=null&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(this._stateSnapshotAtLastNewline!==null){if(this._stateSnapshotAtLastNewline.currentTags===null)return T.throwNullException("this._stateAtLastNewline.currentTags");if(this.state.currentTags===null)return T.throwNullException("this.state.currentTags");let v=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(v==G.OutputStateChange.ExtendedBeyondNewline||this._sawLookaheadUnsafeFunctionAfterNewline)return this.RestoreStateSnapshot(),!0;v==G.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?this._stateSnapshotAtLastNewline==null&&this.StateSnapshot():this.DiscardSnapshot())}return this._profiler!=null&&this._profiler.PostSnapshot(),!1}CalculateNewlineOutputStateChange(v,C,_,P){if(v===null)return T.throwNullException("prevText");if(C===null)return T.throwNullException("currText");let O=C.length>=v.length&&C.charAt(v.length-1)==`
`;if(_==P&&v.length==C.length&&O)return G.OutputStateChange.NoChange;if(!O)return G.OutputStateChange.NewlineRemoved;if(P>_)return G.OutputStateChange.ExtendedBeyondNewline;for(let F=v.length;F<C.length;F++){let x=C.charAt(F);if(x!=" "&&x!="	")return G.OutputStateChange.ExtendedBeyondNewline}return G.OutputStateChange.NoChange}ContinueMaximally(){this.IfAsyncWeCant("ContinueMaximally");let v=new y.StringBuilder;for(;this.canContinue;)v.Append(this.Continue());return v.toString()}ContentAtPath(v){return this.mainContentContainer.ContentAtPath(v)}KnotContainerWithName(v){let C=this.mainContentContainer.namedContent.get(v);return C instanceof e.Container?C:null}PointerAtPath(v){if(v.length==0)return N.Pointer.Null;let C=new N.Pointer,_=v.length,P=null;return v.lastComponent===null?T.throwNullException("path.lastComponent"):(v.lastComponent.isIndex?(_=v.length-1,P=this.mainContentContainer.ContentAtPath(v,void 0,_),C.container=P.container,C.index=v.lastComponent.index):(P=this.mainContentContainer.ContentAtPath(v),C.container=P.container,C.index=-1),P.obj==null||P.obj==this.mainContentContainer&&_>0?this.Error("Failed to find content at path '"+v+"', and no approximation of it was possible."):P.approximate&&this.Warning("Failed to find content at path '"+v+"', so it was approximated to: '"+P.obj.path+"'."),C)}StateSnapshot(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}RestoreStateSnapshot(){this._stateSnapshotAtLastNewline===null&&T.throwNullException("_stateSnapshotAtLastNewline"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}DiscardSnapshot(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}CopyStateForBackgroundThreadSave(){if(this.IfAsyncWeCant("start saving on a background thread"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!");let v=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,v}BackgroundSaveComplete(){this._stateSnapshotAtLastNewline===null&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}Step(){let v=!0,C=this.state.currentPointer.copy();if(C.isNull)return;let _=k.asOrNull(C.Resolve(),e.Container);for(;_&&(this.VisitContainer(_,!0),_.content.length!=0);)C=N.Pointer.StartOf(_),_=k.asOrNull(C.Resolve(),e.Container);this.state.currentPointer=C.copy(),this._profiler!=null&&this._profiler.Step(this.state.callStack);let P=C.Resolve(),O=this.PerformLogicAndFlowControl(P);if(this.state.currentPointer.isNull)return;O&&(v=!1);let F=k.asOrNull(P,l.ChoicePoint);if(F){let A=this.ProcessChoice(F);A&&this.state.generatedChoices.push(A),P=null,v=!1}if(P instanceof e.Container&&(v=!1),v){let A=k.asOrNull(P,h.VariablePointerValue);if(A&&A.contextIndex==-1){let W=this.state.callStack.ContextForVariableNamed(A.variableName);P=new h.VariablePointerValue(A.variableName,W)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(P):this.state.PushToOutputStream(P)}this.NextContent();let x=k.asOrNull(P,o.ControlCommand);x&&x.commandType==o.ControlCommand.CommandType.StartThread&&this.state.callStack.PushThread()}VisitContainer(v,C){(!v.countingAtStartOnly||C)&&(v.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(v),v.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(v))}VisitChangedContainersDueToDivert(){let v=this.state.previousPointer.copy(),C=this.state.currentPointer.copy();if(C.isNull||C.index==-1)return;if(this._prevContainers.length=0,!v.isNull){let F=v.Resolve(),x=k.asOrNull(F,e.Container)||k.asOrNull(v.container,e.Container);for(;x;)this._prevContainers.push(x),x=k.asOrNull(x.parent,e.Container)}let _=C.Resolve();if(_==null)return;let P=k.asOrNull(_.parent,e.Container),O=!0;for(;P&&(this._prevContainers.indexOf(P)<0||P.countingAtStartOnly);){let F=P.content.length>0&&_==P.content[0]&&O;F||(O=!1),this.VisitContainer(P,F),_=P,P=k.asOrNull(P.parent,e.Container)}}ProcessChoice(v){let C=!0;if(v.hasCondition){let F=this.state.PopEvaluationStack();this.IsTruthy(F)||(C=!1)}let _="",P="";if(v.hasChoiceOnlyContent&&(P=k.asOrThrows(this.state.PopEvaluationStack(),h.StringValue).value||""),v.hasStartContent&&(_=k.asOrThrows(this.state.PopEvaluationStack(),h.StringValue).value||""),v.onceOnly&&this.state.VisitCountForContainer(v.choiceTarget)>0&&(C=!1),!C)return null;let O=new a.Choice;return O.targetPath=v.pathOnChoice,O.sourcePath=v.path.toString(),O.isInvisibleDefault=v.isInvisibleDefault,O.threadAtGeneration=this.state.callStack.ForkThread(),O.text=(_+P).replace(/^[ \t]+|[ \t]+$/g,""),O}IsTruthy(v){let C=!1;if(v instanceof h.Value){let _=v;if(_ instanceof h.DivertTargetValue){let P=_;return this.Error("Shouldn't use a divert target (to "+P.targetPath+") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)"),!1}return _.isTruthy}return C}PerformLogicAndFlowControl(v){if(v==null)return!1;if(v instanceof u.Divert){let C=v;if(C.isConditional){let _=this.state.PopEvaluationStack();if(!this.IsTruthy(_))return!0}if(C.hasVariableTarget){let _=C.variableDivertName,P=this.state.variablesState.GetVariableWithName(_);if(P==null)this.Error("Tried to divert using a target from a variable that could not be found ("+_+")");else if(!(P instanceof h.DivertTargetValue)){let F=k.asOrNull(P,h.IntValue),x="Tried to divert to a target from a variable, but the variable ("+_+") didn't contain a divert target, it ";F instanceof h.IntValue&&F.value==0?x+="was empty/null (the value 0).":x+="contained '"+P+"'.",this.Error(x)}let O=k.asOrThrows(P,h.DivertTargetValue);this.state.divertedPointer=this.PointerAtPath(O.targetPath)}else{if(C.isExternal)return this.CallExternalFunction(C.targetPathString,C.externalArgs),!0;this.state.divertedPointer=C.targetPointer.copy()}return C.pushesToStack&&this.state.callStack.Push(C.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!C.isExternal&&(C&&C.debugMetadata&&C.debugMetadata.sourceName!=null?this.Error("Divert target doesn't exist: "+C.debugMetadata.sourceName):this.Error("Divert resolution failed: "+C)),!0}else if(v instanceof o.ControlCommand){let C=v;switch(C.commandType){case o.ControlCommand.CommandType.EvalStart:this.Assert(this.state.inExpressionEvaluation===!1,"Already in expression evaluation?"),this.state.inExpressionEvaluation=!0;break;case o.ControlCommand.CommandType.EvalEnd:this.Assert(this.state.inExpressionEvaluation===!0,"Not in expression evaluation mode"),this.state.inExpressionEvaluation=!1;break;case o.ControlCommand.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){let q=this.state.PopEvaluationStack();if(!(q instanceof c.Void)){let oe=new h.StringValue(q.toString());this.state.PushToOutputStream(oe)}}break;case o.ControlCommand.CommandType.NoOp:break;case o.ControlCommand.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case o.ControlCommand.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case o.ControlCommand.CommandType.PopFunction:case o.ControlCommand.CommandType.PopTunnel:let _=C.commandType==o.ControlCommand.CommandType.PopFunction?s.PushPopType.Function:s.PushPopType.Tunnel,P=null;if(_==s.PushPopType.Tunnel){let q=this.state.PopEvaluationStack();P=k.asOrNull(q,h.DivertTargetValue),P===null&&this.Assert(q instanceof c.Void,"Expected void if ->-> doesn't override target")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type!=_||!this.state.callStack.canPop){let q=new Map;q.set(s.PushPopType.Function,"function return statement (~ return)"),q.set(s.PushPopType.Tunnel,"tunnel onwards statement (->->)");let oe=q.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(oe="end of flow (-> END or choice)");let Fe="Found "+q.get(_)+", when expected "+oe;this.Error(Fe)}else this.state.PopCallStack(),P&&(this.state.divertedPointer=this.PointerAtPath(P.targetPath));break;case o.ControlCommand.CommandType.BeginString:this.state.PushToOutputStream(C),this.Assert(this.state.inExpressionEvaluation===!0,"Expected to be in an expression when evaluating a string"),this.state.inExpressionEvaluation=!1;break;case o.ControlCommand.CommandType.EndString:let O=[],F=0;for(let q=this.state.outputStream.length-1;q>=0;--q){let oe=this.state.outputStream[q];F++;let Fe=k.asOrNull(oe,o.ControlCommand);if(Fe&&Fe.commandType==o.ControlCommand.CommandType.BeginString)break;oe instanceof h.StringValue&&O.push(oe)}this.state.PopFromOutputStream(F),O=O.reverse();let x=new y.StringBuilder;for(let q of O)x.Append(q.toString());this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new h.StringValue(x.toString()));break;case o.ControlCommand.CommandType.ChoiceCount:let A=this.state.generatedChoices.length;this.state.PushEvaluationStack(new h.IntValue(A));break;case o.ControlCommand.CommandType.Turns:this.state.PushEvaluationStack(new h.IntValue(this.state.currentTurnIndex+1));break;case o.ControlCommand.CommandType.TurnsSince:case o.ControlCommand.CommandType.ReadCount:let W=this.state.PopEvaluationStack();if(!(W instanceof h.DivertTargetValue)){let q="";W instanceof h.IntValue&&(q=". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?"),this.Error("TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw "+W+q);break}let z=k.asOrThrows(W,h.DivertTargetValue),Q=k.asOrNull(this.ContentAtPath(z.targetPath).correctObj,e.Container),me;Q!=null?C.commandType==o.ControlCommand.CommandType.TurnsSince?me=this.state.TurnsSinceForContainer(Q):me=this.state.VisitCountForContainer(Q):(C.commandType==o.ControlCommand.CommandType.TurnsSince?me=-1:me=0,this.Warning("Failed to find container for "+C.toString()+" lookup at "+z.targetPath.toString())),this.state.PushEvaluationStack(new h.IntValue(me));break;case o.ControlCommand.CommandType.Random:{let q=k.asOrNull(this.state.PopEvaluationStack(),h.IntValue),oe=k.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(oe==null||!(oe instanceof h.IntValue))return this.Error("Invalid value for minimum parameter of RANDOM(min, max)");if(q==null||!(oe instanceof h.IntValue))return this.Error("Invalid value for maximum parameter of RANDOM(min, max)");if(q.value===null)return T.throwNullException("maxInt.value");if(oe.value===null)return T.throwNullException("minInt.value");let Fe=q.value-oe.value+1;(!isFinite(Fe)||Fe>Number.MAX_SAFE_INTEGER)&&(Fe=Number.MAX_SAFE_INTEGER,this.Error("RANDOM was called with a range that exceeds the size that ink numbers can use.")),Fe<=0&&this.Error("RANDOM was called with minimum as "+oe.value+" and maximum as "+q.value+". The maximum must be larger");let Ml=this.state.storySeed+this.state.previousRandom,zr=new g.PRNG(Ml).next(),$l=zr%Fe+oe.value;this.state.PushEvaluationStack(new h.IntValue($l)),this.state.previousRandom=zr;break}case o.ControlCommand.CommandType.SeedRandom:let ee=k.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(ee==null||!(ee instanceof h.IntValue))return this.Error("Invalid value passed to SEED_RANDOM");if(ee.value===null)return T.throwNullException("minInt.value");this.state.storySeed=ee.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new c.Void);break;case o.ControlCommand.CommandType.VisitIndex:let Qe=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new h.IntValue(Qe));break;case o.ControlCommand.CommandType.SequenceShuffleIndex:let gt=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new h.IntValue(gt));break;case o.ControlCommand.CommandType.StartThread:break;case o.ControlCommand.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=N.Pointer.Null);break;case o.ControlCommand.CommandType.End:this.state.ForceEnd();break;case o.ControlCommand.CommandType.ListFromInt:let xs=k.asOrNull(this.state.PopEvaluationStack(),h.IntValue),Vh=k.asOrThrows(this.state.PopEvaluationStack(),h.StringValue);if(xs===null)throw new f.StoryException("Passed non-integer when creating a list element from a numerical value.");let Ts=null;if(this.listDefinitions===null)return T.throwNullException("this.listDefinitions");let Wh=this.listDefinitions.TryListGetDefinition(Vh.value,null);if(Wh.exists){if(xs.value===null)return T.throwNullException("minInt.value");let q=Wh.result.TryGetItemWithValue(xs.value,L.InkListItem.Null);q.exists&&(Ts=new h.ListValue(q.result,xs.value))}else throw new f.StoryException("Failed to find LIST called "+Vh.value);Ts==null&&(Ts=new h.ListValue),this.state.PushEvaluationStack(Ts);break;case o.ControlCommand.CommandType.ListRange:let jh=k.asOrNull(this.state.PopEvaluationStack(),h.Value),Mh=k.asOrNull(this.state.PopEvaluationStack(),h.Value),jl=k.asOrNull(this.state.PopEvaluationStack(),h.ListValue);if(jl===null||Mh===null||jh===null)throw new f.StoryException("Expected list, minimum and maximum for LIST_RANGE");if(jl.value===null)return T.throwNullException("targetList.value");let Pm=jl.value.ListWithSubRange(Mh.valueObject,jh.valueObject);this.state.PushEvaluationStack(new h.ListValue(Pm));break;case o.ControlCommand.CommandType.ListRandom:{let q=this.state.PopEvaluationStack();if(q===null)throw new f.StoryException("Expected list for LIST_RANDOM");let oe=q.value,Fe=null;if(oe===null)throw T.throwNullException("list");if(oe.Count==0)Fe=new L.InkList;else{let Ml=this.state.storySeed+this.state.previousRandom,zr=new g.PRNG(Ml).next(),$l=zr%oe.Count,$h=oe.entries();for(let Gh=0;Gh<=$l-1;Gh++)$h.next();let Bh=$h.next().value,Ns={Key:L.InkListItem.fromSerializedKey(Bh[0]),Value:Bh[1]};if(Ns.Key.originName===null)return T.throwNullException("randomItem.Key.originName");Fe=new L.InkList(Ns.Key.originName,this),Fe.Add(Ns.Key,Ns.Value),this.state.previousRandom=zr}this.state.PushEvaluationStack(new h.ListValue(Fe));break}default:this.Error("unhandled ControlCommand: "+C);break}return!0}else if(v instanceof S.VariableAssignment){let C=v,_=this.state.PopEvaluationStack();return this.state.variablesState.Assign(C,_),!0}else if(v instanceof E.VariableReference){let C=v,_=null;if(C.pathForCount!=null){let P=C.containerForCount,O=this.state.VisitCountForContainer(P);_=new h.IntValue(O)}else _=this.state.variablesState.GetVariableWithName(C.name),_==null&&(this.Warning("Variable not found: '"+C.name+"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state."),_=new h.IntValue(0));return this.state.PushEvaluationStack(_),!0}else if(v instanceof d.NativeFunctionCall){let C=v,_=this.state.PopEvaluationStack(C.numberOfParameters),P=C.Call(_);return this.state.PushEvaluationStack(P),!0}return!1}ChoosePathString(v,C=!0,_=[]){if(this.IfAsyncWeCant("call ChoosePathString right now"),this.onChoosePathString!==null&&this.onChoosePathString(v,_),C)this.ResetCallstack();else if(this.state.callStack.currentElement.type==s.PushPopType.Function){let P="",O=this.state.callStack.currentElement.currentPointer.container;throw O!=null&&(P="("+O.path.toString()+") "),new Error("Story was running a function "+P+"when you called ChoosePathString("+v+`) - this is almost certainly not not what you want! Full stack trace: 
`+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(_),this.ChoosePath(new p.Path(v))}IfAsyncWeCant(v){if(this._asyncContinueActive)throw new Error("Can't "+v+". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.")}ChoosePath(v,C=!0){this.state.SetChosenPath(v,C),this.VisitChangedContainersDueToDivert()}ChooseChoiceIndex(v){v=v;let C=this.currentChoices;this.Assert(v>=0&&v<C.length,"choice out of range");let _=C[v];if(this.onMakeChoice!==null&&this.onMakeChoice(_),_.threadAtGeneration===null)return T.throwNullException("choiceToChoose.threadAtGeneration");if(_.targetPath===null)return T.throwNullException("choiceToChoose.targetPath");this.state.callStack.currentThread=_.threadAtGeneration,this.ChoosePath(_.targetPath)}HasFunction(v){try{return this.KnotContainerWithName(v)!=null}catch{return!1}}EvaluateFunction(v,C=[],_=!1){if(this.onEvaluateFunction!==null&&this.onEvaluateFunction(v,C),this.IfAsyncWeCant("evaluate a function"),v==null)throw new Error("Function is null");if(v==""||v.trim()=="")throw new Error("Function is empty or white space.");let P=this.KnotContainerWithName(v);if(P==null)throw new Error("Function doesn't exist: '"+v+"'");let O=[];O.push(...this.state.outputStream),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(P,C);let F=new y.StringBuilder;for(;this.canContinue;)F.Append(this.Continue());let x=F.toString();this._state.ResetOutput(O);let A=this.state.CompleteFunctionEvaluationFromGame();return this.onCompleteEvaluateFunction!=null&&this.onCompleteEvaluateFunction(v,C,x,A),_?{returned:A,output:x}:A}EvaluateExpression(v){let C=this.state.callStack.elements.length;this.state.callStack.Push(s.PushPopType.Tunnel),this._temporaryEvaluationContainer=v,this.state.GoToStart();let _=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>C&&this.state.PopCallStack(),this.state.evaluationStack.length>_?this.state.PopEvaluationStack():null}CallExternalFunction(v,C){if(v===null)return T.throwNullException("funcName");let _=this._externals.get(v),P=null,O=typeof _!="undefined";if(O&&!_.lookAheadSafe&&this._stateSnapshotAtLastNewline!==null){this._sawLookaheadUnsafeFunctionAfterNewline=!0;return}if(!O)if(this.allowExternalFunctionFallbacks){P=this.KnotContainerWithName(v),this.Assert(P!==null,"Trying to call EXTERNAL function '"+v+"' which has not been bound, and fallback ink function could not be found."),this.state.callStack.Push(s.PushPopType.Function,void 0,this.state.outputStream.length),this.state.divertedPointer=N.Pointer.StartOf(P);return}else this.Assert(!1,"Trying to call EXTERNAL function '"+v+"' which has not been bound (and ink fallbacks disabled).");let F=[];for(let W=0;W<C;++W){let Q=k.asOrThrows(this.state.PopEvaluationStack(),h.Value).valueObject;F.push(Q)}F.reverse();let x=_.function(F),A=null;x!=null?(A=h.Value.Create(x),this.Assert(A!==null,"Could not create ink value from returned object of type "+typeof x)):A=new c.Void,this.state.PushEvaluationStack(A)}BindExternalFunctionGeneral(v,C,_){this.IfAsyncWeCant("bind an external function"),this.Assert(!this._externals.has(v),"Function '"+v+"' has already been bound."),this._externals.set(v,{function:C,lookAheadSafe:_})}TryCoerce(v){return v}BindExternalFunction(v,C,_){this.Assert(C!=null,"Can't bind a null function"),this.BindExternalFunctionGeneral(v,P=>{this.Assert(P.length>=C.length,"External function expected "+C.length+" arguments");let O=[];for(let F=0,x=P.length;F<x;F++)O[F]=this.TryCoerce(P[F]);return C.apply(null,O)},_)}UnbindExternalFunction(v){this.IfAsyncWeCant("unbind an external a function"),this.Assert(this._externals.has(v),"Function '"+v+"' has not been bound."),this._externals.delete(v)}ValidateExternalBindings(){let v=null,C=null,_=arguments[1]||new Set;if(arguments[0]instanceof e.Container&&(v=arguments[0]),arguments[0]instanceof n.InkObject&&(C=arguments[0]),v===null&&C===null)if(this.ValidateExternalBindings(this._mainContentContainer,_),this._hasValidatedExternals=!0,_.size==0)this._hasValidatedExternals=!0;else{let P="Error: Missing function binding for external";P+=_.size>1?"s":"",P+=": '",P+=Array.from(_).join("', '"),P+="' ",P+=this.allowExternalFunctionFallbacks?", and no fallback ink function found.":" (ink fallbacks disabled)",this.Error(P)}else if(v!=null){for(let P of v.content){let O=P;(O==null||!O.hasValidName)&&this.ValidateExternalBindings(P,_)}for(let[,P]of v.namedContent)this.ValidateExternalBindings(k.asOrNull(P,n.InkObject),_)}else if(C!=null){let P=k.asOrNull(C,u.Divert);if(P&&P.isExternal){let O=P.targetPathString;if(O===null)return T.throwNullException("name");this._externals.has(O)||this.allowExternalFunctionFallbacks&&this.mainContentContainer.namedContent.has(O)||_.add(O)}}}ObserveVariable(v,C){if(this.IfAsyncWeCant("observe a new variable"),this._variableObservers===null&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(v))throw new Error("Cannot observe variable '"+v+"' because it wasn't declared in the ink story.");this._variableObservers.has(v)?this._variableObservers.get(v).push(C):this._variableObservers.set(v,[C])}ObserveVariables(v,C){for(let _=0,P=v.length;_<P;_++)this.ObserveVariable(v[_],C[_])}RemoveVariableObserver(v,C){if(this.IfAsyncWeCant("remove a variable observer"),this._variableObservers!==null){if(C!=null){if(this._variableObservers.has(C))if(v!=null){let _=this._variableObservers.get(C);_!=null&&(_.splice(_.indexOf(v),1),_.length===0&&this._variableObservers.delete(C))}else this._variableObservers.delete(C)}else if(v!=null){let _=this._variableObservers.keys();for(let P of _){let O=this._variableObservers.get(P);O!=null&&(O.splice(O.indexOf(v),1),O.length===0&&this._variableObservers.delete(P))}}}}VariableStateDidChangeEvent(v,C){if(this._variableObservers===null)return;let _=this._variableObservers.get(v);if(typeof _!="undefined"){if(!(C instanceof h.Value))throw new Error("Tried to get the value of a variable that isn't a standard type");let P=k.asOrThrows(C,h.Value);for(let O of _)O(v,P.valueObject)}}get globalTags(){return this.TagsAtStartOfFlowContainerWithPathString("")}TagsForContentAtPath(v){return this.TagsAtStartOfFlowContainerWithPathString(v)}TagsAtStartOfFlowContainerWithPathString(v){let C=new p.Path(v),_=this.ContentAtPath(C).container;if(_===null)return T.throwNullException("flowContainer");for(;;){let O=_.content[0];if(O instanceof e.Container)_=O;else break}let P=null;for(let O of _.content){let F=k.asOrNull(O,m.Tag);if(F)P==null&&(P=[]),P.push(F.text);else break}return P}BuildStringOfHierarchy(){let v=new y.StringBuilder;return this.mainContentContainer.BuildStringOfHierarchy(v,0,this.state.currentPointer.Resolve()),v.toString()}BuildStringOfContainer(v){let C=new y.StringBuilder;return v.BuildStringOfHierarchy(C,0,this.state.currentPointer.Resolve()),C.toString()}NextContent(){if(this.state.previousPointer=this.state.currentPointer.copy(),!this.state.divertedPointer.isNull&&(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=N.Pointer.Null,this.VisitChangedContainersDueToDivert(),!this.state.currentPointer.isNull))return;if(!this.IncrementContentPointer()){let C=!1;this.state.callStack.CanPop(s.PushPopType.Function)?(this.state.PopCallStack(s.PushPopType.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new c.Void),C=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),C=!0):this.state.TryExitFunctionEvaluationFromGame(),C&&!this.state.currentPointer.isNull&&this.NextContent()}}IncrementContentPointer(){let v=!0,C=this.state.callStack.currentElement.currentPointer.copy();if(C.index++,C.container===null)return T.throwNullException("pointer.container");for(;C.index>=C.container.content.length;){v=!1;let _=k.asOrNull(C.container.parent,e.Container);if(!(_ instanceof e.Container))break;let P=_.content.indexOf(C.container);if(P==-1)break;if(C=new N.Pointer(_,P),C.index++,v=!0,C.container===null)return T.throwNullException("pointer.container")}return v||(C=N.Pointer.Null),this.state.callStack.currentElement.currentPointer=C.copy(),v}TryFollowDefaultInvisibleChoice(){let v=this._state.currentChoices,C=v.filter(P=>P.isInvisibleDefault);if(C.length==0||v.length>C.length)return!1;let _=C[0];return _.targetPath===null?T.throwNullException("choice.targetPath"):_.threadAtGeneration===null?T.throwNullException("choice.threadAtGeneration"):(this.state.callStack.currentThread=_.threadAtGeneration,this._stateSnapshotAtLastNewline!==null&&(this.state.callStack.currentThread=this.state.callStack.ForkThread()),this.ChoosePath(_.targetPath,!1),!0)}NextSequenceShuffleIndex(){let v=k.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(!(v instanceof h.IntValue))return this.Error("expected number of elements in sequence for shuffle index"),0;let C=this.state.currentPointer.container;if(C===null)return T.throwNullException("seqContainer");if(v.value===null)return T.throwNullException("numElementsIntVal.value");let _=v.value,O=k.asOrThrows(this.state.PopEvaluationStack(),h.IntValue).value;if(O===null)return T.throwNullException("seqCount");let F=O/_,x=O%_,A=C.path.toString(),W=0;for(let ee=0,Qe=A.length;ee<Qe;ee++)W+=A.charCodeAt(ee)||0;let z=W+F+this.state.storySeed,Q=new g.PRNG(Math.floor(z)),me=[];for(let ee=0;ee<_;++ee)me.push(ee);for(let ee=0;ee<=x;++ee){let Qe=Q.next()%me.length,gt=me[Qe];if(me.splice(Qe,1),ee==x)return gt}throw new Error("Should never reach here")}Error(v,C=!1){let _=new f.StoryException(v);throw _.useEndLineNumber=C,_}Warning(v){this.AddError(v,!0)}AddError(v,C=!1,_=!1){let P=this.currentDebugMetadata,O=C?"WARNING":"ERROR";if(P!=null){let F=_?P.endLineNumber:P.startLineNumber;v="RUNTIME "+O+": '"+P.fileName+"' line "+F+": "+v}else this.state.currentPointer.isNull?v="RUNTIME "+O+": "+v:v="RUNTIME "+O+": ("+this.state.currentPointer+"): "+v;this.state.AddError(v,C),C||this.state.ForceEnd()}Assert(v,C=null){if(v==!1)throw C==null&&(C="Story assert"),new Error(C+" "+this.currentDebugMetadata)}get currentDebugMetadata(){let v,C=this.state.currentPointer;if(!C.isNull&&C.Resolve()!==null&&(v=C.Resolve().debugMetadata,v!==null))return v;for(let _=this.state.callStack.elements.length-1;_>=0;--_)if(C=this.state.callStack.elements[_].currentPointer,!C.isNull&&C.Resolve()!==null&&(v=C.Resolve().debugMetadata,v!==null))return v;for(let _=this.state.outputStream.length-1;_>=0;--_)if(v=this.state.outputStream[_].debugMetadata,v!==null)return v;return null}get mainContentContainer(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}t.Story=G,G.inkVersionCurrent=20,function(Je){(function(v){v[v.NoChange=0]="NoChange",v[v.ExtendedBeyondNewline=1]="ExtendedBeyondNewline",v[v.NewlineRemoved=2]="NewlineRemoved"})(Je.OutputStateChange||(Je.OutputStateChange={}))}(G=t.Story||(t.Story={}))})(_s);Object.defineProperty(bl,"__esModule",{value:!0});bl.Story=void 0;const eE=Rr,tE=Wr,io=he,so=Ve,di=hl,oo=ut,rd=jr,nE=Ss,rE=Gr,iE=ws,sE=_s,nr=$t,oE=Bt,lE=Tt,pi=B,aE=Un,uE=zn,hE=Ut;class Dl extends oo.FlowBase{constructor(e,n=!1){super(null,e,null,!1,n);this._errorHandler=null,this._hadError=!1,this._hadWarning=!1,this._dontFlattenContainers=new Set,this._listDefs=new Map,this.constants=new Map,this.externals=new Map,this.countAllVisits=!1,this.ExportRuntime=(r=null)=>{var i,o;this._errorHandler=r,this.constants=new Map;for(const h of this.FindAll(tE.ConstantDeclaration)()){const p=this.constants.get(h.constantName);if(p&&!p.Equals(h.expression)){const c=`CONST '${h.constantName}' has been redefined with a different value. Multiple definitions of the same CONST are valid so long as they contain the same value. Initial definition was on ${p.debugMetadata}.`;this.Error(c,h,!1)}this.constants.set(h.constantName,h.expression)}this._listDefs=new Map;for(const h of this.FindAll(rE.ListDefinition)())((i=h.identifier)===null||i===void 0?void 0:i.name)&&this._listDefs.set((o=h.identifier)===null||o===void 0?void 0:o.name,h);this.externals=new Map,this.ResolveWeavePointNaming();const s=this.runtimeObject,l=new io.Container;l.AddContent(so.ControlCommand.EvalStart());const a=[];for(const[h,p]of this.variableDeclarations)if(p.isGlobalDeclaration){if(p.listDefinition)this._listDefs.set(h,p.listDefinition),l.AddContent(p.listDefinition.runtimeObject),a.push(p.listDefinition.runtimeListDefinition);else{if(!p.expression)throw new Error;p.expression.GenerateIntoContainer(l)}const c=new lE.VariableAssignment(h,!0);c.isGlobal=!0,l.AddContent(c)}l.AddContent(so.ControlCommand.EvalEnd()),l.AddContent(so.ControlCommand.End()),this.variableDeclarations.size>0&&(l.name="global decl",s.AddToNamedContentOnly(l)),s.AddContent(so.ControlCommand.Done());const u=new sE.Story(s,a);return this.runtimeObject=u,this.hadError||(this.FlattenContainersIn(s),this.ResolveReferences(this),this.hadError)?null:(u.ResetState(),u)},this.ResolveList=r=>{let i=this._listDefs.get(r);return i||null},this.ResolveListItem=(r,i,o=null)=>{let s=null;if(r)return(s=this._listDefs.get(r))?s.ItemNamed(i):null;{let l=null,a=null;for(const[,u]of this._listDefs.entries()){const h=u.ItemNamed(i);h&&(l?this.Error(`Ambiguous item name '${i}' found in multiple sets, including ${a.identifier} and ${u.identifier}`,o,!1):(l=h,a=u))}return l}},this.FlattenContainersIn=r=>{const i=new Set;if(r.content)for(const o of r.content){const s=pi.asOrNull(o,io.Container);s&&i.add(s)}if(r.namedContent)for(const[,o]of r.namedContent){const s=pi.asOrNull(o,io.Container);s&&i.add(s)}for(const o of i)this.TryFlattenContainer(o),this.FlattenContainersIn(o)},this.TryFlattenContainer=r=>{if(r.namedContent&&r.namedContent.size>0||r.hasValidName||this._dontFlattenContainers.has(r))return;const i=pi.asOrNull(r.parent,io.Container);if(i){let o=i.content.indexOf(r);i.content.splice(o,1);const s=r.ownDebugMetadata;if(r.content)for(const l of r.content)l.parent=null,s!==null&&l.ownDebugMetadata===null&&(l.debugMetadata=s),i.InsertContent(l,o),o+=1}},this.Error=(r,i,o)=>{let s=o?di.ErrorType.Warning:di.ErrorType.Error,l="";if(i instanceof eE.AuthorWarning?(l+="TODO: ",s=di.ErrorType.Author):o?l+="WARNING: ":l+="ERROR: ",i&&i.debugMetadata!==null&&i.debugMetadata.startLineNumber>=1&&(i.debugMetadata.fileName!=null&&(l+=`'${i.debugMetadata.fileName}' `),l+=`line ${i.debugMetadata.startLineNumber}: `),l+=r,r=l,this._errorHandler!==null)this._errorHandler(r,s);else throw new Error(r);this._hadError=s===di.ErrorType.Error,this._hadWarning=s===di.ErrorType.Warning},this.ResetError=()=>{this._hadError=!1,this._hadWarning=!1},this.IsExternal=r=>this.externals.has(r),this.AddExternal=r=>{this.externals.has(r.name)?this.Error(`Duplicate EXTERNAL definition of '${r.name}'`,r,!1):r.name&&this.externals.set(r.name,r)},this.DontFlattenContainer=r=>{this._dontFlattenContainers.add(r)},this.NameConflictError=(r,i,o,s)=>{r.Error(`${s} '${i}': name has already been used for a ${o.typeName.toLowerCase()} on ${o.debugMetadata}`)},this.CheckForNamingCollisions=(r,i,o,s="")=>{var l;const a=s||r.typeName;if(Dl.IsReservedKeyword(i==null?void 0:i.name)){r.Error(`'${i}' cannot be used for the name of a ${a.toLowerCase()} because it's a reserved keyword`);return}else if(uE.FunctionCall.IsBuiltIn((i==null?void 0:i.name)||"")){r.Error(`'${i}' cannot be used for the name of a ${a.toLowerCase()} because it's a built in function`);return}const u=this.ContentWithNameAtLevel((i==null?void 0:i.name)||"",rd.FlowLevel.Knot),h=pi.asOrNull(u,oo.FlowBase);if(h&&(h!==r||o===nr.SymbolType.Arg)){this.NameConflictError(r,(i==null?void 0:i.name)||"",h,a);return}if(o<nr.SymbolType.List)return;for(const[S,E]of this._listDefs)if((i==null?void 0:i.name)===S&&r!==E&&E.variableAssignment!==r&&this.NameConflictError(r,i==null?void 0:i.name,E,a),!(r instanceof iE.ListElementDefinition))for(const d of E.itemDefinitions)(i==null?void 0:i.name)===d.name&&this.NameConflictError(r,(i==null?void 0:i.name)||"",d,a);if(o<=nr.SymbolType.Var)return;const p=(i==null?void 0:i.name)&&this.variableDeclarations.get(i==null?void 0:i.name)||null;if(p&&p!==r&&p.isGlobalDeclaration&&p.listDefinition==null&&this.NameConflictError(r,(i==null?void 0:i.name)||"",p,a),o<nr.SymbolType.SubFlowAndWeave)return;const m=new hE.Path(i).ResolveFromContext(r);if(m&&m!==r){this.NameConflictError(r,(i==null?void 0:i.name)||"",m,a);return}if(!(o<nr.SymbolType.Arg)&&o!==nr.SymbolType.Arg){let S=pi.asOrNull(r,oo.FlowBase);if(S||(S=aE.ClosestFlowBase(r)),S&&S.hasParameters&&S.args){for(const E of S.args)if(((l=E.identifier)===null||l===void 0?void 0:l.name)===(i==null?void 0:i.name)){r.Error(`${a} '${i}': name has already been used for a argument to ${S.identifier} on ${S.debugMetadata}`);return}}}}}get flowLevel(){return rd.FlowLevel.Story}get hadError(){return this._hadError}get hadWarning(){return this._hadWarning}get typeName(){return"Story"}PreProcessTopLevelObjects(e){super.PreProcessTopLevelObjects(e);const n=[];for(let r of e)if(r instanceof nE.IncludedFile){const i=r,o=e.indexOf(r);if(e.splice(o,1),i.includedStory){const s=[],l=i.includedStory;if(l.content!=null){for(const a of l.content)a instanceof oo.FlowBase?n.push(a):s.push(a);s.push(new oE.Text(`
`)),e.splice(o,0,...s)}}continue}e.splice(0,0,...n)}}bl.Story=Dl;Dl.IsReservedKeyword=t=>{switch(t){case"true":case"false":case"not":case"return":case"else":case"VAR":case"CONST":case"temp":case"LIST":case"function":return!0}return!1};var Vl={};Object.defineProperty(Vl,"__esModule",{value:!0});Vl.StringExpression=void 0;const id=Ve,cE=Ge,fE=Bt,dE=B;class Dh extends cE.Expression{constructor(e){super();this.GenerateIntoContainer=n=>{n.AddContent(id.ControlCommand.BeginString());for(const r of this.content)n.AddContent(r.runtimeObject);n.AddContent(id.ControlCommand.EndString())},this.toString=()=>{let n="";for(const r of this.content)n+=r;return n},this.AddContent(e)}get isSingleString(){return!(this.content.length!==1||!(this.content[0]instanceof fE.Text))}get typeName(){return"String"}Equals(e){const n=dE.asOrNull(e,Dh);if(n===null||!this.isSingleString||!n.isSingleString)return!1;const r=this.toString(),i=n.toString();return r===i}}Vl.StringExpression=Dh;var Wl={};Object.defineProperty(Wl,"__esModule",{value:!0});Wl.Tag=void 0;const pE=Cs;class mE extends pE.Wrap{constructor(e){super(e)}get typeName(){return"Tag"}}Wl.Tag=mE;Object.defineProperty(cl,"__esModule",{value:!0});cl.InkParser=void 0;const gE=fl,vE=Rr,yE=us,zt=pl,_e=jn,CE=Mn,SE=ml,wE=Vr,mi=fs,et=Br,_E=Wr,sd=wm,EE=Sl,En=Gn,Ra=Cn,PE=Ge,OE=wl,od=_l,lo=zn,xE=Mr,TE=El,NE=Ur,ao=Pl,ld=Ss,bE=Ol,IE=xl,ad=Tl,kE=Gr,AE=ws,FE=ps,ud=Z,RE=Ut,hd=ds,cd=ms,ve=kh,Re=_m,LE=Nl,fd=bl,gi=Vl,It=bh,DE=Wl,VE=Hn,kt=Bt,dd=gs,La=vs,Da=Sn,WE=cs,Jt=B,vi=$r,rr=Lr,pd=hl;class ne extends It.StringParser{constructor(e,n=null,r=null,i=null,o=null){super(e);if(this.ParseStory=()=>{const s=this.StatementsAtLevel(Re.StatementLevel.Top);return new fd.Story(s,this._rootParser!==this)},this.SeparatedList=(s,l)=>{const a=this.Parse(s);if(a===null)return null;const u=[];u.push(a);do{const h=this.BeginRule();if(l()===null){this.FailRule(h);break}const c=this.Parse(s);if(c===null){this.FailRule(h);break}this.SucceedRule(h),u.push(c)}while(!0);return u},this.CreateDebugMetadata=(s,l)=>{const a=new EE.DebugMetadata;return a.startLineNumber=((s==null?void 0:s.lineIndex)||0)+1,a.endLineNumber=l.lineIndex+1,a.startCharacterNumber=((s==null?void 0:s.characterInLineIndex)||0)+1,a.endCharacterNumber=l.characterInLineIndex+1,a.fileName=this._filename,a},this.RuleDidSucceed=(s,l,a)=>{const u=Jt.asOrNull(s,ud.ParsedObject);u&&(u.debugMetadata=this.CreateDebugMetadata(l,a));const h=Array.isArray(s)?s:null;if(h!==null)for(const c of h)!Jt.asOrNull(c,ud.ParsedObject)||c.hasOwnDebugMetadata||(c.debugMetadata=this.CreateDebugMetadata(l,a));const p=Jt.asOrNull(s,vi.Identifier);p!=null&&(p.debugMetadata=this.CreateDebugMetadata(l,a))},this.OnStringParserError=(s,l,a=0,u=!1)=>{let p=u?"WARNING:":"ERROR:";if(this._filename!==null&&(p+=` '${this._filename}'`),p+=` line ${a+1}: ${s}`,this._externalErrorHandler!==null)this._externalErrorHandler(p,u?pd.ErrorType.Warning:pd.ErrorType.Error);else throw new Error(p)},this.AuthorWarning=()=>{this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);if(s===null||s.name!=="TODO")return null;this.Whitespace(),this.ParseString(":"),this.Whitespace();const l=this.ParseUntilCharactersFromString(`
\r`);return l?new vE.AuthorWarning(l):null},this.ExtendIdentifierCharacterRanges=s=>{const l=ne.ListAllCharacterRanges();for(const a of l)s.AddCharacters(a.ToCharacterSet())},this._parsingChoice=!1,this.Choice=()=>{let s=!0,l=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("*"));if(!l){if(l=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("+")),l===null)return null;s=!1}const a=this.Parse(this.BracketedName);this.Whitespace();const u=this.Parse(this.ChoiceCondition);if(this.Whitespace(),this._parsingChoice)throw new Error("Already parsing a choice - shouldn't have nested choices");this._parsingChoice=!0;let h=null;const p=this.Parse(this.MixedTextAndLogic);p&&(h=new et.ContentList(p));let c=null,m=null;const S=this.ParseString("[")!==null;if(S){const y=this.Parse(this.MixedTextAndLogic);y!==null&&(c=new et.ContentList(y)),this.Expect(this.String("]"),"closing ']' for weave-style option");let w=this.Parse(this.MixedTextAndLogic);w!==null&&(m=new et.ContentList(w))}this.Whitespace();const E=this.Parse(this.MultiDivert);this._parsingChoice=!1,this.Whitespace();const d=!h&&!m&&!c;d&&E===null&&this.Warning("Choice is completely empty. Interpretting as a default fallback choice. Add a divert arrow to remove this warning: * ->"),!h&&S&&!c&&this.Warning("Blank choice - if you intended a default fallback choice, use the `* ->` syntax"),m||(m=new et.ContentList);const f=this.Parse(this.Tags);if(f!==null&&m.AddContent(f),E!==null)for(const y of E){const w=Jt.asOrNull(y,En.Divert);w&&w.isEmpty||m.AddContent(y)}m.AddContent(new kt.Text(`
`));const g=new CE.Choice(h,c,m);return a&&(g.identifier=a),g.indentationDepth=l.length,g.hasWeaveStyleInlineBrackets=S,g.condition=u,g.onceOnly=s,g.isInvisibleDefault=d,g},this.ChoiceCondition=()=>{const s=this.Interleave(this.ChoiceSingleCondition,this.ChoiceConditionsSpace);return s===null?null:s.length===1?s[0]:new FE.MultipleConditionExpression(s)},this.ChoiceConditionsSpace=()=>(this.Newline(),this.Whitespace(),It.ParseSuccess),this.ChoiceSingleCondition=()=>{if(this.ParseString("{")===null)return null;const s=this.Expect(this.Expression,"choice condition inside { }");return this.DisallowIncrement(s),this.Expect(this.String("}"),"closing '}' for choice condition"),s},this.Gather=()=>{const s=this.Parse(this.GatherDashes);if(s===null)return null;const l=Number(s),a=this.Parse(this.BracketedName),u=new xE.Gather(a,l);return this.Newline(),u},this.GatherDashes=()=>{this.Whitespace();let s=0;for(;this.ParseDashNotArrow()!==null;)s+=1,this.Whitespace();return s===0?null:s},this.ParseDashNotArrow=()=>{const s=this.BeginRule();return this.ParseString("->")===null&&this.ParseSingleCharacter()==="-"?this.SucceedRule(s):this.FailRule(s)},this.BracketedName=()=>{if(this.ParseString("(")===null)return null;this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);return s===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing ')' for bracketed name"),s)},this.InnerConditionalContent=s=>{if(s===void 0){const p=this.Parse(this.ConditionExpression),c=this.Parse(()=>this.InnerConditionalContent(p));return c===null?null:c}let l;const a=s!==null,u=this.Parse(this.Newline)===null;if(u&&!a)return null;if(u)l=this.InlineConditionalBranches();else{if(l=this.MultilineConditionalBranches(),l===null){if(s){let p=this.StatementsAtLevel(Re.StatementLevel.InnerBlock);if(p!==null){l=[new mi.ConditionalSingleBranch(p)];const m=this.Parse(this.SingleMultilineCondition);m&&(m.isElse||(this.ErrorWithParsedObject("Expected an '- else:' clause here rather than an extra condition",m),m.isElse=!0),l.push(m))}}if(l===null)return null}else if(l.length===1&&l[0].isElse&&s){const p=new mi.ConditionalSingleBranch(null);p.isTrueBranch=!0,l.unshift(p)}if(s){let p=!1;for(let c=0;c<l.length;++c){const m=l[c],S=c===l.length-1;m.ownExpression?(m.matchingEquality=!0,p=!0):p&&S?(m.matchingEquality=!0,m.isElse=!0):!S&&l.length>2?this.ErrorWithParsedObject("Only final branch can be an 'else'. Did you miss a ':'?",m):c===0?m.isTrueBranch=!0:m.isElse=!0}}else{for(let p=0;p<l.length;++p){const c=l[p],m=p===l.length-1;if(c.ownExpression===null)if(m)c.isElse=!0;else if(c.isElse){const S=l[l.length-1];S.isElse?this.ErrorWithParsedObject("Multiple 'else' cases. Can have a maximum of one, at the end.",S):this.ErrorWithParsedObject("'else' case in conditional should always be the final one",c)}else this.ErrorWithParsedObject("Branch doesn't have condition. Are you missing a ':'? ",c)}l.length===1&&l[0].ownExpression===null&&this.ErrorWithParsedObject("Condition block with no conditions",l[0])}}if(l===null)return null;for(const p of l)p.isInline=u;return new wE.Conditional(s,l)},this.InlineConditionalBranches=()=>{const s=this.Interleave(this.MixedTextAndLogic,this.Exclude(this.String("|")),null,!1);if(s===null||s.length===0)return null;const l=[];if(s.length>2)this.Error("Expected one or two alternatives separated by '|' in inline conditional");else{const a=new mi.ConditionalSingleBranch(s[0]);if(a.isTrueBranch=!0,l.push(a),s.length>1){const u=new mi.ConditionalSingleBranch(s[1]);u.isElse=!0,l.push(u)}}return l},this.MultilineConditionalBranches=()=>{this.MultilineWhitespace();const s=this.OneOrMore(this.SingleMultilineCondition);return s===null?null:(this.MultilineWhitespace(),s)},this.SingleMultilineCondition=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();let s=null;const l=this.Parse(this.ElseExpression)!==null;l||(s=this.Parse(this.ConditionExpression));let a=this.StatementsAtLevel(Re.StatementLevel.InnerBlock);s===null&&a===null&&(this.Error("expected content for the conditional branch following '-'"),a=[new kt.Text("")]),this.MultilineWhitespace();const u=new mi.ConditionalSingleBranch(a);return u.ownExpression=s,u.isElse=l,u},this.ConditionExpression=()=>{const s=this.Parse(this.Expression);return s===null||(this.DisallowIncrement(s),this.Whitespace(),this.ParseString(":")===null)?null:s},this.ElseExpression=()=>this.ParseString("else")===null||(this.Whitespace(),this.ParseString(":")===null)?null:It.ParseSuccess,this._nonTextPauseCharacters=null,this._nonTextEndCharacters=null,this._notTextEndCharactersChoice=null,this._notTextEndCharactersString=null,this.TrimEndWhitespace=(s,l)=>{if(s.length>0){const a=s.length-1,u=s[a];if(u instanceof kt.Text){const h=u;h.text=h.text.replace(new RegExp(/[ \t]+$/g),""),l?h.text+=" ":h.text.length===0&&(s.splice(a,1),this.TrimEndWhitespace(s,!1))}}},this.LineOfMixedTextAndLogic=()=>{this.Parse(this.Whitespace);let s=this.Parse(this.MixedTextAndLogic),l=!1;const a=this.Parse(this.Tags);if(a)if(!s)s=a,l=!0;else for(const p of a)s.push(p);if(!s||!s.length)return null;const u=s[0];return u&&u.text&&u.text.startsWith("return")&&this.Warning("Do you need a '~' before 'return'? If not, perhaps use a glue: <> (since it's lowercase) or rewrite somehow?"),s.length===0?null:(s[s.length-1]instanceof En.Divert||this.TrimEndWhitespace(s,!1),l||s.push(new kt.Text(`
`)),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),s)},this.MixedTextAndLogic=()=>{this.ParseObject(this.Spaced(this.String("~")))!==null&&this.Error("You shouldn't use a '~' here - tildas are for logic that's on its own line. To do inline logic, use { curly braces } instead");let l=this.Interleave(this.Optional(this.ContentText),this.Optional(this.InlineLogicOrGlue));if(!this._parsingChoice){const a=this.Parse(this.MultiDivert);a!==null&&(l===null&&(l=[]),this.TrimEndWhitespace(l,!0),l.push(...a))}return l||null},this.ContentText=()=>this.ContentTextAllowingEscapeChar(),this.ContentTextAllowingEscapeChar=()=>{let s=null;do{let l=this.Parse(this.ContentTextNoEscape);const a=this.ParseString("\\")!==null;if(a||l!==null)s===null&&(s=""),l!==null&&(s+=String(l)),a&&(s+=this.ParseSingleCharacter());else break}while(!0);return s!==null?new kt.Text(s):null},this.ContentTextNoEscape=()=>{this._nonTextPauseCharacters===null&&(this._nonTextPauseCharacters=new _e.CharacterSet("-<")),this._nonTextEndCharacters===null&&(this._nonTextEndCharacters=new _e.CharacterSet(`{}|
\r\\#`),this._notTextEndCharactersChoice=new _e.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersChoice.AddCharacters("[]"),this._notTextEndCharactersString=new _e.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersString.AddCharacters('"'));const s=()=>this.OneOf([this.ParseDivertArrow,this.ParseThreadArrow,this.EndOfLine,this.Glue]);let l=null;this.parsingStringExpression?l=this._notTextEndCharactersString:this._parsingChoice?l=this._notTextEndCharactersChoice:l=this._nonTextEndCharacters;const a=this.ParseUntil(s,this._nonTextPauseCharacters,l);return a!==null?a:null},this.MultiDivert=()=>{this.Whitespace();let s=[];const l=this.Parse(this.StartThread);if(l)return s=[l],s;const a=this.Interleave(this.ParseDivertArrowOrTunnelOnwards,this.DivertIdentifierWithArguments);if(!a)return null;s=[];for(let u=0;u<a.length;++u)if(u%2===0){if(a[u]==="->->"){u===0||u===a.length-1||u===a.length-2||this.Error("Tunnel onwards '->->' must only come at the begining or the start of a divert");const c=new dd.TunnelOnwards;if(u<a.length-1){const m=Jt.asOrNull(a[u+1],En.Divert);c.divertAfter=m}s.push(c);break}}else{const p=a[u];u<a.length-1&&(p.isTunnel=!0),s.push(p)}if(s.length===0&&a.length===1){const u=new En.Divert(null);u.isEmpty=!0,s.push(u),this._parsingChoice||this.Error("Empty diverts (->) are only valid on choices")}return s},this.StartThread=()=>{if(this.Whitespace(),this.ParseThreadArrow()===null)return null;this.Whitespace();const s=this.Expect(this.DivertIdentifierWithArguments,"target for new thread",()=>new En.Divert(null));return s.isThread=!0,s},this.DivertIdentifierWithArguments=()=>{this.Whitespace();const s=this.Parse(this.DotSeparatedDivertPathComponents);if(!s)return null;this.Whitespace();const l=this.Parse(this.ExpressionFunctionCallArguments);this.Whitespace();const a=new RE.Path(s);return new En.Divert(a,l)},this.SingleDivert=()=>{const s=this.Parse(this.MultiDivert);if(!s||s.length!==1||s[0]instanceof dd.TunnelOnwards)return null;const a=s[0];return a.isTunnel?null:a},this.DotSeparatedDivertPathComponents=()=>this.Interleave(this.Spaced(this.IdentifierWithMetadata),this.Exclude(this.String("."))),this.ParseDivertArrowOrTunnelOnwards=()=>{let s=0;for(;this.ParseString("->")!==null;)s+=1;return s===0?null:s===1?"->":(s===2||this.Error("Unexpected number of arrows in divert. Should only have '->' or '->->'"),"->->")},this.ParseDivertArrow=()=>this.ParseString("->"),this.ParseThreadArrow=()=>this.ParseString("<-"),this._binaryOperators=[],this._maxBinaryOpLength=0,this.TempDeclarationOrAssignment=()=>{this.Whitespace();const s=this.ParseTempKeyword();this.Whitespace();let l=null;if(s?l=this.Expect(this.IdentifierWithMetadata,"variable name"):l=this.Parse(this.IdentifierWithMetadata),l===null)return null;this.Whitespace();const a=this.ParseString("+")!==null,u=this.ParseString("-")!==null;if(a&&u&&this.Error("Unexpected sequence '+-'"),this.ParseString("=")===null)return s&&this.Error("Expected '='"),null;const h=this.Expect(this.Expression,"value expression to be assigned");return a||u?new ao.IncDecExpression(l,h,a):new La.VariableAssignment({variableIdentifier:l,assignedExpression:h,isTemporaryNewDeclaration:s})},this.DisallowIncrement=s=>{s instanceof ao.IncDecExpression&&this.Error("Can't use increment/decrement here. It can only be used on a ~ line")},this.ParseTempKeyword=()=>{const s=this.BeginRule();return this.Parse(this.Identifier)==="temp"?(this.SucceedRule(s),!0):(this.FailRule(s),!1)},this.ReturnStatement=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="return")return null;this.Whitespace();const l=this.Parse(this.Expression);return new hd.ReturnType(l)},this.Expression=(s=0)=>{this.Whitespace();let l=this.ExpressionUnary();if(l===null)return null;for(this.Whitespace();;){const a=this.BeginRule(),u=this.ParseInfixOperator();if(u!==null&&u.precedence>s){const h=`right side of '${u.type}' expression`,p=this.Expect(()=>this.ExpressionInfixRight(l,u),h);if(p===null)return this.FailRule(a),null;l=this.SucceedRule(a,p);continue}this.FailRule(a);break}return this.Whitespace(),l},this.ExpressionUnary=()=>{const s=this.Parse(this.ExpressionDivertTarget);if(s!==null)return s;let l=this.OneOf([this.String("-"),this.String("!")]);l===null&&(l=this.Parse(this.ExpressionNot)),this.Whitespace();let a=this.OneOf([this.ExpressionList,this.ExpressionParen,this.ExpressionFunctionCall,this.ExpressionVariableName,this.ExpressionLiteral]);if(a===null&&l!==null&&(a=this.ExpressionUnary()),a===null)return null;l!==null&&(a=WE.UnaryExpression.WithInner(a,l)),this.Whitespace();const u=this.OneOf([this.String("++"),this.String("--")]);if(u!==null){const h=u==="++";if(!(a instanceof Da.VariableReference))this.Error(`can only increment and decrement variables, but saw '${a}'.`);else{const p=a;a=new ao.IncDecExpression(p.identifier,h)}}return a},this.ExpressionNot=()=>{const s=this.Identifier();return s==="not"?s:null},this.ExpressionLiteral=()=>this.OneOf([this.ExpressionFloat,this.ExpressionInt,this.ExpressionBool,this.ExpressionString]),this.ExpressionDivertTarget=()=>{this.Whitespace();const s=this.Parse(this.SingleDivert);return!s||s&&s.isThread?null:(this.Whitespace(),new Ra.DivertTarget(s))},this.ExpressionInt=()=>{const s=this.ParseInt();return s===null?null:new rr.NumberExpression(s,"int")},this.ExpressionFloat=()=>{const s=this.ParseFloat();return s===null?null:new rr.NumberExpression(s,"float")},this.ExpressionString=()=>{if(this.ParseString('"')===null)return null;this.parsingStringExpression=!0;let l=this.Parse(this.MixedTextAndLogic);return this.Expect(this.String('"'),"close quote for string expression"),this.parsingStringExpression=!1,l===null?l=[new kt.Text("")]:l.find(a=>a instanceof En.Divert)&&this.Error("String expressions cannot contain diverts (->)"),new gi.StringExpression(l)},this.ExpressionBool=()=>{const s=this.Parse(this.Identifier);return s==="true"?new rr.NumberExpression(!0,"bool"):s==="false"?new rr.NumberExpression(!1,"bool"):null},this.ExpressionFunctionCall=()=>{const s=this.Parse(this.IdentifierWithMetadata);if(s===null)return null;this.Whitespace();const l=this.Parse(this.ExpressionFunctionCallArguments);return l===null?null:new lo.FunctionCall(s,l)},this.ExpressionFunctionCallArguments=()=>{if(this.ParseString("(")===null)return null;const s=this.Exclude(this.String(","));let l=this.Interleave(this.Expression,s);return l===null&&(l=[]),this.Whitespace(),this.Expect(this.String(")"),"closing ')' for function call"),l},this.ExpressionVariableName=()=>{const s=this.Interleave(this.IdentifierWithMetadata,this.Exclude(this.Spaced(this.String("."))));return s===null||fd.Story.IsReservedKeyword(s[0].name)?null:new Da.VariableReference(s)},this.ExpressionParen=()=>{if(this.ParseString("(")===null)return null;const s=this.Parse(this.Expression);return s===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing parenthesis ')' for expression"),s)},this.ExpressionInfixRight=(s,l)=>{if(!s)return null;this.Whitespace();const a=this.Parse(()=>this.Expression(l.precedence));return a?new yE.BinaryExpression(s,a,l.type):null},this.ParseInfixOperator=()=>{for(const s of this._binaryOperators){const l=this.BeginRule();if(this.ParseString(s.type)!==null){if(s.requireWhitespace&&this.Whitespace()===null){this.FailRule(l);continue}return this.SucceedRule(l,s)}this.FailRule(l)}return null},this.ExpressionList=()=>{if(this.Whitespace(),this.ParseString("(")===null)return null;this.Whitespace();const s=this.SeparatedList(this.ListMember,this.Spaced(this.String(",")));return this.Whitespace(),this.ParseString(")")===null?null:new ad.List(s)},this.ListMember=()=>{this.Whitespace();let s=this.Parse(this.IdentifierWithMetadata);if(s===null)return null;if(this.ParseString(".")!==null){const a=this.Expect(this.IdentifierWithMetadata,`element name within the set ${s}`);s.name+=`.${a==null?void 0:a.name}`}return this.Whitespace(),s},this.RegisterExpressionOperators=()=>{this.RegisterBinaryOperator("&&",1),this.RegisterBinaryOperator("||",1),this.RegisterBinaryOperator("and",1,!0),this.RegisterBinaryOperator("or",1,!0),this.RegisterBinaryOperator("==",2),this.RegisterBinaryOperator(">=",2),this.RegisterBinaryOperator("<=",2),this.RegisterBinaryOperator("<",2),this.RegisterBinaryOperator(">",2),this.RegisterBinaryOperator("!=",2),this.RegisterBinaryOperator("?",3),this.RegisterBinaryOperator("has",3,!0),this.RegisterBinaryOperator("!?",3),this.RegisterBinaryOperator("hasnt",3,!0),this.RegisterBinaryOperator("^",3),this.RegisterBinaryOperator("+",4),this.RegisterBinaryOperator("-",5),this.RegisterBinaryOperator("*",6),this.RegisterBinaryOperator("/",7),this.RegisterBinaryOperator("%",8),this.RegisterBinaryOperator("mod",8,!0)},this.RegisterBinaryOperator=(s,l,a=!1)=>{const u=new bE.InfixOperator(s,l,a);this._binaryOperators.push(u),this._maxBinaryOpLength=Math.max(this._maxBinaryOpLength,s.length)},this._openFilenames=[],this.IncludeStatement=()=>{if(this.Whitespace(),this.ParseString("INCLUDE")===null)return null;this.Whitespace();let s=this.Expect(()=>this.ParseUntilCharactersFromString(`
\r`),"filename for include statement");s=s.replace(new RegExp(/[ \t]+$/g),"");const l=this.fileHandler.ResolveInkFilename(s);if(this.FilenameIsAlreadyOpen(l))return this.Error(`Recursive INCLUDE detected: '${l}' is already open.`),this.ParseUntilCharactersFromString(`\r
`),new ld.IncludedFile(null);this.AddOpenFilename(l);let a=null,u="";try{u=this._rootParser.fileHandler.LoadInkFileContents(l)}catch(h){this.Error(`Failed to load: '${s}'.
Error:${h}`)}return u&&(a=new ne(u,s,this._externalErrorHandler,this._rootParser,this.fileHandler).ParseStory()),this.RemoveOpenFilename(l),new ld.IncludedFile(a)},this.FilenameIsAlreadyOpen=s=>this._rootParser._openFilenames.includes(s),this.AddOpenFilename=s=>{this._rootParser._openFilenames.push(s)},this.RemoveOpenFilename=s=>{this._rootParser._openFilenames.splice(this._rootParser._openFilenames.indexOf(s),1)},this.KnotDefinition=()=>{const s=this.Parse(this.KnotDeclaration);if(s===null)return null;this.Expect(this.EndOfLine,"end of line after knot name definition",this.SkipToNextLine);const l=()=>this.StatementsAtLevel(Re.StatementLevel.Knot),a=this.Expect(l,"at least one line within the knot",this.KnotStitchNoContentRecoveryRule);return new IE.Knot(s.name,a,s.args,s.isFunction)},this.KnotDeclaration=()=>{if(this.Whitespace(),this.KnotTitleEquals()===null)return null;this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);let l;const a=(s==null?void 0:s.name)==="function";a?(this.Expect(this.Whitespace,"whitespace after the 'function' keyword"),l=this.Parse(this.IdentifierWithMetadata)):l=s,l===null&&(this.Error(`Expected the name of the ${a?"function":"knot"}`),l=new vi.Identifier("")),this.Whitespace();const u=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),this.Parse(this.KnotTitleEquals),new od.FlowDecl(l,u,a)},this.KnotTitleEquals=()=>{const s=this.ParseCharactersFromString("=");return s===null||s.length<=1?null:s},this.StitchDefinition=()=>{const s=this.Parse(this.StitchDeclaration);if(s===null)return null;this.Expect(this.EndOfLine,"end of line after stitch name",this.SkipToNextLine);const l=()=>this.StatementsAtLevel(Re.StatementLevel.Stitch),a=this.Expect(l,"at least one line within the stitch",this.KnotStitchNoContentRecoveryRule);return new LE.Stitch(s.name,a,s.args,s.isFunction)},this.StitchDeclaration=()=>{if(this.Whitespace(),this.ParseString("=")===null||this.ParseString("=")!==null)return null;this.Whitespace();const s=this.ParseString("function")!==null;s&&this.Whitespace();const l=this.Parse(this.IdentifierWithMetadata);if(l===null)return null;this.Whitespace();const a=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),new od.FlowDecl(l,a,s)},this.KnotStitchNoContentRecoveryRule=()=>(this.ParseUntil(this.KnotDeclaration,new _e.CharacterSet("="),null),[new kt.Text("<ERROR IN FLOW>")]),this.BracketedKnotDeclArguments=()=>{if(this.ParseString("(")===null)return null;let s=this.Interleave(this.Spaced(this.FlowDeclArgument),this.Exclude(this.String(",")));return this.Expect(this.String(")"),"closing ')' for parameter list"),s===null&&(s=[]),s},this.FlowDeclArgument=()=>{const s=this.Parse(this.IdentifierWithMetadata);this.Whitespace();const l=this.ParseDivertArrow();this.Whitespace();const a=this.Parse(this.IdentifierWithMetadata);if(s==null&&a===null)return null;const u=new gE.Argument;return l!==null&&(u.isDivertTarget=!0),s!==null&&s.name==="ref"?(a===null&&this.Error("Expected an parameter name after 'ref'"),u.identifier=a,u.isByReference=!0):(u.isDivertTarget?u.identifier=a:u.identifier=s,u.identifier===null&&this.Error("Expected an parameter name"),u.isByReference=!1),u},this.ExternalDeclaration=()=>{this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);if(s===null||s.name!="EXTERNAL")return null;this.Whitespace();const l=this.Expect(this.IdentifierWithMetadata,"name of external function")||new vi.Identifier("");this.Whitespace();let a=this.Expect(this.BracketedKnotDeclArguments,`declaration of arguments for EXTERNAL, even if empty, i.e. 'EXTERNAL ${l}()'`);a===null&&(a=[]);const u=a.map(h=>{var p;return(p=h.identifier)===null||p===void 0?void 0:p.name}).filter(Jt.filterUndef);return new OE.ExternalDeclaration(l,u)},this._identifierCharSet=null,this.LogicLine=()=>{if(this.Whitespace(),this.ParseString("~")===null)return null;this.Whitespace();const s=()=>this.OneOf([this.ReturnStatement,this.TempDeclarationOrAssignment,this.Expression]);let l=this.Expect(s,"expression after '~'",this.SkipToNextLine);if(l===null)return new et.ContentList;l instanceof PE.Expression&&!(l instanceof lo.FunctionCall||l instanceof ao.IncDecExpression)&&this.Error(`Logic following a '~' can't be that type of expression. It can only be something like:
	~ return
	~ var x = blah
	~ x++
	~ myFunction()`);const a=Jt.asOrNull(l,lo.FunctionCall);return a&&(a.shouldPopReturnedValue=!0),l.Find(lo.FunctionCall)()!==null&&(l=new et.ContentList(l,new kt.Text(`
`))),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),l},this.VariableDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="VAR")return null;this.Whitespace();const l=this.Expect(this.IdentifierWithMetadata,"variable name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const u=this.Expect(this.Expression,"initial value for ");return u?(u instanceof rr.NumberExpression||u instanceof gi.StringExpression||u instanceof Ra.DivertTarget||u instanceof Da.VariableReference||u instanceof ad.List||this.Error("initial value for a variable must be a number, constant, list or divert target"),this.Parse(this.ListElementDefinitionSeparator)!==null?this.Error("Unexpected ','. If you're trying to declare a new list, use the LIST keyword, not VAR"):u instanceof gi.StringExpression&&(u.isSingleString||this.Error("Constant strings cannot contain any logic.")),new La.VariableAssignment({assignedExpression:u,isGlobalDeclaration:!0,variableIdentifier:l})):null},this.ListDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!="LIST")return null;this.Whitespace();const l=this.Expect(this.IdentifierWithMetadata,"list name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of the list definition"),this.Whitespace();const a=this.Expect(this.ListDefinition,"list item names");return a?(a.identifier=new vi.Identifier(l.name),new La.VariableAssignment({variableIdentifier:l,listDef:a})):null},this.ListDefinition=()=>{this.AnyWhitespace();const s=this.SeparatedList(this.ListElementDefinition,this.ListElementDefinitionSeparator);return s===null?null:new kE.ListDefinition(s)},this.ListElementDefinitionSeparator=()=>(this.AnyWhitespace(),this.ParseString(",")===null?null:(this.AnyWhitespace(),",")),this.ListElementDefinition=()=>{const s=this.ParseString("(")!==null;let l=s;this.Whitespace();const a=this.Parse(this.IdentifierWithMetadata);if(a===null)return null;this.Whitespace(),s&&this.ParseString(")")!=null&&(l=!1,this.Whitespace());let u=null;if(this.ParseString("=")!==null){this.Whitespace();const h=this.Expect(this.ExpressionInt,"value to be assigned to list item");h!==null&&(u=h.value),l&&(this.Whitespace(),this.ParseString(")")!==null&&(l=!1))}return l&&this.Error("Expected closing ')'"),new AE.ListElementDefinition(a,s,u)},this.ConstDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="CONST")return null;this.Whitespace();const l=this.Expect(this.IdentifierWithMetadata,"constant name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const a=this.Expect(this.Expression,"initial value for ");return a instanceof rr.NumberExpression||a instanceof Ra.DivertTarget||a instanceof gi.StringExpression?a instanceof gi.StringExpression&&(a.isSingleString||this.Error("Constant strings cannot contain any logic.")):this.Error("initial value for a constant must be a number or divert target"),new _E.ConstantDeclaration(l,a)},this.InlineLogicOrGlue=()=>this.OneOf([this.InlineLogic,this.Glue]),this.Glue=()=>this.ParseString("<>")!==null?new TE.Glue(new NE.Glue):null,this.InlineLogic=()=>{if(this.ParseString("{")===null)return null;this.Whitespace();const s=this.Expect(this.InnerLogic,"some kind of logic, conditional or sequence within braces: { ... }");if(s===null)return null;this.DisallowIncrement(s);let l=Jt.asOrNull(s,et.ContentList);return l||(l=new et.ContentList(s)),this.Whitespace(),this.Expect(this.String("}"),"closing brace '}' for inline logic"),l},this.InnerLogic=()=>{this.Whitespace();const s=this.ParseObject(this.SequenceTypeAnnotation);if(s!==null){const u=this.Expect(this.InnerSequenceObjects,"sequence elements (for cycle/stoping etc)");return u===null?null:new cd.Sequence(u,s)}const l=this.Parse(this.ConditionExpression);if(l)return this.Expect(()=>this.InnerConditionalContent(l),"conditional content following query");const a=[this.InnerConditionalContent,this.InnerSequence,this.InnerExpression];for(const u of a){const h=this.BeginRule(),p=this.ParseObject(u);if(p)if(this.Peek(this.Spaced(this.String("}")))===null)this.FailRule(h);else return this.SucceedRule(h,p);else this.FailRule(h)}return null},this.InnerExpression=()=>{const s=this.Parse(this.Expression);return s&&(s.outputWhenComplete=!0),s},this.IdentifierWithMetadata=()=>{const s=this.Identifier();return s===null?null:new vi.Identifier(s)},this.Identifier=()=>{const s=this.ParseCharactersFromCharSet(this.identifierCharSet);if(s===null)return null;let l=!0;for(let a of s)if(!(a>="0"&&a<="9")){l=!1;break}return l?null:s},this._sequenceTypeSymbols=new _e.CharacterSet("!&~$"),this.InnerSequence=()=>{this.Whitespace();let s=ve.SequenceType.Stopping;const l=this.Parse(this.SequenceTypeAnnotation);l!==null&&(s=l);const a=this.Parse(this.InnerSequenceObjects);return a===null||a.length<=1?null:new cd.Sequence(a,s)},this.SequenceTypeAnnotation=()=>{let s=this.Parse(this.SequenceTypeSymbolAnnotation);if(s===null&&(s=this.Parse(this.SequenceTypeWordAnnotation)),s===null)return null;switch(s){case ve.SequenceType.Once:case ve.SequenceType.Cycle:case ve.SequenceType.Stopping:case ve.SequenceType.Shuffle:case ve.SequenceType.Shuffle|ve.SequenceType.Stopping:case ve.SequenceType.Shuffle|ve.SequenceType.Once:break;default:return this.Error(`Sequence type combination not supported: ${s}`),ve.SequenceType.Stopping}return s},this.SequenceTypeSymbolAnnotation=()=>{this._sequenceTypeSymbols===null&&(this._sequenceTypeSymbols=new _e.CharacterSet("!&~$ "));let s=0;const l=this.ParseCharactersFromCharSet(this._sequenceTypeSymbols);if(l===null)return null;for(const a of l)switch(a){case"!":s|=ve.SequenceType.Once;break;case"&":s|=ve.SequenceType.Cycle;break;case"~":s|=ve.SequenceType.Shuffle;break;case"$":s|=ve.SequenceType.Stopping;break}return s===0?null:s},this.SequenceTypeWordAnnotation=()=>{const s=this.Interleave(this.SequenceTypeSingleWord,this.Exclude(this.Whitespace));if(s===null||s.length===0||this.ParseString(":")===null)return null;let l=0;for(const a of s)l|=a;return l},this.SequenceTypeSingleWord=()=>{let s=null;const l=this.Parse(this.IdentifierWithMetadata);if(l!==null)switch(l.name){case"once":s=ve.SequenceType.Once;break;case"cycle":s=ve.SequenceType.Cycle;break;case"shuffle":s=ve.SequenceType.Shuffle;break;case"stopping":s=ve.SequenceType.Stopping;break}return s===null?null:s},this.InnerSequenceObjects=()=>{const s=this.Parse(this.Newline)!==null;let l=null;return s?l=this.Parse(this.InnerMultilineSequenceObjects):l=this.Parse(this.InnerInlineSequenceObjects),l},this.InnerInlineSequenceObjects=()=>{const s=this.Interleave(this.Optional(this.MixedTextAndLogic),this.String("|"),null,!1);if(s===null)return null;const l=[];let a=!1;for(const u of s)if(u==="|")a||l.push(new et.ContentList),a=!1;else{const h=u;h===null?this.Error(`Expected content, but got ${u} (this is an ink compiler bug!)`):l.push(new et.ContentList(h)),a=!0}return a||l.push(new et.ContentList),l},this.InnerMultilineSequenceObjects=()=>{this.MultilineWhitespace();const s=this.OneOrMore(this.SingleMultilineSequenceElement);return s===null?null:s},this.SingleMultilineSequenceElement=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();const s=this.StatementsAtLevel(Re.StatementLevel.InnerBlock);return s===null?this.MultilineWhitespace():s.unshift(new kt.Text(`
`)),new et.ContentList(s)},this._statementRulesAtLevel=[],this._statementBreakRulesAtLevel=[],this.StatementsAtLevel=s=>(s===Re.StatementLevel.InnerBlock&&this.Parse(this.GatherDashes)!==null&&this.Error("You can't use a gather (the dashes) within the { curly braces } context. For multi-line sequences and conditions, you should only use one dash."),this.Interleave(this.Optional(this.MultilineWhitespace),()=>this.StatementAtLevel(s),()=>this.StatementsBreakForLevel(s))),this.StatementAtLevel=s=>{const l=this._statementRulesAtLevel[s],a=this.OneOf(l);return s===Re.StatementLevel.Top&&a instanceof hd.ReturnType&&this.Error("should not have return statement outside of a knot"),a},this.StatementsBreakForLevel=s=>{this.Whitespace();const l=this._statementBreakRulesAtLevel[s],a=this.OneOf(l);return a===null?null:a},this.GenerateStatementLevelRules=()=>{const s=Object.values(Re.StatementLevel);this._statementRulesAtLevel="f".repeat(s.length).split("f").map(()=>[]),this._statementBreakRulesAtLevel="f".repeat(s.length).split("f").map(()=>[]);for(const l of s){const a=[],u=[];a.push(this.Line(this.MultiDivert)),l>=Re.StatementLevel.Top&&a.push(this.KnotDefinition),a.push(this.Line(this.Choice)),a.push(this.Line(this.AuthorWarning)),l>Re.StatementLevel.InnerBlock&&a.push(this.Gather),l>=Re.StatementLevel.Knot&&a.push(this.StitchDefinition),a.push(this.Line(this.ListDeclaration)),a.push(this.Line(this.VariableDeclaration)),a.push(this.Line(this.ConstDeclaration)),a.push(this.Line(this.ExternalDeclaration)),a.push(this.Line(this.IncludeStatement)),a.push(this.LogicLine),a.push(this.LineOfMixedTextAndLogic),l<=Re.StatementLevel.Knot&&u.push(this.KnotDeclaration),l<=Re.StatementLevel.Stitch&&u.push(this.StitchDeclaration),l<=Re.StatementLevel.InnerBlock&&(u.push(this.ParseDashNotArrow),u.push(this.String("}"))),this._statementRulesAtLevel[l]=a,this._statementBreakRulesAtLevel[l]=u}},this.SkipToNextLine=()=>(this.ParseUntilCharactersFromString(`
\r`),this.ParseNewline(),It.ParseSuccess),this.Line=s=>()=>{const l=this.ParseObject(s);return l===null?null:(this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),l)},this._endOfTagCharSet=new _e.CharacterSet(`#
\r\\`),this.Tag=()=>{if(this.Whitespace(),this.ParseString("#")===null)return null;this.Whitespace();let s="";do{if(s+=this.ParseUntilCharactersFromCharSet(this._endOfTagCharSet)||"",this.ParseString("\\")!==null){const u=this.ParseSingleCharacter();u!=="\0"&&(s+=u);continue}break}while(!0);const l=s.trim();return new DE.Tag(new VE.Tag(l))},this.Tags=()=>{const s=this.OneOrMore(this.Tag);return s===null?null:s},this._inlineWhitespaceChars=new _e.CharacterSet(" 	"),this.EndOfLine=()=>this.OneOf([this.Newline,this.EndOfFile]),this.Newline=()=>(this.Whitespace(),this.ParseNewline()!==null?It.ParseSuccess:null),this.EndOfFile=()=>(this.Whitespace(),this.endOfInput?It.ParseSuccess:null),this.MultilineWhitespace=()=>{let s=this.OneOrMore(this.Newline);return s===null?null:s.length>=1?It.ParseSuccess:null},this.Whitespace=()=>this.ParseCharactersFromCharSet(this._inlineWhitespaceChars)!==null?It.ParseSuccess:null,this.Spaced=s=>()=>{this.Whitespace();const l=this.ParseObject(s);return l===null?null:(this.Whitespace(),l)},this.AnyWhitespace=()=>{let s=!1;for(;this.OneOf([this.Whitespace,this.MultilineWhitespace])!==null;)s=!0;return s?It.ParseSuccess:null},this.MultiSpaced=s=>()=>{this.AnyWhitespace();const l=this.ParseObject(s);return l===null?null:(this.AnyWhitespace(),l)},this._filename=null,this._externalErrorHandler=null,this._fileHandler=null,this._filename=n,this.RegisterExpressionOperators(),this.GenerateStatementLevelRules(),this.errorHandler=this.OnStringParserError,this._externalErrorHandler=r,this._fileHandler=o,i===null){if(this._rootParser=this,this._openFilenames=[],this._filename!==null){const s=this.fileHandler.ResolveInkFilename(this._filename);this._openFilenames.push(s)}}else this._rootParser=i}get fileHandler(){if(!this._fileHandler)throw new Error("No FileHandler defined");return this._fileHandler}set fileHandler(e){this._fileHandler=e}PreProcessInputString(e){return new SE.CommentEliminator(e).Process()}get parsingStringExpression(){return this.GetFlag(Number(sd.CustomFlags.ParsingString))}set parsingStringExpression(e){this.SetFlag(Number(sd.CustomFlags.ParsingString),e)}get identifierCharSet(){return this._identifierCharSet===null&&((this._identifierCharSet=new _e.CharacterSet).AddRange("A","Z").AddRange("a","z").AddRange("0","9").Add("_"),this.ExtendIdentifierCharacterRanges(this._identifierCharSet)),this._identifierCharSet}}cl.InkParser=ne;ne.LatinBasic=zt.CharacterRange.Define("A","z",new _e.CharacterSet().AddRange("[","`"));ne.LatinExtendedA=zt.CharacterRange.Define("\u0100","\u017F");ne.LatinExtendedB=zt.CharacterRange.Define("\u0180","\u024F");ne.Greek=zt.CharacterRange.Define("\u0370","\u03FF",new _e.CharacterSet().AddRange("\u0378","\u0385").AddCharacters("\u0374\u0375\u0378\u0387\u038B\u038D\u03A2"));ne.Cyrillic=zt.CharacterRange.Define("\u0400","\u04FF",new _e.CharacterSet().AddRange("\u0482","\u0489"));ne.Armenian=zt.CharacterRange.Define("\u0530","\u058F",new _e.CharacterSet().AddCharacters("\u0530").AddRange("\u0557","\u0560").AddRange("\u0588","\u058E"));ne.Hebrew=zt.CharacterRange.Define("\u0590","\u05FF",new _e.CharacterSet);ne.Arabic=zt.CharacterRange.Define("\u0600","\u06FF",new _e.CharacterSet);ne.Korean=zt.CharacterRange.Define("\uAC00","\uD7AF",new _e.CharacterSet);ne.ListAllCharacterRanges=()=>[ne.LatinBasic,ne.LatinExtendedA,ne.LatinExtendedB,ne.Arabic,ne.Armenian,ne.Cyrillic,ne.Greek,ne.Hebrew,ne.Korean];(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Compiler=t.Story=t.InkList=t.CompilerOptions=void 0;const e=Zi,n=ul,r=hl,i=cl,o=re,s=B;var l=Zi;Object.defineProperty(t,"CompilerOptions",{enumerable:!0,get:function(){return l.CompilerOptions}});var a=_s;Object.defineProperty(t,"InkList",{enumerable:!0,get:function(){return a.InkList}}),Object.defineProperty(t,"Story",{enumerable:!0,get:function(){return a.Story}});class u{constructor(p,c=null){this._errors=[],this._warnings=[],this._authorMessages=[],this._parsedStory=null,this._runtimeStory=null,this._parser=null,this._debugSourceRanges=[],this.Compile=()=>(this._parser=new i.InkParser(this.inputString,this.options.sourceFilename||null,this.OnError,null,this.options.fileHandler),this._parsedStory=this.parser.ParseStory(),this.errors.length===0?(this.parsedStory.countAllVisits=this.options.countAllVisits,this._runtimeStory=this.parsedStory.ExportRuntime(this.OnError)):this._runtimeStory=null,this.runtimeStory),this.RetrieveDebugSourceForLatestContent=()=>{var m;for(const S of this.runtimeStory.state.outputStream){const E=s.asOrNull(S,o.StringValue);if(E!==null){const d=new n.DebugSourceRange(((m=E.value)===null||m===void 0?void 0:m.length)||0,E.debugMetadata,E.value||"unknown");this.debugSourceRanges.push(d)}}},this.DebugMetadataForContentAtOffset=m=>{let S=0,E=null;for(const d of this.debugSourceRanges){if(d.debugMetadata!==null&&(E=d.debugMetadata),m>=S&&m<S+d.length)return E;S+=d.length}return null},this.OnError=(m,S)=>{switch(S){case r.ErrorType.Author:this._authorMessages.push(m);break;case r.ErrorType.Warning:this._warnings.push(m);break;case r.ErrorType.Error:this._errors.push(m);break}this.options.errorHandler!==null&&this.options.errorHandler(m,S)},this._inputString=p,this._options=c||new e.CompilerOptions}get errors(){return this._errors}get warnings(){return this._warnings}get authorMessages(){return this._authorMessages}get inputString(){return this._inputString}get options(){return this._options}get parsedStory(){if(!this._parsedStory)throw new Error;return this._parsedStory}get runtimeStory(){if(!this._runtimeStory)throw new Error("Compilation failed.");return this._runtimeStory}get parser(){if(!this._parser)throw new Error;return this._parser}get debugSourceRanges(){return this._debugSourceRanges}}t.Compiler=u})(Ly);export{Ly as C,ME as R,$E as a,ho as b,GE as i,Fy as j,J as r,BE as u};
