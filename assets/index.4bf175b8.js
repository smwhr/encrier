var k=Object.defineProperty,$=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var w=(e,t,o)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,g=(e,t)=>{for(var o in t||(t={}))G.call(t,o)&&w(e,o,t[o]);if(S)for(var o of S(t))H.call(t,o)&&w(e,o,t[o]);return e},C=(e,t)=>$(e,j(t));import{r as l,l as B,u as U,a as W,i as _,j as u,b as L,R as q,c as F}from"./vendor.331803d5.js";const K=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};K();const V=({setStory:e})=>{const t=`Once upon a time...
    -(opts)
    + Choice A.
    + Choice B.
    + Choice C.
   
   - They lived happily ever after {opts}.
       -> opts
   `,o=l.exports.useRef(null),[s,n]=l.exports.useState([]),r=B(a=>s.map(d=>{const c=a.lineBlockAt(d.index);return{from:c.from,to:c.to,severity:d.type.includes("ERROR")?"error":d.type.includes("WARNING")?"warning":"info",message:d.msg}})),{setContainer:i}=U({container:o.current,extensions:[r,W()],value:t,minHeight:"100%",height:"100%",theme:"dark",onChange:(a,d)=>{y(a)}}),y=a=>{const d=[],c=(h,m)=>{var R=/^(ERROR|WARNING|RUNTIME ERROR|RUNTIME WARNING|TODO): ('([^']+)' )?line (\d+): (.*)/;let p=h.match(R);if(p){const v=p[1],P=p[3],E=parseInt(p[4]),T=p[5],b=/\n/gi,N=[];let I=null;for(;I=b.exec(a);)N.push(I.index+1);const D=N[E-1]||0;d.push({type:v,filename:P,lineNumber:E,index:D,msg:T})}},f=new _.exports.CompilerOptions(null,[],!1,c,null),x=new _.exports.Compiler(a,f);try{const h=x.Compile();e(h)}catch(h){console.error(h)}finally{n(d)}};return l.exports.useEffect(()=>{y(t)},[]),l.exports.useEffect(()=>{o.current&&i(o.current)},[o.current]),u("div",{ref:o})},z=(e,t)=>({text:e,index:t,delay:0}),A=(e,t=[])=>({text:e,classList:t,delay:0}),M={texts:[],choices:[]};function J(e,t){switch(t.type){case"reset":return M;case"add_text":return C(g({},e),{texts:e.texts.concat(t.payload)});case"delay_text":const{index:o,delay:s}=t.payload,n=e.texts;return n[o].delay=s,C(g({},e),{texts:n});case"add_choice":return C(g({},e),{choices:e.choices.concat(t.payload)});case"delay_choice":const{index:r,delay:i}=t.payload,y=e.choices;return y[r].delay=i,C(g({},e),{choices:y});case"clear_choices":return C(g({},e),{choices:[]});default:throw new Error}}const Q=({story:e})=>{const[t,o]=l.exports.useReducer(J,M),[s,n]=l.exports.useState([]),r=l.exports.useRef(t.texts),i=l.exports.useRef(null);if(l.exports.useLayoutEffect(()=>{if(e!==null){for(let c of s)try{O(e,o,c)}catch{console.log(`Could not choose ${c}`),n(s.slice(0,s.indexOf(c)));break}return O(e,o),()=>{o({type:"reset"})}}},[e]),l.exports.useLayoutEffect(()=>{if(i.current===null)return;const c=r.current,f=t.texts;let x=0;for(let m of f)if(c.indexOf(m)===-1){const p=f.indexOf(m),v=x*200;o({type:"delay_text",payload:{index:p,delay:v}}),x++}for(let m of a){if(m.delay>0)continue;const R=a.indexOf(m),p=x*200;o({type:"delay_choice",payload:{index:R,delay:p}}),x++}r.current=f;const h=i.current.querySelector("p:last-child");h&&h.scrollIntoView()},[e,t.texts,t.choices]),e===null)return null;const{texts:y,choices:a}=t,d=c=>()=>{o({type:"clear_choices"}),n(s.concat(c)),e.ChooseChoiceIndex(c),O(e,o)};return u("div",{children:L("div",{className:"container",ref:i,children:[y.map((c,f)=>u("p",{style:{animationDelay:c.delay+200+"ms"},children:c.text},f)),a.length>0&&a.map(c=>u("p",{className:"choice",style:{animationDelay:c.delay+200+"ms"},children:u("a",{href:"#",onClick:d(c.index),children:c.text})},`choice-${s.length}-${c.index}`))]})})};function O(e,t,o){for(;e.canContinue;){var s=e.Continue(),n=e.currentTags;t({type:"add_text",payload:A(s)}),n&&n.length>0&&t({type:"add_text",payload:A(n.map(r=>`#${r}`).join(" "),["tags"])})}if(o!==void 0){e.ChooseChoiceIndex(o);return}e.currentChoices.forEach(function(r,i){t({type:"add_choice",payload:z(r.text,r.index)})})}function X(){l.exports.useState(0);const[e,t]=l.exports.useState(null);return u("div",{className:"App",children:L("div",{className:"row",children:[u(V,{setStory:t}),u(Q,{story:e})]})})}q.render(u(F.StrictMode,{children:u(X,{})}),document.getElementById("root"));
