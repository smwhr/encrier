var A=Object.defineProperty,$=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var M=(e,t,o)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,C=(e,t)=>{for(var o in t||(t={}))P.call(t,o)&&M(e,o,t[o]);if(k)for(var o of k(t))_.call(t,o)&&M(e,o,t[o]);return e},w=(e,t)=>$(e,D(t));import{C as T,j as i,a as h,u as F,r as l,i as K,R as j,b as V}from"./vendor.f43ac392.js";const B=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}};B();const G=e=>{const t=[],o=(c,s)=>{var x=/^(ERROR|WARNING|RUNTIME ERROR|RUNTIME WARNING|TODO): ('([^']+)' )?line (\d+): (.*)/;let d=c.match(x);if(d){const R=d[1],a=d[3],u=parseInt(d[4]),f=d[5],b=/\n/gi,g=[0];let y=null;for(;y=b.exec(e);)g.push(y.index+1);const v=g[u-1]||0,N={type:R,filename:a,lineNumber:u,index:v,msg:f};t.push(N)}},r=new T.CompilerOptions(null,[],!1,o,null),n=new T.Compiler(e,r);try{const c=n.Compile(),s=n.parsedStory;return{story:c,parsedStory:s,parseErrors:t}}catch{return{story:void 0,parsedStory:void 0,parseErrors:t}}},H=e=>e.GetType()=="Knot",W=e=>[{label:"choice",kind:e.languages.CompletionItemKind.Snippet,insertText:"* ${1:text}",insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Simple choice"},{label:"labeled-choice",kind:e.languages.CompletionItemKind.Snippet,insertText:"*(${2:label}) ${1:text}",insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Labeled choice"}],q=e=>{const{toggleFileManager:t}=e;return i("div",{className:"split-view-view visible left-bar",style:{left:"0px",width:"48px",height:"100%"},children:i("div",{className:"monaco-action-bar vertical",children:h("ul",{className:"actions-container",role:"toolbar","aria-label":"Active View Switcher",children:[h("li",{className:"action-item icon",role:"tab",children:[i("a",{className:"action-label codicon codicon-explorer-view-icon",style:{color:"rgb(248, 248, 242)"},onClick:t}),i("div",{className:"active-item-indicator"})]}),h("li",{className:"action-item icon checked",role:"tab",children:[i("a",{className:"action-label codicon codicon-edit-icon",style:{color:"rgb(248, 248, 242)"},onClick:t}),i("div",{className:"active-item-indicator"})]}),h("li",{className:"action-item icon checked",role:"tab",children:[i("a",{className:"action-label codicon codicon-play-icon",style:{color:"rgb(248, 248, 242)"}}),i("div",{className:"active-item-indicator"})]})]})})})},U=e=>{const{visible:t}=e;return i("div",{className:`split-view-view ${t?"visible":""} left-bar`,style:{left:"48px",width:"120px",height:"100%"},children:i("div",{className:"monaco-action-bar vertical",children:h("ul",{className:"actions-container",role:"toolbar","aria-label":"Active View Switcher",children:[h("li",{className:"action-item icon",role:"tab",children:[i("a",{className:"action-label codicon codicon-explorer-view-icon",style:{color:"rgb(248, 248, 242)"}}),i("div",{className:"active-item-indicator"})]}),h("li",{className:"action-item icon checked",role:"tab",children:[i("a",{className:"action-label codicon codicon-edit-icon",style:{color:"rgb(248, 248, 242)"}}),i("div",{className:"active-item-indicator"})]}),h("li",{className:"action-item icon checked",role:"tab",children:[i("a",{className:"action-label codicon codicon-play-icon",style:{color:"rgb(248, 248, 242)"}}),i("div",{className:"active-item-indicator"})]})]})})})},z=({setStory:e})=>{const t=`LIST letters = a,b,c
    Once upon a time...
    -(opts)
    + Choice A.
    + Choice B.
    + Choice C.
        ->knot
   
   - They lived happily ever after {opts}.
       -> opts

== knot ==
Another castle
->END
   `,o=F(),r=l.exports.useRef(null),[n,c]=l.exports.useState(t),[s,x]=l.exports.useState(),[d,R]=l.exports.useState(),[a,u]=l.exports.useState([]),[f,b]=l.exports.useState(!1),g=()=>{b(!f)};l.exports.useEffect(()=>{if(o&&r.current&&d){const p=r.current;let m=d.map(S=>({range:new o.Range(S.lineNumber,1,S.lineNumber,1),options:{isWholeLine:!0}}));u(p.deltaDecorations(a,m))}},[o,r,d]),l.exports.useEffect(()=>{if(o&&s){const p=o.languages.registerFoldingRangeProvider("ink",{provideFoldingRanges:function(){return s.content.filter(m=>m.debugMetadata!==null).map(m=>({start:m.debugMetadata.startLineNumber,end:Math.max(m.debugMetadata.startLineNumber,m.debugMetadata.endLineNumber-1),kind:o.languages.FoldingRangeKind.Region}))}});return()=>{p.dispose()}}},[o,s]),l.exports.useEffect(()=>{if(o&&s){const p=o.languages.registerCompletionItemProvider("ink",{provideCompletionItems:function(){const m=s.content.filter(I=>I.debugMetadata!==null).filter(H).map(I=>({label:I.name,kind:o.languages.CompletionItemKind.Text,insertText:`-> ${I.name}`})),S=W(o);return{suggestions:m.concat(S)}}});return()=>{p.dispose()}}},[o,s]),l.exports.useEffect(()=>{const{story:p,parsedStory:m,parseErrors:S}=G(n);p&&e(p),x(m),R(S)},[n,o,r]);const y=p=>{p&&c(p)},v=(p,m)=>{r.current=p,m.languages.register({id:"ink"})},N=48+(f?120:0);return i("div",{className:"monaco-split-view2",style:{padding:0},children:i("div",{className:"monaco-scrollable-element",children:h("div",{className:"split-view-container",children:[i(q,{toggleFileManager:g}),i(U,{visible:f}),i("div",{className:"split-view-view visible",style:{left:`${N}px`,width:`calc( 100% - ${N}px )`,height:"100%"},children:i(K,{className:"editor",theme:"vs-dark",height:"100%",width:"auto",defaultValue:n,language:"ink",onChange:y,onMount:v,options:{glyphMargin:!0}})})]})})})},J=(e,t)=>({text:e,index:t,delay:0}),O=(e,t=[])=>({text:e,classList:t,delay:0}),L={texts:[],choices:[]};function Q(e,t){switch(t.type){case"reset":return L;case"add_text":return w(C({},e),{texts:e.texts.concat(t.payload)});case"delay_text":const{index:o,delay:r}=t.payload,n=e.texts;return n[o].delay=r,w(C({},e),{texts:n});case"add_choice":return w(C({},e),{choices:e.choices.concat(t.payload)});case"delay_choice":const{index:c,delay:s}=t.payload,x=e.choices;return x[c].delay=s,w(C({},e),{choices:x});case"clear_choices":return w(C({},e),{choices:[]});default:throw new Error}}const X=({story:e})=>{const[t,o]=l.exports.useReducer(Q,L),[r,n]=l.exports.useState([]),c=l.exports.useRef(t.texts),s=l.exports.useRef(null);if(l.exports.useLayoutEffect(()=>{if(e!==null){for(let a of r)try{E(e,o,a)}catch{console.log(`Could not choose ${a}`),n(r.slice(0,r.indexOf(a)));break}return E(e,o),()=>{o({type:"reset"})}}},[e]),l.exports.useLayoutEffect(()=>{if(s.current===null)return;const a=c.current,u=t.texts;let f=0;for(let g of u)if(a.indexOf(g)===-1){const v=u.indexOf(g),N=f*200;o({type:"delay_text",payload:{index:v,delay:N}}),f++}for(let g of d){if(g.delay>0)continue;const y=d.indexOf(g),v=f*200;o({type:"delay_choice",payload:{index:y,delay:v}}),f++}c.current=u;const b=s.current.querySelector("p:last-child");b&&b.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},[e,t.texts,t.choices]),e===null)return null;const{texts:x,choices:d}=t,R=a=>u=>{u.preventDefault(),o({type:"clear_choices"}),n(r.concat(a)),e.ChooseChoiceIndex(a),E(e,o)};return h("div",{className:"container",ref:s,children:[x.map((a,u)=>i("p",{style:{animationDelay:a.delay+200+"ms"},children:a.text},u)),d.length>0&&d.map(a=>i("p",{className:"choice",style:{animationDelay:a.delay+200+"ms"},children:i("a",{href:"#",onClick:R(a.index),children:a.text})},`choice-${r.length}-${a.index}`)),i("p",{})]})};function E(e,t,o){for(;e.canContinue;){var r=e.Continue(),n=e.currentTags;t({type:"add_text",payload:O(r)}),n&&n.length>0&&t({type:"add_text",payload:O(n.map(c=>`#${c}`).join(" "),["tags"])})}if(o!==void 0){e.ChooseChoiceIndex(o);return}e.currentChoices.forEach(function(c,s){t({type:"add_choice",payload:J(c.text,c.index)})})}function Y(){l.exports.useState(0);const[e,t]=l.exports.useState(null);return i("div",{className:"App",children:h("div",{className:"row",children:[i(z,{setStory:t}),i(X,{story:e})]})})}j.render(i(V.StrictMode,{children:i(Y,{})}),document.getElementById("root"));
