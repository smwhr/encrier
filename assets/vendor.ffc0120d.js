var Tm=Object.defineProperty,Nm=Object.defineProperties;var bm=Object.getOwnPropertyDescriptors;var Hh=Object.getOwnPropertySymbols;var Im=Object.prototype.hasOwnProperty,km=Object.prototype.propertyIsEnumerable;var Kh=(t,e,n)=>e in t?Tm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xr=(t,e)=>{for(var n in e||(e={}))Im.call(e,n)&&Kh(t,n,e[n]);if(Hh)for(var n of Hh(e))km.call(e,n)&&Kh(t,n,e[n]);return t},Jh=(t,e)=>Nm(t,bm(e));var J={exports:{}},z={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Qh=Object.getOwnPropertySymbols,Am=Object.prototype.hasOwnProperty,Fm=Object.prototype.propertyIsEnumerable;function Rm(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function Dm(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map(function(l){return e[l]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(l){i[l]=l}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var vd=Dm()?Object.assign:function(t,e){for(var n,r=Rm(t),i,l=1;l<arguments.length;l++){n=Object(arguments[l]);for(var s in n)Am.call(n,s)&&(r[s]=n[s]);if(Qh){i=Qh(n);for(var o=0;o<i.length;o++)Fm.call(n,i[o])&&(r[i[o]]=n[i[o]])}}return r};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Au=vd,Ar=60103,yd=60106;z.Fragment=60107;z.StrictMode=60108;z.Profiler=60114;var Cd=60109,Sd=60110,wd=60112;z.Suspense=60113;var _d=60115,Ed=60116;if(typeof Symbol=="function"&&Symbol.for){var mt=Symbol.for;Ar=mt("react.element"),yd=mt("react.portal"),z.Fragment=mt("react.fragment"),z.StrictMode=mt("react.strict_mode"),z.Profiler=mt("react.profiler"),Cd=mt("react.provider"),Sd=mt("react.context"),wd=mt("react.forward_ref"),z.Suspense=mt("react.suspense"),_d=mt("react.memo"),Ed=mt("react.lazy")}var Xh=typeof Symbol=="function"&&Symbol.iterator;function Lm(t){return t===null||typeof t!="object"?null:(t=Xh&&t[Xh]||t["@@iterator"],typeof t=="function"?t:null)}function ls(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Pd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Od={};function Fr(t,e,n){this.props=t,this.context=e,this.refs=Od,this.updater=n||Pd}Fr.prototype.isReactComponent={};Fr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(ls(85));this.updater.enqueueSetState(this,t,e,"setState")};Fr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function xd(){}xd.prototype=Fr.prototype;function Fu(t,e,n){this.props=t,this.context=e,this.refs=Od,this.updater=n||Pd}var Ru=Fu.prototype=new xd;Ru.constructor=Fu;Au(Ru,Fr.prototype);Ru.isPureReactComponent=!0;var Du={current:null},Td=Object.prototype.hasOwnProperty,Nd={key:!0,ref:!0,__self:!0,__source:!0};function bd(t,e,n){var r,i={},l=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(l=""+e.key),e)Td.call(e,r)&&!Nd.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),u=0;u<o;u++)a[u]=arguments[u+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:Ar,type:t,key:l,ref:s,props:i,_owner:Du.current}}function Vm(t,e){return{$$typeof:Ar,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Lu(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ar}function Wm(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Yh=/\/+/g;function zo(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Wm(""+t.key):e.toString(36)}function dl(t,e,n,r,i){var l=typeof t;(l==="undefined"||l==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(l){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case Ar:case yd:s=!0}}if(s)return s=t,i=i(s),t=r===""?"."+zo(s,0):r,Array.isArray(i)?(n="",t!=null&&(n=t.replace(Yh,"$&/")+"/"),dl(i,e,n,"",function(u){return u})):i!=null&&(Lu(i)&&(i=Vm(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(Yh,"$&/")+"/")+t)),e.push(i)),1;if(s=0,r=r===""?".":r+":",Array.isArray(t))for(var o=0;o<t.length;o++){l=t[o];var a=r+zo(l,o);s+=dl(l,e,n,a,i)}else if(a=Lm(t),typeof a=="function")for(t=a.call(t),o=0;!(l=t.next()).done;)l=l.value,a=r+zo(l,o++),s+=dl(l,e,n,a,i);else if(l==="object")throw e=""+t,Error(ls(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e));return s}function As(t,e,n){if(t==null)return t;var r=[],i=0;return dl(t,r,"","",function(l){return e.call(n,l,i++)}),r}function jm(t){if(t._status===-1){var e=t._result;e=e(),t._status=0,t._result=e,e.then(function(n){t._status===0&&(n=n.default,t._status=1,t._result=n)},function(n){t._status===0&&(t._status=2,t._result=n)})}if(t._status===1)return t._result;throw t._result}var Id={current:null};function $t(){var t=Id.current;if(t===null)throw Error(ls(321));return t}var Mm={ReactCurrentDispatcher:Id,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:Du,IsSomeRendererActing:{current:!1},assign:Au};z.Children={map:As,forEach:function(t,e,n){As(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return As(t,function(){e++}),e},toArray:function(t){return As(t,function(e){return e})||[]},only:function(t){if(!Lu(t))throw Error(ls(143));return t}};z.Component=Fr;z.PureComponent=Fu;z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mm;z.cloneElement=function(t,e,n){if(t==null)throw Error(ls(267,t));var r=Au({},t.props),i=t.key,l=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,s=Du.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(a in e)Td.call(e,a)&&!Nd.hasOwnProperty(a)&&(r[a]=e[a]===void 0&&o!==void 0?o[a]:e[a])}var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){o=Array(a);for(var u=0;u<a;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:Ar,type:t.type,key:i,ref:l,props:r,_owner:s}};z.createContext=function(t,e){return e===void 0&&(e=null),t={$$typeof:Sd,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:Cd,_context:t},t.Consumer=t};z.createElement=bd;z.createFactory=function(t){var e=bd.bind(null,t);return e.type=t,e};z.createRef=function(){return{current:null}};z.forwardRef=function(t){return{$$typeof:wd,render:t}};z.isValidElement=Lu;z.lazy=function(t){return{$$typeof:Ed,_payload:{_status:-1,_result:t},_init:jm}};z.memo=function(t,e){return{$$typeof:_d,type:t,compare:e===void 0?null:e}};z.useCallback=function(t,e){return $t().useCallback(t,e)};z.useContext=function(t,e){return $t().useContext(t,e)};z.useDebugValue=function(){};z.useEffect=function(t,e){return $t().useEffect(t,e)};z.useImperativeHandle=function(t,e,n){return $t().useImperativeHandle(t,e,n)};z.useLayoutEffect=function(t,e){return $t().useLayoutEffect(t,e)};z.useMemo=function(t,e){return $t().useMemo(t,e)};z.useReducer=function(t,e,n){return $t().useReducer(t,e,n)};z.useRef=function(t){return $t().useRef(t)};z.useState=function(t){return $t().useState(t)};z.version="17.0.2";J.exports=z;var pl=J.exports,kd={exports:{}},ct={},Ad={exports:{}},Fd={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var e,n,r,i;if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var a=null,u=null,h=function(){if(a!==null)try{var O=t.unstable_now();a(!0,O),a=null}catch(A){throw setTimeout(h,0),A}};e=function(O){a!==null?setTimeout(e,0,O):(a=O,setTimeout(h,0))},n=function(O,A){u=setTimeout(O,A)},r=function(){clearTimeout(u)},t.unstable_shouldYield=function(){return!1},i=t.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,c=window.clearTimeout;if(typeof console!="undefined"){var g=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof g!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var S=!1,E=null,d=-1,f=5,v=0;t.unstable_shouldYield=function(){return t.unstable_now()>=v},i=function(){},t.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):f=0<O?Math.floor(1e3/O):5};var y=new MessageChannel,w=y.port2;y.port1.onmessage=function(){if(E!==null){var O=t.unstable_now();v=O+f;try{E(!0,O)?w.postMessage(null):(S=!1,E=null)}catch(A){throw w.postMessage(null),A}}else S=!1},e=function(O){E=O,S||(S=!0,w.postMessage(null))},n=function(O,A){d=p(function(){O(t.unstable_now())},A)},r=function(){c(d),d=-1}}function b(O,A){var W=O.length;O.push(A);e:for(;;){var U=W-1>>>1,te=O[U];if(te!==void 0&&0<I(te,A))O[U]=A,O[W]=te,W=U;else break e}}function N(O){return O=O[0],O===void 0?null:O}function D(O){var A=O[0];if(A!==void 0){var W=O.pop();if(W!==A){O[0]=W;e:for(var U=0,te=O.length;U<te;){var Me=2*(U+1)-1,Z=O[Me],Qe=Me+1,Xe=O[Qe];if(Z!==void 0&&0>I(Z,W))Xe!==void 0&&0>I(Xe,Z)?(O[U]=Xe,O[Qe]=W,U=Qe):(O[U]=Z,O[Me]=W,U=Me);else if(Xe!==void 0&&0>I(Xe,W))O[U]=Xe,O[Qe]=W,U=Qe;else break e}}return A}return null}function I(O,A){var W=O.sortIndex-A.sortIndex;return W!==0?W:O.id-A.id}var T=[],j=[],Je=1,ce=null,G=3,tt=!1,m=!1,C=!1;function _(O){for(var A=N(j);A!==null;){if(A.callback===null)D(j);else if(A.startTime<=O)D(j),A.sortIndex=A.expirationTime,b(T,A);else break;A=N(j)}}function P(O){if(C=!1,_(O),!m)if(N(T)!==null)m=!0,e(x);else{var A=N(j);A!==null&&n(P,A.startTime-O)}}function x(O,A){m=!1,C&&(C=!1,r()),tt=!0;var W=G;try{for(_(A),ce=N(T);ce!==null&&(!(ce.expirationTime>A)||O&&!t.unstable_shouldYield());){var U=ce.callback;if(typeof U=="function"){ce.callback=null,G=ce.priorityLevel;var te=U(ce.expirationTime<=A);A=t.unstable_now(),typeof te=="function"?ce.callback=te:ce===N(T)&&D(T),_(A)}else D(T);ce=N(T)}if(ce!==null)var Me=!0;else{var Z=N(j);Z!==null&&n(P,Z.startTime-A),Me=!1}return Me}finally{ce=null,G=W,tt=!1}}var F=i;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(O){O.callback=null},t.unstable_continueExecution=function(){m||tt||(m=!0,e(x))},t.unstable_getCurrentPriorityLevel=function(){return G},t.unstable_getFirstCallbackNode=function(){return N(T)},t.unstable_next=function(O){switch(G){case 1:case 2:case 3:var A=3;break;default:A=G}var W=G;G=A;try{return O()}finally{G=W}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=F,t.unstable_runWithPriority=function(O,A){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var W=G;G=O;try{return A()}finally{G=W}},t.unstable_scheduleCallback=function(O,A,W){var U=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?U+W:U):W=U,O){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=W+te,O={id:Je++,callback:A,priorityLevel:O,startTime:W,expirationTime:te,sortIndex:-1},W>U?(O.sortIndex=W,b(j,O),N(T)===null&&O===N(j)&&(C?r():C=!0,n(P,W-U))):(O.sortIndex=te,b(T,O),m||tt||(m=!0,e(x))),O},t.unstable_wrapCallback=function(O){var A=G;return function(){var W=G;G=A;try{return O.apply(this,arguments)}finally{G=W}}}})(Fd);Ad.exports=Fd;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xl=J.exports,ee=vd,Se=Ad.exports;function k(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Xl)throw Error(k(227));var Rd=new Set,Gi={};function jn(t,e){Tr(t,e),Tr(t+"Capture",e)}function Tr(t,e){for(Gi[t]=e,t=0;t<e.length;t++)Rd.add(e[t])}var Mt=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),$m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zh=Object.prototype.hasOwnProperty,ec={},tc={};function Bm(t){return Zh.call(tc,t)?!0:Zh.call(ec,t)?!1:$m.test(t)?tc[t]=!0:(ec[t]=!0,!1)}function Gm(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Um(t,e,n,r){if(e===null||typeof e=="undefined"||Gm(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function je(t,e,n,r,i,l,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=l,this.removeEmptyString=s}var Oe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Oe[t]=new je(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Oe[e]=new je(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Oe[t]=new je(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Oe[t]=new je(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Oe[t]=new je(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Oe[t]=new je(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Oe[t]=new je(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Oe[t]=new je(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Oe[t]=new je(t,5,!1,t.toLowerCase(),null,!1,!1)});var Vu=/[\-:]([a-z])/g;function Wu(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Vu,Wu);Oe[e]=new je(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Vu,Wu);Oe[e]=new je(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Vu,Wu);Oe[e]=new je(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Oe[t]=new je(t,1,!1,t.toLowerCase(),null,!1,!1)});Oe.xlinkHref=new je("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Oe[t]=new je(t,1,!1,t.toLowerCase(),null,!0,!0)});function ju(t,e,n,r){var i=Oe.hasOwnProperty(e)?Oe[e]:null,l=i!==null?i.type===0:r?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");l||(Um(e,n,i,r)&&(n=null),r||i===null?Bm(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Mn=Xl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ei=60103,In=60106,nn=60107,Mu=60108,bi=60114,$u=60109,Bu=60110,Yl=60112,Ii=60113,xl=60120,Zl=60115,Gu=60116,Uu=60121,zu=60128,Dd=60129,qu=60130,$a=60131;if(typeof Symbol=="function"&&Symbol.for){var ve=Symbol.for;Ei=ve("react.element"),In=ve("react.portal"),nn=ve("react.fragment"),Mu=ve("react.strict_mode"),bi=ve("react.profiler"),$u=ve("react.provider"),Bu=ve("react.context"),Yl=ve("react.forward_ref"),Ii=ve("react.suspense"),xl=ve("react.suspense_list"),Zl=ve("react.memo"),Gu=ve("react.lazy"),Uu=ve("react.block"),ve("react.scope"),zu=ve("react.opaque.id"),Dd=ve("react.debug_trace_mode"),qu=ve("react.offscreen"),$a=ve("react.legacy_hidden")}var nc=typeof Symbol=="function"&&Symbol.iterator;function Yr(t){return t===null||typeof t!="object"?null:(t=nc&&t[nc]||t["@@iterator"],typeof t=="function"?t:null)}var qo;function Pi(t){if(qo===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);qo=e&&e[1]||""}return`
`+qo+t}var Ho=!1;function Fs(t,e){if(!t||Ho)return"";Ho=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(a){var r=a}Reflect.construct(t,[],e)}else{try{e.call()}catch(a){r=a}t.call(e.prototype)}else{try{throw Error()}catch(a){r=a}t()}}catch(a){if(a&&r&&typeof a.stack=="string"){for(var i=a.stack.split(`
`),l=r.stack.split(`
`),s=i.length-1,o=l.length-1;1<=s&&0<=o&&i[s]!==l[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==l[o]){if(s!==1||o!==1)do if(s--,o--,0>o||i[s]!==l[o])return`
`+i[s].replace(" at new "," at ");while(1<=s&&0<=o);break}}}finally{Ho=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Pi(t):""}function zm(t){switch(t.tag){case 5:return Pi(t.type);case 16:return Pi("Lazy");case 13:return Pi("Suspense");case 19:return Pi("SuspenseList");case 0:case 2:case 15:return t=Fs(t.type,!1),t;case 11:return t=Fs(t.type.render,!1),t;case 22:return t=Fs(t.type._render,!1),t;case 1:return t=Fs(t.type,!0),t;default:return""}}function gr(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case nn:return"Fragment";case In:return"Portal";case bi:return"Profiler";case Mu:return"StrictMode";case Ii:return"Suspense";case xl:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Bu:return(t.displayName||"Context")+".Consumer";case $u:return(t._context.displayName||"Context")+".Provider";case Yl:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case Zl:return gr(t.type);case Uu:return gr(t._render);case Gu:e=t._payload,t=t._init;try{return gr(t(e))}catch{}}return null}function gn(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function Ld(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function qm(t){var e=Ld(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,l=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,l.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Rs(t){t._valueTracker||(t._valueTracker=qm(t))}function Vd(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Ld(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Tl(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ba(t,e){var n=e.checked;return ee({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function rc(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=gn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Wd(t,e){e=e.checked,e!=null&&ju(t,"checked",e,!1)}function Ga(t,e){Wd(t,e);var n=gn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Ua(t,e.type,n):e.hasOwnProperty("defaultValue")&&Ua(t,e.type,gn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ic(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Ua(t,e,n){(e!=="number"||Tl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function Hm(t){var e="";return Xl.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}function za(t,e){return t=ee({children:void 0},e),(e=Hm(e.children))&&(t.children=e),t}function vr(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+gn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function qa(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(k(91));return ee({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function sc(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(k(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(k(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:gn(n)}}function jd(t,e){var n=gn(e.value),r=gn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function lc(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}var Ha={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Md(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ka(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Md(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ds,$d=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!==Ha.svg||"innerHTML"in t)t.innerHTML=e;else{for(Ds=Ds||document.createElement("div"),Ds.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ds.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ui(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ki={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Km=["Webkit","ms","Moz","O"];Object.keys(ki).forEach(function(t){Km.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ki[e]=ki[t]})});function Bd(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ki.hasOwnProperty(t)&&ki[t]?(""+e).trim():e+"px"}function Gd(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Bd(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Jm=ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ja(t,e){if(e){if(Jm[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(k(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(k(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(k(61))}if(e.style!=null&&typeof e.style!="object")throw Error(k(62))}}function Qa(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Hu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Xa=null,yr=null,Cr=null;function oc(t){if(t=as(t)){if(typeof Xa!="function")throw Error(k(280));var e=t.stateNode;e&&(e=so(e),Xa(t.stateNode,t.type,e))}}function Ud(t){yr?Cr?Cr.push(t):Cr=[t]:yr=t}function zd(){if(yr){var t=yr,e=Cr;if(Cr=yr=null,oc(t),e)for(t=0;t<e.length;t++)oc(e[t])}}function Ku(t,e){return t(e)}function qd(t,e,n,r,i){return t(e,n,r,i)}function Ju(){}var Hd=Ku,kn=!1,Ko=!1;function Qu(){(yr!==null||Cr!==null)&&(Ju(),zd())}function Qm(t,e,n){if(Ko)return t(e,n);Ko=!0;try{return Hd(t,e,n)}finally{Ko=!1,Qu()}}function zi(t,e){var n=t.stateNode;if(n===null)return null;var r=so(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(k(231,e,typeof n));return n}var Ya=!1;if(Mt)try{var Zr={};Object.defineProperty(Zr,"passive",{get:function(){Ya=!0}}),window.addEventListener("test",Zr,Zr),window.removeEventListener("test",Zr,Zr)}catch{Ya=!1}function Xm(t,e,n,r,i,l,s,o,a){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var Ai=!1,Nl=null,bl=!1,Za=null,Ym={onError:function(t){Ai=!0,Nl=t}};function Zm(t,e,n,r,i,l,s,o,a){Ai=!1,Nl=null,Xm.apply(Ym,arguments)}function eg(t,e,n,r,i,l,s,o,a){if(Zm.apply(this,arguments),Ai){if(Ai){var u=Nl;Ai=!1,Nl=null}else throw Error(k(198));bl||(bl=!0,Za=u)}}function $n(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&1026)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Kd(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ac(t){if($n(t)!==t)throw Error(k(188))}function tg(t){var e=t.alternate;if(!e){if(e=$n(t),e===null)throw Error(k(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var l=i.alternate;if(l===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===l.child){for(l=i.child;l;){if(l===n)return ac(i),t;if(l===r)return ac(i),e;l=l.sibling}throw Error(k(188))}if(n.return!==r.return)n=i,r=l;else{for(var s=!1,o=i.child;o;){if(o===n){s=!0,n=i,r=l;break}if(o===r){s=!0,r=i,n=l;break}o=o.sibling}if(!s){for(o=l.child;o;){if(o===n){s=!0,n=l,r=i;break}if(o===r){s=!0,r=l,n=i;break}o=o.sibling}if(!s)throw Error(k(189))}}if(n.alternate!==r)throw Error(k(190))}if(n.tag!==3)throw Error(k(188));return n.stateNode.current===n?t:e}function Jd(t){if(t=tg(t),!t)return null;for(var e=t;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function uc(t,e){for(var n=t.alternate;e!==null;){if(e===t||e===n)return!0;e=e.return}return!1}var Qd,Xu,Xd,Yd,eu=!1,Pt=[],on=null,an=null,un=null,qi=new Map,Hi=new Map,ei=[],hc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tu(t,e,n,r,i){return{blockedOn:t,domEventName:e,eventSystemFlags:n|16,nativeEvent:i,targetContainers:[r]}}function cc(t,e){switch(t){case"focusin":case"focusout":on=null;break;case"dragenter":case"dragleave":an=null;break;case"mouseover":case"mouseout":un=null;break;case"pointerover":case"pointerout":qi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hi.delete(e.pointerId)}}function ti(t,e,n,r,i,l){return t===null||t.nativeEvent!==l?(t=tu(e,n,r,i,l),e!==null&&(e=as(e),e!==null&&Xu(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function ng(t,e,n,r,i){switch(e){case"focusin":return on=ti(on,t,e,n,r,i),!0;case"dragenter":return an=ti(an,t,e,n,r,i),!0;case"mouseover":return un=ti(un,t,e,n,r,i),!0;case"pointerover":var l=i.pointerId;return qi.set(l,ti(qi.get(l)||null,t,e,n,r,i)),!0;case"gotpointercapture":return l=i.pointerId,Hi.set(l,ti(Hi.get(l)||null,t,e,n,r,i)),!0}return!1}function rg(t){var e=An(t.target);if(e!==null){var n=$n(e);if(n!==null){if(e=n.tag,e===13){if(e=Kd(n),e!==null){t.blockedOn=e,Yd(t.lanePriority,function(){Se.unstable_runWithPriority(t.priority,function(){Xd(n)})});return}}else if(e===3&&n.stateNode.hydrate){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ml(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=th(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null)return e=as(n),e!==null&&Xu(e),t.blockedOn=n,!1;e.shift()}return!0}function fc(t,e,n){ml(t)&&n.delete(e)}function ig(){for(eu=!1;0<Pt.length;){var t=Pt[0];if(t.blockedOn!==null){t=as(t.blockedOn),t!==null&&Qd(t);break}for(var e=t.targetContainers;0<e.length;){var n=th(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null){t.blockedOn=n;break}e.shift()}t.blockedOn===null&&Pt.shift()}on!==null&&ml(on)&&(on=null),an!==null&&ml(an)&&(an=null),un!==null&&ml(un)&&(un=null),qi.forEach(fc),Hi.forEach(fc)}function ni(t,e){t.blockedOn===e&&(t.blockedOn=null,eu||(eu=!0,Se.unstable_scheduleCallback(Se.unstable_NormalPriority,ig)))}function Zd(t){function e(i){return ni(i,t)}if(0<Pt.length){ni(Pt[0],t);for(var n=1;n<Pt.length;n++){var r=Pt[n];r.blockedOn===t&&(r.blockedOn=null)}}for(on!==null&&ni(on,t),an!==null&&ni(an,t),un!==null&&ni(un,t),qi.forEach(e),Hi.forEach(e),n=0;n<ei.length;n++)r=ei[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ei.length&&(n=ei[0],n.blockedOn===null);)rg(n),n.blockedOn===null&&ei.shift()}function Ls(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var hr={animationend:Ls("Animation","AnimationEnd"),animationiteration:Ls("Animation","AnimationIteration"),animationstart:Ls("Animation","AnimationStart"),transitionend:Ls("Transition","TransitionEnd")},Jo={},ep={};Mt&&(ep=document.createElement("div").style,"AnimationEvent"in window||(delete hr.animationend.animation,delete hr.animationiteration.animation,delete hr.animationstart.animation),"TransitionEvent"in window||delete hr.transitionend.transition);function eo(t){if(Jo[t])return Jo[t];if(!hr[t])return t;var e=hr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in ep)return Jo[t]=e[n];return t}var tp=eo("animationend"),np=eo("animationiteration"),rp=eo("animationstart"),ip=eo("transitionend"),sp=new Map,Yu=new Map,sg=["abort","abort",tp,"animationEnd",np,"animationIteration",rp,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ip,"transitionEnd","waiting","waiting"];function Zu(t,e){for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Yu.set(r,e),sp.set(r,i),jn(i,[r])}}var lg=Se.unstable_now;lg();var K=8;function ar(t){if((1&t)!==0)return K=15,1;if((2&t)!==0)return K=14,2;if((4&t)!==0)return K=13,4;var e=24&t;return e!==0?(K=12,e):(t&32)!==0?(K=11,32):(e=192&t,e!==0?(K=10,e):(t&256)!==0?(K=9,256):(e=3584&t,e!==0?(K=8,e):(t&4096)!==0?(K=7,4096):(e=4186112&t,e!==0?(K=6,e):(e=62914560&t,e!==0?(K=5,e):t&67108864?(K=4,67108864):(t&134217728)!==0?(K=3,134217728):(e=805306368&t,e!==0?(K=2,e):(1073741824&t)!==0?(K=1,1073741824):(K=8,t))))))}function og(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function ag(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(k(358,t))}}function Ki(t,e){var n=t.pendingLanes;if(n===0)return K=0;var r=0,i=0,l=t.expiredLanes,s=t.suspendedLanes,o=t.pingedLanes;if(l!==0)r=l,i=K=15;else if(l=n&134217727,l!==0){var a=l&~s;a!==0?(r=ar(a),i=K):(o&=l,o!==0&&(r=ar(o),i=K))}else l=n&~s,l!==0?(r=ar(l),i=K):o!==0&&(r=ar(o),i=K);if(r===0)return 0;if(r=31-vn(r),r=n&((0>r?0:1<<r)<<1)-1,e!==0&&e!==r&&(e&s)===0){if(ar(e),i<=K)return e;K=i}if(e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-vn(e),i=1<<n,r|=t[n],e&=~i;return r}function lp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Il(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return t=ur(24&~e),t===0?Il(10,e):t;case 10:return t=ur(192&~e),t===0?Il(8,e):t;case 8:return t=ur(3584&~e),t===0&&(t=ur(4186112&~e),t===0&&(t=512)),t;case 2:return e=ur(805306368&~e),e===0&&(e=268435456),e}throw Error(k(358,t))}function ur(t){return t&-t}function Qo(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function to(t,e,n){t.pendingLanes|=e;var r=e-1;t.suspendedLanes&=r,t.pingedLanes&=r,t=t.eventTimes,e=31-vn(e),t[e]=n}var vn=Math.clz32?Math.clz32:cg,ug=Math.log,hg=Math.LN2;function cg(t){return t===0?32:31-(ug(t)/hg|0)|0}var fg=Se.unstable_UserBlockingPriority,dg=Se.unstable_runWithPriority,gl=!0;function pg(t,e,n,r){kn||Ju();var i=eh,l=kn;kn=!0;try{qd(i,t,e,n,r)}finally{(kn=l)||Qu()}}function mg(t,e,n,r){dg(fg,eh.bind(null,t,e,n,r))}function eh(t,e,n,r){if(gl){var i;if((i=(e&4)===0)&&0<Pt.length&&-1<hc.indexOf(t))t=tu(null,t,e,n,r),Pt.push(t);else{var l=th(t,e,n,r);if(l===null)i&&cc(t,r);else{if(i){if(-1<hc.indexOf(t)){t=tu(l,t,e,n,r),Pt.push(t);return}if(ng(l,t,e,n,r))return;cc(t,r)}Cp(t,e,r,null,n)}}}}function th(t,e,n,r){var i=Hu(r);if(i=An(i),i!==null){var l=$n(i);if(l===null)i=null;else{var s=l.tag;if(s===13){if(i=Kd(l),i!==null)return i;i=null}else if(s===3){if(l.stateNode.hydrate)return l.tag===3?l.stateNode.containerInfo:null;i=null}else l!==i&&(i=null)}}return Cp(t,e,r,i,n),null}var rn=null,nh=null,vl=null;function op(){if(vl)return vl;var t,e=nh,n=e.length,r,i="value"in rn?rn.value:rn.textContent,l=i.length;for(t=0;t<n&&e[t]===i[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===i[l-r];r++);return vl=i.slice(t,1<r?1-r:void 0)}function yl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vs(){return!0}function dc(){return!1}function et(t){function e(n,r,i,l,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=l,this.target=s,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(l):l[o]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?Vs:dc,this.isPropagationStopped=dc,this}return ee(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vs)},persist:function(){},isPersistent:Vs}),e}var Rr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rh=et(Rr),os=ee({},Rr,{view:0,detail:0}),gg=et(os),Xo,Yo,ri,no=ee({},os,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ih,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ri&&(ri&&t.type==="mousemove"?(Xo=t.screenX-ri.screenX,Yo=t.screenY-ri.screenY):Yo=Xo=0,ri=t),Xo)},movementY:function(t){return"movementY"in t?t.movementY:Yo}}),pc=et(no),vg=ee({},no,{dataTransfer:0}),yg=et(vg),Cg=ee({},os,{relatedTarget:0}),Zo=et(Cg),Sg=ee({},Rr,{animationName:0,elapsedTime:0,pseudoElement:0}),wg=et(Sg),_g=ee({},Rr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Eg=et(_g),Pg=ee({},Rr,{data:0}),mc=et(Pg),Og={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ng(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Tg[t])?!!e[t]:!1}function ih(){return Ng}var bg=ee({},os,{key:function(t){if(t.key){var e=Og[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=yl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?xg[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ih,charCode:function(t){return t.type==="keypress"?yl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?yl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ig=et(bg),kg=ee({},no,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gc=et(kg),Ag=ee({},os,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ih}),Fg=et(Ag),Rg=ee({},Rr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Dg=et(Rg),Lg=ee({},no,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Vg=et(Lg),Wg=[9,13,27,32],sh=Mt&&"CompositionEvent"in window,Fi=null;Mt&&"documentMode"in document&&(Fi=document.documentMode);var jg=Mt&&"TextEvent"in window&&!Fi,ap=Mt&&(!sh||Fi&&8<Fi&&11>=Fi),vc=String.fromCharCode(32),yc=!1;function up(t,e){switch(t){case"keyup":return Wg.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hp(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var cr=!1;function Mg(t,e){switch(t){case"compositionend":return hp(e);case"keypress":return e.which!==32?null:(yc=!0,vc);case"textInput":return t=e.data,t===vc&&yc?null:t;default:return null}}function $g(t,e){if(cr)return t==="compositionend"||!sh&&up(t,e)?(t=op(),vl=nh=rn=null,cr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ap&&e.locale!=="ko"?null:e.data;default:return null}}var Bg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Bg[t.type]:e==="textarea"}function cp(t,e,n,r){Ud(r),e=kl(e,"onChange"),0<e.length&&(n=new rh("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ri=null,Ji=null;function Gg(t){gp(t,0)}function ro(t){var e=dr(t);if(Vd(e))return t}function Ug(t,e){if(t==="change")return e}var fp=!1;if(Mt){var ea;if(Mt){var ta="oninput"in document;if(!ta){var Sc=document.createElement("div");Sc.setAttribute("oninput","return;"),ta=typeof Sc.oninput=="function"}ea=ta}else ea=!1;fp=ea&&(!document.documentMode||9<document.documentMode)}function wc(){Ri&&(Ri.detachEvent("onpropertychange",dp),Ji=Ri=null)}function dp(t){if(t.propertyName==="value"&&ro(Ji)){var e=[];if(cp(e,Ji,t,Hu(t)),t=Gg,kn)t(e);else{kn=!0;try{Ku(t,e)}finally{kn=!1,Qu()}}}}function zg(t,e,n){t==="focusin"?(wc(),Ri=e,Ji=n,Ri.attachEvent("onpropertychange",dp)):t==="focusout"&&wc()}function qg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ro(Ji)}function Hg(t,e){if(t==="click")return ro(e)}function Kg(t,e){if(t==="input"||t==="change")return ro(e)}function Jg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var st=typeof Object.is=="function"?Object.is:Jg,Qg=Object.prototype.hasOwnProperty;function Qi(t,e){if(st(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Qg.call(e,n[r])||!st(t[n[r]],e[n[r]]))return!1;return!0}function _c(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ec(t,e){var n=_c(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_c(n)}}function pp(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pp(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Pc(){for(var t=window,e=Tl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Tl(t.document)}return e}function nu(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var Xg=Mt&&"documentMode"in document&&11>=document.documentMode,fr=null,ru=null,Di=null,iu=!1;function Oc(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;iu||fr==null||fr!==Tl(r)||(r=fr,"selectionStart"in r&&nu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Di&&Qi(Di,r)||(Di=r,r=kl(ru,"onSelect"),0<r.length&&(e=new rh("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=fr)))}Zu("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Zu("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Zu(sg,2);for(var xc="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),na=0;na<xc.length;na++)Yu.set(xc[na],0);Tr("onMouseEnter",["mouseout","mouseover"]);Tr("onMouseLeave",["mouseout","mouseover"]);Tr("onPointerEnter",["pointerout","pointerover"]);Tr("onPointerLeave",["pointerout","pointerover"]);jn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));jn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));jn("onBeforeInput",["compositionend","keypress","textInput","paste"]);jn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));jn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));jn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mp=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oi));function Tc(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,eg(r,e,void 0,t),t.currentTarget=null}function gp(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var l=void 0;if(e)for(var s=r.length-1;0<=s;s--){var o=r[s],a=o.instance,u=o.currentTarget;if(o=o.listener,a!==l&&i.isPropagationStopped())break e;Tc(i,o,u),l=a}else for(s=0;s<r.length;s++){if(o=r[s],a=o.instance,u=o.currentTarget,o=o.listener,a!==l&&i.isPropagationStopped())break e;Tc(i,o,u),l=a}}}if(bl)throw t=Za,bl=!1,Za=null,t}function X(t,e){var n=wp(e),r=t+"__bubble";n.has(r)||(yp(e,t,2,!1),n.add(r))}var Nc="_reactListening"+Math.random().toString(36).slice(2);function vp(t){t[Nc]||(t[Nc]=!0,Rd.forEach(function(e){mp.has(e)||bc(e,!1,t,null),bc(e,!0,t,null)}))}function bc(t,e,n,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=n;if(t==="selectionchange"&&n.nodeType!==9&&(l=n.ownerDocument),r!==null&&!e&&mp.has(t)){if(t!=="scroll")return;i|=2,l=r}var s=wp(l),o=t+"__"+(e?"capture":"bubble");s.has(o)||(e&&(i|=4),yp(l,t,i,e),s.add(o))}function yp(t,e,n,r){var i=Yu.get(e);switch(i===void 0?2:i){case 0:i=pg;break;case 1:i=mg;break;default:i=eh}n=i.bind(null,e,n,t),i=void 0,!Ya||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Cp(t,e,n,r,i){var l=r;if((e&1)===0&&(e&2)===0&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var a=s.tag;if((a===3||a===4)&&(a=s.stateNode.containerInfo,a===i||a.nodeType===8&&a.parentNode===i))return;s=s.return}for(;o!==null;){if(s=An(o),s===null)return;if(a=s.tag,a===5||a===6){r=l=s;continue e}o=o.parentNode}}r=r.return}Qm(function(){var u=l,h=Hu(n),p=[];e:{var c=sp.get(t);if(c!==void 0){var g=rh,S=t;switch(t){case"keypress":if(yl(n)===0)break e;case"keydown":case"keyup":g=Ig;break;case"focusin":S="focus",g=Zo;break;case"focusout":S="blur",g=Zo;break;case"beforeblur":case"afterblur":g=Zo;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=pc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=yg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=Fg;break;case tp:case np:case rp:g=wg;break;case ip:g=Dg;break;case"scroll":g=gg;break;case"wheel":g=Vg;break;case"copy":case"cut":case"paste":g=Eg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=gc}var E=(e&4)!==0,d=!E&&t==="scroll",f=E?c!==null?c+"Capture":null:c;E=[];for(var v=u,y;v!==null;){y=v;var w=y.stateNode;if(y.tag===5&&w!==null&&(y=w,f!==null&&(w=zi(v,f),w!=null&&E.push(Xi(v,w,y)))),d)break;v=v.return}0<E.length&&(c=new g(c,S,null,n,h),p.push({event:c,listeners:E}))}}if((e&7)===0){e:{if(c=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",c&&(e&16)===0&&(S=n.relatedTarget||n.fromElement)&&(An(S)||S[Dr]))break e;if((g||c)&&(c=h.window===h?h:(c=h.ownerDocument)?c.defaultView||c.parentWindow:window,g?(S=n.relatedTarget||n.toElement,g=u,S=S?An(S):null,S!==null&&(d=$n(S),S!==d||S.tag!==5&&S.tag!==6)&&(S=null)):(g=null,S=u),g!==S)){if(E=pc,w="onMouseLeave",f="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(E=gc,w="onPointerLeave",f="onPointerEnter",v="pointer"),d=g==null?c:dr(g),y=S==null?c:dr(S),c=new E(w,v+"leave",g,n,h),c.target=d,c.relatedTarget=y,w=null,An(h)===u&&(E=new E(f,v+"enter",S,n,h),E.target=y,E.relatedTarget=d,w=E),d=w,g&&S)t:{for(E=g,f=S,v=0,y=E;y;y=Xn(y))v++;for(y=0,w=f;w;w=Xn(w))y++;for(;0<v-y;)E=Xn(E),v--;for(;0<y-v;)f=Xn(f),y--;for(;v--;){if(E===f||f!==null&&E===f.alternate)break t;E=Xn(E),f=Xn(f)}E=null}else E=null;g!==null&&Ic(p,c,g,E,!1),S!==null&&d!==null&&Ic(p,d,S,E,!0)}}e:{if(c=u?dr(u):window,g=c.nodeName&&c.nodeName.toLowerCase(),g==="select"||g==="input"&&c.type==="file")var b=Ug;else if(Cc(c))if(fp)b=Kg;else{b=qg;var N=zg}else(g=c.nodeName)&&g.toLowerCase()==="input"&&(c.type==="checkbox"||c.type==="radio")&&(b=Hg);if(b&&(b=b(t,u))){cp(p,b,n,h);break e}N&&N(t,c,u),t==="focusout"&&(N=c._wrapperState)&&N.controlled&&c.type==="number"&&Ua(c,"number",c.value)}switch(N=u?dr(u):window,t){case"focusin":(Cc(N)||N.contentEditable==="true")&&(fr=N,ru=u,Di=null);break;case"focusout":Di=ru=fr=null;break;case"mousedown":iu=!0;break;case"contextmenu":case"mouseup":case"dragend":iu=!1,Oc(p,n,h);break;case"selectionchange":if(Xg)break;case"keydown":case"keyup":Oc(p,n,h)}var D;if(sh)e:{switch(t){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else cr?up(t,n)&&(I="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(ap&&n.locale!=="ko"&&(cr||I!=="onCompositionStart"?I==="onCompositionEnd"&&cr&&(D=op()):(rn=h,nh="value"in rn?rn.value:rn.textContent,cr=!0)),N=kl(u,I),0<N.length&&(I=new mc(I,t,null,n,h),p.push({event:I,listeners:N}),D?I.data=D:(D=hp(n),D!==null&&(I.data=D)))),(D=jg?Mg(t,n):$g(t,n))&&(u=kl(u,"onBeforeInput"),0<u.length&&(h=new mc("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:u}),h.data=D))}gp(p,e)})}function Xi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function kl(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,l=i.stateNode;i.tag===5&&l!==null&&(i=l,l=zi(t,n),l!=null&&r.unshift(Xi(t,l,i)),l=zi(t,e),l!=null&&r.push(Xi(t,l,i))),t=t.return}return r}function Xn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ic(t,e,n,r,i){for(var l=e._reactName,s=[];n!==null&&n!==r;){var o=n,a=o.alternate,u=o.stateNode;if(a!==null&&a===r)break;o.tag===5&&u!==null&&(o=u,i?(a=zi(n,l),a!=null&&s.unshift(Xi(n,a,o))):i||(a=zi(n,l),a!=null&&s.push(Xi(n,a,o)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}function Al(){}var ra=null,ia=null;function Sp(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function su(t,e){return t==="textarea"||t==="option"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var kc=typeof setTimeout=="function"?setTimeout:void 0,Yg=typeof clearTimeout=="function"?clearTimeout:void 0;function lh(t){t.nodeType===1?t.textContent="":t.nodeType===9&&(t=t.body,t!=null&&(t.textContent=""))}function Sr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break}return t}function Ac(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var sa=0;function Zg(t){return{$$typeof:zu,toString:t,valueOf:t}}var io=Math.random().toString(36).slice(2),sn="__reactFiber$"+io,Fl="__reactProps$"+io,Dr="__reactContainer$"+io,Fc="__reactEvents$"+io;function An(t){var e=t[sn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Dr]||n[sn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ac(t);t!==null;){if(n=t[sn])return n;t=Ac(t)}return e}t=n,n=t.parentNode}return null}function as(t){return t=t[sn]||t[Dr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function dr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(k(33))}function so(t){return t[Fl]||null}function wp(t){var e=t[Fc];return e===void 0&&(e=t[Fc]=new Set),e}var lu=[],pr=-1;function wn(t){return{current:t}}function Y(t){0>pr||(t.current=lu[pr],lu[pr]=null,pr--)}function le(t,e){pr++,lu[pr]=t.current,t.current=e}var yn={},ke=wn(yn),ze=wn(!1),Ln=yn;function Nr(t,e){var n=t.type.contextTypes;if(!n)return yn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},l;for(l in n)i[l]=e[l];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function qe(t){return t=t.childContextTypes,t!=null}function Rl(){Y(ze),Y(ke)}function Rc(t,e,n){if(ke.current!==yn)throw Error(k(168));le(ke,e),le(ze,n)}function _p(t,e,n){var r=t.stateNode;if(t=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(k(108,gr(e)||"Unknown",i));return ee({},n,r)}function Cl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||yn,Ln=ke.current,le(ke,t),le(ze,ze.current),!0}function Dc(t,e,n){var r=t.stateNode;if(!r)throw Error(k(169));n?(t=_p(t,e,Ln),r.__reactInternalMemoizedMergedChildContext=t,Y(ze),Y(ke),le(ke,t)):Y(ze),le(ze,n)}var oh=null,Dn=null,ev=Se.unstable_runWithPriority,ah=Se.unstable_scheduleCallback,ou=Se.unstable_cancelCallback,tv=Se.unstable_shouldYield,Lc=Se.unstable_requestPaint,au=Se.unstable_now,nv=Se.unstable_getCurrentPriorityLevel,lo=Se.unstable_ImmediatePriority,Ep=Se.unstable_UserBlockingPriority,Pp=Se.unstable_NormalPriority,Op=Se.unstable_LowPriority,xp=Se.unstable_IdlePriority,la={},rv=Lc!==void 0?Lc:function(){},Dt=null,Sl=null,oa=!1,Vc=au(),be=1e4>Vc?au:function(){return au()-Vc};function br(){switch(nv()){case lo:return 99;case Ep:return 98;case Pp:return 97;case Op:return 96;case xp:return 95;default:throw Error(k(332))}}function Tp(t){switch(t){case 99:return lo;case 98:return Ep;case 97:return Pp;case 96:return Op;case 95:return xp;default:throw Error(k(332))}}function Vn(t,e){return t=Tp(t),ev(t,e)}function Yi(t,e,n){return t=Tp(t),ah(t,e,n)}function bt(){if(Sl!==null){var t=Sl;Sl=null,ou(t)}Np()}function Np(){if(!oa&&Dt!==null){oa=!0;var t=0;try{var e=Dt;Vn(99,function(){for(;t<e.length;t++){var n=e[t];do n=n(!0);while(n!==null)}}),Dt=null}catch(n){throw Dt!==null&&(Dt=Dt.slice(t+1)),ah(lo,bt),n}finally{oa=!1}}}var iv=Mn.ReactCurrentBatchConfig;function yt(t,e){if(t&&t.defaultProps){e=ee({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Dl=wn(null),Ll=null,mr=null,Vl=null;function uh(){Vl=mr=Ll=null}function hh(t){var e=Dl.current;Y(Dl),t.type._context._currentValue=e}function bp(t,e){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)===e){if(n===null||(n.childLanes&e)===e)break;n.childLanes|=e}else t.childLanes|=e,n!==null&&(n.childLanes|=e);t=t.return}}function wr(t,e){Ll=t,Vl=mr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Ct=!0),t.firstContext=null)}function ut(t,e){if(Vl!==t&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Vl=t,e=1073741823),e={context:t,observedBits:e,next:null},mr===null){if(Ll===null)throw Error(k(308));mr=e,Ll.dependencies={lanes:0,firstContext:e,responders:null}}else mr=mr.next=e;return t._currentValue}var en=!1;function ch(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Ip(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function hn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function cn(t,e){if(t=t.updateQueue,t!==null){t=t.shared;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function Wc(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,l=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};l===null?i=l=s:l=l.next=s,n=n.next}while(n!==null);l===null?i=l=e:l=l.next=e}else i=l=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:l,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Zi(t,e,n,r){var i=t.updateQueue;en=!1;var l=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var a=o,u=a.next;a.next=null,s===null?l=u:s.next=u,s=a;var h=t.alternate;if(h!==null){h=h.updateQueue;var p=h.lastBaseUpdate;p!==s&&(p===null?h.firstBaseUpdate=u:p.next=u,h.lastBaseUpdate=a)}}if(l!==null){p=i.baseState,s=0,h=u=a=null;do{o=l.lane;var c=l.eventTime;if((r&o)===o){h!==null&&(h=h.next={eventTime:c,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var g=t,S=l;switch(o=e,c=n,S.tag){case 1:if(g=S.payload,typeof g=="function"){p=g.call(c,p,o);break e}p=g;break e;case 3:g.flags=g.flags&-4097|64;case 0:if(g=S.payload,o=typeof g=="function"?g.call(c,p,o):g,o==null)break e;p=ee({},p,o);break e;case 2:en=!0}}l.callback!==null&&(t.flags|=32,o=i.effects,o===null?i.effects=[l]:o.push(l))}else c={eventTime:c,lane:o,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=c,a=p):h=h.next=c,s|=o;if(l=l.next,l===null){if(o=i.shared.pending,o===null)break;l=o.next,o.next=null,i.lastBaseUpdate=o,i.shared.pending=null}}while(1);h===null&&(a=p),i.baseState=a,i.firstBaseUpdate=u,i.lastBaseUpdate=h,hs|=s,t.lanes=s,t.memoizedState=p}}function jc(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(k(191,i));i.call(r)}}}var kp=new Xl.Component().refs;function Wl(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ee({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var oo={isMounted:function(t){return(t=t._reactInternals)?$n(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ze(),i=fn(t),l=hn(r,i);l.payload=e,n!=null&&(l.callback=n),cn(t,l),dn(t,i,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ze(),i=fn(t),l=hn(r,i);l.tag=1,l.payload=e,n!=null&&(l.callback=n),cn(t,l),dn(t,i,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ze(),r=fn(t),i=hn(n,r);i.tag=2,e!=null&&(i.callback=e),cn(t,i),dn(t,r,n)}};function Mc(t,e,n,r,i,l,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,l,s):e.prototype&&e.prototype.isPureReactComponent?!Qi(n,r)||!Qi(i,l):!0}function Ap(t,e,n){var r=!1,i=yn,l=e.contextType;return typeof l=="object"&&l!==null?l=ut(l):(i=qe(e)?Ln:ke.current,r=e.contextTypes,l=(r=r!=null)?Nr(t,i):yn),e=new e(n,l),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=oo,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=l),e}function $c(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&oo.enqueueReplaceState(e,e.state,null)}function uu(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=kp,ch(t);var l=e.contextType;typeof l=="object"&&l!==null?i.context=ut(l):(l=qe(e)?Ln:ke.current,i.context=Nr(t,l)),Zi(t,n,i,r),i.state=t.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&(Wl(t,e,l,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&oo.enqueueReplaceState(i,i.state,null),Zi(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4)}var Ws=Array.isArray;function ii(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(k(309));var r=n.stateNode}if(!r)throw Error(k(147,t));var i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(l){var s=r.refs;s===kp&&(s=r.refs={}),l===null?delete s[i]:s[i]=l},e._stringRef=i,e)}if(typeof t!="string")throw Error(k(284));if(!n._owner)throw Error(k(290,t))}return t}function js(t,e){if(t.type!=="textarea")throw Error(k(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function Fp(t){function e(d,f){if(t){var v=d.lastEffect;v!==null?(v.nextEffect=f,d.lastEffect=f):d.firstEffect=d.lastEffect=f,f.nextEffect=null,f.flags=8}}function n(d,f){if(!t)return null;for(;f!==null;)e(d,f),f=f.sibling;return null}function r(d,f){for(d=new Map;f!==null;)f.key!==null?d.set(f.key,f):d.set(f.index,f),f=f.sibling;return d}function i(d,f){return d=Sn(d,f),d.index=0,d.sibling=null,d}function l(d,f,v){return d.index=v,t?(v=d.alternate,v!==null?(v=v.index,v<f?(d.flags=2,f):v):(d.flags=2,f)):f}function s(d){return t&&d.alternate===null&&(d.flags=2),d}function o(d,f,v,y){return f===null||f.tag!==6?(f=fa(v,d.mode,y),f.return=d,f):(f=i(f,v),f.return=d,f)}function a(d,f,v,y){return f!==null&&f.elementType===v.type?(y=i(f,v.props),y.ref=ii(d,f,v),y.return=d,y):(y=Pl(v.type,v.key,v.props,null,d.mode,y),y.ref=ii(d,f,v),y.return=d,y)}function u(d,f,v,y){return f===null||f.tag!==4||f.stateNode.containerInfo!==v.containerInfo||f.stateNode.implementation!==v.implementation?(f=da(v,d.mode,y),f.return=d,f):(f=i(f,v.children||[]),f.return=d,f)}function h(d,f,v,y,w){return f===null||f.tag!==7?(f=Or(v,d.mode,y,w),f.return=d,f):(f=i(f,v),f.return=d,f)}function p(d,f,v){if(typeof f=="string"||typeof f=="number")return f=fa(""+f,d.mode,v),f.return=d,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case Ei:return v=Pl(f.type,f.key,f.props,null,d.mode,v),v.ref=ii(d,null,f),v.return=d,v;case In:return f=da(f,d.mode,v),f.return=d,f}if(Ws(f)||Yr(f))return f=Or(f,d.mode,v,null),f.return=d,f;js(d,f)}return null}function c(d,f,v,y){var w=f!==null?f.key:null;if(typeof v=="string"||typeof v=="number")return w!==null?null:o(d,f,""+v,y);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ei:return v.key===w?v.type===nn?h(d,f,v.props.children,y,w):a(d,f,v,y):null;case In:return v.key===w?u(d,f,v,y):null}if(Ws(v)||Yr(v))return w!==null?null:h(d,f,v,y,null);js(d,v)}return null}function g(d,f,v,y,w){if(typeof y=="string"||typeof y=="number")return d=d.get(v)||null,o(f,d,""+y,w);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ei:return d=d.get(y.key===null?v:y.key)||null,y.type===nn?h(f,d,y.props.children,w,y.key):a(f,d,y,w);case In:return d=d.get(y.key===null?v:y.key)||null,u(f,d,y,w)}if(Ws(y)||Yr(y))return d=d.get(v)||null,h(f,d,y,w,null);js(f,y)}return null}function S(d,f,v,y){for(var w=null,b=null,N=f,D=f=0,I=null;N!==null&&D<v.length;D++){N.index>D?(I=N,N=null):I=N.sibling;var T=c(d,N,v[D],y);if(T===null){N===null&&(N=I);break}t&&N&&T.alternate===null&&e(d,N),f=l(T,f,D),b===null?w=T:b.sibling=T,b=T,N=I}if(D===v.length)return n(d,N),w;if(N===null){for(;D<v.length;D++)N=p(d,v[D],y),N!==null&&(f=l(N,f,D),b===null?w=N:b.sibling=N,b=N);return w}for(N=r(d,N);D<v.length;D++)I=g(N,d,D,v[D],y),I!==null&&(t&&I.alternate!==null&&N.delete(I.key===null?D:I.key),f=l(I,f,D),b===null?w=I:b.sibling=I,b=I);return t&&N.forEach(function(j){return e(d,j)}),w}function E(d,f,v,y){var w=Yr(v);if(typeof w!="function")throw Error(k(150));if(v=w.call(v),v==null)throw Error(k(151));for(var b=w=null,N=f,D=f=0,I=null,T=v.next();N!==null&&!T.done;D++,T=v.next()){N.index>D?(I=N,N=null):I=N.sibling;var j=c(d,N,T.value,y);if(j===null){N===null&&(N=I);break}t&&N&&j.alternate===null&&e(d,N),f=l(j,f,D),b===null?w=j:b.sibling=j,b=j,N=I}if(T.done)return n(d,N),w;if(N===null){for(;!T.done;D++,T=v.next())T=p(d,T.value,y),T!==null&&(f=l(T,f,D),b===null?w=T:b.sibling=T,b=T);return w}for(N=r(d,N);!T.done;D++,T=v.next())T=g(N,d,D,T.value,y),T!==null&&(t&&T.alternate!==null&&N.delete(T.key===null?D:T.key),f=l(T,f,D),b===null?w=T:b.sibling=T,b=T);return t&&N.forEach(function(Je){return e(d,Je)}),w}return function(d,f,v,y){var w=typeof v=="object"&&v!==null&&v.type===nn&&v.key===null;w&&(v=v.props.children);var b=typeof v=="object"&&v!==null;if(b)switch(v.$$typeof){case Ei:e:{for(b=v.key,w=f;w!==null;){if(w.key===b){switch(w.tag){case 7:if(v.type===nn){n(d,w.sibling),f=i(w,v.props.children),f.return=d,d=f;break e}break;default:if(w.elementType===v.type){n(d,w.sibling),f=i(w,v.props),f.ref=ii(d,w,v),f.return=d,d=f;break e}}n(d,w);break}else e(d,w);w=w.sibling}v.type===nn?(f=Or(v.props.children,d.mode,y,v.key),f.return=d,d=f):(y=Pl(v.type,v.key,v.props,null,d.mode,y),y.ref=ii(d,f,v),y.return=d,d=y)}return s(d);case In:e:{for(w=v.key;f!==null;){if(f.key===w)if(f.tag===4&&f.stateNode.containerInfo===v.containerInfo&&f.stateNode.implementation===v.implementation){n(d,f.sibling),f=i(f,v.children||[]),f.return=d,d=f;break e}else{n(d,f);break}else e(d,f);f=f.sibling}f=da(v,d.mode,y),f.return=d,d=f}return s(d)}if(typeof v=="string"||typeof v=="number")return v=""+v,f!==null&&f.tag===6?(n(d,f.sibling),f=i(f,v),f.return=d,d=f):(n(d,f),f=fa(v,d.mode,y),f.return=d,d=f),s(d);if(Ws(v))return S(d,f,v,y);if(Yr(v))return E(d,f,v,y);if(b&&js(d,v),typeof v=="undefined"&&!w)switch(d.tag){case 1:case 22:case 0:case 11:case 15:throw Error(k(152,gr(d.type)||"Component"))}return n(d,f)}}var jl=Fp(!0),Rp=Fp(!1),us={},Tt=wn(us),es=wn(us),ts=wn(us);function Fn(t){if(t===us)throw Error(k(174));return t}function hu(t,e){switch(le(ts,e),le(es,t),le(Tt,us),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ka(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ka(e,t)}Y(Tt),le(Tt,e)}function Ir(){Y(Tt),Y(es),Y(ts)}function Bc(t){Fn(ts.current);var e=Fn(Tt.current),n=Ka(e,t.type);e!==n&&(le(es,t),le(Tt,n))}function fh(t){es.current===t&&(Y(Tt),Y(es))}var se=wn(0);function Ml(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Vt=null,ln=null,Nt=!1;function Dp(t,e){var n=lt(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.flags=8,t.lastEffect!==null?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function Gc(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function cu(t){if(Nt){var e=ln;if(e){var n=e;if(!Gc(t,e)){if(e=Sr(n.nextSibling),!e||!Gc(t,e)){t.flags=t.flags&-1025|2,Nt=!1,Vt=t;return}Dp(Vt,n)}Vt=t,ln=Sr(e.firstChild)}else t.flags=t.flags&-1025|2,Nt=!1,Vt=t}}function Uc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Vt=t}function Ms(t){if(t!==Vt)return!1;if(!Nt)return Uc(t),Nt=!0,!1;var e=t.type;if(t.tag!==5||e!=="head"&&e!=="body"&&!su(e,t.memoizedProps))for(e=ln;e;)Dp(t,e),e=Sr(e.nextSibling);if(Uc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(k(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ln=Sr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ln=null}}else ln=Vt?Sr(t.stateNode.nextSibling):null;return!0}function aa(){ln=Vt=null,Nt=!1}var _r=[];function dh(){for(var t=0;t<_r.length;t++)_r[t]._workInProgressVersionPrimary=null;_r.length=0}var Li=Mn.ReactCurrentDispatcher,ot=Mn.ReactCurrentBatchConfig,ns=0,oe=null,Ne=null,Ee=null,$l=!1,Vi=!1;function $e(){throw Error(k(321))}function ph(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!st(t[n],e[n]))return!1;return!0}function mh(t,e,n,r,i,l){if(ns=l,oe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Li.current=t===null||t.memoizedState===null?lv:ov,t=n(r,i),Vi){l=0;do{if(Vi=!1,!(25>l))throw Error(k(301));l+=1,Ee=Ne=null,e.updateQueue=null,Li.current=av,t=n(r,i)}while(Vi)}if(Li.current=zl,e=Ne!==null&&Ne.next!==null,ns=0,Ee=Ne=oe=null,$l=!1,e)throw Error(k(300));return t}function Rn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ee===null?oe.memoizedState=Ee=t:Ee=Ee.next=t,Ee}function Bn(){if(Ne===null){var t=oe.alternate;t=t!==null?t.memoizedState:null}else t=Ne.next;var e=Ee===null?oe.memoizedState:Ee.next;if(e!==null)Ee=e,Ne=t;else{if(t===null)throw Error(k(310));Ne=t,t={memoizedState:Ne.memoizedState,baseState:Ne.baseState,baseQueue:Ne.baseQueue,queue:Ne.queue,next:null},Ee===null?oe.memoizedState=Ee=t:Ee=Ee.next=t}return Ee}function Ot(t,e){return typeof e=="function"?e(t):e}function si(t){var e=Bn(),n=e.queue;if(n===null)throw Error(k(311));n.lastRenderedReducer=t;var r=Ne,i=r.baseQueue,l=n.pending;if(l!==null){if(i!==null){var s=i.next;i.next=l.next,l.next=s}r.baseQueue=i=l,n.pending=null}if(i!==null){i=i.next,r=r.baseState;var o=s=l=null,a=i;do{var u=a.lane;if((ns&u)===u)o!==null&&(o=o.next={lane:0,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null}),r=a.eagerReducer===t?a.eagerState:t(r,a.action);else{var h={lane:u,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null};o===null?(s=o=h,l=r):o=o.next=h,oe.lanes|=u,hs|=u}a=a.next}while(a!==null&&a!==i);o===null?l=r:o.next=s,st(r,e.memoizedState)||(Ct=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=o,n.lastRenderedState=r}return[e.memoizedState,n.dispatch]}function li(t){var e=Bn(),n=e.queue;if(n===null)throw Error(k(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,l=e.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do l=t(l,s.action),s=s.next;while(s!==i);st(l,e.memoizedState)||(Ct=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),n.lastRenderedState=l}return[l,r]}function zc(t,e,n){var r=e._getVersion;r=r(e._source);var i=e._workInProgressVersionPrimary;if(i!==null?t=i===r:(t=t.mutableReadLanes,(t=(ns&t)===t)&&(e._workInProgressVersionPrimary=r,_r.push(e))),t)return n(e._source);throw _r.push(e),Error(k(350))}function Lp(t,e,n,r){var i=We;if(i===null)throw Error(k(349));var l=e._getVersion,s=l(e._source),o=Li.current,a=o.useState(function(){return zc(i,e,n)}),u=a[1],h=a[0];a=Ee;var p=t.memoizedState,c=p.refs,g=c.getSnapshot,S=p.source;p=p.subscribe;var E=oe;return t.memoizedState={refs:c,source:e,subscribe:r},o.useEffect(function(){c.getSnapshot=n,c.setSnapshot=u;var d=l(e._source);if(!st(s,d)){d=n(e._source),st(h,d)||(u(d),d=fn(E),i.mutableReadLanes|=d&i.pendingLanes),d=i.mutableReadLanes,i.entangledLanes|=d;for(var f=i.entanglements,v=d;0<v;){var y=31-vn(v),w=1<<y;f[y]|=d,v&=~w}}},[n,e,r]),o.useEffect(function(){return r(e._source,function(){var d=c.getSnapshot,f=c.setSnapshot;try{f(d(e._source));var v=fn(E);i.mutableReadLanes|=v&i.pendingLanes}catch(y){f(function(){throw y})}})},[e,r]),st(g,n)&&st(S,e)&&st(p,r)||(t={pending:null,dispatch:null,lastRenderedReducer:Ot,lastRenderedState:h},t.dispatch=u=yh.bind(null,oe,t),a.queue=t,a.baseQueue=null,h=zc(i,e,n),a.memoizedState=a.baseState=h),h}function Vp(t,e,n){var r=Bn();return Lp(r,t,e,n)}function oi(t){var e=Rn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t=e.queue={pending:null,dispatch:null,lastRenderedReducer:Ot,lastRenderedState:t},t=t.dispatch=yh.bind(null,oe,t),[e.memoizedState,t]}function Bl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=oe.updateQueue,e===null?(e={lastEffect:null},oe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function qc(t){var e=Rn();return t={current:t},e.memoizedState=t}function Gl(){return Bn().memoizedState}function fu(t,e,n,r){var i=Rn();oe.flags|=t,i.memoizedState=Bl(1|e,n,void 0,r===void 0?null:r)}function gh(t,e,n,r){var i=Bn();r=r===void 0?null:r;var l=void 0;if(Ne!==null){var s=Ne.memoizedState;if(l=s.destroy,r!==null&&ph(r,s.deps)){Bl(e,n,l,r);return}}oe.flags|=t,i.memoizedState=Bl(1|e,n,l,r)}function Hc(t,e){return fu(516,4,t,e)}function Ul(t,e){return gh(516,4,t,e)}function Wp(t,e){return gh(4,2,t,e)}function jp(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Mp(t,e,n){return n=n!=null?n.concat([t]):null,gh(4,2,jp.bind(null,e,t),n)}function vh(){}function $p(t,e){var n=Bn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ph(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Bp(t,e){var n=Bn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ph(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function sv(t,e){var n=br();Vn(98>n?98:n,function(){t(!0)}),Vn(97<n?97:n,function(){var r=ot.transition;ot.transition=1;try{t(!1),e()}finally{ot.transition=r}})}function yh(t,e,n){var r=Ze(),i=fn(t),l={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},s=e.pending;if(s===null?l.next=l:(l.next=s.next,s.next=l),e.pending=l,s=t.alternate,t===oe||s!==null&&s===oe)Vi=$l=!0;else{if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(l.eagerReducer=s,l.eagerState=a,st(a,o))return}catch{}finally{}dn(t,i,r)}}var zl={readContext:ut,useCallback:$e,useContext:$e,useEffect:$e,useImperativeHandle:$e,useLayoutEffect:$e,useMemo:$e,useReducer:$e,useRef:$e,useState:$e,useDebugValue:$e,useDeferredValue:$e,useTransition:$e,useMutableSource:$e,useOpaqueIdentifier:$e,unstable_isNewReconciler:!1},lv={readContext:ut,useCallback:function(t,e){return Rn().memoizedState=[t,e===void 0?null:e],t},useContext:ut,useEffect:Hc,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,fu(4,2,jp.bind(null,e,t),n)},useLayoutEffect:function(t,e){return fu(4,2,t,e)},useMemo:function(t,e){var n=Rn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Rn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},t=t.dispatch=yh.bind(null,oe,t),[r.memoizedState,t]},useRef:qc,useState:oi,useDebugValue:vh,useDeferredValue:function(t){var e=oi(t),n=e[0],r=e[1];return Hc(function(){var i=ot.transition;ot.transition=1;try{r(t)}finally{ot.transition=i}},[t]),n},useTransition:function(){var t=oi(!1),e=t[0];return t=sv.bind(null,t[1]),qc(t),[t,e]},useMutableSource:function(t,e,n){var r=Rn();return r.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:n},Lp(r,t,e,n)},useOpaqueIdentifier:function(){if(Nt){var t=!1,e=Zg(function(){throw t||(t=!0,n("r:"+(sa++).toString(36))),Error(k(355))}),n=oi(e)[1];return(oe.mode&2)===0&&(oe.flags|=516,Bl(5,function(){n("r:"+(sa++).toString(36))},void 0,null)),e}return e="r:"+(sa++).toString(36),oi(e),e},unstable_isNewReconciler:!1},ov={readContext:ut,useCallback:$p,useContext:ut,useEffect:Ul,useImperativeHandle:Mp,useLayoutEffect:Wp,useMemo:Bp,useReducer:si,useRef:Gl,useState:function(){return si(Ot)},useDebugValue:vh,useDeferredValue:function(t){var e=si(Ot),n=e[0],r=e[1];return Ul(function(){var i=ot.transition;ot.transition=1;try{r(t)}finally{ot.transition=i}},[t]),n},useTransition:function(){var t=si(Ot)[0];return[Gl().current,t]},useMutableSource:Vp,useOpaqueIdentifier:function(){return si(Ot)[0]},unstable_isNewReconciler:!1},av={readContext:ut,useCallback:$p,useContext:ut,useEffect:Ul,useImperativeHandle:Mp,useLayoutEffect:Wp,useMemo:Bp,useReducer:li,useRef:Gl,useState:function(){return li(Ot)},useDebugValue:vh,useDeferredValue:function(t){var e=li(Ot),n=e[0],r=e[1];return Ul(function(){var i=ot.transition;ot.transition=1;try{r(t)}finally{ot.transition=i}},[t]),n},useTransition:function(){var t=li(Ot)[0];return[Gl().current,t]},useMutableSource:Vp,useOpaqueIdentifier:function(){return li(Ot)[0]},unstable_isNewReconciler:!1},uv=Mn.ReactCurrentOwner,Ct=!1;function Ue(t,e,n,r){e.child=t===null?Rp(e,null,n,r):jl(e,t.child,n,r)}function Kc(t,e,n,r,i){n=n.render;var l=e.ref;return wr(e,i),r=mh(t,e,n,r,l,i),t!==null&&!Ct?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,Wt(t,e,i)):(e.flags|=1,Ue(t,e,r,i),e.child)}function Jc(t,e,n,r,i,l){if(t===null){var s=n.type;return typeof s=="function"&&!Ph(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Gp(t,e,s,r,i,l)):(t=Pl(n.type,null,r,e,e.mode,l),t.ref=e.ref,t.return=e,e.child=t)}return s=t.child,(i&l)===0&&(i=s.memoizedProps,n=n.compare,n=n!==null?n:Qi,n(i,r)&&t.ref===e.ref)?Wt(t,e,l):(e.flags|=1,t=Sn(s,r),t.ref=e.ref,t.return=e,e.child=t)}function Gp(t,e,n,r,i,l){if(t!==null&&Qi(t.memoizedProps,r)&&t.ref===e.ref)if(Ct=!1,(l&i)!==0)(t.flags&16384)!==0&&(Ct=!0);else return e.lanes=t.lanes,Wt(t,e,l);return du(t,e,n,r,l)}function ua(t,e,n){var r=e.pendingProps,i=r.children,l=t!==null?t.memoizedState:null;if(r.mode==="hidden"||r.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},Bs(e,n);else if((n&1073741824)!==0)e.memoizedState={baseLanes:0},Bs(e,l!==null?l.baseLanes:n);else return t=l!==null?l.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},Bs(e,t),null;else l!==null?(r=l.baseLanes|n,e.memoizedState=null):r=n,Bs(e,r);return Ue(t,e,i,n),e.child}function Up(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=128)}function du(t,e,n,r,i){var l=qe(n)?Ln:ke.current;return l=Nr(e,l),wr(e,i),n=mh(t,e,n,r,l,i),t!==null&&!Ct?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,Wt(t,e,i)):(e.flags|=1,Ue(t,e,n,i),e.child)}function Qc(t,e,n,r,i){if(qe(n)){var l=!0;Cl(e)}else l=!1;if(wr(e,i),e.stateNode===null)t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),Ap(e,n,r),uu(e,n,r,i),r=!0;else if(t===null){var s=e.stateNode,o=e.memoizedProps;s.props=o;var a=s.context,u=n.contextType;typeof u=="object"&&u!==null?u=ut(u):(u=qe(n)?Ln:ke.current,u=Nr(e,u));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o!==r||a!==u)&&$c(e,s,r,u),en=!1;var c=e.memoizedState;s.state=c,Zi(e,r,s,i),a=e.memoizedState,o!==r||c!==a||ze.current||en?(typeof h=="function"&&(Wl(e,n,h,r),a=e.memoizedState),(o=en||Mc(e,n,o,r,c,a,u))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4)):(typeof s.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=r,e.memoizedState=a),s.props=r,s.state=a,s.context=u,r=o):(typeof s.componentDidMount=="function"&&(e.flags|=4),r=!1)}else{s=e.stateNode,Ip(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:yt(e.type,o),s.props=u,p=e.pendingProps,c=s.context,a=n.contextType,typeof a=="object"&&a!==null?a=ut(a):(a=qe(n)?Ln:ke.current,a=Nr(e,a));var g=n.getDerivedStateFromProps;(h=typeof g=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o!==p||c!==a)&&$c(e,s,r,a),en=!1,c=e.memoizedState,s.state=c,Zi(e,r,s,i);var S=e.memoizedState;o!==p||c!==S||ze.current||en?(typeof g=="function"&&(Wl(e,n,g,r),S=e.memoizedState),(u=en||Mc(e,n,u,r,c,S,a))?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,S,a),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,S,a)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof s.componentDidUpdate!="function"||o===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),e.memoizedProps=r,e.memoizedState=S),s.props=r,s.state=S,s.context=a,r=u):(typeof s.componentDidUpdate!="function"||o===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),r=!1)}return pu(t,e,n,r,l,i)}function pu(t,e,n,r,i,l){Up(t,e);var s=(e.flags&64)!==0;if(!r&&!s)return i&&Dc(e,n,!1),Wt(t,e,l);r=e.stateNode,uv.current=e;var o=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=jl(e,t.child,null,l),e.child=jl(e,null,o,l)):Ue(t,e,o,l),e.memoizedState=r.state,i&&Dc(e,n,!0),e.child}function Xc(t){var e=t.stateNode;e.pendingContext?Rc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Rc(t,e.context,!1),hu(t,e.containerInfo)}var $s={dehydrated:null,retryLane:0};function Yc(t,e,n){var r=e.pendingProps,i=se.current,l=!1,s;return(s=(e.flags&64)!==0)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(l=!0,e.flags&=-65):t!==null&&t.memoizedState===null||r.fallback===void 0||r.unstable_avoidThisFallback===!0||(i|=1),le(se,i&1),t===null?(r.fallback!==void 0&&cu(e),t=r.children,i=r.fallback,l?(t=Zc(e,t,i,n),e.child.memoizedState={baseLanes:n},e.memoizedState=$s,t):typeof r.unstable_expectedLoadTime=="number"?(t=Zc(e,t,i,n),e.child.memoizedState={baseLanes:n},e.memoizedState=$s,e.lanes=33554432,t):(n=Oh({mode:"visible",children:t},e.mode,n,null),n.return=e,e.child=n)):t.memoizedState!==null?l?(r=tf(t,e,r.children,r.fallback,n),l=e.child,i=t.child.memoizedState,l.memoizedState=i===null?{baseLanes:n}:{baseLanes:i.baseLanes|n},l.childLanes=t.childLanes&~n,e.memoizedState=$s,r):(n=ef(t,e,r.children,n),e.memoizedState=null,n):l?(r=tf(t,e,r.children,r.fallback,n),l=e.child,i=t.child.memoizedState,l.memoizedState=i===null?{baseLanes:n}:{baseLanes:i.baseLanes|n},l.childLanes=t.childLanes&~n,e.memoizedState=$s,r):(n=ef(t,e,r.children,n),e.memoizedState=null,n)}function Zc(t,e,n,r){var i=t.mode,l=t.child;return e={mode:"hidden",children:e},(i&2)===0&&l!==null?(l.childLanes=0,l.pendingProps=e):l=Oh(e,i,0,null),n=Or(n,i,r,null),l.return=t,n.return=t,l.sibling=n,t.child=l,n}function ef(t,e,n,r){var i=t.child;return t=i.sibling,n=Sn(i,{mode:"visible",children:n}),(e.mode&2)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=n}function tf(t,e,n,r,i){var l=e.mode,s=t.child;t=s.sibling;var o={mode:"hidden",children:n};return(l&2)===0&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=o,s=n.lastEffect,s!==null?(e.firstEffect=n.firstEffect,e.lastEffect=s,s.nextEffect=null):e.firstEffect=e.lastEffect=null):n=Sn(s,o),t!==null?r=Sn(t,r):(r=Or(r,l,i,null),r.flags|=2),r.return=e,n.return=e,n.sibling=r,e.child=n,r}function nf(t,e){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),bp(t.return,e)}function ha(t,e,n,r,i,l){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:l}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i,s.lastEffect=l)}function rf(t,e,n){var r=e.pendingProps,i=r.revealOrder,l=r.tail;if(Ue(t,e,r.children,n),r=se.current,(r&2)!==0)r=r&1|2,e.flags|=64;else{if(t!==null&&(t.flags&64)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&nf(t,n);else if(t.tag===19)nf(t,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(le(se,r),(e.mode&2)===0)e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Ml(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),ha(e,!1,i,n,l,e.lastEffect);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Ml(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}ha(e,!0,n,null,l,e.lastEffect);break;case"together":ha(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Wt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),hs|=e.lanes,(n&e.childLanes)!==0){if(t!==null&&e.child!==t.child)throw Error(k(153));if(e.child!==null){for(t=e.child,n=Sn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Sn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}return null}var zp,mu,qp,Hp;zp=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};mu=function(){};qp=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Fn(Tt.current);var l=null;switch(n){case"input":i=Ba(t,i),r=Ba(t,r),l=[];break;case"option":i=za(t,i),r=za(t,r),l=[];break;case"select":i=ee({},i,{value:void 0}),r=ee({},r,{value:void 0}),l=[];break;case"textarea":i=qa(t,i),r=qa(t,r),l=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Al)}Ja(n,r);var s;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var o=i[u];for(s in o)o.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Gi.hasOwnProperty(u)?l||(l=[]):(l=l||[]).push(u,null));for(u in r){var a=r[u];if(o=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&a!==o&&(a!=null||o!=null))if(u==="style")if(o){for(s in o)!o.hasOwnProperty(s)||a&&a.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in a)a.hasOwnProperty(s)&&o[s]!==a[s]&&(n||(n={}),n[s]=a[s])}else n||(l||(l=[]),l.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,o=o?o.__html:void 0,a!=null&&o!==a&&(l=l||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(l=l||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Gi.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&X("scroll",t),l||o===a||(l=[])):typeof a=="object"&&a!==null&&a.$$typeof===zu?a.toString():(l=l||[]).push(u,a))}n&&(l=l||[]).push("style",n);var u=l;(e.updateQueue=u)&&(e.flags|=4)}};Hp=function(t,e,n,r){n!==r&&(e.flags|=4)};function ai(t,e){if(!Nt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function hv(t,e,n){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return qe(e.type)&&Rl(),null;case 3:return Ir(),Y(ze),Y(ke),dh(),r=e.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Ms(e)?e.flags|=4:r.hydrate||(e.flags|=256)),mu(e),null;case 5:fh(e);var i=Fn(ts.current);if(n=e.type,t!==null&&e.stateNode!=null)qp(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=128);else{if(!r){if(e.stateNode===null)throw Error(k(166));return null}if(t=Fn(Tt.current),Ms(e)){r=e.stateNode,n=e.type;var l=e.memoizedProps;switch(r[sn]=e,r[Fl]=l,n){case"dialog":X("cancel",r),X("close",r);break;case"iframe":case"object":case"embed":X("load",r);break;case"video":case"audio":for(t=0;t<Oi.length;t++)X(Oi[t],r);break;case"source":X("error",r);break;case"img":case"image":case"link":X("error",r),X("load",r);break;case"details":X("toggle",r);break;case"input":rc(r,l),X("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!l.multiple},X("invalid",r);break;case"textarea":sc(r,l),X("invalid",r)}Ja(n,l),t=null;for(var s in l)l.hasOwnProperty(s)&&(i=l[s],s==="children"?typeof i=="string"?r.textContent!==i&&(t=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(t=["children",""+i]):Gi.hasOwnProperty(s)&&i!=null&&s==="onScroll"&&X("scroll",r));switch(n){case"input":Rs(r),ic(r,l,!0);break;case"textarea":Rs(r),lc(r);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(r.onclick=Al)}r=t,e.updateQueue=r,r!==null&&(e.flags|=4)}else{switch(s=i.nodeType===9?i:i.ownerDocument,t===Ha.html&&(t=Md(n)),t===Ha.html?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[sn]=e,t[Fl]=r,zp(t,e,!1,!1),e.stateNode=t,s=Qa(n,r),n){case"dialog":X("cancel",t),X("close",t),i=r;break;case"iframe":case"object":case"embed":X("load",t),i=r;break;case"video":case"audio":for(i=0;i<Oi.length;i++)X(Oi[i],t);i=r;break;case"source":X("error",t),i=r;break;case"img":case"image":case"link":X("error",t),X("load",t),i=r;break;case"details":X("toggle",t),i=r;break;case"input":rc(t,r),i=Ba(t,r),X("invalid",t);break;case"option":i=za(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ee({},r,{value:void 0}),X("invalid",t);break;case"textarea":sc(t,r),i=qa(t,r),X("invalid",t);break;default:i=r}Ja(n,i);var o=i;for(l in o)if(o.hasOwnProperty(l)){var a=o[l];l==="style"?Gd(t,a):l==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&$d(t,a)):l==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&Ui(t,a):typeof a=="number"&&Ui(t,""+a):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Gi.hasOwnProperty(l)?a!=null&&l==="onScroll"&&X("scroll",t):a!=null&&ju(t,l,a,s))}switch(n){case"input":Rs(t),ic(t,r,!1);break;case"textarea":Rs(t),lc(t);break;case"option":r.value!=null&&t.setAttribute("value",""+gn(r.value));break;case"select":t.multiple=!!r.multiple,l=r.value,l!=null?vr(t,!!r.multiple,l,!1):r.defaultValue!=null&&vr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Al)}Sp(n,r)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(t&&e.stateNode!=null)Hp(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(k(166));n=Fn(ts.current),Fn(Tt.current),Ms(e)?(r=e.stateNode,n=e.memoizedProps,r[sn]=e,r.nodeValue!==n&&(e.flags|=4)):(r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[sn]=e,e.stateNode=r)}return null;case 13:return Y(se),r=e.memoizedState,(e.flags&64)!==0?(e.lanes=n,e):(r=r!==null,n=!1,t===null?e.memoizedProps.fallback!==void 0&&Ms(e):n=t.memoizedState!==null,r&&!n&&(e.mode&2)!==0&&(t===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(se.current&1)!==0?Pe===0&&(Pe=3):((Pe===0||Pe===3)&&(Pe=4),We===null||(hs&134217727)===0&&(Vr&134217727)===0||Er(We,Ie))),(r||n)&&(e.flags|=4),null);case 4:return Ir(),mu(e),t===null&&vp(e.stateNode.containerInfo),null;case 10:return hh(e),null;case 17:return qe(e.type)&&Rl(),null;case 19:if(Y(se),r=e.memoizedState,r===null)return null;if(l=(e.flags&64)!==0,s=r.rendering,s===null)if(l)ai(r,!1);else{if(Pe!==0||t!==null&&(t.flags&64)!==0)for(t=e.child;t!==null;){if(s=Ml(t),s!==null){for(e.flags|=64,ai(r,!1),l=s.updateQueue,l!==null&&(e.updateQueue=l,e.flags|=4),r.lastEffect===null&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=n,n=e.child;n!==null;)l=n,t=r,l.flags&=2,l.nextEffect=null,l.firstEffect=null,l.lastEffect=null,s=l.alternate,s===null?(l.childLanes=0,l.lanes=t,l.child=null,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,l.type=s.type,t=s.dependencies,l.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return le(se,se.current&1|2),e.child}t=t.sibling}r.tail!==null&&be()>wu&&(e.flags|=64,l=!0,ai(r,!1),e.lanes=33554432)}else{if(!l)if(t=Ml(s),t!==null){if(e.flags|=64,l=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ai(r,!0),r.tail===null&&r.tailMode==="hidden"&&!s.alternate&&!Nt)return e=e.lastEffect=r.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*be()-r.renderingStartTime>wu&&n!==1073741824&&(e.flags|=64,l=!0,ai(r,!1),e.lanes=33554432);r.isBackwards?(s.sibling=e.child,e.child=s):(n=r.last,n!==null?n.sibling=s:e.child=s,r.last=s)}return r.tail!==null?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=be(),n.sibling=null,e=se.current,le(se,l?e&1|2:e&1),n):null;case 23:case 24:return Eh(),t!==null&&t.memoizedState!==null!=(e.memoizedState!==null)&&r.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(k(156,e.tag))}function cv(t){switch(t.tag){case 1:qe(t.type)&&Rl();var e=t.flags;return e&4096?(t.flags=e&-4097|64,t):null;case 3:if(Ir(),Y(ze),Y(ke),dh(),e=t.flags,(e&64)!==0)throw Error(k(285));return t.flags=e&-4097|64,t;case 5:return fh(t),null;case 13:return Y(se),e=t.flags,e&4096?(t.flags=e&-4097|64,t):null;case 19:return Y(se),null;case 4:return Ir(),null;case 10:return hh(t),null;case 23:case 24:return Eh(),null;default:return null}}function Ch(t,e){try{var n="",r=e;do n+=zm(r),r=r.return;while(r);var i=n}catch(l){i=`
Error generating stack: `+l.message+`
`+l.stack}return{value:t,source:e,stack:i}}function gu(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var fv=typeof WeakMap=="function"?WeakMap:Map;function Kp(t,e,n){n=hn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Hl||(Hl=!0,_u=r),gu(t,e)},n}function Jp(t,e,n){n=hn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return gu(t,e),r(i)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(n.callback=function(){typeof r!="function"&&(xt===null?xt=new Set([this]):xt.add(this),gu(t,e));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}var dv=typeof WeakSet=="function"?WeakSet:Set;function sf(t){var e=t.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(n){pn(t,n)}else e.current=null}function pv(t,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&t!==null){var n=t.memoizedProps,r=t.memoizedState;t=e.stateNode,e=t.getSnapshotBeforeUpdate(e.elementType===e.type?n:yt(e.type,n),r),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&lh(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(k(163))}function mv(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{if((t.tag&3)===3){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{var i=t;r=i.next,i=i.tag,(i&4)!==0&&(i&1)!==0&&(im(n,t),Ev(n,t)),t=r}while(t!==e)}return;case 1:t=n.stateNode,n.flags&4&&(e===null?t.componentDidMount():(r=n.elementType===n.type?e.memoizedProps:yt(n.type,e.memoizedProps),t.componentDidUpdate(r,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),e=n.updateQueue,e!==null&&jc(n,e,t);return;case 3:if(e=n.updateQueue,e!==null){if(t=null,n.child!==null)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}jc(n,e,t)}return;case 5:t=n.stateNode,e===null&&n.flags&4&&Sp(n.type,n.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:n.memoizedState===null&&(n=n.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&Zd(n))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(k(163))}function lf(t,e){for(var n=t;;){if(n.tag===5){var r=n.stateNode;if(e)r=r.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=i!=null&&i.hasOwnProperty("display")?i.display:null,r.style.display=Bd("display",i)}}else if(n.tag===6)n.stateNode.nodeValue=e?"":n.memoizedProps;else if((n.tag!==23&&n.tag!==24||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function of(t,e){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(oh,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(t=e.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var n=t=t.next;do{var r=n,i=r.destroy;if(r=r.tag,i!==void 0)if((r&4)!==0)im(e,n);else{r=e;try{i()}catch(l){pn(r,l)}}n=n.next}while(n!==t)}break;case 1:if(sf(e),t=e.stateNode,typeof t.componentWillUnmount=="function")try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(l){pn(e,l)}break;case 5:sf(e);break;case 4:Qp(t,e)}}function af(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function uf(t){return t.tag===5||t.tag===3||t.tag===4}function hf(t){e:{for(var e=t.return;e!==null;){if(uf(e))break e;e=e.return}throw Error(k(160))}var n=e;switch(e=n.stateNode,n.tag){case 5:var r=!1;break;case 3:e=e.containerInfo,r=!0;break;case 4:e=e.containerInfo,r=!0;break;default:throw Error(k(161))}n.flags&16&&(Ui(e,""),n.flags&=-17);e:t:for(n=t;;){for(;n.sibling===null;){if(n.return===null||uf(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2)){n=n.stateNode;break e}}r?vu(t,n,e):yu(t,n,e)}function vu(t,e,n){var r=t.tag,i=r===5||r===6;if(i)t=i?t.stateNode:t.stateNode.instance,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Al));else if(r!==4&&(t=t.child,t!==null))for(vu(t,e,n),t=t.sibling;t!==null;)vu(t,e,n),t=t.sibling}function yu(t,e,n){var r=t.tag,i=r===5||r===6;if(i)t=i?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(yu(t,e,n),t=t.sibling;t!==null;)yu(t,e,n),t=t.sibling}function Qp(t,e){for(var n=e,r=!1,i,l;;){if(!r){r=n.return;e:for(;;){if(r===null)throw Error(k(160));switch(i=r.stateNode,r.tag){case 5:l=!1;break e;case 3:i=i.containerInfo,l=!0;break e;case 4:i=i.containerInfo,l=!0;break e}r=r.return}r=!0}if(n.tag===5||n.tag===6){e:for(var s=t,o=n,a=o;;)if(of(s,a),a.child!==null&&a.tag!==4)a.child.return=a,a=a.child;else{if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}l?(s=i,o=n.stateNode,s.nodeType===8?s.parentNode.removeChild(o):s.removeChild(o)):i.removeChild(n.stateNode)}else if(n.tag===4){if(n.child!==null){i=n.stateNode.containerInfo,l=!0,n.child.return=n,n=n.child;continue}}else if(of(t,n),n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return,n.tag===4&&(r=!1)}n.sibling.return=n.return,n=n.sibling}}function ca(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do(r.tag&3)===3&&(t=r.destroy,r.destroy=void 0,t!==void 0&&t()),r=r.next;while(r!==n)}return;case 1:return;case 5:if(n=e.stateNode,n!=null){r=e.memoizedProps;var i=t!==null?t.memoizedProps:r;t=e.type;var l=e.updateQueue;if(e.updateQueue=null,l!==null){for(n[Fl]=r,t==="input"&&r.type==="radio"&&r.name!=null&&Wd(n,r),Qa(t,i),e=Qa(t,r),i=0;i<l.length;i+=2){var s=l[i],o=l[i+1];s==="style"?Gd(n,o):s==="dangerouslySetInnerHTML"?$d(n,o):s==="children"?Ui(n,o):ju(n,s,o,e)}switch(t){case"input":Ga(n,r);break;case"textarea":jd(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,l=r.value,l!=null?vr(n,!!r.multiple,l,!1):t!==!!r.multiple&&(r.defaultValue!=null?vr(n,!!r.multiple,r.defaultValue,!0):vr(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(k(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:n=e.stateNode,n.hydrate&&(n.hydrate=!1,Zd(n.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(_h=be(),lf(e.child,!0)),cf(e);return;case 19:cf(e);return;case 17:return;case 23:case 24:lf(e,e.memoizedState!==null);return}throw Error(k(163))}function cf(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new dv),e.forEach(function(r){var i=xv.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function gv(t,e){return t!==null&&(t=t.memoizedState,t===null||t.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var vv=Math.ceil,ql=Mn.ReactCurrentDispatcher,Sh=Mn.ReactCurrentOwner,$=0,We=null,me=null,Ie=0,Wn=0,Cu=wn(0),Pe=0,ao=null,Lr=0,hs=0,Vr=0,wh=0,Su=null,_h=0,wu=1/0;function Wr(){wu=be()+500}var R=null,Hl=!1,_u=null,xt=null,Cn=!1,Wi=null,xi=90,Eu=[],Pu=[],jt=null,ji=0,Ou=null,wl=-1,Lt=0,_l=0,Mi=null,El=!1;function Ze(){return($&48)!==0?be():wl!==-1?wl:wl=be()}function fn(t){if(t=t.mode,(t&2)===0)return 1;if((t&4)===0)return br()===99?1:2;if(Lt===0&&(Lt=Lr),iv.transition!==0){_l!==0&&(_l=Su!==null?Su.pendingLanes:0),t=Lt;var e=4186112&~_l;return e&=-e,e===0&&(t=4186112&~t,e=t&-t,e===0&&(e=8192)),e}return t=br(),($&4)!==0&&t===98?t=Il(12,Lt):(t=og(t),t=Il(t,Lt)),t}function dn(t,e,n){if(50<ji)throw ji=0,Ou=null,Error(k(185));if(t=uo(t,e),t===null)return null;to(t,e,n),t===We&&(Vr|=e,Pe===4&&Er(t,Ie));var r=br();e===1?($&8)!==0&&($&48)===0?xu(t):(ht(t,n),$===0&&(Wr(),bt())):(($&4)===0||r!==98&&r!==99||(jt===null?jt=new Set([t]):jt.add(t)),ht(t,n)),Su=t}function uo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}function ht(t,e){for(var n=t.callbackNode,r=t.suspendedLanes,i=t.pingedLanes,l=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-vn(s),a=1<<o,u=l[o];if(u===-1){if((a&r)===0||(a&i)!==0){u=e,ar(a);var h=K;l[o]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=e&&(t.expiredLanes|=a);s&=~a}if(r=Ki(t,t===We?Ie:0),e=K,r===0)n!==null&&(n!==la&&ou(n),t.callbackNode=null,t.callbackPriority=0);else{if(n!==null){if(t.callbackPriority===e)return;n!==la&&ou(n)}e===15?(n=xu.bind(null,t),Dt===null?(Dt=[n],Sl=ah(lo,Np)):Dt.push(n),n=la):e===14?n=Yi(99,xu.bind(null,t)):(n=ag(e),n=Yi(n,Xp.bind(null,t))),t.callbackPriority=e,t.callbackNode=n}}function Xp(t){if(wl=-1,_l=Lt=0,($&48)!==0)throw Error(k(327));var e=t.callbackNode;if(_n()&&t.callbackNode!==e)return null;var n=Ki(t,t===We?Ie:0);if(n===0)return null;var r=n,i=$;$|=16;var l=tm();(We!==t||Ie!==r)&&(Wr(),Pr(t,r));do try{Sv();break}catch(o){em(t,o)}while(1);if(uh(),ql.current=l,$=i,me!==null?r=0:(We=null,Ie=0,r=Pe),(Lr&Vr)!==0)Pr(t,0);else if(r!==0){if(r===2&&($|=64,t.hydrate&&(t.hydrate=!1,lh(t.containerInfo)),n=lp(t),n!==0&&(r=Ti(t,n))),r===1)throw e=ao,Pr(t,0),Er(t,n),ht(t,be()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=n,r){case 0:case 1:throw Error(k(345));case 2:bn(t);break;case 3:if(Er(t,n),(n&62914560)===n&&(r=_h+500-be(),10<r)){if(Ki(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){Ze(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=kc(bn.bind(null,t),r);break}bn(t);break;case 4:if(Er(t,n),(n&4186112)===n)break;for(r=t.eventTimes,i=-1;0<n;){var s=31-vn(n);l=1<<s,s=r[s],s>i&&(i=s),n&=~l}if(n=i,n=be()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*vv(n/1960))-n,10<n){t.timeoutHandle=kc(bn.bind(null,t),n);break}bn(t);break;case 5:bn(t);break;default:throw Error(k(329))}}return ht(t,be()),t.callbackNode===e?Xp.bind(null,t):null}function Er(t,e){for(e&=~wh,e&=~Vr,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-vn(e),r=1<<n;t[n]=-1,e&=~r}}function xu(t){if(($&48)!==0)throw Error(k(327));if(_n(),t===We&&(t.expiredLanes&Ie)!==0){var e=Ie,n=Ti(t,e);(Lr&Vr)!==0&&(e=Ki(t,e),n=Ti(t,e))}else e=Ki(t,0),n=Ti(t,e);if(t.tag!==0&&n===2&&($|=64,t.hydrate&&(t.hydrate=!1,lh(t.containerInfo)),e=lp(t),e!==0&&(n=Ti(t,e))),n===1)throw n=ao,Pr(t,0),Er(t,e),ht(t,be()),n;return t.finishedWork=t.current.alternate,t.finishedLanes=e,bn(t),ht(t,be()),null}function yv(){if(jt!==null){var t=jt;jt=null,t.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,ht(e,be())})}bt()}function Yp(t,e){var n=$;$|=1;try{return t(e)}finally{$=n,$===0&&(Wr(),bt())}}function Zp(t,e){var n=$;$&=-2,$|=8;try{return t(e)}finally{$=n,$===0&&(Wr(),bt())}}function Bs(t,e){le(Cu,Wn),Wn|=e,Lr|=e}function Eh(){Wn=Cu.current,Y(Cu)}function Pr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Yg(n)),me!==null)for(n=me.return;n!==null;){var r=n;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Rl();break;case 3:Ir(),Y(ze),Y(ke),dh();break;case 5:fh(r);break;case 4:Ir();break;case 13:Y(se);break;case 19:Y(se);break;case 10:hh(r);break;case 23:case 24:Eh()}n=n.return}We=t,me=Sn(t.current,null),Ie=Wn=Lr=e,Pe=0,ao=null,wh=Vr=hs=0}function em(t,e){do{var n=me;try{if(uh(),Li.current=zl,$l){for(var r=oe.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}$l=!1}if(ns=0,Ee=Ne=oe=null,Vi=!1,Sh.current=null,n===null||n.return===null){Pe=1,ao=e,me=null;break}e:{var l=t,s=n.return,o=n,a=e;if(e=Ie,o.flags|=2048,o.firstEffect=o.lastEffect=null,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a;if((o.mode&2)===0){var h=o.alternate;h?(o.updateQueue=h.updateQueue,o.memoizedState=h.memoizedState,o.lanes=h.lanes):(o.updateQueue=null,o.memoizedState=null)}var p=(se.current&1)!==0,c=s;do{var g;if(g=c.tag===13){var S=c.memoizedState;if(S!==null)g=S.dehydrated!==null;else{var E=c.memoizedProps;g=E.fallback===void 0?!1:E.unstable_avoidThisFallback!==!0?!0:!p}}if(g){var d=c.updateQueue;if(d===null){var f=new Set;f.add(u),c.updateQueue=f}else d.add(u);if((c.mode&2)===0){if(c.flags|=64,o.flags|=16384,o.flags&=-2981,o.tag===1)if(o.alternate===null)o.tag=17;else{var v=hn(-1,1);v.tag=2,cn(o,v)}o.lanes|=1;break e}a=void 0,o=e;var y=l.pingCache;if(y===null?(y=l.pingCache=new fv,a=new Set,y.set(u,a)):(a=y.get(u),a===void 0&&(a=new Set,y.set(u,a))),!a.has(o)){a.add(o);var w=Ov.bind(null,l,u,o);u.then(w,w)}c.flags|=4096,c.lanes=e;break e}c=c.return}while(c!==null);a=Error((gr(o.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Pe!==5&&(Pe=2),a=Ch(a,o),c=s;do{switch(c.tag){case 3:l=a,c.flags|=4096,e&=-e,c.lanes|=e;var b=Kp(c,l,e);Wc(c,b);break e;case 1:l=a;var N=c.type,D=c.stateNode;if((c.flags&64)===0&&(typeof N.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(xt===null||!xt.has(D)))){c.flags|=4096,e&=-e,c.lanes|=e;var I=Jp(c,l,e);Wc(c,I);break e}}c=c.return}while(c!==null)}rm(n)}catch(T){e=T,me===n&&n!==null&&(me=n=n.return);continue}break}while(1)}function tm(){var t=ql.current;return ql.current=zl,t===null?zl:t}function Ti(t,e){var n=$;$|=16;var r=tm();We===t&&Ie===e||Pr(t,e);do try{Cv();break}catch(i){em(t,i)}while(1);if(uh(),$=n,ql.current=r,me!==null)throw Error(k(261));return We=null,Ie=0,Pe}function Cv(){for(;me!==null;)nm(me)}function Sv(){for(;me!==null&&!tv();)nm(me)}function nm(t){var e=sm(t.alternate,t,Wn);t.memoizedProps=t.pendingProps,e===null?rm(t):me=e,Sh.current=null}function rm(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&2048)===0){if(n=hv(n,e,Wn),n!==null){me=n;return}if(n=e,n.tag!==24&&n.tag!==23||n.memoizedState===null||(Wn&1073741824)!==0||(n.mode&4)===0){for(var r=0,i=n.child;i!==null;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}t!==null&&(t.flags&2048)===0&&(t.firstEffect===null&&(t.firstEffect=e.firstEffect),e.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(t.lastEffect!==null?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}else{if(n=cv(e),n!==null){n.flags&=2047,me=n;return}t!==null&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(e=e.sibling,e!==null){me=e;return}me=e=t}while(e!==null);Pe===0&&(Pe=5)}function bn(t){var e=br();return Vn(99,wv.bind(null,t,e)),null}function wv(t,e){do _n();while(Wi!==null);if(($&48)!==0)throw Error(k(327));var n=t.finishedWork;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(k(177));t.callbackNode=null;var r=n.lanes|n.childLanes,i=r,l=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;for(var s=t.eventTimes,o=t.expirationTimes;0<l;){var a=31-vn(l),u=1<<a;i[a]=0,s[a]=-1,o[a]=-1,l&=~u}if(jt!==null&&(r&24)===0&&jt.has(t)&&jt.delete(t),t===We&&(me=We=null,Ie=0),1<n.flags?n.lastEffect!==null?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,r!==null){if(i=$,$|=32,Sh.current=null,ra=gl,s=Pc(),nu(s)){if("selectionStart"in s)o={start:s.selectionStart,end:s.selectionEnd};else e:if(o=(o=s.ownerDocument)&&o.defaultView||window,(u=o.getSelection&&o.getSelection())&&u.rangeCount!==0){o=u.anchorNode,l=u.anchorOffset,a=u.focusNode,u=u.focusOffset;try{o.nodeType,a.nodeType}catch{o=null;break e}var h=0,p=-1,c=-1,g=0,S=0,E=s,d=null;t:for(;;){for(var f;E!==o||l!==0&&E.nodeType!==3||(p=h+l),E!==a||u!==0&&E.nodeType!==3||(c=h+u),E.nodeType===3&&(h+=E.nodeValue.length),(f=E.firstChild)!==null;)d=E,E=f;for(;;){if(E===s)break t;if(d===o&&++g===l&&(p=h),d===a&&++S===u&&(c=h),(f=E.nextSibling)!==null)break;E=d,d=E.parentNode}E=f}o=p===-1||c===-1?null:{start:p,end:c}}else o=null;o=o||{start:0,end:0}}else o=null;ia={focusedElem:s,selectionRange:o},gl=!1,Mi=null,El=!1,R=r;do try{_v()}catch(T){if(R===null)throw Error(k(330));pn(R,T),R=R.nextEffect}while(R!==null);Mi=null,R=r;do try{for(s=t;R!==null;){var v=R.flags;if(v&16&&Ui(R.stateNode,""),v&128){var y=R.alternate;if(y!==null){var w=y.ref;w!==null&&(typeof w=="function"?w(null):w.current=null)}}switch(v&1038){case 2:hf(R),R.flags&=-3;break;case 6:hf(R),R.flags&=-3,ca(R.alternate,R);break;case 1024:R.flags&=-1025;break;case 1028:R.flags&=-1025,ca(R.alternate,R);break;case 4:ca(R.alternate,R);break;case 8:o=R,Qp(s,o);var b=o.alternate;af(o),b!==null&&af(b)}R=R.nextEffect}}catch(T){if(R===null)throw Error(k(330));pn(R,T),R=R.nextEffect}while(R!==null);if(w=ia,y=Pc(),v=w.focusedElem,s=w.selectionRange,y!==v&&v&&v.ownerDocument&&pp(v.ownerDocument.documentElement,v)){for(s!==null&&nu(v)&&(y=s.start,w=s.end,w===void 0&&(w=y),"selectionStart"in v?(v.selectionStart=y,v.selectionEnd=Math.min(w,v.value.length)):(w=(y=v.ownerDocument||document)&&y.defaultView||window,w.getSelection&&(w=w.getSelection(),o=v.textContent.length,b=Math.min(s.start,o),s=s.end===void 0?b:Math.min(s.end,o),!w.extend&&b>s&&(o=s,s=b,b=o),o=Ec(v,b),l=Ec(v,s),o&&l&&(w.rangeCount!==1||w.anchorNode!==o.node||w.anchorOffset!==o.offset||w.focusNode!==l.node||w.focusOffset!==l.offset)&&(y=y.createRange(),y.setStart(o.node,o.offset),w.removeAllRanges(),b>s?(w.addRange(y),w.extend(l.node,l.offset)):(y.setEnd(l.node,l.offset),w.addRange(y)))))),y=[],w=v;w=w.parentNode;)w.nodeType===1&&y.push({element:w,left:w.scrollLeft,top:w.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<y.length;v++)w=y[v],w.element.scrollLeft=w.left,w.element.scrollTop=w.top}gl=!!ra,ia=ra=null,t.current=n,R=r;do try{for(v=t;R!==null;){var N=R.flags;if(N&36&&mv(v,R.alternate,R),N&128){y=void 0;var D=R.ref;if(D!==null){var I=R.stateNode;switch(R.tag){case 5:y=I;break;default:y=I}typeof D=="function"?D(y):D.current=y}}R=R.nextEffect}}catch(T){if(R===null)throw Error(k(330));pn(R,T),R=R.nextEffect}while(R!==null);R=null,rv(),$=i}else t.current=n;if(Cn)Cn=!1,Wi=t,xi=e;else for(R=r;R!==null;)e=R.nextEffect,R.nextEffect=null,R.flags&8&&(N=R,N.sibling=null,N.stateNode=null),R=e;if(r=t.pendingLanes,r===0&&(xt=null),r===1?t===Ou?ji++:(ji=0,Ou=t):ji=0,n=n.stateNode,Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(oh,n,void 0,(n.current.flags&64)===64)}catch{}if(ht(t,be()),Hl)throw Hl=!1,t=_u,_u=null,t;return($&8)!==0||bt(),null}function _v(){for(;R!==null;){var t=R.alternate;El||Mi===null||((R.flags&8)!==0?uc(R,Mi)&&(El=!0):R.tag===13&&gv(t,R)&&uc(R,Mi)&&(El=!0));var e=R.flags;(e&256)!==0&&pv(t,R),(e&512)===0||Cn||(Cn=!0,Yi(97,function(){return _n(),null})),R=R.nextEffect}}function _n(){if(xi!==90){var t=97<xi?97:xi;return xi=90,Vn(t,Pv)}return!1}function Ev(t,e){Eu.push(e,t),Cn||(Cn=!0,Yi(97,function(){return _n(),null}))}function im(t,e){Pu.push(e,t),Cn||(Cn=!0,Yi(97,function(){return _n(),null}))}function Pv(){if(Wi===null)return!1;var t=Wi;if(Wi=null,($&48)!==0)throw Error(k(331));var e=$;$|=32;var n=Pu;Pu=[];for(var r=0;r<n.length;r+=2){var i=n[r],l=n[r+1],s=i.destroy;if(i.destroy=void 0,typeof s=="function")try{s()}catch(a){if(l===null)throw Error(k(330));pn(l,a)}}for(n=Eu,Eu=[],r=0;r<n.length;r+=2){i=n[r],l=n[r+1];try{var o=i.create;i.destroy=o()}catch(a){if(l===null)throw Error(k(330));pn(l,a)}}for(o=t.current.firstEffect;o!==null;)t=o.nextEffect,o.nextEffect=null,o.flags&8&&(o.sibling=null,o.stateNode=null),o=t;return $=e,bt(),!0}function ff(t,e,n){e=Ch(n,e),e=Kp(t,e,1),cn(t,e),e=Ze(),t=uo(t,1),t!==null&&(to(t,1,e),ht(t,e))}function pn(t,e){if(t.tag===3)ff(t,t,e);else for(var n=t.return;n!==null;){if(n.tag===3){ff(n,t,e);break}else if(n.tag===1){var r=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xt===null||!xt.has(r))){t=Ch(e,t);var i=Jp(n,t,1);if(cn(n,i),i=Ze(),n=uo(n,1),n!==null)to(n,1,i),ht(n,i);else if(typeof r.componentDidCatch=="function"&&(xt===null||!xt.has(r)))try{r.componentDidCatch(e,t)}catch{}break}}n=n.return}}function Ov(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ze(),t.pingedLanes|=t.suspendedLanes&n,We===t&&(Ie&n)===n&&(Pe===4||Pe===3&&(Ie&62914560)===Ie&&500>be()-_h?Pr(t,0):wh|=n),ht(t,e)}function xv(t,e){var n=t.stateNode;n!==null&&n.delete(e),e=0,e===0&&(e=t.mode,(e&2)===0?e=1:(e&4)===0?e=br()===99?1:2:(Lt===0&&(Lt=Lr),e=ur(62914560&~Lt),e===0&&(e=4194304))),n=Ze(),t=uo(t,e),t!==null&&(to(t,e,n),ht(t,n))}var sm;sm=function(t,e,n){var r=e.lanes;if(t!==null)if(t.memoizedProps!==e.pendingProps||ze.current)Ct=!0;else if((n&r)!==0)Ct=(t.flags&16384)!==0;else{switch(Ct=!1,e.tag){case 3:Xc(e),aa();break;case 5:Bc(e);break;case 1:qe(e.type)&&Cl(e);break;case 4:hu(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value;var i=e.type._context;le(Dl,i._currentValue),i._currentValue=r;break;case 13:if(e.memoizedState!==null)return(n&e.child.childLanes)!==0?Yc(t,e,n):(le(se,se.current&1),e=Wt(t,e,n),e!==null?e.sibling:null);le(se,se.current&1);break;case 19:if(r=(n&e.childLanes)!==0,(t.flags&64)!==0){if(r)return rf(t,e,n);e.flags|=64}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),le(se,se.current),r)break;return null;case 23:case 24:return e.lanes=0,ua(t,e,n)}return Wt(t,e,n)}else Ct=!1;switch(e.lanes=0,e.tag){case 2:if(r=e.type,t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=Nr(e,ke.current),wr(e,n),i=mh(null,e,r,t,i,n),e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,qe(r)){var l=!0;Cl(e)}else l=!1;e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,ch(e);var s=r.getDerivedStateFromProps;typeof s=="function"&&Wl(e,r,s,t),i.updater=oo,e.stateNode=i,i._reactInternals=e,uu(e,r,t,n),e=pu(null,e,r,!0,l,n)}else e.tag=0,Ue(null,e,i,n),e=e.child;return e;case 16:i=e.elementType;e:{switch(t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,l=i._init,i=l(i._payload),e.type=i,l=e.tag=Nv(i),t=yt(i,t),l){case 0:e=du(null,e,i,t,n);break e;case 1:e=Qc(null,e,i,t,n);break e;case 11:e=Kc(null,e,i,t,n);break e;case 14:e=Jc(null,e,i,yt(i.type,t),r,n);break e}throw Error(k(306,i,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),du(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),Qc(t,e,r,i,n);case 3:if(Xc(e),r=e.updateQueue,t===null||r===null)throw Error(k(282));if(r=e.pendingProps,i=e.memoizedState,i=i!==null?i.element:null,Ip(t,e),Zi(e,r,null,n),r=e.memoizedState.element,r===i)aa(),e=Wt(t,e,n);else{if(i=e.stateNode,(l=i.hydrate)&&(ln=Sr(e.stateNode.containerInfo.firstChild),Vt=e,l=Nt=!0),l){if(t=i.mutableSourceEagerHydrationData,t!=null)for(i=0;i<t.length;i+=2)l=t[i],l._workInProgressVersionPrimary=t[i+1],_r.push(l);for(n=Rp(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|1024,n=n.sibling}else Ue(t,e,r,n),aa();e=e.child}return e;case 5:return Bc(e),t===null&&cu(e),r=e.type,i=e.pendingProps,l=t!==null?t.memoizedProps:null,s=i.children,su(r,i)?s=null:l!==null&&su(r,l)&&(e.flags|=16),Up(t,e),Ue(t,e,s,n),e.child;case 6:return t===null&&cu(e),null;case 13:return Yc(t,e,n);case 4:return hu(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=jl(e,null,r,n):Ue(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),Kc(t,e,r,i,n);case 7:return Ue(t,e,e.pendingProps,n),e.child;case 8:return Ue(t,e,e.pendingProps.children,n),e.child;case 12:return Ue(t,e,e.pendingProps.children,n),e.child;case 10:e:{r=e.type._context,i=e.pendingProps,s=e.memoizedProps,l=i.value;var o=e.type._context;if(le(Dl,o._currentValue),o._currentValue=l,s!==null)if(o=s.value,l=st(o,l)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(o,l):1073741823)|0,l===0){if(s.children===i.children&&!ze.current){e=Wt(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var u=a.firstContext;u!==null;){if(u.context===r&&(u.observedBits&l)!==0){o.tag===1&&(u=hn(-1,n&-n),u.tag=2,cn(o,u)),o.lanes|=n,u=o.alternate,u!==null&&(u.lanes|=n),bp(o.return,n),a.lanes|=n;break}u=u.next}}else s=o.tag===10&&o.type===e.type?null:o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Ue(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,l=e.pendingProps,r=l.children,wr(e,n),i=ut(i,l.unstable_observedBits),r=r(i),e.flags|=1,Ue(t,e,r,n),e.child;case 14:return i=e.type,l=yt(i,e.pendingProps),l=yt(i.type,l),Jc(t,e,i,l,r,n);case 15:return Gp(t,e,e.type,e.pendingProps,r,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,qe(r)?(t=!0,Cl(e)):t=!1,wr(e,n),Ap(e,r,i),uu(e,r,i,n),pu(null,e,r,!0,t,n);case 19:return rf(t,e,n);case 23:return ua(t,e,n);case 24:return ua(t,e,n)}throw Error(k(156,e.tag))};function Tv(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function lt(t,e,n,r){return new Tv(t,e,n,r)}function Ph(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Nv(t){if(typeof t=="function")return Ph(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Yl)return 11;if(t===Zl)return 14}return 2}function Sn(t,e){var n=t.alternate;return n===null?(n=lt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Pl(t,e,n,r,i,l){var s=2;if(r=t,typeof t=="function")Ph(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case nn:return Or(n.children,i,l,e);case Dd:s=8,i|=16;break;case Mu:s=8,i|=1;break;case bi:return t=lt(12,n,e,i|8),t.elementType=bi,t.type=bi,t.lanes=l,t;case Ii:return t=lt(13,n,e,i),t.type=Ii,t.elementType=Ii,t.lanes=l,t;case xl:return t=lt(19,n,e,i),t.elementType=xl,t.lanes=l,t;case qu:return Oh(n,i,l,e);case $a:return t=lt(24,n,e,i),t.elementType=$a,t.lanes=l,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case $u:s=10;break e;case Bu:s=9;break e;case Yl:s=11;break e;case Zl:s=14;break e;case Gu:s=16,r=null;break e;case Uu:s=22;break e}throw Error(k(130,t==null?t:typeof t,""))}return e=lt(s,n,e,i),e.elementType=t,e.type=r,e.lanes=l,e}function Or(t,e,n,r){return t=lt(7,t,r,e),t.lanes=n,t}function Oh(t,e,n,r){return t=lt(23,t,r,e),t.elementType=qu,t.lanes=n,t}function fa(t,e,n){return t=lt(6,t,null,e),t.lanes=n,t}function da(t,e,n){return e=lt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function bv(t,e,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Qo(0),this.expirationTimes=Qo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qo(0),this.mutableSourceEagerHydrationData=null}function Iv(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:In,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Kl(t,e,n,r){var i=e.current,l=Ze(),s=fn(i);e:if(n){n=n._reactInternals;t:{if($n(n)!==n||n.tag!==1)throw Error(k(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break t;case 1:if(qe(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break t}}o=o.return}while(o!==null);throw Error(k(171))}if(n.tag===1){var a=n.type;if(qe(a)){n=_p(n,a,o);break e}}n=o}else n=yn;return e.context===null?e.context=n:e.pendingContext=n,e=hn(l,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),cn(i,e),dn(i,s,l),s}function pa(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function df(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function xh(t,e){df(t,e),(t=t.alternate)&&df(t,e)}function kv(){return null}function Th(t,e,n){var r=n!=null&&n.hydrationOptions!=null&&n.hydrationOptions.mutableSources||null;if(n=new bv(t,e,n!=null&&n.hydrate===!0),e=lt(3,null,null,e===2?7:e===1?3:0),n.current=e,e.stateNode=n,ch(e),t[Dr]=n.current,vp(t.nodeType===8?t.parentNode:t),r)for(t=0;t<r.length;t++){e=r[t];var i=e._getVersion;i=i(e._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[e,i]:n.mutableSourceEagerHydrationData.push(e,i)}this._internalRoot=n}Th.prototype.render=function(t){Kl(t,this._internalRoot,null,null)};Th.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;Kl(null,t,null,function(){e[Dr]=null})};function cs(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Av(t,e){if(e||(e=t?t.nodeType===9?t.documentElement:t.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new Th(t,0,e?{hydrate:!0}:void 0)}function ho(t,e,n,r,i){var l=n._reactRootContainer;if(l){var s=l._internalRoot;if(typeof i=="function"){var o=i;i=function(){var u=pa(s);o.call(u)}}Kl(e,s,t,i)}else{if(l=n._reactRootContainer=Av(n,r),s=l._internalRoot,typeof i=="function"){var a=i;i=function(){var u=pa(s);a.call(u)}}Zp(function(){Kl(e,s,t,i)})}return pa(s)}Qd=function(t){if(t.tag===13){var e=Ze();dn(t,4,e),xh(t,4)}};Xu=function(t){if(t.tag===13){var e=Ze();dn(t,67108864,e),xh(t,67108864)}};Xd=function(t){if(t.tag===13){var e=Ze(),n=fn(t);dn(t,n,e),xh(t,n)}};Yd=function(t,e){return e()};Xa=function(t,e,n){switch(e){case"input":if(Ga(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=so(r);if(!i)throw Error(k(90));Vd(r),Ga(r,i)}}}break;case"textarea":jd(t,n);break;case"select":e=n.value,e!=null&&vr(t,!!n.multiple,e,!1)}};Ku=Yp;qd=function(t,e,n,r,i){var l=$;$|=4;try{return Vn(98,t.bind(null,e,n,r,i))}finally{$=l,$===0&&(Wr(),bt())}};Ju=function(){($&49)===0&&(yv(),_n())};Hd=function(t,e){var n=$;$|=2;try{return t(e)}finally{$=n,$===0&&(Wr(),bt())}};function lm(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cs(e))throw Error(k(200));return Iv(t,e,null,n)}var Fv={Events:[as,dr,so,Ud,zd,_n,{current:!1}]},ui={findFiberByHostInstance:An,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},Rv={bundleType:ui.bundleType,version:ui.version,rendererPackageName:ui.rendererPackageName,rendererConfig:ui.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Mn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Jd(t),t===null?null:t.stateNode},findFiberByHostInstance:ui.findFiberByHostInstance||kv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Gs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gs.isDisabled&&Gs.supportsFiber)try{oh=Gs.inject(Rv),Dn=Gs}catch{}}ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fv;ct.createPortal=lm;ct.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(k(188)):Error(k(268,Object.keys(t)));return t=Jd(e),t=t===null?null:t.stateNode,t};ct.flushSync=function(t,e){var n=$;if((n&48)!==0)return t(e);$|=1;try{if(t)return Vn(99,t.bind(null,e))}finally{$=n,bt()}};ct.hydrate=function(t,e,n){if(!cs(e))throw Error(k(200));return ho(null,t,e,!0,n)};ct.render=function(t,e,n){if(!cs(e))throw Error(k(200));return ho(null,t,e,!1,n)};ct.unmountComponentAtNode=function(t){if(!cs(t))throw Error(k(40));return t._reactRootContainer?(Zp(function(){ho(null,null,t,!1,function(){t._reactRootContainer=null,t[Dr]=null})}),!0):!1};ct.unstable_batchedUpdates=Yp;ct.unstable_createPortal=function(t,e){return lm(t,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};ct.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!cs(n))throw Error(k(200));if(t==null||t._reactInternals===void 0)throw Error(k(38));return ho(t,e,n,!1,r)};ct.version="17.0.2";function om(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(om)}catch(t){console.error(t)}}om(),kd.exports=ct;var KE=kd.exports;function Dv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pf(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function mf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pf(Object(n),!0).forEach(function(r){Dv(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pf(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Lv(t,e){return Vv(t)||Wv(t,e)||jv(t,e)||Mv()}function Vv(t){if(Array.isArray(t))return t}function Wv(t,e){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,l=void 0;try{for(var s=t[Symbol.iterator](),o;!(r=(o=s.next()).done)&&(n.push(o.value),!(e&&n.length===e));r=!0);}catch(a){i=!0,l=a}finally{try{!r&&s.return!=null&&s.return()}finally{if(i)throw l}}return n}}function jv(t,e){if(!!t){if(typeof t=="string")return gf(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gf(t,e)}}function gf(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Mv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vf(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function yf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vf(Object(n),!0).forEach(function(r){$v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vf(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Bv(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){return e.reduceRight(function(i,l){return l(i)},r)}}function Ni(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return i.length>=t.length?t.apply(this,i):function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return e.apply(n,[].concat(i,o))}}}function Jl(t){return{}.toString.call(t).includes("Object")}function Gv(t){return!Object.keys(t).length}function rs(t){return typeof t=="function"}function Uv(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zv(t,e){return Jl(e)||mn("changeType"),Object.keys(e).some(function(n){return!Uv(t,n)})&&mn("changeField"),e}function qv(t){rs(t)||mn("selectorType")}function Hv(t){rs(t)||Jl(t)||mn("handlerType"),Jl(t)&&Object.values(t).some(function(e){return!rs(e)})&&mn("handlersType")}function Kv(t){t||mn("initialIsRequired"),Jl(t)||mn("initialType"),Gv(t)&&mn("initialContent")}function Jv(t,e){throw new Error(t[e]||t.default)}var Qv={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},mn=Ni(Jv)(Qv),Us={changes:zv,selector:qv,handler:Hv,initial:Kv};function Xv(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Us.initial(t),Us.handler(e);var n={current:t},r=Ni(ey)(n,e),i=Ni(Zv)(n),l=Ni(Us.changes)(t),s=Ni(Yv)(n);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(h){return h};return Us.selector(u),u(n.current)}function a(u){Bv(r,i,l,s)(u)}return[o,a]}function Yv(t,e){return rs(e)?e(t.current):e}function Zv(t,e){return t.current=yf(yf({},t.current),e),e}function ey(t,e,n){return rs(e)?e(t.current):Object.keys(n).forEach(function(r){var i;return(i=e[r])===null||i===void 0?void 0:i.call(e,t.current[r])}),n}var ty={create:Xv},ny={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.28.1/min/vs"}};function ry(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return i.length>=t.length?t.apply(this,i):function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return e.apply(n,[].concat(i,o))}}}function iy(t){return{}.toString.call(t).includes("Object")}function sy(t){return t||Cf("configIsRequired"),iy(t)||Cf("configType"),t.urls?(ly(),{paths:{vs:t.urls.monacoBase}}):t}function ly(){console.warn(am.deprecation)}function oy(t,e){throw new Error(t[e]||t.default)}var am={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Cf=ry(oy)(am),ay={config:sy},uy=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(i){return n.reduceRight(function(l,s){return s(l)},i)}};function um(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],um(t[n],e[n]))}),mf(mf({},t),e)}var hy={type:"cancelation",msg:"operation is manually canceled"};function Sf(t){var e=!1,n=new Promise(function(r,i){t.then(function(l){return e?i(hy):r(l)}),t.catch(i)});return n.cancel=function(){return e=!0},n}var cy=ty.create({config:ny,isInitialized:!1,resolve:null,reject:null,monaco:null}),hm=Lv(cy,2),fs=hm[0],co=hm[1];function fy(t){co(function(e){return{config:um(e.config,ay.config(t))}})}function dy(){var t=fs(function(e){var n=e.isInitialized;return{isInitialized:n}});if(!t.isInitialized){if(window.monaco&&window.monaco.editor)return cm(window.monaco),Sf(Promise.resolve(window.monaco));uy(py,gy)(vy),co({isInitialized:!0})}return Sf(Cy)}function py(t){return document.body.appendChild(t)}function my(t){var e=document.createElement("script");return t&&(e.src=t),e}function gy(t){var e=fs(function(r){var i=r.config,l=r.reject;return{config:i,reject:l}}),n=my("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function vy(){var t=fs(function(n){var r=n.config,i=n.resolve,l=n.reject;return{config:r,resolve:i,reject:l}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){cm(n),t.resolve(n)},function(n){t.reject(n)})}function cm(t){fs().monaco||co({monaco:t})}function yy(){return fs(function(t){var e=t.monaco;return e})}var Cy=new Promise(function(t,e){return co({resolve:t,reject:e})}),Tu={config:fy,init:dy,__getMonacoInstance:yy},fm={exports:{}},Sy="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",wy=Sy,_y=wy;function dm(){}function pm(){}pm.resetWarningCache=dm;var Ey=function(){function t(r,i,l,s,o,a){if(a!==_y){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:pm,resetWarningCache:dm};return n.PropTypes=n,n};fm.exports=Ey();var L=fm.exports;function Nu(){return Nu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Nu.apply(this,arguments)}const Py={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function Oy({content:t}){return pl.createElement("div",{style:Py},t)}const ma={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function mm({width:t,height:e,isEditorReady:n,loading:r,_ref:i,className:l,wrapperProps:s}){return pl.createElement("section",Nu({style:Jh(Xr({},ma.wrapper),{width:t,height:e})},s),!n&&pl.createElement(Oy,{content:r}),pl.createElement("div",{ref:i,style:Xr(Xr({},ma.fullWidth),!n&&ma.hide),className:l}))}mm.propTypes={width:L.oneOfType([L.number,L.string]).isRequired,height:L.oneOfType([L.number,L.string]).isRequired,loading:L.oneOfType([L.element,L.string]).isRequired,isEditorReady:L.bool.isRequired,className:L.string,wrapperProps:L.object};var xy=J.exports.memo(mm);function gm(t){J.exports.useEffect(t,[])}function Yn(t,e,n=!0){const r=J.exports.useRef(!0);J.exports.useEffect(r.current||!n?()=>{r.current=!1}:t,e)}function ga(){}function wf(t,e,n,r){return Ty(t,r)||Ny(t,e,n,r)}function Ty(t,e){return t.editor.getModel(vm(t,e))}function Ny(t,e,n,r){return t.editor.createModel(e,n,r&&vm(t,r))}function vm(t,e){return t.Uri.parse(e)}function by(t){return t===void 0}var Nh={exports:{}},ds={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Iy=J.exports,ym=60103;ds.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var _f=Symbol.for;ym=_f("react.element"),ds.Fragment=_f("react.fragment")}var ky=Iy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ay=Object.prototype.hasOwnProperty,Fy={key:!0,ref:!0,__self:!0,__source:!0};function Cm(t,e,n){var r,i={},l=null,s=null;n!==void 0&&(l=""+n),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)Ay.call(e,r)&&!Fy.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:ym,type:t,key:l,ref:s,props:i,_owner:ky.current}}ds.jsx=Cm;ds.jsxs=Cm;Nh.exports=ds;const Ry=Nh.exports.jsx,JE=Nh.exports.jsxs;L.string,L.string,L.string,L.string,L.string,L.string,L.string,L.bool,L.bool,L.string,L.oneOfType([L.element,L.string]),L.object,L.oneOfType([L.number,L.string]),L.oneOfType([L.number,L.string]),L.string,L.object,L.func,L.func;function QE(){const[t,e]=J.exports.useState(Tu.__getMonacoInstance());return gm(()=>{let n;return t||(n=Tu.init(),n.then(r=>{e(r)})),()=>{var r;return(r=n)===null||r===void 0?void 0:r.cancel()}}),t}function Dy(t){const e=J.exports.useRef();return J.exports.useEffect(()=>{e.current=t},[t]),e.current}const zs=new Map;function bh({defaultValue:t,defaultLanguage:e,defaultPath:n,value:r,language:i,path:l,theme:s,line:o,loading:a,options:u,overrideServices:h,saveViewState:p,keepCurrentModel:c,width:g,height:S,className:E,wrapperProps:d,beforeMount:f,onMount:v,onChange:y,onValidate:w}){const[b,N]=J.exports.useState(!1),[D,I]=J.exports.useState(!0),T=J.exports.useRef(null),j=J.exports.useRef(null),Je=J.exports.useRef(null),ce=J.exports.useRef(v),G=J.exports.useRef(f),tt=J.exports.useRef(null),m=J.exports.useRef(r),C=Dy(l);gm(()=>{const x=Tu.init();return x.then(F=>(T.current=F)&&I(!1)).catch(F=>(F==null?void 0:F.type)!=="cancelation"&&console.error("Monaco initialization: error:",F)),()=>j.current?P():x.cancel()}),Yn(()=>{const x=wf(T.current,t||r,e||i,l);x!==j.current.getModel()&&(p&&zs.set(C,j.current.saveViewState()),j.current.setModel(x),p&&j.current.restoreViewState(zs.get(l)))},[l],b),Yn(()=>{j.current.updateOptions(u)},[u],b),Yn(()=>{j.current.getOption(T.current.editor.EditorOption.readOnly)?j.current.setValue(r):r!==j.current.getValue()&&(j.current.executeEdits("",[{range:j.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),j.current.pushUndoStop())},[r],b),Yn(()=>{T.current.editor.setModelLanguage(j.current.getModel(),i)},[i],b),Yn(()=>{by(o)||j.current.revealLine(o)},[o],b),Yn(()=>{T.current.editor.setTheme(s)},[s],b);const _=J.exports.useCallback(()=>{G.current(T.current);const x=l||n,F=wf(T.current,r||t,e||i,x);j.current=T.current.editor.create(Je.current,Xr({model:F,automaticLayout:!0},u),h),p&&j.current.restoreViewState(zs.get(x)),T.current.editor.setTheme(s),N(!0)},[t,e,n,r,i,l,u,h,p,s]);J.exports.useEffect(()=>{b&&ce.current(j.current,T.current)},[b]),J.exports.useEffect(()=>{!D&&!b&&_()},[D,b,_]),m.current=r,J.exports.useEffect(()=>{if(b&&y){var x,F;(x=tt.current)===null||x===void 0||x.dispose(),tt.current=(F=j.current)===null||F===void 0?void 0:F.onDidChangeModelContent(O=>{const A=j.current.getValue();m.current!==A&&y(A,O)})}},[b,y]),J.exports.useEffect(()=>{if(b){const x=T.current.editor.onDidChangeMarkers(F=>{var O;const A=(O=j.current.getModel())===null||O===void 0?void 0:O.uri;if(A&&F.find(U=>U.path===A.path)){const U=T.current.editor.getModelMarkers({resource:A});w==null||w(U)}});return()=>{x==null||x.dispose()}}},[b,w]);function P(){var x;if((x=tt.current)===null||x===void 0||x.dispose(),c)p&&zs.set(l,j.current.saveViewState());else{var F;(F=j.current.getModel())===null||F===void 0||F.dispose()}j.current.dispose()}return Ry(xy,{width:g,height:S,isEditorReady:b,loading:a,_ref:Je,className:E,wrapperProps:d})}bh.propTypes={defaultValue:L.string,defaultPath:L.string,defaultLanguage:L.string,value:L.string,language:L.string,path:L.string,theme:L.string,line:L.number,loading:L.oneOfType([L.element,L.string]),options:L.object,overrideServices:L.object,saveViewState:L.bool,keepCurrentModel:L.bool,width:L.oneOfType([L.number,L.string]),height:L.oneOfType([L.number,L.string]),className:L.string,wrapperProps:L.object,beforeMount:L.func,onMount:L.func,onChange:L.func,onValidate:L.func};bh.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:ga,onMount:ga,onValidate:ga};var XE=J.exports.memo(bh),Ly={},is={};Object.defineProperty(is,"__esModule",{value:!0});is.CompilerOptions=void 0;class Vy{constructor(e=null,n=[],r=!1,i=null,l=null){this.sourceFilename=e,this.pluginNames=n,this.countAllVisits=r,this.errorHandler=i,this.fileHandler=l}}is.CompilerOptions=Vy;var fo={};Object.defineProperty(fo,"__esModule",{value:!0});fo.DebugSourceRange=void 0;class Wy{constructor(e,n,r){this.length=e,this.debugMetadata=n,this.text=r}}fo.DebugSourceRange=Wy;var po={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(t.ErrorType||(t.ErrorType={}))})(po);var mo={},go={};Object.defineProperty(go,"__esModule",{value:!0});go.Argument=void 0;class jy{constructor(e=null,n=null,r=null){this.identifier=e,this.isByReference=n,this.isDivertTarget=r}}go.Argument=jy;var jr={},Q={},B={};Object.defineProperty(B,"__esModule",{value:!0});B.filterUndef=B.isEquatable=B.nullIfUndefined=B.asINamedContentOrNull=B.asBooleanOrThrows=B.asNumberOrThrows=B.asOrThrows=B.asOrNull=void 0;function My(t,e){return t instanceof e?Sm(t):null}B.asOrNull=My;function $y(t,e){if(t instanceof e)return Sm(t);throw new Error(`${t} is not of type ${e}`)}B.asOrThrows=$y;function By(t){if(typeof t=="number")return t;throw new Error(`${t} is not a number`)}B.asNumberOrThrows=By;function Gy(t){if(typeof t=="boolean")return t;throw new Error(`${t} is not a boolean`)}B.asBooleanOrThrows=Gy;function Uy(t){return t.hasValidName&&t.name?t:null}B.asINamedContentOrNull=Uy;function zy(t){return typeof t=="undefined"?null:t}B.nullIfUndefined=zy;function qy(t){return typeof t=="object"&&typeof t.Equals=="function"}B.isEquatable=qy;function Sm(t,e){return t}function Hy(t){return t!=null}B.filterUndef=Hy;Object.defineProperty(Q,"__esModule",{value:!0});Q.ParsedObject=void 0;const Ef=B;class Ky{constructor(){this._alreadyHadError=!1,this._alreadyHadWarning=!1,this._debugMetadata=null,this._runtimeObject=null,this.content=[],this.parent=null,this.GetType=()=>this.typeName,this.AddContent=e=>{this.content===null&&(this.content=[]);const n=Array.isArray(e)?e:[e];for(const r of n)r.hasOwnProperty("parent")&&(r.parent=this),this.content.push(r);if(!Array.isArray(e))return e},this.InsertContent=(e,n)=>(this.content===null&&(this.content=[]),n.parent=this,this.content.splice(e,0,n),n),this.Find=e=>(n=null)=>{let r=Ef.asOrNull(this,e);if(r!==null&&(n===null||n(r)===!0))return r;if(this.content===null)return null;for(const i of this.content){let l=i.Find&&i.Find(e)(n);if(l)return l}return null},this.FindAll=e=>(n,r)=>{const i=Array.isArray(r)?r:[],l=Ef.asOrNull(this,e);if(l!==null&&(!n||n(l)===!0)&&i.push(l),this.content===null)return[];for(const s of this.content)s.FindAll&&s.FindAll(e)(n,i);return i},this.Warning=(e,n=null)=>{this.Error(e,n,!0)}}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get hasOwnDebugMetadata(){return Boolean(this.debugMetadata)}get typeName(){return"ParsedObject"}get story(){let e=this;for(;e.parent;)e=e.parent;return e}get runtimeObject(){return this._runtimeObject||(this._runtimeObject=this.GenerateRuntimeObject(),this._runtimeObject&&(this._runtimeObject.debugMetadata=this.debugMetadata)),this._runtimeObject}set runtimeObject(e){this._runtimeObject=e}get runtimePath(){if(!this.runtimeObject.path)throw new Error;return this.runtimeObject.path}get containerForCounting(){return this.runtimeObject}get ancestry(){let e=[],n=this.parent;for(;n;)e.push(n),n=n.parent;return e=e.reverse(),e}ResolveReferences(e){if(this.content!==null)for(const n of this.content)n.ResolveReferences(e)}Error(e,n=null,r=!1){if(n===null&&(n=this),!(n._alreadyHadError&&!r||n._alreadyHadWarning&&r)){if(this.parent)this.parent.Error(e,n,r);else throw new Error(`No parent object to send error to: ${e}`);r?n._alreadyHadWarning=!0:n._alreadyHadError=!0}}}Q.ParsedObject=Ky;Object.defineProperty(jr,"__esModule",{value:!0});jr.AuthorWarning=void 0;const Jy=Q;class Qy extends Jy.ParsedObject{constructor(e){super();this.warningMessage=e,this.GenerateRuntimeObject=()=>(this.Warning(this.warningMessage),null)}get typeName(){return"AuthorWarning"}}jr.AuthorWarning=Qy;var ps={},He={},he={},ie={},Ae={},Ke={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Path=void 0;class e{constructor(){if(this._components=[],this._componentsString=null,this._isRelative=!1,typeof arguments[0]=="string"){let r=arguments[0];this.componentsString=r}else if(arguments[0]instanceof e.Component&&arguments[1]instanceof e){let r=arguments[0],i=arguments[1];this._components.push(r),this._components=this._components.concat(i._components)}else if(arguments[0]instanceof Array){let r=arguments[0],i=!!arguments[1];this._components=this._components.concat(r),this._isRelative=i}}get isRelative(){return this._isRelative}get componentCount(){return this._components.length}get head(){return this._components.length>0?this._components[0]:null}get tail(){if(this._components.length>=2){let r=this._components.slice(1,this._components.length);return new e(r)}else return e.self}get length(){return this._components.length}get lastComponent(){let r=this._components.length-1;return r>=0?this._components[r]:null}get containsNamedComponent(){for(let r=0,i=this._components.length;r<i;r++)if(!this._components[r].isIndex)return!0;return!1}static get self(){let r=new e;return r._isRelative=!0,r}GetComponent(r){return this._components[r]}PathByAppendingPath(r){let i=new e,l=0;for(let s=0;s<r._components.length&&r._components[s].isParent;++s)l++;for(let s=0;s<this._components.length-l;++s)i._components.push(this._components[s]);for(let s=l;s<r._components.length;++s)i._components.push(r._components[s]);return i}get componentsString(){return this._componentsString==null&&(this._componentsString=this._components.join("."),this.isRelative&&(this._componentsString="."+this._componentsString)),this._componentsString}set componentsString(r){if(this._components.length=0,this._componentsString=r,this._componentsString==null||this._componentsString=="")return;this._componentsString[0]=="."&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));let i=this._componentsString.split(".");for(let l of i)/^(\-|\+)?([0-9]+|Infinity)$/.test(l)?this._components.push(new e.Component(parseInt(l))):this._components.push(new e.Component(l))}toString(){return this.componentsString}Equals(r){if(r==null||r._components.length!=this._components.length||r.isRelative!=this.isRelative)return!1;for(let i=0,l=r._components.length;i<l;i++)if(!r._components[i].Equals(this._components[i]))return!1;return!0}PathByAppendingComponent(r){let i=new e;return i._components.push(...this._components),i._components.push(r),i}}t.Path=e,e.parentId="^",function(n){class r{constructor(l){this.index=-1,this.name=null,typeof l=="string"?this.name=l:this.index=l}get isIndex(){return this.index>=0}get isParent(){return this.name==n.parentId}static ToParent(){return new r(n.parentId)}toString(){return this.isIndex?this.index.toString():this.name}Equals(l){return l!=null&&l.isIndex==this.isIndex?this.isIndex?this.index==l.index:this.name==l.name:!1}}n.Component=r}(e=t.Path||(t.Path={}))})(Ke);var ms={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Debug=void 0,function(e){function n(i,l,s){r(i instanceof l,s)}e.AssertType=n;function r(i,l){if(!i)throw typeof l!="undefined"&&console.warn(l),console.trace&&console.trace(),new Error("")}e.Assert=r}(t.Debug||(t.Debug={}))})(ms);var ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.throwNullException=ue.NullException=void 0;class wm extends Error{}ue.NullException=wm;function Xy(t){throw new wm(`${t} is null or undefined`)}ue.throwNullException=Xy;Object.defineProperty(Ae,"__esModule",{value:!0});Ae.InkObject=void 0;const Zn=Ke,hi=he,va=ms,er=B,qs=ue;class Yy{constructor(){this.parent=null,this._debugMetadata=null,this._path=null}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get ownDebugMetadata(){return this._debugMetadata}DebugLineNumberOfPath(e){if(e===null)return null;let n=this.rootContentContainer;if(n){let r=n.ContentAtPath(e).obj;if(r){let i=r.debugMetadata;if(i!==null)return i.startLineNumber}}return null}get path(){if(this._path==null)if(this.parent==null)this._path=new Zn.Path;else{let e=[],n=this,r=er.asOrNull(n.parent,hi.Container);for(;r!==null;){let i=er.asINamedContentOrNull(n);if(i!=null&&i.hasValidName){if(i.name===null)return qs.throwNullException("namedChild.name");e.unshift(new Zn.Path.Component(i.name))}else e.unshift(new Zn.Path.Component(r.content.indexOf(n)));n=r,r=er.asOrNull(r.parent,hi.Container)}this._path=new Zn.Path(e)}return this._path}ResolvePath(e){if(e===null)return qs.throwNullException("path");if(e.isRelative){let n=er.asOrNull(this,hi.Container);return n===null&&(va.Debug.Assert(this.parent!==null,"Can't resolve relative path because we don't have a parent"),n=er.asOrNull(this.parent,hi.Container),va.Debug.Assert(n!==null,"Expected parent to be a container"),va.Debug.Assert(e.GetComponent(0).isParent),e=e.tail),n===null?qs.throwNullException("nearestContainer"):n.ContentAtPath(e)}else{let n=this.rootContentContainer;return n===null?qs.throwNullException("contentContainer"):n.ContentAtPath(e)}}ConvertPathToRelative(e){let n=this.path,r=Math.min(e.length,n.length),i=-1;for(let a=0;a<r;++a){let u=n.GetComponent(a),h=e.GetComponent(a);if(u.Equals(h))i=a;else break}if(i==-1)return e;let l=n.componentCount-1-i,s=[];for(let a=0;a<l;++a)s.push(Zn.Path.Component.ToParent());for(let a=i+1;a<e.componentCount;++a)s.push(e.GetComponent(a));return new Zn.Path(s,!0)}CompactPathString(e){let n=null,r=null;return e.isRelative?(r=e.componentsString,n=this.path.PathByAppendingPath(e).componentsString):(r=this.ConvertPathToRelative(e).componentsString,n=e.componentsString),r.length<n.length?r:n}get rootContentContainer(){let e=this;for(;e.parent;)e=e.parent;return er.asOrNull(e,hi.Container)}Copy(){throw Error("Not Implemented: Doesn't support copying")}SetChild(e,n,r){e[n]&&(e[n]=null),e[n]=r,e[n]&&(e[n].parent=this)}Equals(e){return e===this}}Ae.InkObject=Yy;var we={},Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.StringBuilder=void 0;class Zy{constructor(e){e=typeof e!="undefined"?e.toString():"",this.string=e}get Length(){return this.string.length}Append(e){e!==null&&(this.string+=e)}AppendLine(e){typeof e!="undefined"&&this.Append(e),this.string+=`
`}AppendFormat(e,...n){this.string+=e.replace(/{(\d+)}/g,(r,i)=>typeof n[i]!="undefined"?n[i]:r)}toString(){return this.string}Clear(){this.string=""}}Bt.StringBuilder=Zy;Object.defineProperty(we,"__esModule",{value:!0});we.InkList=we.InkListItem=void 0;const St=ue,eC=Bt;class pe{constructor(){if(this.originName=null,this.itemName=null,typeof arguments[1]!="undefined"){let e=arguments[0],n=arguments[1];this.originName=e,this.itemName=n}else if(arguments[0]){let n=arguments[0].toString().split(".");this.originName=n[0],this.itemName=n[1]}}static get Null(){return new pe(null,null)}get isNull(){return this.originName==null&&this.itemName==null}get fullName(){return(this.originName!==null?this.originName:"?")+"."+this.itemName}toString(){return this.fullName}Equals(e){if(e instanceof pe){let n=e;return n.itemName==this.itemName&&n.originName==this.originName}return!1}copy(){return new pe(this.originName,this.itemName)}serialized(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}static fromSerializedKey(e){let n=JSON.parse(e);if(!pe.isLikeInkListItem(n))return pe.Null;let r=n;return new pe(r.originName,r.itemName)}static isLikeInkListItem(e){return!(typeof e!="object"||!e.hasOwnProperty("originName")||!e.hasOwnProperty("itemName")||typeof e.originName!="string"&&typeof e.originName!==null||typeof e.itemName!="string"&&typeof e.itemName!==null)}}we.InkListItem=pe;class de extends Map{constructor(){super((()=>arguments[0]instanceof de?arguments[0]:[])());if(this.origins=null,this._originNames=[],arguments[0]instanceof de){let e=arguments[0],n=e.originNames;n!==null&&(this._originNames=n.slice()),e.origins!==null&&(this.origins=e.origins.slice())}else if(typeof arguments[0]=="string"){let e=arguments[0],n=arguments[1];if(this.SetInitialOriginName(e),n.listDefinitions===null)return St.throwNullException("originStory.listDefinitions");let r=n.listDefinitions.TryListGetDefinition(e,null);if(r.exists){if(r.result===null)return St.throwNullException("def.result");this.origins=[r.result]}else throw new Error("InkList origin could not be found in story when constructing new list: "+e)}else if(typeof arguments[0]=="object"&&arguments[0].hasOwnProperty("Key")&&arguments[0].hasOwnProperty("Value")){let e=arguments[0];this.Add(e.Key,e.Value)}}static FromString(e,n){var r;let i=(r=n.listDefinitions)===null||r===void 0?void 0:r.FindSingleItemListWithName(e);if(i)return i.value===null?St.throwNullException("listValue.value"):new de(i.value);throw new Error("Could not find the InkListItem from the string '"+e+"' to create an InkList because it doesn't exist in the original list definition in ink.")}AddItem(e){if(e instanceof pe){let n=e;if(n.originName==null){this.AddItem(n.itemName);return}if(this.origins===null)return St.throwNullException("this.origins");for(let r of this.origins)if(r.name==n.originName){let i=r.TryGetValueForItem(n,0);if(i.exists){this.Add(n,i.result);return}else throw new Error("Could not add the item "+n+" to this list because it doesn't exist in the original list definition in ink.")}throw new Error("Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.")}else{let n=e,r=null;if(this.origins===null)return St.throwNullException("this.origins");for(let s of this.origins){if(n===null)return St.throwNullException("itemName");if(s.ContainsItemWithName(n)){if(r!=null)throw new Error("Could not add the item "+n+" to this list because it could come from either "+s.name+" or "+r.name);r=s}}if(r==null)throw new Error("Could not add the item "+n+" to this list because it isn't known to any list definitions previously associated with this list.");let i=new pe(r.name,n),l=r.ValueForItem(i);this.Add(i,l)}}ContainsItemNamed(e){for(let[n]of this)if(pe.fromSerializedKey(n).itemName==e)return!0;return!1}ContainsKey(e){return this.has(e.serialized())}Add(e,n){let r=e.serialized();if(this.has(r))throw new Error(`The Map already contains an entry for ${e}`);this.set(r,n)}Remove(e){return this.delete(e.serialized())}get Count(){return this.size}get originOfMaxItem(){if(this.origins==null)return null;let e=this.maxItem.Key.originName,n=null;return this.origins.every(r=>r.name==e?(n=r,!1):!0),n}get originNames(){if(this.Count>0){this._originNames==null&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);for(let[e]of this){let n=pe.fromSerializedKey(e);if(n.originName===null)return St.throwNullException("item.originName");this._originNames.push(n.originName)}}return this._originNames}SetInitialOriginName(e){this._originNames=[e]}SetInitialOriginNames(e){e==null?this._originNames=null:this._originNames=e.slice()}get maxItem(){let e={Key:pe.Null,Value:0};for(let[n,r]of this){let i=pe.fromSerializedKey(n);(e.Key.isNull||r>e.Value)&&(e={Key:i,Value:r})}return e}get minItem(){let e={Key:pe.Null,Value:0};for(let[n,r]of this){let i=pe.fromSerializedKey(n);(e.Key.isNull||r<e.Value)&&(e={Key:i,Value:r})}return e}get inverse(){let e=new de;if(this.origins!=null)for(let n of this.origins)for(let[r,i]of n.items){let l=pe.fromSerializedKey(r);this.ContainsKey(l)||e.Add(l,i)}return e}get all(){let e=new de;if(this.origins!=null)for(let n of this.origins)for(let[r,i]of n.items){let l=pe.fromSerializedKey(r);e.set(l.serialized(),i)}return e}Union(e){let n=new de(this);for(let[r,i]of e)n.set(r,i);return n}Intersect(e){let n=new de;for(let[r,i]of this)e.has(r)&&n.set(r,i);return n}HasIntersection(e){for(let[n]of this)if(e.has(n))return!0;return!1}Without(e){let n=new de(this);for(let[r]of e)n.delete(r);return n}Contains(e){if(typeof e=="string")return this.ContainsItemNamed(e);const n=e;if(n.size==0||this.size==0)return!1;for(let[r]of n)if(!this.has(r))return!1;return!0}GreaterThan(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>e.maxItem.Value}GreaterThanOrEquals(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>=e.minItem.Value&&this.maxItem.Value>=e.maxItem.Value}LessThan(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<e.minItem.Value}LessThanOrEquals(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<=e.maxItem.Value&&this.minItem.Value<=e.minItem.Value}MaxAsList(){return this.Count>0?new de(this.maxItem):new de}MinAsList(){return this.Count>0?new de(this.minItem):new de}ListWithSubRange(e,n){if(this.Count==0)return new de;let r=this.orderedItems,i=0,l=Number.MAX_SAFE_INTEGER;Number.isInteger(e)?i=e:e instanceof de&&e.Count>0&&(i=e.minItem.Value),Number.isInteger(n)?l=n:e instanceof de&&e.Count>0&&(l=n.maxItem.Value);let s=new de;s.SetInitialOriginNames(this.originNames);for(let o of r)o.Value>=i&&o.Value<=l&&s.Add(o.Key,o.Value);return s}Equals(e){if(!(e instanceof de)||e.Count!=this.Count)return!1;for(let[n]of this)if(!e.has(n))return!1;return!0}get orderedItems(){let e=new Array;for(let[n,r]of this){let i=pe.fromSerializedKey(n);e.push({Key:i,Value:r})}return e.sort((n,r)=>n.Key.originName===null?St.throwNullException("x.Key.originName"):r.Key.originName===null?St.throwNullException("y.Key.originName"):n.Value==r.Value?n.Key.originName.localeCompare(r.Key.originName):n.Value<r.Value?-1:n.Value>r.Value?1:0),e}toString(){let e=this.orderedItems,n=new eC.StringBuilder;for(let r=0;r<e.length;r++){r>0&&n.Append(", ");let i=e[r].Key;if(i.itemName===null)return St.throwNullException("item.itemName");n.Append(i.itemName)}return n.toString()}valueOf(){return NaN}}we.InkList=de;var Gn={};Object.defineProperty(Gn,"__esModule",{value:!0});Gn.StoryException=void 0;class tC extends Error{constructor(e){super(e);this.useEndLineNumber=!1,this.message=e,this.name="StoryException"}}Gn.StoryException=tC;var at={};Object.defineProperty(at,"__esModule",{value:!0});at.tryParseFloat=at.tryParseInt=at.tryGetValueFromMap=void 0;function nC(t,e,n){if(t===null)return{result:n,exists:!1};let r=t.get(e);return typeof r=="undefined"?{result:n,exists:!1}:{result:r,exists:!0}}at.tryGetValueFromMap=nC;function rC(t,e=0){let n=parseInt(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}at.tryParseInt=rC;function iC(t,e=0){let n=parseFloat(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}at.tryParseFloat=iC;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=t.ListValue=t.VariablePointerValue=t.DivertTargetValue=t.StringValue=t.FloatValue=t.IntValue=t.BoolValue=t.Value=t.AbstractValue=void 0;const e=Ae,n=Ke,r=we,i=Gn,l=B,s=at,o=ue;class a extends e.InkObject{static Create(y,w){if(w){if(w===f.Int&&Number.isInteger(Number(y)))return new p(Number(y));if(w===f.Float&&!isNaN(y))return new c(Number(y))}if(typeof y=="boolean")return new h(Boolean(y));if(typeof y=="string")return new g(String(y));if(Number.isInteger(Number(y)))return new p(Number(y));if(isNaN(y)){if(y instanceof n.Path)return new S(l.asOrThrows(y,n.Path));if(y instanceof r.InkList)return new d(l.asOrThrows(y,r.InkList))}else return new c(Number(y));return null}Copy(){return l.asOrThrows(a.Create(this.valueObject),e.InkObject)}BadCastException(y){return new i.StoryException("Can't cast "+this.valueObject+" from "+this.valueType+" to "+y)}}t.AbstractValue=a;class u extends a{constructor(y){super();this.value=y}get valueObject(){return this.value}toString(){return this.value===null?o.throwNullException("Value.value"):this.value.toString()}}t.Value=u;class h extends u{constructor(y){super(y||!1)}get isTruthy(){return Boolean(this.value)}get valueType(){return f.Bool}Cast(y){if(this.value===null)return o.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Int)return new p(this.value?1:0);if(y==f.Float)return new c(this.value?1:0);if(y==f.String)return new g(this.value?"true":"false");throw this.BadCastException(y)}toString(){return this.value?"true":"false"}}t.BoolValue=h;class p extends u{constructor(y){super(y||0)}get isTruthy(){return this.value!=0}get valueType(){return f.Int}Cast(y){if(this.value===null)return o.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Bool)return new h(this.value!==0);if(y==f.Float)return new c(this.value);if(y==f.String)return new g(""+this.value);throw this.BadCastException(y)}}t.IntValue=p;class c extends u{constructor(y){super(y||0)}get isTruthy(){return this.value!=0}get valueType(){return f.Float}Cast(y){if(this.value===null)return o.throwNullException("Value.value");if(y==this.valueType)return this;if(y==f.Bool)return new h(this.value!==0);if(y==f.Int)return new p(this.value);if(y==f.String)return new g(""+this.value);throw this.BadCastException(y)}}t.FloatValue=c;class g extends u{constructor(y){super(y||"");if(this._isNewline=this.value==`
`,this._isInlineWhitespace=!0,this.value===null)return o.throwNullException("Value.value");this.value.length>0&&this.value.split("").every(w=>w!=" "&&w!="	"?(this._isInlineWhitespace=!1,!1):!0)}get valueType(){return f.String}get isTruthy(){return this.value===null?o.throwNullException("Value.value"):this.value.length>0}get isNewline(){return this._isNewline}get isInlineWhitespace(){return this._isInlineWhitespace}get isNonWhitespace(){return!this.isNewline&&!this.isInlineWhitespace}Cast(y){if(y==this.valueType)return this;if(y==f.Int){let w=s.tryParseInt(this.value);if(w.exists)return new p(w.result);throw this.BadCastException(y)}if(y==f.Float){let w=s.tryParseFloat(this.value);if(w.exists)return new c(w.result);throw this.BadCastException(y)}throw this.BadCastException(y)}}t.StringValue=g;class S extends u{constructor(y=null){super(y)}get valueType(){return f.DivertTarget}get targetPath(){return this.value===null?o.throwNullException("Value.value"):this.value}set targetPath(y){this.value=y}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a divert target")}Cast(y){if(y==this.valueType)return this;throw this.BadCastException(y)}toString(){return"DivertTargetValue("+this.targetPath+")"}}t.DivertTargetValue=S;class E extends u{constructor(y,w=-1){super(y);this._contextIndex=w}get contextIndex(){return this._contextIndex}set contextIndex(y){this._contextIndex=y}get variableName(){return this.value===null?o.throwNullException("Value.value"):this.value}set variableName(y){this.value=y}get valueType(){return f.VariablePointer}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a variable pointer")}Cast(y){if(y==this.valueType)return this;throw this.BadCastException(y)}toString(){return"VariablePointerValue("+this.variableName+")"}Copy(){return new E(this.variableName,this.contextIndex)}}t.VariablePointerValue=E;class d extends u{get isTruthy(){return this.value===null?o.throwNullException("this.value"):this.value.Count>0}get valueType(){return f.List}Cast(y){if(this.value===null)return o.throwNullException("Value.value");if(y==f.Int){let w=this.value.maxItem;return w.Key.isNull?new p(0):new p(w.Value)}else if(y==f.Float){let w=this.value.maxItem;return w.Key.isNull?new c(0):new c(w.Value)}else if(y==f.String){let w=this.value.maxItem;return w.Key.isNull?new g(""):new g(w.Key.toString())}if(y==this.valueType)return this;throw this.BadCastException(y)}constructor(y,w){super(null);!y&&!w?this.value=new r.InkList:y instanceof r.InkList?this.value=new r.InkList(y):y instanceof r.InkListItem&&typeof w=="number"&&(this.value=new r.InkList({Key:y,Value:w}))}static RetainListOriginsForAssignment(y,w){let b=l.asOrNull(y,d),N=l.asOrNull(w,d);if(N&&N.value===null)return o.throwNullException("newList.value");if(b&&b.value===null)return o.throwNullException("oldList.value");b&&N&&N.value.Count==0&&N.value.SetInitialOriginNames(b.value.originNames)}}t.ListValue=d;var f;(function(v){v[v.Bool=-1]="Bool",v[v.Int=0]="Int",v[v.Float=1]="Float",v[v.List=2]="List",v[v.String=3]="String",v[v.DivertTarget=4]="DivertTarget",v[v.VariablePointer=5]="VariablePointer"})(f=t.ValueType||(t.ValueType={}))})(ie);var vo={};Object.defineProperty(vo,"__esModule",{value:!0});vo.SearchResult=void 0;const sC=he;class Ih{constructor(){this.obj=null,this.approximate=!1}get correctObj(){return this.approximate?null:this.obj}get container(){return this.obj instanceof sC.Container?this.obj:null}copy(){let e=new Ih;return e.obj=this.obj,e.approximate=this.approximate,e}}vo.SearchResult=Ih;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;const e=ie,n=ue,r=Bt,i=Ae,l=vo,s=Ke,o=ms,a=at,u=B;class h extends i.InkObject{constructor(){super(...arguments);this.name=null,this._content=[],this.namedContent=new Map,this.visitsShouldBeCounted=!1,this.turnIndexShouldBeCounted=!1,this.countingAtStartOnly=!1,this._pathToFirstLeafContent=null}get hasValidName(){return this.name!=null&&this.name.length>0}get content(){return this._content}set content(c){this.AddContent(c)}get namedOnlyContent(){let c=new Map;for(let[g,S]of this.namedContent){let E=u.asOrThrows(S,i.InkObject);c.set(g,E)}for(let g of this.content){let S=u.asINamedContentOrNull(g);S!=null&&S.hasValidName&&c.delete(S.name)}return c.size==0&&(c=null),c}set namedOnlyContent(c){let g=this.namedOnlyContent;if(g!=null)for(let[S]of g)this.namedContent.delete(S);if(c!=null)for(let[,S]of c){let E=u.asINamedContentOrNull(S);E!=null&&this.AddToNamedContentOnly(E)}}get countFlags(){let c=0;return this.visitsShouldBeCounted&&(c|=h.CountFlags.Visits),this.turnIndexShouldBeCounted&&(c|=h.CountFlags.Turns),this.countingAtStartOnly&&(c|=h.CountFlags.CountStartOnly),c==h.CountFlags.CountStartOnly&&(c=0),c}set countFlags(c){let g=c;(g&h.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(g&h.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(g&h.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}get pathToFirstLeafContent(){return this._pathToFirstLeafContent==null&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}get internalPathToFirstLeafContent(){let c=[],g=this;for(;g instanceof h;)g.content.length>0&&(c.push(new s.Path.Component(0)),g=g.content[0]);return new s.Path(c)}AddContent(c){if(c instanceof Array){let g=c;for(let S of g)this.AddContent(S)}else{let g=c;if(this._content.push(g),g.parent)throw new Error("content is already in "+g.parent);g.parent=this,this.TryAddNamedContent(g)}}TryAddNamedContent(c){let g=u.asINamedContentOrNull(c);g!=null&&g.hasValidName&&this.AddToNamedContentOnly(g)}AddToNamedContentOnly(c){o.Debug.AssertType(c,i.InkObject,"Can only add Runtime.Objects to a Runtime.Container");let g=u.asOrThrows(c,i.InkObject);if(g.parent=this,c.name===null)return n.throwNullException("namedContentObj.name");this.namedContent.set(c.name,c)}ContentAtPath(c,g=0,S=-1){S==-1&&(S=c.length);let E=new l.SearchResult;E.approximate=!1;let d=this,f=this;for(let v=g;v<S;++v){let y=c.GetComponent(v);if(d==null){E.approximate=!0;break}let w=d.ContentWithPathComponent(y);if(w==null){E.approximate=!0;break}f=w,d=u.asOrNull(w,h)}return E.obj=f,E}InsertContent(c,g){if(this.content.splice(g,0,c),c.parent)throw new Error("content is already in "+c.parent);c.parent=this,this.TryAddNamedContent(c)}AddContentsOfContainer(c){this.content.push(...c.content);for(let g of c.content)g.parent=this,this.TryAddNamedContent(g)}ContentWithPathComponent(c){if(c.isIndex)return c.index>=0&&c.index<this.content.length?this.content[c.index]:null;if(c.isParent)return this.parent;{if(c.name===null)return n.throwNullException("component.name");let g=a.tryGetValueFromMap(this.namedContent,c.name,null);return g.exists?u.asOrThrows(g.result,i.InkObject):null}}BuildStringOfHierarchy(){let c;if(arguments.length==0)return c=new r.StringBuilder,this.BuildStringOfHierarchy(c,0,null),c.toString();c=arguments[0];let g=arguments[1],S=arguments[2];function E(){for(let v=0;v<4*g;++v)c.Append(" ")}E(),c.Append("["),this.hasValidName&&c.AppendFormat(" ({0})",this.name),this==S&&c.Append("  <---"),c.AppendLine(),g++;for(let f=0;f<this.content.length;++f){let v=this.content[f];v instanceof h?v.BuildStringOfHierarchy(c,g,S):(E(),v instanceof e.StringValue?(c.Append('"'),c.Append(v.toString().replace(`
`,"\\n")),c.Append('"')):c.Append(v.toString())),f!=this.content.length-1&&c.Append(","),!(v instanceof h)&&v==S&&c.Append("  <---"),c.AppendLine()}let d=new Map;for(let[f,v]of this.namedContent)this.content.indexOf(u.asOrThrows(v,i.InkObject))>=0||d.set(f,v);if(d.size>0){E(),c.AppendLine("-- named: --");for(let[,f]of d)o.Debug.AssertType(f,h,"Can only print out named Containers"),f.BuildStringOfHierarchy(c,g,S),c.AppendLine()}g--,E(),c.Append("]")}}t.Container=h,function(p){(function(c){c[c.Visits=1]="Visits",c[c.Turns=2]="Turns",c[c.CountStartOnly=4]="CountStartOnly"})(p.CountFlags||(p.CountFlags={}))}(h=t.Container||(t.Container={}))})(he);var Fe={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlCommand=void 0;const e=Ae;class n extends e.InkObject{constructor(i=n.CommandType.NotSet){super();this._commandType=i}get commandType(){return this._commandType}Copy(){return new n(this.commandType)}static EvalStart(){return new n(n.CommandType.EvalStart)}static EvalOutput(){return new n(n.CommandType.EvalOutput)}static EvalEnd(){return new n(n.CommandType.EvalEnd)}static Duplicate(){return new n(n.CommandType.Duplicate)}static PopEvaluatedValue(){return new n(n.CommandType.PopEvaluatedValue)}static PopFunction(){return new n(n.CommandType.PopFunction)}static PopTunnel(){return new n(n.CommandType.PopTunnel)}static BeginString(){return new n(n.CommandType.BeginString)}static EndString(){return new n(n.CommandType.EndString)}static NoOp(){return new n(n.CommandType.NoOp)}static ChoiceCount(){return new n(n.CommandType.ChoiceCount)}static Turns(){return new n(n.CommandType.Turns)}static TurnsSince(){return new n(n.CommandType.TurnsSince)}static ReadCount(){return new n(n.CommandType.ReadCount)}static Random(){return new n(n.CommandType.Random)}static SeedRandom(){return new n(n.CommandType.SeedRandom)}static VisitIndex(){return new n(n.CommandType.VisitIndex)}static SequenceShuffleIndex(){return new n(n.CommandType.SequenceShuffleIndex)}static StartThread(){return new n(n.CommandType.StartThread)}static Done(){return new n(n.CommandType.Done)}static End(){return new n(n.CommandType.End)}static ListFromInt(){return new n(n.CommandType.ListFromInt)}static ListRange(){return new n(n.CommandType.ListRange)}static ListRandom(){return new n(n.CommandType.ListRandom)}static BeginTag(){return new n(n.CommandType.BeginTag)}static EndTag(){return new n(n.CommandType.EndTag)}toString(){return this.commandType.toString()}}t.ControlCommand=n,function(r){(function(i){i[i.NotSet=-1]="NotSet",i[i.EvalStart=0]="EvalStart",i[i.EvalOutput=1]="EvalOutput",i[i.EvalEnd=2]="EvalEnd",i[i.Duplicate=3]="Duplicate",i[i.PopEvaluatedValue=4]="PopEvaluatedValue",i[i.PopFunction=5]="PopFunction",i[i.PopTunnel=6]="PopTunnel",i[i.BeginString=7]="BeginString",i[i.EndString=8]="EndString",i[i.NoOp=9]="NoOp",i[i.ChoiceCount=10]="ChoiceCount",i[i.Turns=11]="Turns",i[i.TurnsSince=12]="TurnsSince",i[i.ReadCount=13]="ReadCount",i[i.Random=14]="Random",i[i.SeedRandom=15]="SeedRandom",i[i.VisitIndex=16]="VisitIndex",i[i.SequenceShuffleIndex=17]="SequenceShuffleIndex",i[i.StartThread=18]="StartThread",i[i.Done=19]="Done",i[i.End=20]="End",i[i.ListFromInt=21]="ListFromInt",i[i.ListRange=22]="ListRange",i[i.ListRandom=23]="ListRandom",i[i.BeginTag=24]="BeginTag",i[i.EndTag=25]="EndTag",i[i.TOTAL_VALUES=26]="TOTAL_VALUES"})(r.CommandType||(r.CommandType={}))}(n=t.ControlCommand||(t.ControlCommand={}))})(Fe);Object.defineProperty(He,"__esModule",{value:!0});He.Expression=void 0;const Pf=he,ya=Fe,lC=Q;class oC extends lC.ParsedObject{constructor(){super(...arguments);this._prototypeRuntimeConstantExpression=null,this.outputWhenComplete=!1,this.GenerateRuntimeObject=()=>{const e=new Pf.Container;return e.AddContent(ya.ControlCommand.EvalStart()),this.GenerateIntoContainer(e),this.outputWhenComplete&&e.AddContent(ya.ControlCommand.EvalOutput()),e.AddContent(ya.ControlCommand.EvalEnd()),e},this.GenerateConstantIntoContainer=e=>{this._prototypeRuntimeConstantExpression===null&&(this._prototypeRuntimeConstantExpression=new Pf.Container,this.GenerateIntoContainer(this._prototypeRuntimeConstantExpression));for(const n of this._prototypeRuntimeConstantExpression.content){const r=n.Copy();r&&e.AddContent(r)}},this.toString=()=>"No string value in JavaScript."}get typeName(){return"Expression"}Equals(e){return!1}}He.Expression=oC;var ft={},Gt={};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.Void=void 0;const aC=Ae;class uC extends aC.InkObject{}Gt.Void=uC;Object.defineProperty(ft,"__esModule",{value:!0});ft.NativeFunctionCall=void 0;const V=ie,ci=Gn,hC=Gt,Hs=we,cC=Ae,nt=B,Be=ue;class M extends cC.InkObject{constructor(){super();if(this._name=null,this._numberOfParameters=0,this._prototype=null,this._isPrototype=!1,this._operationFuncs=null,arguments.length===0)M.GenerateNativeFunctionsIfNecessary();else if(arguments.length===1){let e=arguments[0];M.GenerateNativeFunctionsIfNecessary(),this.name=e}else if(arguments.length===2){let e=arguments[0],n=arguments[1];this._isPrototype=!0,this.name=e,this.numberOfParameters=n}}static CallWithName(e){return new M(e)}static CallExistsWithName(e){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(e)}get name(){return this._name===null?Be.throwNullException("NativeFunctionCall._name"):this._name}set name(e){this._name=e,this._isPrototype||(M._nativeFunctions===null?Be.throwNullException("NativeFunctionCall._nativeFunctions"):this._prototype=M._nativeFunctions.get(this._name)||null)}get numberOfParameters(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters}set numberOfParameters(e){this._numberOfParameters=e}Call(e){if(this._prototype)return this._prototype.Call(e);if(this.numberOfParameters!=e.length)throw new Error("Unexpected number of parameters");let n=!1;for(let l of e){if(l instanceof hC.Void)throw new ci.StoryException('Attempting to perform operation on a void value. Did you forget to "return" a value from a function you called here?');l instanceof V.ListValue&&(n=!0)}if(e.length==2&&n)return this.CallBinaryListOperation(e);let r=this.CoerceValuesToSingleType(e),i=r[0].valueType;return i==V.ValueType.Int?this.CallType(r):i==V.ValueType.Float?this.CallType(r):i==V.ValueType.String?this.CallType(r):i==V.ValueType.DivertTarget?this.CallType(r):i==V.ValueType.List?this.CallType(r):null}CallType(e){let n=nt.asOrThrows(e[0],V.Value),r=n.valueType,i=n,l=e.length;if(l==2||l==1){if(this._operationFuncs===null)return Be.throwNullException("NativeFunctionCall._operationFuncs");let s=this._operationFuncs.get(r);if(!s){const o=V.ValueType[r];throw new ci.StoryException("Cannot perform operation "+this.name+" on "+o)}if(l==2){let a=nt.asOrThrows(e[1],V.Value),u=s;if(i.value===null||a.value===null)return Be.throwNullException("NativeFunctionCall.Call BinaryOp values");let h=u(i.value,a.value);return V.Value.Create(h)}else{let o=s;if(i.value===null)return Be.throwNullException("NativeFunctionCall.Call UnaryOp value");let a=o(i.value);return this.name===M.Int?V.Value.Create(a,V.ValueType.Int):this.name===M.Float?V.Value.Create(a,V.ValueType.Float):V.Value.Create(a,n.valueType)}}else throw new Error("Unexpected number of parameters to NativeFunctionCall: "+e.length)}CallBinaryListOperation(e){if((this.name=="+"||this.name=="-")&&e[0]instanceof V.ListValue&&e[1]instanceof V.IntValue)return this.CallListIncrementOperation(e);let n=nt.asOrThrows(e[0],V.Value),r=nt.asOrThrows(e[1],V.Value);if((this.name=="&&"||this.name=="||")&&(n.valueType!=V.ValueType.List||r.valueType!=V.ValueType.List)){if(this._operationFuncs===null)return Be.throwNullException("NativeFunctionCall._operationFuncs");let i=this._operationFuncs.get(V.ValueType.Int);if(i===null)return Be.throwNullException("NativeFunctionCall.CallBinaryListOperation op");let l=nt.asBooleanOrThrows(i(n.isTruthy?1:0,r.isTruthy?1:0));return new V.BoolValue(l)}if(n.valueType==V.ValueType.List&&r.valueType==V.ValueType.List)return this.CallType([n,r]);throw new ci.StoryException("Can not call use "+this.name+" operation on "+V.ValueType[n.valueType]+" and "+V.ValueType[r.valueType])}CallListIncrementOperation(e){let n=nt.asOrThrows(e[0],V.ListValue),r=nt.asOrThrows(e[1],V.IntValue),i=new Hs.InkList;if(n.value===null)return Be.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value");for(let[l,s]of n.value){let o=Hs.InkListItem.fromSerializedKey(l);if(this._operationFuncs===null)return Be.throwNullException("NativeFunctionCall._operationFuncs");let a=this._operationFuncs.get(V.ValueType.Int);if(r.value===null)return Be.throwNullException("NativeFunctionCall.CallListIncrementOperation intVal.value");let u=a(s,r.value),h=null;if(n.value.origins===null)return Be.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value.origins");for(let p of n.value.origins)if(p.name==o.originName){h=p;break}if(h!=null){let p=h.TryGetItemWithValue(u,Hs.InkListItem.Null);p.exists&&i.Add(p.result,u)}}return new V.ListValue(i)}CoerceValuesToSingleType(e){let n=V.ValueType.Int,r=null;for(let l of e){let s=nt.asOrThrows(l,V.Value);s.valueType>n&&(n=s.valueType),s.valueType==V.ValueType.List&&(r=nt.asOrNull(s,V.ListValue))}let i=[];if(V.ValueType[n]==V.ValueType[V.ValueType.List])for(let l of e){let s=nt.asOrThrows(l,V.Value);if(s.valueType==V.ValueType.List)i.push(s);else if(s.valueType==V.ValueType.Int){let o=parseInt(s.valueObject);if(r=nt.asOrThrows(r,V.ListValue),r.value===null)return Be.throwNullException("NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value");let a=r.value.originOfMaxItem;if(a===null)return Be.throwNullException("NativeFunctionCall.CoerceValuesToSingleType list");let u=a.TryGetItemWithValue(o,Hs.InkListItem.Null);if(u.exists){let h=new V.ListValue(u.result,o);i.push(h)}else throw new ci.StoryException("Could not find List item with the value "+o+" in "+a.name)}else{const o=V.ValueType[s.valueType];throw new ci.StoryException("Cannot mix Lists and "+o+" values in this operation")}}else for(let l of e){let o=nt.asOrThrows(l,V.Value).Cast(n);i.push(o)}return i}static Identity(e){return e}static GenerateNativeFunctionsIfNecessary(){if(this._nativeFunctions==null){this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,(r,i)=>r+i),this.AddIntBinaryOp(this.Subtract,(r,i)=>r-i),this.AddIntBinaryOp(this.Multiply,(r,i)=>r*i),this.AddIntBinaryOp(this.Divide,(r,i)=>Math.floor(r/i)),this.AddIntBinaryOp(this.Mod,(r,i)=>r%i),this.AddIntUnaryOp(this.Negate,r=>-r),this.AddIntBinaryOp(this.Equal,(r,i)=>r==i),this.AddIntBinaryOp(this.Greater,(r,i)=>r>i),this.AddIntBinaryOp(this.Less,(r,i)=>r<i),this.AddIntBinaryOp(this.GreaterThanOrEquals,(r,i)=>r>=i),this.AddIntBinaryOp(this.LessThanOrEquals,(r,i)=>r<=i),this.AddIntBinaryOp(this.NotEquals,(r,i)=>r!=i),this.AddIntUnaryOp(this.Not,r=>r==0),this.AddIntBinaryOp(this.And,(r,i)=>r!=0&&i!=0),this.AddIntBinaryOp(this.Or,(r,i)=>r!=0||i!=0),this.AddIntBinaryOp(this.Max,(r,i)=>Math.max(r,i)),this.AddIntBinaryOp(this.Min,(r,i)=>Math.min(r,i)),this.AddIntBinaryOp(this.Pow,(r,i)=>Math.pow(r,i)),this.AddIntUnaryOp(this.Floor,M.Identity),this.AddIntUnaryOp(this.Ceiling,M.Identity),this.AddIntUnaryOp(this.Int,M.Identity),this.AddIntUnaryOp(this.Float,r=>r),this.AddFloatBinaryOp(this.Add,(r,i)=>r+i),this.AddFloatBinaryOp(this.Subtract,(r,i)=>r-i),this.AddFloatBinaryOp(this.Multiply,(r,i)=>r*i),this.AddFloatBinaryOp(this.Divide,(r,i)=>r/i),this.AddFloatBinaryOp(this.Mod,(r,i)=>r%i),this.AddFloatUnaryOp(this.Negate,r=>-r),this.AddFloatBinaryOp(this.Equal,(r,i)=>r==i),this.AddFloatBinaryOp(this.Greater,(r,i)=>r>i),this.AddFloatBinaryOp(this.Less,(r,i)=>r<i),this.AddFloatBinaryOp(this.GreaterThanOrEquals,(r,i)=>r>=i),this.AddFloatBinaryOp(this.LessThanOrEquals,(r,i)=>r<=i),this.AddFloatBinaryOp(this.NotEquals,(r,i)=>r!=i),this.AddFloatUnaryOp(this.Not,r=>r==0),this.AddFloatBinaryOp(this.And,(r,i)=>r!=0&&i!=0),this.AddFloatBinaryOp(this.Or,(r,i)=>r!=0||i!=0),this.AddFloatBinaryOp(this.Max,(r,i)=>Math.max(r,i)),this.AddFloatBinaryOp(this.Min,(r,i)=>Math.min(r,i)),this.AddFloatBinaryOp(this.Pow,(r,i)=>Math.pow(r,i)),this.AddFloatUnaryOp(this.Floor,r=>Math.floor(r)),this.AddFloatUnaryOp(this.Ceiling,r=>Math.ceil(r)),this.AddFloatUnaryOp(this.Int,r=>Math.floor(r)),this.AddFloatUnaryOp(this.Float,M.Identity),this.AddStringBinaryOp(this.Add,(r,i)=>r+i),this.AddStringBinaryOp(this.Equal,(r,i)=>r===i),this.AddStringBinaryOp(this.NotEquals,(r,i)=>r!==i),this.AddStringBinaryOp(this.Has,(r,i)=>r.includes(i)),this.AddStringBinaryOp(this.Hasnt,(r,i)=>!r.includes(i)),this.AddListBinaryOp(this.Add,(r,i)=>r.Union(i)),this.AddListBinaryOp(this.Subtract,(r,i)=>r.Without(i)),this.AddListBinaryOp(this.Has,(r,i)=>r.Contains(i)),this.AddListBinaryOp(this.Hasnt,(r,i)=>!r.Contains(i)),this.AddListBinaryOp(this.Intersect,(r,i)=>r.Intersect(i)),this.AddListBinaryOp(this.Equal,(r,i)=>r.Equals(i)),this.AddListBinaryOp(this.Greater,(r,i)=>r.GreaterThan(i)),this.AddListBinaryOp(this.Less,(r,i)=>r.LessThan(i)),this.AddListBinaryOp(this.GreaterThanOrEquals,(r,i)=>r.GreaterThanOrEquals(i)),this.AddListBinaryOp(this.LessThanOrEquals,(r,i)=>r.LessThanOrEquals(i)),this.AddListBinaryOp(this.NotEquals,(r,i)=>!r.Equals(i)),this.AddListBinaryOp(this.And,(r,i)=>r.Count>0&&i.Count>0),this.AddListBinaryOp(this.Or,(r,i)=>r.Count>0||i.Count>0),this.AddListUnaryOp(this.Not,r=>r.Count==0?1:0),this.AddListUnaryOp(this.Invert,r=>r.inverse),this.AddListUnaryOp(this.All,r=>r.all),this.AddListUnaryOp(this.ListMin,r=>r.MinAsList()),this.AddListUnaryOp(this.ListMax,r=>r.MaxAsList()),this.AddListUnaryOp(this.Count,r=>r.Count),this.AddListUnaryOp(this.ValueOfList,r=>r.maxItem.Value);let e=(r,i)=>r.Equals(i),n=(r,i)=>!r.Equals(i);this.AddOpToNativeFunc(this.Equal,2,V.ValueType.DivertTarget,e),this.AddOpToNativeFunc(this.NotEquals,2,V.ValueType.DivertTarget,n)}}AddOpFuncForType(e,n){this._operationFuncs==null&&(this._operationFuncs=new Map),this._operationFuncs.set(e,n)}static AddOpToNativeFunc(e,n,r,i){if(this._nativeFunctions===null)return Be.throwNullException("NativeFunctionCall._nativeFunctions");let l=this._nativeFunctions.get(e);l||(l=new M(e,n),this._nativeFunctions.set(e,l)),l.AddOpFuncForType(r,i)}static AddIntBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.Int,n)}static AddIntUnaryOp(e,n){this.AddOpToNativeFunc(e,1,V.ValueType.Int,n)}static AddFloatBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.Float,n)}static AddFloatUnaryOp(e,n){this.AddOpToNativeFunc(e,1,V.ValueType.Float,n)}static AddStringBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.String,n)}static AddListBinaryOp(e,n){this.AddOpToNativeFunc(e,2,V.ValueType.List,n)}static AddListUnaryOp(e,n){this.AddOpToNativeFunc(e,1,V.ValueType.List,n)}toString(){return'Native "'+this.name+'"'}}ft.NativeFunctionCall=M;M.Add="+";M.Subtract="-";M.Divide="/";M.Multiply="*";M.Mod="%";M.Negate="_";M.Equal="==";M.Greater=">";M.Less="<";M.GreaterThanOrEquals=">=";M.LessThanOrEquals="<=";M.NotEquals="!=";M.Not="!";M.And="&&";M.Or="||";M.Min="MIN";M.Max="MAX";M.Pow="POW";M.Floor="FLOOR";M.Ceiling="CEILING";M.Int="INT";M.Float="FLOAT";M.Has="?";M.Hasnt="!?";M.Intersect="^";M.ListMin="LIST_MIN";M.ListMax="LIST_MAX";M.All="LIST_ALL";M.Count="LIST_COUNT";M.ValueOfList="LIST_VALUE";M.Invert="LIST_INVERT";M._nativeFunctions=null;var gs={},Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});Mr.NumberExpression=void 0;const fC=He,Ca=ie,dC=B;class kh extends fC.Expression{constructor(e,n){super();if(this.isInt=()=>this.subtype=="int",this.isFloat=()=>this.subtype=="float",this.isBool=()=>this.subtype=="bool",this.GenerateIntoContainer=r=>{this.isInt()?r.AddContent(new Ca.IntValue(this.value)):this.isFloat()?r.AddContent(new Ca.FloatValue(this.value)):this.isBool()&&r.AddContent(new Ca.BoolValue(this.value))},this.toString=()=>String(this.value),typeof e=="number"&&!Number.isNaN(e)||typeof e=="boolean")this.value=e,this.subtype=n;else throw new Error("Unexpected object type in NumberExpression.")}get typeName(){return"Number"}Equals(e){const n=dC.asOrNull(e,kh);return n?n.subtype==this.subtype&&n.value==this.value:!1}}Mr.NumberExpression=kh;Object.defineProperty(gs,"__esModule",{value:!0});gs.UnaryExpression=void 0;const pC=He,mC=ft,tr=Mr,gC=B;class bu extends pC.Expression{constructor(e,n){super();this.op=n,this.GenerateIntoContainer=r=>{this.innerExpression.GenerateIntoContainer(r),r.AddContent(mC.NativeFunctionCall.CallWithName(this.nativeNameForOp))},this.toString=()=>this.nativeNameForOp+this.innerExpression,this.innerExpression=this.AddContent(e)}get nativeNameForOp(){return this.op==="-"?"_":this.op==="not"?"!":this.op}get typeName(){return"UnaryExpression"}}gs.UnaryExpression=bu;bu.WithInner=(t,e)=>{const n=gC.asOrNull(t,tr.NumberExpression);if(n){if(e==="-"){if(n.isInt())return new tr.NumberExpression(-n.value,"int");if(n.isFloat())return new tr.NumberExpression(-n.value,"float")}else if(e=="!"||e=="not"){if(n.isInt())return new tr.NumberExpression(n.value==0,"bool");if(n.isFloat())return new tr.NumberExpression(n.value==0,"bool");if(n.isBool())return new tr.NumberExpression(!n.value,"bool")}throw new Error("Unexpected operation or number type")}return new bu(t,e)};Object.defineProperty(ps,"__esModule",{value:!0});ps.BinaryExpression=void 0;const vC=He,yC=ft,CC=gs,SC=B;class wC extends vC.Expression{constructor(e,n,r){super();this.opName=r,this.GenerateIntoContainer=i=>{this.leftExpression.GenerateIntoContainer(i),this.rightExpression.GenerateIntoContainer(i),this.opName=this.NativeNameForOp(this.opName),i.AddContent(yC.NativeFunctionCall.CallWithName(this.opName))},this.NativeNameForOp=i=>i==="and"?"&&":i==="or"?"||":i==="mod"?"%":i==="has"?"?":i==="hasnt"?"!?":i,this.toString=()=>`(${this.leftExpression} ${this.opName} ${this.rightExpression})`,this.leftExpression=this.AddContent(e),this.rightExpression=this.AddContent(n),this.opName=r}get typeName(){return"BinaryExpression"}ResolveReferences(e){if(super.ResolveReferences(e),this.NativeNameForOp(this.opName)==="?"){const n=SC.asOrNull(this.leftExpression,CC.UnaryExpression);n!==null&&(n.op==="not"||n.op==="!")&&this.Error(`Using 'not' or '!' here negates '${n.innerExpression}' rather than the result of the '?' or 'has' operator. You need to add parentheses around the (A ? B) expression.`)}}}ps.BinaryExpression=wC;var yo={},Un={};Object.defineProperty(Un,"__esModule",{value:!0});Un.CharacterSet=void 0;class Iu{constructor(e){this.set=new Set,this.Add=n=>this.set.add(n),this.AddRange=(n,r)=>{for(let i=n.charCodeAt(0);i<=r.charCodeAt(0);++i)this.Add(String.fromCharCode(i));return this},this.AddCharacters=n=>{if(typeof n=="string"||Array.isArray(n))for(const r of n)this.Add(r);else for(const r of n.set)this.Add(r);return this},e&&this.AddCharacters(e)}}Un.CharacterSet=Iu;Iu.FromRange=(t,e)=>new Iu().AddRange(t,e);Object.defineProperty(yo,"__esModule",{value:!0});yo.CharacterRange=void 0;const Of=Un;class ku{constructor(e,n,r=[]){if(this._start=e,this._end=n,this._correspondingCharSet=new Of.CharacterSet,this._excludes=new Set,this.ToCharacterSet=()=>{if(this._correspondingCharSet.set.size===0)for(let i=this.start.charCodeAt(0),l=String.fromCharCode(i);i<=this.end.charCodeAt(0);i+=1)this._excludes.has(l)||this._correspondingCharSet.AddCharacters(l);return this._correspondingCharSet},r instanceof Of.CharacterSet)this._excludes=r.set;else for(const i of r)this._excludes.add(i)}get start(){return this._start}get end(){return this._end}}yo.CharacterRange=ku;ku.Define=(t,e,n=[])=>new ku(t,e,n);var zn={},$r={};Object.defineProperty($r,"__esModule",{value:!0});$r.ChoicePoint=void 0;const _C=Ae,EC=Ke,Sa=ue;class PC extends _C.InkObject{constructor(e=!0){super();this._pathOnChoice=null,this.hasCondition=!1,this.hasStartContent=!1,this.hasChoiceOnlyContent=!1,this.isInvisibleDefault=!1,this.onceOnly=!0,this.onceOnly=e}get pathOnChoice(){if(this._pathOnChoice!=null&&this._pathOnChoice.isRelative){let e=this.choiceTarget;e&&(this._pathOnChoice=e.path)}return this._pathOnChoice}set pathOnChoice(e){this._pathOnChoice=e}get choiceTarget(){return this._pathOnChoice===null?Sa.throwNullException("ChoicePoint._pathOnChoice"):this.ResolvePath(this._pathOnChoice).container}get pathStringOnChoice(){return this.pathOnChoice===null?Sa.throwNullException("ChoicePoint.pathOnChoice"):this.CompactPathString(this.pathOnChoice)}set pathStringOnChoice(e){this.pathOnChoice=new EC.Path(e)}get flags(){let e=0;return this.hasCondition&&(e|=1),this.hasStartContent&&(e|=2),this.hasChoiceOnlyContent&&(e|=4),this.isInvisibleDefault&&(e|=8),this.onceOnly&&(e|=16),e}set flags(e){this.hasCondition=(e&1)>0,this.hasStartContent=(e&2)>0,this.hasChoiceOnlyContent=(e&4)>0,this.isInvisibleDefault=(e&8)>0,this.onceOnly=(e&16)>0}toString(){if(this.pathOnChoice===null)return Sa.throwNullException("ChoicePoint.pathOnChoice");let e=this.pathOnChoice.toString();return"Choice: -> "+e}}$r.ChoicePoint=PC;var dt={},qn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PushPopType=void 0,function(e){e[e.Tunnel=0]="Tunnel",e[e.Function=1]="Function",e[e.FunctionEvaluationFromGame=2]="FunctionEvaluationFromGame"}(t.PushPopType||(t.PushPopType={}))})(qn);var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.Pointer=void 0;const OC=Ke;class $i{constructor(){this.container=null,this.index=-1,arguments.length===2&&(this.container=arguments[0],this.index=arguments[1])}Resolve(){return this.index<0?this.container:this.container==null?null:this.container.content.length==0?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}get isNull(){return this.container==null}get path(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new OC.Path.Component(this.index)):this.container.path}toString(){return this.container?"Ink Pointer -> "+this.container.path.toString()+" -- index "+this.index:"Ink Pointer (null)"}copy(){return new $i(this.container,this.index)}static StartOf(e){return new $i(e,0)}static get Null(){return new $i(null,-1)}}Hn.Pointer=$i;Object.defineProperty(dt,"__esModule",{value:!0});dt.Divert=void 0;const xC=Ke,TC=qn,NC=Bt,bC=Ae,wa=Hn,xf=he,Ks=ue;class Ah extends bC.InkObject{constructor(e){super();this._targetPath=null,this._targetPointer=wa.Pointer.Null,this.variableDivertName=null,this.pushesToStack=!1,this.stackPushType=0,this.isExternal=!1,this.externalArgs=0,this.isConditional=!1,this.pushesToStack=!1,typeof e!="undefined"&&(this.pushesToStack=!0,this.stackPushType=e)}get targetPath(){if(this._targetPath!=null&&this._targetPath.isRelative){let e=this.targetPointer.Resolve();e&&(this._targetPath=e.path)}return this._targetPath}set targetPath(e){this._targetPath=e,this._targetPointer=wa.Pointer.Null}get targetPointer(){if(this._targetPointer.isNull){let e=this.ResolvePath(this._targetPath).obj;if(this._targetPath===null)return Ks.throwNullException("this._targetPath");if(this._targetPath.lastComponent===null)return Ks.throwNullException("this._targetPath.lastComponent");if(this._targetPath.lastComponent.isIndex){if(e===null)return Ks.throwNullException("targetObj");this._targetPointer.container=e.parent instanceof xf.Container?e.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=wa.Pointer.StartOf(e instanceof xf.Container?e:null)}return this._targetPointer.copy()}get targetPathString(){return this.targetPath==null?null:this.CompactPathString(this.targetPath)}set targetPathString(e){e==null?this.targetPath=null:this.targetPath=new xC.Path(e)}get hasVariableTarget(){return this.variableDivertName!=null}Equals(e){let n=e;return n instanceof Ah&&this.hasVariableTarget==n.hasVariableTarget?this.hasVariableTarget?this.variableDivertName==n.variableDivertName:this.targetPath===null?Ks.throwNullException("this.targetPath"):this.targetPath.Equals(n.targetPath):!1}toString(){if(this.hasVariableTarget)return"Divert(variable: "+this.variableDivertName+")";if(this.targetPath==null)return"Divert(null)";{let e=new NC.StringBuilder,n=this.targetPath.toString();return e.Append("Divert"),this.isConditional&&e.Append("?"),this.pushesToStack&&(this.stackPushType==TC.PushPopType.Function?e.Append(" function"):e.Append(" tunnel")),e.Append(" -> "),e.Append(this.targetPathString),e.Append(" ("),e.Append(n),e.Append(")"),e.toString()}}}dt.Divert=Ah;var Ut={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolType=void 0,function(e){e[e.Knot=0]="Knot",e[e.List=1]="List",e[e.ListItem=2]="ListItem",e[e.Var=3]="Var",e[e.SubFlowAndWeave=4]="SubFlowAndWeave",e[e.Arg=5]="Arg",e[e.Temp=6]="Temp"}(t.SymbolType||(t.SymbolType={}))})(Ut);var It={};Object.defineProperty(It,"__esModule",{value:!0});It.VariableAssignment=void 0;const IC=Ae;class kC extends IC.InkObject{constructor(e,n){super();this.variableName=e||null,this.isNewDeclaration=!!n,this.isGlobal=!1}toString(){return"VarAssign to "+this.variableName}}It.VariableAssignment=kC;Object.defineProperty(zn,"__esModule",{value:!0});zn.Choice=void 0;const AC=$r,Js=he,Qt=Fe,_a=dt,Tf=ie,FC=Q,RC=Ut,Nf=It;class DC extends FC.ParsedObject{constructor(e,n,r){super();this._condition=null,this._innerContentContainer=null,this._outerContainer=null,this._runtimeChoice=null,this._returnToR1=null,this._returnToR2=null,this._r1Label=null,this._r2Label=null,this._divertToStartContentOuter=null,this._divertToStartContentInner=null,this._startContentRuntimeContainer=null,this.isInvisibleDefault=!1,this.hasWeaveStyleInlineBrackets=!1,this.GenerateRuntimeObject=()=>{if(this._outerContainer=new Js.Container,this._runtimeChoice=new AC.ChoicePoint(this.onceOnly),this._runtimeChoice.isInvisibleDefault=this.isInvisibleDefault,(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(Qt.ControlCommand.EvalStart()),this.startContent){this._returnToR1=new Tf.DivertTargetValue,this._outerContainer.AddContent(this._returnToR1);const i=new Nf.VariableAssignment("$r",!0);this._outerContainer.AddContent(i),this._outerContainer.AddContent(Qt.ControlCommand.BeginString()),this._divertToStartContentOuter=new _a.Divert,this._outerContainer.AddContent(this._divertToStartContentOuter),this._startContentRuntimeContainer=this.startContent.GenerateRuntimeObject(),this._startContentRuntimeContainer.name="s";const l=new _a.Divert;l.variableDivertName="$r",this._startContentRuntimeContainer.AddContent(l),this._outerContainer.AddToNamedContentOnly(this._startContentRuntimeContainer),this._r1Label=new Js.Container,this._r1Label.name="$r1",this._outerContainer.AddContent(this._r1Label),this._outerContainer.AddContent(Qt.ControlCommand.EndString()),this._runtimeChoice.hasStartContent=!0}if(this.choiceOnlyContent){this._outerContainer.AddContent(Qt.ControlCommand.BeginString());const i=this.choiceOnlyContent.GenerateRuntimeObject();this._outerContainer.AddContentsOfContainer(i),this._outerContainer.AddContent(Qt.ControlCommand.EndString()),this._runtimeChoice.hasChoiceOnlyContent=!0}if(this.condition&&(this.condition.GenerateIntoContainer(this._outerContainer),this._runtimeChoice.hasCondition=!0),(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(Qt.ControlCommand.EvalEnd()),this._outerContainer.AddContent(this._runtimeChoice),this._innerContentContainer=new Js.Container,this.startContent){this._returnToR2=new Tf.DivertTargetValue,this._innerContentContainer.AddContent(Qt.ControlCommand.EvalStart()),this._innerContentContainer.AddContent(this._returnToR2),this._innerContentContainer.AddContent(Qt.ControlCommand.EvalEnd());const i=new Nf.VariableAssignment("$r",!0);this._innerContentContainer.AddContent(i),this._divertToStartContentInner=new _a.Divert,this._innerContentContainer.AddContent(this._divertToStartContentInner),this._r2Label=new Js.Container,this._r2Label.name="$r2",this._innerContentContainer.AddContent(this._r2Label)}if(this.innerContent){const i=this.innerContent.GenerateRuntimeObject();this._innerContentContainer.AddContentsOfContainer(i)}return this.story.countAllVisits&&(this._innerContentContainer.visitsShouldBeCounted=!0),this._innerContentContainer.countingAtStartOnly=!0,this._outerContainer},this.toString=()=>this.choiceOnlyContent!==null?`* ${this.startContent}[${this.choiceOnlyContent}]...`:`* ${this.startContent}...`,this.startContent=e,this.choiceOnlyContent=n,this.innerContent=r,this.indentationDepth=1,e&&this.AddContent(this.startContent),n&&this.AddContent(this.choiceOnlyContent),r&&this.AddContent(this.innerContent),this.onceOnly=!0}get runtimeChoice(){if(!this._runtimeChoice)throw new Error;return this._runtimeChoice}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get condition(){return this._condition}set condition(e){this._condition=e,e&&this.AddContent(e)}get runtimeContainer(){return this._innerContentContainer}get innerContentContainer(){return this._innerContentContainer}get containerForCounting(){return this._innerContentContainer}get runtimePath(){if(!this.innerContentContainer||!this.innerContentContainer.path)throw new Error;return this.innerContentContainer.path}get typeName(){return"Choice"}ResolveReferences(e){var n;if(this._innerContentContainer&&(this.runtimeChoice.pathOnChoice=this._innerContentContainer.path,this.onceOnly&&(this._innerContentContainer.visitsShouldBeCounted=!0)),this._returnToR1){if(!this._r1Label)throw new Error;this._returnToR1.targetPath=this._r1Label.path}if(this._returnToR2){if(!this._r2Label)throw new Error;this._returnToR2.targetPath=this._r2Label.path}if(this._divertToStartContentOuter){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentOuter.targetPath=this._startContentRuntimeContainer.path}if(this._divertToStartContentInner){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentInner.targetPath=this._startContentRuntimeContainer.path}super.ResolveReferences(e),this.identifier&&(((n=this.identifier)===null||n===void 0?void 0:n.name)||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,RC.SymbolType.SubFlowAndWeave)}}zn.Choice=DC;var Co={},Fh={},So={},wo={};Object.defineProperty(wo,"__esModule",{value:!0});wo.StringParserElement=void 0;class ss{constructor(){this.characterIndex=0,this.characterInLineIndex=0,this.lineIndex=0,this.reportedErrorInScope=!1,this.uniqueId=0,this.customFlags=0,this.CopyFrom=e=>{ss._uniqueIdCounter++,this.uniqueId=ss._uniqueIdCounter,this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.customFlags=e.customFlags,this.reportedErrorInScope=!1},this.SquashFrom=e=>{this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.reportedErrorInScope=e.reportedErrorInScope,this.customFlags=e.customFlags}}}wo.StringParserElement=ss;ss._uniqueIdCounter=1e3;Object.defineProperty(So,"__esModule",{value:!0});So.StringParserState=void 0;const bf=wo;class LC{constructor(){this._stack=[],this._numElements=0,this.StringParserState=()=>{this._stack=new Array(200);for(let r=0;r<200;++r)this._stack[r]=new bf.StringParserElement;this._numElements=1},this.Push=()=>{if(this._numElements>=this._stack.length&&this._numElements>0)throw new Error("Stack overflow in parser state.");const n=this._stack[this._numElements-1],r=this._stack[this._numElements];return this._numElements++,r.CopyFrom(n),r.uniqueId},this.Pop=n=>{if(this._numElements==1)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");if(this.currentElement.uniqueId!=n)throw new Error("Mismatched rule IDs while Poping - do you have mismatched Begin/Succeed/Fail?");this._numElements-=1},this.Peek=n=>{if(this.currentElement.uniqueId!=n)throw new Error("Mismatched rule IDs while Peeking - do you have mismatched Begin/Succeed/Fail?");return this._stack[this._numElements-1]},this.PeekPenultimate=()=>this._numElements>=2?this._stack[this._numElements-2]:null,this.Squash=()=>{if(this._numElements<2)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");const n=this._stack[this._numElements-2],r=this._stack[this._numElements-1];n.SquashFrom(r),this._numElements-=1},this.NoteErrorReported=()=>{for(const n of this._stack)n.reportedErrorInScope=!0};const e=200;for(let n=0;n<e;n++)this._stack[n]=new bf.StringParserElement;this._numElements=1}get currentElement(){return this._stack[this._numElements-1]}get lineIndex(){return this.currentElement.lineIndex}set lineIndex(e){this.currentElement.lineIndex=e}get characterIndex(){return this.currentElement.characterIndex}set characterIndex(e){this.currentElement.characterIndex=e}get characterInLineIndex(){return this.currentElement.characterInLineIndex}set characterInLineIndex(e){this.currentElement.characterInLineIndex=e}get customFlags(){return this.currentElement.customFlags}set customFlags(e){this.currentElement.customFlags=e}get errorReportedAlreadyInScope(){return this.currentElement.reportedErrorInScope}get stackHeight(){return this._numElements}}So.StringParserState=LC;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StringParser=t.ParseSuccess=void 0;const e=Un,n=So;t.ParseSuccess=Symbol("ParseSuccessStruct");class r{constructor(l){this.ParseRule=null,this.errorHandler=null,this.hadError=!1,this.BeginRule=()=>this.state.Push(),this.FailRule=o=>(this.state.Pop(o),null),this.CancelRule=o=>{this.state.Pop(o)},this.SucceedRule=(o,a=null)=>{const u=this.state.Peek(o),h=this.state.PeekPenultimate();this.RuleDidSucceed&&this.RuleDidSucceed(a,h,u),this.state.Squash();let p=a;return p===null&&(p=r.ParseSuccess),p},this.Expect=(o,a=null,u=null)=>{let h=this.ParseObject(o);if(h===null){a===null&&(a=o.name);let p;const c=this.LineRemainder();c===null||c.length===0?p="end of line":p=`'${c}'`,this.Error(`Expected ${a} but saw ${p}`),u!==null&&(h=u())}return h},this.Error=(o,a=!1)=>{this.ErrorOnLine(o,this.lineIndex+1,a)},this.ErrorWithParsedObject=(o,a,u=!1)=>{this.ErrorOnLine(o,a.debugMetadata?a.debugMetadata.startLineNumber:-1,u)},this.ErrorOnLine=(o,a,u)=>{if(!this.state.errorReportedAlreadyInScope){const h=u?"Warning":"Error";if(this.errorHandler)this.errorHandler(o,this.index,a-1,u);else throw new Error(`${h} on line ${a}: ${o}`);this.state.NoteErrorReported()}u||(this.hadError=!0)},this.Warning=o=>this.Error(o,!0),this.LineRemainder=()=>this.Peek(()=>this.ParseUntilCharactersFromString(`
\r`)),this.SetFlag=(o,a)=>{a?this.state.customFlags|=o:this.state.customFlags&=~o},this.GetFlag=o=>Boolean(this.state.customFlags&o),this.ParseObject=o=>{const a=this.BeginRule(),u=this.state.stackHeight,h=o();if(u!==this.state.stackHeight)throw new Error("Mismatched Begin/Fail/Succeed rules");return h===null?this.FailRule(a):(this.SucceedRule(a,h),h)},this.Parse=o=>{const a=this.BeginRule(),u=o();return u===null?(this.FailRule(a),null):(this.SucceedRule(a,u),u)},this.OneOf=o=>{for(const a of o){const u=this.ParseObject(a);if(u!==null)return u}return null},this.OneOrMore=o=>{const a=[];let u=null;do u=this.ParseObject(o),u!==null&&a.push(u);while(u!==null);return a.length>0?a:null},this.Optional=o=>()=>{const a=this.ParseObject(o);return a===null?r.ParseSuccess:a},this.Exclude=o=>()=>this.ParseObject(o)&&r.ParseSuccess,this.OptionalExclude=o=>()=>(this.ParseObject(o),r.ParseSuccess),this.String=o=>()=>this.ParseString(o),this.TryAddResultToList=(o,a,u=!0)=>{if(o!==r.ParseSuccess){if(u&&Array.isArray(o)){const h=o;if(h!==null){for(const p of h)a.push(p);return}}a.push(o)}},this.Interleave=(o,a,u=null,h=!0)=>{const p=this.BeginRule(),c=[],g=this.ParseObject(o);if(g===null)return this.FailRule(p);this.TryAddResultToList(g,c,h);let S=null,E=null;do{if(u!==null&&this.Peek(u)!==null||(S=this.ParseObject(a),S===null))break;if(this.TryAddResultToList(S,c,h),E=null,S!==null){if(E=this.ParseObject(o),E===null)break;this.TryAddResultToList(E,c,h)}}while((S!==null||E!==null)&&!(S===r.ParseSuccess&&E==r.ParseSuccess)&&this.remainingLength>0);return c.length===0?this.FailRule(p):this.SucceedRule(p,c)},this.ParseString=o=>{if(o.length>this.remainingLength)return null;const a=this.BeginRule();let u=this.index,h=this.characterInLineIndex,p=this.lineIndex,c=!0;for(let g=0;g<o.length;g+=1){const S=o[g];if(this._chars[u]!==S){c=!1;break}S===`
`&&(p++,h=-1),u++,h++}return this.index=u,this.characterInLineIndex=h,this.lineIndex=p,c?this.SucceedRule(a,o):this.FailRule(a)},this.ParseSingleCharacter=()=>{if(this.remainingLength>0){const o=this._chars[this.index];return o===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1,o}return"0"},this.ParseUntilCharactersFromString=(o,a=-1)=>this.ParseCharactersFromString(o,!1,a),this.ParseUntilCharactersFromCharSet=(o,a=-1)=>this.ParseCharactersFromCharSet(o,!1,a),this.ParseCharactersFromString=(o,a=-1,u=-1)=>{const h=new e.CharacterSet(o);return typeof a=="number"?this.ParseCharactersFromCharSet(h,!0,a):this.ParseCharactersFromCharSet(h,a,u)},this.ParseCharactersFromCharSet=(o,a=!0,u=-1)=>{u===-1&&(u=Number.MAX_SAFE_INTEGER);const h=this.index;let p=this.index,c=this.characterInLineIndex,g=this.lineIndex,S=0;for(;p<this._chars.length&&o.set.has(this._chars[p])===a&&S<u;)this._chars[p]===`
`&&(g+=1,c=-1),p+=1,c+=1,S+=1;return this.index=p,this.characterInLineIndex=c,this.lineIndex=g,this.index>h?this._chars.slice(h,this.index).join(""):null},this.Peek=o=>{const a=this.BeginRule(),u=o();return this.CancelRule(a),u},this.ParseInt=()=>{const o=this.index,a=this.characterInLineIndex,u=this.ParseString("-")!==null;this.ParseCharactersFromString(" 	");const h=this.ParseCharactersFromCharSet(r.numbersCharacterSet);if(h===null)return this.index=o,this.characterInLineIndex=a,null;let p;return Number.isNaN(Number(h))?(this.Error("Failed to read integer value: "+h+". Perhaps it's out of the range of acceptable numbers ink supports? ("+Number.MIN_SAFE_INTEGER+" to "+Number.MAX_SAFE_INTEGER+")"),null):(p=Number(h),u?-p:p)},this.ParseFloat=()=>{const o=this.index,a=this.characterInLineIndex,u=this.ParseInt();if(u!==null&&this.ParseString(".")!==null){const h=this.ParseCharactersFromCharSet(r.numbersCharacterSet);return Number(`${u}.${h}`)}return this.index=o,this.characterInLineIndex=a,null},this.ParseNewline=()=>{const o=this.BeginRule();return this.ParseString("\r"),this.ParseString(`
`)===null?this.FailRule(o):this.SucceedRule(o,`
`)};const s=this.PreProcessInputString(l);this.state=new n.StringParserState,l?this._chars=s.split(""):this._chars=[],this.inputString=s}get currentCharacter(){return this.index>=0&&this.remainingLength>0?this._chars[this.index]:"0"}PreProcessInputString(l){return l}get endOfInput(){return this.index>=this._chars.length}get remainingString(){return this._chars.slice(this.index,this.index+this.remainingLength).join("")}get remainingLength(){return this._chars.length-this.index}get lineIndex(){return this.state.lineIndex}set lineIndex(l){this.state.lineIndex=l}set characterInLineIndex(l){this.state.characterInLineIndex=l}get characterInLineIndex(){return this.state.characterInLineIndex}get index(){return this.state.characterIndex}set index(l){this.state.characterIndex=l}ParseUntil(l,s=null,o=null){const a=this.BeginRule(),u=new e.CharacterSet;s!==null&&(u.set=new Set([...u.set.values(),...s.set.values()])),o!==null&&(u.set=new Set([...u.set.values(),...o.set.values()]));let h="",p=null;do{const c=this.ParseUntilCharactersFromCharSet(u);if(c&&(h+=c),p=this.Peek(l),p!==null)break;{if(this.endOfInput)break;const g=this.currentCharacter;if(s!==null&&s.set.has(g)){h+=g,g===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1;continue}else break}}while(!0);return h.length>0?this.SucceedRule(a,String(h)):this.FailRule(a)}}t.StringParser=r,r.ParseSuccess=t.ParseSuccess,r.numbersCharacterSet=new e.CharacterSet("0123456789")})(Fh);Object.defineProperty(Co,"__esModule",{value:!0});Co.CommentEliminator=void 0;const Ea=Un,VC=Fh;class WC extends VC.StringParser{constructor(){super(...arguments);this._commentOrNewlineStartCharacter=new Ea.CharacterSet(`/\r
`),this._commentBlockEndCharacter=new Ea.CharacterSet("*"),this._newlineCharacters=new Ea.CharacterSet(`
\r`),this.Process=()=>{const e=this.Interleave(this.Optional(this.CommentsAndNewlines),this.Optional(this.MainInk));return e!==null?e.join(""):""},this.MainInk=()=>this.ParseUntil(this.CommentsAndNewlines,this._commentOrNewlineStartCharacter,null),this.CommentsAndNewlines=()=>{let e=this.Interleave(this.Optional(this.ParseNewline),this.Optional(this.ParseSingleComment));return e!==null?e.join(""):null},this.ParseSingleComment=()=>this.OneOf([this.EndOfLineComment,this.BlockComment]),this.EndOfLineComment=()=>this.ParseString("//")===null?null:(this.ParseUntilCharactersFromCharSet(this._newlineCharacters),""),this.BlockComment=()=>{if(this.ParseString("/*")===null)return null;const e=this.lineIndex,n=this.ParseUntil(this.String("*/"),this._commentBlockEndCharacter,null);return this.endOfInput||this.ParseString("*/"),n!=null?`
`.repeat(this.lineIndex-e):null}}PreProcessInputString(e){return e}}Co.CommentEliminator=WC;var Br={};Object.defineProperty(Br,"__esModule",{value:!0});Br.Conditional=void 0;const jC=he,If=Fe,MC=Q;class $C extends MC.ParsedObject{constructor(e,n){super();this.initialCondition=e,this.branches=n,this._reJoinTarget=null,this.GenerateRuntimeObject=()=>{const r=new jC.Container;this.initialCondition&&r.AddContent(this.initialCondition.runtimeObject);for(const i of this.branches){const l=i.runtimeObject;r.AddContent(l)}return this.initialCondition!==null&&this.branches[0].ownExpression!==null&&!this.branches[this.branches.length-1].isElse&&r.AddContent(If.ControlCommand.PopEvaluatedValue()),this._reJoinTarget=If.ControlCommand.NoOp(),r.AddContent(this._reJoinTarget),r},this.initialCondition&&this.AddContent(this.initialCondition),this.branches!==null&&this.AddContent(this.branches)}get typeName(){return"Conditional"}ResolveReferences(e){const n=this._reJoinTarget.path;for(const r of this.branches){if(!r.returnDivert)throw new Error;r.returnDivert.targetPath=n}super.ResolveReferences(e)}}Br.Conditional=$C;var vs={},zt={};Object.defineProperty(zt,"__esModule",{value:!0});zt.Text=void 0;const BC=Q,GC=ie;class UC extends BC.ParsedObject{constructor(e){super();this.text=e,this.GenerateRuntimeObject=()=>new GC.StringValue(this.text),this.toString=()=>this.text}get typeName(){return"Text"}}zt.Text=UC;var qt={},Gr={};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.ConstantDeclaration=void 0;const zC=Q,qC=Ut;class HC extends zC.ParsedObject{constructor(e,n){super();this._expression=null,this.GenerateRuntimeObject=()=>null,this.constantIdentifier=e,n&&(this._expression=this.AddContent(n))}get constantName(){var e;return(e=this.constantIdentifier)===null||e===void 0?void 0:e.name}get expression(){if(!this._expression)throw new Error;return this._expression}get typeName(){return"CONST"}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.constantIdentifier,qC.SymbolType.Var)}}Gr.ConstantDeclaration=HC;var Kn={},En={},pt={},Ur={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.FlowLevel=void 0,function(e){e[e.Story=0]="Story",e[e.Knot=1]="Knot",e[e.Stitch=2]="Stitch",e[e.WeavePoint=3]="WeavePoint"}(t.FlowLevel||(t.FlowLevel={}))})(Ur);var zr={};Object.defineProperty(zr,"__esModule",{value:!0});zr.Gather=void 0;const KC=he,JC=Q,QC=Ut;class XC extends JC.ParsedObject{constructor(e,n){super();this.indentationDepth=n,this.GenerateRuntimeObject=()=>{const r=new KC.Container;if(r.name=this.name,this.story.countAllVisits&&(r.visitsShouldBeCounted=!0),r.countingAtStartOnly=!0,this.content)for(const i of this.content)r.AddContent(i.runtimeObject);return r},this.toString=()=>{var r,i;return`- ${((r=this.identifier)===null||r===void 0?void 0:r.name)?"("+((i=this.identifier)===null||i===void 0?void 0:i.name)+")":"gather"}`},e&&(this.identifier=e)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get runtimeContainer(){return this.runtimeObject}get typeName(){return"Gather"}ResolveReferences(e){super.ResolveReferences(e),this.identifier&&(this.identifier.name||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,QC.SymbolType.SubFlowAndWeave)}}zr.Gather=XC;var Ht={};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.Path=void 0;const Qs=B,kf=pt,nr=Ur,YC=qt;class ZC{constructor(e,n){this._dotSeparatedComponents=null,this.toString=()=>this.components===null||this.components.length===0?this.baseTargetLevel===nr.FlowLevel.WeavePoint?"-> <next gather point>":"<invalid Path>":`-> ${this.dotSeparatedComponents}`,this.ResolveFromContext=r=>{if(this.components==null||this.components.length==0)return null;let i=this.ResolveBaseTarget(r);return i===null?null:this.components.length>1?this.ResolveTailComponents(i):i},this.ResolveBaseTarget=r=>{const i=this.firstComponent;let l=r;for(;l;){const s=l===r,o=this.GetChildFromContext(l,i,null,s);if(o)return o;l=l.parent}return null},this.ResolveTailComponents=r=>{let i=r;if(!this.components)return null;for(let l=1;l<this.components.length;++l){const s=this.components[l].name;let o,a=Qs.asOrNull(i,kf.FlowBase);if(a!==null?o=a.flowLevel+1:o=nr.FlowLevel.WeavePoint,i=this.GetChildFromContext(i,s,o),i===null)break}return i},this.GetChildFromContext=(r,i,l,s=!1)=>{const o=l===null,a=Qs.asOrNull(r,YC.Weave);if(i&&a!==null&&(o||l===nr.FlowLevel.WeavePoint))return a.WeavePointNamed(i);let u=Qs.asOrNull(r,kf.FlowBase);if(i&&u!==null){const h=s||u.flowLevel===nr.FlowLevel.Knot;return u.ContentWithNameAtLevel(i,l,h)}return null},Object.values(nr.FlowLevel).includes(e)?(this._baseTargetLevel=e,this.components=n||[]):Array.isArray(e)?(this._baseTargetLevel=null,this.components=e||[]):(this._baseTargetLevel=null,this.components=[e])}get baseTargetLevel(){return this.baseLevelIsAmbiguous?nr.FlowLevel.Story:this._baseTargetLevel}get baseLevelIsAmbiguous(){return!this._baseTargetLevel}get firstComponent(){return this.components==null||!this.components.length?null:this.components[0].name}get numberOfComponents(){return this.components?this.components.length:0}get dotSeparatedComponents(){return this._dotSeparatedComponents==null&&(this._dotSeparatedComponents=(this.components?this.components:[]).map(e=>e.name).filter(Qs.filterUndef).join(".")),this._dotSeparatedComponents}get typeName(){return"Path"}}Ht.Path=ZC;var ys={};Object.defineProperty(ys,"__esModule",{value:!0});ys.ReturnType=void 0;const eS=Q,tS=he,Pa=Fe,nS=Gt;class rS extends eS.ParsedObject{constructor(e=null){super();this.returnedExpression=null,this.GenerateRuntimeObject=()=>{const n=new tS.Container;return this.returnedExpression?n.AddContent(this.returnedExpression.runtimeObject):(n.AddContent(Pa.ControlCommand.EvalStart()),n.AddContent(new nS.Void),n.AddContent(Pa.ControlCommand.EvalEnd())),n.AddContent(Pa.ControlCommand.PopFunction()),n},e&&(this.returnedExpression=this.AddContent(e))}get typeName(){return"ReturnType"}}ys.ReturnType=rS;var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0});Jn.ClosestFlowBase=void 0;function iS(t){let e=t.parent;for(;e;){if(e.hasOwnProperty("iamFlowbase")&&e.iamFlowbase())return e;e=e.parent}return null}Jn.ClosestFlowBase=iS;var qr={};Object.defineProperty(qr,"__esModule",{value:!0});qr.Identifier=void 0;class Rh{constructor(e){this.debugMetadata=null,this.toString=()=>this.name||"undefined identifer",this.name=e}get typeName(){return"Identifier"}static Done(){return new Rh("DONE")}}qr.Identifier=Rh;Object.defineProperty(pt,"__esModule",{value:!0});pt.FlowBase=void 0;const sS=zn,Oa=Kn,lS=En,wt=Ur,oS=zr,aS=Q,uS=Ht,hS=ys,cS=he,fS=dt,dS=It,xa=Ut,pS=qt,mS=Jn,gS=qr,Af=B;class Ql extends aS.ParsedObject{constructor(e,n=null,r=null,i=!1,l=!1){super();this.isFunction=i,this._rootWeave=null,this._subFlowsByName=new Map,this._startingSubFlowDivert=null,this._startingSubFlowRuntime=null,this._firstChildFlow=null,this.variableDeclarations=new Map,this.identifier=null,this.args=null,this.iamFlowbase=()=>!0,this.SplitWeaveAndSubFlowContent=(s,o)=>{var a,u;const h=[],p=[];this._subFlowsByName=new Map;for(const g of s){const S=Af.asOrNull(g,Ql);S?(this._firstChildFlow===null&&(this._firstChildFlow=S),p.push(g),((a=S.identifier)===null||a===void 0?void 0:a.name)&&this._subFlowsByName.set((u=S.identifier)===null||u===void 0?void 0:u.name,S)):h.push(g)}o&&h.push(new oS.Gather(null,1),new Oa.Divert(new uS.Path(gS.Identifier.Done())));const c=[];return h.length>0&&(this._rootWeave=new pS.Weave(h,0),c.push(this._rootWeave)),p.length>0&&c.push(...p),c},this.ResolveVariableWithName=(s,o)=>{var a;const u={},h=o===null?this:mS.ClosestFlowBase(o);if(h){if(h.args!==null){for(const p of h.args)if(((a=p.identifier)===null||a===void 0?void 0:a.name)===s)return u.found=!0,u.isArgument=!0,u.ownerFlow=h,u}if(h!==this.story&&h.variableDeclarations.has(s))return u.found=!0,u.ownerFlow=h,u.isTemporary=!0,u}return this.story.variableDeclarations.has(s)?(u.found=!0,u.ownerFlow=this.story,u.isGlobal=!0,u):(u.found=!1,u)},this.AddNewVariableDeclaration=s=>{const o=s.variableName;if(this.variableDeclarations.has(o)){const a=this.variableDeclarations.get(o);let u="";a.debugMetadata&&(u=` (${a.debugMetadata})`),this.Error(`found declaration variable '${o}' that was already declared${u}`,s,!1);return}this.variableDeclarations.set(s.variableName,s)},this.ResolveWeavePointNaming=()=>{this._rootWeave&&this._rootWeave.ResolveWeavePointNaming();for(const[,s]of this._subFlowsByName)s.hasOwnProperty("ResolveWeavePointNaming")&&s.ResolveWeavePointNaming()},this.GenerateRuntimeObject=()=>{var s;let o=null;this.isFunction?this.CheckForDisallowedFunctionFlowControl():(this.flowLevel===wt.FlowLevel.Knot||this.flowLevel===wt.FlowLevel.Stitch)&&(o=this.Find(hS.ReturnType)(),o!==null&&this.Error(`Return statements can only be used in knots that are declared as functions: == function ${this.identifier} ==`,o));const a=new cS.Container;a.name=(s=this.identifier)===null||s===void 0?void 0:s.name,this.story.countAllVisits&&(a.visitsShouldBeCounted=!0),this.GenerateArgumentVariableAssignments(a);let u=0;for(;this.content!==null&&u<this.content.length;){const h=this.content[u];if(h instanceof Ql){const p=h,c=p.runtimeObject;u===0&&!p.hasParameters&&this.flowLevel===wt.FlowLevel.Knot&&(this._startingSubFlowDivert=new fS.Divert,a.AddContent(this._startingSubFlowDivert),this._startingSubFlowRuntime=c);const g=c,S=a.namedContent.get(g.name)||null;if(S){const E=`${this.GetType()} already contains flow named '${g.name}' (at ${S.debugMetadata})`;this.Error(E,p)}a.AddToNamedContentOnly(g)}else h&&a.AddContent(h.runtimeObject);u+=1}return this.flowLevel!==wt.FlowLevel.Story&&!this.isFunction&&this._rootWeave!==null&&o===null&&this._rootWeave.ValidateTermination(this.WarningInTermination),a},this.GenerateArgumentVariableAssignments=s=>{var o;if(!(this.args===null||this.args.length===0))for(let a=this.args.length-1;a>=0;--a){const u=((o=this.args[a].identifier)===null||o===void 0?void 0:o.name)||null,h=new dS.VariableAssignment(u,!0);s.AddContent(h)}},this.ContentWithNameAtLevel=(s,o=null,a=!1)=>{var u;if((o===this.flowLevel||o===null)&&s===((u=this.identifier)===null||u===void 0?void 0:u.name))return this;if(o===wt.FlowLevel.WeavePoint||o===null){let p=null;if(this._rootWeave&&(p=this._rootWeave.WeavePointNamed(s),p))return p;if(o===wt.FlowLevel.WeavePoint)return a?this.DeepSearchForAnyLevelContent(s):null}if(o!==null&&o<this.flowLevel)return null;let h=this._subFlowsByName.get(s)||null;return h&&(o===null||o===h.flowLevel)?h:a?this.DeepSearchForAnyLevelContent(s):null},this.DeepSearchForAnyLevelContent=s=>{const o=this.ContentWithNameAtLevel(s,wt.FlowLevel.WeavePoint,!1);if(o)return o;for(const[,a]of this._subFlowsByName){const u=a.ContentWithNameAtLevel(s,null,!0);if(u)return u}return null},this.CheckForDisallowedFunctionFlowControl=()=>{this.flowLevel!==wt.FlowLevel.Knot&&this.Error("Functions cannot be stitches - i.e. they should be defined as '== function myFunc ==' rather than internal to another knot.");for(const[a,u]of this._subFlowsByName)this.Error(`Functions may not contain stitches, but saw '${a}' within the function '${this.identifier}'`,u);if(!this._rootWeave)throw new Error;const s=this._rootWeave.FindAll(Oa.Divert)();for(const a of s)!a.isFunctionCall&&!(a.parent instanceof lS.DivertTarget)&&this.Error(`Functions may not contain diverts, but saw '${a}'`,a);const o=this._rootWeave.FindAll(sS.Choice)();for(const a of o)this.Error(`Functions may not contain choices, but saw '${a}'`,a)},this.WarningInTermination=s=>{let o="Apparent loose end exists where the flow runs out. Do you need a '-> DONE' statement, choice or divert?";s.parent===this._rootWeave&&this._firstChildFlow&&(o=`${o} Note that if you intend to enter '${this._firstChildFlow.identifier}' next, you need to divert to it explicitly.`);const a=Af.asOrNull(s,Oa.Divert);a&&a.isTunnel&&(o+=` When final tunnel to '${a.target} ->' returns it won't have anywhere to go.`),this.Warning(o,s)},this.toString=()=>`${this.typeName} '${this.identifier}'`,this.identifier=e,this.args=r,n===null&&(n=[]),this.PreProcessTopLevelObjects(n),n=this.SplitWeaveAndSubFlowContent(n,this.GetType()=="Story"&&!l),this.AddContent(n)}get hasParameters(){return this.args!==null&&this.args.length>0}get subFlowsByName(){return this._subFlowsByName}get typeName(){return this.isFunction?"Function":String(this.flowLevel)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}PreProcessTopLevelObjects(e){}ResolveReferences(e){var n,r;if(this._startingSubFlowDivert){if(!this._startingSubFlowRuntime)throw new Error;this._startingSubFlowDivert.targetPath=this._startingSubFlowRuntime.path}if(super.ResolveReferences(e),this.args!==null){for(const i of this.args)e.CheckForNamingCollisions(this,i.identifier,xa.SymbolType.Arg,"argument");for(let i=0;i<this.args.length;i+=1)for(let l=i+1;l<this.args.length;l+=1)((n=this.args[i].identifier)===null||n===void 0?void 0:n.name)==((r=this.args[l].identifier)===null||r===void 0?void 0:r.name)&&this.Error(`Multiple arguments with the same name: '${this.args[i].identifier}'`)}if(this.flowLevel!==wt.FlowLevel.Story){const i=this.flowLevel===wt.FlowLevel.Knot?xa.SymbolType.Knot:xa.SymbolType.SubFlowAndWeave;e.CheckForNamingCollisions(this,this.identifier,i)}}}pt.FlowBase=Ql;var Qn={},Pn={},Hr={};Object.defineProperty(Hr,"__esModule",{value:!0});Hr.ContentList=void 0;const vS=he,yS=Q,CS=zt,SS=B;class wS extends yS.ParsedObject{constructor(e,...n){super();this.dontFlatten=!1,this.TrimTrailingWhitespace=()=>{for(let r=this.content.length-1;r>=0;--r){const i=SS.asOrNull(this.content[r],CS.Text);if(i===null)break;if(i.text=i.text.replace(new RegExp(/[ \t]/g),""),i.text.length===0)this.content.splice(r,1);else break}},this.GenerateRuntimeObject=()=>{const r=new vS.Container;if(this.content!==null)for(const i of this.content){const l=i.runtimeObject;l&&r.AddContent(l)}return this.dontFlatten&&this.story.DontFlattenContainer(r),r},this.toString=()=>`ContentList(${this.content.join(", ")})`,e&&this.AddContent(e),n&&this.AddContent(n)}get runtimeContainer(){return this.runtimeObject}get typeName(){return"ContentList"}}Hr.ContentList=wS;var On={};Object.defineProperty(On,"__esModule",{value:!0});On.VariableReference=void 0;const _S=Ae,ES=Ke;class PS extends _S.InkObject{constructor(e=null){super();this.pathForCount=null,this.name=e}get containerForCount(){return this.pathForCount===null?null:this.ResolvePath(this.pathForCount).container}get pathStringForCount(){return this.pathForCount===null?null:this.CompactPathString(this.pathForCount)}set pathStringForCount(e){e===null?this.pathForCount=null:this.pathForCount=new ES.Path(e)}toString(){if(this.name!=null)return"var("+this.name+")";{let e=this.pathStringForCount;return"read_count("+e+")"}}}On.VariableReference=PS;Object.defineProperty(Pn,"__esModule",{value:!0});Pn.VariableReference=void 0;const OS=Hr,xS=He,Ff=pt,TS=Ht,NS=On,bS=qt,IS=qr,Rf=B;class kS extends xS.Expression{constructor(e){super();this.pathIdentifiers=e,this._runtimeVarRef=null,this.isConstantReference=!1,this.isListItemReference=!1,this.GenerateIntoContainer=n=>{let r=this.story.constants.get(this.name);if(r){r.GenerateConstantIntoContainer(n),this.isConstantReference=!0;return}if(this._runtimeVarRef=new NS.VariableReference(this.name),this.path.length===1||this.path.length===2){let i="",l="";this.path.length===1?i=this.path[0]:(l=this.path[0],i=this.path[1]),this.story.ResolveListItem(l,i,this)&&(this.isListItemReference=!0)}n.AddContent(this._runtimeVarRef)},this.toString=()=>`{${this.path.join(".")}}`}get name(){return this.path.join(".")}get path(){return this.pathIdentifiers.map(e=>e.name).filter(Rf.filterUndef)}get identifier(){if(!this.pathIdentifiers||this.pathIdentifiers.length==0)return null;const e=this.path.join(".");return new IS.Identifier(e)}get runtimeVarRef(){return this._runtimeVarRef}get typeName(){return"ref"}ResolveReferences(e){if(super.ResolveReferences(e),this.isConstantReference||this.isListItemReference)return;const n=new TS.Path(this.pathIdentifiers),r=n.ResolveFromContext(this);if(r){if(!r.containerForCounting)throw new Error;if(r.containerForCounting.visitsShouldBeCounted=!0,this._runtimeVarRef===null)return;this._runtimeVarRef.pathForCount=r.runtimePath,this._runtimeVarRef.name=null;let i=Rf.asOrNull(r,Ff.FlowBase);i&&i.isFunction&&(this.parent instanceof bS.Weave||this.parent instanceof OS.ContentList||this.parent instanceof Ff.FlowBase)&&this.Warning(`'${i.identifier}' being used as read count rather than being called as function. Perhaps you intended to write ${i.identifier}()`);return}if(this.path.length>1){let i=`Could not find target for read count: ${n}`;this.path.length<=2&&(i+=`, or couldn't find list item with the name ${this.path.join(",")}`),this.Error(i);return}e.ResolveVariableWithName(this.name,this).found||this.Error(`Unresolved variable: ${this.name}`,this)}}Pn.VariableReference=kS;Object.defineProperty(Qn,"__esModule",{value:!0});Qn.FunctionCall=void 0;const _t=Fe,AS=Kn,FS=En,RS=He,DS=we,LS=ie,Ol=ft,Df=Mr,VS=Ht,WS=ie,jS=Pn,Xs=B;class _m extends RS.Expression{constructor(e,n){super();this._divertTargetToCount=null,this._variableReferenceToCount=null,this.shouldPopReturnedValue=!1,this.GenerateIntoContainer=r=>{const i=this.story.ResolveList(this.name);let l=!1;if(this.isChoiceCount)this.args.length>0&&this.Error("The CHOICE_COUNT() function shouldn't take any arguments"),r.AddContent(_t.ControlCommand.ChoiceCount());else if(this.isTurns)this.args.length>0&&this.Error("The TURNS() function shouldn't take any arguments"),r.AddContent(_t.ControlCommand.Turns());else if(this.isTurnsSince||this.isReadCount){const s=Xs.asOrNull(this.args[0],FS.DivertTarget),o=Xs.asOrNull(this.args[0],jS.VariableReference);if(this.args.length!==1||s===null&&o===null){this.Error(`The ${this.name}() function should take one argument: a divert target to the target knot, stitch, gather or choice you want to check. e.g. TURNS_SINCE(-> myKnot)`);return}s?(this._divertTargetToCount=s,this.AddContent(this._divertTargetToCount),this._divertTargetToCount.GenerateIntoContainer(r)):o&&(this._variableReferenceToCount=o,this.AddContent(this._variableReferenceToCount),this._variableReferenceToCount.GenerateIntoContainer(r)),this.isTurnsSince?r.AddContent(_t.ControlCommand.TurnsSince()):r.AddContent(_t.ControlCommand.ReadCount())}else if(this.isRandom){this.args.length!==2&&this.Error("RANDOM should take 2 parameters: a minimum and a maximum integer");for(let s=0;s<this.args.length;s+=1){const o=Xs.asOrNull(this.args[s],Df.NumberExpression);if(o&&!o.isInt()){const a=s===0?"minimum":"maximum";this.Error(`RANDOM's ${a} parameter should be an integer`)}this.args[s].GenerateIntoContainer(r)}r.AddContent(_t.ControlCommand.Random())}else if(this.isSeedRandom){this.args.length!==1&&this.Error("SEED_RANDOM should take 1 parameter - an integer seed");const s=Xs.asOrNull(this.args[0],Df.NumberExpression);s&&!s.isInt()&&this.Error("SEED_RANDOM's parameter should be an integer seed"),this.args[0].GenerateIntoContainer(r),r.AddContent(_t.ControlCommand.SeedRandom())}else if(this.isListRange){this.args.length!==3&&this.Error("LIST_RANGE should take 3 parameters - a list, a min and a max");for(let s=0;s<this.args.length;s+=1)this.args[s].GenerateIntoContainer(r);r.AddContent(_t.ControlCommand.ListRange())}else if(this.isListRandom)this.args.length!==1&&this.Error("LIST_RANDOM should take 1 parameter - a list"),this.args[0].GenerateIntoContainer(r),r.AddContent(_t.ControlCommand.ListRandom());else if(Ol.NativeFunctionCall.CallExistsWithName(this.name)){const s=Ol.NativeFunctionCall.CallWithName(this.name);if(s.numberOfParameters!==this.args.length){let o=`${name} should take ${s.numberOfParameters} parameter`;s.numberOfParameters>1&&(o+="s"),this.Error(o)}for(let o=0;o<this.args.length;o+=1)this.args[o].GenerateIntoContainer(r);r.AddContent(Ol.NativeFunctionCall.CallWithName(this.name))}else if(i!==null)if(this.args.length>1&&this.Error("Can currently only construct a list from one integer (or an empty list from a given list definition)"),this.args.length===1)r.AddContent(new WS.StringValue(this.name)),this.args[0].GenerateIntoContainer(r),r.AddContent(_t.ControlCommand.ListFromInt());else{const s=new DS.InkList;s.SetInitialOriginName(this.name),r.AddContent(new LS.ListValue(s))}else r.AddContent(this._proxyDivert.runtimeObject),l=!0;l||this.content.splice(this.content.indexOf(this._proxyDivert),1),this.shouldPopReturnedValue&&r.AddContent(_t.ControlCommand.PopEvaluatedValue())},this.toString=()=>{const r=this.args.join(", ");return`${this.name}(${r})`},this._proxyDivert=new AS.Divert(new VS.Path(e),n),this._proxyDivert.isFunctionCall=!0,this.AddContent(this._proxyDivert)}get proxyDivert(){return this._proxyDivert}get name(){return this._proxyDivert.target.firstComponent||""}get args(){return this._proxyDivert.args}get runtimeDivert(){return this._proxyDivert.runtimeDivert}get isChoiceCount(){return this.name==="CHOICE_COUNT"}get isTurns(){return this.name==="TURNS"}get isTurnsSince(){return this.name==="TURNS_SINCE"}get isRandom(){return this.name==="RANDOM"}get isSeedRandom(){return this.name==="SEED_RANDOM"}get isListRange(){return this.name==="LIST_RANGE"}get isListRandom(){return this.name==="LIST_RANDOM"}get isReadCount(){return this.name==="READ_COUNT"}get typeName(){return"FunctionCall"}ResolveReferences(e){if(super.ResolveReferences(e),!this.content.includes(this._proxyDivert)&&this.args!==null)for(const n of this.args)n.ResolveReferences(e);if(this._divertTargetToCount){const n=this._divertTargetToCount.divert,r=n.runtimeDivert.variableDivertName!=null;if(r){this.Error(`When getting the TURNS_SINCE() of a variable target, remove the '->' - i.e. it should just be TURNS_SINCE(${n.runtimeDivert.variableDivertName})`);return}const i=n.targetContent;if(i===null)r||this.Error(`Failed to find target for TURNS_SINCE: '${n.target}'`);else{if(!i.containerForCounting)throw new Error;i.containerForCounting.turnIndexShouldBeCounted=!0}}else if(this._variableReferenceToCount){const n=this._variableReferenceToCount.runtimeVarRef;if(!n)throw new Error;n.pathForCount!==null&&this.Error(`Should be '${name}'(-> '${this._variableReferenceToCount.name}). Usage without the '->' only makes sense for variable targets.`)}}}Qn.FunctionCall=_m;_m.IsBuiltIn=t=>Ol.NativeFunctionCall.CallExistsWithName(t)?!0:t==="CHOICE_COUNT"||t==="TURNS_SINCE"||t==="TURNS"||t==="RANDOM"||t==="SEED_RANDOM"||t==="LIST_VALUE"||t==="LIST_RANDOM"||t==="READ_COUNT";var Cs={};Object.defineProperty(Cs,"__esModule",{value:!0});Cs.MultipleConditionExpression=void 0;const MS=He,$S=ft;class BS extends MS.Expression{constructor(e){super();this.GenerateIntoContainer=n=>{let r=!0;for(const i of this.subExpressions)i.GenerateIntoContainer(n),r||n.AddContent($S.NativeFunctionCall.CallWithName("&&")),r=!1},this.AddContent(e)}get subExpressions(){return this.content}get typeName(){return"MultipleConditionExpression"}}Cs.MultipleConditionExpression=BS;Object.defineProperty(En,"__esModule",{value:!0});En.DivertTarget=void 0;const GS=ps,US=zn,zS=Br,qS=vs,HS=ie,Ta=He,KS=pt,Lf=Qn,JS=Cs,Vf=Pn,Na=B;class Bi extends Ta.Expression{constructor(e){super();this._runtimeDivert=null,this._runtimeDivertTargetValue=null,this.GenerateIntoContainer=n=>{this.divert.GenerateRuntimeObject(),this._runtimeDivert=this.divert.runtimeDivert,this._runtimeDivertTargetValue=new HS.DivertTargetValue,n.AddContent(this.runtimeDivertTargetValue)},this.Equals=n=>{const r=Na.asOrNull(n,Bi);if(!r||!this.divert.target||!r.divert.target)return!1;const i=this.divert.target.dotSeparatedComponents,l=r.divert.target.dotSeparatedComponents;return i===l},this.divert=this.AddContent(e)}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}get runtimeDivertTargetValue(){if(!this._runtimeDivertTargetValue)throw new Error;return this._runtimeDivertTargetValue}get typeName(){return"DivertTarget"}ResolveReferences(e){if(super.ResolveReferences(e),this.divert.isDone||this.divert.isEnd){this.Error("Can't use -> DONE or -> END as variable divert targets",this);return}let n=this;for(;n&&n instanceof Ta.Expression;){let i=!1,l=!1;const s=n.parent;if(s instanceof GS.BinaryExpression){const o=s;o.opName!=="=="&&o.opName!=="!="?i=!0:(o.leftExpression instanceof Bi||o.leftExpression instanceof Vf.VariableReference)&&(o.rightExpression instanceof Bi||o.rightExpression instanceof Vf.VariableReference)||(i=!0),l=!0}else if(s instanceof Lf.FunctionCall){const o=s;!o.isTurnsSince&&!o.isReadCount&&(i=!0),l=!0}else(s instanceof Ta.Expression||s instanceof JS.MultipleConditionExpression||s instanceof US.Choice&&s.condition===n||s instanceof zS.Conditional||s instanceof qS.ConditionalSingleBranch)&&(i=!0,l=!0);if(i&&this.Error(`Can't use a divert target like that. Did you intend to call '${this.divert.target}' as a function: likeThis(), or check the read count: likeThis, with no arrows?`,this),l)break;n=s}if(this.runtimeDivert.hasVariableTarget){if(!this.divert.target)throw new Error;this.Error(`Since '${this.divert.target.dotSeparatedComponents}' is a variable, it shouldn't be preceded by '->' here.`)}this.runtimeDivert.targetPath&&(this.runtimeDivertTargetValue.targetPath=this.runtimeDivert.targetPath);let r=this.divert.targetContent;if(r!==null){let i=r.containerForCounting;if(i!==null){const s=Na.asOrNull(this.parent,Lf.FunctionCall);s&&s.isTurnsSince||(i.visitsShouldBeCounted=!0),i.turnIndexShouldBeCounted=!0}let l=Na.asOrNull(r,KS.FlowBase);if(l!=null&&l.args!==null)for(const s of l.args)s.isByReference&&this.Error(`Can't store a divert target to a knot or function that has by-reference arguments ('${l.identifier}' has 'ref ${s.identifier}').`)}}}En.DivertTarget=Bi;Object.defineProperty(Kn,"__esModule",{value:!0});Kn.Divert=void 0;const QS=he,fi=Fe,XS=dt,ba=En,Ia=pt,YS=Qn,ZS=Q,Wf=Ht,ew=Ke,jf=qn,tw=ie,Mf=Pn,nw=Jn,di=B;class rw extends ZS.ParsedObject{constructor(e,n){super();this.args=[],this.target=null,this.targetContent=null,this._runtimeDivert=null,this.isFunctionCall=!1,this.isEmpty=!1,this.isTunnel=!1,this.isThread=!1,this.GenerateRuntimeObject=()=>{if(this.isEnd)return fi.ControlCommand.End();if(this.isDone)return fi.ControlCommand.Done();this.runtimeDivert=new XS.Divert,this.ResolveTargetContent(),this.CheckArgumentValidity();const r=this.args!==null&&this.args.length>0;if(r||this.isFunctionCall||this.isTunnel||this.isThread){const i=new QS.Container;if(r){this.isFunctionCall||i.AddContent(fi.ControlCommand.EvalStart());let l=null;this.targetContent&&(l=this.targetContent.args);for(let s=0;s<this.args.length;++s){const o=this.args[s];let a=null;if(l&&s<l.length&&(a=l[s]),a&&a.isByReference){const u=di.asOrNull(o,Mf.VariableReference);if(!u){this.Error(`Expected variable name to pass by reference to 'ref ${a.identifier}' but saw ${o}`);break}const h=new Wf.Path(u.pathIdentifiers);if(h.ResolveFromContext(this)){this.Error(`can't pass a read count by reference. '${h.dotSeparatedComponents}' is a knot/stitch/label, but '${this.target.dotSeparatedComponents}' requires the name of a VAR to be passed.`);break}const c=new tw.VariablePointerValue(u.name);i.AddContent(c)}else o.GenerateIntoContainer(i)}this.isFunctionCall||i.AddContent(fi.ControlCommand.EvalEnd())}return this.isThread?i.AddContent(fi.ControlCommand.StartThread()):(this.isFunctionCall||this.isTunnel)&&(this.runtimeDivert.pushesToStack=!0,this.runtimeDivert.stackPushType=this.isFunctionCall?jf.PushPopType.Function:jf.PushPopType.Tunnel),i.AddContent(this.runtimeDivert),i}return this.runtimeDivert},this.PathAsVariableName=()=>this.target?this.target.firstComponent:null,this.ResolveTargetContent=()=>{if(!(this.isEmpty||this.isEnd)&&this.targetContent===null){let r=this.PathAsVariableName();if(r!==null){const i=di.asOrNull(nw.ClosestFlowBase(this),Ia.FlowBase);if(i){const l=i.ResolveVariableWithName(r,this);if(l.found){if(l.isArgument&&l.ownerFlow&&l.ownerFlow.args){let s=l.ownerFlow.args.find(o=>{var a;return((a=o.identifier)===null||a===void 0?void 0:a.name)==r});s&&!s.isDivertTarget&&this.Error(`Since '${s.identifier}' is used as a variable divert target (on ${this.debugMetadata}), it should be marked as: -> ${s.identifier}`,l.ownerFlow)}this.runtimeDivert.variableDivertName=r;return}}}if(!this.target)throw new Error;this.targetContent=this.target.ResolveFromContext(this)}},this.CheckArgumentValidity=()=>{if(this.isEmpty)return;let r=0;if(this.args!==null&&this.args.length>0&&(r=this.args.length),this.targetContent===null)return;const i=di.asOrNull(this.targetContent,Ia.FlowBase);if(r===0&&(i===null||!i.hasParameters))return;if(i===null&&r>0){this.Error("target needs to be a knot or stitch in order to pass arguments");return}else if(i!==null&&(i.args===null||!i.args&&r>0)){this.Error(`target (${i.name}) doesn't take parameters`);return}else if(this.parent instanceof ba.DivertTarget){r>0&&this.Error("can't store arguments in a divert target variable");return}const l=i.args.length;if(l!==r){let s;r===0?s="but there weren't any passed to it":r<l?s=`but only got ${r}`:s=`but got ${r}`,this.Error(`to '${i.identifier}' requires ${l} arguments, ${s}`);return}for(let s=0;s<l;++s){const o=i.args[s],a=this.args[s];if(o.isDivertTarget){let u=di.asOrNull(a,Mf.VariableReference);if(!(a instanceof ba.DivertTarget)&&u===null)this.Error(`Target '${i.identifier}' expects a divert target for the parameter named -> ${o.identifier} but saw ${a}`,a);else if(u){const h=new Wf.Path(u.pathIdentifiers);h.ResolveFromContext(u)&&this.Error(`Passing read count of '${h.dotSeparatedComponents}' instead of a divert target. You probably meant '${h}'`)}}}if(i===null){this.Error("Can't call as a function or with arguments unless it's a knot or stitch");return}},this.CheckExternalArgumentValidity=r=>{const i=this.target?this.target.firstComponent:null,l=r.externals.get(i);if(!l)throw new Error("external not found");const s=l.argumentNames.length;let o=0;this.args&&(o=this.args.length),o!==s&&this.Error(`incorrect number of arguments sent to external function '${i}'. Expected ${s} but got ${o}`)},this.toString=()=>{let r="";if(this.target!==null)r+=this.target.toString();else return"-> <empty divert>";return this.isTunnel&&(r+=" ->"),this.isFunctionCall&&(r+=" ()"),r},e&&(this.target=e),n&&(this.args=n,this.AddContent(n))}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}set runtimeDivert(e){this._runtimeDivert=e}get isEnd(){return Boolean(this.target&&this.target.dotSeparatedComponents==="END")}get isDone(){return Boolean(this.target&&this.target.dotSeparatedComponents==="DONE")}get typeName(){return"Divert"}ResolveReferences(e){if(this.isEmpty||this.isEnd||this.isDone)return;if(!this.runtimeDivert)throw new Error;this.targetContent&&(this.runtimeDivert.targetPath=this.targetContent.runtimePath),super.ResolveReferences(e);let n=di.asOrNull(this.targetContent,Ia.FlowBase);n&&(!n.isFunction&&this.isFunctionCall?super.Error(`${n.identifier} hasn't been marked as a function, but it's being called as one. Do you need to delcare the knot as '== function ${n.identifier} =='?`):n.isFunction&&!this.isFunctionCall&&!(this.parent instanceof ba.DivertTarget)&&super.Error(n.identifier+" can't be diverted to. It can only be called as a function since it's been marked as such: '"+n.identifier+"(...)'"));const r=this.targetContent!==null;let i=!1,l=!1;if(this.target){if(this.target.numberOfComponents===1){if(!this.target.firstComponent)throw new Error;if(i=YS.FunctionCall.IsBuiltIn(this.target.firstComponent),l=e.IsExternal(this.target.firstComponent),i||l){this.isFunctionCall||super.Error(`${this.target.firstComponent} must be called as a function: ~ ${this.target.firstComponent}()`),l&&(this.runtimeDivert.isExternal=!0,this.args!==null&&(this.runtimeDivert.externalArgs=this.args.length),this.runtimeDivert.pushesToStack=!1,this.runtimeDivert.targetPath=new ew.Path(this.target.firstComponent),this.CheckExternalArgumentValidity(e));return}}}else throw new Error;this.runtimeDivert.variableDivertName==null&&!r&&!i&&!l&&this.Error(`target not found: '${this.target}'`)}Error(e,n=null,r=!1){if(n!==this&&n){super.Error(e,n);return}this.isFunctionCall?super.Error(`Function call ${e}`,n,r):super.Error(`Divert ${e}`,n,r)}}Kn.Divert=rw;var _o={};Object.defineProperty(_o,"__esModule",{value:!0});_o.GatherPointToResolve=void 0;class iw{constructor(e,n){this.divert=e,this.targetRuntimeObj=n}}_o.GatherPointToResolve=iw;var Ss={},Eo={};Object.defineProperty(Eo,"__esModule",{value:!0});Eo.SequenceDivertToResolve=void 0;class sw{constructor(e,n){this.divert=e,this.targetContent=n}}Eo.SequenceDivertToResolve=sw;var Dh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SequenceType=void 0,function(e){e[e.Stopping=1]="Stopping",e[e.Cycle=2]="Cycle",e[e.Shuffle=4]="Shuffle",e[e.Once=8]="Once"}(t.SequenceType||(t.SequenceType={}))})(Dh);Object.defineProperty(Ss,"__esModule",{value:!0});Ss.Sequence=void 0;const $f=he,gt=Fe,ka=dt,pi=ie,Ys=ft,lw=Q,ow=Eo,Zs=Dh,aw=qt;class uw extends lw.ParsedObject{constructor(e,n){super();this.sequenceType=n,this._sequenceDivertsToResolve=[],this.GenerateRuntimeObject=()=>{const r=new $f.Container;r.visitsShouldBeCounted=!0,r.countingAtStartOnly=!0,this._sequenceDivertsToResolve=[],r.AddContent(gt.ControlCommand.EvalStart()),r.AddContent(gt.ControlCommand.VisitIndex());const i=(this.sequenceType&Zs.SequenceType.Once)>0,l=(this.sequenceType&Zs.SequenceType.Cycle)>0,s=(this.sequenceType&Zs.SequenceType.Stopping)>0,o=(this.sequenceType&Zs.SequenceType.Shuffle)>0;let a=this.sequenceElements.length;if(i&&(a+=1),s||i?(r.AddContent(new pi.IntValue(a-1)),r.AddContent(Ys.NativeFunctionCall.CallWithName("MIN"))):l&&(r.AddContent(new pi.IntValue(this.sequenceElements.length)),r.AddContent(Ys.NativeFunctionCall.CallWithName("%"))),o){const h=gt.ControlCommand.NoOp();if(i||s){const c=s?this.sequenceElements.length-1:this.sequenceElements.length;r.AddContent(gt.ControlCommand.Duplicate()),r.AddContent(new pi.IntValue(c)),r.AddContent(Ys.NativeFunctionCall.CallWithName("=="));const g=new ka.Divert;g.isConditional=!0,r.AddContent(g),this.AddDivertToResolve(g,h)}let p=this.sequenceElements.length;s&&(p-=1),r.AddContent(new pi.IntValue(p)),r.AddContent(gt.ControlCommand.SequenceShuffleIndex()),(i||s)&&r.AddContent(h)}r.AddContent(gt.ControlCommand.EvalEnd());const u=gt.ControlCommand.NoOp();for(let h=0;h<a;h+=1){r.AddContent(gt.ControlCommand.EvalStart()),r.AddContent(gt.ControlCommand.Duplicate()),r.AddContent(new pi.IntValue(h)),r.AddContent(Ys.NativeFunctionCall.CallWithName("==")),r.AddContent(gt.ControlCommand.EvalEnd());const p=new ka.Divert;p.isConditional=!0,r.AddContent(p);let c;h<this.sequenceElements.length?c=this.sequenceElements[h].runtimeObject:c=new $f.Container,c.name=`s${h}`,c.InsertContent(gt.ControlCommand.PopEvaluatedValue(),0);const g=new ka.Divert;c.AddContent(g),r.AddToNamedContentOnly(c),this.AddDivertToResolve(p,c),this.AddDivertToResolve(g,u)}return r.AddContent(u),r},this.AddDivertToResolve=(r,i)=>{this._sequenceDivertsToResolve.push(new ow.SequenceDivertToResolve(r,i))},this.sequenceType=n,this.sequenceElements=[];for(const r of e){const i=r.content;let l=null;i===null||i.length===0?l=r:l=new aw.Weave(i),this.sequenceElements.push(l),this.AddContent(l)}}get typeName(){return"Sequence"}ResolveReferences(e){super.ResolveReferences(e);for(const n of this._sequenceDivertsToResolve)n.divert.targetPath=n.targetContent.path}}Ss.Sequence=uw;var ws={};Object.defineProperty(ws,"__esModule",{value:!0});ws.TunnelOnwards=void 0;const hw=he,mi=Fe,cw=dt,fw=ie,dw=Q,pw=Gt,mw=B,gw=On;class vw extends dw.ParsedObject{constructor(){super(...arguments);this._overrideDivertTarget=null,this._divertAfter=null,this.GenerateRuntimeObject=()=>{const e=new hw.Container;if(e.AddContent(mi.ControlCommand.EvalStart()),this.divertAfter){const n=this.divertAfter.GenerateRuntimeObject(),r=n;if(r){const l=this.divertAfter.args;if(l!==null&&l.length>0){let s=-1,o=-1;for(let a=0;a<r.content.length;a+=1){const u=r.content[a];u&&(s==-1&&u.commandType===mi.ControlCommand.CommandType.EvalStart?s=a:u.commandType===mi.ControlCommand.CommandType.EvalEnd&&(o=a))}for(let a=s+1;a<o;a+=1){const u=r.content[a];u.parent=null,e.AddContent(r.content[a])}}}let i=mw.asOrNull(n,cw.Divert);if(i!=null&&i.hasVariableTarget){let l=new gw.VariableReference(i.variableDivertName);e.AddContent(l)}else this._overrideDivertTarget=new fw.DivertTargetValue,e.AddContent(this._overrideDivertTarget)}else e.AddContent(new pw.Void);return e.AddContent(mi.ControlCommand.EvalEnd()),e.AddContent(mi.ControlCommand.PopTunnel()),e},this.toString=()=>` -> ${this._divertAfter}`}get divertAfter(){return this._divertAfter}set divertAfter(e){this._divertAfter=e,this._divertAfter&&this.AddContent(this._divertAfter)}get typeName(){return"TunnelOnwards"}ResolveReferences(e){super.ResolveReferences(e),this.divertAfter&&this.divertAfter.targetContent&&(this._overrideDivertTarget.targetPath=this.divertAfter.targetContent.runtimePath)}}ws.TunnelOnwards=vw;var _s={},Kr={},Es={};Object.defineProperty(Es,"__esModule",{value:!0});Es.ListDefinition=void 0;const Aa=we;class yw{constructor(e,n){this._name=e||"",this._items=null,this._itemNameToValues=n||new Map}get name(){return this._name}get items(){if(this._items==null){this._items=new Map;for(let[e,n]of this._itemNameToValues){let r=new Aa.InkListItem(this.name,e);this._items.set(r.serialized(),n)}}return this._items}ValueForItem(e){if(!e.itemName)return 0;let n=this._itemNameToValues.get(e.itemName);return typeof n!="undefined"?n:0}ContainsItem(e){return!e.itemName||e.originName!=this.name?!1:this._itemNameToValues.has(e.itemName)}ContainsItemWithName(e){return this._itemNameToValues.has(e)}TryGetItemWithValue(e,n){for(let[r,i]of this._itemNameToValues)if(i==e)return n=new Aa.InkListItem(this.name,r),{result:n,exists:!0};return n=Aa.InkListItem.Null,{result:n,exists:!1}}TryGetValueForItem(e,n){if(!e.itemName)return{result:0,exists:!1};let r=this._itemNameToValues.get(e.itemName);return r?{result:r,exists:!0}:{result:0,exists:!1}}}Es.ListDefinition=yw;Object.defineProperty(Kr,"__esModule",{value:!0});Kr.ListDefinition=void 0;const Cw=we,Sw=we,ww=Es,_w=ie,Ew=Q,Pw=Ut;class Ow extends Ew.ParsedObject{constructor(e){super();this.itemDefinitions=e,this.identifier=null,this.variableAssignment=null,this._elementsByName=null,this.ItemNamed=r=>{if(this._elementsByName===null){this._elementsByName=new Map;for(const l of this.itemDefinitions)this._elementsByName.set(l.name,l)}return this._elementsByName.get(r)||null},this.GenerateRuntimeObject=()=>{var r,i;const l=new Cw.InkList;for(const s of this.itemDefinitions)if(s.inInitialList){const o=new Sw.InkListItem(((r=this.identifier)===null||r===void 0?void 0:r.name)||null,s.name||null);l.Add(o,s.seriesValue)}return l.SetInitialOriginName(((i=this.identifier)===null||i===void 0?void 0:i.name)||""),new _w.ListValue(l)};let n=1;for(const r of this.itemDefinitions)r.explicitValue!==null&&(n=r.explicitValue),r.seriesValue=n,n+=1;this.AddContent(e)}get typeName(){return"ListDefinition"}get runtimeListDefinition(){var e;const n=new Map;for(const r of this.itemDefinitions)n.has(r.name)?this.Error(`List '${this.identifier}' contains duplicate items called '${r.name}'`):n.set(r.name,r.seriesValue);return new ww.ListDefinition(((e=this.identifier)===null||e===void 0?void 0:e.name)||"",n)}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.identifier,Pw.SymbolType.List)}}Kr.ListDefinition=Ow;Object.defineProperty(_s,"__esModule",{value:!0});_s.VariableAssignment=void 0;const xw=he,Tw=Jn,Nw=Kr,bw=Q,Bf=Ut,Iw=It,kw=Pn,Aw=B;class Fw extends bw.ParsedObject{constructor({assignedExpression:e,isGlobalDeclaration:n,isTemporaryNewDeclaration:r,listDef:i,variableIdentifier:l}){super();this._runtimeAssignment=null,this.expression=null,this.listDefinition=null,this.GenerateRuntimeObject=()=>{let s=null;if(this.isGlobalDeclaration?s=this.story:this.isNewTemporaryDeclaration&&(s=Tw.ClosestFlowBase(this)),s&&s.AddNewVariableDeclaration(this),this.isGlobalDeclaration)return null;const o=new xw.Container;return this.expression?o.AddContent(this.expression.runtimeObject):this.listDefinition&&o.AddContent(this.listDefinition.runtimeObject),this._runtimeAssignment=new Iw.VariableAssignment(this.variableName,this.isNewTemporaryDeclaration),o.AddContent(this._runtimeAssignment),o},this.toString=()=>`${this.isGlobalDeclaration?"VAR":this.isNewTemporaryDeclaration?"~ temp":""} ${this.variableName}`,this.variableIdentifier=l,this.isGlobalDeclaration=Boolean(n),this.isNewTemporaryDeclaration=Boolean(r),i instanceof Nw.ListDefinition?(this.listDefinition=this.AddContent(i),this.listDefinition.variableAssignment=this,this.isGlobalDeclaration=!0):e&&(this.expression=this.AddContent(e))}get variableName(){return this.variableIdentifier.name}get typeName(){return this.isNewTemporaryDeclaration?"temp":this.isGlobalDeclaration?this.listDefinition!==null?"LIST":"VAR":"variable assignment"}get isDeclaration(){return this.isGlobalDeclaration||this.isNewTemporaryDeclaration}ResolveReferences(e){if(super.ResolveReferences(e),this.isDeclaration&&this.listDefinition===null&&e.CheckForNamingCollisions(this,this.variableIdentifier,this.isGlobalDeclaration?Bf.SymbolType.Var:Bf.SymbolType.Temp),this.isGlobalDeclaration){const n=Aw.asOrNull(this.expression,kw.VariableReference);n&&!n.isConstantReference&&!n.isListItemReference&&this.Error("global variable assignments cannot refer to other variables, only literal values, constants and list items")}if(!this.isNewTemporaryDeclaration){const n=e.ResolveVariableWithName(this.variableName,this);n.found||(this.variableName in this.story.constants?this.Error(`Can't re-assign to a constant (do you need to use VAR when declaring '${this.variableName}'?)`,this):this.Error(`Variable could not be found to assign to: '${this.variableName}'`,this)),this._runtimeAssignment&&(this._runtimeAssignment.isGlobal=n.isGlobal)}}}_s.VariableAssignment=Fw;Object.defineProperty(qt,"__esModule",{value:!0});qt.Weave=void 0;const Gf=jr,rt=zn,el=Br,Rw=Gr,Dw=he,tl=Kn,Lw=dt,Vw=En,Ww=pt,Et=zr,jw=_o,Mw=Q,Fa=Ss,$w=zt,Bw=ws,Gw=_s,it=B;class tn extends Mw.ParsedObject{constructor(e,n=-1){super();this.previousWeavePoint=null,this.addContentToPreviousWeavePoint=!1,this.hasSeenChoiceInSection=!1,this.currentContainer=null,this._unnamedGatherCount=0,this._choiceCount=0,this._rootContainer=null,this._namedWeavePoints=new Map,this.looseEnds=[],this.gatherPointsToResolve=[],this.ResolveWeavePointNaming=()=>{var r,i,l;const s=[...this.FindAll(Et.Gather)(o=>!(o.name===null||o.name===void 0)),...this.FindAll(rt.Choice)(o=>!(o.name===null||o.name===void 0))];this._namedWeavePoints=new Map;for(const o of s){const a=this.namedWeavePoints.get(((r=o.identifier)===null||r===void 0?void 0:r.name)||"");if(a){const u=a instanceof Et.Gather?"gather":"choice",h=a;this.Error(`A ${u} with the same label name '${o.name}' already exists in this context on line ${h.debugMetadata?h.debugMetadata.startLineNumber:"NO DEBUG METADATA AVAILABLE"}`,o)}((i=o.identifier)===null||i===void 0?void 0:i.name)&&this.namedWeavePoints.set((l=o.identifier)===null||l===void 0?void 0:l.name,o)}},this.ConstructWeaveHierarchyFromIndentation=()=>{let r=0;for(;r<this.content.length;){const i=this.content[r];if(i instanceof rt.Choice||i instanceof Et.Gather){const s=i.indentationDepth-1;if(s>this.baseIndentIndex){let o=r;for(;r<this.content.length;){const p=it.asOrNull(this.content[r],rt.Choice)||it.asOrNull(this.content[r],Et.Gather);if(p!==null&&p.indentationDepth-1<=this.baseIndentIndex)break;r+=1}const a=r-o,u=this.content.slice(o,o+a);this.content.splice(o,a);const h=new tn(u,s);this.InsertContent(o,h),r=o}}r+=1}},this.DetermineBaseIndentationFromContent=r=>{for(const i of r)if(i instanceof rt.Choice||i instanceof Et.Gather)return i.indentationDepth-1;return 0},this.GenerateRuntimeObject=()=>{this._rootContainer=new Dw.Container,this.currentContainer=this._rootContainer,this.looseEnds=[],this.gatherPointsToResolve=[];for(const r of this.content)if(r instanceof rt.Choice||r instanceof Et.Gather)this.AddRuntimeForWeavePoint(r);else if(r instanceof tn){const i=r;this.AddRuntimeForNestedWeave(i),this.gatherPointsToResolve.splice(0,0,...i.gatherPointsToResolve)}else this.AddGeneralRuntimeContent(r.runtimeObject);return this.PassLooseEndsToAncestors(),this._rootContainer},this.AddRuntimeForGather=r=>{const i=!this.hasSeenChoiceInSection;this.hasSeenChoiceInSection=!1;const l=r.runtimeContainer;if(r.name||(l.name=`g-${this._unnamedGatherCount}`,this._unnamedGatherCount+=1),i){if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(l)}else this.rootContainer.AddToNamedContentOnly(l);for(const s of this.looseEnds){const o=s;if(o instanceof Et.Gather&&o.indentationDepth==r.indentationDepth)continue;let a=null;if(o instanceof tl.Divert)a=o.runtimeObject;else{a=new Lw.Divert;const u=o;if(!u.runtimeContainer)throw new Error;u.runtimeContainer.AddContent(a)}this.gatherPointsToResolve.push(new jw.GatherPointToResolve(a,l))}this.looseEnds=[],this.currentContainer=l},this.AddRuntimeForWeavePoint=r=>{if(r instanceof Et.Gather)this.AddRuntimeForGather(r);else if(r instanceof rt.Choice){if(!this.currentContainer)throw new Error;this.previousWeavePoint instanceof Et.Gather&&this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1);const i=r;if(this.currentContainer.AddContent(i.runtimeObject),!i.innerContentContainer)throw new Error;i.innerContentContainer.name=`c-${this._choiceCount}`,this.currentContainer.AddToNamedContentOnly(i.innerContentContainer),this._choiceCount+=1,this.hasSeenChoiceInSection=!0}this.addContentToPreviousWeavePoint=!1,this.WeavePointHasLooseEnd(r)&&(this.looseEnds.push(r),it.asOrNull(r,rt.Choice)&&(this.addContentToPreviousWeavePoint=!0)),this.previousWeavePoint=r},this.AddRuntimeForNestedWeave=r=>{this.AddGeneralRuntimeContent(r.rootContainer),this.previousWeavePoint!==null&&(this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1),this.addContentToPreviousWeavePoint=!1)},this.AddGeneralRuntimeContent=r=>{if(r!==null)if(this.addContentToPreviousWeavePoint){if(!this.previousWeavePoint||!this.previousWeavePoint.runtimeContainer)throw new Error;this.previousWeavePoint.runtimeContainer.AddContent(r)}else{if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(r)}},this.PassLooseEndsToAncestors=()=>{if(this.looseEnds.length===0)return;let r=null,i=null,l=!1;for(let s=this.parent;s!==null;s=s.parent){const o=it.asOrNull(s,tn);o&&(!l&&r===null&&(r=o),l&&i===null&&(i=o)),(s instanceof Fa.Sequence||s instanceof el.Conditional)&&(l=!0)}if(!(r===null&&i===null))for(let s=this.looseEnds.length-1;s>=0;s-=1){const o=this.looseEnds[s];let a=!1;if(l){if(o instanceof rt.Choice&&r!==null)r.ReceiveLooseEnd(o),a=!0;else if(!(o instanceof rt.Choice)){const u=r||i;u!==null&&(u.ReceiveLooseEnd(o),a=!0)}}else(r==null?void 0:r.hasOwnProperty("ReceiveLooseEnd"))&&r.ReceiveLooseEnd(o),a=!0;a&&this.looseEnds.splice(s,1)}},this.ReceiveLooseEnd=r=>{this.looseEnds.push(r)},this.WeavePointNamed=r=>{if(!this.namedWeavePoints)return null;let i=this.namedWeavePoints.get(r);return i||null},this.IsGlobalDeclaration=r=>{const i=it.asOrNull(r,Gw.VariableAssignment);return!!(i&&i.isGlobalDeclaration&&i.isDeclaration||it.asOrNull(r,Rw.ConstantDeclaration))},this.ContentThatFollowsWeavePoint=r=>{const i=[],l=r;if(l.content!==null)for(const a of l.content)this.IsGlobalDeclaration(a)||i.push(a);const s=it.asOrNull(l.parent,tn);if(s===null)throw new Error("Expected weave point parent to be weave?");const o=s.content.indexOf(l);for(let a=o+1;a<s.content.length;a+=1){const u=s.content[a];if(!this.IsGlobalDeclaration(u)){if(u instanceof rt.Choice||u instanceof Et.Gather||u instanceof tn)break;i.push(u)}}return i},this.ValidateTermination=r=>{if(this.lastParsedSignificantObject instanceof Gf.AuthorWarning)return;if(this.looseEnds!==null&&this.looseEnds.length>0)for(const l of this.looseEnds){const s=this.ContentThatFollowsWeavePoint(l);this.ValidateFlowOfObjectsTerminates(s,l,r)}else{for(const l of this.content)if(l instanceof rt.Choice||l instanceof tl.Divert)return;this.ValidateFlowOfObjectsTerminates(this.content,this,r)}},this.BadNestedTerminationHandler=r=>{let i=null;for(let s=r.parent;s!==null;s=s.parent)if(s instanceof Fa.Sequence||s instanceof el.Conditional){i=it.asOrNull(s,el.Conditional);break}let l="Choices nested in conditionals or sequences need to explicitly divert afterwards.";i!==null&&i.FindAll(rt.Choice)().length===1&&(l=`Choices with conditions should be written: '* {condition} choice'. Otherwise, ${l.toLowerCase()}`),this.Error(l,r)},this.ValidateFlowOfObjectsTerminates=(r,i,l)=>{let s=!1,o=i;for(const a of r){if(a.Find(tl.Divert)(h=>!h.isThread&&!h.isTunnel&&!h.isFunctionCall&&!(h.parent instanceof Vw.DivertTarget))!==null&&(s=!0),a.Find(Bw.TunnelOnwards)()!=null){s=!0;break}o=a}if(!s){if(o instanceof Gf.AuthorWarning)return;l(o)}},this.WeavePointHasLooseEnd=r=>{if(r.content===null)return!0;for(let i=r.content.length-1;i>=0;--i){let l=it.asOrNull(r.content[i],tl.Divert);if(l&&!(l.isThread||l.isTunnel||l.isFunctionCall))return!1}return!0},this.CheckForWeavePointNamingCollisions=()=>{if(!this.namedWeavePoints)return;const r=[];for(const i of this.ancestry){const l=it.asOrNull(i,Ww.FlowBase);if(l)r.push(l);else break}for(const[i,l]of this.namedWeavePoints)for(const s of r){const o=s.ContentWithNameAtLevel(i);if(o&&o!==l){const a=`${l.GetType()} '${i}' has the same label name as a ${o.GetType()} (on ${o.debugMetadata})`;this.Error(a,l)}}},n==-1?this.baseIndentIndex=this.DetermineBaseIndentationFromContent(e):this.baseIndentIndex=n,this.AddContent(e),this.ConstructWeaveHierarchyFromIndentation()}get rootContainer(){return this._rootContainer||(this._rootContainer=this.GenerateRuntimeObject()),this._rootContainer}get namedWeavePoints(){return this._namedWeavePoints}get lastParsedSignificantObject(){if(this.content.length===0)return null;let e=null;for(let r=this.content.length-1;r>=0;--r){e=this.content[r];let i=it.asOrNull(e,$w.Text);if(!(i&&i.text===`
`)&&!this.IsGlobalDeclaration(e))break}const n=it.asOrNull(e,tn);return n&&(e=n.lastParsedSignificantObject),e}get typeName(){return"Weave"}ResolveReferences(e){if(super.ResolveReferences(e),this.looseEnds!==null&&this.looseEnds.length>0){let n=!1;for(let r=this.parent;r!==null;r=r.parent)if(r instanceof Fa.Sequence||r instanceof el.Conditional){n=!0;break}n&&this.ValidateTermination(this.BadNestedTerminationHandler)}for(const n of this.gatherPointsToResolve)n.divert.targetPath=n.targetRuntimeObj.path;this.CheckForWeavePointNamingCollisions()}}qt.Weave=tn;Object.defineProperty(vs,"__esModule",{value:!0});vs.ConditionalSingleBranch=void 0;const Uf=he,nl=Fe,zf=dt,Uw=Q,zw=ft,qw=ie,Hw=zt,Kw=qt,Jw=B;class Qw extends Uw.ParsedObject{constructor(e){super();this._contentContainer=null,this._conditionalDivert=null,this._ownExpression=null,this._innerWeave=null,this.isTrueBranch=!1,this.matchingEquality=!1,this.isElse=!1,this.isInline=!1,this.returnDivert=null,this.GenerateRuntimeObject=()=>{if(this._innerWeave)for(const i of this._innerWeave.content){const l=Jw.asOrNull(i,Hw.Text);l&&l.text.startsWith("else:")&&this.Warning("Saw the text 'else:' which is being treated as content. Did you mean '- else:'?",l)}const n=new Uf.Container,r=this.matchingEquality&&!this.isElse;if(r&&n.AddContent(nl.ControlCommand.Duplicate()),this._conditionalDivert=new zf.Divert,this._conditionalDivert.isConditional=!this.isElse,!this.isTrueBranch&&!this.isElse){const i=this.ownExpression!==null;i&&n.AddContent(nl.ControlCommand.EvalStart()),this.ownExpression&&this.ownExpression.GenerateIntoContainer(n),this.matchingEquality&&n.AddContent(zw.NativeFunctionCall.CallWithName("==")),i&&n.AddContent(nl.ControlCommand.EvalEnd())}return n.AddContent(this._conditionalDivert),this._contentContainer=this.GenerateRuntimeForContent(),this._contentContainer.name="b",this.isInline||this._contentContainer.InsertContent(new qw.StringValue(`
`),0),(r||this.isElse&&this.matchingEquality)&&this._contentContainer.InsertContent(nl.ControlCommand.PopEvaluatedValue(),0),n.AddToNamedContentOnly(this._contentContainer),this.returnDivert=new zf.Divert,this._contentContainer.AddContent(this.returnDivert),n},this.GenerateRuntimeForContent=()=>this._innerWeave===null?new Uf.Container:this._innerWeave.rootContainer,e&&(this._innerWeave=new Kw.Weave(e),this.AddContent(this._innerWeave))}get ownExpression(){return this._ownExpression}set ownExpression(e){this._ownExpression=e,this._ownExpression&&this.AddContent(this._ownExpression)}get typeName(){return"ConditionalSingleBranch"}ResolveReferences(e){if(!this._conditionalDivert||!this._contentContainer)throw new Error;this._conditionalDivert.targetPath=this._contentContainer.path,super.ResolveReferences(e)}}vs.ConditionalSingleBranch=Qw;var Em={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFlags=void 0,function(e){e[e.ParsingString=1]="ParsingString",e[e.TagActive=2]="TagActive"}(t.CustomFlags||(t.CustomFlags={}))})(Em);var Po={};Object.defineProperty(Po,"__esModule",{value:!0});Po.DebugMetadata=void 0;class Lh{constructor(){this.startLineNumber=0,this.endLineNumber=0,this.startCharacterNumber=0,this.endCharacterNumber=0,this.fileName=null,this.sourceName=null}Merge(e){let n=new Lh;return n.fileName=this.fileName,n.sourceName=this.sourceName,this.startLineNumber<e.startLineNumber?(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=this.startCharacterNumber):this.startLineNumber>e.startLineNumber?(n.startLineNumber=e.startLineNumber,n.startCharacterNumber=e.startCharacterNumber):(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=Math.min(this.startCharacterNumber,e.startCharacterNumber)),this.endLineNumber>e.endLineNumber?(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=this.endCharacterNumber):this.endLineNumber<e.endLineNumber?(n.endLineNumber=e.endLineNumber,n.endCharacterNumber=e.endCharacterNumber):(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=Math.max(this.endCharacterNumber,e.endCharacterNumber)),n}toString(){return this.fileName!==null?`line ${this.startLineNumber} of ${this.fileName}"`:"line "+this.startLineNumber}}Po.DebugMetadata=Lh;var Oo={};Object.defineProperty(Oo,"__esModule",{value:!0});Oo.ExternalDeclaration=void 0;const Xw=Q;class Yw extends Xw.ParsedObject{constructor(e,n){super();this.identifier=e,this.argumentNames=n,this.GenerateRuntimeObject=()=>(this.story.AddExternal(this),null)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get typeName(){return"EXTERNAL"}toString(){var e;return`EXTERNAL ${(e=this.identifier)===null||e===void 0?void 0:e.name}`}}Oo.ExternalDeclaration=Yw;var xo={};Object.defineProperty(xo,"__esModule",{value:!0});xo.FlowDecl=void 0;class Zw{constructor(e,n,r){this.name=e,this.args=n,this.isFunction=r}}xo.FlowDecl=Zw;var To={},Ps={};Object.defineProperty(Ps,"__esModule",{value:!0});Ps.Wrap=void 0;const e_=Q;class t_ extends e_.ParsedObject{constructor(e){super();this._objToWrap=e,this.GenerateRuntimeObject=()=>this._objToWrap}}Ps.Wrap=t_;Object.defineProperty(To,"__esModule",{value:!0});To.Glue=void 0;const n_=Ps;class r_ extends n_.Wrap{constructor(e){super(e)}get typeName(){return"Glue"}}To.Glue=r_;var Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.Glue=void 0;const i_=Ae;class s_ extends i_.InkObject{toString(){return"Glue"}}Jr.Glue=s_;var No={};Object.defineProperty(No,"__esModule",{value:!0});No.IncDecExpression=void 0;const l_=Hr,qf=He,o_=pt,a_=ft,u_=ie,h_=It,c_=On,f_=qt;class d_ extends qf.Expression{constructor(e,n,r){super();this.varIdentifier=e,this._runtimeAssignment=null,this.expression=null,this.GenerateIntoContainer=i=>{var l,s;i.AddContent(new c_.VariableReference(((l=this.varIdentifier)===null||l===void 0?void 0:l.name)||null)),this.expression?this.expression.GenerateIntoContainer(i):i.AddContent(new u_.IntValue(1)),i.AddContent(a_.NativeFunctionCall.CallWithName(this.isInc?"+":"-")),this._runtimeAssignment=new h_.VariableAssignment(((s=this.varIdentifier)===null||s===void 0?void 0:s.name)||null,!1),i.AddContent(this._runtimeAssignment)},this.toString=()=>{var i,l;return this.expression?`${(i=this.varIdentifier)===null||i===void 0?void 0:i.name}${this.isInc?" += ":" -= "}${this.expression}`:`${(l=this.varIdentifier)===null||l===void 0?void 0:l.name}`+(this.isInc?"++":"--")},n instanceof qf.Expression?(this.expression=n,this.AddContent(this.expression),this.isInc=Boolean(r)):this.isInc=n}get typeName(){return"IncDecExpression"}ResolveReferences(e){var n;super.ResolveReferences(e);const r=e.ResolveVariableWithName(((n=this.varIdentifier)===null||n===void 0?void 0:n.name)||"",this);if(r.found||this.Error(`variable for ${this.incrementDecrementWord} could not be found: '${this.varIdentifier}' after searching: {this.descriptionOfScope}`),!this._runtimeAssignment)throw new Error;this._runtimeAssignment.isGlobal=r.isGlobal,!(this.parent instanceof f_.Weave)&&!(this.parent instanceof o_.FlowBase)&&!(this.parent instanceof l_.ContentList)&&this.Error(`Can't use ${this.incrementDecrementWord} as sub-expression`)}get incrementDecrementWord(){return this.isInc?"increment":"decrement"}}No.IncDecExpression=d_;var Os={};Object.defineProperty(Os,"__esModule",{value:!0});Os.IncludedFile=void 0;const p_=Q;class m_ extends p_.ParsedObject{constructor(e){super();this.includedStory=e,this.GenerateRuntimeObject=()=>null}}Os.IncludedFile=m_;var bo={};Object.defineProperty(bo,"__esModule",{value:!0});bo.InfixOperator=void 0;class g_{constructor(e,n,r){this.type=e,this.precedence=n,this.requireWhitespace=r,this.toString=()=>this.type}}bo.InfixOperator=g_;var Io={};Object.defineProperty(Io,"__esModule",{value:!0});Io.Knot=void 0;const v_=pt,Hf=Ur;class y_ extends v_.FlowBase{get flowLevel(){return Hf.FlowLevel.Knot}constructor(e,n,r,i){super(e,n,r,i)}get typeName(){return this.isFunction?"Function":"Knot"}ResolveReferences(e){super.ResolveReferences(e);let n=this.story;for(const r in this.subFlowsByName){const i=n.ContentWithNameAtLevel(r,Hf.FlowLevel.Knot,!1);if(i){const l=this.subFlowsByName.get(r),s=`Stitch '${l?l.name:"NO STITCH FOUND"}' has the same name as a knot (on ${i.debugMetadata})`;this.Error(s,l)}}}}Io.Knot=y_;var ko={};Object.defineProperty(ko,"__esModule",{value:!0});ko.List=void 0;const C_=He,S_=we,w_=we,__=ie;class E_ extends C_.Expression{constructor(e){super();this.itemIdentifierList=e,this.GenerateIntoContainer=n=>{var r,i;const l=new S_.InkList;if(this.itemIdentifierList!=null)for(const s of this.itemIdentifierList){const o=((r=s==null?void 0:s.name)===null||r===void 0?void 0:r.split("."))||[];let a=null,u="";o.length>1?(a=o[0],u=o[1]):u=o[0];const h=this.story.ResolveListItem(a,u,this);if(h===null)a===null?this.Error(`Could not find list definition that contains item '${s}'`):this.Error(`Could not find list item ${s}`);else{if(h.parent==null){this.Error(`Could not find list definition for item ${s}`);return}a||(a=((i=h.parent.identifier)===null||i===void 0?void 0:i.name)||null);const p=new w_.InkListItem(a,h.name||null);l.has(p.serialized())?this.Warning(`Duplicate of item '${s}' in list.`):l.Add(p,h.seriesValue)}}n.AddContent(new __.ListValue(l))}}get typeName(){return"List"}}ko.List=E_;var xs={};Object.defineProperty(xs,"__esModule",{value:!0});xs.ListElementDefinition=void 0;const P_=Q,O_=Ut;class x_ extends P_.ParsedObject{constructor(e,n,r=null){super();this.indentifier=e,this.inInitialList=n,this.explicitValue=r,this.seriesValue=0,this.parent=null,this.GenerateRuntimeObject=()=>{throw new Error("Not implemented.")},this.toString=()=>this.fullName,this.parent=super.parent}get fullName(){var e;const n=this.parent;if(n===null)throw new Error("Can't get full name without a parent list.");return`${(e=n.identifier)===null||e===void 0?void 0:e.name}.${this.name}`}get typeName(){return"ListElement"}get name(){var e;return((e=this.indentifier)===null||e===void 0?void 0:e.name)||null}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.indentifier,O_.SymbolType.ListItem)}}xs.ListElementDefinition=x_;var Pm={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StatementLevel=void 0,function(e){e[e.InnerBlock=0]="InnerBlock",e[e.Stitch=1]="Stitch",e[e.Knot=2]="Knot",e[e.Top=3]="Top"}(t.StatementLevel||(t.StatementLevel={}))})(Pm);var Ao={};Object.defineProperty(Ao,"__esModule",{value:!0});Ao.Stitch=void 0;const T_=pt,N_=Ur;class b_ extends T_.FlowBase{constructor(e,n,r,i){super(e,n,r,i);this.toString=()=>`${this.parent!==null?this.parent+" > ":""}${super.toString()}`}get flowLevel(){return N_.FlowLevel.Stitch}get typeName(){return"Stitch"}}Ao.Stitch=b_;var Fo={},Ts={},xn={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.Tag=void 0;const I_=Ae;class k_ extends I_.InkObject{constructor(e){super();this.text=e.toString()||""}toString(){return"# "+this.text}}Qr.Tag=k_;var Ns={};Object.defineProperty(Ns,"__esModule",{value:!0});Ns.Choice=void 0;const A_=Ke,F_=ue,R_=Ae;class D_ extends R_.InkObject{constructor(){super(...arguments);this.text="",this.index=0,this.threadAtGeneration=null,this.sourcePath="",this.targetPath=null,this.isInvisibleDefault=!1,this.tags=null,this.originalThreadIndex=0}get pathStringOnChoice(){return this.targetPath===null?F_.throwNullException("Choice.targetPath"):this.targetPath.toString()}set pathStringOnChoice(e){this.targetPath=new A_.Path(e)}}Ns.Choice=D_;var bs={};Object.defineProperty(bs,"__esModule",{value:!0});bs.ListDefinitionsOrigin=void 0;const L_=we,V_=ie,W_=ue;class j_{constructor(e){this._lists=new Map,this._allUnambiguousListValueCache=new Map;for(let n of e){this._lists.set(n.name,n);for(let[r,i]of n.items){let l=L_.InkListItem.fromSerializedKey(r),s=new V_.ListValue(l,i);if(!l.itemName)throw new Error("item.itemName is null or undefined.");this._allUnambiguousListValueCache.set(l.itemName,s),this._allUnambiguousListValueCache.set(l.fullName,s)}}}get lists(){let e=[];for(let[,n]of this._lists)e.push(n);return e}TryListGetDefinition(e,n){if(e===null)return{result:n,exists:!1};let r=this._lists.get(e);return r?{result:r,exists:!0}:{result:n,exists:!1}}FindSingleItemListWithName(e){if(e===null)return W_.throwNullException("name");let n=this._allUnambiguousListValueCache.get(e);return typeof n!="undefined"?n:null}}bs.ListDefinitionsOrigin=j_;Object.defineProperty(xn,"__esModule",{value:!0});xn.JsonSerialisation=void 0;const rl=he,Ye=ie,Kf=Jr,H=Fe,rr=qn,Jf=dt,Qf=$r,Ra=On,Xf=It,Da=ft,Yf=Gt,Zf=Qr,M_=Ke,ed=Ns,$_=Es,B_=bs,il=we,ae=B,Tn=ue;class xr{static JArrayToRuntimeObjList(e,n=!1){let r=e.length;n&&r--;let i=[];for(let l=0;l<r;l++){let s=e[l],o=this.JTokenToRuntimeObject(s);if(o===null)return Tn.throwNullException("runtimeObj");i.push(o)}return i}static WriteDictionaryRuntimeObjs(e,n){e.WriteObjectStart();for(let[r,i]of n)e.WritePropertyStart(r),this.WriteRuntimeObject(e,i),e.WritePropertyEnd();e.WriteObjectEnd()}static WriteListRuntimeObjs(e,n){e.WriteArrayStart();for(let r of n)this.WriteRuntimeObject(e,r);e.WriteArrayEnd()}static WriteIntDictionary(e,n){e.WriteObjectStart();for(let[r,i]of n)e.WriteIntProperty(r,i);e.WriteObjectEnd()}static WriteRuntimeObject(e,n){let r=ae.asOrNull(n,rl.Container);if(r){this.WriteRuntimeContainer(e,r);return}let i=ae.asOrNull(n,Jf.Divert);if(i){let b="->";i.isExternal?b="x()":i.pushesToStack&&(i.stackPushType==rr.PushPopType.Function?b="f()":i.stackPushType==rr.PushPopType.Tunnel&&(b="->t->"));let N;i.hasVariableTarget?N=i.variableDivertName:N=i.targetPathString,e.WriteObjectStart(),e.WriteProperty(b,N),i.hasVariableTarget&&e.WriteProperty("var",!0),i.isConditional&&e.WriteProperty("c",!0),i.externalArgs>0&&e.WriteIntProperty("exArgs",i.externalArgs),e.WriteObjectEnd();return}let l=ae.asOrNull(n,Qf.ChoicePoint);if(l){e.WriteObjectStart(),e.WriteProperty("*",l.pathStringOnChoice),e.WriteIntProperty("flg",l.flags),e.WriteObjectEnd();return}let s=ae.asOrNull(n,Ye.BoolValue);if(s){e.WriteBool(s.value);return}let o=ae.asOrNull(n,Ye.IntValue);if(o){e.WriteInt(o.value);return}let a=ae.asOrNull(n,Ye.FloatValue);if(a){e.WriteFloat(a.value);return}let u=ae.asOrNull(n,Ye.StringValue);if(u){u.isNewline?e.Write(`
`,!1):(e.WriteStringStart(),e.WriteStringInner("^"),e.WriteStringInner(u.value),e.WriteStringEnd());return}let h=ae.asOrNull(n,Ye.ListValue);if(h){this.WriteInkList(e,h);return}let p=ae.asOrNull(n,Ye.DivertTargetValue);if(p){if(e.WriteObjectStart(),p.value===null)return Tn.throwNullException("divTargetVal.value");e.WriteProperty("^->",p.value.componentsString),e.WriteObjectEnd();return}let c=ae.asOrNull(n,Ye.VariablePointerValue);if(c){e.WriteObjectStart(),e.WriteProperty("^var",c.value),e.WriteIntProperty("ci",c.contextIndex),e.WriteObjectEnd();return}if(ae.asOrNull(n,Kf.Glue)){e.Write("<>");return}let S=ae.asOrNull(n,H.ControlCommand);if(S){e.Write(xr._controlCommandNames[S.commandType]);return}let E=ae.asOrNull(n,Da.NativeFunctionCall);if(E){let b=E.name;b=="^"&&(b="L^"),e.Write(b);return}let d=ae.asOrNull(n,Ra.VariableReference);if(d){e.WriteObjectStart();let b=d.pathStringForCount;b!=null?e.WriteProperty("CNT?",b):e.WriteProperty("VAR?",d.name),e.WriteObjectEnd();return}let f=ae.asOrNull(n,Xf.VariableAssignment);if(f){e.WriteObjectStart();let b=f.isGlobal?"VAR=":"temp=";e.WriteProperty(b,f.variableName),f.isNewDeclaration||e.WriteProperty("re",!0),e.WriteObjectEnd();return}if(ae.asOrNull(n,Yf.Void)){e.Write("void");return}let y=ae.asOrNull(n,Zf.Tag);if(y){e.WriteObjectStart(),e.WriteProperty("#",y.text),e.WriteObjectEnd();return}let w=ae.asOrNull(n,ed.Choice);if(w){this.WriteChoice(e,w);return}throw new Error("Failed to convert runtime object to Json token: "+n)}static JObjectToDictionaryRuntimeObjs(e){let n=new Map;for(let r in e)if(e.hasOwnProperty(r)){let i=this.JTokenToRuntimeObject(e[r]);if(i===null)return Tn.throwNullException("inkObject");n.set(r,i)}return n}static JObjectToIntDictionary(e){let n=new Map;for(let r in e)e.hasOwnProperty(r)&&n.set(r,parseInt(e[r]));return n}static JTokenToRuntimeObject(e){if(typeof e=="number"&&!isNaN(e)||typeof e=="boolean")return Ye.Value.Create(e);if(typeof e=="string"){let n=e.toString(),r=n[0];if(r=="^")return new Ye.StringValue(n.substring(1));if(r==`
`&&n.length==1)return new Ye.StringValue(`
`);if(n=="<>")return new Kf.Glue;for(let i=0;i<xr._controlCommandNames.length;++i){let l=xr._controlCommandNames[i];if(n==l)return new H.ControlCommand(i)}if(n=="L^"&&(n="^"),Da.NativeFunctionCall.CallExistsWithName(n))return Da.NativeFunctionCall.CallWithName(n);if(n=="->->")return H.ControlCommand.PopTunnel();if(n=="~ret")return H.ControlCommand.PopFunction();if(n=="void")return new Yf.Void}if(typeof e=="object"&&!Array.isArray(e)){let n=e,r;if(n["^->"])return r=n["^->"],new Ye.DivertTargetValue(new M_.Path(r.toString()));if(n["^var"]){r=n["^var"];let h=new Ye.VariablePointerValue(r.toString());return"ci"in n&&(r=n.ci,h.contextIndex=parseInt(r)),h}let i=!1,l=!1,s=rr.PushPopType.Function,o=!1;if((r=n["->"])?i=!0:(r=n["f()"])?(i=!0,l=!0,s=rr.PushPopType.Function):(r=n["->t->"])?(i=!0,l=!0,s=rr.PushPopType.Tunnel):(r=n["x()"])&&(i=!0,o=!0,l=!1,s=rr.PushPopType.Function),i){let h=new Jf.Divert;h.pushesToStack=l,h.stackPushType=s,h.isExternal=o;let p=r.toString();return(r=n.var)?h.variableDivertName=p:h.targetPathString=p,h.isConditional=!!n.c,o&&(r=n.exArgs)&&(h.externalArgs=parseInt(r)),h}if(r=n["*"]){let h=new Qf.ChoicePoint;return h.pathStringOnChoice=r.toString(),(r=n.flg)&&(h.flags=parseInt(r)),h}if(r=n["VAR?"])return new Ra.VariableReference(r.toString());if(r=n["CNT?"]){let h=new Ra.VariableReference;return h.pathStringForCount=r.toString(),h}let a=!1,u=!1;if((r=n["VAR="])?(a=!0,u=!0):(r=n["temp="])&&(a=!0,u=!1),a){let h=r.toString(),p=!n.re,c=new Xf.VariableAssignment(h,p);return c.isGlobal=u,c}if(n["#"]!==void 0)return r=n["#"],new Zf.Tag(r.toString());if(r=n.list){let h=r,p=new il.InkList;if(r=n.origins){let c=r;p.SetInitialOriginNames(c)}for(let c in h)if(h.hasOwnProperty(c)){let g=h[c],S=new il.InkListItem(c),E=parseInt(g);p.Add(S,E)}return new Ye.ListValue(p)}if(n.originalChoicePath!=null)return this.JObjectToChoice(n)}if(Array.isArray(e))return this.JArrayToContainer(e);if(e==null)return null;throw new Error("Failed to convert token to runtime object: "+this.toJson(e,["parent"]))}static toJson(e,n,r){return JSON.stringify(e,(i,l)=>(n==null?void 0:n.some(s=>s===i))?void 0:l,r)}static WriteRuntimeContainer(e,n,r=!1){if(e.WriteArrayStart(),n===null)return Tn.throwNullException("container");for(let a of n.content)this.WriteRuntimeObject(e,a);let i=n.namedOnlyContent,l=n.countFlags,s=n.name!=null&&!r,o=i!=null||l>0||s;if(o&&e.WriteObjectStart(),i!=null)for(let[a,u]of i){let h=a,p=ae.asOrNull(u,rl.Container);e.WritePropertyStart(h),this.WriteRuntimeContainer(e,p,!0),e.WritePropertyEnd()}l>0&&e.WriteIntProperty("#f",l),s&&e.WriteProperty("#n",n.name),o?e.WriteObjectEnd():e.WriteNull(),e.WriteArrayEnd()}static JArrayToContainer(e){let n=new rl.Container;n.content=this.JArrayToRuntimeObjList(e,!0);let r=e[e.length-1];if(r!=null){let i=new Map;for(let l in r)if(l=="#f")n.countFlags=parseInt(r[l]);else if(l=="#n")n.name=r[l].toString();else{let s=this.JTokenToRuntimeObject(r[l]),o=ae.asOrNull(s,rl.Container);o&&(o.name=l),i.set(l,s)}n.namedOnlyContent=i}return n}static JObjectToChoice(e){let n=new ed.Choice;return n.text=e.text.toString(),n.index=parseInt(e.index),n.sourcePath=e.originalChoicePath.toString(),n.originalThreadIndex=parseInt(e.originalThreadIndex),n.pathStringOnChoice=e.targetPath.toString(),n}static WriteChoice(e,n){e.WriteObjectStart(),e.WriteProperty("text",n.text),e.WriteIntProperty("index",n.index),e.WriteProperty("originalChoicePath",n.sourcePath),e.WriteIntProperty("originalThreadIndex",n.originalThreadIndex),e.WriteProperty("targetPath",n.pathStringOnChoice),e.WriteObjectEnd()}static WriteInkList(e,n){let r=n.value;if(r===null)return Tn.throwNullException("rawList");e.WriteObjectStart(),e.WritePropertyStart("list"),e.WriteObjectStart();for(let[i,l]of r){let s=il.InkListItem.fromSerializedKey(i),o=l;if(s.itemName===null)return Tn.throwNullException("item.itemName");e.WritePropertyNameStart(),e.WritePropertyNameInner(s.originName?s.originName:"?"),e.WritePropertyNameInner("."),e.WritePropertyNameInner(s.itemName),e.WritePropertyNameEnd(),e.Write(o),e.WritePropertyEnd()}if(e.WriteObjectEnd(),e.WritePropertyEnd(),r.Count==0&&r.originNames!=null&&r.originNames.length>0){e.WritePropertyStart("origins"),e.WriteArrayStart();for(let i of r.originNames)e.Write(i);e.WriteArrayEnd(),e.WritePropertyEnd()}e.WriteObjectEnd()}static ListDefinitionsToJToken(e){let n={};for(let r of e.lists){let i={};for(let[l,s]of r.items){let o=il.InkListItem.fromSerializedKey(l);if(o.itemName===null)return Tn.throwNullException("item.itemName");i[o.itemName]=s}n[r.name]=i}return n}static JTokenToListDefinitions(e){let n=e,r=[];for(let i in n)if(n.hasOwnProperty(i)){let l=i.toString(),s=n[i],o=new Map;for(let u in s)if(n.hasOwnProperty(i)){let h=s[u];o.set(u,parseInt(h))}let a=new $_.ListDefinition(l,o);r.push(a)}return new B_.ListDefinitionsOrigin(r)}}xn.JsonSerialisation=xr;xr._controlCommandNames=(()=>{let t=[];t[H.ControlCommand.CommandType.EvalStart]="ev",t[H.ControlCommand.CommandType.EvalOutput]="out",t[H.ControlCommand.CommandType.EvalEnd]="/ev",t[H.ControlCommand.CommandType.Duplicate]="du",t[H.ControlCommand.CommandType.PopEvaluatedValue]="pop",t[H.ControlCommand.CommandType.PopFunction]="~ret",t[H.ControlCommand.CommandType.PopTunnel]="->->",t[H.ControlCommand.CommandType.BeginString]="str",t[H.ControlCommand.CommandType.EndString]="/str",t[H.ControlCommand.CommandType.NoOp]="nop",t[H.ControlCommand.CommandType.ChoiceCount]="choiceCnt",t[H.ControlCommand.CommandType.Turns]="turn",t[H.ControlCommand.CommandType.TurnsSince]="turns",t[H.ControlCommand.CommandType.ReadCount]="readc",t[H.ControlCommand.CommandType.Random]="rnd",t[H.ControlCommand.CommandType.SeedRandom]="srnd",t[H.ControlCommand.CommandType.VisitIndex]="visit",t[H.ControlCommand.CommandType.SequenceShuffleIndex]="seq",t[H.ControlCommand.CommandType.StartThread]="thread",t[H.ControlCommand.CommandType.Done]="done",t[H.ControlCommand.CommandType.End]="end",t[H.ControlCommand.CommandType.ListFromInt]="listInt",t[H.ControlCommand.CommandType.ListRange]="range",t[H.ControlCommand.CommandType.ListRandom]="lrnd",t[H.ControlCommand.CommandType.BeginTag]="#",t[H.ControlCommand.CommandType.EndTag]="/#";for(let e=0;e<H.ControlCommand.CommandType.TOTAL_VALUES;++e)if(t[e]==null)throw new Error("Control command not accounted for in serialisation");return t})();var Ro={},Vh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CallStack=void 0;const e=qn,n=Ke,r=Ts,i=xn,l=ie,s=Bt,o=Hn,a=ms,u=at,h=ue;class p{constructor(){if(this._threadCounter=0,this._startOfRoot=o.Pointer.Null,arguments[0]instanceof r.Story){let g=arguments[0];this._startOfRoot=o.Pointer.StartOf(g.rootContentContainer),this.Reset()}else{let g=arguments[0];this._threads=[];for(let S of g._threads)this._threads.push(S.Copy());this._threadCounter=g._threadCounter,this._startOfRoot=g._startOfRoot.copy()}}get elements(){return this.callStack}get depth(){return this.elements.length}get currentElement(){let S=this._threads[this._threads.length-1].callstack;return S[S.length-1]}get currentElementIndex(){return this.callStack.length-1}get currentThread(){return this._threads[this._threads.length-1]}set currentThread(g){a.Debug.Assert(this._threads.length==1,"Shouldn't be directly setting the current thread when we have a stack of them"),this._threads.length=0,this._threads.push(g)}get canPop(){return this.callStack.length>1}Reset(){this._threads=[],this._threads.push(new p.Thread),this._threads[0].callstack.push(new p.Element(e.PushPopType.Tunnel,this._startOfRoot))}SetJsonToken(g,S){this._threads.length=0;let E=g.threads;for(let d of E){let f=d,v=new p.Thread(f,S);this._threads.push(v)}this._threadCounter=parseInt(g.threadCounter),this._startOfRoot=o.Pointer.StartOf(S.rootContentContainer)}WriteJson(g){g.WriteObject(S=>{S.WritePropertyStart("threads"),S.WriteArrayStart();for(let E of this._threads)E.WriteJson(S);S.WriteArrayEnd(),S.WritePropertyEnd(),S.WritePropertyStart("threadCounter"),S.WriteInt(this._threadCounter),S.WritePropertyEnd()})}PushThread(){let g=this.currentThread.Copy();this._threadCounter++,g.threadIndex=this._threadCounter,this._threads.push(g)}ForkThread(){let g=this.currentThread.Copy();return this._threadCounter++,g.threadIndex=this._threadCounter,g}PopThread(){if(this.canPopThread)this._threads.splice(this._threads.indexOf(this.currentThread),1);else throw new Error("Can't pop thread")}get canPopThread(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}get elementIsEvaluateFromGame(){return this.currentElement.type==e.PushPopType.FunctionEvaluationFromGame}Push(g,S=0,E=0){let d=new p.Element(g,this.currentElement.currentPointer,!1);d.evaluationStackHeightWhenPushed=S,d.functionStartInOutputStream=E,this.callStack.push(d)}CanPop(g=null){return this.canPop?g==null?!0:this.currentElement.type==g:!1}Pop(g=null){if(this.CanPop(g)){this.callStack.pop();return}else throw new Error("Mismatched push/pop in Callstack")}GetTemporaryVariableWithName(g,S=-1){S==-1&&(S=this.currentElementIndex+1);let E=this.callStack[S-1],d=u.tryGetValueFromMap(E.temporaryVariables,g,null);return d.exists?d.result:null}SetTemporaryVariable(g,S,E,d=-1){d==-1&&(d=this.currentElementIndex+1);let f=this.callStack[d-1];if(!E&&!f.temporaryVariables.get(g))throw new Error("Could not find temporary variable to set: "+g);let v=u.tryGetValueFromMap(f.temporaryVariables,g,null);v.exists&&l.ListValue.RetainListOriginsForAssignment(v.result,S),f.temporaryVariables.set(g,S)}ContextForVariableNamed(g){return this.currentElement.temporaryVariables.get(g)?this.currentElementIndex+1:0}ThreadWithIndex(g){let S=this._threads.filter(E=>{if(E.threadIndex==g)return E});return S.length>0?S[0]:null}get callStack(){return this.currentThread.callstack}get callStackTrace(){let g=new s.StringBuilder;for(let S=0;S<this._threads.length;S++){let E=this._threads[S],d=S==this._threads.length-1;g.AppendFormat(`=== THREAD {0}/{1} {2}===
`,S+1,this._threads.length,d?"(current) ":"");for(let f=0;f<E.callstack.length;f++){E.callstack[f].type==e.PushPopType.Function?g.Append("  [FUNCTION] "):g.Append("  [TUNNEL] ");let v=E.callstack[f].currentPointer;if(!v.isNull){if(g.Append("<SOMEWHERE IN "),v.container===null)return h.throwNullException("pointer.container");g.Append(v.container.path.toString()),g.AppendLine(">")}}}return g.toString()}}t.CallStack=p,function(c){class g{constructor(d,f,v=!1){this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=f.copy(),this.inExpressionEvaluation=v,this.temporaryVariables=new Map,this.type=d}Copy(){let d=new g(this.type,this.currentPointer,this.inExpressionEvaluation);return d.temporaryVariables=new Map(this.temporaryVariables),d.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,d.functionStartInOutputStream=this.functionStartInOutputStream,d}}c.Element=g;class S{constructor(){if(this.threadIndex=0,this.previousPointer=o.Pointer.Null,this.callstack=[],arguments[0]&&arguments[1]){let d=arguments[0],f=arguments[1];this.threadIndex=parseInt(d.threadIndex);let v=d.callstack;for(let w of v){let b=w,N=parseInt(b.type),D=o.Pointer.Null,I,T=b.cPath;if(typeof T!="undefined"){I=T.toString();let G=f.ContentAtPath(new n.Path(I));if(D.container=G.container,D.index=parseInt(b.idx),G.obj==null)throw new Error("When loading state, internal story location couldn't be found: "+I+". Has the story changed since this save data was created?");if(G.approximate){if(D.container===null)return h.throwNullException("pointer.container");f.Warning("When loading state, exact internal story location couldn't be found: '"+I+"', so it was approximated to '"+D.container.path.toString()+"' to recover. Has the story changed since this save data was created?")}}let j=!!b.exp,Je=new g(N,D,j),ce=b.temp;typeof ce!="undefined"?Je.temporaryVariables=i.JsonSerialisation.JObjectToDictionaryRuntimeObjs(ce):Je.temporaryVariables.clear(),this.callstack.push(Je)}let y=d.previousContentObject;if(typeof y!="undefined"){let w=new n.Path(y.toString());this.previousPointer=f.PointerAtPath(w)}}}Copy(){let d=new S;d.threadIndex=this.threadIndex;for(let f of this.callstack)d.callstack.push(f.Copy());return d.previousPointer=this.previousPointer.copy(),d}WriteJson(d){d.WriteObjectStart(),d.WritePropertyStart("callstack"),d.WriteArrayStart();for(let f of this.callstack){if(d.WriteObjectStart(),!f.currentPointer.isNull){if(f.currentPointer.container===null)return h.throwNullException("el.currentPointer.container");d.WriteProperty("cPath",f.currentPointer.container.path.componentsString),d.WriteIntProperty("idx",f.currentPointer.index)}d.WriteProperty("exp",f.inExpressionEvaluation),d.WriteIntProperty("type",f.type),f.temporaryVariables.size>0&&(d.WritePropertyStart("temp"),i.JsonSerialisation.WriteDictionaryRuntimeObjs(d,f.temporaryVariables),d.WritePropertyEnd()),d.WriteObjectEnd()}if(d.WriteArrayEnd(),d.WritePropertyEnd(),d.WriteIntProperty("threadIndex",this.threadIndex),!this.previousPointer.isNull){let f=this.previousPointer.Resolve();if(f===null)return h.throwNullException("this.previousPointer.Resolve()");d.WriteProperty("previousContentObject",f.path.toString())}d.WriteObjectEnd()}}c.Thread=S}(p=t.CallStack||(t.CallStack={}))})(Vh);var Do={};Object.defineProperty(Do,"__esModule",{value:!0});Do.VariablesState=void 0;const _e=ie,G_=Gn,td=xn,xe=B,gi=at,At=ue;function U_(){return class{}}class Lo extends U_(){constructor(e,n){super();this.variableChangedEventCallbacks=[],this.patch=null,this._batchObservingVariableChanges=!1,this._defaultGlobalVariables=new Map,this._changedVariablesForBatchObs=new Set,this._globalVariables=new Map,this._callStack=e,this._listDefsOrigin=n;try{return new Proxy(this,{get(i,l){return l in i?i[l]:i.$(l)},set(i,l,s){return l in i?i[l]=s:i.$(l,s),!0}})}catch{}}variableChangedEvent(e,n){for(let r of this.variableChangedEventCallbacks)r(e,n)}get batchObservingVariableChanges(){return this._batchObservingVariableChanges}set batchObservingVariableChanges(e){if(this._batchObservingVariableChanges=e,e)this._changedVariablesForBatchObs=new Set;else if(this._changedVariablesForBatchObs!=null){for(let n of this._changedVariablesForBatchObs){let r=this._globalVariables.get(n);r?this.variableChangedEvent(n,r):At.throwNullException("currentValue")}this._changedVariablesForBatchObs=null}}get callStack(){return this._callStack}set callStack(e){this._callStack=e}$(e,n){if(typeof n=="undefined"){let r=null;return this.patch!==null&&(r=this.patch.TryGetGlobal(e,null),r.exists)?r.result.valueObject:(r=this._globalVariables.get(e),typeof r=="undefined"&&(r=this._defaultGlobalVariables.get(e)),typeof r!="undefined"?r.valueObject:null)}else{if(typeof this._defaultGlobalVariables.get(e)=="undefined")throw new G_.StoryException("Cannot assign to a variable ("+e+") that hasn't been declared in the story");let r=_e.Value.Create(n);if(r==null)throw n==null?new Error("Cannot pass null to VariableState"):new Error("Invalid value passed to VariableState: "+n.toString());this.SetGlobal(e,r)}}ApplyPatch(){if(this.patch===null)return At.throwNullException("this.patch");for(let[e,n]of this.patch.globals)this._globalVariables.set(e,n);if(this._changedVariablesForBatchObs!==null)for(let e of this.patch.changedVariables)this._changedVariablesForBatchObs.add(e);this.patch=null}SetJsonToken(e){this._globalVariables.clear();for(let[n,r]of this._defaultGlobalVariables){let i=e[n];if(typeof i!="undefined"){let l=td.JsonSerialisation.JTokenToRuntimeObject(i);if(l===null)return At.throwNullException("tokenInkObject");this._globalVariables.set(n,l)}else this._globalVariables.set(n,r)}}WriteJson(e){e.WriteObjectStart();for(let[n,r]of this._globalVariables){let i=n,l=r;if(Lo.dontSaveDefaultValues&&this._defaultGlobalVariables.has(i)){let s=this._defaultGlobalVariables.get(i);if(this.RuntimeObjectsEqual(l,s))continue}e.WritePropertyStart(i),td.JsonSerialisation.WriteRuntimeObject(e,l),e.WritePropertyEnd()}e.WriteObjectEnd()}RuntimeObjectsEqual(e,n){if(e===null)return At.throwNullException("obj1");if(n===null)return At.throwNullException("obj2");if(e.constructor!==n.constructor)return!1;let r=xe.asOrNull(e,_e.BoolValue);if(r!==null)return r.value===xe.asOrThrows(n,_e.BoolValue).value;let i=xe.asOrNull(e,_e.IntValue);if(i!==null)return i.value===xe.asOrThrows(n,_e.IntValue).value;let l=xe.asOrNull(e,_e.FloatValue);if(l!==null)return l.value===xe.asOrThrows(n,_e.FloatValue).value;let s=xe.asOrNull(e,_e.Value),o=xe.asOrNull(n,_e.Value);if(s!==null&&o!==null)return xe.isEquatable(s.valueObject)&&xe.isEquatable(o.valueObject)?s.valueObject.Equals(o.valueObject):s.valueObject===o.valueObject;throw new Error("FastRoughDefinitelyEquals: Unsupported runtime object type: "+e.constructor.name)}GetVariableWithName(e,n=-1){let r=this.GetRawVariableWithName(e,n),i=xe.asOrNull(r,_e.VariablePointerValue);return i!==null&&(r=this.ValueAtVariablePointer(i)),r}TryGetDefaultVariableValue(e){let n=gi.tryGetValueFromMap(this._defaultGlobalVariables,e,null);return n.exists?n.result:null}GlobalVariableExistsWithName(e){return this._globalVariables.has(e)||this._defaultGlobalVariables!==null&&this._defaultGlobalVariables.has(e)}GetRawVariableWithName(e,n){let r=null;if(n==0||n==-1){let i=null;if(this.patch!==null&&(i=this.patch.TryGetGlobal(e,null),i.exists)||(i=gi.tryGetValueFromMap(this._globalVariables,e,null),i.exists)||this._defaultGlobalVariables!==null&&(i=gi.tryGetValueFromMap(this._defaultGlobalVariables,e,null),i.exists))return i.result;if(this._listDefsOrigin===null)return At.throwNullException("VariablesState._listDefsOrigin");let l=this._listDefsOrigin.FindSingleItemListWithName(e);if(l)return l}return r=this._callStack.GetTemporaryVariableWithName(e,n),r}ValueAtVariablePointer(e){return this.GetVariableWithName(e.variableName,e.contextIndex)}Assign(e,n){let r=e.variableName;if(r===null)return At.throwNullException("name");let i=-1,l=!1;if(e.isNewDeclaration?l=e.isGlobal:l=this.GlobalVariableExistsWithName(r),e.isNewDeclaration){let s=xe.asOrNull(n,_e.VariablePointerValue);s!==null&&(n=this.ResolveVariablePointer(s))}else{let s=null;do s=xe.asOrNull(this.GetRawVariableWithName(r,i),_e.VariablePointerValue),s!=null&&(r=s.variableName,i=s.contextIndex,l=i==0);while(s!=null)}l?this.SetGlobal(r,n):this._callStack.SetTemporaryVariable(r,n,e.isNewDeclaration,i)}SnapshotDefaultGlobals(){this._defaultGlobalVariables=new Map(this._globalVariables)}RetainListOriginsForAssignment(e,n){let r=xe.asOrThrows(e,_e.ListValue),i=xe.asOrThrows(n,_e.ListValue);r.value&&i.value&&i.value.Count==0&&i.value.SetInitialOriginNames(r.value.originNames)}SetGlobal(e,n){let r=null;if(this.patch===null&&(r=gi.tryGetValueFromMap(this._globalVariables,e,null)),this.patch!==null&&(r=this.patch.TryGetGlobal(e,null),r.exists||(r=gi.tryGetValueFromMap(this._globalVariables,e,null))),_e.ListValue.RetainListOriginsForAssignment(r.result,n),e===null)return At.throwNullException("variableName");if(this.patch!==null?this.patch.SetGlobal(e,n):this._globalVariables.set(e,n),this.variableChangedEvent!==null&&r!==null&&n!==r.result)if(this.batchObservingVariableChanges){if(this._changedVariablesForBatchObs===null)return At.throwNullException("this._changedVariablesForBatchObs");this.patch!==null?this.patch.AddChangedVariable(e):this._changedVariablesForBatchObs!==null&&this._changedVariablesForBatchObs.add(e)}else this.variableChangedEvent(e,n)}ResolveVariablePointer(e){let n=e.contextIndex;n==-1&&(n=this.GetContextIndexOfVariableNamed(e.variableName));let r=this.GetRawVariableWithName(e.variableName,n),i=xe.asOrNull(r,_e.VariablePointerValue);return i!=null?i:new _e.VariablePointerValue(e.variableName,n)}GetContextIndexOfVariableNamed(e){return this.GlobalVariableExistsWithName(e)?0:this._callStack.currentElementIndex}ObserveVariableChange(e){this.variableChangedEventCallbacks.push(e)}}Do.VariablesState=Lo;Lo.dontSaveDefaultValues=!0;var Is={};Object.defineProperty(Is,"__esModule",{value:!0});Is.PRNG=void 0;class z_{constructor(e){this.seed=e%2147483647,this.seed<=0&&(this.seed+=2147483646)}next(){return this.seed=this.seed*48271%2147483647}nextFloat(){return(this.next()-1)/2147483646}}Is.PRNG=z_;var Vo={};Object.defineProperty(Vo,"__esModule",{value:!0});Vo.StatePatch=void 0;class q_{constructor(){if(this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,arguments.length===1&&arguments[0]!==null){let e=arguments[0];this._globals=new Map(e._globals),this._changedVariables=new Set(e._changedVariables),this._visitCounts=new Map(e._visitCounts),this._turnIndices=new Map(e._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}get globals(){return this._globals}get changedVariables(){return this._changedVariables}get visitCounts(){return this._visitCounts}get turnIndices(){return this._turnIndices}TryGetGlobal(e,n){return e!==null&&this._globals.has(e)?{result:this._globals.get(e),exists:!0}:{result:n,exists:!1}}SetGlobal(e,n){this._globals.set(e,n)}AddChangedVariable(e){return this._changedVariables.add(e)}TryGetVisitCount(e,n){return this._visitCounts.has(e)?{result:this._visitCounts.get(e),exists:!0}:{result:n,exists:!1}}SetVisitCount(e,n){this._visitCounts.set(e,n)}SetTurnIndex(e,n){this._turnIndices.set(e,n)}TryGetTurnIndex(e,n){return this._turnIndices.has(e)?{result:this._turnIndices.get(e),exists:!0}:{result:n,exists:!1}}}Vo.StatePatch=q_;var Wh={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleJson=void 0;class e{static TextToDictionary(r){return new e.Reader(r).ToDictionary()}static TextToArray(r){return new e.Reader(r).ToArray()}}t.SimpleJson=e,function(n){class r{constructor(s){this._rootObject=JSON.parse(s)}ToDictionary(){return this._rootObject}ToArray(){return this._rootObject}}n.Reader=r;class i{constructor(){this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}WriteObject(s){this.WriteObjectStart(),s(this),this.WriteObjectEnd()}WriteObjectStart(){this.StartNewObject(!0);let s={};if(this.state===n.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let o=this._propertyNameStack.pop();this.currentCollection[o]=s,this._collectionStack.push(s)}else this.state===n.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(s),this._collectionStack.push(s)):(this.Assert(this.state===n.Writer.State.None),this._jsonObject=s,this._collectionStack.push(s));this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Object))}WriteObjectEnd(){this.Assert(this.state===n.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}WriteProperty(s,o){if(this.WritePropertyStart(s),arguments[1]instanceof Function)arguments[1](this);else{let a=arguments[1];this.Write(a)}this.WritePropertyEnd()}WriteIntProperty(s,o){this.WritePropertyStart(s),this.WriteInt(o),this.WritePropertyEnd()}WriteFloatProperty(s,o){this.WritePropertyStart(s),this.WriteFloat(o),this.WritePropertyEnd()}WritePropertyStart(s){this.Assert(this.state===n.Writer.State.Object),this._propertyNameStack.push(s),this.IncrementChildCount(),this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Property))}WritePropertyEnd(){this.Assert(this.state===n.Writer.State.Property),this.Assert(this.childCount===1),this._stateStack.pop()}WritePropertyNameStart(){this.Assert(this.state===n.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName="",this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Property)),this._stateStack.push(new n.Writer.StateElement(n.Writer.State.PropertyName))}WritePropertyNameEnd(){this.Assert(this.state===n.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}WritePropertyNameInner(s){this.Assert(this.state===n.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._currentPropertyName+=s}WriteArrayStart(){this.StartNewObject(!0);let s=[];if(this.state===n.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let o=this._propertyNameStack.pop();this.currentCollection[o]=s,this._collectionStack.push(s)}else this.state===n.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(s),this._collectionStack.push(s)):(this.Assert(this.state===n.Writer.State.None),this._jsonObject=s,this._collectionStack.push(s));this._stateStack.push(new n.Writer.StateElement(n.Writer.State.Array))}WriteArrayEnd(){this.Assert(this.state===n.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}Write(s,o=!0){if(s===null){console.error("Warning: trying to write a null value");return}this.StartNewObject(!1),this._addToCurrentObject(s)}WriteBool(s){s!==null&&(this.StartNewObject(!1),this._addToCurrentObject(s))}WriteInt(s){s!==null&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(s)))}WriteFloat(s){s!==null&&(this.StartNewObject(!1),s==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):s==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(s)?this._addToCurrentObject(0):this._addToCurrentObject(s))}WriteNull(){this.StartNewObject(!1),this._addToCurrentObject(null)}WriteStringStart(){this.StartNewObject(!1),this._currentString="",this._stateStack.push(new n.Writer.StateElement(n.Writer.State.String))}WriteStringEnd(){this.Assert(this.state==n.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}WriteStringInner(s,o=!0){if(this.Assert(this.state===n.Writer.State.String),s===null){console.error("Warning: trying to write a null string");return}this._currentString+=s}toString(){return this._jsonObject===null?"":JSON.stringify(this._jsonObject)}StartNewObject(s){s?this.Assert(this.state===n.Writer.State.None||this.state===n.Writer.State.Property||this.state===n.Writer.State.Array):this.Assert(this.state===n.Writer.State.Property||this.state===n.Writer.State.Array),this.state===n.Writer.State.Property&&this.Assert(this.childCount===0),(this.state===n.Writer.State.Array||this.state===n.Writer.State.Property)&&this.IncrementChildCount()}get state(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:n.Writer.State.None}get childCount(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}get currentCollection(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}get currentPropertyName(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}IncrementChildCount(){this.Assert(this._stateStack.length>0);let s=this._stateStack.pop();s.childCount++,this._stateStack.push(s)}Assert(s){if(!s)throw Error("Assert failed while writing JSON")}_addToCurrentObject(s){this.Assert(this.currentCollection!==null),this.state===n.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(s)):this.state===n.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(this.currentPropertyName!==null),this.currentCollection[this.currentPropertyName]=s,this._propertyNameStack.pop())}}n.Writer=i,function(l){(function(o){o[o.None=0]="None",o[o.Object=1]="Object",o[o.Array=2]="Array",o[o.Property=3]="Property",o[o.PropertyName=4]="PropertyName",o[o.String=5]="String"})(l.State||(l.State={}));class s{constructor(a){this.type=n.Writer.State.None,this.childCount=0,this.type=a}}l.StateElement=s}(i=n.Writer||(n.Writer={}))}(e=t.SimpleJson||(t.SimpleJson={}))})(Wh);var Wo={};Object.defineProperty(Wo,"__esModule",{value:!0});Wo.Flow=void 0;const nd=Vh,sl=xn,H_=ue;class K_{constructor(){let e=arguments[0],n=arguments[1];if(this.name=e,this.callStack=new nd.CallStack(n),arguments[2]){let r=arguments[2];this.callStack.SetJsonToken(r.callstack,n),this.outputStream=sl.JsonSerialisation.JArrayToRuntimeObjList(r.outputStream),this.currentChoices=sl.JsonSerialisation.JArrayToRuntimeObjList(r.currentChoices);let i=r.choiceThreads;typeof i!="undefined"&&this.LoadFlowChoiceThreads(i,n)}else this.outputStream=[],this.currentChoices=[]}WriteJson(e){e.WriteObjectStart(),e.WriteProperty("callstack",r=>this.callStack.WriteJson(r)),e.WriteProperty("outputStream",r=>sl.JsonSerialisation.WriteListRuntimeObjs(r,this.outputStream));let n=!1;for(let r of this.currentChoices){if(r.threadAtGeneration===null)return H_.throwNullException("c.threadAtGeneration");r.originalThreadIndex=r.threadAtGeneration.threadIndex,this.callStack.ThreadWithIndex(r.originalThreadIndex)===null&&(n||(n=!0,e.WritePropertyStart("choiceThreads"),e.WriteObjectStart()),e.WritePropertyStart(r.originalThreadIndex),r.threadAtGeneration.WriteJson(e),e.WritePropertyEnd())}n&&(e.WriteObjectEnd(),e.WritePropertyEnd()),e.WriteProperty("currentChoices",r=>{r.WriteArrayStart();for(let i of this.currentChoices)sl.JsonSerialisation.WriteChoice(r,i);r.WriteArrayEnd()}),e.WriteObjectEnd()}LoadFlowChoiceThreads(e,n){for(let r of this.currentChoices){let i=this.callStack.ThreadWithIndex(r.originalThreadIndex);if(i!==null)r.threadAtGeneration=i.Copy();else{let l=e[`${r.originalThreadIndex}`];r.threadAtGeneration=new nd.CallStack.Thread(l,n)}}}}Wo.Flow=K_;Object.defineProperty(Ro,"__esModule",{value:!0});Ro.StoryState=void 0;const J_=Vh,Q_=Do,ye=ie,Xt=qn,X_=Qr,La=Jr,rd=Ke,Le=Fe,Va=Bt,Yt=xn,Y_=Is,Z_=Gt,ir=Hn,vi=at,fe=B,eE=ms,vt=ue,tE=Ts,nE=Vo,id=Wh,ll=Wo,rE=we;class jh{constructor(e){this.kInkSaveStateVersion=10,this.kMinCompatibleLoadVersion=8,this.onDidLoadState=null,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=ir.Pointer.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this._aliveFlowNames=null,this._namedFlows=null,this.kDefaultFlowName="DEFAULT_FLOW",this._aliveFlowNamesDirty=!0,this.story=e,this._currentFlow=new ll.Flow(this.kDefaultFlowName,e),this.OutputStreamDirty(),this._aliveFlowNamesDirty=!0,this._evaluationStack=[],this._variablesState=new Q_.VariablesState(this.callStack,e.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;let n=new Date().getTime();this.storySeed=new Y_.PRNG(n).next()%100,this.previousRandom=0,this.GoToStart()}ToJson(e=!1){let n=new id.SimpleJson.Writer;return this.WriteJson(n),n.toString()}toJson(e=!1){return this.ToJson(e)}LoadJson(e){let n=id.SimpleJson.TextToDictionary(e);this.LoadJsonObj(n),this.onDidLoadState!==null&&this.onDidLoadState()}VisitCountAtPathString(e){let n;if(this._patch!==null){let r=this.story.ContentAtPath(new rd.Path(e)).container;if(r===null)throw new Error("Content at path not found: "+e);if(n=this._patch.TryGetVisitCount(r,0),n.exists)return n.result}return n=vi.tryGetValueFromMap(this._visitCounts,e,null),n.exists?n.result:0}VisitCountForContainer(e){if(e===null)return vt.throwNullException("container");if(!e.visitsShouldBeCounted)return this.story.Error("Read count for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),0;if(this._patch!==null){let i=this._patch.TryGetVisitCount(e,0);if(i.exists)return i.result}let n=e.path.toString(),r=vi.tryGetValueFromMap(this._visitCounts,n,null);return r.exists?r.result:0}IncrementVisitCountForContainer(e){if(this._patch!==null){let i=this.VisitCountForContainer(e);i++,this._patch.SetVisitCount(e,i);return}let n=e.path.toString(),r=vi.tryGetValueFromMap(this._visitCounts,n,null);r.exists?this._visitCounts.set(n,r.result+1):this._visitCounts.set(n,1)}RecordTurnIndexVisitToContainer(e){if(this._patch!==null){this._patch.SetTurnIndex(e,this.currentTurnIndex);return}let n=e.path.toString();this._turnIndices.set(n,this.currentTurnIndex)}TurnsSinceForContainer(e){if(e.turnIndexShouldBeCounted||this.story.Error("TURNS_SINCE() for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),this._patch!==null){let i=this._patch.TryGetTurnIndex(e,0);if(i.exists)return this.currentTurnIndex-i.result}let n=e.path.toString(),r=vi.tryGetValueFromMap(this._turnIndices,n,0);return r.exists?this.currentTurnIndex-r.result:-1}get callstackDepth(){return this.callStack.depth}get outputStream(){return this._currentFlow.outputStream}get currentChoices(){return this.canContinue?[]:this._currentFlow.currentChoices}get generatedChoices(){return this._currentFlow.currentChoices}get currentErrors(){return this._currentErrors}get currentWarnings(){return this._currentWarnings}get variablesState(){return this._variablesState}set variablesState(e){this._variablesState=e}get callStack(){return this._currentFlow.callStack}get evaluationStack(){return this._evaluationStack}get currentTurnIndex(){return this._currentTurnIndex}set currentTurnIndex(e){this._currentTurnIndex=e}get currentPathString(){let e=this.currentPointer;return e.isNull?null:e.path===null?vt.throwNullException("pointer.path"):e.path.toString()}get currentPointer(){return this.callStack.currentElement.currentPointer.copy()}set currentPointer(e){this.callStack.currentElement.currentPointer=e.copy()}get previousPointer(){return this.callStack.currentThread.previousPointer.copy()}set previousPointer(e){this.callStack.currentThread.previousPointer=e.copy()}get canContinue(){return!this.currentPointer.isNull&&!this.hasError}get hasError(){return this.currentErrors!=null&&this.currentErrors.length>0}get hasWarning(){return this.currentWarnings!=null&&this.currentWarnings.length>0}get currentText(){if(this._outputStreamTextDirty){let e=new Va.StringBuilder,n=!1;for(let r of this.outputStream){let i=fe.asOrNull(r,ye.StringValue);if(!n&&i!==null)e.Append(i.value);else{let l=fe.asOrNull(r,Le.ControlCommand);l!==null&&(l.commandType==Le.ControlCommand.CommandType.BeginTag?n=!0:l.commandType==Le.ControlCommand.CommandType.EndTag&&(n=!1))}}this._currentText=this.CleanOutputWhitespace(e.toString()),this._outputStreamTextDirty=!1}return this._currentText}CleanOutputWhitespace(e){let n=new Va.StringBuilder,r=-1,i=0;for(let l=0;l<e.length;l++){let s=e.charAt(l),o=s==" "||s=="	";o&&r==-1&&(r=l),o||(s!=`
`&&r>0&&r!=i&&n.Append(" "),r=-1),s==`
`&&(i=l+1),o||n.Append(s)}return n.toString()}get currentTags(){if(this._outputStreamTagsDirty){this._currentTags=[];let e=!1,n=new Va.StringBuilder;for(let r of this.outputStream){let i=fe.asOrNull(r,Le.ControlCommand);if(i!=null){if(i.commandType==Le.ControlCommand.CommandType.BeginTag){if(e&&n.Length>0){let l=this.CleanOutputWhitespace(n.toString());this._currentTags.push(l),n.Clear()}e=!0}else if(i.commandType==Le.ControlCommand.CommandType.EndTag){if(n.Length>0){let l=this.CleanOutputWhitespace(n.toString());this._currentTags.push(l),n.Clear()}e=!1}}else if(e){let l=fe.asOrNull(r,ye.StringValue);l!==null&&n.Append(l.value)}else{let l=fe.asOrNull(r,X_.Tag);l!=null&&l.text!=null&&l.text.length>0&&this._currentTags.push(l.text)}}if(n.Length>0){let r=this.CleanOutputWhitespace(n.toString());this._currentTags.push(r),n.Clear()}this._outputStreamTagsDirty=!1}return this._currentTags}get currentFlowName(){return this._currentFlow.name}get currentFlowIsDefaultFlow(){return this._currentFlow.name==this.kDefaultFlowName}get aliveFlowNames(){if(this._aliveFlowNamesDirty){if(this._aliveFlowNames=[],this._namedFlows!=null)for(let e of this._namedFlows.keys())e!=this.kDefaultFlowName&&this._aliveFlowNames.push(e);this._aliveFlowNamesDirty=!1}return this._aliveFlowNames}get inExpressionEvaluation(){return this.callStack.currentElement.inExpressionEvaluation}set inExpressionEvaluation(e){this.callStack.currentElement.inExpressionEvaluation=e}GoToStart(){this.callStack.currentElement.currentPointer=ir.Pointer.StartOf(this.story.mainContentContainer)}SwitchFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.SwitchFlow");if(this._namedFlows===null&&(this._namedFlows=new Map,this._namedFlows.set(this.kDefaultFlowName,this._currentFlow)),e===this._currentFlow.name)return;let n,r=vi.tryGetValueFromMap(this._namedFlows,e,null);r.exists?n=r.result:(n=new ll.Flow(e,this.story),this._namedFlows.set(e,n),this._aliveFlowNamesDirty=!0),this._currentFlow=n,this.variablesState.callStack=this._currentFlow.callStack,this.OutputStreamDirty()}SwitchToDefaultFlow_Internal(){this._namedFlows!==null&&this.SwitchFlow_Internal(this.kDefaultFlowName)}RemoveFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.DestroyFlow");if(e===this.kDefaultFlowName)throw new Error("Cannot destroy default flow");if(this._currentFlow.name===e&&this.SwitchToDefaultFlow_Internal(),this._namedFlows===null)return vt.throwNullException("this._namedFlows");this._namedFlows.delete(e),this._aliveFlowNamesDirty=!0}CopyAndStartPatching(){let e=new jh(this.story);if(e._patch=new nE.StatePatch(this._patch),e._currentFlow.name=this._currentFlow.name,e._currentFlow.callStack=new J_.CallStack(this._currentFlow.callStack),e._currentFlow.currentChoices.push(...this._currentFlow.currentChoices),e._currentFlow.outputStream.push(...this._currentFlow.outputStream),e.OutputStreamDirty(),this._namedFlows!==null){e._namedFlows=new Map;for(let[n,r]of this._namedFlows)e._namedFlows.set(n,r),e._aliveFlowNamesDirty=!0;e._namedFlows.set(this._currentFlow.name,e._currentFlow)}return this.hasError&&(e._currentErrors=[],e._currentErrors.push(...this.currentErrors||[])),this.hasWarning&&(e._currentWarnings=[],e._currentWarnings.push(...this.currentWarnings||[])),e.variablesState=this.variablesState,e.variablesState.callStack=e.callStack,e.variablesState.patch=e._patch,e.evaluationStack.push(...this.evaluationStack),this.divertedPointer.isNull||(e.divertedPointer=this.divertedPointer.copy()),e.previousPointer=this.previousPointer.copy(),e._visitCounts=this._visitCounts,e._turnIndices=this._turnIndices,e.currentTurnIndex=this.currentTurnIndex,e.storySeed=this.storySeed,e.previousRandom=this.previousRandom,e.didSafeExit=this.didSafeExit,e}RestoreAfterPatch(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}ApplyAnyPatch(){if(this._patch!==null){this.variablesState.ApplyPatch();for(let[e,n]of this._patch.visitCounts)this.ApplyCountChanges(e,n,!0);for(let[e,n]of this._patch.turnIndices)this.ApplyCountChanges(e,n,!1);this._patch=null}}ApplyCountChanges(e,n,r){(r?this._visitCounts:this._turnIndices).set(e.path.toString(),n)}WriteJson(e){if(e.WriteObjectStart(),e.WritePropertyStart("flows"),e.WriteObjectStart(),this._namedFlows!==null)for(let[n,r]of this._namedFlows)e.WriteProperty(n,i=>r.WriteJson(i));else e.WriteProperty(this._currentFlow.name,n=>this._currentFlow.WriteJson(n));if(e.WriteObjectEnd(),e.WritePropertyEnd(),e.WriteProperty("currentFlowName",this._currentFlow.name),e.WriteProperty("variablesState",n=>this.variablesState.WriteJson(n)),e.WriteProperty("evalStack",n=>Yt.JsonSerialisation.WriteListRuntimeObjs(n,this.evaluationStack)),!this.divertedPointer.isNull){if(this.divertedPointer.path===null)return vt.throwNullException("divertedPointer");e.WriteProperty("currentDivertTarget",this.divertedPointer.path.componentsString)}e.WriteProperty("visitCounts",n=>Yt.JsonSerialisation.WriteIntDictionary(n,this._visitCounts)),e.WriteProperty("turnIndices",n=>Yt.JsonSerialisation.WriteIntDictionary(n,this._turnIndices)),e.WriteIntProperty("turnIdx",this.currentTurnIndex),e.WriteIntProperty("storySeed",this.storySeed),e.WriteIntProperty("previousRandom",this.previousRandom),e.WriteIntProperty("inkSaveVersion",this.kInkSaveStateVersion),e.WriteIntProperty("inkFormatVersion",tE.Story.inkVersionCurrent),e.WriteObjectEnd()}LoadJsonObj(e){let n=e,r=n.inkSaveVersion;if(r==null)throw new Error("ink save format incorrect, can't load.");if(parseInt(r)<this.kMinCompatibleLoadVersion)throw new Error("Ink save format isn't compatible with the current version (saw '"+r+"', but minimum is "+this.kMinCompatibleLoadVersion+"), so can't load.");let i=n.flows;if(i!=null){let s=i;Object.keys(s).length===1?this._namedFlows=null:this._namedFlows===null?this._namedFlows=new Map:this._namedFlows.clear();let o=Object.entries(s);for(let[a,u]of o){let h=a,p=u,c=new ll.Flow(h,this.story,p);if(Object.keys(s).length===1)this._currentFlow=new ll.Flow(h,this.story,p);else{if(this._namedFlows===null)return vt.throwNullException("this._namedFlows");this._namedFlows.set(h,c)}}if(this._namedFlows!=null&&this._namedFlows.size>1){let a=n.currentFlowName;this._currentFlow=this._namedFlows.get(a)}}else{this._namedFlows=null,this._currentFlow.name=this.kDefaultFlowName,this._currentFlow.callStack.SetJsonToken(n.callstackThreads,this.story),this._currentFlow.outputStream=Yt.JsonSerialisation.JArrayToRuntimeObjList(n.outputStream),this._currentFlow.currentChoices=Yt.JsonSerialisation.JArrayToRuntimeObjList(n.currentChoices);let s=n.choiceThreads;this._currentFlow.LoadFlowChoiceThreads(s,this.story)}this.OutputStreamDirty(),this._aliveFlowNamesDirty=!0,this.variablesState.SetJsonToken(n.variablesState),this.variablesState.callStack=this._currentFlow.callStack,this._evaluationStack=Yt.JsonSerialisation.JArrayToRuntimeObjList(n.evalStack);let l=n.currentDivertTarget;if(l!=null){let s=new rd.Path(l.toString());this.divertedPointer=this.story.PointerAtPath(s)}this._visitCounts=Yt.JsonSerialisation.JObjectToIntDictionary(n.visitCounts),this._turnIndices=Yt.JsonSerialisation.JObjectToIntDictionary(n.turnIndices),this.currentTurnIndex=parseInt(n.turnIdx),this.storySeed=parseInt(n.storySeed),this.previousRandom=parseInt(n.previousRandom)}ResetErrors(){this._currentErrors=null,this._currentWarnings=null}ResetOutput(e=null){this.outputStream.length=0,e!==null&&this.outputStream.push(...e),this.OutputStreamDirty()}PushToOutputStream(e){let n=fe.asOrNull(e,ye.StringValue);if(n!==null){let r=this.TrySplittingHeadTailWhitespace(n);if(r!==null){for(let i of r)this.PushToOutputStreamIndividual(i);this.OutputStreamDirty();return}}this.PushToOutputStreamIndividual(e),this.OutputStreamDirty()}PopFromOutputStream(e){this.outputStream.splice(this.outputStream.length-e,e),this.OutputStreamDirty()}TrySplittingHeadTailWhitespace(e){let n=e.value;if(n===null)return vt.throwNullException("single.value");let r=-1,i=-1;for(let h=0;h<n.length;h++){let p=n[h];if(p==`
`)r==-1&&(r=h),i=h;else{if(p==" "||p=="	")continue;break}}let l=-1,s=-1;for(let h=n.length-1;h>=0;h--){let p=n[h];if(p==`
`)l==-1&&(l=h),s=h;else{if(p==" "||p=="	")continue;break}}if(r==-1&&l==-1)return null;let o=[],a=0,u=n.length;if(r!=-1){if(r>0){let h=new ye.StringValue(n.substring(0,r));o.push(h)}o.push(new ye.StringValue(`
`)),a=i+1}if(l!=-1&&(u=s),u>a){let h=n.substring(a,u-a);o.push(new ye.StringValue(h))}if(l!=-1&&s>i&&(o.push(new ye.StringValue(`
`)),l<n.length-1)){let h=n.length-l-1,p=new ye.StringValue(n.substring(l+1,h));o.push(p)}return o}PushToOutputStreamIndividual(e){let n=fe.asOrNull(e,La.Glue),r=fe.asOrNull(e,ye.StringValue),i=!0;if(n)this.TrimNewlinesFromOutputStream(),i=!0;else if(r){let l=-1,s=this.callStack.currentElement;s.type==Xt.PushPopType.Function&&(l=s.functionStartInOutputStream);let o=-1;for(let u=this.outputStream.length-1;u>=0;u--){let h=this.outputStream[u],p=h instanceof Le.ControlCommand?h:null;if((h instanceof La.Glue?h:null)!=null){o=u;break}else if(p!=null&&p.commandType==Le.ControlCommand.CommandType.BeginString){u>=l&&(l=-1);break}}let a=-1;if(o!=-1&&l!=-1?a=Math.min(l,o):o!=-1?a=o:a=l,a!=-1){if(r.isNewline)i=!1;else if(r.isNonWhitespace&&(o>-1&&this.RemoveExistingGlue(),l>-1)){let u=this.callStack.elements;for(let h=u.length-1;h>=0;h--){let p=u[h];if(p.type==Xt.PushPopType.Function)p.functionStartInOutputStream=-1;else break}}}else r.isNewline&&(this.outputStreamEndsInNewline||!this.outputStreamContainsContent)&&(i=!1)}if(i){if(e===null)return vt.throwNullException("obj");this.outputStream.push(e),this.OutputStreamDirty()}}TrimNewlinesFromOutputStream(){let e=-1,n=this.outputStream.length-1;for(;n>=0;){let r=this.outputStream[n],i=fe.asOrNull(r,Le.ControlCommand),l=fe.asOrNull(r,ye.StringValue);if(i!=null||l!=null&&l.isNonWhitespace)break;l!=null&&l.isNewline&&(e=n),n--}if(e>=0)for(n=e;n<this.outputStream.length;)fe.asOrNull(this.outputStream[n],ye.StringValue)?this.outputStream.splice(n,1):n++;this.OutputStreamDirty()}RemoveExistingGlue(){for(let e=this.outputStream.length-1;e>=0;e--){let n=this.outputStream[e];if(n instanceof La.Glue)this.outputStream.splice(e,1);else if(n instanceof Le.ControlCommand)break}this.OutputStreamDirty()}get outputStreamEndsInNewline(){if(this.outputStream.length>0)for(let e=this.outputStream.length-1;e>=0&&!(this.outputStream[e]instanceof Le.ControlCommand);e--){let r=this.outputStream[e];if(r instanceof ye.StringValue){if(r.isNewline)return!0;if(r.isNonWhitespace)break}}return!1}get outputStreamContainsContent(){for(let e of this.outputStream)if(e instanceof ye.StringValue)return!0;return!1}get inStringEvaluation(){for(let e=this.outputStream.length-1;e>=0;e--){let n=fe.asOrNull(this.outputStream[e],Le.ControlCommand);if(n instanceof Le.ControlCommand&&n.commandType==Le.ControlCommand.CommandType.BeginString)return!0}return!1}PushEvaluationStack(e){let n=fe.asOrNull(e,ye.ListValue);if(n){let r=n.value;if(r===null)return vt.throwNullException("rawList");if(r.originNames!=null){r.origins||(r.origins=[]),r.origins.length=0;for(let i of r.originNames){if(this.story.listDefinitions===null)return vt.throwNullException("StoryState.story.listDefinitions");let l=this.story.listDefinitions.TryListGetDefinition(i,null);if(l.result===null)return vt.throwNullException("StoryState def.result");r.origins.indexOf(l.result)<0&&r.origins.push(l.result)}}}if(e===null)return vt.throwNullException("obj");this.evaluationStack.push(e)}PopEvaluationStack(e){if(typeof e=="undefined"){let n=this.evaluationStack.pop();return fe.nullIfUndefined(n)}else{if(e>this.evaluationStack.length)throw new Error("trying to pop too many objects");let n=this.evaluationStack.splice(this.evaluationStack.length-e,e);return fe.nullIfUndefined(n)}}PeekEvaluationStack(){return this.evaluationStack[this.evaluationStack.length-1]}ForceEnd(){this.callStack.Reset(),this._currentFlow.currentChoices.length=0,this.currentPointer=ir.Pointer.Null,this.previousPointer=ir.Pointer.Null,this.didSafeExit=!0}TrimWhitespaceFromFunctionEnd(){eE.Debug.Assert(this.callStack.currentElement.type==Xt.PushPopType.Function);let e=this.callStack.currentElement.functionStartInOutputStream;e==-1&&(e=0);for(let n=this.outputStream.length-1;n>=e;n--){let r=this.outputStream[n],i=fe.asOrNull(r,ye.StringValue),l=fe.asOrNull(r,Le.ControlCommand);if(i!=null){if(l)break;if(i.isNewline||i.isInlineWhitespace)this.outputStream.splice(n,1),this.OutputStreamDirty();else break}}}PopCallStack(e=null){this.callStack.currentElement.type==Xt.PushPopType.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(e)}SetChosenPath(e,n){this._currentFlow.currentChoices.length=0;let r=this.story.PointerAtPath(e);!r.isNull&&r.index==-1&&(r.index=0),this.currentPointer=r,n&&this.currentTurnIndex++}StartFunctionEvaluationFromGame(e,n){this.callStack.Push(Xt.PushPopType.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=ir.Pointer.StartOf(e),this.PassArgumentsToEvaluationStack(n)}PassArgumentsToEvaluationStack(e){if(e!==null)for(let n=0;n<e.length;n++){if(!(typeof e[n]=="number"||typeof e[n]=="string"||typeof e[n]=="boolean"||e[n]instanceof rE.InkList))throw new Error("ink arguments when calling EvaluateFunction / ChoosePathStringWithParameters must benumber, string, bool or InkList. Argument was "+(fe.nullIfUndefined(arguments[n])===null)?"null":arguments[n].constructor.name);this.PushEvaluationStack(ye.Value.Create(e[n]))}}TryExitFunctionEvaluationFromGame(){return this.callStack.currentElement.type==Xt.PushPopType.FunctionEvaluationFromGame?(this.currentPointer=ir.Pointer.Null,this.didSafeExit=!0,!0):!1}CompleteFunctionEvaluationFromGame(){if(this.callStack.currentElement.type!=Xt.PushPopType.FunctionEvaluationFromGame)throw new Error("Expected external function evaluation to be complete. Stack trace: "+this.callStack.callStackTrace);let e=this.callStack.currentElement.evaluationStackHeightWhenPushed,n=null;for(;this.evaluationStack.length>e;){let r=this.PopEvaluationStack();n===null&&(n=r)}if(this.PopCallStack(Xt.PushPopType.FunctionEvaluationFromGame),n){if(n instanceof Z_.Void)return null;let r=fe.asOrThrows(n,ye.Value);return r.valueType==ye.ValueType.DivertTarget?r.valueObject.toString():r.valueObject}return null}AddError(e,n){n?(this._currentWarnings==null&&(this._currentWarnings=[]),this._currentWarnings.push(e)):(this._currentErrors==null&&(this._currentErrors=[]),this._currentErrors.push(e))}OutputStreamDirty(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}Ro.StoryState=jh;var jo={};Object.defineProperty(jo,"__esModule",{value:!0});jo.Stopwatch=void 0;class iE{constructor(){this.startTime=void 0}get ElapsedMilliseconds(){return typeof this.startTime=="undefined"?0:new Date().getTime()-this.startTime}Start(){this.startTime=new Date().getTime()}Stop(){this.startTime=void 0}}jo.Stopwatch=iE;var Om={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(t.ErrorType||(t.ErrorType={}))})(Om);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Story=t.InkList=void 0;const e=he,n=Ae,r=xn,i=Ro,l=Fe,s=qn,o=$r,a=Ns,u=dt,h=ie,p=Ke,c=Gt,g=Qr,S=It,E=On,d=ft,f=Gn,v=Is,y=Bt,w=bs,b=jo,N=Hn,D=we,I=B,T=ue,j=Wh,Je=Om;var ce=we;Object.defineProperty(t,"InkList",{enumerable:!0,get:function(){return ce.InkList}}),Number.isInteger||(Number.isInteger=function(m){return typeof m=="number"&&isFinite(m)&&m>-9007199254740992&&m<9007199254740992&&Math.floor(m)===m});class G extends n.InkObject{constructor(){super();this.inkVersionMinimumCompatible=18,this.onError=null,this.onDidContinue=null,this.onMakeChoice=null,this.onEvaluateFunction=null,this.onCompleteEvaluateFunction=null,this.onChoosePathString=null,this._prevContainers=[],this.allowExternalFunctionFallbacks=!1,this._listDefinitions=null,this._variableObservers=null,this._hasValidatedExternals=!1,this._temporaryEvaluationContainer=null,this._asyncContinueActive=!1,this._stateSnapshotAtLastNewline=null,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount=0,this._asyncSaving=!1,this._profiler=null;let m,C=null,_=null;if(arguments[0]instanceof e.Container)m=arguments[0],typeof arguments[1]!="undefined"&&(C=arguments[1]),this._mainContentContainer=m;else if(typeof arguments[0]=="string"){let P=arguments[0];_=j.SimpleJson.TextToDictionary(P)}else _=arguments[0];if(C!=null&&(this._listDefinitions=new w.ListDefinitionsOrigin(C)),this._externals=new Map,_!==null){let P=_,x=P.inkVersion;if(x==null)throw new Error("ink version number not found. Are you sure it's a valid .ink.json file?");let F=parseInt(x);if(F>G.inkVersionCurrent)throw new Error("Version of ink used to build story was newer than the current version of the engine");if(F<this.inkVersionMinimumCompatible)throw new Error("Version of ink used to build story is too old to be loaded by this version of the engine");F!=G.inkVersionCurrent&&console.warn("WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.");let O=P.root;if(O==null)throw new Error("Root node for ink not found. Are you sure it's a valid .ink.json file?");let A;(A=P.listDefs)&&(this._listDefinitions=r.JsonSerialisation.JTokenToListDefinitions(A)),this._mainContentContainer=I.asOrThrows(r.JsonSerialisation.JTokenToRuntimeObject(O),e.Container),this.ResetState()}}get currentChoices(){let m=[];if(this._state===null)return T.throwNullException("this._state");for(let C of this._state.currentChoices)C.isInvisibleDefault||(C.index=m.length,m.push(C));return m}get currentText(){return this.IfAsyncWeCant("call currentText since it's a work in progress"),this.state.currentText}get currentTags(){return this.IfAsyncWeCant("call currentTags since it's a work in progress"),this.state.currentTags}get currentErrors(){return this.state.currentErrors}get currentWarnings(){return this.state.currentWarnings}get currentFlowName(){return this.state.currentFlowName}get currentFlowIsDefaultFlow(){return this.state.currentFlowIsDefaultFlow}get aliveFlowNames(){return this.state.aliveFlowNames}get hasError(){return this.state.hasError}get hasWarning(){return this.state.hasWarning}get variablesState(){return this.state.variablesState}get listDefinitions(){return this._listDefinitions}get state(){return this._state}StartProfiling(){}EndProfiling(){}ToJson(m){let C=!1;if(m||(C=!0,m=new j.SimpleJson.Writer),m.WriteObjectStart(),m.WriteIntProperty("inkVersion",G.inkVersionCurrent),m.WriteProperty("root",_=>r.JsonSerialisation.WriteRuntimeContainer(_,this._mainContentContainer)),this._listDefinitions!=null){m.WritePropertyStart("listDefs"),m.WriteObjectStart();for(let _ of this._listDefinitions.lists){m.WritePropertyStart(_.name),m.WriteObjectStart();for(let[P,x]of _.items){let F=D.InkListItem.fromSerializedKey(P),O=x;m.WriteIntProperty(F.itemName,O)}m.WriteObjectEnd(),m.WritePropertyEnd()}m.WriteObjectEnd(),m.WritePropertyEnd()}if(m.WriteObjectEnd(),C)return m.toString()}ResetState(){this.IfAsyncWeCant("ResetState"),this._state=new i.StoryState(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}ResetErrors(){if(this._state===null)return T.throwNullException("this._state");this._state.ResetErrors()}ResetCallstack(){if(this.IfAsyncWeCant("ResetCallstack"),this._state===null)return T.throwNullException("this._state");this._state.ForceEnd()}ResetGlobals(){if(this._mainContentContainer.namedContent.get("global decl")){let m=this.state.currentPointer.copy();this.ChoosePath(new p.Path("global decl"),!1),this.ContinueInternal(),this.state.currentPointer=m}this.state.variablesState.SnapshotDefaultGlobals()}SwitchFlow(m){if(this.IfAsyncWeCant("switch flow"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't switch flow to "+m);this.state.SwitchFlow_Internal(m)}RemoveFlow(m){this.state.RemoveFlow_Internal(m)}SwitchToDefaultFlow(){this.state.SwitchToDefaultFlow_Internal()}Continue(){return this.ContinueAsync(0),this.currentText}get canContinue(){return this.state.canContinue}get asyncContinueComplete(){return!this._asyncContinueActive}ContinueAsync(m){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(m)}ContinueInternal(m=0){this._profiler!=null&&this._profiler.PreContinue();let C=m>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=C,!this.canContinue)throw new Error("Can't continue - should check canContinue before calling Continue");this._state.didSafeExit=!1,this._state.ResetOutput(),this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!0)}let _=new b.Stopwatch;_.Start();let P=!1;this._sawLookaheadUnsafeFunctionAfterNewline=!1;do{try{P=this.ContinueSingleStep()}catch(x){if(!(x instanceof f.StoryException))throw x;this.AddError(x.message,void 0,x.useEndLineNumber);break}if(P||this._asyncContinueActive&&_.ElapsedMilliseconds>m)break}while(this.canContinue);if(_.Stop(),(P||!this.canContinue)&&(this._stateSnapshotAtLastNewline!==null&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError("Thread available to pop, threads should always be flat by the end of evaluation?"),this.state.generatedChoices.length==0&&!this.state.didSafeExit&&this._temporaryEvaluationContainer==null&&(this.state.callStack.CanPop(s.PushPopType.Tunnel)?this.AddError("unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?"):this.state.callStack.CanPop(s.PushPopType.Function)?this.AddError("unexpectedly reached end of content. Do you need a '~ return'?"):this.state.callStack.canPop?this.AddError("unexpectedly reached end of content for unknown reason. Please debug compiler!"):this.AddError("ran out of content. Do you need a '-> DONE' or '-> END'?"))),this.state.didSafeExit=!1,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1,this.onDidContinue!==null&&this.onDidContinue()),this._recursiveContinueCount--,this._profiler!=null&&this._profiler.PostContinue(),this.state.hasError||this.state.hasWarning)if(this.onError!==null){if(this.state.hasError)for(let x of this.state.currentErrors)this.onError(x,Je.ErrorType.Error);if(this.state.hasWarning)for(let x of this.state.currentWarnings)this.onError(x,Je.ErrorType.Warning);this.ResetErrors()}else{let x=new y.StringBuilder;throw x.Append("Ink had "),this.state.hasError&&(x.Append(`${this.state.currentErrors.length}`),x.Append(this.state.currentErrors.length==1?" error":"errors"),this.state.hasWarning&&x.Append(" and ")),this.state.hasWarning&&(x.Append(`${this.state.currentWarnings.length}`),x.Append(this.state.currentWarnings.length==1?" warning":"warnings"),this.state.hasWarning&&x.Append(" and ")),x.Append(". It is strongly suggested that you assign an error handler to story.onError. The first issue was: "),x.Append(this.state.hasError?this.state.currentErrors[0]:this.state.currentWarnings[0]),new f.StoryException(x.toString())}}ContinueSingleStep(){if(this._profiler!=null&&this._profiler.PreStep(),this.Step(),this._profiler!=null&&this._profiler.PostStep(),!this.canContinue&&!this.state.callStack.elementIsEvaluateFromGame&&this.TryFollowDefaultInvisibleChoice(),this._profiler!=null&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(this._stateSnapshotAtLastNewline!==null){if(this._stateSnapshotAtLastNewline.currentTags===null)return T.throwNullException("this._stateAtLastNewline.currentTags");if(this.state.currentTags===null)return T.throwNullException("this.state.currentTags");let m=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(m==G.OutputStateChange.ExtendedBeyondNewline||this._sawLookaheadUnsafeFunctionAfterNewline)return this.RestoreStateSnapshot(),!0;m==G.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?this._stateSnapshotAtLastNewline==null&&this.StateSnapshot():this.DiscardSnapshot())}return this._profiler!=null&&this._profiler.PostSnapshot(),!1}CalculateNewlineOutputStateChange(m,C,_,P){if(m===null)return T.throwNullException("prevText");if(C===null)return T.throwNullException("currText");let x=C.length>=m.length&&m.length>0&&C.charAt(m.length-1)==`
`;if(_==P&&m.length==C.length&&x)return G.OutputStateChange.NoChange;if(!x)return G.OutputStateChange.NewlineRemoved;if(P>_)return G.OutputStateChange.ExtendedBeyondNewline;for(let F=m.length;F<C.length;F++){let O=C.charAt(F);if(O!=" "&&O!="	")return G.OutputStateChange.ExtendedBeyondNewline}return G.OutputStateChange.NoChange}ContinueMaximally(){this.IfAsyncWeCant("ContinueMaximally");let m=new y.StringBuilder;for(;this.canContinue;)m.Append(this.Continue());return m.toString()}ContentAtPath(m){return this.mainContentContainer.ContentAtPath(m)}KnotContainerWithName(m){let C=this.mainContentContainer.namedContent.get(m);return C instanceof e.Container?C:null}PointerAtPath(m){if(m.length==0)return N.Pointer.Null;let C=new N.Pointer,_=m.length,P=null;return m.lastComponent===null?T.throwNullException("path.lastComponent"):(m.lastComponent.isIndex?(_=m.length-1,P=this.mainContentContainer.ContentAtPath(m,void 0,_),C.container=P.container,C.index=m.lastComponent.index):(P=this.mainContentContainer.ContentAtPath(m),C.container=P.container,C.index=-1),P.obj==null||P.obj==this.mainContentContainer&&_>0?this.Error("Failed to find content at path '"+m+"', and no approximation of it was possible."):P.approximate&&this.Warning("Failed to find content at path '"+m+"', so it was approximated to: '"+P.obj.path+"'."),C)}StateSnapshot(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}RestoreStateSnapshot(){this._stateSnapshotAtLastNewline===null&&T.throwNullException("_stateSnapshotAtLastNewline"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}DiscardSnapshot(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}CopyStateForBackgroundThreadSave(){if(this.IfAsyncWeCant("start saving on a background thread"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!");let m=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,m}BackgroundSaveComplete(){this._stateSnapshotAtLastNewline===null&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}Step(){let m=!0,C=this.state.currentPointer.copy();if(C.isNull)return;let _=I.asOrNull(C.Resolve(),e.Container);for(;_&&(this.VisitContainer(_,!0),_.content.length!=0);)C=N.Pointer.StartOf(_),_=I.asOrNull(C.Resolve(),e.Container);this.state.currentPointer=C.copy(),this._profiler!=null&&this._profiler.Step(this.state.callStack);let P=C.Resolve(),x=this.PerformLogicAndFlowControl(P);if(this.state.currentPointer.isNull)return;x&&(m=!1);let F=I.asOrNull(P,o.ChoicePoint);if(F){let A=this.ProcessChoice(F);A&&this.state.generatedChoices.push(A),P=null,m=!1}if(P instanceof e.Container&&(m=!1),m){let A=I.asOrNull(P,h.VariablePointerValue);if(A&&A.contextIndex==-1){let W=this.state.callStack.ContextForVariableNamed(A.variableName);P=new h.VariablePointerValue(A.variableName,W)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(P):this.state.PushToOutputStream(P)}this.NextContent();let O=I.asOrNull(P,l.ControlCommand);O&&O.commandType==l.ControlCommand.CommandType.StartThread&&this.state.callStack.PushThread()}VisitContainer(m,C){(!m.countingAtStartOnly||C)&&(m.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(m),m.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(m))}VisitChangedContainersDueToDivert(){let m=this.state.previousPointer.copy(),C=this.state.currentPointer.copy();if(C.isNull||C.index==-1)return;if(this._prevContainers.length=0,!m.isNull){let F=m.Resolve(),O=I.asOrNull(F,e.Container)||I.asOrNull(m.container,e.Container);for(;O;)this._prevContainers.push(O),O=I.asOrNull(O.parent,e.Container)}let _=C.Resolve();if(_==null)return;let P=I.asOrNull(_.parent,e.Container),x=!0;for(;P&&(this._prevContainers.indexOf(P)<0||P.countingAtStartOnly);){let F=P.content.length>0&&_==P.content[0]&&x;F||(x=!1),this.VisitContainer(P,F),_=P,P=I.asOrNull(P.parent,e.Container)}}PopChoiceStringAndTags(m){let C=I.asOrThrows(this.state.PopEvaluationStack(),h.StringValue);for(;this.state.evaluationStack.length>0&&I.asOrNull(this.state.PeekEvaluationStack(),g.Tag)!=null;){let _=I.asOrNull(this.state.PopEvaluationStack(),g.Tag);_&&m.push(_.text)}return C.value}ProcessChoice(m){let C=!0;if(m.hasCondition){let O=this.state.PopEvaluationStack();this.IsTruthy(O)||(C=!1)}let _="",P="",x=[];if(m.hasChoiceOnlyContent&&(P=this.PopChoiceStringAndTags(x)||""),m.hasStartContent&&(_=this.PopChoiceStringAndTags(x)||""),m.onceOnly&&this.state.VisitCountForContainer(m.choiceTarget)>0&&(C=!1),!C)return null;let F=new a.Choice;return F.targetPath=m.pathOnChoice,F.sourcePath=m.path.toString(),F.isInvisibleDefault=m.isInvisibleDefault,F.threadAtGeneration=this.state.callStack.ForkThread(),F.tags=x.reverse(),F.text=(_+P).replace(/^[ \t]+|[ \t]+$/g,""),F}IsTruthy(m){let C=!1;if(m instanceof h.Value){let _=m;if(_ instanceof h.DivertTargetValue){let P=_;return this.Error("Shouldn't use a divert target (to "+P.targetPath+") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)"),!1}return _.isTruthy}return C}PerformLogicAndFlowControl(m){if(m==null)return!1;if(m instanceof u.Divert){let C=m;if(C.isConditional){let _=this.state.PopEvaluationStack();if(!this.IsTruthy(_))return!0}if(C.hasVariableTarget){let _=C.variableDivertName,P=this.state.variablesState.GetVariableWithName(_);if(P==null)this.Error("Tried to divert using a target from a variable that could not be found ("+_+")");else if(!(P instanceof h.DivertTargetValue)){let F=I.asOrNull(P,h.IntValue),O="Tried to divert to a target from a variable, but the variable ("+_+") didn't contain a divert target, it ";F instanceof h.IntValue&&F.value==0?O+="was empty/null (the value 0).":O+="contained '"+P+"'.",this.Error(O)}let x=I.asOrThrows(P,h.DivertTargetValue);this.state.divertedPointer=this.PointerAtPath(x.targetPath)}else{if(C.isExternal)return this.CallExternalFunction(C.targetPathString,C.externalArgs),!0;this.state.divertedPointer=C.targetPointer.copy()}return C.pushesToStack&&this.state.callStack.Push(C.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!C.isExternal&&(C&&C.debugMetadata&&C.debugMetadata.sourceName!=null?this.Error("Divert target doesn't exist: "+C.debugMetadata.sourceName):this.Error("Divert resolution failed: "+C)),!0}else if(m instanceof l.ControlCommand){let C=m;switch(C.commandType){case l.ControlCommand.CommandType.EvalStart:this.Assert(this.state.inExpressionEvaluation===!1,"Already in expression evaluation?"),this.state.inExpressionEvaluation=!0;break;case l.ControlCommand.CommandType.EvalEnd:this.Assert(this.state.inExpressionEvaluation===!0,"Not in expression evaluation mode"),this.state.inExpressionEvaluation=!1;break;case l.ControlCommand.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){let q=this.state.PopEvaluationStack();if(!(q instanceof c.Void)){let ne=new h.StringValue(q.toString());this.state.PushToOutputStream(ne)}}break;case l.ControlCommand.CommandType.NoOp:break;case l.ControlCommand.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case l.ControlCommand.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case l.ControlCommand.CommandType.PopFunction:case l.ControlCommand.CommandType.PopTunnel:let _=C.commandType==l.ControlCommand.CommandType.PopFunction?s.PushPopType.Function:s.PushPopType.Tunnel,P=null;if(_==s.PushPopType.Tunnel){let q=this.state.PopEvaluationStack();P=I.asOrNull(q,h.DivertTargetValue),P===null&&this.Assert(q instanceof c.Void,"Expected void if ->-> doesn't override target")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type!=_||!this.state.callStack.canPop){let q=new Map;q.set(s.PushPopType.Function,"function return statement (~ return)"),q.set(s.PushPopType.Tunnel,"tunnel onwards statement (->->)");let ne=q.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(ne="end of flow (-> END or choice)");let ge="Found "+q.get(_)+", when expected "+ne;this.Error(ge)}else this.state.PopCallStack(),P&&(this.state.divertedPointer=this.PointerAtPath(P.targetPath));break;case l.ControlCommand.CommandType.BeginString:this.state.PushToOutputStream(C),this.Assert(this.state.inExpressionEvaluation===!0,"Expected to be in an expression when evaluating a string"),this.state.inExpressionEvaluation=!1;break;case l.ControlCommand.CommandType.BeginTag:this.state.PushToOutputStream(C);break;case l.ControlCommand.CommandType.EndTag:{if(this.state.inStringEvaluation){let q=[],ne=0;for(let Re=this.state.outputStream.length-1;Re>=0;--Re){let De=this.state.outputStream[Re];ne++;let kt=I.asOrNull(De,l.ControlCommand);if(kt!=null){if(kt.commandType==l.ControlCommand.CommandType.BeginTag)break;this.Error("Unexpected ControlCommand while extracting tag from choice");break}De instanceof h.StringValue&&q.push(De)}this.state.PopFromOutputStream(ne);let ge=new y.StringBuilder;for(let Re of q)ge.Append(Re.toString());let Jt=new g.Tag(this.state.CleanOutputWhitespace(ge.toString()));this.state.PushEvaluationStack(Jt)}else this.state.PushToOutputStream(C);break}case l.ControlCommand.CommandType.EndString:{let q=[],ne=[],ge=0;for(let Re=this.state.outputStream.length-1;Re>=0;--Re){let De=this.state.outputStream[Re];ge++;let kt=I.asOrNull(De,l.ControlCommand);if(kt&&kt.commandType==l.ControlCommand.CommandType.BeginString)break;De instanceof g.Tag&&ne.push(De),De instanceof h.StringValue&&q.push(De)}this.state.PopFromOutputStream(ge);for(let Re of ne)this.state.PushToOutputStream(Re);q=q.reverse();let Jt=new y.StringBuilder;for(let Re of q)Jt.Append(Re.toString());this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new h.StringValue(Jt.toString()));break}case l.ControlCommand.CommandType.ChoiceCount:let x=this.state.generatedChoices.length;this.state.PushEvaluationStack(new h.IntValue(x));break;case l.ControlCommand.CommandType.Turns:this.state.PushEvaluationStack(new h.IntValue(this.state.currentTurnIndex+1));break;case l.ControlCommand.CommandType.TurnsSince:case l.ControlCommand.CommandType.ReadCount:let F=this.state.PopEvaluationStack();if(!(F instanceof h.DivertTargetValue)){let q="";F instanceof h.IntValue&&(q=". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?"),this.Error("TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw "+F+q);break}let O=I.asOrThrows(F,h.DivertTargetValue),A=I.asOrNull(this.ContentAtPath(O.targetPath).correctObj,e.Container),W;A!=null?C.commandType==l.ControlCommand.CommandType.TurnsSince?W=this.state.TurnsSinceForContainer(A):W=this.state.VisitCountForContainer(A):(C.commandType==l.ControlCommand.CommandType.TurnsSince?W=-1:W=0,this.Warning("Failed to find container for "+C.toString()+" lookup at "+O.targetPath.toString())),this.state.PushEvaluationStack(new h.IntValue(W));break;case l.ControlCommand.CommandType.Random:{let q=I.asOrNull(this.state.PopEvaluationStack(),h.IntValue),ne=I.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(ne==null||!(ne instanceof h.IntValue))return this.Error("Invalid value for minimum parameter of RANDOM(min, max)");if(q==null||!(ne instanceof h.IntValue))return this.Error("Invalid value for maximum parameter of RANDOM(min, max)");if(q.value===null)return T.throwNullException("maxInt.value");if(ne.value===null)return T.throwNullException("minInt.value");let ge=q.value-ne.value+1;(!isFinite(ge)||ge>Number.MAX_SAFE_INTEGER)&&(ge=Number.MAX_SAFE_INTEGER,this.Error("RANDOM was called with a range that exceeds the size that ink numbers can use.")),ge<=0&&this.Error("RANDOM was called with minimum as "+ne.value+" and maximum as "+q.value+". The maximum must be larger");let Jt=this.state.storySeed+this.state.previousRandom,De=new v.PRNG(Jt).next(),kt=De%ge+ne.value;this.state.PushEvaluationStack(new h.IntValue(kt)),this.state.previousRandom=De;break}case l.ControlCommand.CommandType.SeedRandom:let U=I.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(U==null||!(U instanceof h.IntValue))return this.Error("Invalid value passed to SEED_RANDOM");if(U.value===null)return T.throwNullException("minInt.value");this.state.storySeed=U.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new c.Void);break;case l.ControlCommand.CommandType.VisitIndex:let te=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new h.IntValue(te));break;case l.ControlCommand.CommandType.SequenceShuffleIndex:let Me=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new h.IntValue(Me));break;case l.ControlCommand.CommandType.StartThread:break;case l.ControlCommand.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=N.Pointer.Null);break;case l.ControlCommand.CommandType.End:this.state.ForceEnd();break;case l.ControlCommand.CommandType.ListFromInt:let Z=I.asOrNull(this.state.PopEvaluationStack(),h.IntValue),Qe=I.asOrThrows(this.state.PopEvaluationStack(),h.StringValue);if(Z===null)throw new f.StoryException("Passed non-integer when creating a list element from a numerical value.");let Xe=null;if(this.listDefinitions===null)return T.throwNullException("this.listDefinitions");let $h=this.listDefinitions.TryListGetDefinition(Qe.value,null);if($h.exists){if(Z.value===null)return T.throwNullException("minInt.value");let q=$h.result.TryGetItemWithValue(Z.value,D.InkListItem.Null);q.exists&&(Xe=new h.ListValue(q.result,Z.value))}else throw new f.StoryException("Failed to find LIST called "+Qe.value);Xe==null&&(Xe=new h.ListValue),this.state.PushEvaluationStack(Xe);break;case l.ControlCommand.CommandType.ListRange:let Bh=I.asOrNull(this.state.PopEvaluationStack(),h.Value),Gh=I.asOrNull(this.state.PopEvaluationStack(),h.Value),Uo=I.asOrNull(this.state.PopEvaluationStack(),h.ListValue);if(Uo===null||Gh===null||Bh===null)throw new f.StoryException("Expected list, minimum and maximum for LIST_RANGE");if(Uo.value===null)return T.throwNullException("targetList.value");let xm=Uo.value.ListWithSubRange(Gh.valueObject,Bh.valueObject);this.state.PushEvaluationStack(new h.ListValue(xm));break;case l.ControlCommand.CommandType.ListRandom:{let q=this.state.PopEvaluationStack();if(q===null)throw new f.StoryException("Expected list for LIST_RANDOM");let ne=q.value,ge=null;if(ne===null)throw T.throwNullException("list");if(ne.Count==0)ge=new D.InkList;else{let Jt=this.state.storySeed+this.state.previousRandom,De=new v.PRNG(Jt).next(),kt=De%ne.Count,Uh=ne.entries();for(let qh=0;qh<=kt-1;qh++)Uh.next();let zh=Uh.next().value,ks={Key:D.InkListItem.fromSerializedKey(zh[0]),Value:zh[1]};if(ks.Key.originName===null)return T.throwNullException("randomItem.Key.originName");ge=new D.InkList(ks.Key.originName,this),ge.Add(ks.Key,ks.Value),this.state.previousRandom=De}this.state.PushEvaluationStack(new h.ListValue(ge));break}default:this.Error("unhandled ControlCommand: "+C);break}return!0}else if(m instanceof S.VariableAssignment){let C=m,_=this.state.PopEvaluationStack();return this.state.variablesState.Assign(C,_),!0}else if(m instanceof E.VariableReference){let C=m,_=null;if(C.pathForCount!=null){let P=C.containerForCount,x=this.state.VisitCountForContainer(P);_=new h.IntValue(x)}else _=this.state.variablesState.GetVariableWithName(C.name),_==null&&(this.Warning("Variable not found: '"+C.name+"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state."),_=new h.IntValue(0));return this.state.PushEvaluationStack(_),!0}else if(m instanceof d.NativeFunctionCall){let C=m,_=this.state.PopEvaluationStack(C.numberOfParameters),P=C.Call(_);return this.state.PushEvaluationStack(P),!0}return!1}ChoosePathString(m,C=!0,_=[]){if(this.IfAsyncWeCant("call ChoosePathString right now"),this.onChoosePathString!==null&&this.onChoosePathString(m,_),C)this.ResetCallstack();else if(this.state.callStack.currentElement.type==s.PushPopType.Function){let P="",x=this.state.callStack.currentElement.currentPointer.container;throw x!=null&&(P="("+x.path.toString()+") "),new Error("Story was running a function "+P+"when you called ChoosePathString("+m+`) - this is almost certainly not not what you want! Full stack trace: 
`+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(_),this.ChoosePath(new p.Path(m))}IfAsyncWeCant(m){if(this._asyncContinueActive)throw new Error("Can't "+m+". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.")}ChoosePath(m,C=!0){this.state.SetChosenPath(m,C),this.VisitChangedContainersDueToDivert()}ChooseChoiceIndex(m){m=m;let C=this.currentChoices;this.Assert(m>=0&&m<C.length,"choice out of range");let _=C[m];if(this.onMakeChoice!==null&&this.onMakeChoice(_),_.threadAtGeneration===null)return T.throwNullException("choiceToChoose.threadAtGeneration");if(_.targetPath===null)return T.throwNullException("choiceToChoose.targetPath");this.state.callStack.currentThread=_.threadAtGeneration,this.ChoosePath(_.targetPath)}HasFunction(m){try{return this.KnotContainerWithName(m)!=null}catch{return!1}}EvaluateFunction(m,C=[],_=!1){if(this.onEvaluateFunction!==null&&this.onEvaluateFunction(m,C),this.IfAsyncWeCant("evaluate a function"),m==null)throw new Error("Function is null");if(m==""||m.trim()=="")throw new Error("Function is empty or white space.");let P=this.KnotContainerWithName(m);if(P==null)throw new Error("Function doesn't exist: '"+m+"'");let x=[];x.push(...this.state.outputStream),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(P,C);let F=new y.StringBuilder;for(;this.canContinue;)F.Append(this.Continue());let O=F.toString();this._state.ResetOutput(x);let A=this.state.CompleteFunctionEvaluationFromGame();return this.onCompleteEvaluateFunction!=null&&this.onCompleteEvaluateFunction(m,C,O,A),_?{returned:A,output:O}:A}EvaluateExpression(m){let C=this.state.callStack.elements.length;this.state.callStack.Push(s.PushPopType.Tunnel),this._temporaryEvaluationContainer=m,this.state.GoToStart();let _=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>C&&this.state.PopCallStack(),this.state.evaluationStack.length>_?this.state.PopEvaluationStack():null}CallExternalFunction(m,C){if(m===null)return T.throwNullException("funcName");let _=this._externals.get(m),P=null,x=typeof _!="undefined";if(x&&!_.lookAheadSafe&&this._stateSnapshotAtLastNewline!==null){this._sawLookaheadUnsafeFunctionAfterNewline=!0;return}if(!x)if(this.allowExternalFunctionFallbacks){P=this.KnotContainerWithName(m),this.Assert(P!==null,"Trying to call EXTERNAL function '"+m+"' which has not been bound, and fallback ink function could not be found."),this.state.callStack.Push(s.PushPopType.Function,void 0,this.state.outputStream.length),this.state.divertedPointer=N.Pointer.StartOf(P);return}else this.Assert(!1,"Trying to call EXTERNAL function '"+m+"' which has not been bound (and ink fallbacks disabled).");let F=[];for(let W=0;W<C;++W){let te=I.asOrThrows(this.state.PopEvaluationStack(),h.Value).valueObject;F.push(te)}F.reverse();let O=_.function(F),A=null;O!=null?(A=h.Value.Create(O),this.Assert(A!==null,"Could not create ink value from returned object of type "+typeof O)):A=new c.Void,this.state.PushEvaluationStack(A)}BindExternalFunctionGeneral(m,C,_=!0){this.IfAsyncWeCant("bind an external function"),this.Assert(!this._externals.has(m),"Function '"+m+"' has already been bound."),this._externals.set(m,{function:C,lookAheadSafe:_})}TryCoerce(m){return m}BindExternalFunction(m,C,_=!1){this.Assert(C!=null,"Can't bind a null function"),this.BindExternalFunctionGeneral(m,P=>{this.Assert(P.length>=C.length,"External function expected "+C.length+" arguments");let x=[];for(let F=0,O=P.length;F<O;F++)x[F]=this.TryCoerce(P[F]);return C.apply(null,x)},_)}UnbindExternalFunction(m){this.IfAsyncWeCant("unbind an external a function"),this.Assert(this._externals.has(m),"Function '"+m+"' has not been bound."),this._externals.delete(m)}ValidateExternalBindings(){let m=null,C=null,_=arguments[1]||new Set;if(arguments[0]instanceof e.Container&&(m=arguments[0]),arguments[0]instanceof n.InkObject&&(C=arguments[0]),m===null&&C===null)if(this.ValidateExternalBindings(this._mainContentContainer,_),this._hasValidatedExternals=!0,_.size==0)this._hasValidatedExternals=!0;else{let P="Error: Missing function binding for external";P+=_.size>1?"s":"",P+=": '",P+=Array.from(_).join("', '"),P+="' ",P+=this.allowExternalFunctionFallbacks?", and no fallback ink function found.":" (ink fallbacks disabled)",this.Error(P)}else if(m!=null){for(let P of m.content){let x=P;(x==null||!x.hasValidName)&&this.ValidateExternalBindings(P,_)}for(let[,P]of m.namedContent)this.ValidateExternalBindings(I.asOrNull(P,n.InkObject),_)}else if(C!=null){let P=I.asOrNull(C,u.Divert);if(P&&P.isExternal){let x=P.targetPathString;if(x===null)return T.throwNullException("name");this._externals.has(x)||this.allowExternalFunctionFallbacks&&this.mainContentContainer.namedContent.has(x)||_.add(x)}}}ObserveVariable(m,C){if(this.IfAsyncWeCant("observe a new variable"),this._variableObservers===null&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(m))throw new Error("Cannot observe variable '"+m+"' because it wasn't declared in the ink story.");this._variableObservers.has(m)?this._variableObservers.get(m).push(C):this._variableObservers.set(m,[C])}ObserveVariables(m,C){for(let _=0,P=m.length;_<P;_++)this.ObserveVariable(m[_],C[_])}RemoveVariableObserver(m,C){if(this.IfAsyncWeCant("remove a variable observer"),this._variableObservers!==null){if(C!=null){if(this._variableObservers.has(C))if(m!=null){let _=this._variableObservers.get(C);_!=null&&(_.splice(_.indexOf(m),1),_.length===0&&this._variableObservers.delete(C))}else this._variableObservers.delete(C)}else if(m!=null){let _=this._variableObservers.keys();for(let P of _){let x=this._variableObservers.get(P);x!=null&&(x.splice(x.indexOf(m),1),x.length===0&&this._variableObservers.delete(P))}}}}VariableStateDidChangeEvent(m,C){if(this._variableObservers===null)return;let _=this._variableObservers.get(m);if(typeof _!="undefined"){if(!(C instanceof h.Value))throw new Error("Tried to get the value of a variable that isn't a standard type");let P=I.asOrThrows(C,h.Value);for(let x of _)x(m,P.valueObject)}}get globalTags(){return this.TagsAtStartOfFlowContainerWithPathString("")}TagsForContentAtPath(m){return this.TagsAtStartOfFlowContainerWithPathString(m)}TagsAtStartOfFlowContainerWithPathString(m){let C=new p.Path(m),_=this.ContentAtPath(C).container;if(_===null)return T.throwNullException("flowContainer");for(;;){let F=_.content[0];if(F instanceof e.Container)_=F;else break}let P=!1,x=null;for(let F of _.content){let O=I.asOrNull(F,l.ControlCommand);if(O!=null)O.commandType==l.ControlCommand.CommandType.BeginTag?P=!0:O.commandType==l.ControlCommand.CommandType.EndTag&&(P=!1);else if(P){let A=I.asOrNull(F,h.StringValue);A!==null?(x===null&&(x=[]),A.value!==null&&x.push(A.value)):this.Error("Tag contained non-text content. Only plain text is allowed when using globalTags or TagsAtContentPath. If you want to evaluate dynamic content, you need to use story.Continue().")}else break}return x}BuildStringOfHierarchy(){let m=new y.StringBuilder;return this.mainContentContainer.BuildStringOfHierarchy(m,0,this.state.currentPointer.Resolve()),m.toString()}BuildStringOfContainer(m){let C=new y.StringBuilder;return m.BuildStringOfHierarchy(C,0,this.state.currentPointer.Resolve()),C.toString()}NextContent(){if(this.state.previousPointer=this.state.currentPointer.copy(),!this.state.divertedPointer.isNull&&(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=N.Pointer.Null,this.VisitChangedContainersDueToDivert(),!this.state.currentPointer.isNull))return;if(!this.IncrementContentPointer()){let C=!1;this.state.callStack.CanPop(s.PushPopType.Function)?(this.state.PopCallStack(s.PushPopType.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new c.Void),C=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),C=!0):this.state.TryExitFunctionEvaluationFromGame(),C&&!this.state.currentPointer.isNull&&this.NextContent()}}IncrementContentPointer(){let m=!0,C=this.state.callStack.currentElement.currentPointer.copy();if(C.index++,C.container===null)return T.throwNullException("pointer.container");for(;C.index>=C.container.content.length;){m=!1;let _=I.asOrNull(C.container.parent,e.Container);if(!(_ instanceof e.Container))break;let P=_.content.indexOf(C.container);if(P==-1)break;if(C=new N.Pointer(_,P),C.index++,m=!0,C.container===null)return T.throwNullException("pointer.container")}return m||(C=N.Pointer.Null),this.state.callStack.currentElement.currentPointer=C.copy(),m}TryFollowDefaultInvisibleChoice(){let m=this._state.currentChoices,C=m.filter(P=>P.isInvisibleDefault);if(C.length==0||m.length>C.length)return!1;let _=C[0];return _.targetPath===null?T.throwNullException("choice.targetPath"):_.threadAtGeneration===null?T.throwNullException("choice.threadAtGeneration"):(this.state.callStack.currentThread=_.threadAtGeneration,this._stateSnapshotAtLastNewline!==null&&(this.state.callStack.currentThread=this.state.callStack.ForkThread()),this.ChoosePath(_.targetPath,!1),!0)}NextSequenceShuffleIndex(){let m=I.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(!(m instanceof h.IntValue))return this.Error("expected number of elements in sequence for shuffle index"),0;let C=this.state.currentPointer.container;if(C===null)return T.throwNullException("seqContainer");if(m.value===null)return T.throwNullException("numElementsIntVal.value");let _=m.value,x=I.asOrThrows(this.state.PopEvaluationStack(),h.IntValue).value;if(x===null)return T.throwNullException("seqCount");let F=x/_,O=x%_,A=C.path.toString(),W=0;for(let Z=0,Qe=A.length;Z<Qe;Z++)W+=A.charCodeAt(Z)||0;let U=W+F+this.state.storySeed,te=new v.PRNG(Math.floor(U)),Me=[];for(let Z=0;Z<_;++Z)Me.push(Z);for(let Z=0;Z<=O;++Z){let Qe=te.next()%Me.length,Xe=Me[Qe];if(Me.splice(Qe,1),Z==O)return Xe}throw new Error("Should never reach here")}Error(m,C=!1){let _=new f.StoryException(m);throw _.useEndLineNumber=C,_}Warning(m){this.AddError(m,!0)}AddError(m,C=!1,_=!1){let P=this.currentDebugMetadata,x=C?"WARNING":"ERROR";if(P!=null){let F=_?P.endLineNumber:P.startLineNumber;m="RUNTIME "+x+": '"+P.fileName+"' line "+F+": "+m}else this.state.currentPointer.isNull?m="RUNTIME "+x+": "+m:m="RUNTIME "+x+": ("+this.state.currentPointer+"): "+m;this.state.AddError(m,C),C||this.state.ForceEnd()}Assert(m,C=null){if(m==!1)throw C==null&&(C="Story assert"),new Error(C+" "+this.currentDebugMetadata)}get currentDebugMetadata(){let m,C=this.state.currentPointer;if(!C.isNull&&C.Resolve()!==null&&(m=C.Resolve().debugMetadata,m!==null))return m;for(let _=this.state.callStack.elements.length-1;_>=0;--_)if(C=this.state.callStack.elements[_].currentPointer,!C.isNull&&C.Resolve()!==null&&(m=C.Resolve().debugMetadata,m!==null))return m;for(let _=this.state.outputStream.length-1;_>=0;--_)if(m=this.state.outputStream[_].debugMetadata,m!==null)return m;return null}get mainContentContainer(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}t.Story=G,G.inkVersionCurrent=21,function(tt){(function(m){m[m.NoChange=0]="NoChange",m[m.ExtendedBeyondNewline=1]="ExtendedBeyondNewline",m[m.NewlineRemoved=2]="NewlineRemoved"})(tt.OutputStateChange||(tt.OutputStateChange={}))}(G=t.Story||(t.Story={}))})(Ts);Object.defineProperty(Fo,"__esModule",{value:!0});Fo.Story=void 0;const sE=jr,lE=Gr,ol=he,al=Fe,yi=po,ul=pt,sd=Ur,oE=Os,aE=Kr,uE=xs,hE=Ts,sr=Ut,cE=zt,fE=It,Ci=B,dE=Jn,pE=Qn,mE=Ht;class Mo extends ul.FlowBase{constructor(e,n=!1){super(null,e,null,!1,n);this._errorHandler=null,this._hadError=!1,this._hadWarning=!1,this._dontFlattenContainers=new Set,this._listDefs=new Map,this.constants=new Map,this.externals=new Map,this.countAllVisits=!1,this.ExportRuntime=(r=null)=>{var i,l;this._errorHandler=r,this.constants=new Map;for(const h of this.FindAll(lE.ConstantDeclaration)()){const p=this.constants.get(h.constantName);if(p&&!p.Equals(h.expression)){const c=`CONST '${h.constantName}' has been redefined with a different value. Multiple definitions of the same CONST are valid so long as they contain the same value. Initial definition was on ${p.debugMetadata}.`;this.Error(c,h,!1)}this.constants.set(h.constantName,h.expression)}this._listDefs=new Map;for(const h of this.FindAll(aE.ListDefinition)())((i=h.identifier)===null||i===void 0?void 0:i.name)&&this._listDefs.set((l=h.identifier)===null||l===void 0?void 0:l.name,h);this.externals=new Map,this.ResolveWeavePointNaming();const s=this.runtimeObject,o=new ol.Container;o.AddContent(al.ControlCommand.EvalStart());const a=[];for(const[h,p]of this.variableDeclarations)if(p.isGlobalDeclaration){if(p.listDefinition)this._listDefs.set(h,p.listDefinition),o.AddContent(p.listDefinition.runtimeObject),a.push(p.listDefinition.runtimeListDefinition);else{if(!p.expression)throw new Error;p.expression.GenerateIntoContainer(o)}const c=new fE.VariableAssignment(h,!0);c.isGlobal=!0,o.AddContent(c)}o.AddContent(al.ControlCommand.EvalEnd()),o.AddContent(al.ControlCommand.End()),this.variableDeclarations.size>0&&(o.name="global decl",s.AddToNamedContentOnly(o)),s.AddContent(al.ControlCommand.Done());const u=new hE.Story(s,a);return this.runtimeObject=u,this.hadError||(this.FlattenContainersIn(s),this.ResolveReferences(this),this.hadError)?null:(u.ResetState(),u)},this.ResolveList=r=>{let i=this._listDefs.get(r);return i||null},this.ResolveListItem=(r,i,l=null)=>{let s=null;if(r)return(s=this._listDefs.get(r))?s.ItemNamed(i):null;{let o=null,a=null;for(const[,u]of this._listDefs.entries()){const h=u.ItemNamed(i);h&&(o?this.Error(`Ambiguous item name '${i}' found in multiple sets, including ${a.identifier} and ${u.identifier}`,l,!1):(o=h,a=u))}return o}},this.FlattenContainersIn=r=>{const i=new Set;if(r.content)for(const l of r.content){const s=Ci.asOrNull(l,ol.Container);s&&i.add(s)}if(r.namedContent)for(const[,l]of r.namedContent){const s=Ci.asOrNull(l,ol.Container);s&&i.add(s)}for(const l of i)this.TryFlattenContainer(l),this.FlattenContainersIn(l)},this.TryFlattenContainer=r=>{if(r.namedContent&&r.namedContent.size>0||r.hasValidName||this._dontFlattenContainers.has(r))return;const i=Ci.asOrNull(r.parent,ol.Container);if(i){let l=i.content.indexOf(r);i.content.splice(l,1);const s=r.ownDebugMetadata;if(r.content)for(const o of r.content)o.parent=null,s!==null&&o.ownDebugMetadata===null&&(o.debugMetadata=s),i.InsertContent(o,l),l+=1}},this.Error=(r,i,l)=>{let s=l?yi.ErrorType.Warning:yi.ErrorType.Error,o="";if(i instanceof sE.AuthorWarning?(o+="TODO: ",s=yi.ErrorType.Author):l?o+="WARNING: ":o+="ERROR: ",i&&i.debugMetadata!==null&&i.debugMetadata.startLineNumber>=1&&(i.debugMetadata.fileName!=null&&(o+=`'${i.debugMetadata.fileName}' `),o+=`line ${i.debugMetadata.startLineNumber}: `),o+=r,r=o,this._errorHandler!==null)this._errorHandler(r,s);else throw new Error(r);this._hadError=s===yi.ErrorType.Error,this._hadWarning=s===yi.ErrorType.Warning},this.ResetError=()=>{this._hadError=!1,this._hadWarning=!1},this.IsExternal=r=>this.externals.has(r),this.AddExternal=r=>{this.externals.has(r.name)?this.Error(`Duplicate EXTERNAL definition of '${r.name}'`,r,!1):r.name&&this.externals.set(r.name,r)},this.DontFlattenContainer=r=>{this._dontFlattenContainers.add(r)},this.NameConflictError=(r,i,l,s)=>{r.Error(`${s} '${i}': name has already been used for a ${l.typeName.toLowerCase()} on ${l.debugMetadata}`)},this.CheckForNamingCollisions=(r,i,l,s="")=>{var o;const a=s||r.typeName;if(Mo.IsReservedKeyword(i==null?void 0:i.name)){r.Error(`'${i}' cannot be used for the name of a ${a.toLowerCase()} because it's a reserved keyword`);return}else if(pE.FunctionCall.IsBuiltIn((i==null?void 0:i.name)||"")){r.Error(`'${i}' cannot be used for the name of a ${a.toLowerCase()} because it's a built in function`);return}const u=this.ContentWithNameAtLevel((i==null?void 0:i.name)||"",sd.FlowLevel.Knot),h=Ci.asOrNull(u,ul.FlowBase);if(h&&(h!==r||l===sr.SymbolType.Arg)){this.NameConflictError(r,(i==null?void 0:i.name)||"",h,a);return}if(l<sr.SymbolType.List)return;for(const[S,E]of this._listDefs)if((i==null?void 0:i.name)===S&&r!==E&&E.variableAssignment!==r&&this.NameConflictError(r,i==null?void 0:i.name,E,a),!(r instanceof uE.ListElementDefinition))for(const d of E.itemDefinitions)(i==null?void 0:i.name)===d.name&&this.NameConflictError(r,(i==null?void 0:i.name)||"",d,a);if(l<=sr.SymbolType.Var)return;const p=(i==null?void 0:i.name)&&this.variableDeclarations.get(i==null?void 0:i.name)||null;if(p&&p!==r&&p.isGlobalDeclaration&&p.listDefinition==null&&this.NameConflictError(r,(i==null?void 0:i.name)||"",p,a),l<sr.SymbolType.SubFlowAndWeave)return;const g=new mE.Path(i).ResolveFromContext(r);if(g&&g!==r){this.NameConflictError(r,(i==null?void 0:i.name)||"",g,a);return}if(!(l<sr.SymbolType.Arg)&&l!==sr.SymbolType.Arg){let S=Ci.asOrNull(r,ul.FlowBase);if(S||(S=dE.ClosestFlowBase(r)),S&&S.hasParameters&&S.args){for(const E of S.args)if(((o=E.identifier)===null||o===void 0?void 0:o.name)===(i==null?void 0:i.name)){r.Error(`${a} '${i}': name has already been used for a argument to ${S.identifier} on ${S.debugMetadata}`);return}}}}}get flowLevel(){return sd.FlowLevel.Story}get hadError(){return this._hadError}get hadWarning(){return this._hadWarning}get typeName(){return"Story"}PreProcessTopLevelObjects(e){super.PreProcessTopLevelObjects(e);const n=[];for(let r of e)if(r instanceof oE.IncludedFile){const i=r,l=e.indexOf(r);if(e.splice(l,1),i.includedStory){const s=[],o=i.includedStory;if(o.content!=null){for(const a of o.content)a instanceof ul.FlowBase?n.push(a):s.push(a);s.push(new cE.Text(`
`)),e.splice(l,0,...s)}}continue}e.splice(0,0,...n)}}Fo.Story=Mo;Mo.IsReservedKeyword=t=>{switch(t){case"true":case"false":case"not":case"return":case"else":case"VAR":case"CONST":case"temp":case"LIST":case"function":return!0}return!1};var $o={};Object.defineProperty($o,"__esModule",{value:!0});$o.StringExpression=void 0;const ld=Fe,gE=He,vE=zt,yE=B;class Mh extends gE.Expression{constructor(e){super();this.GenerateIntoContainer=n=>{n.AddContent(ld.ControlCommand.BeginString());for(const r of this.content)n.AddContent(r.runtimeObject);n.AddContent(ld.ControlCommand.EndString())},this.toString=()=>{let n="";for(const r of this.content)n+=r;return n},this.AddContent(e)}get isSingleString(){return!(this.content.length!==1||!(this.content[0]instanceof vE.Text))}get typeName(){return"String"}Equals(e){const n=yE.asOrNull(e,Mh);if(n===null||!this.isSingleString||!n.isSingleString)return!1;const r=this.toString(),i=n.toString();return r===i}}$o.StringExpression=Mh;var kr={};Object.defineProperty(kr,"__esModule",{value:!0});kr.LegacyTag=kr.Tag=void 0;const CE=Q,od=Fe;class SE extends CE.ParsedObject{constructor(e,n=!1){super();this.GenerateRuntimeObject=()=>this.isStart?od.ControlCommand.BeginTag():od.ControlCommand.EndTag(),this.toString=()=>this.isStart?"#StartTag":"#EndTag",this.isStart=e,this.inChoice=n}get typeName(){return"Tag"}}kr.Tag=SE;const wE=Ps;class _E extends wE.Wrap{constructor(e){super(e)}get typeName(){return"Tag"}}kr.LegacyTag=_E;var Bo={};Object.defineProperty(Bo,"__esModule",{value:!0});Bo.DefaultFileHandler=void 0;class EE{constructor(e){this.rootPath=e,this.ResolveInkFilename=()=>{throw Error("Can't resolve filename because no FileHandler was provided when instantiating the parser / compiler.")},this.LoadInkFileContents=()=>{throw Error("Can't load ink content because no FileHandler was provided when instantiating the parser / compiler.")}}}Bo.DefaultFileHandler=EE;Object.defineProperty(mo,"__esModule",{value:!0});mo.InkParser=void 0;const PE=go,OE=jr,xE=ps,Kt=yo,Te=Un,TE=zn,NE=Co,bE=Br,Si=vs,Ge=Hr,IE=Gr,hl=Em,kE=Po,Nn=Kn,Wa=En,AE=He,FE=Oo,ad=xo,cl=Qn,RE=zr,DE=To,LE=Jr,fl=No,ud=Os,VE=bo,WE=Io,hd=ko,jE=Kr,ME=xs,$E=Cs,cd=Q,BE=Ht,fd=ys,dd=Ss,Ce=Dh,Ve=Pm,GE=Ao,pd=Fo,wi=$o,Ft=Fh,lr=kr,Rt=zt,md=ws,ja=_s,Ma=Pn,UE=gs,Zt=B,_i=qr,or=Mr,gd=po,zE=Bo;class re extends Ft.StringParser{constructor(e,n=null,r=null,i=null,l=null){super(e);if(this.ParseStory=()=>{const s=this.StatementsAtLevel(Ve.StatementLevel.Top);return new pd.Story(s,this._rootParser!==this)},this.SeparatedList=(s,o)=>{const a=this.Parse(s);if(a===null)return null;const u=[];u.push(a);do{const h=this.BeginRule();if(o()===null){this.FailRule(h);break}const c=this.Parse(s);if(c===null){this.FailRule(h);break}this.SucceedRule(h),u.push(c)}while(!0);return u},this.CreateDebugMetadata=(s,o)=>{const a=new kE.DebugMetadata;return a.startLineNumber=((s==null?void 0:s.lineIndex)||0)+1,a.endLineNumber=o.lineIndex+1,a.startCharacterNumber=((s==null?void 0:s.characterInLineIndex)||0)+1,a.endCharacterNumber=o.characterInLineIndex+1,a.fileName=this._filename,a},this.RuleDidSucceed=(s,o,a)=>{const u=Zt.asOrNull(s,cd.ParsedObject);u&&(u.debugMetadata=this.CreateDebugMetadata(o,a));const h=Array.isArray(s)?s:null;if(h!==null)for(const c of h)!Zt.asOrNull(c,cd.ParsedObject)||c.hasOwnDebugMetadata||(c.debugMetadata=this.CreateDebugMetadata(o,a));const p=Zt.asOrNull(s,_i.Identifier);p!=null&&(p.debugMetadata=this.CreateDebugMetadata(o,a))},this.OnStringParserError=(s,o,a=0,u=!1)=>{let p=u?"WARNING:":"ERROR:";if(this._filename!==null&&(p+=` '${this._filename}'`),p+=` line ${a+1}: ${s}`,this._externalErrorHandler!==null)this._externalErrorHandler(p,u?gd.ErrorType.Warning:gd.ErrorType.Error);else throw new Error(p)},this.AuthorWarning=()=>{this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);if(s===null||s.name!=="TODO")return null;this.Whitespace(),this.ParseString(":"),this.Whitespace();const o=this.ParseUntilCharactersFromString(`
\r`);return o?new OE.AuthorWarning(o):null},this.ExtendIdentifierCharacterRanges=s=>{const o=re.ListAllCharacterRanges();for(const a of o)s.AddCharacters(a.ToCharacterSet())},this._parsingChoice=!1,this.Choice=()=>{let s=!0,o=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("*"));if(!o){if(o=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("+")),o===null)return null;s=!1}const a=this.Parse(this.BracketedName);this.Whitespace();const u=this.Parse(this.ChoiceCondition);if(this.Whitespace(),this._parsingChoice)throw new Error("Already parsing a choice - shouldn't have nested choices");this._parsingChoice=!0;let h=null;const p=this.Parse(this.MixedTextAndLogic);p&&(h=new Ge.ContentList(p));let c=null,g=null;const S=this.ParseString("[")!==null;if(S){this.EndTagIfNecessary(h);const v=this.Parse(this.MixedTextAndLogic);v!==null&&(c=new Ge.ContentList(v)),this.Expect(this.String("]"),"closing ']' for weave-style option"),this.EndTagIfNecessary(c);let y=this.Parse(this.MixedTextAndLogic);y!==null&&(g=new Ge.ContentList(y))}this.Whitespace(),this.EndTagIfNecessary(g!=null?g:h);const E=this.Parse(this.MultiDivert);this._parsingChoice=!1,this.Whitespace();const d=!h&&!g&&!c;if(d&&E===null&&this.Warning("Choice is completely empty. Interpretting as a default fallback choice. Add a divert arrow to remove this warning: * ->"),!h&&S&&!c&&this.Warning("Blank choice - if you intended a default fallback choice, use the `* ->` syntax"),g||(g=new Ge.ContentList),this.EndTagIfNecessary(g),E!==null)for(const v of E){const y=Zt.asOrNull(v,Nn.Divert);y&&y.isEmpty||g.AddContent(v)}g.AddContent(new Rt.Text(`
`));const f=new TE.Choice(h,c,g);return a&&(f.identifier=a),f.indentationDepth=o.length,f.hasWeaveStyleInlineBrackets=S,f.condition=u,f.onceOnly=s,f.isInvisibleDefault=d,f},this.ChoiceCondition=()=>{const s=this.Interleave(this.ChoiceSingleCondition,this.ChoiceConditionsSpace);return s===null?null:s.length===1?s[0]:new $E.MultipleConditionExpression(s)},this.ChoiceConditionsSpace=()=>(this.Newline(),this.Whitespace(),Ft.ParseSuccess),this.ChoiceSingleCondition=()=>{if(this.ParseString("{")===null)return null;const s=this.Expect(this.Expression,"choice condition inside { }");return this.DisallowIncrement(s),this.Expect(this.String("}"),"closing '}' for choice condition"),s},this.Gather=()=>{const s=this.Parse(this.GatherDashes);if(s===null)return null;const o=Number(s),a=this.Parse(this.BracketedName),u=new RE.Gather(a,o);return this.Newline(),u},this.GatherDashes=()=>{this.Whitespace();let s=0;for(;this.ParseDashNotArrow()!==null;)s+=1,this.Whitespace();return s===0?null:s},this.ParseDashNotArrow=()=>{const s=this.BeginRule();return this.ParseString("->")===null&&this.ParseSingleCharacter()==="-"?this.SucceedRule(s):this.FailRule(s)},this.BracketedName=()=>{if(this.ParseString("(")===null)return null;this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);return s===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing ')' for bracketed name"),s)},this.InnerConditionalContent=s=>{if(s===void 0){const p=this.Parse(this.ConditionExpression),c=this.Parse(()=>this.InnerConditionalContent(p));return c===null?null:c}let o;const a=s!==null,u=this.Parse(this.Newline)===null;if(u&&!a)return null;if(u)o=this.InlineConditionalBranches();else{if(o=this.MultilineConditionalBranches(),o===null){if(s){let p=this.StatementsAtLevel(Ve.StatementLevel.InnerBlock);if(p!==null){o=[new Si.ConditionalSingleBranch(p)];const g=this.Parse(this.SingleMultilineCondition);g&&(g.isElse||(this.ErrorWithParsedObject("Expected an '- else:' clause here rather than an extra condition",g),g.isElse=!0),o.push(g))}}if(o===null)return null}else if(o.length===1&&o[0].isElse&&s){const p=new Si.ConditionalSingleBranch(null);p.isTrueBranch=!0,o.unshift(p)}if(s){let p=!1;for(let c=0;c<o.length;++c){const g=o[c],S=c===o.length-1;g.ownExpression?(g.matchingEquality=!0,p=!0):p&&S?(g.matchingEquality=!0,g.isElse=!0):!S&&o.length>2?this.ErrorWithParsedObject("Only final branch can be an 'else'. Did you miss a ':'?",g):c===0?g.isTrueBranch=!0:g.isElse=!0}}else{for(let p=0;p<o.length;++p){const c=o[p],g=p===o.length-1;if(c.ownExpression===null)if(g)c.isElse=!0;else if(c.isElse){const S=o[o.length-1];S.isElse?this.ErrorWithParsedObject("Multiple 'else' cases. Can have a maximum of one, at the end.",S):this.ErrorWithParsedObject("'else' case in conditional should always be the final one",c)}else this.ErrorWithParsedObject("Branch doesn't have condition. Are you missing a ':'? ",c)}o.length===1&&o[0].ownExpression===null&&this.ErrorWithParsedObject("Condition block with no conditions",o[0])}}if(o===null)return null;for(const p of o)p.isInline=u;return new bE.Conditional(s,o)},this.InlineConditionalBranches=()=>{const s=this.Interleave(this.MixedTextAndLogic,this.Exclude(this.String("|")),null,!1);if(s===null||s.length===0)return null;const o=[];if(s.length>2)this.Error("Expected one or two alternatives separated by '|' in inline conditional");else{const a=new Si.ConditionalSingleBranch(s[0]);if(a.isTrueBranch=!0,o.push(a),s.length>1){const u=new Si.ConditionalSingleBranch(s[1]);u.isElse=!0,o.push(u)}}return o},this.MultilineConditionalBranches=()=>{this.MultilineWhitespace();const s=this.OneOrMore(this.SingleMultilineCondition);return s===null?null:(this.MultilineWhitespace(),s)},this.SingleMultilineCondition=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();let s=null;const o=this.Parse(this.ElseExpression)!==null;o||(s=this.Parse(this.ConditionExpression));let a=this.StatementsAtLevel(Ve.StatementLevel.InnerBlock);s===null&&a===null&&(this.Error("expected content for the conditional branch following '-'"),a=[new Rt.Text("")]),this.MultilineWhitespace();const u=new Si.ConditionalSingleBranch(a);return u.ownExpression=s,u.isElse=o,u},this.ConditionExpression=()=>{const s=this.Parse(this.Expression);return s===null||(this.DisallowIncrement(s),this.Whitespace(),this.ParseString(":")===null)?null:s},this.ElseExpression=()=>this.ParseString("else")===null||(this.Whitespace(),this.ParseString(":")===null)?null:Ft.ParseSuccess,this._nonTextPauseCharacters=null,this._nonTextEndCharacters=null,this._notTextEndCharactersChoice=null,this._notTextEndCharactersString=null,this.TrimEndWhitespace=(s,o)=>{if(s.length>0){const a=s.length-1,u=s[a];if(u instanceof Rt.Text){const h=u;h.text=h.text.replace(new RegExp(/[ \t]+$/g),""),o?h.text+=" ":h.text.length===0&&(s.splice(a,1),this.TrimEndWhitespace(s,!1))}}},this.LineOfMixedTextAndLogic=()=>{this.Parse(this.Whitespace);let s=this.Parse(this.MixedTextAndLogic);if(!s||!s.length)return null;const o=s[0];return o&&o.text&&o.text.startsWith("return")&&this.Warning("Do you need a '~' before 'return'? If not, perhaps use a glue: <> (since it's lowercase) or rewrite somehow?"),s.length===0?null:(s[s.length-1]instanceof Nn.Divert||this.TrimEndWhitespace(s,!1),this.EndTagIfNecessary(s),s.length>0&&s[0]instanceof lr.Tag&&s[0].isStart||s.push(new Rt.Text(`
`)),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),s)},this.MixedTextAndLogic=()=>{this.ParseObject(this.Spaced(this.String("~")))!==null&&this.Error("You shouldn't use a '~' here - tildas are for logic that's on its own line. To do inline logic, use { curly braces } instead");let o=this.Interleave(this.Optional(this.ContentText),this.Optional(this.InlineLogicOrGlueOrStartTag));if(!this._parsingChoice){const a=this.Parse(this.MultiDivert);a!==null&&(o===null&&(o=[]),this.EndTagIfNecessary(o),this.TrimEndWhitespace(o,!0),o.push(...a))}return o||null},this.ContentText=()=>this.ContentTextAllowingEscapeChar(),this.ContentTextAllowingEscapeChar=()=>{let s=null;do{let o=this.Parse(this.ContentTextNoEscape);const a=this.ParseString("\\")!==null;if(a||o!==null)s===null&&(s=""),o!==null&&(s+=String(o)),a&&(s+=this.ParseSingleCharacter());else break}while(!0);return s!==null?new Rt.Text(s):null},this.ContentTextNoEscape=()=>{this._nonTextPauseCharacters===null&&(this._nonTextPauseCharacters=new Te.CharacterSet("-<")),this._nonTextEndCharacters===null&&(this._nonTextEndCharacters=new Te.CharacterSet(`{}|
\r\\#`),this._notTextEndCharactersChoice=new Te.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersChoice.AddCharacters("[]"),this._notTextEndCharactersString=new Te.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersString.AddCharacters('"'));const s=()=>this.OneOf([this.ParseDivertArrow,this.ParseThreadArrow,this.EndOfLine,this.Glue]);let o=null;this.parsingStringExpression?o=this._notTextEndCharactersString:this._parsingChoice?o=this._notTextEndCharactersChoice:o=this._nonTextEndCharacters;const a=this.ParseUntil(s,this._nonTextPauseCharacters,o);return a!==null?a:null},this.MultiDivert=()=>{this.Whitespace();let s=[];const o=this.Parse(this.StartThread);if(o)return s=[o],s;const a=this.Interleave(this.ParseDivertArrowOrTunnelOnwards,this.DivertIdentifierWithArguments);if(!a)return null;s=[],this.EndTagIfNecessary(s);for(let u=0;u<a.length;++u)if(u%2===0){if(a[u]==="->->"){u===0||u===a.length-1||u===a.length-2||this.Error("Tunnel onwards '->->' must only come at the begining or the start of a divert");const c=new md.TunnelOnwards;if(u<a.length-1){const g=Zt.asOrNull(a[u+1],Nn.Divert);c.divertAfter=g}s.push(c);break}}else{const p=a[u];u<a.length-1&&(p.isTunnel=!0),s.push(p)}if(s.length===0&&a.length===1){const u=new Nn.Divert(null);u.isEmpty=!0,s.push(u),this._parsingChoice||this.Error("Empty diverts (->) are only valid on choices")}return s},this.StartThread=()=>{if(this.Whitespace(),this.ParseThreadArrow()===null)return null;this.Whitespace();const s=this.Expect(this.DivertIdentifierWithArguments,"target for new thread",()=>new Nn.Divert(null));return s.isThread=!0,s},this.DivertIdentifierWithArguments=()=>{this.Whitespace();const s=this.Parse(this.DotSeparatedDivertPathComponents);if(!s)return null;this.Whitespace();const o=this.Parse(this.ExpressionFunctionCallArguments);this.Whitespace();const a=new BE.Path(s);return new Nn.Divert(a,o)},this.SingleDivert=()=>{const s=this.Parse(this.MultiDivert);if(!s||s.length!==1||s[0]instanceof md.TunnelOnwards)return null;const a=s[0];return a.isTunnel?null:a},this.DotSeparatedDivertPathComponents=()=>this.Interleave(this.Spaced(this.IdentifierWithMetadata),this.Exclude(this.String("."))),this.ParseDivertArrowOrTunnelOnwards=()=>{let s=0;for(;this.ParseString("->")!==null;)s+=1;return s===0?null:s===1?"->":(s===2||this.Error("Unexpected number of arrows in divert. Should only have '->' or '->->'"),"->->")},this.ParseDivertArrow=()=>this.ParseString("->"),this.ParseThreadArrow=()=>this.ParseString("<-"),this._binaryOperators=[],this._maxBinaryOpLength=0,this.TempDeclarationOrAssignment=()=>{this.Whitespace();const s=this.ParseTempKeyword();this.Whitespace();let o=null;if(s?o=this.Expect(this.IdentifierWithMetadata,"variable name"):o=this.Parse(this.IdentifierWithMetadata),o===null)return null;this.Whitespace();const a=this.ParseString("+")!==null,u=this.ParseString("-")!==null;if(a&&u&&this.Error("Unexpected sequence '+-'"),this.ParseString("=")===null)return s&&this.Error("Expected '='"),null;const h=this.Expect(this.Expression,"value expression to be assigned");return a||u?new fl.IncDecExpression(o,h,a):new ja.VariableAssignment({variableIdentifier:o,assignedExpression:h,isTemporaryNewDeclaration:s})},this.DisallowIncrement=s=>{s instanceof fl.IncDecExpression&&this.Error("Can't use increment/decrement here. It can only be used on a ~ line")},this.ParseTempKeyword=()=>{const s=this.BeginRule();return this.Parse(this.Identifier)==="temp"?(this.SucceedRule(s),!0):(this.FailRule(s),!1)},this.ReturnStatement=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="return")return null;this.Whitespace();const o=this.Parse(this.Expression);return new fd.ReturnType(o)},this.Expression=(s=0)=>{this.Whitespace();let o=this.ExpressionUnary();if(o===null)return null;for(this.Whitespace();;){const a=this.BeginRule(),u=this.ParseInfixOperator();if(u!==null&&u.precedence>s){const h=`right side of '${u.type}' expression`,p=this.Expect(()=>this.ExpressionInfixRight(o,u),h);if(p===null)return this.FailRule(a),null;o=this.SucceedRule(a,p);continue}this.FailRule(a);break}return this.Whitespace(),o},this.ExpressionUnary=()=>{const s=this.Parse(this.ExpressionDivertTarget);if(s!==null)return s;let o=this.OneOf([this.String("-"),this.String("!")]);o===null&&(o=this.Parse(this.ExpressionNot)),this.Whitespace();let a=this.OneOf([this.ExpressionList,this.ExpressionParen,this.ExpressionFunctionCall,this.ExpressionVariableName,this.ExpressionLiteral]);if(a===null&&o!==null&&(a=this.ExpressionUnary()),a===null)return null;o!==null&&(a=UE.UnaryExpression.WithInner(a,o)),this.Whitespace();const u=this.OneOf([this.String("++"),this.String("--")]);if(u!==null){const h=u==="++";if(!(a instanceof Ma.VariableReference))this.Error(`can only increment and decrement variables, but saw '${a}'.`);else{const p=a;a=new fl.IncDecExpression(p.identifier,h)}}return a},this.ExpressionNot=()=>{const s=this.Identifier();return s==="not"?s:null},this.ExpressionLiteral=()=>this.OneOf([this.ExpressionFloat,this.ExpressionInt,this.ExpressionBool,this.ExpressionString]),this.ExpressionDivertTarget=()=>{this.Whitespace();const s=this.Parse(this.SingleDivert);return!s||s&&s.isThread?null:(this.Whitespace(),new Wa.DivertTarget(s))},this.ExpressionInt=()=>{const s=this.ParseInt();return s===null?null:new or.NumberExpression(s,"int")},this.ExpressionFloat=()=>{const s=this.ParseFloat();return s===null?null:new or.NumberExpression(s,"float")},this.ExpressionString=()=>{if(this.ParseString('"')===null)return null;this.parsingStringExpression=!0;let o=this.Parse(this.MixedTextAndLogic);return this.Expect(this.String('"'),"close quote for string expression"),this.parsingStringExpression=!1,o===null?o=[new Rt.Text("")]:o.find(a=>a instanceof Nn.Divert)&&this.Error("String expressions cannot contain diverts (->)"),new wi.StringExpression(o)},this.ExpressionBool=()=>{const s=this.Parse(this.Identifier);return s==="true"?new or.NumberExpression(!0,"bool"):s==="false"?new or.NumberExpression(!1,"bool"):null},this.ExpressionFunctionCall=()=>{const s=this.Parse(this.IdentifierWithMetadata);if(s===null)return null;this.Whitespace();const o=this.Parse(this.ExpressionFunctionCallArguments);return o===null?null:new cl.FunctionCall(s,o)},this.ExpressionFunctionCallArguments=()=>{if(this.ParseString("(")===null)return null;const s=this.Exclude(this.String(","));let o=this.Interleave(this.Expression,s);return o===null&&(o=[]),this.Whitespace(),this.Expect(this.String(")"),"closing ')' for function call"),o},this.ExpressionVariableName=()=>{const s=this.Interleave(this.IdentifierWithMetadata,this.Exclude(this.Spaced(this.String("."))));return s===null||pd.Story.IsReservedKeyword(s[0].name)?null:new Ma.VariableReference(s)},this.ExpressionParen=()=>{if(this.ParseString("(")===null)return null;const s=this.Parse(this.Expression);return s===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing parenthesis ')' for expression"),s)},this.ExpressionInfixRight=(s,o)=>{if(!s)return null;this.Whitespace();const a=this.Parse(()=>this.Expression(o.precedence));return a?new xE.BinaryExpression(s,a,o.type):null},this.ParseInfixOperator=()=>{for(const s of this._binaryOperators){const o=this.BeginRule();if(this.ParseString(s.type)!==null){if(s.requireWhitespace&&this.Whitespace()===null){this.FailRule(o);continue}return this.SucceedRule(o,s)}this.FailRule(o)}return null},this.ExpressionList=()=>{if(this.Whitespace(),this.ParseString("(")===null)return null;this.Whitespace();const s=this.SeparatedList(this.ListMember,this.Spaced(this.String(",")));return this.Whitespace(),this.ParseString(")")===null?null:new hd.List(s)},this.ListMember=()=>{this.Whitespace();let s=this.Parse(this.IdentifierWithMetadata);if(s===null)return null;if(this.ParseString(".")!==null){const a=this.Expect(this.IdentifierWithMetadata,`element name within the set ${s}`);s.name+=`.${a==null?void 0:a.name}`}return this.Whitespace(),s},this.RegisterExpressionOperators=()=>{this.RegisterBinaryOperator("&&",1),this.RegisterBinaryOperator("||",1),this.RegisterBinaryOperator("and",1,!0),this.RegisterBinaryOperator("or",1,!0),this.RegisterBinaryOperator("==",2),this.RegisterBinaryOperator(">=",2),this.RegisterBinaryOperator("<=",2),this.RegisterBinaryOperator("<",2),this.RegisterBinaryOperator(">",2),this.RegisterBinaryOperator("!=",2),this.RegisterBinaryOperator("?",3),this.RegisterBinaryOperator("has",3,!0),this.RegisterBinaryOperator("!?",3),this.RegisterBinaryOperator("hasnt",3,!0),this.RegisterBinaryOperator("^",3),this.RegisterBinaryOperator("+",4),this.RegisterBinaryOperator("-",5),this.RegisterBinaryOperator("*",6),this.RegisterBinaryOperator("/",7),this.RegisterBinaryOperator("%",8),this.RegisterBinaryOperator("mod",8,!0)},this.RegisterBinaryOperator=(s,o,a=!1)=>{const u=new VE.InfixOperator(s,o,a);this._binaryOperators.push(u),this._maxBinaryOpLength=Math.max(this._maxBinaryOpLength,s.length)},this._openFilenames=[],this.IncludeStatement=()=>{if(this.Whitespace(),this.ParseString("INCLUDE")===null)return null;this.Whitespace();let s=this.Expect(()=>this.ParseUntilCharactersFromString(`
\r`),"filename for include statement");s=s.replace(new RegExp(/[ \t]+$/g),"");const o=this.fileHandler.ResolveInkFilename(s);if(this.FilenameIsAlreadyOpen(o))return this.Error(`Recursive INCLUDE detected: '${o}' is already open.`),this.ParseUntilCharactersFromString(`\r
`),new ud.IncludedFile(null);this.AddOpenFilename(o);let a=null,u="";try{u=this._rootParser.fileHandler.LoadInkFileContents(o)}catch(h){this.Error(`Failed to load: '${s}'.
Error:${h}`)}return u&&(a=new re(u,s,this._externalErrorHandler,this._rootParser,this.fileHandler).ParseStory()),this.RemoveOpenFilename(o),new ud.IncludedFile(a)},this.FilenameIsAlreadyOpen=s=>this._rootParser._openFilenames.includes(s),this.AddOpenFilename=s=>{this._rootParser._openFilenames.push(s)},this.RemoveOpenFilename=s=>{this._rootParser._openFilenames.splice(this._rootParser._openFilenames.indexOf(s),1)},this.KnotDefinition=()=>{const s=this.Parse(this.KnotDeclaration);if(s===null)return null;this.Expect(this.EndOfLine,"end of line after knot name definition",this.SkipToNextLine);const o=()=>this.StatementsAtLevel(Ve.StatementLevel.Knot),a=this.Expect(o,"at least one line within the knot",this.KnotStitchNoContentRecoveryRule);return new WE.Knot(s.name,a,s.args,s.isFunction)},this.KnotDeclaration=()=>{if(this.Whitespace(),this.KnotTitleEquals()===null)return null;this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);let o;const a=(s==null?void 0:s.name)==="function";a?(this.Expect(this.Whitespace,"whitespace after the 'function' keyword"),o=this.Parse(this.IdentifierWithMetadata)):o=s,o===null&&(this.Error(`Expected the name of the ${a?"function":"knot"}`),o=new _i.Identifier("")),this.Whitespace();const u=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),this.Parse(this.KnotTitleEquals),new ad.FlowDecl(o,u,a)},this.KnotTitleEquals=()=>{const s=this.ParseCharactersFromString("=");return s===null||s.length<=1?null:s},this.StitchDefinition=()=>{const s=this.Parse(this.StitchDeclaration);if(s===null)return null;this.Expect(this.EndOfLine,"end of line after stitch name",this.SkipToNextLine);const o=()=>this.StatementsAtLevel(Ve.StatementLevel.Stitch),a=this.Expect(o,"at least one line within the stitch",this.KnotStitchNoContentRecoveryRule);return new GE.Stitch(s.name,a,s.args,s.isFunction)},this.StitchDeclaration=()=>{if(this.Whitespace(),this.ParseString("=")===null||this.ParseString("=")!==null)return null;this.Whitespace();const s=this.ParseString("function")!==null;s&&this.Whitespace();const o=this.Parse(this.IdentifierWithMetadata);if(o===null)return null;this.Whitespace();const a=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),new ad.FlowDecl(o,a,s)},this.KnotStitchNoContentRecoveryRule=()=>(this.ParseUntil(this.KnotDeclaration,new Te.CharacterSet("="),null),[new Rt.Text("<ERROR IN FLOW>")]),this.BracketedKnotDeclArguments=()=>{if(this.ParseString("(")===null)return null;let s=this.Interleave(this.Spaced(this.FlowDeclArgument),this.Exclude(this.String(",")));return this.Expect(this.String(")"),"closing ')' for parameter list"),s===null&&(s=[]),s},this.FlowDeclArgument=()=>{const s=this.Parse(this.IdentifierWithMetadata);this.Whitespace();const o=this.ParseDivertArrow();this.Whitespace();const a=this.Parse(this.IdentifierWithMetadata);if(s==null&&a===null)return null;const u=new PE.Argument;return o!==null&&(u.isDivertTarget=!0),s!==null&&s.name==="ref"?(a===null&&this.Error("Expected an parameter name after 'ref'"),u.identifier=a,u.isByReference=!0):(u.isDivertTarget?u.identifier=a:u.identifier=s,u.identifier===null&&this.Error("Expected an parameter name"),u.isByReference=!1),u},this.ExternalDeclaration=()=>{this.Whitespace();const s=this.Parse(this.IdentifierWithMetadata);if(s===null||s.name!="EXTERNAL")return null;this.Whitespace();const o=this.Expect(this.IdentifierWithMetadata,"name of external function")||new _i.Identifier("");this.Whitespace();let a=this.Expect(this.BracketedKnotDeclArguments,`declaration of arguments for EXTERNAL, even if empty, i.e. 'EXTERNAL ${o}()'`);a===null&&(a=[]);const u=a.map(h=>{var p;return(p=h.identifier)===null||p===void 0?void 0:p.name}).filter(Zt.filterUndef);return new FE.ExternalDeclaration(o,u)},this._identifierCharSet=null,this.LogicLine=()=>{if(this.Whitespace(),this.ParseString("~")===null)return null;this.Whitespace();const s=()=>this.OneOf([this.ReturnStatement,this.TempDeclarationOrAssignment,this.Expression]);let o=this.Expect(s,"expression after '~'",this.SkipToNextLine);if(o===null)return new Ge.ContentList;o instanceof AE.Expression&&!(o instanceof cl.FunctionCall||o instanceof fl.IncDecExpression)&&this.Error(`Logic following a '~' can't be that type of expression. It can only be something like:
	~ return
	~ var x = blah
	~ x++
	~ myFunction()`);const a=Zt.asOrNull(o,cl.FunctionCall);return a&&(a.shouldPopReturnedValue=!0),o.Find(cl.FunctionCall)()!==null&&(o=new Ge.ContentList(o,new Rt.Text(`
`))),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),o},this.VariableDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="VAR")return null;this.Whitespace();const o=this.Expect(this.IdentifierWithMetadata,"variable name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const u=this.Expect(this.Expression,"initial value for ");return u?(u instanceof or.NumberExpression||u instanceof wi.StringExpression||u instanceof Wa.DivertTarget||u instanceof Ma.VariableReference||u instanceof hd.List||this.Error("initial value for a variable must be a number, constant, list or divert target"),this.Parse(this.ListElementDefinitionSeparator)!==null?this.Error("Unexpected ','. If you're trying to declare a new list, use the LIST keyword, not VAR"):u instanceof wi.StringExpression&&(u.isSingleString||this.Error("Constant strings cannot contain any logic.")),new ja.VariableAssignment({assignedExpression:u,isGlobalDeclaration:!0,variableIdentifier:o})):null},this.ListDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!="LIST")return null;this.Whitespace();const o=this.Expect(this.IdentifierWithMetadata,"list name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of the list definition"),this.Whitespace();const a=this.Expect(this.ListDefinition,"list item names");return a?(a.identifier=new _i.Identifier(o.name),new ja.VariableAssignment({variableIdentifier:o,listDef:a})):null},this.ListDefinition=()=>{this.AnyWhitespace();const s=this.SeparatedList(this.ListElementDefinition,this.ListElementDefinitionSeparator);return s===null?null:new jE.ListDefinition(s)},this.ListElementDefinitionSeparator=()=>(this.AnyWhitespace(),this.ParseString(",")===null?null:(this.AnyWhitespace(),",")),this.ListElementDefinition=()=>{const s=this.ParseString("(")!==null;let o=s;this.Whitespace();const a=this.Parse(this.IdentifierWithMetadata);if(a===null)return null;this.Whitespace(),s&&this.ParseString(")")!=null&&(o=!1,this.Whitespace());let u=null;if(this.ParseString("=")!==null){this.Whitespace();const h=this.Expect(this.ExpressionInt,"value to be assigned to list item");h!==null&&(u=h.value),o&&(this.Whitespace(),this.ParseString(")")!==null&&(o=!1))}return o&&this.Error("Expected closing ')'"),new ME.ListElementDefinition(a,s,u)},this.ConstDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="CONST")return null;this.Whitespace();const o=this.Expect(this.IdentifierWithMetadata,"constant name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const a=this.Expect(this.Expression,"initial value for ");return a instanceof or.NumberExpression||a instanceof Wa.DivertTarget||a instanceof wi.StringExpression?a instanceof wi.StringExpression&&(a.isSingleString||this.Error("Constant strings cannot contain any logic.")):this.Error("initial value for a constant must be a number or divert target"),new IE.ConstantDeclaration(o,a)},this.InlineLogicOrGlueOrStartTag=()=>this.OneOf([this.InlineLogic,this.Glue,this.StartTag]),this.Glue=()=>this.ParseString("<>")!==null?new DE.Glue(new LE.Glue):null,this.InlineLogic=()=>{if(this.ParseString("{")===null)return null;let s=this.parsingStringExpression,o=this.tagActive;this.Whitespace();const a=this.Expect(this.InnerLogic,"some kind of logic, conditional or sequence within braces: { ... }");if(a===null)return this.parsingStringExpression=s,null;this.DisallowIncrement(a);let u=Zt.asOrNull(a,Ge.ContentList);return u||(u=new Ge.ContentList(a)),this.Whitespace(),this.Expect(this.String("}"),"closing brace '}' for inline logic"),this.parsingStringExpression=s,o||this.EndTagIfNecessary(u),u},this.InnerLogic=()=>{this.Whitespace();const s=this.ParseObject(this.SequenceTypeAnnotation);if(s!==null){const u=this.Expect(this.InnerSequenceObjects,"sequence elements (for cycle/stoping etc)");return u===null?null:new dd.Sequence(u,s)}const o=this.Parse(this.ConditionExpression);if(o)return this.Expect(()=>this.InnerConditionalContent(o),"conditional content following query");const a=[this.InnerConditionalContent,this.InnerSequence,this.InnerExpression];this.tagActive;for(const u of a){const h=this.BeginRule(),p=this.ParseObject(u);if(p)if(this.Peek(this.Spaced(this.String("}")))===null)this.FailRule(h);else return this.SucceedRule(h,p);else this.FailRule(h)}return null},this.InnerExpression=()=>{const s=this.Parse(this.Expression);return s&&(s.outputWhenComplete=!0),s},this.IdentifierWithMetadata=()=>{const s=this.Identifier();return s===null?null:new _i.Identifier(s)},this.Identifier=()=>{const s=this.ParseCharactersFromCharSet(this.identifierCharSet);if(s===null)return null;let o=!0;for(let a of s)if(!(a>="0"&&a<="9")){o=!1;break}return o?null:s},this._sequenceTypeSymbols=new Te.CharacterSet("!&~$"),this.InnerSequence=()=>{this.Whitespace();let s=Ce.SequenceType.Stopping;const o=this.Parse(this.SequenceTypeAnnotation);o!==null&&(s=o);const a=this.Parse(this.InnerSequenceObjects);return a===null||a.length<=1?null:new dd.Sequence(a,s)},this.SequenceTypeAnnotation=()=>{let s=this.Parse(this.SequenceTypeSymbolAnnotation);if(s===null&&(s=this.Parse(this.SequenceTypeWordAnnotation)),s===null)return null;switch(s){case Ce.SequenceType.Once:case Ce.SequenceType.Cycle:case Ce.SequenceType.Stopping:case Ce.SequenceType.Shuffle:case Ce.SequenceType.Shuffle|Ce.SequenceType.Stopping:case Ce.SequenceType.Shuffle|Ce.SequenceType.Once:break;default:return this.Error(`Sequence type combination not supported: ${s}`),Ce.SequenceType.Stopping}return s},this.SequenceTypeSymbolAnnotation=()=>{this._sequenceTypeSymbols===null&&(this._sequenceTypeSymbols=new Te.CharacterSet("!&~$ "));let s=0;const o=this.ParseCharactersFromCharSet(this._sequenceTypeSymbols);if(o===null)return null;for(const a of o)switch(a){case"!":s|=Ce.SequenceType.Once;break;case"&":s|=Ce.SequenceType.Cycle;break;case"~":s|=Ce.SequenceType.Shuffle;break;case"$":s|=Ce.SequenceType.Stopping;break}return s===0?null:s},this.SequenceTypeWordAnnotation=()=>{const s=this.Interleave(this.SequenceTypeSingleWord,this.Exclude(this.Whitespace));if(s===null||s.length===0||this.ParseString(":")===null)return null;let o=0;for(const a of s)o|=a;return o},this.SequenceTypeSingleWord=()=>{let s=null;const o=this.Parse(this.IdentifierWithMetadata);if(o!==null)switch(o.name){case"once":s=Ce.SequenceType.Once;break;case"cycle":s=Ce.SequenceType.Cycle;break;case"shuffle":s=Ce.SequenceType.Shuffle;break;case"stopping":s=Ce.SequenceType.Stopping;break}return s===null?null:s},this.InnerSequenceObjects=()=>{const s=this.Parse(this.Newline)!==null;let o=null;return s?o=this.Parse(this.InnerMultilineSequenceObjects):o=this.Parse(this.InnerInlineSequenceObjects),o},this.InnerInlineSequenceObjects=()=>{const s=this.Interleave(this.Optional(this.MixedTextAndLogic),this.String("|"),null,!1);if(s===null)return null;const o=[];let a=!1;for(const u of s)if(u==="|")a||o.push(new Ge.ContentList),a=!1;else{const h=u;h===null?this.Error(`Expected content, but got ${u} (this is an ink compiler bug!)`):o.push(new Ge.ContentList(h)),a=!0}return a||o.push(new Ge.ContentList),o},this.InnerMultilineSequenceObjects=()=>{this.MultilineWhitespace();const s=this.OneOrMore(this.SingleMultilineSequenceElement);return s===null?null:s},this.SingleMultilineSequenceElement=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();const s=this.StatementsAtLevel(Ve.StatementLevel.InnerBlock);return s===null?this.MultilineWhitespace():s.unshift(new Rt.Text(`
`)),new Ge.ContentList(s)},this._statementRulesAtLevel=[],this._statementBreakRulesAtLevel=[],this.StatementsAtLevel=s=>(s===Ve.StatementLevel.InnerBlock&&this.Parse(this.GatherDashes)!==null&&this.Error("You can't use a gather (the dashes) within the { curly braces } context. For multi-line sequences and conditions, you should only use one dash."),this.Interleave(this.Optional(this.MultilineWhitespace),()=>this.StatementAtLevel(s),()=>this.StatementsBreakForLevel(s))),this.StatementAtLevel=s=>{const o=this._statementRulesAtLevel[s],a=this.OneOf(o);return s===Ve.StatementLevel.Top&&a instanceof fd.ReturnType&&this.Error("should not have return statement outside of a knot"),a},this.StatementsBreakForLevel=s=>{this.Whitespace();const o=this._statementBreakRulesAtLevel[s],a=this.OneOf(o);return a===null?null:a},this.GenerateStatementLevelRules=()=>{const s=Object.values(Ve.StatementLevel);this._statementRulesAtLevel="f".repeat(s.length).split("f").map(()=>[]),this._statementBreakRulesAtLevel="f".repeat(s.length).split("f").map(()=>[]);for(const o of s){const a=[],u=[];a.push(this.Line(this.MultiDivert)),o>=Ve.StatementLevel.Top&&a.push(this.KnotDefinition),a.push(this.Line(this.Choice)),a.push(this.Line(this.AuthorWarning)),o>Ve.StatementLevel.InnerBlock&&a.push(this.Gather),o>=Ve.StatementLevel.Knot&&a.push(this.StitchDefinition),a.push(this.Line(this.ListDeclaration)),a.push(this.Line(this.VariableDeclaration)),a.push(this.Line(this.ConstDeclaration)),a.push(this.Line(this.ExternalDeclaration)),a.push(this.Line(this.IncludeStatement)),a.push(this.LogicLine),a.push(this.LineOfMixedTextAndLogic),o<=Ve.StatementLevel.Knot&&u.push(this.KnotDeclaration),o<=Ve.StatementLevel.Stitch&&u.push(this.StitchDeclaration),o<=Ve.StatementLevel.InnerBlock&&(u.push(this.ParseDashNotArrow),u.push(this.String("}"))),this._statementRulesAtLevel[o]=a,this._statementBreakRulesAtLevel[o]=u}},this.SkipToNextLine=()=>(this.ParseUntilCharactersFromString(`
\r`),this.ParseNewline(),Ft.ParseSuccess),this.Line=s=>()=>{const o=this.ParseObject(s);return o===null?null:(this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),o)},this.StartTag=()=>{if(this.Whitespace(),this.ParseString("#")===null)return null;this.parsingStringExpression&&this.Error("Tags aren't allowed inside of strings. Please use \\# if you want a hash symbol.");let s=null;if(this.tagActive){let o=new Ge.ContentList;o.AddContent(new lr.Tag(!1)),o.AddContent(new lr.Tag(!0)),s=o}else s=new lr.Tag(!0);return this.tagActive=!0,this.Whitespace(),s},this._inlineWhitespaceChars=new Te.CharacterSet(" 	"),this.EndOfLine=()=>this.OneOf([this.Newline,this.EndOfFile]),this.Newline=()=>(this.Whitespace(),this.ParseNewline()!==null?Ft.ParseSuccess:null),this.EndOfFile=()=>(this.Whitespace(),this.endOfInput?Ft.ParseSuccess:null),this.MultilineWhitespace=()=>{let s=this.OneOrMore(this.Newline);return s===null?null:s.length>=1?Ft.ParseSuccess:null},this.Whitespace=()=>this.ParseCharactersFromCharSet(this._inlineWhitespaceChars)!==null?Ft.ParseSuccess:null,this.Spaced=s=>()=>{this.Whitespace();const o=this.ParseObject(s);return o===null?null:(this.Whitespace(),o)},this.AnyWhitespace=()=>{let s=!1;for(;this.OneOf([this.Whitespace,this.MultilineWhitespace])!==null;)s=!0;return s?Ft.ParseSuccess:null},this.MultiSpaced=s=>()=>{this.AnyWhitespace();const o=this.ParseObject(s);return o===null?null:(this.AnyWhitespace(),o)},this._filename=null,this._externalErrorHandler=null,this._fileHandler=null,this._filename=n,this.RegisterExpressionOperators(),this.GenerateStatementLevelRules(),this.errorHandler=this.OnStringParserError,this._externalErrorHandler=r,l===null?this._fileHandler=new zE.DefaultFileHandler:this._fileHandler=l,i===null){if(this._rootParser=this,this._openFilenames=[],this._filename!==null){const s=this.fileHandler.ResolveInkFilename(this._filename);this._openFilenames.push(s)}}else this._rootParser=i}get fileHandler(){if(!this._fileHandler)throw new Error("No FileHandler defined");return this._fileHandler}set fileHandler(e){this._fileHandler=e}PreProcessInputString(e){return new NE.CommentEliminator(e).Process()}get parsingStringExpression(){return this.GetFlag(Number(hl.CustomFlags.ParsingString))}set parsingStringExpression(e){this.SetFlag(Number(hl.CustomFlags.ParsingString),e)}get tagActive(){return this.GetFlag(Number(hl.CustomFlags.TagActive))}set tagActive(e){this.SetFlag(Number(hl.CustomFlags.TagActive),e)}get identifierCharSet(){return this._identifierCharSet===null&&((this._identifierCharSet=new Te.CharacterSet).AddRange("A","Z").AddRange("a","z").AddRange("0","9").Add("_"),this.ExtendIdentifierCharacterRanges(this._identifierCharSet)),this._identifierCharSet}EndTagIfNecessary(e){this.tagActive&&(e!=null&&(e instanceof Ge.ContentList?e.AddContent(new lr.Tag(!1)):e.push(new lr.Tag(!1))),this.tagActive=!1)}}mo.InkParser=re;re.LatinBasic=Kt.CharacterRange.Define("A","z",new Te.CharacterSet().AddRange("[","`"));re.LatinExtendedA=Kt.CharacterRange.Define("\u0100","\u017F");re.LatinExtendedB=Kt.CharacterRange.Define("\u0180","\u024F");re.Greek=Kt.CharacterRange.Define("\u0370","\u03FF",new Te.CharacterSet().AddRange("\u0378","\u0385").AddCharacters("\u0374\u0375\u0378\u0387\u038B\u038D\u03A2"));re.Cyrillic=Kt.CharacterRange.Define("\u0400","\u04FF",new Te.CharacterSet().AddRange("\u0482","\u0489"));re.Armenian=Kt.CharacterRange.Define("\u0530","\u058F",new Te.CharacterSet().AddCharacters("\u0530").AddRange("\u0557","\u0560").AddRange("\u0588","\u058E"));re.Hebrew=Kt.CharacterRange.Define("\u0590","\u05FF",new Te.CharacterSet);re.Arabic=Kt.CharacterRange.Define("\u0600","\u06FF",new Te.CharacterSet);re.Korean=Kt.CharacterRange.Define("\uAC00","\uD7AF",new Te.CharacterSet);re.ListAllCharacterRanges=()=>[re.LatinBasic,re.LatinExtendedA,re.LatinExtendedB,re.Arabic,re.Armenian,re.Cyrillic,re.Greek,re.Hebrew,re.Korean];var Go={};Object.defineProperty(Go,"__esModule",{value:!0});Go.JsonFileHandler=void 0;class qE{constructor(e){this.fileHierarchy=e,this.ResolveInkFilename=n=>{if(Object.keys(this.fileHierarchy).includes(n))return n;throw new Error(`Cannot locate ${n}. Are you trying a relative import ? This is not yet implemented.`)},this.LoadInkFileContents=n=>{if(Object.keys(this.fileHierarchy).includes(n))return this.fileHierarchy[n];throw new Error(`Cannot open ${n}.`)}}}Go.JsonFileHandler=qE;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Compiler=t.Story=t.InkList=t.JsonFileHandler=t.CompilerOptions=void 0;const e=is,n=fo,r=po,i=mo,l=ie,s=B;var o=is;Object.defineProperty(t,"CompilerOptions",{enumerable:!0,get:function(){return o.CompilerOptions}});var a=Go;Object.defineProperty(t,"JsonFileHandler",{enumerable:!0,get:function(){return a.JsonFileHandler}});var u=Ts;Object.defineProperty(t,"InkList",{enumerable:!0,get:function(){return u.InkList}}),Object.defineProperty(t,"Story",{enumerable:!0,get:function(){return u.Story}});class h{constructor(c,g=null){this._errors=[],this._warnings=[],this._authorMessages=[],this._parsedStory=null,this._runtimeStory=null,this._parser=null,this._debugSourceRanges=[],this.Compile=()=>(this._parser=new i.InkParser(this.inputString,this.options.sourceFilename||null,this.OnError,null,this.options.fileHandler),this._parsedStory=this.parser.ParseStory(),this.errors.length===0?(this.parsedStory.countAllVisits=this.options.countAllVisits,this._runtimeStory=this.parsedStory.ExportRuntime(this.OnError)):this._runtimeStory=null,this.runtimeStory),this.RetrieveDebugSourceForLatestContent=()=>{var S;for(const E of this.runtimeStory.state.outputStream){const d=s.asOrNull(E,l.StringValue);if(d!==null){const f=new n.DebugSourceRange(((S=d.value)===null||S===void 0?void 0:S.length)||0,d.debugMetadata,d.value||"unknown");this.debugSourceRanges.push(f)}}},this.DebugMetadataForContentAtOffset=S=>{let E=0,d=null;for(const f of this.debugSourceRanges){if(f.debugMetadata!==null&&(d=f.debugMetadata),S>=E&&S<E+f.length)return d;E+=f.length}return null},this.OnError=(S,E)=>{switch(E){case r.ErrorType.Author:this._authorMessages.push(S);break;case r.ErrorType.Warning:this._warnings.push(S);break;case r.ErrorType.Error:this._errors.push(S);break}this.options.errorHandler!==null&&this.options.errorHandler(S,E)},this._inputString=c,this._options=g||new e.CompilerOptions}get errors(){return this._errors}get warnings(){return this._warnings}get authorMessages(){return this._authorMessages}get inputString(){return this._inputString}get options(){return this._options}get parsedStory(){if(!this._parsedStory)throw new Error;return this._parsedStory}get runtimeStory(){if(!this._runtimeStory)throw new Error("Compilation failed.");return this._runtimeStory}get parser(){if(!this._parser)throw new Error;return this._parser}get debugSourceRanges(){return this._debugSourceRanges}}t.Compiler=h})(Ly);export{Ly as C,KE as R,JE as a,pl as b,XE as i,Ry as j,J as r,QE as u};
