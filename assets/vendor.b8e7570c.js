var vt={exports:{}},ae={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Qm=Object.getOwnPropertySymbols,kx=Object.prototype.hasOwnProperty,Ox=Object.prototype.propertyIsEnumerable;function _x(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function Px(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var i=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(i.join("")!=="0123456789")return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(s){r[s]=s}),Object.keys(Object.assign({},r)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var jy=Px()?Object.assign:function(n,e){for(var t,i=_x(n),r,s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var o in t)kx.call(t,o)&&(i[o]=t[o]);if(Qm){r=Qm(t);for(var l=0;l<r.length;l++)Ox.call(t,r[l])&&(i[r[l]]=t[r[l]])}}return i};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hp=jy,Ds=60103,$y=60106;ae.Fragment=60107;ae.StrictMode=60108;ae.Profiler=60114;var Gy=60109,Hy=60110,zy=60112;ae.Suspense=60113;var Uy=60115,qy=60116;if(typeof Symbol=="function"&&Symbol.for){var an=Symbol.for;Ds=an("react.element"),$y=an("react.portal"),ae.Fragment=an("react.fragment"),ae.StrictMode=an("react.strict_mode"),ae.Profiler=an("react.profiler"),Gy=an("react.provider"),Hy=an("react.context"),zy=an("react.forward_ref"),ae.Suspense=an("react.suspense"),Uy=an("react.memo"),qy=an("react.lazy")}var Zm=typeof Symbol=="function"&&Symbol.iterator;function Tx(n){return n===null||typeof n!="object"?null:(n=Zm&&n[Zm]||n["@@iterator"],typeof n=="function"?n:null)}function _l(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ky={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jy={};function Rs(n,e,t){this.props=n,this.context=e,this.refs=Jy,this.updater=t||Ky}Rs.prototype.isReactComponent={};Rs.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error(_l(85));this.updater.enqueueSetState(this,n,e,"setState")};Rs.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Yy(){}Yy.prototype=Rs.prototype;function cp(n,e,t){this.props=n,this.context=e,this.refs=Jy,this.updater=t||Ky}var fp=cp.prototype=new Yy;fp.constructor=cp;hp(fp,Rs.prototype);fp.isPureReactComponent=!0;var dp={current:null},Xy=Object.prototype.hasOwnProperty,Qy={key:!0,ref:!0,__self:!0,__source:!0};function Zy(n,e,t){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Xy.call(e,i)&&!Qy.hasOwnProperty(i)&&(r[i]=e[i]);var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){for(var a=Array(l),u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}if(n&&n.defaultProps)for(i in l=n.defaultProps,l)r[i]===void 0&&(r[i]=l[i]);return{$$typeof:Ds,type:n,key:s,ref:o,props:r,_owner:dp.current}}function Ax(n,e){return{$$typeof:Ds,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function pp(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ds}function Nx(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var eg=/\/+/g;function dc(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Nx(""+n.key):e.toString(36)}function Ja(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ds:case $y:o=!0}}if(o)return o=n,r=r(o),n=i===""?"."+dc(o,0):i,Array.isArray(r)?(t="",n!=null&&(t=n.replace(eg,"$&/")+"/"),Ja(r,e,t,"",function(u){return u})):r!=null&&(pp(r)&&(r=Ax(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(eg,"$&/")+"/")+n)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Array.isArray(n))for(var l=0;l<n.length;l++){s=n[l];var a=i+dc(s,l);o+=Ja(s,e,t,a,r)}else if(a=Tx(n),typeof a=="function")for(n=a.call(n),l=0;!(s=n.next()).done;)s=s.value,a=i+dc(s,l++),o+=Ja(s,e,t,a,r);else if(s==="object")throw e=""+n,Error(_l(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e));return o}function ra(n,e,t){if(n==null)return n;var i=[],r=0;return Ja(n,i,"","",function(s){return e.call(t,s,r++)}),i}function Ix(n){if(n._status===-1){var e=n._result;e=e(),n._status=0,n._result=e,e.then(function(t){n._status===0&&(t=t.default,n._status=1,n._result=t)},function(t){n._status===0&&(n._status=2,n._result=t)})}if(n._status===1)return n._result;throw n._result}var eC={current:null};function ei(){var n=eC.current;if(n===null)throw Error(_l(321));return n}var Dx={ReactCurrentDispatcher:eC,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:dp,IsSomeRendererActing:{current:!1},assign:hp};ae.Children={map:ra,forEach:function(n,e,t){ra(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return ra(n,function(){e++}),e},toArray:function(n){return ra(n,function(e){return e})||[]},only:function(n){if(!pp(n))throw Error(_l(143));return n}};ae.Component=Rs;ae.PureComponent=cp;ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Dx;ae.cloneElement=function(n,e,t){if(n==null)throw Error(_l(267,n));var i=hp({},n.props),r=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=dp.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(a in e)Xy.call(e,a)&&!Qy.hasOwnProperty(a)&&(i[a]=e[a]===void 0&&l!==void 0?l[a]:e[a])}var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){l=Array(a);for(var u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:Ds,type:n.type,key:r,ref:s,props:i,_owner:o}};ae.createContext=function(n,e){return e===void 0&&(e=null),n={$$typeof:Hy,_calculateChangedBits:e,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null},n.Provider={$$typeof:Gy,_context:n},n.Consumer=n};ae.createElement=Zy;ae.createFactory=function(n){var e=Zy.bind(null,n);return e.type=n,e};ae.createRef=function(){return{current:null}};ae.forwardRef=function(n){return{$$typeof:zy,render:n}};ae.isValidElement=pp;ae.lazy=function(n){return{$$typeof:qy,_payload:{_status:-1,_result:n},_init:Ix}};ae.memo=function(n,e){return{$$typeof:Uy,type:n,compare:e===void 0?null:e}};ae.useCallback=function(n,e){return ei().useCallback(n,e)};ae.useContext=function(n,e){return ei().useContext(n,e)};ae.useDebugValue=function(){};ae.useEffect=function(n,e){return ei().useEffect(n,e)};ae.useImperativeHandle=function(n,e,t){return ei().useImperativeHandle(n,e,t)};ae.useLayoutEffect=function(n,e){return ei().useLayoutEffect(n,e)};ae.useMemo=function(n,e){return ei().useMemo(n,e)};ae.useReducer=function(n,e,t){return ei().useReducer(n,e,t)};ae.useRef=function(n){return ei().useRef(n)};ae.useState=function(n){return ei().useState(n)};ae.version="17.0.2";vt.exports=ae;var Rx=vt.exports,tC={exports:{}},sn={},nC={exports:{}},iC={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){var e,t,i,r;if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var a=null,u=null,h=function(){if(a!==null)try{var D=n.unstable_now();a(!0,D),a=null}catch(W){throw setTimeout(h,0),W}};e=function(D){a!==null?setTimeout(e,0,D):(a=D,setTimeout(h,0))},t=function(D,W){u=setTimeout(D,W)},i=function(){clearTimeout(u)},n.unstable_shouldYield=function(){return!1},r=n.unstable_forceFrameRate=function(){}}else{var c=window.setTimeout,f=window.clearTimeout;if(typeof console!="undefined"){var d=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof d!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var m=!1,w=null,v=-1,p=5,y=0;n.unstable_shouldYield=function(){return n.unstable_now()>=y},r=function(){},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):p=0<D?Math.floor(1e3/D):5};var C=new MessageChannel,b=C.port2;C.port1.onmessage=function(){if(w!==null){var D=n.unstable_now();y=D+p;try{w(!0,D)?b.postMessage(null):(m=!1,w=null)}catch(W){throw b.postMessage(null),W}}else m=!1},e=function(D){w=D,m||(m=!0,b.postMessage(null))},t=function(D,W){v=c(function(){D(n.unstable_now())},W)},i=function(){f(v),v=-1}}function _(D,W){var z=D.length;D.push(W);e:for(;;){var se=z-1>>>1,ge=D[se];if(ge!==void 0&&0<L(ge,W))D[se]=W,D[z]=ge,z=se;else break e}}function O(D){return D=D[0],D===void 0?null:D}function R(D){var W=D[0];if(W!==void 0){var z=D.pop();if(z!==W){D[0]=z;e:for(var se=0,ge=D.length;se<ge;){var Me=2*(se+1)-1,le=D[Me],gt=Me+1,Et=D[gt];if(le!==void 0&&0>L(le,z))Et!==void 0&&0>L(Et,le)?(D[se]=Et,D[gt]=z,se=gt):(D[se]=le,D[Me]=z,se=Me);else if(Et!==void 0&&0>L(Et,z))D[se]=Et,D[gt]=z,se=gt;else break e}}return W}return null}function L(D,W){var z=D.sortIndex-W.sortIndex;return z!==0?z:D.id-W.id}var A=[],$=[],U=1,X=null,H=3,Ce=!1,S=!1,E=!1;function P(D){for(var W=O($);W!==null;){if(W.callback===null)R($);else if(W.startTime<=D)R($),W.sortIndex=W.expirationTime,_(A,W);else break;W=O($)}}function T(D){if(E=!1,P(D),!S)if(O(A)!==null)S=!0,e(N);else{var W=O($);W!==null&&t(T,W.startTime-D)}}function N(D,W){S=!1,E&&(E=!1,i()),Ce=!0;var z=H;try{for(P(W),X=O(A);X!==null&&(!(X.expirationTime>W)||D&&!n.unstable_shouldYield());){var se=X.callback;if(typeof se=="function"){X.callback=null,H=X.priorityLevel;var ge=se(X.expirationTime<=W);W=n.unstable_now(),typeof ge=="function"?X.callback=ge:X===O(A)&&R(A),P(W)}else R(A);X=O(A)}if(X!==null)var Me=!0;else{var le=O($);le!==null&&t(T,le.startTime-W),Me=!1}return Me}finally{X=null,H=z,Ce=!1}}var j=r;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_continueExecution=function(){S||Ce||(S=!0,e(N))},n.unstable_getCurrentPriorityLevel=function(){return H},n.unstable_getFirstCallbackNode=function(){return O(A)},n.unstable_next=function(D){switch(H){case 1:case 2:case 3:var W=3;break;default:W=H}var z=H;H=W;try{return D()}finally{H=z}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=j,n.unstable_runWithPriority=function(D,W){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var z=H;H=D;try{return W()}finally{H=z}},n.unstable_scheduleCallback=function(D,W,z){var se=n.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?se+z:se):z=se,D){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=z+ge,D={id:U++,callback:W,priorityLevel:D,startTime:z,expirationTime:ge,sortIndex:-1},z>se?(D.sortIndex=z,_($,D),O(A)===null&&D===O($)&&(E?i():E=!0,t(T,z-se))):(D.sortIndex=ge,_(A,D),S||Ce||(S=!0,e(N))),D},n.unstable_wrapCallback=function(D){var W=H;return function(){var z=H;H=W;try{return D.apply(this,arguments)}finally{H=z}}}})(iC);nC.exports=iC;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oh=vt.exports,Pe=jy,Ke=nC.exports;function V(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!oh)throw Error(V(227));var rC=new Set,il={};function Or(n,e){Es(n,e),Es(n+"Capture",e)}function Es(n,e){for(il[n]=e,n=0;n<e.length;n++)rC.add(e[n])}var Zn=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Lx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tg=Object.prototype.hasOwnProperty,ng={},ig={};function Mx(n){return tg.call(ig,n)?!0:tg.call(ng,n)?!1:Lx.test(n)?ig[n]=!0:(ng[n]=!0,!1)}function Fx(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Vx(n,e,t,i){if(e===null||typeof e=="undefined"||Fx(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function xt(n,e,t,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var rt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){rt[n]=new xt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];rt[e]=new xt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){rt[n]=new xt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){rt[n]=new xt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){rt[n]=new xt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){rt[n]=new xt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){rt[n]=new xt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){rt[n]=new xt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){rt[n]=new xt(n,5,!1,n.toLowerCase(),null,!1,!1)});var mp=/[\-:]([a-z])/g;function gp(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(mp,gp);rt[e]=new xt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(mp,gp);rt[e]=new xt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(mp,gp);rt[e]=new xt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){rt[n]=new xt(n,1,!1,n.toLowerCase(),null,!1,!1)});rt.xlinkHref=new xt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){rt[n]=new xt(n,1,!1,n.toLowerCase(),null,!0,!0)});function vp(n,e,t,i){var r=rt.hasOwnProperty(e)?rt[e]:null,s=r!==null?r.type===0:i?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");s||(Vx(e,t,r,i)&&(t=null),i||r===null?Mx(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var _r=oh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Po=60103,rr=60106,Si=60107,yp=60108,Wo=60114,Cp=60109,Sp=60110,lh=60112,Bo=60113,mu=60120,ah=60115,wp=60116,xp=60121,bp=60128,sC=60129,Ep=60130,Tf=60131;if(typeof Symbol=="function"&&Symbol.for){var ze=Symbol.for;Po=ze("react.element"),rr=ze("react.portal"),Si=ze("react.fragment"),yp=ze("react.strict_mode"),Wo=ze("react.profiler"),Cp=ze("react.provider"),Sp=ze("react.context"),lh=ze("react.forward_ref"),Bo=ze("react.suspense"),mu=ze("react.suspense_list"),ah=ze("react.memo"),wp=ze("react.lazy"),xp=ze("react.block"),ze("react.scope"),bp=ze("react.opaque.id"),sC=ze("react.debug_trace_mode"),Ep=ze("react.offscreen"),Tf=ze("react.legacy_hidden")}var rg=typeof Symbol=="function"&&Symbol.iterator;function to(n){return n===null||typeof n!="object"?null:(n=rg&&n[rg]||n["@@iterator"],typeof n=="function"?n:null)}var pc;function To(n){if(pc===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);pc=e&&e[1]||""}return`
`+pc+n}var mc=!1;function sa(n,e){if(!n||mc)return"";mc=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(a){var i=a}Reflect.construct(n,[],e)}else{try{e.call()}catch(a){i=a}n.call(e.prototype)}else{try{throw Error()}catch(a){i=a}n()}}catch(a){if(a&&i&&typeof a.stack=="string"){for(var r=a.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,l=s.length-1;1<=o&&0<=l&&r[o]!==s[l];)l--;for(;1<=o&&0<=l;o--,l--)if(r[o]!==s[l]){if(o!==1||l!==1)do if(o--,l--,0>l||r[o]!==s[l])return`
`+r[o].replace(" at new "," at ");while(1<=o&&0<=l);break}}}finally{mc=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?To(n):""}function Wx(n){switch(n.tag){case 5:return To(n.type);case 16:return To("Lazy");case 13:return To("Suspense");case 19:return To("SuspenseList");case 0:case 2:case 15:return n=sa(n.type,!1),n;case 11:return n=sa(n.type.render,!1),n;case 22:return n=sa(n.type._render,!1),n;case 1:return n=sa(n.type,!0),n;default:return""}}function us(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Si:return"Fragment";case rr:return"Portal";case Wo:return"Profiler";case yp:return"StrictMode";case Bo:return"Suspense";case mu:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Sp:return(n.displayName||"Context")+".Consumer";case Cp:return(n._context.displayName||"Context")+".Provider";case lh:var e=n.render;return e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case ah:return us(n.type);case xp:return us(n._render);case wp:e=n._payload,n=n._init;try{return us(n(e))}catch{}}return null}function Fi(n){switch(typeof n){case"boolean":case"number":case"object":case"string":case"undefined":return n;default:return""}}function oC(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Bx(n){var e=oC(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t!="undefined"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function oa(n){n._valueTracker||(n._valueTracker=Bx(n))}function lC(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=oC(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function gu(n){if(n=n||(typeof document!="undefined"?document:void 0),typeof n=="undefined")return null;try{return n.activeElement||n.body}catch{return n.body}}function Af(n,e){var t=e.checked;return Pe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t!=null?t:n._wrapperState.initialChecked})}function sg(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=Fi(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function aC(n,e){e=e.checked,e!=null&&vp(n,"checked",e,!1)}function Nf(n,e){aC(n,e);var t=Fi(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?If(n,e.type,t):e.hasOwnProperty("defaultValue")&&If(n,e.type,Fi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function og(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function If(n,e,t){(e!=="number"||gu(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}function jx(n){var e="";return oh.Children.forEach(n,function(t){t!=null&&(e+=t)}),e}function Df(n,e){return n=Pe({children:void 0},e),(e=jx(e.children))&&(n.children=e),n}function hs(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+Fi(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function Rf(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(V(91));return Pe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function lg(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(V(92));if(Array.isArray(t)){if(!(1>=t.length))throw Error(V(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Fi(t)}}function uC(n,e){var t=Fi(e.value),i=Fi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function ag(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}var Lf={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function hC(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Mf(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?hC(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var la,cC=function(n){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!==Lf.svg||"innerHTML"in n)n.innerHTML=e;else{for(la=la||document.createElement("div"),la.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=la.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function rl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var jo={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$x=["Webkit","ms","Moz","O"];Object.keys(jo).forEach(function(n){$x.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),jo[e]=jo[n]})});function fC(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||jo.hasOwnProperty(n)&&jo[n]?(""+e).trim():e+"px"}function dC(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=fC(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var Gx=Pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ff(n,e){if(e){if(Gx[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(V(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(V(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(V(61))}if(e.style!=null&&typeof e.style!="object")throw Error(V(62))}}function Vf(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function kp(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Wf=null,cs=null,fs=null;function ug(n){if(n=Tl(n)){if(typeof Wf!="function")throw Error(V(280));var e=n.stateNode;e&&(e=ph(e),Wf(n.stateNode,n.type,e))}}function pC(n){cs?fs?fs.push(n):fs=[n]:cs=n}function mC(){if(cs){var n=cs,e=fs;if(fs=cs=null,ug(n),e)for(n=0;n<e.length;n++)ug(e[n])}}function Op(n,e){return n(e)}function gC(n,e,t,i,r){return n(e,t,i,r)}function _p(){}var vC=Op,sr=!1,gc=!1;function Pp(){(cs!==null||fs!==null)&&(_p(),mC())}function Hx(n,e,t){if(gc)return n(e,t);gc=!0;try{return vC(n,e,t)}finally{gc=!1,Pp()}}function sl(n,e){var t=n.stateNode;if(t===null)return null;var i=ph(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(V(231,e,typeof t));return t}var Bf=!1;if(Zn)try{var no={};Object.defineProperty(no,"passive",{get:function(){Bf=!0}}),window.addEventListener("test",no,no),window.removeEventListener("test",no,no)}catch{Bf=!1}function zx(n,e,t,i,r,s,o,l,a){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var $o=!1,vu=null,yu=!1,jf=null,Ux={onError:function(n){$o=!0,vu=n}};function qx(n,e,t,i,r,s,o,l,a){$o=!1,vu=null,zx.apply(Ux,arguments)}function Kx(n,e,t,i,r,s,o,l,a){if(qx.apply(this,arguments),$o){if($o){var u=vu;$o=!1,vu=null}else throw Error(V(198));yu||(yu=!0,jf=u)}}function Pr(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,(e.flags&1026)!==0&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function yC(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function hg(n){if(Pr(n)!==n)throw Error(V(188))}function Jx(n){var e=n.alternate;if(!e){if(e=Pr(n),e===null)throw Error(V(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return hg(r),n;if(s===i)return hg(r),e;s=s.sibling}throw Error(V(188))}if(t.return!==i.return)t=r,i=s;else{for(var o=!1,l=r.child;l;){if(l===t){o=!0,t=r,i=s;break}if(l===i){o=!0,i=r,t=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===t){o=!0,t=s,i=r;break}if(l===i){o=!0,i=s,t=r;break}l=l.sibling}if(!o)throw Error(V(189))}}if(t.alternate!==i)throw Error(V(190))}if(t.tag!==3)throw Error(V(188));return t.stateNode.current===t?n:e}function CC(n){if(n=Jx(n),!n)return null;for(var e=n;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===n)break;for(;!e.sibling;){if(!e.return||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function cg(n,e){for(var t=n.alternate;e!==null;){if(e===n||e===t)return!0;e=e.return}return!1}var SC,Tp,wC,xC,$f=!1,On=[],Pi=null,Ti=null,Ai=null,ol=new Map,ll=new Map,io=[],fg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gf(n,e,t,i,r){return{blockedOn:n,domEventName:e,eventSystemFlags:t|16,nativeEvent:r,targetContainers:[i]}}function dg(n,e){switch(n){case"focusin":case"focusout":Pi=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":Ai=null;break;case"pointerover":case"pointerout":ol.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ll.delete(e.pointerId)}}function ro(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n=Gf(e,t,i,r,s),e!==null&&(e=Tl(e),e!==null&&Tp(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function Yx(n,e,t,i,r){switch(e){case"focusin":return Pi=ro(Pi,n,e,t,i,r),!0;case"dragenter":return Ti=ro(Ti,n,e,t,i,r),!0;case"mouseover":return Ai=ro(Ai,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return ol.set(s,ro(ol.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ll.set(s,ro(ll.get(s)||null,n,e,t,i,r)),!0}return!1}function Xx(n){var e=or(n.target);if(e!==null){var t=Pr(e);if(t!==null){if(e=t.tag,e===13){if(e=yC(t),e!==null){n.blockedOn=e,xC(n.lanePriority,function(){Ke.unstable_runWithPriority(n.priority,function(){wC(t)})});return}}else if(e===3&&t.stateNode.hydrate){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ya(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Dp(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null)return e=Tl(t),e!==null&&Tp(e),n.blockedOn=t,!1;e.shift()}return!0}function pg(n,e,t){Ya(n)&&t.delete(e)}function Qx(){for($f=!1;0<On.length;){var n=On[0];if(n.blockedOn!==null){n=Tl(n.blockedOn),n!==null&&SC(n);break}for(var e=n.targetContainers;0<e.length;){var t=Dp(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null){n.blockedOn=t;break}e.shift()}n.blockedOn===null&&On.shift()}Pi!==null&&Ya(Pi)&&(Pi=null),Ti!==null&&Ya(Ti)&&(Ti=null),Ai!==null&&Ya(Ai)&&(Ai=null),ol.forEach(pg),ll.forEach(pg)}function so(n,e){n.blockedOn===e&&(n.blockedOn=null,$f||($f=!0,Ke.unstable_scheduleCallback(Ke.unstable_NormalPriority,Qx)))}function bC(n){function e(r){return so(r,n)}if(0<On.length){so(On[0],n);for(var t=1;t<On.length;t++){var i=On[t];i.blockedOn===n&&(i.blockedOn=null)}}for(Pi!==null&&so(Pi,n),Ti!==null&&so(Ti,n),Ai!==null&&so(Ai,n),ol.forEach(e),ll.forEach(e),t=0;t<io.length;t++)i=io[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<io.length&&(t=io[0],t.blockedOn===null);)Xx(t),t.blockedOn===null&&io.shift()}function aa(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var es={animationend:aa("Animation","AnimationEnd"),animationiteration:aa("Animation","AnimationIteration"),animationstart:aa("Animation","AnimationStart"),transitionend:aa("Transition","TransitionEnd")},vc={},EC={};Zn&&(EC=document.createElement("div").style,"AnimationEvent"in window||(delete es.animationend.animation,delete es.animationiteration.animation,delete es.animationstart.animation),"TransitionEvent"in window||delete es.transitionend.transition);function uh(n){if(vc[n])return vc[n];if(!es[n])return n;var e=es[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in EC)return vc[n]=e[t];return n}var kC=uh("animationend"),OC=uh("animationiteration"),_C=uh("animationstart"),PC=uh("transitionend"),TC=new Map,Ap=new Map,Zx=["abort","abort",kC,"animationEnd",OC,"animationIteration",_C,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",PC,"transitionEnd","waiting","waiting"];function Np(n,e){for(var t=0;t<n.length;t+=2){var i=n[t],r=n[t+1];r="on"+(r[0].toUpperCase()+r.slice(1)),Ap.set(i,e),TC.set(i,r),Or(r,[i])}}var eb=Ke.unstable_now;eb();var Se=8;function Qr(n){if((1&n)!==0)return Se=15,1;if((2&n)!==0)return Se=14,2;if((4&n)!==0)return Se=13,4;var e=24&n;return e!==0?(Se=12,e):(n&32)!==0?(Se=11,32):(e=192&n,e!==0?(Se=10,e):(n&256)!==0?(Se=9,256):(e=3584&n,e!==0?(Se=8,e):(n&4096)!==0?(Se=7,4096):(e=4186112&n,e!==0?(Se=6,e):(e=62914560&n,e!==0?(Se=5,e):n&67108864?(Se=4,67108864):(n&134217728)!==0?(Se=3,134217728):(e=805306368&n,e!==0?(Se=2,e):(1073741824&n)!==0?(Se=1,1073741824):(Se=8,n))))))}function tb(n){switch(n){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function nb(n){switch(n){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(V(358,n))}}function al(n,e){var t=n.pendingLanes;if(t===0)return Se=0;var i=0,r=0,s=n.expiredLanes,o=n.suspendedLanes,l=n.pingedLanes;if(s!==0)i=s,r=Se=15;else if(s=t&134217727,s!==0){var a=s&~o;a!==0?(i=Qr(a),r=Se):(l&=s,l!==0&&(i=Qr(l),r=Se))}else s=t&~o,s!==0?(i=Qr(s),r=Se):l!==0&&(i=Qr(l),r=Se);if(i===0)return 0;if(i=31-Vi(i),i=t&((0>i?0:1<<i)<<1)-1,e!==0&&e!==i&&(e&o)===0){if(Qr(e),r<=Se)return e;Se=r}if(e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Vi(e),r=1<<t,i|=n[t],e&=~r;return i}function AC(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Cu(n,e){switch(n){case 15:return 1;case 14:return 2;case 12:return n=Zr(24&~e),n===0?Cu(10,e):n;case 10:return n=Zr(192&~e),n===0?Cu(8,e):n;case 8:return n=Zr(3584&~e),n===0&&(n=Zr(4186112&~e),n===0&&(n=512)),n;case 2:return e=Zr(805306368&~e),e===0&&(e=268435456),e}throw Error(V(358,n))}function Zr(n){return n&-n}function yc(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function hh(n,e,t){n.pendingLanes|=e;var i=e-1;n.suspendedLanes&=i,n.pingedLanes&=i,n=n.eventTimes,e=31-Vi(e),n[e]=t}var Vi=Math.clz32?Math.clz32:sb,ib=Math.log,rb=Math.LN2;function sb(n){return n===0?32:31-(ib(n)/rb|0)|0}var ob=Ke.unstable_UserBlockingPriority,lb=Ke.unstable_runWithPriority,Xa=!0;function ab(n,e,t,i){sr||_p();var r=Ip,s=sr;sr=!0;try{gC(r,n,e,t,i)}finally{(sr=s)||Pp()}}function ub(n,e,t,i){lb(ob,Ip.bind(null,n,e,t,i))}function Ip(n,e,t,i){if(Xa){var r;if((r=(e&4)===0)&&0<On.length&&-1<fg.indexOf(n))n=Gf(null,n,e,t,i),On.push(n);else{var s=Dp(n,e,t,i);if(s===null)r&&dg(n,i);else{if(r){if(-1<fg.indexOf(n)){n=Gf(s,n,e,t,i),On.push(n);return}if(Yx(s,n,e,t,i))return;dg(n,i)}GC(n,e,i,null,t)}}}}function Dp(n,e,t,i){var r=kp(i);if(r=or(r),r!==null){var s=Pr(r);if(s===null)r=null;else{var o=s.tag;if(o===13){if(r=yC(s),r!==null)return r;r=null}else if(o===3){if(s.stateNode.hydrate)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return GC(n,e,i,r,t),null}var xi=null,Rp=null,Qa=null;function NC(){if(Qa)return Qa;var n,e=Rp,t=e.length,i,r="value"in xi?xi.value:xi.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var o=t-n;for(i=1;i<=o&&e[t-i]===r[s-i];i++);return Qa=r.slice(n,1<i?1-i:void 0)}function Za(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function ua(){return!0}function mg(){return!1}function zt(n){function e(t,i,r,s,o){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(s):s[l]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ua:mg,this.isPropagationStopped=mg,this}return Pe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ua)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ua)},persist:function(){},isPersistent:ua}),e}var Ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lp=zt(Ls),Pl=Pe({},Ls,{view:0,detail:0}),hb=zt(Pl),Cc,Sc,oo,ch=Pe({},Pl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mp,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==oo&&(oo&&n.type==="mousemove"?(Cc=n.screenX-oo.screenX,Sc=n.screenY-oo.screenY):Sc=Cc=0,oo=n),Cc)},movementY:function(n){return"movementY"in n?n.movementY:Sc}}),gg=zt(ch),cb=Pe({},ch,{dataTransfer:0}),fb=zt(cb),db=Pe({},Pl,{relatedTarget:0}),wc=zt(db),pb=Pe({},Ls,{animationName:0,elapsedTime:0,pseudoElement:0}),mb=zt(pb),gb=Pe({},Ls,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),vb=zt(gb),yb=Pe({},Ls,{data:0}),vg=zt(yb),Cb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xb(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=wb[n])?!!e[n]:!1}function Mp(){return xb}var bb=Pe({},Pl,{key:function(n){if(n.key){var e=Cb[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Za(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Sb[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mp,charCode:function(n){return n.type==="keypress"?Za(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Za(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Eb=zt(bb),kb=Pe({},ch,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yg=zt(kb),Ob=Pe({},Pl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mp}),_b=zt(Ob),Pb=Pe({},Ls,{propertyName:0,elapsedTime:0,pseudoElement:0}),Tb=zt(Pb),Ab=Pe({},ch,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Nb=zt(Ab),Ib=[9,13,27,32],Fp=Zn&&"CompositionEvent"in window,Go=null;Zn&&"documentMode"in document&&(Go=document.documentMode);var Db=Zn&&"TextEvent"in window&&!Go,IC=Zn&&(!Fp||Go&&8<Go&&11>=Go),Cg=String.fromCharCode(32),Sg=!1;function DC(n,e){switch(n){case"keyup":return Ib.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function RC(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ts=!1;function Rb(n,e){switch(n){case"compositionend":return RC(e);case"keypress":return e.which!==32?null:(Sg=!0,Cg);case"textInput":return n=e.data,n===Cg&&Sg?null:n;default:return null}}function Lb(n,e){if(ts)return n==="compositionend"||!Fp&&DC(n,e)?(n=NC(),Qa=Rp=xi=null,ts=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return IC&&e.locale!=="ko"?null:e.data;default:return null}}var Mb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wg(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Mb[n.type]:e==="textarea"}function LC(n,e,t,i){pC(i),e=Su(e,"onChange"),0<e.length&&(t=new Lp("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var Ho=null,ul=null;function Fb(n){BC(n,0)}function fh(n){var e=is(n);if(lC(e))return n}function Vb(n,e){if(n==="change")return e}var MC=!1;if(Zn){var xc;if(Zn){var bc="oninput"in document;if(!bc){var xg=document.createElement("div");xg.setAttribute("oninput","return;"),bc=typeof xg.oninput=="function"}xc=bc}else xc=!1;MC=xc&&(!document.documentMode||9<document.documentMode)}function bg(){Ho&&(Ho.detachEvent("onpropertychange",FC),ul=Ho=null)}function FC(n){if(n.propertyName==="value"&&fh(ul)){var e=[];if(LC(e,ul,n,kp(n)),n=Fb,sr)n(e);else{sr=!0;try{Op(n,e)}finally{sr=!1,Pp()}}}}function Wb(n,e,t){n==="focusin"?(bg(),Ho=e,ul=t,Ho.attachEvent("onpropertychange",FC)):n==="focusout"&&bg()}function Bb(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return fh(ul)}function jb(n,e){if(n==="click")return fh(e)}function $b(n,e){if(n==="input"||n==="change")return fh(e)}function Gb(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Xt=typeof Object.is=="function"?Object.is:Gb,Hb=Object.prototype.hasOwnProperty;function hl(n,e){if(Xt(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++)if(!Hb.call(e,t[i])||!Xt(n[t[i]],e[t[i]]))return!1;return!0}function Eg(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function kg(n,e){var t=Eg(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Eg(t)}}function VC(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?VC(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Og(){for(var n=window,e=gu();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=gu(n.document)}return e}function Hf(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}var zb=Zn&&"documentMode"in document&&11>=document.documentMode,ns=null,zf=null,zo=null,Uf=!1;function _g(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Uf||ns==null||ns!==gu(i)||(i=ns,"selectionStart"in i&&Hf(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),zo&&hl(zo,i)||(zo=i,i=Su(zf,"onSelect"),0<i.length&&(e=new Lp("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=ns)))}Np("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Np("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Np(Zx,2);for(var Pg="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Ec=0;Ec<Pg.length;Ec++)Ap.set(Pg[Ec],0);Es("onMouseEnter",["mouseout","mouseover"]);Es("onMouseLeave",["mouseout","mouseover"]);Es("onPointerEnter",["pointerout","pointerover"]);Es("onPointerLeave",["pointerout","pointerover"]);Or("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Or("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Or("onBeforeInput",["compositionend","keypress","textInput","paste"]);Or("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Or("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Or("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ao="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WC=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ao));function Tg(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,Kx(i,e,void 0,n),n.currentTarget=null}function BC(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var l=i[o],a=l.instance,u=l.currentTarget;if(l=l.listener,a!==s&&r.isPropagationStopped())break e;Tg(r,l,u),s=a}else for(o=0;o<i.length;o++){if(l=i[o],a=l.instance,u=l.currentTarget,l=l.listener,a!==s&&r.isPropagationStopped())break e;Tg(r,l,u),s=a}}}if(yu)throw n=jf,yu=!1,jf=null,n}function xe(n,e){var t=zC(e),i=n+"__bubble";t.has(i)||($C(e,n,2,!1),t.add(i))}var Ag="_reactListening"+Math.random().toString(36).slice(2);function jC(n){n[Ag]||(n[Ag]=!0,rC.forEach(function(e){WC.has(e)||Ng(e,!1,n,null),Ng(e,!0,n,null)}))}function Ng(n,e,t,i){var r=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,s=t;if(n==="selectionchange"&&t.nodeType!==9&&(s=t.ownerDocument),i!==null&&!e&&WC.has(n)){if(n!=="scroll")return;r|=2,s=i}var o=zC(s),l=n+"__"+(e?"capture":"bubble");o.has(l)||(e&&(r|=4),$C(s,n,r,e),o.add(l))}function $C(n,e,t,i){var r=Ap.get(e);switch(r===void 0?2:r){case 0:r=ab;break;case 1:r=ub;break;default:r=Ip}t=r.bind(null,e,t,n),r=void 0,!Bf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function GC(n,e,t,i,r){var s=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var l=i.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var a=o.tag;if((a===3||a===4)&&(a=o.stateNode.containerInfo,a===r||a.nodeType===8&&a.parentNode===r))return;o=o.return}for(;l!==null;){if(o=or(l),o===null)return;if(a=o.tag,a===5||a===6){i=s=o;continue e}l=l.parentNode}}i=i.return}Hx(function(){var u=s,h=kp(t),c=[];e:{var f=TC.get(n);if(f!==void 0){var d=Lp,m=n;switch(n){case"keypress":if(Za(t)===0)break e;case"keydown":case"keyup":d=Eb;break;case"focusin":m="focus",d=wc;break;case"focusout":m="blur",d=wc;break;case"beforeblur":case"afterblur":d=wc;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=gg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=fb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=_b;break;case kC:case OC:case _C:d=mb;break;case PC:d=Tb;break;case"scroll":d=hb;break;case"wheel":d=Nb;break;case"copy":case"cut":case"paste":d=vb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=yg}var w=(e&4)!==0,v=!w&&n==="scroll",p=w?f!==null?f+"Capture":null:f;w=[];for(var y=u,C;y!==null;){C=y;var b=C.stateNode;if(C.tag===5&&b!==null&&(C=b,p!==null&&(b=sl(y,p),b!=null&&w.push(cl(y,b,C)))),v)break;y=y.return}0<w.length&&(f=new d(f,m,null,t,h),c.push({event:f,listeners:w}))}}if((e&7)===0){e:{if(f=n==="mouseover"||n==="pointerover",d=n==="mouseout"||n==="pointerout",f&&(e&16)===0&&(m=t.relatedTarget||t.fromElement)&&(or(m)||m[Ms]))break e;if((d||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,d?(m=t.relatedTarget||t.toElement,d=u,m=m?or(m):null,m!==null&&(v=Pr(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(d=null,m=u),d!==m)){if(w=gg,b="onMouseLeave",p="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(w=yg,b="onPointerLeave",p="onPointerEnter",y="pointer"),v=d==null?f:is(d),C=m==null?f:is(m),f=new w(b,y+"leave",d,t,h),f.target=v,f.relatedTarget=C,b=null,or(h)===u&&(w=new w(p,y+"enter",m,t,h),w.target=C,w.relatedTarget=v,b=w),v=b,d&&m)t:{for(w=d,p=m,y=0,C=w;C;C=Gr(C))y++;for(C=0,b=p;b;b=Gr(b))C++;for(;0<y-C;)w=Gr(w),y--;for(;0<C-y;)p=Gr(p),C--;for(;y--;){if(w===p||p!==null&&w===p.alternate)break t;w=Gr(w),p=Gr(p)}w=null}else w=null;d!==null&&Ig(c,f,d,w,!1),m!==null&&v!==null&&Ig(c,v,m,w,!0)}}e:{if(f=u?is(u):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var _=Vb;else if(wg(f))if(MC)_=$b;else{_=Bb;var O=Wb}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(_=jb);if(_&&(_=_(n,u))){LC(c,_,t,h);break e}O&&O(n,f,u),n==="focusout"&&(O=f._wrapperState)&&O.controlled&&f.type==="number"&&If(f,"number",f.value)}switch(O=u?is(u):window,n){case"focusin":(wg(O)||O.contentEditable==="true")&&(ns=O,zf=u,zo=null);break;case"focusout":zo=zf=ns=null;break;case"mousedown":Uf=!0;break;case"contextmenu":case"mouseup":case"dragend":Uf=!1,_g(c,t,h);break;case"selectionchange":if(zb)break;case"keydown":case"keyup":_g(c,t,h)}var R;if(Fp)e:{switch(n){case"compositionstart":var L="onCompositionStart";break e;case"compositionend":L="onCompositionEnd";break e;case"compositionupdate":L="onCompositionUpdate";break e}L=void 0}else ts?DC(n,t)&&(L="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(L="onCompositionStart");L&&(IC&&t.locale!=="ko"&&(ts||L!=="onCompositionStart"?L==="onCompositionEnd"&&ts&&(R=NC()):(xi=h,Rp="value"in xi?xi.value:xi.textContent,ts=!0)),O=Su(u,L),0<O.length&&(L=new vg(L,n,null,t,h),c.push({event:L,listeners:O}),R?L.data=R:(R=RC(t),R!==null&&(L.data=R)))),(R=Db?Rb(n,t):Lb(n,t))&&(u=Su(u,"onBeforeInput"),0<u.length&&(h=new vg("onBeforeInput","beforeinput",null,t,h),c.push({event:h,listeners:u}),h.data=R))}BC(c,e)})}function cl(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Su(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=sl(n,t),s!=null&&i.unshift(cl(n,s,r)),s=sl(n,e),s!=null&&i.push(cl(n,s,r))),n=n.return}return i}function Gr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ig(n,e,t,i,r){for(var s=e._reactName,o=[];t!==null&&t!==i;){var l=t,a=l.alternate,u=l.stateNode;if(a!==null&&a===i)break;l.tag===5&&u!==null&&(l=u,r?(a=sl(t,s),a!=null&&o.unshift(cl(t,a,l))):r||(a=sl(t,s),a!=null&&o.push(cl(t,a,l)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}function wu(){}var kc=null,Oc=null;function HC(n,e){switch(n){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function qf(n,e){return n==="textarea"||n==="option"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Dg=typeof setTimeout=="function"?setTimeout:void 0,Ub=typeof clearTimeout=="function"?clearTimeout:void 0;function Vp(n){n.nodeType===1?n.textContent="":n.nodeType===9&&(n=n.body,n!=null&&(n.textContent=""))}function ds(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break}return n}function Rg(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var _c=0;function qb(n){return{$$typeof:bp,toString:n,valueOf:n}}var dh=Math.random().toString(36).slice(2),bi="__reactFiber$"+dh,xu="__reactProps$"+dh,Ms="__reactContainer$"+dh,Lg="__reactEvents$"+dh;function or(n){var e=n[bi];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ms]||t[bi]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Rg(n);n!==null;){if(t=n[bi])return t;n=Rg(n)}return e}n=t,t=n.parentNode}return null}function Tl(n){return n=n[bi]||n[Ms],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function is(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(V(33))}function ph(n){return n[xu]||null}function zC(n){var e=n[Lg];return e===void 0&&(e=n[Lg]=new Set),e}var Kf=[],rs=-1;function Ui(n){return{current:n}}function Ee(n){0>rs||(n.current=Kf[rs],Kf[rs]=null,rs--)}function Ie(n,e){rs++,Kf[rs]=n.current,n.current=e}var Wi={},dt=Ui(Wi),Nt=Ui(!1),gr=Wi;function ks(n,e){var t=n.type.contextTypes;if(!t)return Wi;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function It(n){return n=n.childContextTypes,n!=null}function bu(){Ee(Nt),Ee(dt)}function Mg(n,e,t){if(dt.current!==Wi)throw Error(V(168));Ie(dt,e),Ie(Nt,t)}function UC(n,e,t){var i=n.stateNode;if(n=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in n))throw Error(V(108,us(e)||"Unknown",r));return Pe({},t,i)}function eu(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Wi,gr=dt.current,Ie(dt,n),Ie(Nt,Nt.current),!0}function Fg(n,e,t){var i=n.stateNode;if(!i)throw Error(V(169));t?(n=UC(n,e,gr),i.__reactInternalMemoizedMergedChildContext=n,Ee(Nt),Ee(dt),Ie(dt,n)):Ee(Nt),Ie(Nt,t)}var Wp=null,fr=null,Kb=Ke.unstable_runWithPriority,Bp=Ke.unstable_scheduleCallback,Jf=Ke.unstable_cancelCallback,Jb=Ke.unstable_shouldYield,Vg=Ke.unstable_requestPaint,Yf=Ke.unstable_now,Yb=Ke.unstable_getCurrentPriorityLevel,mh=Ke.unstable_ImmediatePriority,qC=Ke.unstable_UserBlockingPriority,KC=Ke.unstable_NormalPriority,JC=Ke.unstable_LowPriority,YC=Ke.unstable_IdlePriority,Pc={},Xb=Vg!==void 0?Vg:function(){},Gn=null,tu=null,Tc=!1,Wg=Yf(),ut=1e4>Wg?Yf:function(){return Yf()-Wg};function Os(){switch(Yb()){case mh:return 99;case qC:return 98;case KC:return 97;case JC:return 96;case YC:return 95;default:throw Error(V(332))}}function XC(n){switch(n){case 99:return mh;case 98:return qC;case 97:return KC;case 96:return JC;case 95:return YC;default:throw Error(V(332))}}function vr(n,e){return n=XC(n),Kb(n,e)}function fl(n,e,t){return n=XC(n),Bp(n,e,t)}function Rn(){if(tu!==null){var n=tu;tu=null,Jf(n)}QC()}function QC(){if(!Tc&&Gn!==null){Tc=!0;var n=0;try{var e=Gn;vr(99,function(){for(;n<e.length;n++){var t=e[n];do t=t(!0);while(t!==null)}}),Gn=null}catch(t){throw Gn!==null&&(Gn=Gn.slice(n+1)),Bp(mh,Rn),t}finally{Tc=!1}}}var Qb=_r.ReactCurrentBatchConfig;function cn(n,e){if(n&&n.defaultProps){e=Pe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var Eu=Ui(null),ku=null,ss=null,Ou=null;function jp(){Ou=ss=ku=null}function $p(n){var e=Eu.current;Ee(Eu),n.type._context._currentValue=e}function ZC(n,e){for(;n!==null;){var t=n.alternate;if((n.childLanes&e)===e){if(t===null||(t.childLanes&e)===e)break;t.childLanes|=e}else n.childLanes|=e,t!==null&&(t.childLanes|=e);n=n.return}}function ps(n,e){ku=n,Ou=ss=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&e)!==0&&(dn=!0),n.firstContext=null)}function nn(n,e){if(Ou!==n&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Ou=n,e=1073741823),e={context:n,observedBits:e,next:null},ss===null){if(ku===null)throw Error(V(308));ss=e,ku.dependencies={lanes:0,firstContext:e,responders:null}}else ss=ss.next=e;return n._currentValue}var gi=!1;function Gp(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function eS(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ni(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Ii(n,e){if(n=n.updateQueue,n!==null){n=n.shared;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}}function Bg(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function dl(n,e,t,i){var r=n.updateQueue;gi=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var a=l,u=a.next;a.next=null,o===null?s=u:o.next=u,o=a;var h=n.alternate;if(h!==null){h=h.updateQueue;var c=h.lastBaseUpdate;c!==o&&(c===null?h.firstBaseUpdate=u:c.next=u,h.lastBaseUpdate=a)}}if(s!==null){c=r.baseState,o=0,h=u=a=null;do{l=s.lane;var f=s.eventTime;if((i&l)===l){h!==null&&(h=h.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var d=n,m=s;switch(l=e,f=t,m.tag){case 1:if(d=m.payload,typeof d=="function"){c=d.call(f,c,l);break e}c=d;break e;case 3:d.flags=d.flags&-4097|64;case 0:if(d=m.payload,l=typeof d=="function"?d.call(f,c,l):d,l==null)break e;c=Pe({},c,l);break e;case 2:gi=!0}}s.callback!==null&&(n.flags|=32,l=r.effects,l===null?r.effects=[s]:l.push(s))}else f={eventTime:f,lane:l,tag:s.tag,payload:s.payload,callback:s.callback,next:null},h===null?(u=h=f,a=c):h=h.next=f,o|=l;if(s=s.next,s===null){if(l=r.shared.pending,l===null)break;s=l.next,l.next=null,r.lastBaseUpdate=l,r.shared.pending=null}}while(1);h===null&&(a=c),r.baseState=a,r.firstBaseUpdate=u,r.lastBaseUpdate=h,Nl|=o,n.lanes=o,n.memoizedState=c}}function jg(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(V(191,r));r.call(i)}}}var tS=new oh.Component().refs;function _u(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Pe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var gh={isMounted:function(n){return(n=n._reactInternals)?Pr(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Gt(),r=Di(n),s=Ni(i,r);s.payload=e,t!=null&&(s.callback=t),Ii(n,s),Ri(n,r,i)},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Gt(),r=Di(n),s=Ni(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),Ii(n,s),Ri(n,r,i)},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Gt(),i=Di(n),r=Ni(t,i);r.tag=2,e!=null&&(r.callback=e),Ii(n,r),Ri(n,i,t)}};function $g(n,e,t,i,r,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!hl(t,i)||!hl(r,s):!0}function nS(n,e,t){var i=!1,r=Wi,s=e.contextType;return typeof s=="object"&&s!==null?s=nn(s):(r=It(e)?gr:dt.current,i=e.contextTypes,s=(i=i!=null)?ks(n,r):Wi),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gh,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function Gg(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&gh.enqueueReplaceState(e,e.state,null)}function Xf(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs=tS,Gp(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=nn(s):(s=It(e)?gr:dt.current,r.context=ks(n,s)),dl(n,t,r,i),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(_u(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&gh.enqueueReplaceState(r,r.state,null),dl(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4)}var ha=Array.isArray;function lo(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(V(309));var i=t.stateNode}if(!i)throw Error(V(147,n));var r=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(s){var o=i.refs;o===tS&&(o=i.refs={}),s===null?delete o[r]:o[r]=s},e._stringRef=r,e)}if(typeof n!="string")throw Error(V(284));if(!t._owner)throw Error(V(290,n))}return n}function ca(n,e){if(n.type!=="textarea")throw Error(V(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function iS(n){function e(v,p){if(n){var y=v.lastEffect;y!==null?(y.nextEffect=p,v.lastEffect=p):v.firstEffect=v.lastEffect=p,p.nextEffect=null,p.flags=8}}function t(v,p){if(!n)return null;for(;p!==null;)e(v,p),p=p.sibling;return null}function i(v,p){for(v=new Map;p!==null;)p.key!==null?v.set(p.key,p):v.set(p.index,p),p=p.sibling;return v}function r(v,p){return v=ji(v,p),v.index=0,v.sibling=null,v}function s(v,p,y){return v.index=y,n?(y=v.alternate,y!==null?(y=y.index,y<p?(v.flags=2,p):y):(v.flags=2,p)):p}function o(v){return n&&v.alternate===null&&(v.flags=2),v}function l(v,p,y,C){return p===null||p.tag!==6?(p=Rc(y,v.mode,C),p.return=v,p):(p=r(p,y),p.return=v,p)}function a(v,p,y,C){return p!==null&&p.elementType===y.type?(C=r(p,y.props),C.ref=lo(v,p,y),C.return=v,C):(C=su(y.type,y.key,y.props,null,v.mode,C),C.ref=lo(v,p,y),C.return=v,C)}function u(v,p,y,C){return p===null||p.tag!==4||p.stateNode.containerInfo!==y.containerInfo||p.stateNode.implementation!==y.implementation?(p=Lc(y,v.mode,C),p.return=v,p):(p=r(p,y.children||[]),p.return=v,p)}function h(v,p,y,C,b){return p===null||p.tag!==7?(p=ys(y,v.mode,C,b),p.return=v,p):(p=r(p,y),p.return=v,p)}function c(v,p,y){if(typeof p=="string"||typeof p=="number")return p=Rc(""+p,v.mode,y),p.return=v,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Po:return y=su(p.type,p.key,p.props,null,v.mode,y),y.ref=lo(v,null,p),y.return=v,y;case rr:return p=Lc(p,v.mode,y),p.return=v,p}if(ha(p)||to(p))return p=ys(p,v.mode,y,null),p.return=v,p;ca(v,p)}return null}function f(v,p,y,C){var b=p!==null?p.key:null;if(typeof y=="string"||typeof y=="number")return b!==null?null:l(v,p,""+y,C);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Po:return y.key===b?y.type===Si?h(v,p,y.props.children,C,b):a(v,p,y,C):null;case rr:return y.key===b?u(v,p,y,C):null}if(ha(y)||to(y))return b!==null?null:h(v,p,y,C,null);ca(v,y)}return null}function d(v,p,y,C,b){if(typeof C=="string"||typeof C=="number")return v=v.get(y)||null,l(p,v,""+C,b);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Po:return v=v.get(C.key===null?y:C.key)||null,C.type===Si?h(p,v,C.props.children,b,C.key):a(p,v,C,b);case rr:return v=v.get(C.key===null?y:C.key)||null,u(p,v,C,b)}if(ha(C)||to(C))return v=v.get(y)||null,h(p,v,C,b,null);ca(p,C)}return null}function m(v,p,y,C){for(var b=null,_=null,O=p,R=p=0,L=null;O!==null&&R<y.length;R++){O.index>R?(L=O,O=null):L=O.sibling;var A=f(v,O,y[R],C);if(A===null){O===null&&(O=L);break}n&&O&&A.alternate===null&&e(v,O),p=s(A,p,R),_===null?b=A:_.sibling=A,_=A,O=L}if(R===y.length)return t(v,O),b;if(O===null){for(;R<y.length;R++)O=c(v,y[R],C),O!==null&&(p=s(O,p,R),_===null?b=O:_.sibling=O,_=O);return b}for(O=i(v,O);R<y.length;R++)L=d(O,v,R,y[R],C),L!==null&&(n&&L.alternate!==null&&O.delete(L.key===null?R:L.key),p=s(L,p,R),_===null?b=L:_.sibling=L,_=L);return n&&O.forEach(function($){return e(v,$)}),b}function w(v,p,y,C){var b=to(y);if(typeof b!="function")throw Error(V(150));if(y=b.call(y),y==null)throw Error(V(151));for(var _=b=null,O=p,R=p=0,L=null,A=y.next();O!==null&&!A.done;R++,A=y.next()){O.index>R?(L=O,O=null):L=O.sibling;var $=f(v,O,A.value,C);if($===null){O===null&&(O=L);break}n&&O&&$.alternate===null&&e(v,O),p=s($,p,R),_===null?b=$:_.sibling=$,_=$,O=L}if(A.done)return t(v,O),b;if(O===null){for(;!A.done;R++,A=y.next())A=c(v,A.value,C),A!==null&&(p=s(A,p,R),_===null?b=A:_.sibling=A,_=A);return b}for(O=i(v,O);!A.done;R++,A=y.next())A=d(O,v,R,A.value,C),A!==null&&(n&&A.alternate!==null&&O.delete(A.key===null?R:A.key),p=s(A,p,R),_===null?b=A:_.sibling=A,_=A);return n&&O.forEach(function(U){return e(v,U)}),b}return function(v,p,y,C){var b=typeof y=="object"&&y!==null&&y.type===Si&&y.key===null;b&&(y=y.props.children);var _=typeof y=="object"&&y!==null;if(_)switch(y.$$typeof){case Po:e:{for(_=y.key,b=p;b!==null;){if(b.key===_){switch(b.tag){case 7:if(y.type===Si){t(v,b.sibling),p=r(b,y.props.children),p.return=v,v=p;break e}break;default:if(b.elementType===y.type){t(v,b.sibling),p=r(b,y.props),p.ref=lo(v,b,y),p.return=v,v=p;break e}}t(v,b);break}else e(v,b);b=b.sibling}y.type===Si?(p=ys(y.props.children,v.mode,C,y.key),p.return=v,v=p):(C=su(y.type,y.key,y.props,null,v.mode,C),C.ref=lo(v,p,y),C.return=v,v=C)}return o(v);case rr:e:{for(b=y.key;p!==null;){if(p.key===b)if(p.tag===4&&p.stateNode.containerInfo===y.containerInfo&&p.stateNode.implementation===y.implementation){t(v,p.sibling),p=r(p,y.children||[]),p.return=v,v=p;break e}else{t(v,p);break}else e(v,p);p=p.sibling}p=Lc(y,v.mode,C),p.return=v,v=p}return o(v)}if(typeof y=="string"||typeof y=="number")return y=""+y,p!==null&&p.tag===6?(t(v,p.sibling),p=r(p,y),p.return=v,v=p):(t(v,p),p=Rc(y,v.mode,C),p.return=v,v=p),o(v);if(ha(y))return m(v,p,y,C);if(to(y))return w(v,p,y,C);if(_&&ca(v,y),typeof y=="undefined"&&!b)switch(v.tag){case 1:case 22:case 0:case 11:case 15:throw Error(V(152,us(v.type)||"Component"))}return t(v,p)}}var Pu=iS(!0),rS=iS(!1),Al={},Nn=Ui(Al),pl=Ui(Al),ml=Ui(Al);function lr(n){if(n===Al)throw Error(V(174));return n}function Qf(n,e){switch(Ie(ml,e),Ie(pl,n),Ie(Nn,Al),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Mf(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Mf(e,n)}Ee(Nn),Ie(Nn,e)}function _s(){Ee(Nn),Ee(pl),Ee(ml)}function Hg(n){lr(ml.current);var e=lr(Nn.current),t=Mf(e,n.type);e!==t&&(Ie(pl,n),Ie(Nn,t))}function Hp(n){pl.current===n&&(Ee(Nn),Ee(pl))}var Ne=Ui(0);function Tu(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var zn=null,Ei=null,In=!1;function sS(n,e){var t=Qt(5,null,null,0);t.elementType="DELETED",t.type="DELETED",t.stateNode=e,t.return=n,t.flags=8,n.lastEffect!==null?(n.lastEffect.nextEffect=t,n.lastEffect=t):n.firstEffect=n.lastEffect=t}function zg(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function Zf(n){if(In){var e=Ei;if(e){var t=e;if(!zg(n,e)){if(e=ds(t.nextSibling),!e||!zg(n,e)){n.flags=n.flags&-1025|2,In=!1,zn=n;return}sS(zn,t)}zn=n,Ei=ds(e.firstChild)}else n.flags=n.flags&-1025|2,In=!1,zn=n}}function Ug(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;zn=n}function fa(n){if(n!==zn)return!1;if(!In)return Ug(n),In=!0,!1;var e=n.type;if(n.tag!==5||e!=="head"&&e!=="body"&&!qf(e,n.memoizedProps))for(e=Ei;e;)sS(n,e),e=ds(e.nextSibling);if(Ug(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(V(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ei=ds(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ei=null}}else Ei=zn?ds(n.stateNode.nextSibling):null;return!0}function Ac(){Ei=zn=null,In=!1}var ms=[];function zp(){for(var n=0;n<ms.length;n++)ms[n]._workInProgressVersionPrimary=null;ms.length=0}var Uo=_r.ReactCurrentDispatcher,en=_r.ReactCurrentBatchConfig,gl=0,Le=null,lt=null,tt=null,Au=!1,qo=!1;function kt(){throw Error(V(321))}function Up(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Xt(n[t],e[t]))return!1;return!0}function qp(n,e,t,i,r,s){if(gl=s,Le=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Uo.current=n===null||n.memoizedState===null?eE:tE,n=t(i,r),qo){s=0;do{if(qo=!1,!(25>s))throw Error(V(301));s+=1,tt=lt=null,e.updateQueue=null,Uo.current=nE,n=t(i,r)}while(qo)}if(Uo.current=Ru,e=lt!==null&&lt.next!==null,gl=0,tt=lt=Le=null,Au=!1,e)throw Error(V(300));return n}function ar(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tt===null?Le.memoizedState=tt=n:tt=tt.next=n,tt}function Tr(){if(lt===null){var n=Le.alternate;n=n!==null?n.memoizedState:null}else n=lt.next;var e=tt===null?Le.memoizedState:tt.next;if(e!==null)tt=e,lt=n;else{if(n===null)throw Error(V(310));lt=n,n={memoizedState:lt.memoizedState,baseState:lt.baseState,baseQueue:lt.baseQueue,queue:lt.queue,next:null},tt===null?Le.memoizedState=tt=n:tt=tt.next=n}return tt}function _n(n,e){return typeof e=="function"?e(n):e}function ao(n){var e=Tr(),t=e.queue;if(t===null)throw Error(V(311));t.lastRenderedReducer=n;var i=lt,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,t.pending=null}if(r!==null){r=r.next,i=i.baseState;var l=o=s=null,a=r;do{var u=a.lane;if((gl&u)===u)l!==null&&(l=l.next={lane:0,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null}),i=a.eagerReducer===n?a.eagerState:n(i,a.action);else{var h={lane:u,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null};l===null?(o=l=h,s=i):l=l.next=h,Le.lanes|=u,Nl|=u}a=a.next}while(a!==null&&a!==r);l===null?s=i:l.next=o,Xt(i,e.memoizedState)||(dn=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=l,t.lastRenderedState=i}return[e.memoizedState,t.dispatch]}function uo(n){var e=Tr(),t=e.queue;if(t===null)throw Error(V(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=n(s,o.action),o=o.next;while(o!==r);Xt(s,e.memoizedState)||(dn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function qg(n,e,t){var i=e._getVersion;i=i(e._source);var r=e._workInProgressVersionPrimary;if(r!==null?n=r===i:(n=n.mutableReadLanes,(n=(gl&n)===n)&&(e._workInProgressVersionPrimary=i,ms.push(e))),n)return t(e._source);throw ms.push(e),Error(V(350))}function oS(n,e,t,i){var r=wt;if(r===null)throw Error(V(349));var s=e._getVersion,o=s(e._source),l=Uo.current,a=l.useState(function(){return qg(r,e,t)}),u=a[1],h=a[0];a=tt;var c=n.memoizedState,f=c.refs,d=f.getSnapshot,m=c.source;c=c.subscribe;var w=Le;return n.memoizedState={refs:f,source:e,subscribe:i},l.useEffect(function(){f.getSnapshot=t,f.setSnapshot=u;var v=s(e._source);if(!Xt(o,v)){v=t(e._source),Xt(h,v)||(u(v),v=Di(w),r.mutableReadLanes|=v&r.pendingLanes),v=r.mutableReadLanes,r.entangledLanes|=v;for(var p=r.entanglements,y=v;0<y;){var C=31-Vi(y),b=1<<C;p[C]|=v,y&=~b}}},[t,e,i]),l.useEffect(function(){return i(e._source,function(){var v=f.getSnapshot,p=f.setSnapshot;try{p(v(e._source));var y=Di(w);r.mutableReadLanes|=y&r.pendingLanes}catch(C){p(function(){throw C})}})},[e,i]),Xt(d,t)&&Xt(m,e)&&Xt(c,i)||(n={pending:null,dispatch:null,lastRenderedReducer:_n,lastRenderedState:h},n.dispatch=u=Yp.bind(null,Le,n),a.queue=n,a.baseQueue=null,h=qg(r,e,t),a.memoizedState=a.baseState=h),h}function lS(n,e,t){var i=Tr();return oS(i,n,e,t)}function ho(n){var e=ar();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n=e.queue={pending:null,dispatch:null,lastRenderedReducer:_n,lastRenderedState:n},n=n.dispatch=Yp.bind(null,Le,n),[e.memoizedState,n]}function Nu(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Le.updateQueue,e===null?(e={lastEffect:null},Le.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function Kg(n){var e=ar();return n={current:n},e.memoizedState=n}function Iu(){return Tr().memoizedState}function ed(n,e,t,i){var r=ar();Le.flags|=n,r.memoizedState=Nu(1|e,t,void 0,i===void 0?null:i)}function Kp(n,e,t,i){var r=Tr();i=i===void 0?null:i;var s=void 0;if(lt!==null){var o=lt.memoizedState;if(s=o.destroy,i!==null&&Up(i,o.deps)){Nu(e,t,s,i);return}}Le.flags|=n,r.memoizedState=Nu(1|e,t,s,i)}function Jg(n,e){return ed(516,4,n,e)}function Du(n,e){return Kp(516,4,n,e)}function aS(n,e){return Kp(4,2,n,e)}function uS(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function hS(n,e,t){return t=t!=null?t.concat([n]):null,Kp(4,2,uS.bind(null,e,n),t)}function Jp(){}function cS(n,e){var t=Tr();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Up(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function fS(n,e){var t=Tr();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Up(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function Zb(n,e){var t=Os();vr(98>t?98:t,function(){n(!0)}),vr(97<t?97:t,function(){var i=en.transition;en.transition=1;try{n(!1),e()}finally{en.transition=i}})}function Yp(n,e,t){var i=Gt(),r=Di(n),s={lane:r,action:t,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(o===null?s.next=s:(s.next=o.next,o.next=s),e.pending=s,o=n.alternate,n===Le||o!==null&&o===Le)qo=Au=!0;else{if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var l=e.lastRenderedState,a=o(l,t);if(s.eagerReducer=o,s.eagerState=a,Xt(a,l))return}catch{}finally{}Ri(n,r,i)}}var Ru={readContext:nn,useCallback:kt,useContext:kt,useEffect:kt,useImperativeHandle:kt,useLayoutEffect:kt,useMemo:kt,useReducer:kt,useRef:kt,useState:kt,useDebugValue:kt,useDeferredValue:kt,useTransition:kt,useMutableSource:kt,useOpaqueIdentifier:kt,unstable_isNewReconciler:!1},eE={readContext:nn,useCallback:function(n,e){return ar().memoizedState=[n,e===void 0?null:e],n},useContext:nn,useEffect:Jg,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,ed(4,2,uS.bind(null,e,n),t)},useLayoutEffect:function(n,e){return ed(4,2,n,e)},useMemo:function(n,e){var t=ar();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=ar();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n=i.queue={pending:null,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},n=n.dispatch=Yp.bind(null,Le,n),[i.memoizedState,n]},useRef:Kg,useState:ho,useDebugValue:Jp,useDeferredValue:function(n){var e=ho(n),t=e[0],i=e[1];return Jg(function(){var r=en.transition;en.transition=1;try{i(n)}finally{en.transition=r}},[n]),t},useTransition:function(){var n=ho(!1),e=n[0];return n=Zb.bind(null,n[1]),Kg(n),[n,e]},useMutableSource:function(n,e,t){var i=ar();return i.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:n,subscribe:t},oS(i,n,e,t)},useOpaqueIdentifier:function(){if(In){var n=!1,e=qb(function(){throw n||(n=!0,t("r:"+(_c++).toString(36))),Error(V(355))}),t=ho(e)[1];return(Le.mode&2)===0&&(Le.flags|=516,Nu(5,function(){t("r:"+(_c++).toString(36))},void 0,null)),e}return e="r:"+(_c++).toString(36),ho(e),e},unstable_isNewReconciler:!1},tE={readContext:nn,useCallback:cS,useContext:nn,useEffect:Du,useImperativeHandle:hS,useLayoutEffect:aS,useMemo:fS,useReducer:ao,useRef:Iu,useState:function(){return ao(_n)},useDebugValue:Jp,useDeferredValue:function(n){var e=ao(_n),t=e[0],i=e[1];return Du(function(){var r=en.transition;en.transition=1;try{i(n)}finally{en.transition=r}},[n]),t},useTransition:function(){var n=ao(_n)[0];return[Iu().current,n]},useMutableSource:lS,useOpaqueIdentifier:function(){return ao(_n)[0]},unstable_isNewReconciler:!1},nE={readContext:nn,useCallback:cS,useContext:nn,useEffect:Du,useImperativeHandle:hS,useLayoutEffect:aS,useMemo:fS,useReducer:uo,useRef:Iu,useState:function(){return uo(_n)},useDebugValue:Jp,useDeferredValue:function(n){var e=uo(_n),t=e[0],i=e[1];return Du(function(){var r=en.transition;en.transition=1;try{i(n)}finally{en.transition=r}},[n]),t},useTransition:function(){var n=uo(_n)[0];return[Iu().current,n]},useMutableSource:lS,useOpaqueIdentifier:function(){return uo(_n)[0]},unstable_isNewReconciler:!1},iE=_r.ReactCurrentOwner,dn=!1;function _t(n,e,t,i){e.child=n===null?rS(e,null,t,i):Pu(e,n.child,t,i)}function Yg(n,e,t,i,r){t=t.render;var s=e.ref;return ps(e,r),i=qp(n,e,t,i,s,r),n!==null&&!dn?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~r,Un(n,e,r)):(e.flags|=1,_t(n,e,i,r),e.child)}function Xg(n,e,t,i,r,s){if(n===null){var o=t.type;return typeof o=="function"&&!nm(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,dS(n,e,o,i,r,s)):(n=su(t.type,null,i,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}return o=n.child,(r&s)===0&&(r=o.memoizedProps,t=t.compare,t=t!==null?t:hl,t(r,i)&&n.ref===e.ref)?Un(n,e,s):(e.flags|=1,n=ji(o,i),n.ref=e.ref,n.return=e,e.child=n)}function dS(n,e,t,i,r,s){if(n!==null&&hl(n.memoizedProps,i)&&n.ref===e.ref)if(dn=!1,(s&r)!==0)(n.flags&16384)!==0&&(dn=!0);else return e.lanes=n.lanes,Un(n,e,s);return td(n,e,t,i,s)}function Nc(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden"||i.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},pa(e,t);else if((t&1073741824)!==0)e.memoizedState={baseLanes:0},pa(e,s!==null?s.baseLanes:t);else return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n},pa(e,n),null;else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,pa(e,i);return _t(n,e,r,t),e.child}function pS(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=128)}function td(n,e,t,i,r){var s=It(t)?gr:dt.current;return s=ks(e,s),ps(e,r),t=qp(n,e,t,i,s,r),n!==null&&!dn?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~r,Un(n,e,r)):(e.flags|=1,_t(n,e,t,r),e.child)}function Qg(n,e,t,i,r){if(It(t)){var s=!0;eu(e)}else s=!1;if(ps(e,r),e.stateNode===null)n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),nS(e,t,i),Xf(e,t,i,r),i=!0;else if(n===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var a=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=nn(u):(u=It(t)?gr:dt.current,u=ks(e,u));var h=t.getDerivedStateFromProps,c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";c||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==i||a!==u)&&Gg(e,o,i,u),gi=!1;var f=e.memoizedState;o.state=f,dl(e,i,o,r),a=e.memoizedState,l!==i||f!==a||Nt.current||gi?(typeof h=="function"&&(_u(e,t,h,i),a=e.memoizedState),(l=gi||$g(e,t,l,i,f,a,u))?(c||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4)):(typeof o.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=i,e.memoizedState=a),o.props=i,o.state=a,o.context=u,i=l):(typeof o.componentDidMount=="function"&&(e.flags|=4),i=!1)}else{o=e.stateNode,eS(n,e),l=e.memoizedProps,u=e.type===e.elementType?l:cn(e.type,l),o.props=u,c=e.pendingProps,f=o.context,a=t.contextType,typeof a=="object"&&a!==null?a=nn(a):(a=It(t)?gr:dt.current,a=ks(e,a));var d=t.getDerivedStateFromProps;(h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==c||f!==a)&&Gg(e,o,i,a),gi=!1,f=e.memoizedState,o.state=f,dl(e,i,o,r);var m=e.memoizedState;l!==c||f!==m||Nt.current||gi?(typeof d=="function"&&(_u(e,t,d,i),m=e.memoizedState),(u=gi||$g(e,t,u,i,f,m,a))?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,m,a),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,m,a)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=256),e.memoizedProps=i,e.memoizedState=m),o.props=i,o.state=m,o.context=a,i=u):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=256),i=!1)}return nd(n,e,t,i,s,r)}function nd(n,e,t,i,r,s){pS(n,e);var o=(e.flags&64)!==0;if(!i&&!o)return r&&Fg(e,t,!1),Un(n,e,s);i=e.stateNode,iE.current=e;var l=o&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&o?(e.child=Pu(e,n.child,null,s),e.child=Pu(e,null,l,s)):_t(n,e,l,s),e.memoizedState=i.state,r&&Fg(e,t,!0),e.child}function Zg(n){var e=n.stateNode;e.pendingContext?Mg(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Mg(n,e.context,!1),Qf(n,e.containerInfo)}var da={dehydrated:null,retryLane:0};function ev(n,e,t){var i=e.pendingProps,r=Ne.current,s=!1,o;return(o=(e.flags&64)!==0)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(s=!0,e.flags&=-65):n!==null&&n.memoizedState===null||i.fallback===void 0||i.unstable_avoidThisFallback===!0||(r|=1),Ie(Ne,r&1),n===null?(i.fallback!==void 0&&Zf(e),n=i.children,r=i.fallback,s?(n=tv(e,n,r,t),e.child.memoizedState={baseLanes:t},e.memoizedState=da,n):typeof i.unstable_expectedLoadTime=="number"?(n=tv(e,n,r,t),e.child.memoizedState={baseLanes:t},e.memoizedState=da,e.lanes=33554432,n):(t=im({mode:"visible",children:n},e.mode,t,null),t.return=e,e.child=t)):n.memoizedState!==null?s?(i=iv(n,e,i.children,i.fallback,t),s=e.child,r=n.child.memoizedState,s.memoizedState=r===null?{baseLanes:t}:{baseLanes:r.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=da,i):(t=nv(n,e,i.children,t),e.memoizedState=null,t):s?(i=iv(n,e,i.children,i.fallback,t),s=e.child,r=n.child.memoizedState,s.memoizedState=r===null?{baseLanes:t}:{baseLanes:r.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=da,i):(t=nv(n,e,i.children,t),e.memoizedState=null,t)}function tv(n,e,t,i){var r=n.mode,s=n.child;return e={mode:"hidden",children:e},(r&2)===0&&s!==null?(s.childLanes=0,s.pendingProps=e):s=im(e,r,0,null),t=ys(t,r,i,null),s.return=n,t.return=n,s.sibling=t,n.child=s,t}function nv(n,e,t,i){var r=n.child;return n=r.sibling,t=ji(r,{mode:"visible",children:t}),(e.mode&2)===0&&(t.lanes=i),t.return=e,t.sibling=null,n!==null&&(n.nextEffect=null,n.flags=8,e.firstEffect=e.lastEffect=n),e.child=t}function iv(n,e,t,i,r){var s=e.mode,o=n.child;n=o.sibling;var l={mode:"hidden",children:t};return(s&2)===0&&e.child!==o?(t=e.child,t.childLanes=0,t.pendingProps=l,o=t.lastEffect,o!==null?(e.firstEffect=t.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null):t=ji(o,l),n!==null?i=ji(n,i):(i=ys(i,s,r,null),i.flags|=2),i.return=e,t.return=e,t.sibling=i,e.child=t,i}function rv(n,e){n.lanes|=e;var t=n.alternate;t!==null&&(t.lanes|=e),ZC(n.return,e)}function Ic(n,e,t,i,r,s){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r,lastEffect:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=t,o.tailMode=r,o.lastEffect=s)}function sv(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(_t(n,e,i.children,t),i=Ne.current,(i&2)!==0)i=i&1|2,e.flags|=64;else{if(n!==null&&(n.flags&64)!==0)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&rv(n,t);else if(n.tag===19)rv(n,t);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Ie(Ne,i),(e.mode&2)===0)e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&Tu(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Ic(e,!1,r,t,s,e.lastEffect);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&Tu(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}Ic(e,!0,t,null,s,e.lastEffect);break;case"together":Ic(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Un(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Nl|=e.lanes,(t&e.childLanes)!==0){if(n!==null&&e.child!==n.child)throw Error(V(153));if(e.child!==null){for(n=e.child,t=ji(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ji(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}return null}var mS,id,gS,vS;mS=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};id=function(){};gS=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,lr(Nn.current);var s=null;switch(t){case"input":r=Af(n,r),i=Af(n,i),s=[];break;case"option":r=Df(n,r),i=Df(n,i),s=[];break;case"select":r=Pe({},r,{value:void 0}),i=Pe({},i,{value:void 0}),s=[];break;case"textarea":r=Rf(n,r),i=Rf(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=wu)}Ff(t,i);var o;t=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(il.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var a=i[u];if(l=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&a!==l&&(a!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||a&&a.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in a)a.hasOwnProperty(o)&&l[o]!==a[o]&&(t||(t={}),t[o]=a[o])}else t||(s||(s=[]),s.push(u,t)),t=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,l=l?l.__html:void 0,a!=null&&l!==a&&(s=s||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(s=s||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(il.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&xe("scroll",n),s||l===a||(s=[])):typeof a=="object"&&a!==null&&a.$$typeof===bp?a.toString():(s=s||[]).push(u,a))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};vS=function(n,e,t,i){t!==i&&(e.flags|=4)};function co(n,e){if(!In)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function rE(n,e,t){var i=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return It(e.type)&&bu(),null;case 3:return _s(),Ee(Nt),Ee(dt),zp(),i=e.stateNode,i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(fa(e)?e.flags|=4:i.hydrate||(e.flags|=256)),id(e),null;case 5:Hp(e);var r=lr(ml.current);if(t=e.type,n!==null&&e.stateNode!=null)gS(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=128);else{if(!i){if(e.stateNode===null)throw Error(V(166));return null}if(n=lr(Nn.current),fa(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[bi]=e,i[xu]=s,t){case"dialog":xe("cancel",i),xe("close",i);break;case"iframe":case"object":case"embed":xe("load",i);break;case"video":case"audio":for(n=0;n<Ao.length;n++)xe(Ao[n],i);break;case"source":xe("error",i);break;case"img":case"image":case"link":xe("error",i),xe("load",i);break;case"details":xe("toggle",i);break;case"input":sg(i,s),xe("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},xe("invalid",i);break;case"textarea":lg(i,s),xe("invalid",i)}Ff(t,s),n=null;for(var o in s)s.hasOwnProperty(o)&&(r=s[o],o==="children"?typeof r=="string"?i.textContent!==r&&(n=["children",r]):typeof r=="number"&&i.textContent!==""+r&&(n=["children",""+r]):il.hasOwnProperty(o)&&r!=null&&o==="onScroll"&&xe("scroll",i));switch(t){case"input":oa(i),og(i,s,!0);break;case"textarea":oa(i),ag(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=wu)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{switch(o=r.nodeType===9?r:r.ownerDocument,n===Lf.html&&(n=hC(t)),n===Lf.html?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=o.createElement(t,{is:i.is}):(n=o.createElement(t),t==="select"&&(o=n,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):n=o.createElementNS(n,t),n[bi]=e,n[xu]=i,mS(n,e,!1,!1),e.stateNode=n,o=Vf(t,i),t){case"dialog":xe("cancel",n),xe("close",n),r=i;break;case"iframe":case"object":case"embed":xe("load",n),r=i;break;case"video":case"audio":for(r=0;r<Ao.length;r++)xe(Ao[r],n);r=i;break;case"source":xe("error",n),r=i;break;case"img":case"image":case"link":xe("error",n),xe("load",n),r=i;break;case"details":xe("toggle",n),r=i;break;case"input":sg(n,i),r=Af(n,i),xe("invalid",n);break;case"option":r=Df(n,i);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=Pe({},i,{value:void 0}),xe("invalid",n);break;case"textarea":lg(n,i),r=Rf(n,i),xe("invalid",n);break;default:r=i}Ff(t,r);var l=r;for(s in l)if(l.hasOwnProperty(s)){var a=l[s];s==="style"?dC(n,a):s==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&cC(n,a)):s==="children"?typeof a=="string"?(t!=="textarea"||a!=="")&&rl(n,a):typeof a=="number"&&rl(n,""+a):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(il.hasOwnProperty(s)?a!=null&&s==="onScroll"&&xe("scroll",n):a!=null&&vp(n,s,a,o))}switch(t){case"input":oa(n),og(n,i,!1);break;case"textarea":oa(n),ag(n);break;case"option":i.value!=null&&n.setAttribute("value",""+Fi(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?hs(n,!!i.multiple,s,!1):i.defaultValue!=null&&hs(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=wu)}HC(t,i)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(n&&e.stateNode!=null)vS(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(V(166));t=lr(ml.current),lr(Nn.current),fa(e)?(i=e.stateNode,t=e.memoizedProps,i[bi]=e,i.nodeValue!==t&&(e.flags|=4)):(i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[bi]=e,e.stateNode=i)}return null;case 13:return Ee(Ne),i=e.memoizedState,(e.flags&64)!==0?(e.lanes=t,e):(i=i!==null,t=!1,n===null?e.memoizedProps.fallback!==void 0&&fa(e):t=n.memoizedState!==null,i&&!t&&(e.mode&2)!==0&&(n===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(Ne.current&1)!==0?nt===0&&(nt=3):((nt===0||nt===3)&&(nt=4),wt===null||(Nl&134217727)===0&&(Vs&134217727)===0||gs(wt,ct))),(i||t)&&(e.flags|=4),null);case 4:return _s(),id(e),n===null&&jC(e.stateNode.containerInfo),null;case 10:return $p(e),null;case 17:return It(e.type)&&bu(),null;case 19:if(Ee(Ne),i=e.memoizedState,i===null)return null;if(s=(e.flags&64)!==0,o=i.rendering,o===null)if(s)co(i,!1);else{if(nt!==0||n!==null&&(n.flags&64)!==0)for(n=e.child;n!==null;){if(o=Tu(n),o!==null){for(e.flags|=64,co(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),i.lastEffect===null&&(e.firstEffect=null),e.lastEffect=i.lastEffect,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ie(Ne,Ne.current&1|2),e.child}n=n.sibling}i.tail!==null&&ut()>ud&&(e.flags|=64,s=!0,co(i,!1),e.lanes=33554432)}else{if(!s)if(n=Tu(o),n!==null){if(e.flags|=64,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),co(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!In)return e=e.lastEffect=i.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*ut()-i.renderingStartTime>ud&&t!==1073741824&&(e.flags|=64,s=!0,co(i,!1),e.lanes=33554432);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.lastEffect=e.lastEffect,i.renderingStartTime=ut(),t.sibling=null,e=Ne.current,Ie(Ne,s?e&1|2:e&1),t):null;case 23:case 24:return tm(),n!==null&&n.memoizedState!==null!=(e.memoizedState!==null)&&i.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(V(156,e.tag))}function sE(n){switch(n.tag){case 1:It(n.type)&&bu();var e=n.flags;return e&4096?(n.flags=e&-4097|64,n):null;case 3:if(_s(),Ee(Nt),Ee(dt),zp(),e=n.flags,(e&64)!==0)throw Error(V(285));return n.flags=e&-4097|64,n;case 5:return Hp(n),null;case 13:return Ee(Ne),e=n.flags,e&4096?(n.flags=e&-4097|64,n):null;case 19:return Ee(Ne),null;case 4:return _s(),null;case 10:return $p(n),null;case 23:case 24:return tm(),null;default:return null}}function Xp(n,e){try{var t="",i=e;do t+=Wx(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r}}function rd(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var oE=typeof WeakMap=="function"?WeakMap:Map;function yS(n,e,t){t=Ni(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Mu||(Mu=!0,hd=i),rd(n,e)},t}function CS(n,e,t){t=Ni(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return rd(n,e),i(r)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){typeof i!="function"&&(Pn===null?Pn=new Set([this]):Pn.add(this),rd(n,e));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}var lE=typeof WeakSet=="function"?WeakSet:Set;function ov(n){var e=n.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(t){Li(n,t)}else e.current=null}function aE(n,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&n!==null){var t=n.memoizedProps,i=n.memoizedState;n=e.stateNode,e=n.getSnapshotBeforeUpdate(e.elementType===e.type?t:cn(e.type,t),i),n.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&Vp(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(V(163))}function uE(n,e,t){switch(t.tag){case 0:case 11:case 15:case 22:if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{if((n.tag&3)===3){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{var r=n;i=r.next,r=r.tag,(r&4)!==0&&(r&1)!==0&&(PS(t,n),vE(t,n)),n=i}while(n!==e)}return;case 1:n=t.stateNode,t.flags&4&&(e===null?n.componentDidMount():(i=t.elementType===t.type?e.memoizedProps:cn(t.type,e.memoizedProps),n.componentDidUpdate(i,e.memoizedState,n.__reactInternalSnapshotBeforeUpdate))),e=t.updateQueue,e!==null&&jg(t,e,n);return;case 3:if(e=t.updateQueue,e!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}jg(t,e,n)}return;case 5:n=t.stateNode,e===null&&t.flags&4&&HC(t.type,t.memoizedProps)&&n.focus();return;case 6:return;case 4:return;case 12:return;case 13:t.memoizedState===null&&(t=t.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&bC(t))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(V(163))}function lv(n,e){for(var t=n;;){if(t.tag===5){var i=t.stateNode;if(e)i=i.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none";else{i=t.stateNode;var r=t.memoizedProps.style;r=r!=null&&r.hasOwnProperty("display")?r.display:null,i.style.display=fC("display",r)}}else if(t.tag===6)t.stateNode.nodeValue=e?"":t.memoizedProps;else if((t.tag!==23&&t.tag!==24||t.memoizedState===null||t===n)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break;for(;t.sibling===null;){if(t.return===null||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}}function av(n,e){if(fr&&typeof fr.onCommitFiberUnmount=="function")try{fr.onCommitFiberUnmount(Wp,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(n=e.updateQueue,n!==null&&(n=n.lastEffect,n!==null)){var t=n=n.next;do{var i=t,r=i.destroy;if(i=i.tag,r!==void 0)if((i&4)!==0)PS(e,t);else{i=e;try{r()}catch(s){Li(i,s)}}t=t.next}while(t!==n)}break;case 1:if(ov(e),n=e.stateNode,typeof n.componentWillUnmount=="function")try{n.props=e.memoizedProps,n.state=e.memoizedState,n.componentWillUnmount()}catch(s){Li(e,s)}break;case 5:ov(e);break;case 4:SS(n,e)}}function uv(n){n.alternate=null,n.child=null,n.dependencies=null,n.firstEffect=null,n.lastEffect=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.return=null,n.updateQueue=null}function hv(n){return n.tag===5||n.tag===3||n.tag===4}function cv(n){e:{for(var e=n.return;e!==null;){if(hv(e))break e;e=e.return}throw Error(V(160))}var t=e;switch(e=t.stateNode,t.tag){case 5:var i=!1;break;case 3:e=e.containerInfo,i=!0;break;case 4:e=e.containerInfo,i=!0;break;default:throw Error(V(161))}t.flags&16&&(rl(e,""),t.flags&=-17);e:t:for(t=n;;){for(;t.sibling===null;){if(t.return===null||hv(t.return)){t=null;break e}t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue t;t.child.return=t,t=t.child}if(!(t.flags&2)){t=t.stateNode;break e}}i?sd(n,t,e):od(n,t,e)}function sd(n,e,t){var i=n.tag,r=i===5||i===6;if(r)n=r?n.stateNode:n.stateNode.instance,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=wu));else if(i!==4&&(n=n.child,n!==null))for(sd(n,e,t),n=n.sibling;n!==null;)sd(n,e,t),n=n.sibling}function od(n,e,t){var i=n.tag,r=i===5||i===6;if(r)n=r?n.stateNode:n.stateNode.instance,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(od(n,e,t),n=n.sibling;n!==null;)od(n,e,t),n=n.sibling}function SS(n,e){for(var t=e,i=!1,r,s;;){if(!i){i=t.return;e:for(;;){if(i===null)throw Error(V(160));switch(r=i.stateNode,i.tag){case 5:s=!1;break e;case 3:r=r.containerInfo,s=!0;break e;case 4:r=r.containerInfo,s=!0;break e}i=i.return}i=!0}if(t.tag===5||t.tag===6){e:for(var o=n,l=t,a=l;;)if(av(o,a),a.child!==null&&a.tag!==4)a.child.return=a,a=a.child;else{if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}s?(o=r,l=t.stateNode,o.nodeType===8?o.parentNode.removeChild(l):o.removeChild(l)):r.removeChild(t.stateNode)}else if(t.tag===4){if(t.child!==null){r=t.stateNode.containerInfo,s=!0,t.child.return=t,t=t.child;continue}}else if(av(n,t),t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return,t.tag===4&&(i=!1)}t.sibling.return=t.return,t=t.sibling}}function Dc(n,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var t=e.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do(i.tag&3)===3&&(n=i.destroy,i.destroy=void 0,n!==void 0&&n()),i=i.next;while(i!==t)}return;case 1:return;case 5:if(t=e.stateNode,t!=null){i=e.memoizedProps;var r=n!==null?n.memoizedProps:i;n=e.type;var s=e.updateQueue;if(e.updateQueue=null,s!==null){for(t[xu]=i,n==="input"&&i.type==="radio"&&i.name!=null&&aC(t,i),Vf(n,r),e=Vf(n,i),r=0;r<s.length;r+=2){var o=s[r],l=s[r+1];o==="style"?dC(t,l):o==="dangerouslySetInnerHTML"?cC(t,l):o==="children"?rl(t,l):vp(t,o,l,e)}switch(n){case"input":Nf(t,i);break;case"textarea":uC(t,i);break;case"select":n=t._wrapperState.wasMultiple,t._wrapperState.wasMultiple=!!i.multiple,s=i.value,s!=null?hs(t,!!i.multiple,s,!1):n!==!!i.multiple&&(i.defaultValue!=null?hs(t,!!i.multiple,i.defaultValue,!0):hs(t,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(V(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:t=e.stateNode,t.hydrate&&(t.hydrate=!1,bC(t.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(em=ut(),lv(e.child,!0)),fv(e);return;case 19:fv(e);return;case 17:return;case 23:case 24:lv(e,e.memoizedState!==null);return}throw Error(V(163))}function fv(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new lE),e.forEach(function(i){var r=SE.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function hE(n,e){return n!==null&&(n=n.memoizedState,n===null||n.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var cE=Math.ceil,Lu=_r.ReactCurrentDispatcher,Qp=_r.ReactCurrentOwner,ne=0,wt=null,Ge=null,ct=0,yr=0,ld=Ui(0),nt=0,vh=null,Fs=0,Nl=0,Vs=0,Zp=0,ad=null,em=0,ud=1/0;function Ws(){ud=ut()+500}var G=null,Mu=!1,hd=null,Pn=null,Bi=!1,Ko=null,No=90,cd=[],fd=[],Jn=null,Jo=0,dd=null,nu=-1,Hn=0,iu=0,Yo=null,ru=!1;function Gt(){return(ne&48)!==0?ut():nu!==-1?nu:nu=ut()}function Di(n){if(n=n.mode,(n&2)===0)return 1;if((n&4)===0)return Os()===99?1:2;if(Hn===0&&(Hn=Fs),Qb.transition!==0){iu!==0&&(iu=ad!==null?ad.pendingLanes:0),n=Hn;var e=4186112&~iu;return e&=-e,e===0&&(n=4186112&~n,e=n&-n,e===0&&(e=8192)),e}return n=Os(),(ne&4)!==0&&n===98?n=Cu(12,Hn):(n=tb(n),n=Cu(n,Hn)),n}function Ri(n,e,t){if(50<Jo)throw Jo=0,dd=null,Error(V(185));if(n=yh(n,e),n===null)return null;hh(n,e,t),n===wt&&(Vs|=e,nt===4&&gs(n,ct));var i=Os();e===1?(ne&8)!==0&&(ne&48)===0?pd(n):(rn(n,t),ne===0&&(Ws(),Rn())):((ne&4)===0||i!==98&&i!==99||(Jn===null?Jn=new Set([n]):Jn.add(n)),rn(n,t)),ad=n}function yh(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}function rn(n,e){for(var t=n.callbackNode,i=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,o=n.pendingLanes;0<o;){var l=31-Vi(o),a=1<<l,u=s[l];if(u===-1){if((a&i)===0||(a&r)!==0){u=e,Qr(a);var h=Se;s[l]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=e&&(n.expiredLanes|=a);o&=~a}if(i=al(n,n===wt?ct:0),e=Se,i===0)t!==null&&(t!==Pc&&Jf(t),n.callbackNode=null,n.callbackPriority=0);else{if(t!==null){if(n.callbackPriority===e)return;t!==Pc&&Jf(t)}e===15?(t=pd.bind(null,n),Gn===null?(Gn=[t],tu=Bp(mh,QC)):Gn.push(t),t=Pc):e===14?t=fl(99,pd.bind(null,n)):(t=nb(e),t=fl(t,wS.bind(null,n))),n.callbackPriority=e,n.callbackNode=t}}function wS(n){if(nu=-1,iu=Hn=0,(ne&48)!==0)throw Error(V(327));var e=n.callbackNode;if(qi()&&n.callbackNode!==e)return null;var t=al(n,n===wt?ct:0);if(t===0)return null;var i=t,r=ne;ne|=16;var s=kS();(wt!==n||ct!==i)&&(Ws(),vs(n,i));do try{pE();break}catch(l){ES(n,l)}while(1);if(jp(),Lu.current=s,ne=r,Ge!==null?i=0:(wt=null,ct=0,i=nt),(Fs&Vs)!==0)vs(n,0);else if(i!==0){if(i===2&&(ne|=64,n.hydrate&&(n.hydrate=!1,Vp(n.containerInfo)),t=AC(n),t!==0&&(i=Io(n,t))),i===1)throw e=vh,vs(n,0),gs(n,t),rn(n,ut()),e;switch(n.finishedWork=n.current.alternate,n.finishedLanes=t,i){case 0:case 1:throw Error(V(345));case 2:nr(n);break;case 3:if(gs(n,t),(t&62914560)===t&&(i=em+500-ut(),10<i)){if(al(n,0)!==0)break;if(r=n.suspendedLanes,(r&t)!==t){Gt(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=Dg(nr.bind(null,n),i);break}nr(n);break;case 4:if(gs(n,t),(t&4186112)===t)break;for(i=n.eventTimes,r=-1;0<t;){var o=31-Vi(t);s=1<<o,o=i[o],o>r&&(r=o),t&=~s}if(t=r,t=ut()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*cE(t/1960))-t,10<t){n.timeoutHandle=Dg(nr.bind(null,n),t);break}nr(n);break;case 5:nr(n);break;default:throw Error(V(329))}}return rn(n,ut()),n.callbackNode===e?wS.bind(null,n):null}function gs(n,e){for(e&=~Zp,e&=~Vs,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Vi(e),i=1<<t;n[t]=-1,e&=~i}}function pd(n){if((ne&48)!==0)throw Error(V(327));if(qi(),n===wt&&(n.expiredLanes&ct)!==0){var e=ct,t=Io(n,e);(Fs&Vs)!==0&&(e=al(n,e),t=Io(n,e))}else e=al(n,0),t=Io(n,e);if(n.tag!==0&&t===2&&(ne|=64,n.hydrate&&(n.hydrate=!1,Vp(n.containerInfo)),e=AC(n),e!==0&&(t=Io(n,e))),t===1)throw t=vh,vs(n,0),gs(n,e),rn(n,ut()),t;return n.finishedWork=n.current.alternate,n.finishedLanes=e,nr(n),rn(n,ut()),null}function fE(){if(Jn!==null){var n=Jn;Jn=null,n.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,rn(e,ut())})}Rn()}function xS(n,e){var t=ne;ne|=1;try{return n(e)}finally{ne=t,ne===0&&(Ws(),Rn())}}function bS(n,e){var t=ne;ne&=-2,ne|=8;try{return n(e)}finally{ne=t,ne===0&&(Ws(),Rn())}}function pa(n,e){Ie(ld,yr),yr|=e,Fs|=e}function tm(){yr=ld.current,Ee(ld)}function vs(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,Ub(t)),Ge!==null)for(t=Ge.return;t!==null;){var i=t;switch(i.tag){case 1:i=i.type.childContextTypes,i!=null&&bu();break;case 3:_s(),Ee(Nt),Ee(dt),zp();break;case 5:Hp(i);break;case 4:_s();break;case 13:Ee(Ne);break;case 19:Ee(Ne);break;case 10:$p(i);break;case 23:case 24:tm()}t=t.return}wt=n,Ge=ji(n.current,null),ct=yr=Fs=e,nt=0,vh=null,Zp=Vs=Nl=0}function ES(n,e){do{var t=Ge;try{if(jp(),Uo.current=Ru,Au){for(var i=Le.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Au=!1}if(gl=0,tt=lt=Le=null,qo=!1,Qp.current=null,t===null||t.return===null){nt=1,vh=e,Ge=null;break}e:{var s=n,o=t.return,l=t,a=e;if(e=ct,l.flags|=2048,l.firstEffect=l.lastEffect=null,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a;if((l.mode&2)===0){var h=l.alternate;h?(l.updateQueue=h.updateQueue,l.memoizedState=h.memoizedState,l.lanes=h.lanes):(l.updateQueue=null,l.memoizedState=null)}var c=(Ne.current&1)!==0,f=o;do{var d;if(d=f.tag===13){var m=f.memoizedState;if(m!==null)d=m.dehydrated!==null;else{var w=f.memoizedProps;d=w.fallback===void 0?!1:w.unstable_avoidThisFallback!==!0?!0:!c}}if(d){var v=f.updateQueue;if(v===null){var p=new Set;p.add(u),f.updateQueue=p}else v.add(u);if((f.mode&2)===0){if(f.flags|=64,l.flags|=16384,l.flags&=-2981,l.tag===1)if(l.alternate===null)l.tag=17;else{var y=Ni(-1,1);y.tag=2,Ii(l,y)}l.lanes|=1;break e}a=void 0,l=e;var C=s.pingCache;if(C===null?(C=s.pingCache=new oE,a=new Set,C.set(u,a)):(a=C.get(u),a===void 0&&(a=new Set,C.set(u,a))),!a.has(l)){a.add(l);var b=CE.bind(null,s,u,l);u.then(b,b)}f.flags|=4096,f.lanes=e;break e}f=f.return}while(f!==null);a=Error((us(l.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}nt!==5&&(nt=2),a=Xp(a,l),f=o;do{switch(f.tag){case 3:s=a,f.flags|=4096,e&=-e,f.lanes|=e;var _=yS(f,s,e);Bg(f,_);break e;case 1:s=a;var O=f.type,R=f.stateNode;if((f.flags&64)===0&&(typeof O.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(Pn===null||!Pn.has(R)))){f.flags|=4096,e&=-e,f.lanes|=e;var L=CS(f,s,e);Bg(f,L);break e}}f=f.return}while(f!==null)}_S(t)}catch(A){e=A,Ge===t&&t!==null&&(Ge=t=t.return);continue}break}while(1)}function kS(){var n=Lu.current;return Lu.current=Ru,n===null?Ru:n}function Io(n,e){var t=ne;ne|=16;var i=kS();wt===n&&ct===e||vs(n,e);do try{dE();break}catch(r){ES(n,r)}while(1);if(jp(),ne=t,Lu.current=i,Ge!==null)throw Error(V(261));return wt=null,ct=0,nt}function dE(){for(;Ge!==null;)OS(Ge)}function pE(){for(;Ge!==null&&!Jb();)OS(Ge)}function OS(n){var e=TS(n.alternate,n,yr);n.memoizedProps=n.pendingProps,e===null?_S(n):Ge=e,Qp.current=null}function _S(n){var e=n;do{var t=e.alternate;if(n=e.return,(e.flags&2048)===0){if(t=rE(t,e,yr),t!==null){Ge=t;return}if(t=e,t.tag!==24&&t.tag!==23||t.memoizedState===null||(yr&1073741824)!==0||(t.mode&4)===0){for(var i=0,r=t.child;r!==null;)i|=r.lanes|r.childLanes,r=r.sibling;t.childLanes=i}n!==null&&(n.flags&2048)===0&&(n.firstEffect===null&&(n.firstEffect=e.firstEffect),e.lastEffect!==null&&(n.lastEffect!==null&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.flags&&(n.lastEffect!==null?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(t=sE(e),t!==null){t.flags&=2047,Ge=t;return}n!==null&&(n.firstEffect=n.lastEffect=null,n.flags|=2048)}if(e=e.sibling,e!==null){Ge=e;return}Ge=e=n}while(e!==null);nt===0&&(nt=5)}function nr(n){var e=Os();return vr(99,mE.bind(null,n,e)),null}function mE(n,e){do qi();while(Ko!==null);if((ne&48)!==0)throw Error(V(327));var t=n.finishedWork;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(V(177));n.callbackNode=null;var i=t.lanes|t.childLanes,r=i,s=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;for(var o=n.eventTimes,l=n.expirationTimes;0<s;){var a=31-Vi(s),u=1<<a;r[a]=0,o[a]=-1,l[a]=-1,s&=~u}if(Jn!==null&&(i&24)===0&&Jn.has(n)&&Jn.delete(n),n===wt&&(Ge=wt=null,ct=0),1<t.flags?t.lastEffect!==null?(t.lastEffect.nextEffect=t,i=t.firstEffect):i=t:i=t.firstEffect,i!==null){if(r=ne,ne|=32,Qp.current=null,kc=Xa,o=Og(),Hf(o)){if("selectionStart"in o)l={start:o.selectionStart,end:o.selectionEnd};else e:if(l=(l=o.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&u.rangeCount!==0){l=u.anchorNode,s=u.anchorOffset,a=u.focusNode,u=u.focusOffset;try{l.nodeType,a.nodeType}catch{l=null;break e}var h=0,c=-1,f=-1,d=0,m=0,w=o,v=null;t:for(;;){for(var p;w!==l||s!==0&&w.nodeType!==3||(c=h+s),w!==a||u!==0&&w.nodeType!==3||(f=h+u),w.nodeType===3&&(h+=w.nodeValue.length),(p=w.firstChild)!==null;)v=w,w=p;for(;;){if(w===o)break t;if(v===l&&++d===s&&(c=h),v===a&&++m===u&&(f=h),(p=w.nextSibling)!==null)break;w=v,v=w.parentNode}w=p}l=c===-1||f===-1?null:{start:c,end:f}}else l=null;l=l||{start:0,end:0}}else l=null;Oc={focusedElem:o,selectionRange:l},Xa=!1,Yo=null,ru=!1,G=i;do try{gE()}catch(A){if(G===null)throw Error(V(330));Li(G,A),G=G.nextEffect}while(G!==null);Yo=null,G=i;do try{for(o=n;G!==null;){var y=G.flags;if(y&16&&rl(G.stateNode,""),y&128){var C=G.alternate;if(C!==null){var b=C.ref;b!==null&&(typeof b=="function"?b(null):b.current=null)}}switch(y&1038){case 2:cv(G),G.flags&=-3;break;case 6:cv(G),G.flags&=-3,Dc(G.alternate,G);break;case 1024:G.flags&=-1025;break;case 1028:G.flags&=-1025,Dc(G.alternate,G);break;case 4:Dc(G.alternate,G);break;case 8:l=G,SS(o,l);var _=l.alternate;uv(l),_!==null&&uv(_)}G=G.nextEffect}}catch(A){if(G===null)throw Error(V(330));Li(G,A),G=G.nextEffect}while(G!==null);if(b=Oc,C=Og(),y=b.focusedElem,o=b.selectionRange,C!==y&&y&&y.ownerDocument&&VC(y.ownerDocument.documentElement,y)){for(o!==null&&Hf(y)&&(C=o.start,b=o.end,b===void 0&&(b=C),"selectionStart"in y?(y.selectionStart=C,y.selectionEnd=Math.min(b,y.value.length)):(b=(C=y.ownerDocument||document)&&C.defaultView||window,b.getSelection&&(b=b.getSelection(),l=y.textContent.length,_=Math.min(o.start,l),o=o.end===void 0?_:Math.min(o.end,l),!b.extend&&_>o&&(l=o,o=_,_=l),l=kg(y,_),s=kg(y,o),l&&s&&(b.rangeCount!==1||b.anchorNode!==l.node||b.anchorOffset!==l.offset||b.focusNode!==s.node||b.focusOffset!==s.offset)&&(C=C.createRange(),C.setStart(l.node,l.offset),b.removeAllRanges(),_>o?(b.addRange(C),b.extend(s.node,s.offset)):(C.setEnd(s.node,s.offset),b.addRange(C)))))),C=[],b=y;b=b.parentNode;)b.nodeType===1&&C.push({element:b,left:b.scrollLeft,top:b.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<C.length;y++)b=C[y],b.element.scrollLeft=b.left,b.element.scrollTop=b.top}Xa=!!kc,Oc=kc=null,n.current=t,G=i;do try{for(y=n;G!==null;){var O=G.flags;if(O&36&&uE(y,G.alternate,G),O&128){C=void 0;var R=G.ref;if(R!==null){var L=G.stateNode;switch(G.tag){case 5:C=L;break;default:C=L}typeof R=="function"?R(C):R.current=C}}G=G.nextEffect}}catch(A){if(G===null)throw Error(V(330));Li(G,A),G=G.nextEffect}while(G!==null);G=null,Xb(),ne=r}else n.current=t;if(Bi)Bi=!1,Ko=n,No=e;else for(G=i;G!==null;)e=G.nextEffect,G.nextEffect=null,G.flags&8&&(O=G,O.sibling=null,O.stateNode=null),G=e;if(i=n.pendingLanes,i===0&&(Pn=null),i===1?n===dd?Jo++:(Jo=0,dd=n):Jo=0,t=t.stateNode,fr&&typeof fr.onCommitFiberRoot=="function")try{fr.onCommitFiberRoot(Wp,t,void 0,(t.current.flags&64)===64)}catch{}if(rn(n,ut()),Mu)throw Mu=!1,n=hd,hd=null,n;return(ne&8)!==0||Rn(),null}function gE(){for(;G!==null;){var n=G.alternate;ru||Yo===null||((G.flags&8)!==0?cg(G,Yo)&&(ru=!0):G.tag===13&&hE(n,G)&&cg(G,Yo)&&(ru=!0));var e=G.flags;(e&256)!==0&&aE(n,G),(e&512)===0||Bi||(Bi=!0,fl(97,function(){return qi(),null})),G=G.nextEffect}}function qi(){if(No!==90){var n=97<No?97:No;return No=90,vr(n,yE)}return!1}function vE(n,e){cd.push(e,n),Bi||(Bi=!0,fl(97,function(){return qi(),null}))}function PS(n,e){fd.push(e,n),Bi||(Bi=!0,fl(97,function(){return qi(),null}))}function yE(){if(Ko===null)return!1;var n=Ko;if(Ko=null,(ne&48)!==0)throw Error(V(331));var e=ne;ne|=32;var t=fd;fd=[];for(var i=0;i<t.length;i+=2){var r=t[i],s=t[i+1],o=r.destroy;if(r.destroy=void 0,typeof o=="function")try{o()}catch(a){if(s===null)throw Error(V(330));Li(s,a)}}for(t=cd,cd=[],i=0;i<t.length;i+=2){r=t[i],s=t[i+1];try{var l=r.create;r.destroy=l()}catch(a){if(s===null)throw Error(V(330));Li(s,a)}}for(l=n.current.firstEffect;l!==null;)n=l.nextEffect,l.nextEffect=null,l.flags&8&&(l.sibling=null,l.stateNode=null),l=n;return ne=e,Rn(),!0}function dv(n,e,t){e=Xp(t,e),e=yS(n,e,1),Ii(n,e),e=Gt(),n=yh(n,1),n!==null&&(hh(n,1,e),rn(n,e))}function Li(n,e){if(n.tag===3)dv(n,n,e);else for(var t=n.return;t!==null;){if(t.tag===3){dv(t,n,e);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Pn===null||!Pn.has(i))){n=Xp(e,n);var r=CS(t,n,1);if(Ii(t,r),r=Gt(),t=yh(t,1),t!==null)hh(t,1,r),rn(t,r);else if(typeof i.componentDidCatch=="function"&&(Pn===null||!Pn.has(i)))try{i.componentDidCatch(e,n)}catch{}break}}t=t.return}}function CE(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Gt(),n.pingedLanes|=n.suspendedLanes&t,wt===n&&(ct&t)===t&&(nt===4||nt===3&&(ct&62914560)===ct&&500>ut()-em?vs(n,0):Zp|=t),rn(n,e)}function SE(n,e){var t=n.stateNode;t!==null&&t.delete(e),e=0,e===0&&(e=n.mode,(e&2)===0?e=1:(e&4)===0?e=Os()===99?1:2:(Hn===0&&(Hn=Fs),e=Zr(62914560&~Hn),e===0&&(e=4194304))),t=Gt(),n=yh(n,e),n!==null&&(hh(n,e,t),rn(n,t))}var TS;TS=function(n,e,t){var i=e.lanes;if(n!==null)if(n.memoizedProps!==e.pendingProps||Nt.current)dn=!0;else if((t&i)!==0)dn=(n.flags&16384)!==0;else{switch(dn=!1,e.tag){case 3:Zg(e),Ac();break;case 5:Hg(e);break;case 1:It(e.type)&&eu(e);break;case 4:Qf(e,e.stateNode.containerInfo);break;case 10:i=e.memoizedProps.value;var r=e.type._context;Ie(Eu,r._currentValue),r._currentValue=i;break;case 13:if(e.memoizedState!==null)return(t&e.child.childLanes)!==0?ev(n,e,t):(Ie(Ne,Ne.current&1),e=Un(n,e,t),e!==null?e.sibling:null);Ie(Ne,Ne.current&1);break;case 19:if(i=(t&e.childLanes)!==0,(n.flags&64)!==0){if(i)return sv(n,e,t);e.flags|=64}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ie(Ne,Ne.current),i)break;return null;case 23:case 24:return e.lanes=0,Nc(n,e,t)}return Un(n,e,t)}else dn=!1;switch(e.lanes=0,e.tag){case 2:if(i=e.type,n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,r=ks(e,dt.current),ps(e,t),r=qp(null,e,i,n,r,t),e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,It(i)){var s=!0;eu(e)}else s=!1;e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Gp(e);var o=i.getDerivedStateFromProps;typeof o=="function"&&_u(e,i,o,n),r.updater=gh,e.stateNode=r,r._reactInternals=e,Xf(e,i,n,t),e=nd(null,e,i,!0,s,t)}else e.tag=0,_t(null,e,r,t),e=e.child;return e;case 16:r=e.elementType;e:{switch(n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=xE(r),n=cn(r,n),s){case 0:e=td(null,e,r,n,t);break e;case 1:e=Qg(null,e,r,n,t);break e;case 11:e=Yg(null,e,r,n,t);break e;case 14:e=Xg(null,e,r,cn(r.type,n),i,t);break e}throw Error(V(306,r,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),td(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),Qg(n,e,i,r,t);case 3:if(Zg(e),i=e.updateQueue,n===null||i===null)throw Error(V(282));if(i=e.pendingProps,r=e.memoizedState,r=r!==null?r.element:null,eS(n,e),dl(e,i,null,t),i=e.memoizedState.element,i===r)Ac(),e=Un(n,e,t);else{if(r=e.stateNode,(s=r.hydrate)&&(Ei=ds(e.stateNode.containerInfo.firstChild),zn=e,s=In=!0),s){if(n=r.mutableSourceEagerHydrationData,n!=null)for(r=0;r<n.length;r+=2)s=n[r],s._workInProgressVersionPrimary=n[r+1],ms.push(s);for(t=rS(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|1024,t=t.sibling}else _t(n,e,i,t),Ac();e=e.child}return e;case 5:return Hg(e),n===null&&Zf(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,o=r.children,qf(i,r)?o=null:s!==null&&qf(i,s)&&(e.flags|=16),pS(n,e),_t(n,e,o,t),e.child;case 6:return n===null&&Zf(e),null;case 13:return ev(n,e,t);case 4:return Qf(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Pu(e,null,i,t):_t(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),Yg(n,e,i,r,t);case 7:return _t(n,e,e.pendingProps,t),e.child;case 8:return _t(n,e,e.pendingProps.children,t),e.child;case 12:return _t(n,e,e.pendingProps.children,t),e.child;case 10:e:{i=e.type._context,r=e.pendingProps,o=e.memoizedProps,s=r.value;var l=e.type._context;if(Ie(Eu,l._currentValue),l._currentValue=s,o!==null)if(l=o.value,s=Xt(l,s)?0:(typeof i._calculateChangedBits=="function"?i._calculateChangedBits(l,s):1073741823)|0,s===0){if(o.children===r.children&&!Nt.current){e=Un(n,e,t);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var a=l.dependencies;if(a!==null){o=l.child;for(var u=a.firstContext;u!==null;){if(u.context===i&&(u.observedBits&s)!==0){l.tag===1&&(u=Ni(-1,t&-t),u.tag=2,Ii(l,u)),l.lanes|=t,u=l.alternate,u!==null&&(u.lanes|=t),ZC(l.return,t),a.lanes|=t;break}u=u.next}}else o=l.tag===10&&l.type===e.type?null:l.child;if(o!==null)o.return=l;else for(o=l;o!==null;){if(o===e){o=null;break}if(l=o.sibling,l!==null){l.return=o.return,o=l;break}o=o.return}l=o}_t(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps,i=s.children,ps(e,t),r=nn(r,s.unstable_observedBits),i=i(r),e.flags|=1,_t(n,e,i,t),e.child;case 14:return r=e.type,s=cn(r,e.pendingProps),s=cn(r.type,s),Xg(n,e,r,s,i,t);case 15:return dS(n,e,e.type,e.pendingProps,i,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,It(i)?(n=!0,eu(e)):n=!1,ps(e,t),nS(e,i,r),Xf(e,i,r,t),nd(null,e,i,!0,n,t);case 19:return sv(n,e,t);case 23:return Nc(n,e,t);case 24:return Nc(n,e,t)}throw Error(V(156,e.tag))};function wE(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Qt(n,e,t,i){return new wE(n,e,t,i)}function nm(n){return n=n.prototype,!(!n||!n.isReactComponent)}function xE(n){if(typeof n=="function")return nm(n)?1:0;if(n!=null){if(n=n.$$typeof,n===lh)return 11;if(n===ah)return 14}return 2}function ji(n,e){var t=n.alternate;return t===null?(t=Qt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.nextEffect=null,t.firstEffect=null,t.lastEffect=null),t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function su(n,e,t,i,r,s){var o=2;if(i=n,typeof n=="function")nm(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Si:return ys(t.children,r,s,e);case sC:o=8,r|=16;break;case yp:o=8,r|=1;break;case Wo:return n=Qt(12,t,e,r|8),n.elementType=Wo,n.type=Wo,n.lanes=s,n;case Bo:return n=Qt(13,t,e,r),n.type=Bo,n.elementType=Bo,n.lanes=s,n;case mu:return n=Qt(19,t,e,r),n.elementType=mu,n.lanes=s,n;case Ep:return im(t,r,s,e);case Tf:return n=Qt(24,t,e,r),n.elementType=Tf,n.lanes=s,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Cp:o=10;break e;case Sp:o=9;break e;case lh:o=11;break e;case ah:o=14;break e;case wp:o=16,i=null;break e;case xp:o=22;break e}throw Error(V(130,n==null?n:typeof n,""))}return e=Qt(o,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function ys(n,e,t,i){return n=Qt(7,n,i,e),n.lanes=t,n}function im(n,e,t,i){return n=Qt(23,n,i,e),n.elementType=Ep,n.lanes=t,n}function Rc(n,e,t){return n=Qt(6,n,null,e),n.lanes=t,n}function Lc(n,e,t){return e=Qt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function bE(n,e,t){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=t,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=yc(0),this.expirationTimes=yc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yc(0),this.mutableSourceEagerHydrationData=null}function EE(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rr,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function Fu(n,e,t,i){var r=e.current,s=Gt(),o=Di(r);e:if(t){t=t._reactInternals;t:{if(Pr(t)!==t||t.tag!==1)throw Error(V(170));var l=t;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(It(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(l!==null);throw Error(V(171))}if(t.tag===1){var a=t.type;if(It(a)){t=UC(t,a,l);break e}}t=l}else t=Wi;return e.context===null?e.context=t:e.pendingContext=t,e=Ni(s,o),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),Ii(r,e),Ri(r,o,s),o}function Mc(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function pv(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function rm(n,e){pv(n,e),(n=n.alternate)&&pv(n,e)}function kE(){return null}function sm(n,e,t){var i=t!=null&&t.hydrationOptions!=null&&t.hydrationOptions.mutableSources||null;if(t=new bE(n,e,t!=null&&t.hydrate===!0),e=Qt(3,null,null,e===2?7:e===1?3:0),t.current=e,e.stateNode=t,Gp(e),n[Ms]=t.current,jC(n.nodeType===8?n.parentNode:n),i)for(n=0;n<i.length;n++){e=i[n];var r=e._getVersion;r=r(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,r]:t.mutableSourceEagerHydrationData.push(e,r)}this._internalRoot=t}sm.prototype.render=function(n){Fu(n,this._internalRoot,null,null)};sm.prototype.unmount=function(){var n=this._internalRoot,e=n.containerInfo;Fu(null,n,null,function(){e[Ms]=null})};function Il(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function OE(n,e){if(e||(e=n?n.nodeType===9?n.documentElement:n.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var t;t=n.lastChild;)n.removeChild(t);return new sm(n,0,e?{hydrate:!0}:void 0)}function Ch(n,e,t,i,r){var s=t._reactRootContainer;if(s){var o=s._internalRoot;if(typeof r=="function"){var l=r;r=function(){var u=Mc(o);l.call(u)}}Fu(e,o,n,r)}else{if(s=t._reactRootContainer=OE(t,i),o=s._internalRoot,typeof r=="function"){var a=r;r=function(){var u=Mc(o);a.call(u)}}bS(function(){Fu(e,o,n,r)})}return Mc(o)}SC=function(n){if(n.tag===13){var e=Gt();Ri(n,4,e),rm(n,4)}};Tp=function(n){if(n.tag===13){var e=Gt();Ri(n,67108864,e),rm(n,67108864)}};wC=function(n){if(n.tag===13){var e=Gt(),t=Di(n);Ri(n,t,e),rm(n,t)}};xC=function(n,e){return e()};Wf=function(n,e,t){switch(e){case"input":if(Nf(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=ph(i);if(!r)throw Error(V(90));lC(i),Nf(i,r)}}}break;case"textarea":uC(n,t);break;case"select":e=t.value,e!=null&&hs(n,!!t.multiple,e,!1)}};Op=xS;gC=function(n,e,t,i,r){var s=ne;ne|=4;try{return vr(98,n.bind(null,e,t,i,r))}finally{ne=s,ne===0&&(Ws(),Rn())}};_p=function(){(ne&49)===0&&(fE(),qi())};vC=function(n,e){var t=ne;ne|=2;try{return n(e)}finally{ne=t,ne===0&&(Ws(),Rn())}};function AS(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Il(e))throw Error(V(200));return EE(n,e,null,t)}var _E={Events:[Tl,is,ph,pC,mC,qi,{current:!1}]},fo={findFiberByHostInstance:or,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},PE={bundleType:fo.bundleType,version:fo.version,rendererPackageName:fo.rendererPackageName,rendererConfig:fo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_r.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=CC(n),n===null?null:n.stateNode},findFiberByHostInstance:fo.findFiberByHostInstance||kE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var ma=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ma.isDisabled&&ma.supportsFiber)try{Wp=ma.inject(PE),fr=ma}catch{}}sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_E;sn.createPortal=AS;sn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(V(188)):Error(V(268,Object.keys(n)));return n=CC(e),n=n===null?null:n.stateNode,n};sn.flushSync=function(n,e){var t=ne;if((t&48)!==0)return n(e);ne|=1;try{if(n)return vr(99,n.bind(null,e))}finally{ne=t,Rn()}};sn.hydrate=function(n,e,t){if(!Il(e))throw Error(V(200));return Ch(null,n,e,!0,t)};sn.render=function(n,e,t){if(!Il(e))throw Error(V(200));return Ch(null,n,e,!1,t)};sn.unmountComponentAtNode=function(n){if(!Il(n))throw Error(V(40));return n._reactRootContainer?(bS(function(){Ch(null,null,n,!1,function(){n._reactRootContainer=null,n[Ms]=null})}),!0):!1};sn.unstable_batchedUpdates=xS;sn.unstable_createPortal=function(n,e){return AS(n,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};sn.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!Il(t))throw Error(V(200));if(n==null||n._reactInternals===void 0)throw Error(V(38));return Ch(n,e,t,!1,i)};sn.version="17.0.2";function NS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NS)}catch(n){console.error(n)}}NS(),tC.exports=sn;var BL=tC.exports;function md(){return md=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},md.apply(this,arguments)}function TE(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}let Cs="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(n=>n?parseInt(n,36):1);for(let n=1;n<Cs.length;n++)Cs[n]+=Cs[n-1];function AE(n){for(let e=1;e<Cs.length;e+=2)if(Cs[e]>n)return Cs[e-1]<=n;return!1}function mv(n){return n>=127462&&n<=127487}const gv=8205;function jt(n,e,t=!0,i=!0){return(t?IS:NE)(n,e,i)}function IS(n,e,t){if(e==n.length)return e;e&&DS(n.charCodeAt(e))&&RS(n.charCodeAt(e-1))&&e--;let i=at(n,e);for(e+=Yt(i);e<n.length;){let r=at(n,e);if(i==gv||r==gv||t&&AE(r))e+=Yt(r),i=r;else if(mv(r)){let s=0,o=e-2;for(;o>=0&&mv(at(n,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function NE(n,e,t){for(;e>0;){let i=IS(n,e-2,t);if(i<e)return i;e--}return 0}function DS(n){return n>=56320&&n<57344}function RS(n){return n>=55296&&n<56320}function at(n,e){let t=n.charCodeAt(e);if(!RS(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return DS(i)?(t-55296<<10)+(i-56320)+65536:t}function om(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function Yt(n){return n<65536?1:2}function Dl(n,e,t=n.length){let i=0;for(let r=0;r<t;)n.charCodeAt(r)==9?(i+=e-i%e,r++):(i++,r=jt(n,r));return i}function gd(n,e,t,i){for(let r=0,s=0;;){if(s>=e)return r;if(r==n.length)break;s+=n.charCodeAt(r)==9?t-s%t:1,r=jt(n,r)}return i===!0?-1:n.length}class me{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){let r=[];return this.decompose(0,e,r,2),i.length&&i.decompose(0,i.length,r,3),this.decompose(t,this.length,r,1),kn.from(r,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let i=[];return this.decompose(e,t,i,0),kn.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),r=new Xo(this),s=new Xo(e);for(let o=t,l=t;;){if(r.next(o),s.next(o),o=0,r.lineBreak!=s.lineBreak||r.done!=s.done||r.value!=s.value)return!1;if(l+=r.value.length,r.done||l>=i)return!0}}iter(e=1){return new Xo(this,e)}iterRange(e,t=this.length){return new LS(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let r=this.line(e).from;i=this.iterRange(r,Math.max(r,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new MS(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?me.empty:e.length<=32?new Re(e):kn.from(Re.split(e,[]))}}class Re extends me{constructor(e,t=IE(e)){super();this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.text[s],l=r+o.length;if((t?i:l)>=e)return new DE(r,l,i,o);r=l+1,i++}}decompose(e,t,i,r){let s=e<=0&&t>=this.length?this:new Re(vv(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(r&1){let o=i.pop(),l=ou(s.text,o.text.slice(),0,s.length);if(l.length<=32)i.push(new Re(l,o.length+s.length));else{let a=l.length>>1;i.push(new Re(l.slice(0,a)),new Re(l.slice(a)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof Re))return super.replace(e,t,i);let r=ou(this.text,ou(i.text,vv(this.text,0,e)),t),s=this.length+i.length-(t-e);return r.length<=32?new Re(r,s):kn.from(Re.split(r,[]),s)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<=t&&o<this.text.length;o++){let l=this.text[o],a=s+l.length;s>e&&o&&(r+=i),e<a&&t>s&&(r+=l.slice(Math.max(0,e-s),t-s)),s=a+1}return r}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],r=-1;for(let s of e)i.push(s),r+=s.length+1,i.length==32&&(t.push(new Re(i,r)),i=[],r=-1);return r>-1&&t.push(new Re(i,r)),t}}class kn extends me{constructor(e,t){super();this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.children[s],l=r+o.length,a=i+o.lines-1;if((t?a:l)>=e)return o.lineInner(e,t,i,r);r=l+1,i=a+1}}decompose(e,t,i,r){for(let s=0,o=0;o<=t&&s<this.children.length;s++){let l=this.children[s],a=o+l.length;if(e<=a&&t>=o){let u=r&((o<=e?1:0)|(a>=t?2:0));o>=e&&a<=t&&!u?i.push(l):l.decompose(e-o,t-o,i,u)}o=a+1}}replace(e,t,i){if(i.lines<this.lines)for(let r=0,s=0;r<this.children.length;r++){let o=this.children[r],l=s+o.length;if(e>=s&&t<=l){let a=o.replace(e-s,t-s,i),u=this.lines-o.lines+a.lines;if(a.lines<u>>5-1&&a.lines>u>>5+1){let h=this.children.slice();return h[r]=a,new kn(h,this.length-(t-e)+i.length)}return super.replace(s,l,a)}s=l+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<this.children.length&&o<=t;s++){let l=this.children[s],a=o+l.length;o>e&&s&&(r+=i),e<a&&t>o&&(r+=l.sliceString(e-o,t-o,i)),o=a+1}return r}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof kn))return 0;let i=0,[r,s,o,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;r+=t,s+=t){if(r==o||s==l)return i;let a=this.children[r],u=e.children[s];if(a!=u)return i+a.scanIdentical(u,t);i+=a.length+1}}static from(e,t=e.reduce((i,r)=>i+r.length+1,-1)){let i=0;for(let d of e)i+=d.lines;if(i<32){let d=[];for(let m of e)m.flatten(d);return new Re(d,t)}let r=Math.max(32,i>>5),s=r<<1,o=r>>1,l=[],a=0,u=-1,h=[];function c(d){let m;if(d.lines>s&&d instanceof kn)for(let w of d.children)c(w);else d.lines>o&&(a>o||!a)?(f(),l.push(d)):d instanceof Re&&a&&(m=h[h.length-1])instanceof Re&&d.lines+m.lines<=32?(a+=d.lines,u+=d.length+1,h[h.length-1]=new Re(m.text.concat(d.text),m.length+1+d.length)):(a+d.lines>r&&f(),a+=d.lines,u+=d.length+1,h.push(d))}function f(){a!=0&&(l.push(h.length==1?h[0]:kn.from(h,u)),u=-1,a=h.length=0)}for(let d of e)c(d);return f(),l.length==1?l[0]:new kn(l,t)}}me.empty=new Re([""],0);function IE(n){let e=-1;for(let t of n)e+=t.length+1;return e}function ou(n,e,t=0,i=1e9){for(let r=0,s=0,o=!0;s<n.length&&r<=i;s++){let l=n[s],a=r+l.length;a>=t&&(a>i&&(l=l.slice(0,i-r)),r<t&&(l=l.slice(t-r)),o?(e[e.length-1]+=l,o=!1):e.push(l)),r=a+1}return e}function vv(n,e,t){return ou(n,[""],e,t)}class Xo{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Re?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,r=this.nodes[i],s=this.offsets[i],o=s>>1,l=r instanceof Re?r.text.length:r.children.length;if(o==(t>0?l:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(r instanceof Re){let a=r.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=r.children[o+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof Re?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class LS{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Xo(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:r}=this.cursor.next(e);return this.pos+=(r.length+e)*t,this.value=r.length<=i?r:t<0?r.slice(r.length-i):r.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class MS{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:r}=this.inner.next(e);return t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol!="undefined"&&(me.prototype[Symbol.iterator]=function(){return this.iter()},Xo.prototype[Symbol.iterator]=LS.prototype[Symbol.iterator]=MS.prototype[Symbol.iterator]=function(){return this});class DE{constructor(e,t,i,r){this.from=e,this.to=t,this.number=i,this.text=r}get length(){return this.to-this.from}}const vd=/\r\n?|\n/;var Ct=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Ct||(Ct={}));class Yn{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,r,s),r+=s):r+=o,i+=s}}iterChangedRanges(e,t=!1){yd(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new Yn(e)}composeDesc(e){return this.empty?e:e.empty?this:FS(this,e)}mapDesc(e,t=!1){return e.empty?this:Cd(this,e,t)}mapPos(e,t=-1,i=Ct.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],u=r+l;if(a<0){if(u>e)return s+(e-r);s+=l}else{if(i!=Ct.Simple&&u>=e&&(i==Ct.TrackDel&&r<e&&u>e||i==Ct.TrackBefore&&r<e||i==Ct.TrackAfter&&u>e))return null;if(u>e||u==e&&t<0&&!l)return e==r||t<0?s:s+a;s+=a}r=u}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=this.sections[i++],o=this.sections[i++],l=r+s;if(o>=0&&r<=t&&l>=e)return r<e&&l>t?"cover":!0;r=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Yn(e)}}class Ue extends Yn{constructor(e,t){super(e);this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return yd(this,(t,i,r,s,o)=>e=e.replace(r,r+(i-t),o),!1),e}mapDesc(e,t=!1){return Cd(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],l=t[r+1];if(l>=0){t[r]=l,t[r+1]=o;let a=r>>1;for(;i.length<a;)i.push(me.empty);i.push(o?e.slice(s,s+o):me.empty)}s+=o}return new Ue(t,i)}compose(e){return this.empty?e:e.empty?this:FS(this,e,!0)}map(e,t=!1){return e.empty?this:Cd(this,e,t,!0)}iterChanges(e,t=!1){yd(this,e,t)}get desc(){return new Yn(this.sections)}filter(e){let t=[],i=[],r=[],s=new vl(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let h=Math.min(s.len,a-l);yt(r,h,-1);let c=s.ins==-1?-1:s.off==0?s.ins:0;yt(t,h,c),c>0&&ur(i,t,s.text),s.forward(h),l+=h}let u=e[o++];for(;l<u;){if(s.done)break e;let h=Math.min(s.len,u-l);yt(t,h,-1),yt(r,h,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(h),l+=h}}return{changes:new Ue(t,i),filtered:new Yn(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):r==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,l=null;function a(h=!1){if(!h&&!r.length)return;o<t&&yt(r,t-o,-1);let c=new Ue(r,s);l=l?l.compose(c.map(l)):c,r=[],s=[],o=0}function u(h){if(Array.isArray(h))for(let c of h)u(c);else if(h instanceof Ue){if(h.length!=t)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${t})`);a(),l=l?l.compose(h.map(l)):h}else{let{from:c,to:f=c,insert:d}=h;if(c>f||c<0||f>t)throw new RangeError(`Invalid change range ${c} to ${f} (in doc of length ${t})`);let m=d?typeof d=="string"?me.of(d.split(i||vd)):d:me.empty,w=m.length;if(c==f&&w==0)return;c<o&&a(),c>o&&yt(r,c-o,-1),yt(r,f-c,w),ur(s,r,m),o=f}}return u(e),a(!l),l}static empty(e){return new Ue(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<r;)i.push(me.empty);i[r]=me.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new Ue(t,i)}}function yt(n,e,t,i=!1){if(e==0&&t<=0)return;let r=n.length-2;r>=0&&t<=0&&t==n[r+1]?n[r]+=e:e==0&&n[r]==0?n[r+1]+=t:i?(n[r]+=e,n[r+1]+=t):n.push(e,t)}function ur(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(me.empty);n.push(t)}}function yd(n,e,t){let i=n.inserted;for(let r=0,s=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)r+=l,s+=l;else{let u=r,h=s,c=me.empty;for(;u+=l,h+=a,a&&i&&(c=c.append(i[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];e(r,u,s,h,c),r=u,s=h}}}function Cd(n,e,t,i=!1){let r=[],s=i?[]:null,o=new vl(n),l=new vl(e);for(let a=0,u=0;;)if(o.ins==-1)a+=o.len,o.next();else if(l.ins==-1&&u<a){let h=Math.min(l.len,a-u);l.forward(h),yt(r,h,-1),u+=h}else if(l.ins>=0&&(o.done||u<a||u==a&&(l.len<o.len||l.len==o.len&&!t))){for(yt(r,l.ins,-1);a>u&&!o.done&&a+o.len<u+l.len;)a+=o.len,o.next();u+=l.len,l.next()}else if(o.ins>=0){let h=0,c=a+o.len;for(;;)if(l.ins>=0&&u>a&&u+l.len<c)h+=l.ins,u+=l.len,l.next();else if(l.ins==-1&&u<c){let f=Math.min(l.len,c-u);h+=f,l.forward(f),u+=f}else break;yt(r,h,o.ins),s&&ur(s,r,o.text),a=c,o.next()}else{if(o.done&&l.done)return s?new Ue(r,s):new Yn(r);throw new Error("Mismatched change set lengths")}}function FS(n,e,t=!1){let i=[],r=t?[]:null,s=new vl(n),o=new vl(e);for(let l=!1;;){if(s.done&&o.done)return r?new Ue(i,r):new Yn(i);if(s.ins==0)yt(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)yt(i,0,o.ins,l),r&&ur(r,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,o.len),u=i.length;if(s.ins==-1){let h=o.ins==-1?-1:o.off?0:o.ins;yt(i,a,h,l),r&&h&&ur(r,i,o.text)}else o.ins==-1?(yt(i,s.off?0:s.len,a,l),r&&ur(r,i,s.textBit(a))):(yt(i,s.off?0:s.len,o.off?0:o.ins,l),r&&!o.off&&ur(r,i,o.text));l=(s.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>u),s.forward2(a),o.forward(a)}}}}class vl{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?me.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?me.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class os{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new os(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return F.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return F.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return F.range(e.anchor,e.head)}}class F{constructor(e,t=0){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:F.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new F([this.main])}addRange(e,t=!0){return F.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,F.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new F(e.ranges.map(t=>os.fromJSON(t)),e.main)}static single(e,t=e){return new F([F.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return RE(e.slice(),t);i=s.to}return new F(e,t)}static cursor(e,t=0,i,r){return new os(e,e,(t==0?0:t<0?4:8)|(i==null?3:Math.min(2,i))|(r!=null?r:33554431)<<5)}static range(e,t,i){let r=(i!=null?i:33554431)<<5;return t<e?new os(t,e,16|r|8):new os(e,t,r|(t>e?4:0))}}function RE(n,e=0){let t=n[e];n.sort((i,r)=>i.from-r.from),e=n.indexOf(t);for(let i=1;i<n.length;i++){let r=n[i],s=n[i-1];if(r.empty?r.from<=s.to:r.from<s.to){let o=s.from,l=Math.max(r.to,s.to);i<=e&&e--,n.splice(--i,2,r.anchor>r.head?F.range(l,o):F.range(o,l))}}return new F(n,e)}function VS(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let lm=0;class Y{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.extensions=s,this.id=lm++,this.default=e([])}static define(e={}){return new Y(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:am),!!e.static,e.enables)}of(e){return new lu([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new lu(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new lu(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function am(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class lu{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=lm++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,l=this.type==2,a=!1,u=!1,h=[];for(let c of this.dependencies)c=="doc"?a=!0:c=="selection"?u=!0:(((t=e[c.id])!==null&&t!==void 0?t:1)&1)==0&&h.push(e[c.id]);return{create(c){return c.values[o]=i(c),1},update(c,f){if(a&&f.docChanged||u&&(f.docChanged||f.selection)||h.some(d=>(dr(c,d)&1)>0)){let d=i(c);if(l?!yv(d,c.values[o],r):!r(d,c.values[o]))return c.values[o]=d,1}return 0},reconfigure(c,f){let d=i(c),m=f.config.address[s];if(m!=null){let w=Wu(f,m);if(l?yv(d,w,r):r(d,w))return c.values[o]=w,0}return c.values[o]=d,1}}}}function yv(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function LE(n,e,t){let i=t.map(a=>n[a.id]),r=t.map(a=>a.type),s=i.filter(a=>!(a&1)),o=n[e.id]>>1;function l(a){let u=[];for(let h=0;h<i.length;h++){let c=Wu(a,i[h]);if(r[h]==2)for(let f of c)u.push(f);else u.push(c)}return e.combine(u)}return{create(a){for(let u of i)dr(a,u);return a.values[o]=l(a),1},update(a,u){if(!s.some(c=>dr(a,c)&1))return 0;let h=l(a);return e.compare(h,a.values[o])?0:(a.values[o]=h,1)},reconfigure(a,u){let h=i.some(m=>dr(a,m)&1),c=u.config.facets[e.id],f=u.facet(e);if(c&&!h&&am(t,c))return a.values[o]=f,0;let d=l(a);return e.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const Cv=Y.define({static:!0});class Ye{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new Ye(lm++,e.create,e.update,e.compare||((i,r)=>i===r),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Cv).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,r)=>{let s=i.values[t],o=this.updateF(s,r);return this.compareF(s,o)?0:(i.values[t]=o,1)},reconfigure:(i,r)=>r.config.address[this.id]!=null?(i.values[t]=r.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,Cv.of({field:this,create:e})]}get extension(){return this}}const $n={lowest:4,low:3,default:2,high:1,highest:0};function fi(n){return e=>new WS(e,n)}const Rl={lowest:fi($n.lowest),low:fi($n.low),default:fi($n.default),high:fi($n.high),highest:fi($n.highest),fallback:fi($n.lowest),extend:fi($n.high),override:fi($n.highest)};class WS{constructor(e,t){this.inner=e,this.prec=t}}class Sh{of(e){return new Sd(this,e)}reconfigure(e){return Sh.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Sd{constructor(e,t){this.compartment=e,this.inner=t}}class Vu{constructor(e,t,i,r,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),o=new Map;for(let f of ME(e,t,o))f instanceof Ye?r.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],u=[];for(let f of r)l[f.id]=u.length<<1,u.push(d=>f.slot(d));let h=i==null?void 0:i.config.facets;for(let f in s){let d=s[f],m=d[0].facet,w=h&&h[f]||[];if(d.every(v=>v.type==0))if(l[m.id]=a.length<<1|1,am(w,d))a.push(i.facet(m));else{let v=m.combine(d.map(p=>p.value));a.push(i&&m.compare(v,i.facet(m))?i.facet(m):v)}else{for(let v of d)v.type==0?(l[v.id]=a.length<<1|1,a.push(v.value)):(l[v.id]=u.length<<1,u.push(p=>v.dynamicSlot(p)));l[m.id]=u.length<<1,u.push(v=>LE(v,m,d))}}let c=u.map(f=>f(l));return new Vu(e,o,c,l,a,s)}}function ME(n,e,t){let i=[[],[],[],[],[]],r=new Map;function s(o,l){let a=r.get(o);if(a!=null){if(a>=l)return;let u=i[a].indexOf(o);u>-1&&i[a].splice(u,1),o instanceof Sd&&t.delete(o.compartment)}if(r.set(o,l),Array.isArray(o))for(let u of o)s(u,l);else if(o instanceof Sd){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=e.get(o.compartment)||o.inner;t.set(o.compartment,u),s(u,l)}else if(o instanceof WS)s(o.inner,o.prec);else if(o instanceof Ye)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof lu)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,l);else{let u=o.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(u,l)}}return s(n,$n.default),i.reduce((o,l)=>o.concat(l))}function dr(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let r=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|r}function Wu(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const BS=Y.define(),jS=Y.define({combine:n=>n.some(e=>e),static:!0}),$S=Y.define({combine:n=>n.length?n[0]:void 0,static:!0}),GS=Y.define(),HS=Y.define(),zS=Y.define(),US=Y.define({combine:n=>n.length?n[0]:!1});class Ki{constructor(e,t){this.type=e,this.value=t}static define(){return new FE}}class FE{of(e){return new Ki(this,e)}}class VE{constructor(e){this.map=e}of(e){return new ie(this,e)}}class ie{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new ie(this.type,t)}is(e){return this.type==e}static define(e={}){return new VE(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let s=r.map(t);s&&i.push(s)}return i}}ie.reconfigure=ie.define();ie.appendConfig=ie.define();class qe{constructor(e,t,i,r,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&VS(i,t.newLength),s.some(l=>l.type==qe.time)||(this.annotations=s.concat(qe.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(qe.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}qe.time=Ki.define();qe.userEvent=Ki.define();qe.addToHistory=Ki.define();qe.remote=Ki.define();function WE(n,e){let t=[];for(let i=0,r=0;;){let s,o;if(i<n.length&&(r==e.length||e[r]>=n[i]))s=n[i++],o=n[i++];else if(r<e.length)s=e[r++],o=e[r++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function qS(n,e,t){var i;let r,s,o;return t?(r=e.changes,s=Ue.empty(e.changes.length),o=n.changes.compose(e.changes)):(r=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(r),effects:ie.mapEffects(n.effects,r).concat(ie.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function wd(n,e,t){let i=e.selection,r=Ss(e.annotations);return e.userEvent&&(r=r.concat(qe.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ue?e.changes:Ue.of(e.changes||[],t,n.facet($S)),selection:i&&(i instanceof F?i:F.single(i.anchor,i.head)),effects:Ss(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function KS(n,e,t){let i=wd(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;i=qS(i,wd(n,e[s],o?i.changes.newLength:n.doc.length),o)}let r=new qe(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return jE(t?BE(r):r)}function BE(n){let e=n.startState,t=!0;for(let r of e.facet(GS)){let s=r(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:WE(t,s))}if(t!==!0){let r,s;if(t===!1)s=n.changes.invertedDesc,r=Ue.empty(e.doc.length);else{let o=n.changes.filter(t);r=o.changes,s=o.filtered.invertedDesc}n=new qe(e,r,n.selection&&n.selection.map(s),ie.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(HS);for(let r=i.length-1;r>=0;r--){let s=i[r](n);s instanceof qe?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof qe?n=s[0]:n=KS(e,Ss(s),!1)}return n}function jE(n){let e=n.startState,t=e.facet(zS),i=n;for(let r=t.length-1;r>=0;r--){let s=t[r](n);s&&Object.keys(s).length&&(i=qS(n,wd(e,s,n.changes.newLength),!0))}return i==n?n:new qe(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const $E=[];function Ss(n){return n==null?$E:Array.isArray(n)?n:[n]}var $t=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}($t||($t={}));const GE=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let xd;try{xd=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function HE(n){if(xd)return xd.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||GE.test(t)))return!0}return!1}function zE(n){return e=>{if(!/\S/.test(e))return $t.Space;if(HE(e))return $t.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return $t.Word;return $t.Other}}class ce{constructor(e,t,i,r,s,o){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)dr(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return dr(this,i),Wu(this,i)}update(...e){return KS(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:r}=t;for(let o of e.effects)o.is(Sh.reconfigure)?(t&&(r=new Map,t.compartments.forEach((l,a)=>r.set(a,l)),t=null),r.set(o.value.compartment,o.value.extension)):o.is(ie.reconfigure)?(t=null,i=o.value):o.is(ie.appendConfig)&&(t=null,i=Ss(i).concat(o.value));let s;t?s=e.startState.values.slice():(t=Vu.resolve(i,r,this),s=new ce(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,a)=>a.reconfigure(l,this),null).values),new ce(t,e.newDoc,e.newSelection,s,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:F.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],o=Ss(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),u=this.changes(a.changes),h=u.map(r);for(let f=0;f<l;f++)s[f]=s[f].map(h);let c=r.mapDesc(u,!0);s.push(a.range.map(c)),r=r.compose(h),o=ie.mapEffects(o,h).concat(ie.mapEffects(Ss(a.effects),c))}return{changes:r,selection:F.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof Ue?e:Ue.of(e,this.doc.length,this.facet(ce.lineSeparator))}toText(e){return me.of(e.split(this.facet(ce.lineSeparator)||vd))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(dr(this,t),Wu(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof Ye&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i)for(let s in i){let o=i[s],l=e[s];r.push(o.init(a=>o.spec.fromJSON(l,a)))}return ce.create({doc:e.doc,selection:F.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=Vu.resolve(e.extensions||[],new Map),i=e.doc instanceof me?e.doc:me.of((e.doc||"").split(t.staticFacet(ce.lineSeparator)||vd)),r=e.selection?e.selection instanceof F?e.selection:F.single(e.selection.anchor,e.selection.head):F.single(0);return VS(r,i.length),t.staticFacet(jS)||(r=r.asSingle()),new ce(t,i,r,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(ce.tabSize)}get lineBreak(){return this.facet(ce.lineSeparator)||`
`}get readOnly(){return this.facet(US)}phrase(e){for(let t of this.facet(ce.phrases))if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(BS))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return zE(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=jt(t,o,!1);if(s(t.slice(a,o))!=$t.Word)break;o=a}for(;l<r;){let a=jt(t,l);if(s(t.slice(l,a))!=$t.Word)break;l=a}return o==l?null:F.range(o+i,l+i)}}ce.allowMultipleSelections=jS;ce.tabSize=Y.define({combine:n=>n.length?n[0]:4});ce.lineSeparator=$S;ce.readOnly=US;ce.phrases=Y.define();ce.languageData=BS;ce.changeFilter=GS;ce.transactionFilter=HS;ce.transactionExtender=zS;Sh.reconfigure=ie.define();function Ji(n,e,t={}){let i={};for(let r of n)for(let s of Object.keys(r)){let o=r[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)i[r]===void 0&&(i[r]=e[r]);return i}const bd="\u037C",Sv=typeof Symbol=="undefined"?"__"+bd:Symbol.for(bd),Ed=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),wv=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};class $i{constructor(e,t){this.rules=[];let{finish:i}=t||{};function r(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,l,a,u){let h=[],c=/^@(\w+)\b/.exec(o[0]),f=c&&c[1]=="keyframes";if(c&&l==null)return a.push(o[0]+";");for(let d in l){let m=l[d];if(/&/.test(d))s(d.split(/,\s*/).map(w=>o.map(v=>w.replace(/&/,v))).reduce((w,v)=>w.concat(v)),m,a);else if(m&&typeof m=="object"){if(!c)throw new RangeError("The value of a property ("+d+") should be a primitive value.");s(r(d),m,h,f)}else m!=null&&h.push(d.replace(/_.*/,"").replace(/[A-Z]/g,w=>"-"+w.toLowerCase())+": "+m+";")}(h.length||f)&&a.push((i&&!c&&!u?o.map(i):o).join(", ")+" {"+h.join(" ")+"}")}for(let o in e)s(r(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=wv[Sv]||1;return wv[Sv]=e+1,bd+e.toString(36)}static mount(e,t){(e[Ed]||new UE(e)).mount(Array.isArray(t)?t:[t])}}let ga=null;class UE{constructor(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(ga)return e.adoptedStyleSheets=[ga.sheet].concat(e.adoptedStyleSheets),e[Ed]=ga;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),ga=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let t=e.head||e;t.insertBefore(this.styleTag,t.firstChild)}this.modules=[],e[Ed]=this}mount(e){let t=this.sheet,i=0,r=0;for(let s=0;s<e.length;s++){let o=e[s],l=this.modules.indexOf(o);if(l<r&&l>-1&&(this.modules.splice(l,1),r--,l=-1),l==-1){if(this.modules.splice(r++,0,o),t)for(let a=0;a<o.rules.length;a++)t.insertRule(o.rules[a],i++)}else{for(;r<l;)i+=this.modules[r++].rules.length;i+=o.rules.length,r++}}if(!t){let s="";for(let o=0;o<this.modules.length;o++)s+=this.modules[o].getRules()+`
`;this.styleTag.textContent=s}}}class Cr{eq(e){return this==e}range(e,t=e){return new kd(e,t,this)}}Cr.prototype.startSide=Cr.prototype.endSide=0;Cr.prototype.point=!1;Cr.prototype.mapMode=Ct.TrackDel;class kd{constructor(e,t,i){this.from=e,this.to=t,this.value=i}}function Od(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class um{constructor(e,t,i,r){this.from=e,this.to=t,this.value=i,this.maxPoint=r}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,r=0){let s=i?this.to:this.from;for(let o=r,l=s.length;;){if(o==l)return o;let a=o+l>>1,u=s[a]-e||(i?this.value[a].endSide:this.value[a].startSide)-t;if(a==o)return u>=0?o:l;u>=0?l=a:o=a+1}}between(e,t,i,r){for(let s=this.findIndex(t,-1e9,!0),o=this.findIndex(i,1e9,!1,s);s<o;s++)if(r(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let i=[],r=[],s=[],o=-1,l=-1;for(let a=0;a<this.value.length;a++){let u=this.value[a],h=this.from[a]+e,c=this.to[a]+e,f,d;if(h==c){let m=t.mapPos(h,u.startSide,u.mapMode);if(m==null||(f=d=m,u.startSide!=u.endSide&&(d=t.mapPos(h,u.endSide),d<f)))continue}else if(f=t.mapPos(h,u.startSide),d=t.mapPos(c,u.endSide),f>d||f==d&&u.startSide>0&&u.endSide<=0)continue;(d-f||u.endSide-u.startSide)<0||(o<0&&(o=f),u.point&&(l=Math.max(l,d-f)),i.push(u),r.push(f-o),s.push(d-o))}return{mapped:i.length?new um(r,s,i,l):null,pos:o}}}class de{constructor(e,t,i=de.empty,r){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=r}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:r=0,filterTo:s=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(i&&(t=t.slice().sort(Od)),this.isEmpty)return t.length?de.of(t):this;let l=new JS(this,null,-1).goto(0),a=0,u=[],h=new Gi;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let c=t[a++];h.addInner(c.from,c.to,c.value)||u.push(c)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!o||r>this.chunkEnd(l.chunkIndex)||s<this.chunkPos[l.chunkIndex])&&h.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||r>l.to||s<l.from||o(l.from,l.to,l.value))&&(h.addInner(l.from,l.to,l.value)||u.push(new kd(l.from,l.to,l.value))),l.next());return h.finishInner(this.nextLayer.isEmpty&&!u.length?de.empty:this.nextLayer.update({add:u,filter:o,filterFrom:r,filterTo:s}))}map(e){if(e.length==0||this.isEmpty)return this;let t=[],i=[],r=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],a=this.chunk[o],u=e.touchesRange(l,l+a.length);if(u===!1)r=Math.max(r,a.maxPoint),t.push(a),i.push(e.mapPos(l));else if(u===!0){let{mapped:h,pos:c}=a.map(l,e);h&&(r=Math.max(r,h.maxPoint),t.push(h),i.push(c))}}let s=this.nextLayer.map(e);return t.length==0?s:new de(i,t,s,r)}between(e,t,i){if(!this.isEmpty){for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r];if(t>=s&&e<=s+o.length&&o.between(s,e-s,t-s,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return yl.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return yl.from(e).goto(t)}static compare(e,t,i,r,s=-1){let o=e.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=s),l=t.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=s),a=xv(o,l,i),u=new po(o,a,s),h=new po(l,a,s);i.iterGaps((c,f,d)=>bv(u,c,h,f,d,r)),i.empty&&i.length==0&&bv(u,0,h,0,0,r)}static eq(e,t,i=0,r){r==null&&(r=1e9);let s=e.filter(h=>!h.isEmpty&&t.indexOf(h)<0),o=t.filter(h=>!h.isEmpty&&e.indexOf(h)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let l=xv(s,o),a=new po(s,l,0).goto(i),u=new po(o,l,0).goto(i);for(;;){if(a.to!=u.to||!_d(a.active,u.active)||a.point&&(!u.point||!a.point.eq(u.point)))return!1;if(a.to>r)return!0;a.next(),u.next()}}static spans(e,t,i,r,s=-1){var o;let l=new po(e,null,s,(o=r.filterPoint)===null||o===void 0?void 0:o.bind(r)).goto(t),a=t,u=l.openStart;for(;;){let h=Math.min(l.to,i);if(l.point?(r.point(a,h,l.point,l.activeForPoint(l.to),u),u=l.openEnd(h)+(l.to>h?1:0)):h>a&&(r.span(a,h,l.active,u),u=l.openEnd(h)),l.to>i)break;a=l.to,l.next()}return u}static of(e,t=!1){let i=new Gi;for(let r of e instanceof kd?[e]:t?qE(e):e)i.add(r.from,r.to,r.value);return i.finish()}}de.empty=new de([],[],null,-1);function qE(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let i=n[t];if(Od(e,i)>0)return n.slice().sort(Od);e=i}return n}de.empty.nextLayer=de.empty;class Gi{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new um(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Gi)).add(e,t,i)}addInner(e,t,i){let r=e-this.lastTo||i.startSide-this.last.endSide;if(r<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return r<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(de.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=new de(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function xv(n,e,t){let i=new Map;for(let s of n)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&i.set(s.chunk[o],s.chunkPos[o]);let r=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let l=i.get(s.chunk[o]);l!=null&&(t?t.mapPos(l):l)==s.chunkPos[o]&&!(t==null?void 0:t.touchesRange(l,l+s.chunk[o].length))&&r.add(s.chunk[o])}return r}class JS{constructor(e,t,i,r=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=r}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let r=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(r)||this.layer.chunkEnd(this.chunkIndex)<e||r.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let r=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<r)&&this.setRangeIndex(r)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.to-e.to||this.endSide-e.endSide}}class yl{constructor(e){this.heap=e}static from(e,t=null,i=-1){let r=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&r.push(new JS(o,t,i,s));return r.length==1?r[0]:new yl(r)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)Fc(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)Fc(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Fc(this.heap,0)}}}function Fc(n,e){for(let t=n[e];;){let i=(e<<1)+1;if(i>=n.length)break;let r=n[i];if(i+1<n.length&&r.compare(n[i+1])>=0&&(r=n[i+1],i++),t.compare(r)<0)break;n[i]=t,n[e]=r,e=i}}class po{constructor(e,t,i,r=()=>!0){this.minPoint=i,this.filterPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=yl.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){va(this.active,e),va(this.activeTo,e),va(this.activeRank,e),this.minActive=Ev(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:r,rank:s}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=s;)t++;ya(this.active,t,i),ya(this.activeTo,t,r),ya(this.activeRank,t,s),e&&ya(e,t,this.cursor.from),this.minActive=Ev(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null,r=0;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&va(i,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else if(!this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank))this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<e&&(r=1),this.cursor.next(),this.to>e&&this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let s=0;for(;s<i.length&&i[s]<e;)s++;this.openStart=s+r}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function bv(n,e,t,i,r,s){n.goto(e),t.goto(i);let o=i+r,l=i,a=i-e;for(;;){let u=n.to+a-t.to||n.endSide-t.endSide,h=u<0?n.to+a:t.to,c=Math.min(h,o);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&_d(n.activeForPoint(n.to+a),t.activeForPoint(t.to))||s.comparePoint(l,c,n.point,t.point):c>l&&!_d(n.active,t.active)&&s.compareRange(l,c,n.active,t.active),h>o)break;l=h,u<=0&&n.next(),u>=0&&t.next()}}function _d(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function va(n,e){for(let t=e,i=n.length-1;t<i;t++)n[t]=n[t+1];n.pop()}function ya(n,e,t){for(let i=n.length-1;i>=e;i--)n[i+1]=n[i];n[e]=t}function Ev(n,e){let t=-1,i=1e9;for(let r=0;r<e.length;r++)(e[r]-i||n[r].endSide-n[t].endSide)<0&&(t=r,i=e[r]);return t}var Hi={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Bu={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},kv=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),KE=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),JE=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),Ov=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),YE=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),XE=kv&&(Ov||+kv[1]<57)||JE&&Ov;for(var it=0;it<10;it++)Hi[48+it]=Hi[96+it]=String(it);for(var it=1;it<=24;it++)Hi[it+111]="F"+it;for(var it=65;it<=90;it++)Hi[it]=String.fromCharCode(it+32),Bu[it]=String.fromCharCode(it);for(var Vc in Hi)Bu.hasOwnProperty(Vc)||(Bu[Vc]=Hi[Vc]);function QE(n){var e=XE&&(n.ctrlKey||n.altKey||n.metaKey)||(KE||YE)&&n.shiftKey&&n.key&&n.key.length==1,t=!e&&n.key||(n.shiftKey?Bu:Hi)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function ju(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function Pd(n,e){return e?n.contains(e.nodeType!=1?e.parentNode:e):!1}function ZE(){let n=document.activeElement;for(;n&&n.shadowRoot;)n=n.shadowRoot.activeElement;return n}function Td(n,e){if(!e.anchorNode)return!1;try{return Pd(n,e.anchorNode)}catch{return!1}}function Cl(n){return n.nodeType==3?Sl(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function $u(n,e,t,i){return t?_v(n,e,t,i,-1)||_v(n,e,t,i,1):!1}function Ad(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function _v(n,e,t,i,r){for(;;){if(n==t&&e==i)return!0;if(e==(r<0?0:Gu(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=Ad(n)+(r<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(r<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=r<0?Gu(n):0}else return!1}}function Gu(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}const YS={left:0,right:0,top:0,bottom:0};function wh(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function ek(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function tk(n,e,t,i,r,s,o,l){let a=n.ownerDocument,u=a.defaultView;for(let h=n;h;)if(h.nodeType==1){let c,f=h==a.body;if(f)c=ek(u);else{if(h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.parentNode;continue}let w=h.getBoundingClientRect();c={left:w.left,right:w.left+h.clientWidth,top:w.top,bottom:w.top+h.clientHeight}}let d=0,m=0;if(r=="nearest")e.top<c.top?(m=-(c.top-e.top+o),t>0&&e.bottom>c.bottom+m&&(m=e.bottom-c.bottom+m+o)):e.bottom>c.bottom&&(m=e.bottom-c.bottom+o,t<0&&e.top-m<c.top&&(m=-(c.top+m-e.top+o)));else{let w=e.bottom-e.top,v=c.bottom-c.top;m=(r=="center"&&w<=v?e.top+w/2-v/2:r=="start"||r=="center"&&t<0?e.top-o:e.bottom-v+o)-c.top}if(i=="nearest"?e.left<c.left?(d=-(c.left-e.left+s),t>0&&e.right>c.right+d&&(d=e.right-c.right+d+s)):e.right>c.right&&(d=e.right-c.right+s,t<0&&e.left<c.left+d&&(d=-(c.left+d-e.left+s))):d=(i=="center"?e.left+(e.right-e.left)/2-(c.right-c.left)/2:i=="start"==l?e.left-s:e.right-(c.right-c.left)+s)-c.left,d||m)if(f)u.scrollBy(d,m);else{if(m){let w=h.scrollTop;h.scrollTop+=m,m=h.scrollTop-w}if(d){let w=h.scrollLeft;h.scrollLeft+=d,d=h.scrollLeft-w}e={left:e.left-d,top:e.top-m,right:e.right-d,bottom:e.bottom-m}}if(f)break;h=h.assignedSlot||h.parentNode,i=r="nearest"}else if(h.nodeType==11)h=h.host;else break}class nk{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,r){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=r}}let Hr=null;function XS(n){if(n.setActive)return n.setActive();if(Hr)return n.focus(Hr);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(Hr==null?{get preventScroll(){return Hr={preventScroll:!0},!0}}:void 0),!Hr){Hr=!1;for(let t=0;t<e.length;){let i=e[t++],r=e[t++],s=e[t++];i.scrollTop!=r&&(i.scrollTop=r),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let Pv;function Sl(n,e,t=e){let i=Pv||(Pv=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function Qo(n,e,t){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0},r=new KeyboardEvent("keydown",i);r.synthetic=!0,n.dispatchEvent(r);let s=new KeyboardEvent("keyup",i);return s.synthetic=!0,n.dispatchEvent(s),r.defaultPrevented||s.defaultPrevented}function ik(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function QS(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}class ht{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new ht(e.parentNode,Ad(e),t)}static after(e,t){return new ht(e.parentNode,Ad(e)+1,t)}}const hm=[];class De{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(this.dirty&2){let t=this.dom,i=t.firstChild;for(let r of this.children){if(r.dirty){if(!r.dom&&i){let s=De.get(i);(!s||!s.parent&&s.constructor==r.constructor)&&r.reuseDOM(i)}r.sync(e),r.dirty=0}if(e&&!e.written&&e.node==t&&i!=r.dom&&(e.written=!0),r.dom.parentNode==t){for(;i&&i!=r.dom;)i=Tv(i);i=r.dom.nextSibling}else t.insertBefore(r.dom,i)}for(i&&e&&e.node==t&&(e.written=!0);i;)i=Tv(i)}else if(this.dirty&1)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let r=Gu(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?r=-1:r=1),e=s}r<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!De.get(i);)i=i.nextSibling;if(!i)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==i)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let r=-1,s=-1,o=-1,l=-1;for(let a=0,u=i,h=i;a<this.children.length;a++){let c=this.children[a],f=u+c.length;if(u<e&&f>t)return c.domBoundsAround(e,t,u);if(f>=e&&r==-1&&(r=a,s=u),u>t&&c.dom.parentNode==this.dom){o=a,l=h;break}h=f,u=f+c.breakAfter}return{from:s,to:l<0?i+this.length:l,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=hm){this.markDirty();for(let r=e;r<t;r++){let s=this.children[r];s.parent==this&&s.destroy()}this.children.splice(e,t-e,...i);for(let r=0;r<i.length;r++)i[r].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ZS(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,r,s,o){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}De.prototype.breakAfter=0;function Tv(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class ZS{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function ew(n,e,t,i,r,s,o,l,a){let{children:u}=n,h=u.length?u[e]:null,c=s.length?s[s.length-1]:null,f=c?c.breakAfter:o;if(!(e==i&&h&&!o&&!f&&s.length<2&&h.merge(t,r,s.length?c:null,t==0,l,a))){if(i<u.length){let d=u[i];d&&r<d.length?(e==i&&(d=d.split(r),r=0),!f&&c&&d.merge(0,r,c,!0,0,a)?s[s.length-1]=d:(r&&d.merge(0,r,null,!1,0,a),s.push(d))):(d==null?void 0:d.breakAfter)&&(c?c.breakAfter=1:o=1),i++}for(h&&(h.breakAfter=o,t>0&&(!o&&s.length&&h.merge(t,h.length,s[0],!1,l,0)?h.breakAfter=s.shift().breakAfter:(t<h.length||h.children.length&&h.children[h.children.length-1].length==0)&&h.merge(t,h.length,null,!1,l,0),e++));e<i&&s.length;)if(u[i-1].become(s[s.length-1]))i--,s.pop(),a=s.length?0:l;else if(u[e].become(s[0]))e++,s.shift(),l=s.length?0:a;else break;!s.length&&e&&i<u.length&&!u[e-1].breakAfter&&u[i].merge(0,0,u[e-1],!1,l,a)&&e--,(e<i||s.length)&&n.replaceChildren(e,i,s)}}function tw(n,e,t,i,r,s){let o=n.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:u,off:h}=o.findPos(e,-1),c=e-t;for(let f of i)c+=f.length;n.length+=c,ew(n,u,h,l,a,i,0,r,s)}let Bt=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},Nd=typeof document!="undefined"?document:{documentElement:{style:{}}};const Id=/Edge\/(\d+)/.exec(Bt.userAgent),nw=/MSIE \d/.test(Bt.userAgent),Dd=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Bt.userAgent),xh=!!(nw||Dd||Id),Av=!xh&&/gecko\/(\d+)/i.test(Bt.userAgent),Wc=!xh&&/Chrome\/(\d+)/.exec(Bt.userAgent),Nv="webkitFontSmoothing"in Nd.documentElement.style,iw=!xh&&/Apple Computer/.test(Bt.vendor),Iv=iw&&(/Mobile\/\w+/.test(Bt.userAgent)||Bt.maxTouchPoints>2);var Q={mac:Iv||/Mac/.test(Bt.platform),windows:/Win/.test(Bt.platform),linux:/Linux|X11/.test(Bt.platform),ie:xh,ie_version:nw?Nd.documentMode||6:Dd?+Dd[1]:Id?+Id[1]:0,gecko:Av,gecko_version:Av?+(/Firefox\/(\d+)/.exec(Bt.userAgent)||[0,0])[1]:0,chrome:!!Wc,chrome_version:Wc?+Wc[1]:0,ios:Iv,android:/Android\b/.test(Bt.userAgent),webkit:Nv,safari:iw,webkit_version:Nv?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Nd.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const rk=256;class Sr extends De{constructor(e){super();this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return i&&(!(i instanceof Sr)||this.length-(t-e)+i.length>rk)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Sr(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new ht(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return rw(this.dom,e,t)}}class wr extends De{constructor(e,t=[],i=0){super();this.mark=e,this.children=t,this.length=i;for(let r of t)r.setParent(this)}setAttrs(e){if(QS(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,r,s,o){return i&&(!(i instanceof wr&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(tw(this,e,t,i?i.children:[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,r=-1,s=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),r<0&&i>=e&&(r=s),i=a,s++}let o=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new wr(this.mark,t,o)}domAtPos(e){return sw(this.dom,this.children,e)}coordsAt(e,t){return lw(this,e,t)}}function rw(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let r=e,s=e,o=0;e==0&&t<0||e==i&&t>=0?Q.chrome||Q.gecko||(e?(r--,o=1):(s++,o=-1)):t<0?r--:s++;let l=Sl(n,r,s).getClientRects();if(!l.length)return YS;let a=l[(o?o<0:t>=0)?0:l.length-1];return Q.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,u=>u.width)||a),o?wh(a,o<0):a||null}class ki extends De{constructor(e,t,i){super();this.widget=e,this.length=t,this.side=i}static create(e,t,i){return new(e.customView||ki)(e,t,i)}split(e){let t=ki.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,r,s,o){return i&&(!(i instanceof ki)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof ki&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return me.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):me.empty}domAtPos(e){return e==0?ht.before(this.dom):ht.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),r=null;if(!i.length)return YS;for(let s=e>0?i.length-1:0;r=i[s],!(e>0?s==0:s==i.length-1||r.top<r.bottom);s+=e>0?-1:1);return e==0&&t>0||e==this.length&&t<=0?r:wh(r,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class sk extends ki{domAtPos(e){return new ht(this.widget.text,e)}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){return t?e.nodeType==3?Math.min(t,this.length):this.length:0}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){return rw(this.widget.text,e,t)}get isEditable(){return!0}}class Ps extends De{constructor(e){super();this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Ps&&e.side==this.side}split(){return new Ps(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return ht.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return me.empty}}Sr.prototype.children=ki.prototype.children=Ps.prototype.children=hm;function sw(n,e,t){let i=0;for(let r=0;i<e.length;i++){let s=e[i],o=r+s.length;if(!(o==r&&s.getSide()<=0)){if(t>r&&t<o&&s.dom.parentNode==n)return s.domAtPos(t-r);if(t<=r)break;r=o}}for(;i>0;i--){let r=e[i-1].dom;if(r.parentNode==n)return ht.after(r)}return new ht(n,0)}function ow(n,e,t){let i,{children:r}=n;t>0&&e instanceof wr&&r.length&&(i=r[r.length-1])instanceof wr&&i.mark.eq(e.mark)?ow(i,e.children[0],t-1):(r.push(e),e.setParent(n)),n.length+=e.length}function lw(n,e,t){for(let s=0,o=0;o<n.children.length;o++){let l=n.children[o],a=s+l.length,u;if((t<=0||a==n.length||l.getSide()>0?a>=e:a>e)&&(e<a||o+1==n.children.length||(u=n.children[o+1]).length||u.getSide()>0)){let h=0;if(a==s){if(l.getSide()<=0)continue;h=t=-l.getSide()}let c=l.coordsAt(Math.max(0,e-s),t);return h&&c?wh(c,t<0):c}s=a}let i=n.dom.lastChild;if(!i)return n.dom.getBoundingClientRect();let r=Cl(i);return r[r.length-1]||null}function Rd(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}function cm(n,e){if(n==e)return!0;if(!n||!e)return!1;let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r of t)if(i.indexOf(r)==-1||n[r]!==e[r])return!1;return!0}function Ld(n,e,t){if(e)for(let i in e)t&&i in t||n.removeAttribute(i);if(t)for(let i in t)e&&e[i]==t[i]||n.setAttribute(i,t[i])}class ti{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var we=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(we||(we={}));class Z extends Cr{constructor(e,t,i,r){super();this.startSide=e,this.endSide=t,this.widget=i,this.spec=r}get heightRelevant(){return!1}static mark(e){return new bh(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new xr(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,{start:i,end:r}=aw(e,t),s=(i?t?-3e8:-1:4e8)-1,o=(r?t?2e8:1:-5e8)+1;return new xr(e,s,o,t,e.widget||null,!0)}static line(e){return new Ll(e)}static set(e,t=!1){return de.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Z.none=de.empty;class bh extends Z{constructor(e){let{start:t,end:i}=aw(e);super(t?-1:4e8,i?1:-5e8,null,e);this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof bh&&this.tagName==e.tagName&&this.class==e.class&&cm(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}bh.prototype.point=!1;class Ll extends Z{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Ll&&cm(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Ll.prototype.mapMode=Ct.TrackBefore;Ll.prototype.point=!0;class xr extends Z{constructor(e,t,i,r,s,o){super(t,i,s,e);this.block=r,this.isReplace=o,this.mapMode=r?t<=0?Ct.TrackBefore:Ct.TrackAfter:Ct.TrackDel}get type(){return this.startSide<this.endSide?we.WidgetRange:this.startSide<=0?we.WidgetBefore:we.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof xr&&ok(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}xr.prototype.point=!0;function aw(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t!=null?t:e,end:i!=null?i:e}}function ok(n,e){return n==e||!!(n&&e&&n.compare(e))}function Md(n,e,t,i=0){let r=t.length-1;r>=0&&t[r]+i>=n?t[r]=Math.max(t[r],e):t.push(n,e)}class St extends De{constructor(){super(...arguments);this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,r,s,o){if(i){if(!(i instanceof St))return!1;this.dom||i.transferDOM(this)}return r&&this.setDeco(i?i.attrs:null),tw(this,e,t,i?i.children:[],s,o),!0}split(e){let t=new St;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:r}=this.childPos(e);r&&(t.append(this.children[i].split(r),0),this.children[i].merge(r,this.children[i].length,null,!1,0,0),i++);for(let s=i;s<this.children.length;s++)t.append(this.children[s],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){cm(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){ow(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=Rd(t,this.attrs||{})),i&&(this.attrs=Rd({class:i},this.attrs||{}))}domAtPos(e){return sw(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?this.dirty&4&&(QS(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Ld(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&De.get(i)instanceof wr;)i=i.lastChild;if(!i||i.nodeName!="BR"&&((t=De.get(i))===null||t===void 0?void 0:t.isEditable)==!1&&(!Q.ios||!this.children.some(r=>r instanceof Sr))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof Sr))return null;let i=Cl(t.dom);if(i.length!=1)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return lw(this,e,t)}become(e){return!1}get type(){return we.Text}static find(e,t){for(let i=0,r=0;i<e.children.length;i++){let s=e.children[i],o=r+s.length;if(o>=t){if(s instanceof St)return s;if(o>t)break}r=o+s.breakAfter}return null}}class pr extends De{constructor(e,t,i){super();this.widget=e,this.length=t,this.type=i,this.breakAfter=0}merge(e,t,i,r,s,o){return i&&(!(i instanceof pr)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?ht.before(this.dom):ht.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new pr(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return hm}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):me.empty}domBoundsAround(){return null}become(e){return e instanceof pr&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class fm{constructor(e,t,i,r){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsBelow=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof pr&&e.type==we.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new St),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(Ca(new Ps(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=s,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append(Ca(new Sr(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=0}}span(e,t,i,r){this.buildText(t-e,i,r),this.pos=t,this.openStart<0&&(this.openStart=r)}point(e,t,i,r,s){let o=t-e;if(i instanceof xr)if(i.block){let{type:l}=i;l==we.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new pr(i.widget||new Dv("div"),o,l))}else{let l=ki.create(i.widget||new Dv("span"),o,i.startSide),a=this.atCursorPos&&!l.isEditable&&s<=r.length&&(e<t||i.startSide>0),u=!l.isEditable&&(e<t||i.startSide<=0),h=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(r),a&&(h.append(Ca(new Ps(1),r),s),s=r.length+Math.max(0,s-r.length)),h.append(Ca(l,r),s),this.atCursorPos=u,this.pendingBuffer=u?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}filterPoint(e,t,i,r){if(r<this.disallowBlockEffectsBelow&&i instanceof xr){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(e,t,i,r,s){let o=new fm(e,t,i,s);return o.openEnd=de.spans(r,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Ca(n,e){for(let t of e)n=new wr(t,[n],n.length);return n}class Dv extends ti{constructor(e){super();this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const lk=[],uw=Y.define(),hw=Y.define(),cw=Y.define(),fw=Y.define(),Fd=Y.define(),dw=Y.define(),Vd=ie.define({map:(n,e)=>n.map(e)}),pw=ie.define({map:(n,e)=>n.map(e)});class ls{constructor(e,t="nearest",i="nearest",r=5,s=5){this.range=e,this.y=t,this.x=i,this.yMargin=r,this.xMargin=s}map(e){return e.empty?this:new ls(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const Rv=ie.define({map:(n,e)=>n.map(e)});function Ht(n,e,t){let i=n.facet(fw);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const Ml=Y.define({combine:n=>n.length?n[0]:!0});class ak{constructor(e,t){this.field=e,this.get=t}}class pt{from(e){return new ak(this,e)}static define(){return new pt}}pt.decorations=pt.define();pt.atomicRanges=pt.define();pt.scrollMargins=pt.define();let uk=0;const Do=Y.define();class Ve{constructor(e,t,i){this.id=e,this.create=t,this.fields=i,this.extension=Do.of(this)}static define(e,t){let{eventHandlers:i,provide:r,decorations:s}=t||{},o=[];if(r)for(let l of Array.isArray(r)?r:[r])o.push(l);return i&&o.push(mw.from(l=>({plugin:l,handlers:i}))),s&&o.push(pt.decorations.from(s)),new Ve(uk++,e,o)}static fromClass(e,t){return Ve.define(i=>new e(i),t)}}const mw=pt.define();class Bc{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}takeField(e,t){if(this.spec)for(let{field:i,get:r}of this.spec.fields)i==e&&t.push(r(this.value))}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(Ht(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Ht(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if((t=this.value)===null||t===void 0?void 0:t.destroy)try{this.value.destroy()}catch(i){Ht(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const gw=Y.define(),vw=Y.define(),hr=Y.define(),Ro=Y.define();class Xn{constructor(e,t,i,r){this.fromA=e,this.toA=t,this.fromB=i,this.toB=r}join(e){return new Xn(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let r=e[t-1];if(!(r.fromA>i.toA)){if(r.toA<i.fromA)break;i=i.join(r),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let r=0,s=0,o=0,l=0;;r++){let a=r==e.length?null:e[r],u=o-l,h=a?a.fromB:1e9;for(;s<t.length&&t[s]<h;){let c=t[s],f=t[s+1],d=Math.max(l,c),m=Math.min(h,f);if(d<=m&&new Xn(d+u,m+u,d,m).addToSet(i),f>h)break;s+=2}if(!a)return i;new Xn(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class Lv{constructor(e,t,i=lk){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=Ue.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let r=[];this.changes.iterChangedRanges((o,l,a,u)=>r.push(new Xn(o,l,a,u))),this.changedRanges=r;let s=e.hasFocus;s!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var fe=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(fe||(fe={}));const Wd=fe.LTR,hk=fe.RTL;function yw(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const ck=yw("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),fk=yw("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Bd=Object.create(null),gn=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);Bd[e]=t,Bd[t]=-e}function dk(n){return n<=247?ck[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?fk[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203||n==8204?256:1}const pk=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class ws{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?hk:Wd}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,r){let s=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(s<0||(r!=0?r<0?l.from<t:l.to>t:e[s].level>l.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}const Te=[];function mk(n,e){let t=n.length,i=e==Wd?1:2,r=e==Wd?2:1;if(!n||i==1&&!pk.test(n))return Cw(t);for(let o=0,l=i,a=i;o<t;o++){let u=dk(n.charCodeAt(o));u==512?u=l:u==8&&a==4&&(u=16),Te[o]=u==4?2:u,u&7&&(a=u),l=u}for(let o=0,l=i,a=i;o<t;o++){let u=Te[o];if(u==128)o<t-1&&l==Te[o+1]&&l&24?u=Te[o]=l:Te[o]=256;else if(u==64){let h=o+1;for(;h<t&&Te[h]==64;)h++;let c=o&&l==8||h<t&&Te[h]==8?a==1?1:8:256;for(let f=o;f<h;f++)Te[f]=c;o=h-1}else u==8&&a==1&&(Te[o]=1);l=u,u&7&&(a=u)}for(let o=0,l=0,a=0,u,h,c;o<t;o++)if(h=Bd[u=n.charCodeAt(o)])if(h<0){for(let f=l-3;f>=0;f-=3)if(gn[f+1]==-h){let d=gn[f+2],m=d&2?i:d&4?d&1?r:i:0;m&&(Te[o]=Te[gn[f]]=m),l=f;break}}else{if(gn.length==189)break;gn[l++]=o,gn[l++]=u,gn[l++]=a}else if((c=Te[o])==2||c==1){let f=c==i;a=f?0:1;for(let d=l-3;d>=0;d-=3){let m=gn[d+2];if(m&2)break;if(f)gn[d+2]|=2;else{if(m&4)break;gn[d+2]|=4}}}for(let o=0;o<t;o++)if(Te[o]==256){let l=o+1;for(;l<t&&Te[l]==256;)l++;let a=(o?Te[o-1]:i)==1,u=(l<t?Te[l]:i)==1,h=a==u?a?1:2:i;for(let c=o;c<l;c++)Te[c]=h;o=l-1}let s=[];if(i==1)for(let o=0;o<t;){let l=o,a=Te[o++]!=1;for(;o<t&&a==(Te[o]!=1);)o++;if(a)for(let u=o;u>l;){let h=u,c=Te[--u]!=2;for(;u>l&&c==(Te[u-1]!=2);)u--;s.push(new ws(u,h,c?2:1))}else s.push(new ws(l,o,0))}else for(let o=0;o<t;){let l=o,a=Te[o++]==2;for(;o<t&&a==(Te[o]==2);)o++;s.push(new ws(l,o,a?1:2))}return s}function Cw(n){return[new ws(0,n,0)]}let Sw="";function gk(n,e,t,i,r){var s;let o=i.head-n.from,l=-1;if(o==0){if(!r||!n.length)return null;e[0].level!=t&&(o=e[0].side(!1,t),l=0)}else if(o==n.length){if(r)return null;let f=e[e.length-1];f.level!=t&&(o=f.side(!0,t),l=e.length-1)}l<0&&(l=ws.find(e,o,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc));let a=e[l];o==a.side(r,t)&&(a=e[l+=r?1:-1],o=a.side(!r,t));let u=r==(a.dir==t),h=jt(n.text,o,u);if(Sw=n.text.slice(Math.min(o,h),Math.max(o,h)),h!=a.side(r,t))return F.cursor(h+n.from,u?-1:1,a.level);let c=l==(r?e.length-1:0)?null:e[l+(r?1:-1)];return!c&&a.level!=t?F.cursor(r?n.to:n.from,r?-1:1,t):c&&c.level<a.level?F.cursor(c.side(!r,t)+n.from,r?1:-1,c.level):F.cursor(h+n.from,r?-1:1,a.level)}const Oi="\uFFFF";class ww{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(ce.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Oi}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let r=e;;){this.findPointBefore(i,r),this.readNode(r);let s=r.nextSibling;if(s==t)break;let o=De.get(r),l=De.get(s);(o&&l?o.breakAfter:(o?o.breakAfter:Mv(r))||Mv(s)&&(r.nodeName!="BR"||r.cmIgnore))&&this.lineBreak(),r=s}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,l;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=r.exec(t))&&(s=l.index,o=l[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=De.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let r=i.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function Mv(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class Fv{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class Vv extends De{constructor(e){super();this.view=e,this.compositionDeco=Z.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new St],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Xn(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Z.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=yk(this.view,e.changes)),(Q.ie||Q.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,r=this.updateDeco(),s=xk(i,r,e.changes);return t=Xn.extendWithRanges(t,s),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let s=Q.chrome||Q.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(s),this.dirty=0,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""});let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof pr&&s.widget instanceof Wv&&r.push(s.dom);i.updateGaps(r)}updateChildren(e,t){let i=this.childCursor(t);for(let r=e.length-1;;r--){let s=r>=0?e[r]:null;if(!s)break;let{fromA:o,toA:l,fromB:a,toB:u}=s,{content:h,breakAtStart:c,openStart:f,openEnd:d}=fm.build(this.view.state.doc,a,u,this.decorations,this.pluginDecorationLength),{i:m,off:w}=i.findPos(l,1),{i:v,off:p}=i.findPos(o,-1);ew(this,v,p,m,w,h,c,f,d)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!(t||this.mayControlSelection())||Q.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let r=this.view.state.selection.main,s=this.domAtPos(r.anchor),o=r.empty?s:this.domAtPos(r.head);if(Q.gecko&&r.empty&&vk(s)){let a=document.createTextNode("");this.view.observer.ignore(()=>s.node.insertBefore(a,s.node.childNodes[s.offset]||null)),s=o=new ht(a,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!$u(s.node,s.offset,l.anchorNode,l.anchorOffset)||!$u(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{Q.android&&Q.chrome&&this.dom.contains(l.focusNode)&&bk(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let a=ju(this.root);if(r.empty){if(Q.gecko){let u=Sk(s.node,s.offset);if(u&&u!=3){let h=bw(s.node,s.offset,u==1?1:-1);h&&(s=new ht(h,u==1?0:h.nodeValue.length))}}a.collapse(s.node,s.offset),r.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=r.bidiLevel)}else if(a.extend)a.collapse(s.node,s.offset),a.extend(o.node,o.offset);else{let u=document.createRange();r.anchor>r.head&&([s,o]=[o,s]),u.setEnd(o.node,o.offset),u.setStart(s.node,s.offset),a.removeAllRanges(),a.addRange(u)}}),this.view.observer.setSelectionRange(s,o)),this.impreciseAnchor=s.precise?null:new ht(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new ht(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=ju(this.root);if(!e.empty||!e.assoc||!t.modify)return;let i=St.find(this,e.head);if(!i)return;let r=i.posAtStart;if(e.head==r||e.head==r+i.length)return;let s=this.coordsAt(e.head,-1),o=this.coordsAt(e.head,1);if(!s||!o||s.bottom>o.top)return;let l=this.domAtPos(e.head+e.assoc);t.collapse(l.node,l.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Ml)?this.root.activeElement==this.dom:Td(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let i=De.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let r=this.children[t];if(i<r.length||r instanceof St)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,r=this.children.length-1;;r--){let s=this.children[r],o=i-s.breakAfter-s.length;if(e>o||e==o&&s.type!=we.WidgetBefore&&s.type!=we.WidgetAfter&&(!r||t==2||this.children[r-1].breakAfter||this.children[r-1].type==we.WidgetBefore&&t>-2))return s.coordsAt(e-o,t);i=o}}measureVisibleLineHeights(){let e=[],{from:t,to:i}=this.view.viewState.viewport,r=this.view.contentDOM.clientWidth,s=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1;for(let l=0,a=0;a<this.children.length;a++){let u=this.children[a],h=l+u.length;if(h>i)break;if(l>=t){let c=u.dom.getBoundingClientRect();if(e.push(c.height),s){let f=u.dom.lastChild,d=f?Cl(f):[];if(d.length){let m=d[d.length-1],w=this.view.textDirection==fe.LTR?m.right-c.left:c.right-m.left;w>o&&(o=w,this.minWidth=r,this.minWidthFrom=l,this.minWidthTo=h)}}}l=h+u.breakAfter}return e}measureTextSize(){for(let r of this.children)if(r instanceof St){let s=r.measureTextSize();if(s)return s}let e=document.createElement("div"),t,i;return e.className="cm-line",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=Cl(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,e.remove()}),{lineHeight:t,charWidth:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new ZS(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,r=0;;r++){let s=r==t.viewports.length?null:t.viewports[r],o=s?s.from-1:this.length;if(o>i){let l=t.lineBlockAt(o).bottom-t.lineBlockAt(i).top;e.push(Z.replace({widget:new Wv(l),block:!0,inclusive:!0}).range(i,o))}if(!s)break;i=s.to+1}return Z.set(e)}updateDeco(){let e=this.view.pluginField(pt.decorations);return this.pluginDecorationLength=e.length,this.decorations=[...e,...this.view.state.facet(hr),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),r;if(!i)return;!t.empty&&(r=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,r.left),top:Math.min(i.top,r.top),right:Math.max(i.right,r.right),bottom:Math.max(i.bottom,r.bottom)});let s=0,o=0,l=0,a=0;for(let h of this.view.pluginField(pt.scrollMargins))if(h){let{left:c,right:f,top:d,bottom:m}=h;c!=null&&(s=Math.max(s,c)),f!=null&&(o=Math.max(o,f)),d!=null&&(l=Math.max(l,d)),m!=null&&(a=Math.max(a,m))}let u={left:i.left-s,top:i.top-l,right:i.right+o,bottom:i.bottom+a};tk(this.view.scrollDOM,u,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==fe.LTR)}}function vk(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class Wv extends ti{constructor(e){super();this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function xw(n){let e=n.observer.selectionRange,t=e.focusNode&&bw(e.focusNode,e.focusOffset,0);if(!t)return null;let i=n.docView.nearest(t);if(!i)return null;if(i instanceof St){let r=t;for(;r.parentNode!=i.dom;)r=r.parentNode;let s=r.previousSibling;for(;s&&!De.get(s);)s=s.previousSibling;let o=s?De.get(s).posAtEnd:i.posAtStart;return{from:o,to:o,node:r,text:t}}else{for(;;){let{parent:s}=i;if(!s)return null;if(s instanceof St)break;i=s}let r=i.posAtStart;return{from:r,to:r+i.length,node:i.dom,text:t}}}function yk(n,e){let t=xw(n);if(!t)return Z.none;let{from:i,to:r,node:s,text:o}=t,l=e.mapPos(i,1),a=Math.max(l,e.mapPos(r,-1)),{state:u}=n,h=s.nodeType==3?s.nodeValue:new ww([],u).readRange(s.firstChild,null).text;if(a-l<h.length)if(u.doc.sliceString(l,Math.min(u.doc.length,l+h.length),Oi)==h)a=l+h.length;else if(u.doc.sliceString(Math.max(0,a-h.length),a,Oi)==h)l=a-h.length;else return Z.none;else if(u.doc.sliceString(l,a,Oi)!=h)return Z.none;return Z.set(Z.replace({widget:new Ck(s,o)}).range(l,a))}class Ck extends ti{constructor(e,t){super();this.top=e,this.text=t}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return sk}}function bw(n,e,t){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&e>0&&t<=0)n=n.childNodes[e-1],e=Gu(n);else if(n.nodeType==1&&e<n.childNodes.length&&t>=0)n=n.childNodes[e],e=0;else return null}}function Sk(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}class wk{constructor(){this.changes=[]}compareRange(e,t){Md(e,t,this.changes)}comparePoint(e,t){Md(e,t,this.changes)}}function xk(n,e,t){let i=new wk;return de.compare(n,e,t,i),i.changes}function bk(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function Ek(n,e,t=1){let i=n.charCategorizer(e),r=n.doc.lineAt(e),s=e-r.from;if(r.length==0)return F.cursor(e);s==0?t=1:s==r.length&&(t=-1);let o=s,l=s;t<0?o=jt(r.text,s,!1):l=jt(r.text,s);let a=i(r.text.slice(o,l));for(;o>0;){let u=jt(r.text,o,!1);if(i(r.text.slice(u,o))!=a)break;o=u}for(;l<r.length;){let u=jt(r.text,l);if(i(r.text.slice(l,u))!=a)break;l=u}return F.range(o+r.from,l+r.from)}function kk(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function Ok(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function jc(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function Bv(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function jv(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function jd(n,e,t){let i,r,s,o,l,a,u,h;for(let d=n.firstChild;d;d=d.nextSibling){let m=Cl(d);for(let w=0;w<m.length;w++){let v=m[w];r&&jc(r,v)&&(v=Bv(jv(v,r.bottom),r.top));let p=kk(e,v),y=Ok(t,v);if(p==0&&y==0)return d.nodeType==3?$v(d,e,t):jd(d,e,t);(!i||o>y||o==y&&s>p)&&(i=d,r=v,s=p,o=y),p==0?t>v.bottom&&(!u||u.bottom<v.bottom)?(l=d,u=v):t<v.top&&(!h||h.top>v.top)&&(a=d,h=v):u&&jc(u,v)?u=jv(u,v.bottom):h&&jc(h,v)&&(h=Bv(h,v.top))}}if(u&&u.bottom>=t?(i=l,r=u):h&&h.top<=t&&(i=a,r=h),!i)return{node:n,offset:0};let c=Math.max(r.left,Math.min(r.right,e));if(i.nodeType==3)return $v(i,c,t);if(!s&&i.contentEditable=="true")return jd(i,c,t);let f=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(r.left+r.right)/2?1:0);return{node:n,offset:f}}function $v(n,e,t){let i=n.nodeValue.length,r=-1,s=1e9,o=0;for(let l=0;l<i;l++){let a=Sl(n,l,l+1).getClientRects();for(let u=0;u<a.length;u++){let h=a[u];if(h.top==h.bottom)continue;o||(o=e-h.left);let c=(h.top>t?h.top-t:t-h.bottom)-1;if(h.left-1<=e&&h.right+1>=e&&c<s){let f=e>=(h.left+h.right)/2,d=f;if((Q.chrome||Q.gecko)&&Sl(n,l).getBoundingClientRect().left==h.right&&(d=!f),c<=0)return{node:n,offset:l+(d?1:0)};r=l+(d?1:0),s=c}}}return{node:n,offset:r>-1?r:o>0?n.nodeValue.length:0}}function Ew(n,{x:e,y:t},i,r=-1){var s;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,a,{docHeight:u}=n.viewState,h=t-l;if(h<0)return 0;if(h>u)return n.state.doc.length;for(let p=n.defaultLineHeight/2,y=!1;a=n.elementAtHeight(h),a.type!=we.Text;)for(;h=r>0?a.bottom+p:a.top-p,!(h>=0&&h<=u);){if(y)return i?null:0;y=!0,r=-r}t=l+h;let c=a.from;if(c<n.viewport.from)return n.viewport.from==0?0:i?null:Gv(n,o,a,e,t);if(c>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:i?null:Gv(n,o,a,e,t);let f=n.dom.ownerDocument,d=n.root.elementFromPoint?n.root:f,m=d.elementFromPoint(e,t);m&&!n.contentDOM.contains(m)&&(m=null),m||(e=Math.max(o.left+1,Math.min(o.right-1,e)),m=d.elementFromPoint(e,t),m&&!n.contentDOM.contains(m)&&(m=null));let w,v=-1;if(m&&((s=n.docView.nearest(m))===null||s===void 0?void 0:s.isEditable)!=!1){if(f.caretPositionFromPoint){let p=f.caretPositionFromPoint(e,t);p&&({offsetNode:w,offset:v}=p)}else if(f.caretRangeFromPoint){let p=f.caretRangeFromPoint(e,t);p&&({startContainer:w,startOffset:v}=p,Q.safari&&_k(w,v,e)&&(w=void 0))}}if(!w||!n.docView.dom.contains(w)){let p=St.find(n.docView,c);if(!p)return h>a.top+a.height/2?a.to:a.from;({node:w,offset:v}=jd(p.dom,e,t))}return n.docView.posFromDOM(w,v)}function Gv(n,e,t,i,r){let s=Math.round((i-e.left)*n.defaultCharacterWidth);n.lineWrapping&&t.height>n.defaultLineHeight*1.5&&(s+=Math.floor((r-t.top)/n.defaultLineHeight)*n.viewState.heightOracle.lineLength);let o=n.state.sliceDoc(t.from,t.to);return t.from+gd(o,s,n.state.tabSize)}function _k(n,e,t){let i;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(let r=n.nextSibling;r;r=r.nextSibling)if(r.nodeType!=1||r.nodeName!="BR")return!1;return Sl(n,i-1,i).getBoundingClientRect().left>t}function Pk(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=!i||!n.lineWrapping?null:n.coordsAtPos(e.assoc<0&&e.head>r.from?e.head-1:e.head);if(s){let a=n.dom.getBoundingClientRect(),u=n.posAtCoords({x:t==(n.textDirection==fe.LTR)?a.right-1:a.left+1,y:(s.top+s.bottom)/2});if(u!=null)return F.cursor(u,t?-1:1)}let o=St.find(n.docView,e.head),l=o?t?o.posAtEnd:o.posAtStart:t?r.to:r.from;return F.cursor(l,t?-1:1)}function Hv(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=n.bidiSpans(r);for(let o=e,l=null;;){let a=gk(r,s,n.textDirection,o,t),u=Sw;if(!a){if(r.number==(t?n.state.doc.lines:1))return o;u=`
`,r=n.state.doc.line(r.number+(t?1:-1)),s=n.bidiSpans(r),a=F.cursor(t?r.from:r.to)}if(l){if(!l(u))return o}else{if(!i)return a;l=i(u)}o=a}}function Tk(n,e,t){let i=n.state.charCategorizer(e),r=i(t);return s=>{let o=i(s);return r==$t.Space&&(r=o),r==o}}function Ak(n,e,t,i){let r=e.head,s=t?1:-1;if(r==(t?n.state.doc.length:0))return F.cursor(r,e.assoc);let o=e.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),u=n.coordsAtPos(r),h=n.documentTop;if(u)o==null&&(o=u.left-a.left),l=s<0?u.top:u.bottom;else{let d=n.viewState.lineBlockAt(r-h);o==null&&(o=Math.min(a.right-a.left,n.defaultCharacterWidth*(r-d.from))),l=(s<0?d.top:d.bottom)+h}let c=a.left+o,f=i!=null?i:n.defaultLineHeight>>1;for(let d=0;;d+=10){let m=l+(f+d)*s,w=Ew(n,{x:c,y:m},!1,s);if(m<a.top||m>a.bottom||(s<0?w<r:w>r))return F.cursor(w,e.assoc,void 0,o)}}function $c(n,e,t){let i=n.pluginField(pt.atomicRanges);for(;;){let r=!1;for(let s of i)s.between(t.from-1,t.from+1,(o,l,a)=>{t.from>o&&t.from<l&&(t=e.from>t.from?F.cursor(o,1):F.cursor(l,-1),r=!0)});if(!r)return t}}class Nk{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in He){let i=He[t];e.contentDOM.addEventListener(t,r=>{t=="keydown"&&this.keydown(e,r)||!zv(e,r)||this.ignoreDuringComposition(r)||(this.mustFlushObserver(r)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,r)?r.preventDefault():i(e,r))}),this.registeredEvents.push(t)}this.notifiedFocused=e.hasFocus,this.ensureHandlers(e),Q.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e){let t=this.customHandlers=e.pluginField(mw);for(let i of t)for(let r in i.handlers)this.registeredEvents.indexOf(r)<0&&r!="scroll"&&(this.registeredEvents.push(r),e.contentDOM.addEventListener(r,s=>{!zv(e,s)||this.runCustomHandlers(r,e,s)&&s.preventDefault()}))}runCustomHandlers(e,t,i){for(let r of this.customHandlers){let s=r.handlers[e];if(s)try{if(s.call(r.plugin,i,t)||i.defaultPrevented)return!0}catch(o){Ht(t.state,o)}}return!1}runScrollHandlers(e,t){for(let i of this.customHandlers){let r=i.handlers.scroll;if(r)try{r.call(i.plugin,t,e)}catch(s){Ht(e.state,s)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),this.screenKeyEvent(e,t))return!0;if(Q.android&&Q.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return Q.ios&&(i=kw.find(r=>r.keyCode==t.keyCode))&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,Qo(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:Q.safari&&Date.now()-this.compositionEndedAt<500?(this.compositionEndedAt=0,!0):!1:!1}screenKeyEvent(e,t){let i=t.keyCode==9&&Date.now()<this.lastEscPress+2e3;return t.keyCode==27?this.lastEscPress=Date.now():Ow.indexOf(t.keyCode)<0&&(this.lastEscPress=0),i}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!Q.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const kw=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Ow=[16,17,18,20,91,92,224,225];class Ik{constructor(e,t,i,r){this.view=e,this.style=i,this.mustSelect=r,this.lastEvent=t;let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(ce.allowMultipleSelections)&&Dk(e,t),this.dragMove=Rk(e,t),this.dragging=Lk(e,t)&&dm(t)==1?null:!1,this.dragging===!1&&(t.preventDefault(),this.select(t))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Dk(n,e){let t=n.state.facet(uw);return t.length?t[0](e):Q.mac?e.metaKey:e.ctrlKey}function Rk(n,e){let t=n.state.facet(hw);return t.length?t[0](e):Q.mac?!e.altKey:!e.ctrlKey}function Lk(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=ju(n.root);if(i.rangeCount==0)return!0;let r=i.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function zv(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=De.get(t))&&i.ignoreEvent(e))return!1;return!0}const He=Object.create(null),_w=Q.ie&&Q.ie_version<15||Q.ios&&Q.webkit_version<604;function Mk(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),Pw(n,t.value)},50)}function Pw(n,e){let{state:t}=n,i,r=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if($d!=null&&t.selection.ranges.every(a=>a.empty)&&$d==s.toString()){let a=-1;i=t.changeByRange(u=>{let h=t.doc.lineAt(u.from);if(h.from==a)return{range:u};a=h.from;let c=t.toText((o?s.line(r++).text:e)+t.lineBreak);return{changes:{from:h.from,insert:c},range:F.cursor(u.from+c.length)}})}else o?i=t.changeByRange(a=>{let u=s.line(r++);return{changes:{from:a.from,to:a.to,insert:u.text},range:F.cursor(a.from+u.length)}}):i=t.replaceSelection(s);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}He.keydown=(n,e)=>{n.inputState.setSelectionOrigin("select")};let Tw=0;He.touchstart=(n,e)=>{Tw=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};He.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};He.mousedown=(n,e)=>{if(n.observer.flush(),Tw>Date.now()-2e3&&dm(e)==1)return;let t=null;for(let i of n.state.facet(cw))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=Wk(n,e)),t){let i=n.root.activeElement!=n.contentDOM;i&&n.observer.ignore(()=>XS(n.contentDOM)),n.inputState.startMouseSelection(new Ik(n,e,t,i))}};function Uv(n,e,t,i){if(i==1)return F.cursor(e,t);if(i==2)return Ek(n.state,e,t);{let r=St.find(n.docView,e),s=n.state.doc.lineAt(r?r.posAtEnd:e),o=r?r.posAtStart:s.from,l=r?r.posAtEnd:s.to;return l<n.state.doc.length&&l==s.to&&l++,F.range(o,l)}}let Aw=(n,e)=>n>=e.top&&n<=e.bottom,qv=(n,e,t)=>Aw(e,t)&&n>=t.left&&n<=t.right;function Fk(n,e,t,i){let r=St.find(n.docView,e);if(!r)return 1;let s=e-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&qv(t,i,o))return-1;let l=r.coordsAt(s,1);return l&&qv(t,i,l)?1:o&&Aw(i,o)?-1:1}function Kv(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Fk(n,t,e.clientX,e.clientY)}}const Vk=Q.ie&&Q.ie_version<=11;let Jv=null,Yv=0,Xv=0;function dm(n){if(!Vk)return n.detail;let e=Jv,t=Xv;return Jv=n,Xv=Date.now(),Yv=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(Yv+1)%3:1}function Wk(n,e){let t=Kv(n,e),i=dm(e),r=n.state.selection,s=t,o=e;return{update(l){l.docChanged&&(t&&(t.pos=l.changes.mapPos(t.pos)),r=r.map(l.changes),o=null)},get(l,a,u){let h;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?h=s:(h=s=Kv(n,l),o=l),!h||!t)return r;let c=Uv(n,h.pos,h.bias,i);if(t.pos!=h.pos&&!a){let f=Uv(n,t.pos,t.bias,i),d=Math.min(f.from,c.from),m=Math.max(f.to,c.to);c=d<c.from?F.range(d,m):F.range(m,d)}return a?r.replaceRange(r.main.extend(c.from,c.to)):u?r.addRange(c):F.create([c])}}}He.dragstart=(n,e)=>{let{selection:{main:t}}=n.state,{mouseSelection:i}=n.inputState;i&&(i.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",n.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function Qv(n,e,t,i){if(!t)return;let r=n.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:s}=n.inputState,o=i&&s&&s.dragging&&s.dragMove?{from:s.dragging.from,to:s.dragging.to}:null,l={from:r,insert:t},a=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(r,-1),head:a.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"})}He.drop=(n,e)=>{if(!e.dataTransfer)return;if(n.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let i=Array(t.length),r=0,s=()=>{++r==t.length&&Qv(n,e,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),s()},l.readAsText(t[o])}}else Qv(n,e,e.dataTransfer.getData("Text"),!0)};He.paste=(n,e)=>{if(n.state.readOnly)return e.preventDefault();n.observer.flush();let t=_w?null:e.clipboardData;t?(Pw(n,t.getData("text/plain")),e.preventDefault()):Mk(n)};function Bk(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function jk(n){let e=[],t=[],i=!1;for(let r of n.selection.ranges)r.empty||(e.push(n.sliceDoc(r.from,r.to)),t.push(r));if(!e.length){let r=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>r&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),r=o.number}i=!0}return{text:e.join(n.lineBreak),ranges:t,linewise:i}}let $d=null;He.copy=He.cut=(n,e)=>{let{text:t,ranges:i,linewise:r}=jk(n.state);if(!t&&!r)return;$d=r?t:null;let s=_w?null:e.clipboardData;s?(e.preventDefault(),s.clearData(),s.setData("text/plain",t)):Bk(n,t),e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};He.focus=He.blur=n=>{setTimeout(()=>{n.hasFocus!=n.inputState.notifiedFocused&&n.update([])},10)};He.beforeprint=n=>{n.viewState.printing=!0,n.requestMeasure(),setTimeout(()=>{n.viewState.printing=!1,n.requestMeasure()},2e3)};function Nw(n,e){if(n.docView.compositionDeco.size){n.inputState.rapidCompositionStart=e;try{n.update([])}finally{n.inputState.rapidCompositionStart=!1}}}He.compositionstart=He.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0,n.docView.compositionDeco.size&&(n.observer.flush(),Nw(n,!0)))};He.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionFirstChange=null,setTimeout(()=>{n.inputState.composing<0&&Nw(n,!1)},50)};He.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};He.beforeinput=(n,e)=>{var t;let i;if(Q.chrome&&Q.android&&(i=kw.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let r=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var s;(((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const Zv=["pre-wrap","normal","pre-line","break-spaces"];class $k{constructor(){this.doc=me.empty,this.lineWrapping=!1,this.direction=fe.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForStyle(e,t){return Zv.indexOf(e)>-1!=this.lineWrapping||this.direction!=t}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let r=e[i];r<0?i++:this.heightSamples[Math.floor(r*10)]||(t=!0,this.heightSamples[Math.floor(r*10)]=!0)}return t}refresh(e,t,i,r,s,o){let l=Zv.indexOf(e)>-1,a=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=l||this.direction!=t;if(this.lineWrapping=l,this.direction=t,this.lineHeight=i,this.charWidth=r,this.lineLength=s,a){this.heightSamples={};for(let u=0;u<o.length;u++){let h=o[u];h<0?u++:this.heightSamples[Math.floor(h*10)]=!0}}return a}}class Gk{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class qn{constructor(e,t,i,r,s){this.from=e,this.length=t,this.top=i,this.height=r,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new qn(this.from,this.length+e.length,this.top,this.height+e.height,t)}moveY(e){return e?new qn(this.from,this.length,this.top+e,this.height,Array.isArray(this.type)?this.type.map(t=>t.moveY(e)):this.type):this}}var be=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(be||(be={}));const au=.001;class Dt{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>au&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return Dt.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,r){let s=this;for(let o=r.length-1;o>=0;o--){let{fromA:l,toA:a,fromB:u,toB:h}=r[o],c=s.lineAt(l,be.ByPosNoHeight,t,0,0),f=c.to>=a?c:s.lineAt(a,be.ByPosNoHeight,t,0,0);for(h+=f.to-a,a=f.to;o>0&&c.from<=r[o-1].toA;)l=r[o-1].fromA,u=r[o-1].fromB,o--,l<c.from&&(c=s.lineAt(l,be.ByPosNoHeight,t,0,0));u+=c.from-l,l=c.from;let d=pm.build(i,e,u,h);s=s.replace(l,a,d)}return s.updateHeight(i,0)}static empty(){return new Wt(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,r=0,s=0;for(;;)if(t==i)if(r>s*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,r-=l.size}else if(s>r*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(r<s){let l=e[t++];l&&(r+=l.size)}else{let l=e[--i];l&&(s+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new Hk(Dt.of(e.slice(0,t)),o,Dt.of(e.slice(i)))}}Dt.prototype.size=1;class Iw extends Dt{constructor(e,t,i){super(e,t);this.type=i}blockAt(e,t,i,r){return new qn(r,this.length,i,this.height,this.type)}lineAt(e,t,i,r,s){return this.blockAt(0,i,r,s)}forEachLine(e,t,i,r,s,o){o(this.blockAt(0,i,r,s))}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more&&this.setHeight(e,r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Wt extends Iw{constructor(e,t){super(e,t,we.Text);this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let r=i[0];return i.length==1&&(r instanceof Wt||r instanceof et&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof et?r=new Wt(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):Dt.of(i)}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more?this.setHeight(e,r.heights[r.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class et extends Dt{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,r=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:r,lineHeight:this.height/(r-i+1)}}blockAt(e,t,i,r){let{firstLine:s,lastLine:o,lineHeight:l}=this.lines(t,r),a=Math.max(0,Math.min(o-s,Math.floor((e-i)/l))),{from:u,length:h}=t.line(s+a);return new qn(u,h,i+l*a,l,we.Text)}lineAt(e,t,i,r,s){if(t==be.ByHeight)return this.blockAt(e,i,r,s);if(t==be.ByPosNoHeight){let{from:c,to:f}=i.lineAt(e);return new qn(c,f-c,0,0,we.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,s),{from:a,length:u,number:h}=i.lineAt(e);return new qn(a,u,r+l*(h-o),l,we.Text)}forEachLine(e,t,i,r,s,o){let{firstLine:l,lineHeight:a}=this.lines(i,s);for(let u=Math.max(e,s),h=Math.min(s+this.length,t);u<=h;){let c=i.lineAt(u);u==e&&(r+=a*(c.number-l)),o(new qn(c.from,c.length,r,a,we.Text)),r+=a,u=c.to+1}}replace(e,t,i){let r=this.length-t;if(r>0){let s=i[i.length-1];s instanceof et?i[i.length-1]=new et(s.length+r):i.push(null,new et(r-1))}if(e>0){let s=i[0];s instanceof et?i[0]=new et(e+s.length):i.unshift(new et(e-1),null)}return Dt.of(i)}decomposeLeft(e,t){t.push(new et(e-1),null)}decomposeRight(e,t){t.push(null,new et(this.length-e-1))}updateHeight(e,t=0,i=!1,r){let s=t+this.length;if(r&&r.from<=t+this.length&&r.more){let o=[],l=Math.max(t,r.from),a=-1,u=e.heightChanged;for(r.from>t&&o.push(new et(r.from-t-1).updateHeight(e,t));l<=s&&r.more;){let c=e.doc.lineAt(l).length;o.length&&o.push(null);let f=r.heights[r.index++];a==-1?a=f:Math.abs(f-a)>=au&&(a=-2);let d=new Wt(c,f);d.outdated=!1,o.push(d),l+=c+1}l<=s&&o.push(null,new et(s-l).updateHeight(e,l));let h=Dt.of(o);return e.heightChanged=u||a<0||Math.abs(h.height-this.height)>=au||Math.abs(a-this.lines(e.doc,t).lineHeight)>=au,h}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class Hk extends Dt{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0));this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,r){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,r):this.right.blockAt(e,t,s,r+this.left.length+this.break)}lineAt(e,t,i,r,s){let o=r+this.left.height,l=s+this.left.length+this.break,a=t==be.ByHeight?e<o:e<l,u=a?this.left.lineAt(e,t,i,r,s):this.right.lineAt(e,t,i,o,l);if(this.break||(a?u.to<l:u.from>l))return u;let h=t==be.ByPosNoHeight?be.ByPosNoHeight:be.ByPos;return a?u.join(this.right.lineAt(l,h,i,o,l)):this.left.lineAt(l,h,i,r,s).join(u)}forEachLine(e,t,i,r,s,o){let l=r+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,r,s,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let u=this.lineAt(a,be.ByPos,i,r,s);e<u.from&&this.left.forEachLine(e,u.from-1,i,r,s,o),u.to>=e&&u.from<=t&&o(u),t>u.to&&this.right.forEachLine(u.to+1,t,i,l,a,o)}}replace(e,t,i){let r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,i));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let l of i)s.push(l);if(e>0&&e0(s,o-1),t<this.length){let l=s.length;this.decomposeRight(t,s),e0(s,l)}return Dt.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,r=i+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<r&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Dt.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,r){let{left:s,right:o}=this,l=t+s.length+this.break,a=null;return r&&r.from<=t+s.length&&r.more?a=s=s.updateHeight(e,t,i,r):s.updateHeight(e,t,i),r&&r.from<=l+o.length&&r.more?a=o=o.updateHeight(e,l,i,r):o.updateHeight(e,l,i),a?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function e0(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof et&&(i=n[e+1])instanceof et&&n.splice(e-1,3,new et(t.length+1+i.length))}const zk=5;class pm{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof Wt?r.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Wt(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let r=i.widget?i.widget.estimatedHeight:0;r<0&&(r=this.oracle.lineHeight);let s=t-e;i.block?this.addBlock(new Iw(s,r,i.type)):(s||r>=zk)&&this.addLineDeco(r,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Wt(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new et(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Wt)return e;let t=new Wt(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type==we.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=we.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Wt)&&!this.isCovered?this.nodes.push(new Wt(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let r of this.nodes)r instanceof Wt&&r.updateHeight(this.oracle,i),i+=r?r.length:1;return this.nodes}static build(e,t,i,r){let s=new pm(i,e);return de.spans(t,i,r,s,0),s.finish(i)}}function Uk(n,e,t){let i=new qk;return de.compare(n,e,t,i,0),i.changes}class qk{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,r){(e<t||i&&i.heightRelevant||r&&r.heightRelevant)&&Md(e,t,this.changes,5)}}function Kk(n,e){let t=n.getBoundingClientRect(),i=Math.max(0,t.left),r=Math.min(innerWidth,t.right),s=Math.max(0,t.top),o=Math.min(innerHeight,t.bottom),l=n.ownerDocument.body;for(let a=n.parentNode;a&&a!=l;)if(a.nodeType==1){let u=a,h=window.getComputedStyle(u);if((u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&h.overflow!="visible"){let c=u.getBoundingClientRect();i=Math.max(i,c.left),r=Math.min(r,c.right),s=Math.max(s,c.top),o=Math.min(o,c.bottom)}a=h.position=="absolute"||h.position=="fixed"?u.offsetParent:u.parentNode}else if(a.nodeType==11)a=a.host;else break;return{left:i-t.left,right:Math.max(i,r)-t.left,top:s-(t.top+e),bottom:Math.max(s,o)-(t.top+e)}}class Gc{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e){return Z.replace({widget:new Jk(this.size,e)}).range(this.from,this.to)}}class Jk extends ti{constructor(e,t){super();this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class t0{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new $k,this.scaler=r0,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Dt.empty().applyChanges(e.facet(hr),me.empty,this.heightOracle.setDoc(e.doc),[new Xn(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Z.set(this.lineGaps.map(t=>t.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let r=i?t.head:t.anchor;if(!e.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);e.push(new Sa(s,o))}}this.viewports=e.sort((i,r)=>i.from-r.from),this.scaler=this.heightMap.height<=7e6?r0:new Qk(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:Lo(e,this.scaler))})}update(e,t=null){let i=this.state;this.state=e.state;let r=this.state.facet(hr),s=e.changedRanges,o=Xn.extendWithRanges(s,Uk(e.startState.facet(hr),r,e?e.changes:Ue.empty(this.state.doc.length))),l=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(r,i.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=l&&(e.flags|=2);let a=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let u=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),u&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),r=this.heightOracle,s=i.whiteSpace,o=i.direction=="rtl"?fe.RTL:fe.LTR,l=this.heightOracle.mustRefreshForStyle(s,o),a=l||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight,u=0,h=0;if(this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,u|=8),a){this.mustMeasureContent=!1,this.contentDOMHeight=t.clientHeight;let p=parseInt(i.paddingTop)||0,y=parseInt(i.paddingBottom)||0;(this.paddingTop!=p||this.paddingBottom!=y)&&(u|=8,this.paddingTop=p,this.paddingBottom=y)}let c=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:Kk(t,this.paddingTop),f=c.top-this.pixelViewport.top,d=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(a=!0)),!this.inView)return 0;let w=t.clientWidth;if((this.contentDOMWidth!=w||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=w,this.editorHeight=e.scrollDOM.clientHeight,u|=8),a){let p=e.docView.measureVisibleLineHeights();if(r.mustRefreshForHeights(p)&&(l=!0),l||r.lineWrapping&&Math.abs(w-this.contentDOMWidth)>r.charWidth){let{lineHeight:y,charWidth:C}=e.docView.measureTextSize();l=r.refresh(s,o,y,C,w/C,p),l&&(e.docView.minWidth=0,u|=8)}f>0&&d>0?h=Math.max(f,d):f<0&&d<0&&(h=Math.min(f,d)),r.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(r,0,l,new Gk(this.viewport.from,p)),r.heightChanged&&(u|=2)}let v=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return v&&(this.viewport=this.getViewport(h,this.scrollTarget)),this.updateForViewport(),(u&2||v)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps)),u|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),u}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.state.doc,{visibleTop:o,visibleBottom:l}=this,a=new Sa(r.lineAt(o-i*1e3,be.ByHeight,s,0,0).from,r.lineAt(l+(1-i)*1e3,be.ByHeight,s,0,0).to);if(t){let{head:u}=t.range;if(u<a.from||u>a.to){let h=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),c=r.lineAt(u,be.ByPos,s,0,0),f;t.y=="center"?f=(c.top+c.bottom)/2-h/2:t.y=="start"||t.y=="nearest"&&u<a.from?f=c.top:f=c.bottom-h,a=new Sa(r.lineAt(f-1e3/2,be.ByHeight,s,0,0).from,r.lineAt(f+h+1e3/2,be.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new Sa(this.heightMap.lineAt(i,be.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(r,be.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,be.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(t,be.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||r<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&r>o-2*1e3&&s<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let r of e)t.touchesRange(r.from,r.to)||i.push(new Gc(t.mapPos(r.from),t.mapPos(r.to),r.size));return i}ensureLineGaps(e){let t=[];if(this.heightOracle.direction!=fe.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let r=Yk(i.from,i.to,this.state);if(r.total<4e3)continue;let s,o;if(this.heightOracle.lineWrapping){let u=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=wa(r,(this.visibleTop-i.top-u)/i.height),o=wa(r,(this.visibleBottom-i.top+u)/i.height)}else{let u=r.total*this.heightOracle.charWidth,h=2e3*this.heightOracle.charWidth;s=wa(r,(this.pixelViewport.left-h)/u),o=wa(r,(this.pixelViewport.right+h)/u)}let l=[];s>i.from&&l.push({from:i.from,to:s}),o<i.to&&l.push({from:o,to:i.to});let a=this.state.selection.main;a.from>=i.from&&a.from<=i.to&&i0(l,a.from-10,a.from+10),!a.empty&&a.to>=i.from&&a.to<=i.to&&i0(l,a.to-10,a.to+10);for(let{from:u,to:h}of l)h-u>1e3&&t.push(Xk(e,c=>c.from>=i.from&&c.to<=i.to&&Math.abs(c.from-u)<1e3&&Math.abs(c.to-h)<1e3)||new Gc(u,h,this.gapSize(i,u,h,r)))}return t}gapSize(e,t,i,r){let s=n0(r,i)-n0(r,t);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){Gc.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Z.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.state.facet(hr);this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];de.spans(e,this.viewport.from,this.viewport.to,{span(r,s){t.push({from:r,to:s})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((r,s)=>r.from!=t[s].from||r.to!=t[s].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Lo(this.heightMap.lineAt(e,be.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return Lo(this.heightMap.lineAt(this.scaler.fromDOM(e),be.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return Lo(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Sa{constructor(e,t){this.from=e,this.to=t}}function Yk(n,e,t){let i=[],r=n,s=0;return de.spans(t.facet(hr),n,e,{span(){},point(o,l){o>r&&(i.push({from:r,to:o}),s+=o-r),r=l}},20),r<e&&(i.push({from:r,to:e}),s+=e-r),{total:s,ranges:i}}function wa({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let r=0;;r++){let{from:s,to:o}=e[r],l=o-s;if(i<=l)return s+i;i-=l}}function n0(n,e){let t=0;for(let{from:i,to:r}of n.ranges){if(e<=r){t+=e-i;break}t+=r-i}return t/n.total}function i0(n,e,t){for(let i=0;i<n.length;i++){let r=n[i];if(r.from<t&&r.to>e){let s=[];r.from<e&&s.push({from:r.from,to:e}),r.to>t&&s.push({from:t,to:r.to}),n.splice(i,1,...s),i+=s.length-1}}}function Xk(n,e){for(let t of n)if(e(t))return t}const r0={toDOM(n){return n},fromDOM(n){return n},scale:1};class Qk{constructor(e,t,i){let r=0,s=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let u=t.lineAt(l,be.ByPos,e,0,0).top,h=t.lineAt(a,be.ByPos,e,0,0).bottom;return r+=h-u,{from:l,to:a,top:u,bottom:h,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(t.height-r);for(let l of this.viewports)l.domTop=o+(l.top-s)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return r+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,r=s.domBottom}}fromDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,r=s.domBottom}}}function Lo(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new qn(n.from,n.length,t,i-t,Array.isArray(n.type)?n.type.map(r=>Lo(r,e)):n.type)}const xa=Y.define({combine:n=>n.join(" ")}),Gd=Y.define({combine:n=>n.indexOf(!0)>-1}),Hd=$i.newName(),Dw=$i.newName(),Rw=$i.newName(),Lw={"&light":"."+Dw,"&dark":"."+Rw};function zd(n,e,t){return new $i(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,r=>{if(r=="&")return n;if(!t||!t[r])throw new RangeError(`Unsupported selector: ${r}`);return t[r]}):n+" "+i}})}const Zk=zd("."+Hd,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-bottom",height:"1em"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Lw),eO={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Hc=Q.ie&&Q.ie_version<=11;class tO{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new nk,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(r=>{for(let s of r)this.queue.push(s);(Q.ie&&Q.ie_version<=11||Q.ios&&e.composing)&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),Hc&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}),this.resize.observe(e.scrollDOM)),this.start(),this.onScroll=this.onScroll.bind(this),window.addEventListener("scroll",this.onScroll),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(r=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),r.length>0&&r[r.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(r=>{r.length>0&&r[r.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(Ml)?t.root.activeElement!=this.dom:!Td(t.dom,i))return;let r=i.anchorNode&&t.docView.nearest(i.anchorNode);r&&r.ignoreEvent(e)||((Q.ie&&Q.ie_version<=11||Q.android&&Q.chrome)&&!t.state.selection.main.empty&&i.focusNode&&$u(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=ju(e),i=Q.safari&&e.nodeType==11&&ZE()==this.view.contentDOM&&nO(this.view)||t;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,eO),Hc&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),Hc&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null;let r=this.view.state;Qo(this.view.contentDOM,i.key,i.keyCode)?this.processRecords():this.flush(),this.view.state==r&&this.view.update([])}),(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let s of this.observer.takeRecords())e.push(s);e.length&&(this.queue=[]);let t=-1,i=-1,r=!1;for(let s of e){let o=this.readMutation(s);!o||(o.typeOver&&(r=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:r}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:r}=this.processRecords(),s=this.selectionChanged&&Td(this.dom,this.selectionRange);if(t<0&&!s)return;this.selectionChanged=!1;let o=this.view.state;this.onChange(t,i,r),this.view.state==o&&this.view.update([])}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let i=s0(t,e.previousSibling||e.target.previousSibling,-1),r=s0(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function s0(n,e,t){for(;e;){let i=De.get(e);if(i&&i.parent==n)return i;let r=e.parentNode;e=r!=n.dom?r:t>0?e.nextSibling:e.previousSibling}return null}function nO(n){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",t,!0),document.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let i=e.startContainer,r=e.startOffset,s=e.endContainer,o=e.endOffset,l=n.docView.domAtPos(n.state.selection.main.anchor);return $u(l.node,l.offset,s,o)&&([i,r,s,o]=[s,o,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:o}}function iO(n,e,t,i){let r,s,o=n.state.selection.main;if(e>-1){let l=n.docView.domBoundsAround(e,t,0);if(!l||n.state.readOnly)return;let{from:a,to:u}=l,h=n.docView.impreciseHead||n.docView.impreciseAnchor?[]:sO(n),c=new ww(h,n.state);c.readRange(l.startDOM,l.endDOM);let f=o.from,d=null;(n.inputState.lastKeyCode===8&&n.inputState.lastKeyTime>Date.now()-100||Q.android&&c.text.length<u-a)&&(f=o.to,d="end");let m=rO(n.state.doc.sliceString(a,u,Oi),c.text,f-a,d);m&&(Q.chrome&&n.inputState.lastKeyCode==13&&m.toB==m.from+2&&c.text.slice(m.from,m.toB)==Oi+Oi&&m.toB--,r={from:a+m.from,to:a+m.toA,insert:me.of(c.text.slice(m.from,m.toB).split(Oi))}),s=oO(h,a)}else if(n.hasFocus||!n.state.facet(Ml)){let l=n.observer.selectionRange,{impreciseHead:a,impreciseAnchor:u}=n.docView,h=a&&a.node==l.focusNode&&a.offset==l.focusOffset||!Pd(n.contentDOM,l.focusNode)?n.state.selection.main.head:n.docView.posFromDOM(l.focusNode,l.focusOffset),c=u&&u.node==l.anchorNode&&u.offset==l.anchorOffset||!Pd(n.contentDOM,l.anchorNode)?n.state.selection.main.anchor:n.docView.posFromDOM(l.anchorNode,l.anchorOffset);(h!=o.head||c!=o.anchor)&&(s=F.single(c,h))}if(!(!r&&!s)){if(!r&&i&&!o.empty&&s&&s.main.empty?r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,o.to)}:r&&r.from>=o.from&&r.to<=o.to&&(r.from!=o.from||r.to!=o.to)&&o.to-o.from-(r.to-r.from)<=4&&(r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,r.from).append(r.insert).append(n.state.doc.slice(r.to,o.to))}),r){let l=n.state;if(Q.ios&&n.inputState.flushIOSKey(n)||Q.android&&(r.from==o.from&&r.to==o.to&&r.insert.length==1&&r.insert.lines==2&&Qo(n.contentDOM,"Enter",13)||r.from==o.from-1&&r.to==o.to&&r.insert.length==0&&Qo(n.contentDOM,"Backspace",8)||r.from==o.from&&r.to==o.to+1&&r.insert.length==0&&Qo(n.contentDOM,"Delete",46)))return;let a=r.insert.toString();if(n.state.facet(dw).some(c=>c(n,r.from,r.to,a)))return;n.inputState.composing>=0&&n.inputState.composing++;let u;if(r.from>=o.from&&r.to<=o.to&&r.to-r.from>=(o.to-o.from)/3&&(!s||s.main.empty&&s.main.from==r.from+r.insert.length)&&n.inputState.composing<0){let c=o.from<r.from?l.sliceDoc(o.from,r.from):"",f=o.to>r.to?l.sliceDoc(r.to,o.to):"";u=l.replaceSelection(n.state.toText(c+r.insert.sliceString(0,void 0,n.state.lineBreak)+f))}else{let c=l.changes(r),f=s&&!l.selection.main.eq(s.main)&&s.main.to<=c.newLength?s.main:void 0;if(l.selection.ranges.length>1&&n.inputState.composing>=0&&r.to<=o.to&&r.to>=o.to-10){let d=n.state.sliceDoc(r.from,r.to),m=xw(n)||n.state.doc.lineAt(o.head),w=o.to-r.to,v=o.to-o.from;u=l.changeByRange(p=>{if(p.from==o.from&&p.to==o.to)return{changes:c,range:f||p.map(c)};let y=p.to-w,C=y-d.length;if(p.to-p.from!=v||n.state.sliceDoc(C,y)!=d||m&&p.to>=m.from&&p.from<=m.to)return{range:p};let b=l.changes({from:C,to:y,insert:r.insert}),_=p.to-o.to;return{changes:b,range:f?F.range(Math.max(0,f.anchor+_),Math.max(0,f.head+_)):p.map(b)}})}else u={changes:c,selection:f&&l.selection.replaceRange(f)}}let h="input.type";n.composing&&(h+=".compose",n.inputState.compositionFirstChange&&(h+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(u,{scrollIntoView:!0,userEvent:h})}else if(s&&!s.main.eq(o)){let l=!1,a="select";n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(l=!0),a=n.inputState.lastSelectionOrigin),n.dispatch({selection:s,scrollIntoView:l,userEvent:a})}}}function rO(n,e,t,i){let r=Math.min(n.length,e.length),s=0;for(;s<r&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==r&&n.length==e.length)return null;let o=n.length,l=e.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,s-Math.min(o,l));t-=o+a-s}return o<s&&n.length<e.length?(s-=t<=s&&t>=o?s-t:0,l=s+(l-o),o=s):l<s&&(s-=t<=s&&t>=l?s-t:0,o=s+(o-l),l=s),{from:s,toA:o,toB:l}}function sO(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:r,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new Fv(t,i)),(r!=t||s!=i)&&e.push(new Fv(r,s))),e}function oO(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?F.single(t+e,i+e):null}class J{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=e.root||ik(e.parent)||document,this.viewState=new t0(e.state||ce.create()),this.plugins=this.state.facet(Do).map(t=>new Bc(t));for(let t of this.plugins)t.update(this);this.observer=new tO(this,(t,i,r)=>{iO(this,t,i,r)},t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()}),this.inputState=new Nk(this),this.docView=new Vv(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,aO(),this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof qe?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i,r=this.state;for(let o of e){if(o.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=o.state}if(this.destroyed){this.viewState.state=r;return}if(r.facet(ce.phrases)!=this.state.facet(ce.phrases))return this.setState(r);i=new Lv(this,r,e);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let o of e){if(s&&(s=s.map(o.changes)),o.scrollIntoView){let{main:l}=o.state.selection;s=new ls(l.empty?l:F.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of o.effects)l.is(Vd)?s=new ls(l.value):l.is(pw)?s=new ls(l.value,"center"):l.is(Rv)&&(s=l.value)}this.viewState.update(i,s),this.bidiCache=Hu.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet(Ro)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(o=>o.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(xa)!=i.state.facet(xa)&&(this.viewState.mustMeasureContent=!0),(t||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let o of this.state.facet(Fd))o(i)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new t0(e),this.plugins=e.facet(Do).map(i=>new Bc(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new Vv(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Do),i=e.state.facet(Do);if(t!=i){let r=[];for(let s of i){let o=t.indexOf(s);if(o<0)r.push(new Bc(s));else{let l=this.plugins[o];l.mustUpdate=e,r.push(l)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=r,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let r of this.plugins)r.mustUpdate=e;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let i=0;;i++){this.updateState=1;let r=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];s&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(c=>{try{return c.read(this)}catch(f){return Ht(this.state,f),o0}}),a=new Lv(this,this.state),u=!1,h=!1;a.flags|=s,t?t.flags|=s:t=a,this.updateState=2,a.empty||(this.updatePlugins(a),this.inputState.update(a),this.updateAttrs(),u=this.docView.update(a));for(let c=0;c<o.length;c++)if(l[c]!=o0)try{let f=o[c];f.write&&f.write(l[c],this)}catch(f){Ht(this.state,f)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=!0),u&&this.docView.updateSelection(!0),this.viewport.from==r.from&&this.viewport.to==r.to&&!h&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let i of this.state.facet(Fd))i(t)}get themeClasses(){return Hd+" "+(this.state.facet(Gd)?Rw:Dw)+" "+this.state.facet(xa)}updateAttrs(){let e=l0(this,gw,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ml)?"true":"false",class:"cm-content",style:`${Q.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),l0(this,vw,t),this.observer.ignore(()=>{Ld(this.contentDOM,this.contentAttrs,t),Ld(this.dom,this.editorAttrs,e)}),this.editorAttrs=e,this.contentAttrs=t}showAnnouncements(e){let t=!0;for(let i of e)for(let r of i.effects)if(r.is(J.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(Ro),$i.mount(this.root,this.styleModules.concat(Zk).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}pluginField(e){let t=[];for(let i of this.plugins)i.update(this).takeField(e,t);return t}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(e,t){let i=zc(t,this);return this.elementAtHeight(e-i).moveY(i)}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}visualLineAtHeight(e,t){let i=zc(t,this);return this.lineBlockAtHeight(e-i).moveY(i)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}viewportLines(e,t){let i=zc(t,this);for(let r of this.viewportLineBlocks)e(r.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(e,t=0){return this.lineBlockAt(e).moveY(t+this.viewState.paddingTop)}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return $c(this,e,Hv(this,e,t,i))}moveByGroup(e,t){return $c(this,e,Hv(this,e,t,i=>Tk(this,e.head,i)))}moveToLineBoundary(e,t,i=!0){return Pk(this,e,t,i)}moveVertically(e,t,i){return $c(this,e,Ak(this,e,t,i))}scrollPosIntoView(e){this.dispatch({effects:Vd.of(F.cursor(e))})}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),Ew(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r),o=s[ws.find(s,e-r.from,-1,t)];return wh(i,o.dir==fe.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>lO)return Cw(e.length);let t=this.textDirection;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t)return r.order;let i=mk(e.text,this.textDirection);return this.bidiCache.push(new Hu(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||Q.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{XS(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Rv.of(new ls(typeof e=="number"?F.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Ve.define(()=>({}),{eventHandlers:e})}static theme(e,t){let i=$i.newName(),r=[xa.of(i),Ro.of(zd(`.${i}`,e))];return t&&t.dark&&r.push(Gd.of(!0)),r}static baseTheme(e){return Rl.lowest(Ro.of(zd("."+Hd,e,Lw)))}}J.scrollTo=Vd;J.centerOn=pw;J.styleModule=Ro;J.inputHandler=dw;J.exceptionSink=fw;J.updateListener=Fd;J.editable=Ml;J.mouseSelectionStyle=cw;J.dragMovesSelection=hw;J.clickAddsSelectionRange=uw;J.decorations=hr;J.darkTheme=Gd;J.contentAttributes=vw;J.editorAttributes=gw;J.lineWrapping=J.contentAttributes.of({class:"cm-lineWrapping"});J.announce=ie.define();const lO=4096;function zc(n,e){return(n==null?e.contentDOM.getBoundingClientRect().top:n)+e.viewState.paddingTop}let Ud=-1;function aO(){window.addEventListener("resize",()=>{Ud==-1&&(Ud=setTimeout(uO,50))})}function uO(){Ud=-1;let n=document.querySelectorAll(".cm-content");for(let e=0;e<n.length;e++){let t=De.get(n[e]);t&&t.editorView.requestMeasure()}}const o0={};class Hu{constructor(e,t,i,r){this.from=e,this.to=t,this.dir=i,this.order=r}static update(e,t){if(t.empty)return e;let i=[],r=e.length?e[e.length-1].dir:fe.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==r&&!t.touchesRange(o.from,o.to)&&i.push(new Hu(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.order))}return i}}function l0(n,e,t){for(let i=n.state.facet(e),r=i.length-1;r>=0;r--){let s=i[r],o=typeof s=="function"?s(n):s;o&&Rd(o,t)}return t}const hO=Q.mac?"mac":Q.windows?"win":Q.linux?"linux":"key";function cO(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let r,s,o,l;for(let a=0;a<t.length-1;++a){const u=t[a];if(/^(cmd|meta|m)$/i.test(u))l=!0;else if(/^a(lt)?$/i.test(u))r=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))e=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+u)}return r&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Uc(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const fO=J.domEventHandlers({keydown(n,e){return Fw(Mw(e.state),n,e,"editor")}}),Eh=Y.define({enables:fO}),a0=new WeakMap;function Mw(n){let e=n.facet(Eh),t=a0.get(e);return t||a0.set(e,t=mO(e.reduce((i,r)=>i.concat(r),[]))),t}function dO(n,e,t){return Fw(Mw(n.state),e,n,t)}let wi=null;const pO=4e3;function mO(n,e=hO){let t=Object.create(null),i=Object.create(null),r=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,l,a,u)=>{let h=t[o]||(t[o]=Object.create(null)),c=l.split(/ (?!$)/).map(m=>cO(m,e));for(let m=1;m<c.length;m++){let w=c.slice(0,m).join(" ");r(w,!0),h[w]||(h[w]={preventDefault:!0,commands:[v=>{let p=wi={view:v,prefix:w,scope:o};return setTimeout(()=>{wi==p&&(wi=null)},pO),!0}]})}let f=c.join(" ");r(f,!1);let d=h[f]||(h[f]={preventDefault:!1,commands:[]});d.commands.push(a),u&&(d.preventDefault=!0)};for(let o of n){let l=o[e]||o.key;if(!!l)for(let a of o.scope?o.scope.split(" "):["editor"])s(a,l,o.run,o.preventDefault),o.shift&&s(a,"Shift-"+l,o.shift,o.preventDefault)}return t}function Fw(n,e,t,i){let r=QE(e),s=r.length==1&&r!=" ",o="",l=!1;wi&&wi.view==t&&wi.scope==i&&(o=wi.prefix+" ",(l=Ow.indexOf(e.keyCode)<0)&&(wi=null));let a=c=>{if(c){for(let f of c.commands)if(f(t))return!0;c.preventDefault&&(l=!0)}return!1},u=n[i],h;if(u){if(a(u[o+Uc(r,e,!s)]))return!0;if(s&&(e.shiftKey||e.altKey||e.metaKey)&&(h=Hi[e.keyCode])&&h!=r){if(a(u[o+Uc(h,e,!0)]))return!0}else if(s&&e.shiftKey&&a(u[o+Uc(r,e,!0)]))return!0}return l}const Vw=!Q.ios,Mo=Y.define({combine(n){return Ji(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function gO(n={}){return[Mo.of(n),vO,yO]}class Ww{constructor(e,t,i,r,s){this.left=e,this.top=t,this.width=i,this.height=r,this.className=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}}const vO=Ve.fromClass(class{constructor(n){this.view=n,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=n.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=n.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),n.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(Mo).cursorBlinkRate+"ms"}update(n){let e=n.startState.facet(Mo)!=n.state.facet(Mo);(e||n.selectionSet||n.geometryChanged||n.viewportChanged)&&this.view.requestMeasure(this.measureReq),n.transactions.some(t=>t.scrollIntoView)&&(this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),e&&this.setBlinkRate()}readPos(){let{state:n}=this.view,e=n.facet(Mo),t=n.selection.ranges.map(r=>r.empty?[]:CO(this.view,r)).reduce((r,s)=>r.concat(s)),i=[];for(let r of n.selection.ranges){let s=r==n.selection.main;if(r.empty?!s||Vw:e.drawRangeCursor){let o=SO(this.view,r,s);o&&i.push(o)}}return{rangePieces:t,cursors:i}}drawSel({rangePieces:n,cursors:e}){if(n.length!=this.rangePieces.length||n.some((t,i)=>!t.eq(this.rangePieces[i]))){this.selectionLayer.textContent="";for(let t of n)this.selectionLayer.appendChild(t.draw());this.rangePieces=n}if(e.length!=this.cursors.length||e.some((t,i)=>!t.eq(this.cursors[i]))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(const i of e)this.cursorLayer.appendChild(i.draw())}else e.forEach((i,r)=>i.adjust(t[r]));this.cursors=e}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),Bw={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Vw&&(Bw[".cm-line"].caretColor="transparent !important");const yO=Rl.highest(J.theme(Bw));function jw(n){let e=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==fe.LTR?e.left:e.right-n.scrollDOM.clientWidth)-n.scrollDOM.scrollLeft,top:e.top-n.scrollDOM.scrollTop}}function u0(n,e,t){let i=F.cursor(e);return{from:Math.max(t.from,n.moveToLineBoundary(i,!1,!0).from),to:Math.min(t.to,n.moveToLineBoundary(i,!0,!0).from),type:we.Text}}function h0(n,e){let t=n.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==we.Text))return i}return t}function CO(n,e){if(e.to<=n.viewport.from||e.from>=n.viewport.to)return[];let t=Math.max(e.from,n.viewport.from),i=Math.min(e.to,n.viewport.to),r=n.textDirection==fe.LTR,s=n.contentDOM,o=s.getBoundingClientRect(),l=jw(n),a=window.getComputedStyle(s.firstChild),u=o.left+parseInt(a.paddingLeft)+Math.min(0,parseInt(a.textIndent)),h=o.right-parseInt(a.paddingRight),c=h0(n,t),f=h0(n,i),d=c.type==we.Text?c:null,m=f.type==we.Text?f:null;if(n.lineWrapping&&(d&&(d=u0(n,t,d)),m&&(m=u0(n,i,m))),d&&m&&d.from==m.from)return v(p(e.from,e.to,d));{let C=d?p(e.from,null,d):y(c,!1),b=m?p(null,e.to,m):y(f,!0),_=[];return(d||c).to<(m||f).from-1?_.push(w(u,C.bottom,h,b.top)):C.bottom<b.top&&n.elementAtHeight((C.bottom+b.top)/2).type==we.Text&&(C.bottom=b.top=(C.bottom+b.top)/2),v(C).concat(_).concat(v(b))}function w(C,b,_,O){return new Ww(C-l.left,b-l.top-.01,_-C,O-b+.01,"cm-selectionBackground")}function v({top:C,bottom:b,horizontal:_}){let O=[];for(let R=0;R<_.length;R+=2)O.push(w(_[R],C,_[R+1],b));return O}function p(C,b,_){let O=1e9,R=-1e9,L=[];function A(X,H,Ce,S,E){let P=n.coordsAtPos(X,X==_.to?-2:2),T=n.coordsAtPos(Ce,Ce==_.from?2:-2);O=Math.min(P.top,T.top,O),R=Math.max(P.bottom,T.bottom,R),E==fe.LTR?L.push(r&&H?u:P.left,r&&S?h:T.right):L.push(!r&&S?u:T.left,!r&&H?h:P.right)}let $=C!=null?C:_.from,U=b!=null?b:_.to;for(let X of n.visibleRanges)if(X.to>$&&X.from<U)for(let H=Math.max(X.from,$),Ce=Math.min(X.to,U);;){let S=n.state.doc.lineAt(H);for(let E of n.bidiSpans(S)){let P=E.from+S.from,T=E.to+S.from;if(P>=Ce)break;T>H&&A(Math.max(P,H),C==null&&P<=$,Math.min(T,Ce),b==null&&T>=U,E.dir)}if(H=S.to+1,H>=Ce)break}return L.length==0&&A($,C==null,U,b==null,n.textDirection),{top:O,bottom:R,horizontal:L}}function y(C,b){let _=o.top+(b?C.top:C.bottom);return{top:_,bottom:_,horizontal:[]}}}function SO(n,e,t){let i=n.coordsAtPos(e.head,e.assoc||1);if(!i)return null;let r=jw(n);return new Ww(i.left-r.left,i.top-r.top,-1,i.bottom-i.top,t?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const $w=ie.define({map(n,e){return n==null?null:e.mapPos(n)}}),Fo=Ye.define({create(){return null},update(n,e){return n!=null&&(n=e.changes.mapPos(n)),e.effects.reduce((t,i)=>i.is($w)?i.value:t,n)}}),wO=Ve.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var e;let t=n.state.field(Fo);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(Fo)!=t||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let n=this.view.state.field(Fo),e=n!=null&&this.view.coordsAtPos(n);if(!e)return null;let t=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-t.left+this.view.scrollDOM.scrollLeft,top:e.top-t.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(n){this.cursor&&(n?(this.cursor.style.left=n.left+"px",this.cursor.style.top=n.top+"px",this.cursor.style.height=n.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(Fo)!=n&&this.view.dispatch({effects:$w.of(n)})}},{eventHandlers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function xO(){return[Fo,wO]}function c0(n,e,t,i,r){e.lastIndex=0;for(let s=n.iterRange(t,i),o=t,l;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;l=e.exec(s.value);)r(o+l.index,o+l.index+l[0].length,l)}function bO(n,e){let t=n.visibleRanges;if(t.length==1&&t[0].from==n.viewport.from&&t[0].to==n.viewport.to)return t;let i=[];for(let{from:r,to:s}of t)r=Math.max(n.state.doc.lineAt(r).from,r-e),s=Math.min(n.state.doc.lineAt(s).to,s+e),i.length&&i[i.length-1].to>=r?i[i.length-1].to=s:i.push({from:r,to:s});return i}class EO{constructor(e){let{regexp:t,decoration:i,boundary:r,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco=typeof i=="function"?i:()=>i,this.boundary=r,this.maxLength=s}createDeco(e){let t=new Gi;for(let{from:i,to:r}of bO(e,this.maxLength))c0(e.state.doc,this.regexp,i,r,(s,o,l)=>t.add(s,o,this.getDeco(l,e,s)));return t.finish()}updateDeco(e,t){let i=1e9,r=-1;return e.docChanged&&e.changes.iterChanges((s,o,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(i=Math.min(l,i),r=Math.max(a,r))}),e.viewportChanged||r-i>1e3?this.createDeco(e.view):r>-1?this.updateRange(e.view,t.map(e.changes),i,r):t}updateRange(e,t,i,r){for(let s of e.visibleRanges){let o=Math.max(s.from,i),l=Math.min(s.to,r);if(l>o){let a=e.state.doc.lineAt(o),u=a.to<l?e.state.doc.lineAt(l):a,h=Math.max(s.from,a.from),c=Math.min(s.to,u.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){h=o;break}for(;l<u.to;l++)if(this.boundary.test(u.text[l-u.from])){c=l;break}}let f=[],d;if(a==u)for(this.regexp.lastIndex=h-a.from;(d=this.regexp.exec(a.text))&&d.index<c-a.from;){let m=d.index+a.from;f.push(this.getDeco(d,e,m).range(m,m+d[0].length))}else c0(e.state.doc,this.regexp,h,c,(m,w,v)=>f.push(this.getDeco(v,e,m).range(m,w)));t=t.update({filterFrom:h,filterTo:c,filter:(m,w)=>m<h||w>c,add:f})}}return t}}const qd=/x/.unicode!=null?"gu":"g",kO=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,qd),OO={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let qc=null;function _O(){var n;if(qc==null&&typeof document!="undefined"&&document.body){let e=document.body.style;qc=((n=e.tabSize)!==null&&n!==void 0?n:e.MozTabSize)!=null}return qc||!1}const uu=Y.define({combine(n){let e=Ji(n,{render:null,specialChars:kO,addSpecialChars:null});return(e.replaceTabs=!_O())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,qd)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,qd)),e}});function PO(n={}){return[uu.of(n),TO()]}let f0=null;function TO(){return f0||(f0=Ve.fromClass(class{constructor(n){this.view=n,this.decorations=Z.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(uu)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new EO({regexp:n.specialChars,decoration:(e,t,i)=>{let{doc:r}=t.state,s=at(e[0],0);if(s==9){let o=r.lineAt(i),l=t.state.tabSize,a=Dl(o.text,l,i-o.from);return Z.replace({widget:new DO((l-a%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[s]||(this.decorationCache[s]=Z.replace({widget:new IO(n,s)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let e=n.state.facet(uu);n.startState.facet(uu)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const AO="\u2022";function NO(n){return n>=32?AO:n==10?"\u2424":String.fromCharCode(9216+n)}class IO extends ti{constructor(e,t){super();this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=NO(this.code),i=e.state.phrase("Control character")+" "+(OO[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,i,t);if(r)return r;let s=document.createElement("span");return s.textContent=t,s.title=i,s.setAttribute("aria-label",i),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class DO extends ti{constructor(e){super();this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function RO(){return MO}const LO=Z.line({class:"cm-activeLine"}),MO=Ve.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=-1,t=[];for(let i of n.state.selection.ranges){if(!i.empty)return Z.none;let r=n.lineBlockAt(i.head);r.from>e&&(t.push(LO.range(r.from)),e=r.from)}return Z.set(t)}},{decorations:n=>n.decorations});class FO extends ti{constructor(e){super();this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}ignoreEvent(){return!1}}function VO(n){return Ve.fromClass(class{constructor(e){this.view=e,this.placeholder=Z.set([Z.widget({widget:new FO(n),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?Z.none:this.placeholder}},{decorations:e=>e.decorations})}const Kd=Ki.define(),WO=Ki.define(),BO=Y.define(),Gw=Y.define({combine(n){return Ji(n,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function jO(n){let e=0;return n.iterChangedRanges((t,i)=>e=i),e}const Hw=Ye.define({create(){return Tn.empty},update(n,e){let t=e.state.facet(Gw),i=e.annotation(Kd);if(i){let a=e.docChanged?F.single(jO(e.changes)):void 0,u=Tt.fromTransaction(e,a),h=i.side,c=h==0?n.undone:n.done;return u?c=zu(c,c.length,t.minDepth,u):c=Kw(c,e.startState.selection),new Tn(h==0?i.rest:c,h==0?c:i.rest)}let r=e.annotation(WO);if((r=="full"||r=="before")&&(n=n.isolate()),e.annotation(qe.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let s=Tt.fromTransaction(e),o=e.annotation(qe.time),l=e.annotation(qe.userEvent);return s?n=n.addChanges(s,o,l,t.newGroupDelay,t.minDepth):e.selection&&(n=n.addSelection(e.startState.selection,o,l,t.newGroupDelay)),(r=="full"||r=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new Tn(n.done.map(Tt.fromJSON),n.undone.map(Tt.fromJSON))}});function $O(n={}){return[Hw,Gw.of(n),J.domEventHandlers({beforeinput(e,t){let i=e.inputType=="historyUndo"?zw:e.inputType=="historyRedo"?Uw:null;return i?(e.preventDefault(),i(t)):!1}})]}function kh(n,e){return function({state:t,dispatch:i}){if(!e&&t.readOnly)return!1;let r=t.field(Hw,!1);if(!r)return!1;let s=r.pop(n,t,e);return s?(i(s),!0):!1}}const zw=kh(0,!1),Uw=kh(1,!1),GO=kh(0,!0),HO=kh(1,!0);class Tt{constructor(e,t,i,r,s){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=r,this.selectionsAfter=s}setSelAfter(e){return new Tt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(e){return new Tt(e.changes&&Ue.fromJSON(e.changes),[],e.mapped&&Yn.fromJSON(e.mapped),e.startSelection&&F.fromJSON(e.startSelection),e.selectionsAfter.map(F.fromJSON))}static fromTransaction(e,t){let i=Zt;for(let r of e.startState.facet(BO)){let s=r(e);s.length&&(i=i.concat(s))}return!i.length&&e.changes.empty?null:new Tt(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,Zt)}static selection(e){return new Tt(void 0,Zt,void 0,void 0,e)}}function zu(n,e,t,i){let r=e+1>t+20?e-t-1:0,s=n.slice(r,e);return s.push(i),s}function zO(n,e){let t=[],i=!1;return n.iterChangedRanges((r,s)=>t.push(r,s)),e.iterChangedRanges((r,s,o,l)=>{for(let a=0;a<t.length;){let u=t[a++],h=t[a++];l>=u&&o<=h&&(i=!0)}}),i}function UO(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,i)=>t.empty!=e.ranges[i].empty).length===0}function qw(n,e){return n.length?e.length?n.concat(e):n:e}const Zt=[],qO=200;function Kw(n,e){if(n.length){let t=n[n.length-1],i=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-qO));return i.length&&i[i.length-1].eq(e)?n:(i.push(e),zu(n,n.length-1,1e9,t.setSelAfter(i)))}else return[Tt.selection([e])]}function KO(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Kc(n,e){if(!n.length)return n;let t=n.length,i=Zt;for(;t;){let r=JO(n[t-1],e,i);if(r.changes&&!r.changes.empty||r.effects.length){let s=n.slice(0,t);return s[t-1]=r,s}else e=r.mapped,t--,i=r.selectionsAfter}return i.length?[Tt.selection(i)]:Zt}function JO(n,e,t){let i=qw(n.selectionsAfter.length?n.selectionsAfter.map(l=>l.map(e)):Zt,t);if(!n.changes)return Tt.selection(i);let r=n.changes.map(e),s=e.mapDesc(n.changes,!0),o=n.mapped?n.mapped.composeDesc(s):s;return new Tt(r,ie.mapEffects(n.effects,e),o,n.startSelection.map(s),i)}const YO=/^(input\.type|delete)($|\.)/;class Tn{constructor(e,t,i=0,r=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=r}isolate(){return this.prevTime?new Tn(this.done,this.undone):this}addChanges(e,t,i,r,s){let o=this.done,l=o[o.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!i||YO.test(i))&&(!l.selectionsAfter.length&&t-this.prevTime<r&&zO(l.changes,e.changes)||i=="input.type.compose")?o=zu(o,o.length-1,s,new Tt(e.changes.compose(l.changes),qw(e.effects,l.effects),l.mapped,l.startSelection,Zt)):o=zu(o,o.length,s,e),new Tn(o,Zt,t,i)}addSelection(e,t,i,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Zt;return s.length>0&&t-this.prevTime<r&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&UO(s[s.length-1],e)?this:new Tn(Kw(this.done,e),this.undone,t,i)}addMapping(e){return new Tn(Kc(this.done,e),Kc(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let r=e==0?this.done:this.undone;if(r.length==0)return null;let s=r[r.length-1];if(i&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Kd.of({side:e,rest:KO(r)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let o=r.length==1?Zt:r.slice(0,r.length-1);return s.mapped&&(o=Kc(o,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Kd.of({side:e,rest:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}Tn.empty=new Tn(Zt,Zt);const XO=[{key:"Mod-z",run:zw,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Uw,preventDefault:!0},{key:"Mod-u",run:GO,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:HO,preventDefault:!0}],QO=1024;let ZO=0;class Jc{constructor(e,t){this.from=e,this.to=t}}class ue{constructor(e={}){this.id=ZO++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=pn.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}ue.closedBy=new ue({deserialize:n=>n.split(" ")});ue.openedBy=new ue({deserialize:n=>n.split(" ")});ue.group=new ue({deserialize:n=>n.split(" ")});ue.contextHash=new ue({perNode:!0});ue.lookAhead=new ue({perNode:!0});ue.mounted=new ue({perNode:!0});const e_=Object.create(null);class pn{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):e_,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new pn(e.name||"",t,e.id,i);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(ue.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return i=>{for(let r=i.prop(ue.group),s=-1;s<(r?r.length:0);s++){let o=t[s<0?i.name:r[s]];if(o)return o}}}}pn.none=new pn("",Object.create(null),0,8);const ba=new WeakMap,d0=new WeakMap;class ft{constructor(e,t,i,r,s){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let e=this.prop(ue.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let r=i.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e,t=0){let i=e!=null&&ba.get(this)||this.topNode,r=new qu(i);return e!=null&&(r.moveTo(e,t),ba.set(this,r._tree)),r}fullCursor(){return new qu(this.topNode,1)}get topNode(){return new Qn(this,0,0,null)}resolve(e,t=0){let i=Ts(ba.get(this)||this.topNode,e,t,!1);return ba.set(this,i),i}resolveInner(e,t=0){let i=Ts(d0.get(this)||this.topNode,e,t,!0);return d0.set(this,i),i}iterate(e){let{enter:t,leave:i,from:r=0,to:s=this.length}=e;for(let o=this.cursor(),l=()=>o.node;;){let a=!1;if(o.from<=s&&o.to>=r&&(o.type.isAnonymous||t(o.type,o.from,o.to,l)!==!1)){if(o.firstChild())continue;o.type.isAnonymous||(a=!0)}for(;a&&i&&i(o.type,o.from,o.to,l),a=o.type.isAnonymous,!o.nextSibling();){if(!o.parent())return;a=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:vm(pn.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,r)=>new ft(this.type,t,i,r,this.propValues),e.makeTree||((t,i,r)=>new ft(pn.none,t,i,r)))}static build(e){return n_(e)}}ft.empty=new ft(pn.none,[],[],0);class mm{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new mm(this.buffer,this.index)}}class Ar{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return pn.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),e+=4,i==e)return s;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,i,r,s){let{buffer:o}=this,l=-1;for(let a=e;a!=t&&!(Jw(s,r,o[a+1],o[a+2])&&(l=a,i>0));a=o[a+3]);return l}slice(e,t,i,r){let s=this.buffer,o=new Uint16Array(t-e);for(let l=e,a=0;l<t;)o[a++]=s[l++],o[a++]=s[l++]-i,o[a++]=s[l++]-i,o[a++]=s[l++]-e;return new Ar(o,r-i,this.set)}}function Jw(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function Yw(n,e){let t=n.childBefore(e);for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(n=t,t=i.prevSibling):t=i}return n}function Ts(n,e,t,i){for(var r;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let s=!i&&n instanceof Qn&&n.index<0?null:n.parent;if(!s)return n;n=s}if(i)for(let s=n,o=s.parent;o;s=o,o=s.parent)s instanceof Qn&&s.index<0&&((r=o.enter(e,t,!0))===null||r===void 0?void 0:r.from)!=s.from&&(n=o);for(;;){let s=n.enter(e,t,i);if(!s)return n;n=s}}class Qn{constructor(e,t,i,r){this.node=e,this._from=t,this.index=i,this._parent=r}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(e,t,i,r,s=0){for(let o=this;;){for(let{children:l,positions:a}=o.node,u=t>0?l.length:-1;e!=u;e+=t){let h=l[e],c=a[e]+o._from;if(!!Jw(r,i,c,c+h.length)){if(h instanceof Ar){if(s&2)continue;let f=h.findChild(0,h.buffer.length,t,i-c,r);if(f>-1)return new _i(new t_(o,h,e,c),null,f)}else if(s&1||!h.type.isAnonymous||gm(h)){let f;if(!(s&1)&&h.props&&(f=h.prop(ue.mounted))&&!f.overlay)return new Qn(f.tree,c,e,o);let d=new Qn(h,c,e,o);return s&1||!d.type.isAnonymous?d:d.nextChild(t<0?h.children.length-1:0,t,i,r)}}}if(s&1||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent.node.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this.node.children.length-1,-1,e,-2)}enter(e,t,i=!0,r=!0){let s;if(i&&(s=this.node.prop(ue.mounted))&&s.overlay){let o=e-this.from;for(let{from:l,to:a}of s.overlay)if((t>0?l<=o:l<o)&&(t<0?a>=o:a>o))return new Qn(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r?0:2)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new qu(this)}get tree(){return this.node}toTree(){return this.node}resolve(e,t=0){return Ts(this,e,t,!1)}resolveInner(e,t=0){return Ts(this,e,t,!0)}enterUnfinishedNodesBefore(e){return Yw(this,e)}getChild(e,t=null,i=null){let r=Uu(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Uu(this,e,t,i)}toString(){return this.node.toString()}}function Uu(n,e,t,i){let r=n.cursor,s=[];if(!r.firstChild())return s;if(t!=null){for(;!r.type.is(t);)if(!r.nextSibling())return s}for(;;){if(i!=null&&r.type.is(i))return s;if(r.type.is(e)&&s.push(r.node),!r.nextSibling())return i==null?s:[]}}class t_{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class _i{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new _i(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i,r=!0){if(!r)return null;let{buffer:s}=this.context,o=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return o<0?null:new _i(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new _i(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new _i(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get cursor(){return new qu(this)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,s=i.buffer[this.index+3];if(s>r){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];e.push(i.slice(r,s,o,l)),t.push(0)}return new ft(this.type,e,t,this.to-this.from)}resolve(e,t=0){return Ts(this,e,t,!1)}resolveInner(e,t=0){return Ts(this,e,t,!0)}enterUnfinishedNodesBefore(e){return Yw(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let r=Uu(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Uu(this,e,t,i)}}class qu{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Qn)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return e?e instanceof Qn?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree.node.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=!0,r=!0){return this.buffer?r?this.enterChild(1,e,t):!1:this.yield(this._tree.enter(e,t,i&&!(this.mode&1),r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&1?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&1?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let r=i<0?0:this.stack[i]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,0,4))}else{let r=t.buffer[this.index+3];if(r<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(r)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let s=t+e,o=e<0?-1:i.node.children.length;s!=o;s+=e){let l=i.node.children[s];if(this.mode&1||l instanceof Ar||!l.type.isAnonymous||gm(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer){e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;t=o,i=s+1;break e}r=this.stack[--s]}}for(let r=i;r<this.stack.length;r++)t=new _i(this.buffer,t,this.stack[r]);return this.bufferNode=new _i(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree.node}}function gm(n){return n.children.some(e=>e instanceof Ar||!e.type.isAnonymous||gm(e))}function n_(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:r=QO,reused:s=[],minRepeatType:o=i.types.length}=n,l=Array.isArray(t)?new mm(t,t.length):t,a=i.types,u=0,h=0;function c(b,_,O,R,L){let{id:A,start:$,end:U,size:X}=l,H=h;for(;X<0;)if(l.next(),X==-1){let T=s[A];O.push(T),R.push($-b);return}else if(X==-3){u=A;return}else if(X==-4){h=A;return}else throw new RangeError(`Unrecognized record size: ${X}`);let Ce=a[A],S,E,P=$-b;if(U-$<=r&&(E=w(l.pos-_,L))){let T=new Uint16Array(E.size-E.skip),N=l.pos-E.size,j=T.length;for(;l.pos>N;)j=v(E.start,T,j);S=new Ar(T,U-E.start,i),P=E.start-b}else{let T=l.pos-X;l.next();let N=[],j=[],D=A>=o?A:-1,W=0,z=U;for(;l.pos>T;)D>=0&&l.id==D&&l.size>=0?(l.end<=z-r&&(d(N,j,$,W,l.end,z,D,H),W=N.length,z=l.end),l.next()):c($,T,N,j,D);if(D>=0&&W>0&&W<N.length&&d(N,j,$,W,$,z,D,H),N.reverse(),j.reverse(),D>-1&&W>0){let se=f(Ce);S=vm(Ce,N,j,0,N.length,0,U-$,se,se)}else S=m(Ce,N,j,U-$,H-U)}O.push(S),R.push(P)}function f(b){return(_,O,R)=>{let L=0,A=_.length-1,$,U;if(A>=0&&($=_[A])instanceof ft){if(!A&&$.type==b&&$.length==R)return $;(U=$.prop(ue.lookAhead))&&(L=O[A]+$.length+U)}return m(b,_,O,R,L)}}function d(b,_,O,R,L,A,$,U){let X=[],H=[];for(;b.length>R;)X.push(b.pop()),H.push(_.pop()+O-L);b.push(m(i.types[$],X,H,A-L,U-A)),_.push(L-O)}function m(b,_,O,R,L=0,A){if(u){let $=[ue.contextHash,u];A=A?[$].concat(A):[$]}if(L>25){let $=[ue.lookAhead,L];A=A?[$].concat(A):[$]}return new ft(b,_,O,R,A)}function w(b,_){let O=l.fork(),R=0,L=0,A=0,$=O.end-r,U={size:0,start:0,skip:0};e:for(let X=O.pos-b;O.pos>X;){let H=O.size;if(O.id==_&&H>=0){U.size=R,U.start=L,U.skip=A,A+=4,R+=4,O.next();continue}let Ce=O.pos-H;if(H<0||Ce<X||O.start<$)break;let S=O.id>=o?4:0,E=O.start;for(O.next();O.pos>Ce;){if(O.size<0)if(O.size==-3)S+=4;else break e;else O.id>=o&&(S+=4);O.next()}L=E,R+=H,A+=S}return(_<0||R==b)&&(U.size=R,U.start=L,U.skip=A),U.size>4?U:void 0}function v(b,_,O){let{id:R,start:L,end:A,size:$}=l;if(l.next(),$>=0&&R<o){let U=O;if($>4){let X=l.pos-($-4);for(;l.pos>X;)O=v(b,_,O)}_[--O]=U,_[--O]=A-b,_[--O]=L-b,_[--O]=R}else $==-3?u=R:$==-4&&(h=R);return O}let p=[],y=[];for(;l.pos>0;)c(n.start||0,n.bufferStart||0,p,y,-1);let C=(e=n.length)!==null&&e!==void 0?e:p.length?y[0]+p[0].length:0;return new ft(a[n.topID],p.reverse(),y.reverse(),C)}const p0=new WeakMap;function hu(n,e){if(!n.isAnonymous||e instanceof Ar||e.type!=n)return 1;let t=p0.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof ft)){t=1;break}t+=hu(n,i)}p0.set(e,t)}return t}function vm(n,e,t,i,r,s,o,l,a){let u=0;for(let m=i;m<r;m++)u+=hu(n,e[m]);let h=Math.ceil(u*1.5/8),c=[],f=[];function d(m,w,v,p,y){for(let C=v;C<p;){let b=C,_=w[C],O=hu(n,m[C]);for(C++;C<p;C++){let R=hu(n,m[C]);if(O+R>=h)break;O+=R}if(C==b+1){if(O>h){let R=m[b];d(R.children,R.positions,0,R.children.length,w[b]+y);continue}c.push(m[b])}else{let R=w[C-1]+m[C-1].length-_;c.push(vm(n,m,w,b,C,_,R,null,a))}f.push(_+y-s)}}return d(e,t,i,r,0),(l||a)(c,f,o)}class mr{constructor(e,t,i,r,s=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let r=[new mr(0,e.length,e,0,!1,i)];for(let s of t)s.to>e.length&&r.push(s);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],s=1,o=e.length?e[0]:null;for(let l=0,a=0,u=0;;l++){let h=l<t.length?t[l]:null,c=h?h.fromA:1e9;if(c-a>=i)for(;o&&o.from<c;){let f=o;if(a>=f.from||c<=f.to||u){let d=Math.max(f.from,a)-u,m=Math.min(f.to,c)-u;f=d>=m?null:new mr(d,m,f.tree,f.offset+u,l>0,!!h)}if(f&&r.push(f),o.to>c)break;o=s<e.length?e[s++]:null}if(!h)break;a=h.toA,u=h.toA-h.toB}return r}}class i_{startParse(e,t,i){return typeof e=="string"&&(e=new r_(e)),i=i?i.length?i.map(r=>new Jc(r.from,r.to)):[new Jc(0,0)]:[new Jc(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let s=r.advance();if(s)return s}}}class r_{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new ue({perNode:!0});const Jd=new ue;class Kn{constructor(e,t,i,r=[]){this.data=e,this.topNode=i,ce.prototype.hasOwnProperty("tree")||Object.defineProperty(ce.prototype,"tree",{get(){return Rt(this)}}),this.parser=t,this.extension=[zi.of(this),ce.languageData.of((s,o,l)=>s.facet(m0(s,o,l)))].concat(r)}isActiveAt(e,t,i=-1){return m0(e,t,i)==this.data}findRegions(e){let t=e.facet(zi);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],r=(s,o)=>{if(s.prop(Jd)==this.data){i.push({from:o,to:o+s.length});return}let l=s.prop(ue.mounted);if(l){if(l.tree.prop(Jd)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+o,to:a.to+o});else i.push({from:o,to:o+s.length});return}else if(l.overlay){let a=i.length;if(r(l.tree,l.overlay[0].from+o),i.length>a)return}}for(let a=0;a<s.children.length;a++){let u=s.children[a];u instanceof ft&&r(u,s.positions[a]+o)}};return r(Rt(e),0),i}get allowsNesting(){return!0}}Kn.setState=ie.define();function m0(n,e,t){let i=n.facet(zi);if(!i)return null;let r=i.data;if(i.allowsNesting)for(let s=Rt(n).topNode;s;s=s.enter(e,t,!0,!1))r=s.type.prop(Jd)||r;return r}function Rt(n){let e=n.field(Kn.state,!1);return e?e.tree:ft.empty}class s_{constructor(e,t=e.length){this.doc=e,this.length=t,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let mo=null;class ym{constructor(e,t,i=[],r,s,o,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new s_(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=ft.empty&&this.isDone(t!=null?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;let r=Date.now()+e;for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(mr.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(t!=null?t:this.state.doc.length))this.parse=this.startParse();else return!0;if(Date.now()>r)return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(mr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=mo;mo=this;try{return e()}finally{mo=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=g0(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:r,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((u,h,c,f)=>a.push({fromA:u,toA:h,fromB:c,toB:f})),i=mr.applyChanges(i,a),r=ft.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let u of this.skipped){let h=e.mapPos(u.from,1),c=e.mapPos(u.to,-1);h<c&&l.push({from:h,to:c})}}}return new ym(this.parser,t,i,r,s,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:r,to:s}=this.skipped[i];r<e.to&&s>e.from&&(this.fragments=g0(this.fragments,r,s),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends i_{createParse(t,i,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let a=mo;if(a){for(let u of r)a.tempSkipped.push(u);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new ft(pn.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return mo}}function g0(n,e,t){return mr.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class As{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new As(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=new ym(e.facet(zi).parser,e,[],ft.empty,0,{from:0,to:t},[],null);return i.work(20,t)||i.takeTree(),new As(i)}}Kn.state=Ye.define({create:As.init,update(n,e){for(let t of e.effects)if(t.is(Kn.setState))return t.value;return e.startState.facet(zi)!=e.state.facet(zi)?As.init(e.state):n.apply(e)}});let Xw=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback!="undefined"&&(Xw=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const o_=Ve.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Kn.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Kn.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=Xw(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:r}}=this.view,s=i.field(Kn.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Math.min(this.chunkBudget,100,e?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<r&&i.doc.length>r+1e3,a=s.context.work(o,r+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Kn.setState.of(new As(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Ht(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return this.working||this.workScheduled>0}},{eventHandlers:{focus(){this.scheduleWork()}}}),zi=Y.define({combine(n){return n.length?n[0]:null},enables:[Kn.state,o_]}),l_=Y.define(),Cm=Y.define({combine:n=>{if(!n.length)return"  ";if(!/^(?: +|\t+)$/.test(n[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return n[0]}});function Ku(n){let e=n.facet(Cm);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function wl(n,e){let t="",i=n.tabSize;if(n.facet(Cm).charCodeAt(0)==9)for(;e>=i;)t+="	",e-=i;for(let r=0;r<e;r++)t+=" ";return t}function Sm(n,e){n instanceof ce&&(n=new Oh(n));for(let i of n.state.facet(l_)){let r=i(n,e);if(r!=null)return r}let t=Rt(n.state);return t?u_(n,t,e):null}class Oh{constructor(e,t={}){this.state=e,this.options=t,this.unit=Ku(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:r}=this.options;return r!=null&&r>=i.from&&r<=i.to?(t<0?r<e:r<=e)?{text:i.text.slice(r-i.from),from:r}:{text:i.text.slice(0,r-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:r}=this.lineAt(e,t);return i.slice(e-r,Math.min(i.length,e+100-r))}column(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.countColumn(i,e-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return Dl(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const a_=new ue;function u_(n,e,t){return Qw(e.resolveInner(t).enterUnfinishedNodesBefore(t),t,n)}function h_(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function c_(n){let e=n.type.prop(a_);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(ue.closedBy))){let r=n.lastChild,s=r&&i.indexOf(r.name)>-1;return o=>g_(o,!0,1,void 0,s&&!h_(o)?r.from:void 0)}return n.parent==null?f_:null}function Qw(n,e,t){for(;n;n=n.parent){let i=c_(n);if(i)return i(new d_(t,e,n))}return null}function f_(){return 0}class d_ extends Oh{constructor(e,t,i){super(e.state,e.options);this.base=e,this.pos=t,this.node=i}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(p_(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?Qw(e,this.pos,this.base):0}}function p_(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function m_(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let r=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped)return a.from<o?t:null;l=a.to}}function g_(n,e,t,i,r){let s=n.textAfter,o=s.match(/^\s*/)[0].length,l=i&&s.slice(o,o+i.length)==i||r==n.pos+o,a=e?m_(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}const v_=200;function y_(){return ce.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:i}=n.newSelection.main,r=t.lineAt(i);if(i>r.from+v_)return n;let s=t.sliceString(r.from,i);if(!e.some(u=>u.test(s)))return n;let{state:o}=n,l=-1,a=[];for(let{head:u}of o.selection.ranges){let h=o.doc.lineAt(u);if(h.from==l)continue;l=h.from;let c=Sm(o,h.from);if(c==null)continue;let f=/^\s*/.exec(h.text)[0],d=wl(o,c);f!=d&&a.push({from:h.from,to:h.from+f.length,insert:d})}return a.length?[n,{changes:a,sequential:!0}]:n})}const C_=Y.define(),S_=new ue;function w_(n,e,t){let i=Rt(n);if(i.length==0)return null;let r=i.resolveInner(t),s=null;for(let o=r;o;o=o.parent){if(o.to<=t||o.from>t)continue;if(s&&o.from<e)break;let l=o.type.prop(S_);if(l){let a=l(o,n);a&&a.from<=t&&a.from>=e&&a.to>t&&(s=a)}}return s}function Ju(n,e,t){for(let i of n.facet(C_)){let r=i(n,e,t);if(r)return r}return w_(n,e,t)}class Dn extends Cr{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Dn.prototype.elementClass="";Dn.prototype.toDOM=void 0;Dn.prototype.mapMode=Ct.TrackBefore;Dn.prototype.startSide=Dn.prototype.endSide=-1;Dn.prototype.point=!0;const cu=Y.define(),x_={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>de.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Zo=Y.define();function Zw(n){return[e1(),Zo.of(Object.assign(Object.assign({},x_),n))]}const b_=J.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}}),Yd=Y.define({combine:n=>n.some(e=>e)});function e1(n){let e=[E_,b_];return n&&n.fixed===!1&&e.push(Yd.of(!0)),e}const E_=Ve.fromClass(class{constructor(n){this.view=n,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=n.state.facet(Zo).map(e=>new y0(n,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!n.state.facet(Yd),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}update(n){if(this.updateGutters(n)){let e=this.prevViewport,t=n.view.viewport,i=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(i<(t.to-t.from)*.8)}n.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Yd)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=n.view.viewport}syncGutters(n){let e=this.dom.nextSibling;n&&this.dom.remove();let t=de.iter(this.view.state.facet(cu),this.view.viewport.from),i=[],r=this.gutters.map(s=>new k_(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks){let o;if(Array.isArray(s.type)){for(let l of s.type)if(l.type==we.Text){o=l;break}}else o=s.type==we.Text?s:void 0;if(!!o){i.length&&(i=[]),t1(t,i,s.from);for(let l of r)l.line(this.view,o,i)}}for(let s of r)s.finish();n&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(n){let e=n.startState.facet(Zo),t=n.state.facet(Zo),i=n.docChanged||n.heightChanged||n.viewportChanged||!de.eq(n.startState.facet(cu),n.state.facet(cu),n.view.viewport.from,n.view.viewport.to);if(e==t)for(let r of this.gutters)r.update(n)&&(i=!0);else{i=!0;let r=[];for(let s of t){let o=e.indexOf(s);o<0?r.push(new y0(this.view,s)):(this.gutters[o].update(n),r.push(this.gutters[o]))}for(let s of this.gutters)s.dom.remove(),r.indexOf(s)<0&&s.destroy();for(let s of r)this.dom.appendChild(s.dom);this.gutters=r}return i}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove()}},{provide:pt.scrollMargins.from(n=>n.gutters.length==0||!n.fixed?null:n.view.textDirection==fe.LTR?{left:n.dom.offsetWidth}:{right:n.dom.offsetWidth})});function v0(n){return Array.isArray(n)?n:[n]}function t1(n,e,t){for(;n.value&&n.from<=t;)n.from==t&&e.push(n.value),n.next()}class k_{constructor(e,t,i){this.gutter=e,this.height=i,this.localMarkers=[],this.i=0,this.cursor=de.iter(e.markers,t.from)}line(e,t,i){this.localMarkers.length&&(this.localMarkers=[]),t1(this.cursor,this.localMarkers,t.from);let r=i.length?this.localMarkers.concat(i):this.localMarkers,s=this.gutter.config.lineMarker(e,t,r);s&&r.unshift(s);let o=this.gutter;if(r.length==0&&!o.config.renderEmptyElements)return;let l=t.top-this.height;if(this.i==o.elements.length){let a=new n1(e,t.height,l,r);o.elements.push(a),o.dom.appendChild(a.dom)}else o.elements[this.i].update(e,t.height,l,r);this.height=t.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class y0{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,r=>{let s=e.lineBlockAtHeight(r.clientY-e.documentTop);t.domEventHandlers[i](e,s,r)&&r.preventDefault()});this.markers=v0(t.markers(e)),t.initialSpacer&&(this.spacer=new n1(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=v0(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let r=this.config.updateSpacer(this.spacer.markers[0],e);r!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[r])}let i=e.view.viewport;return!de.eq(this.markers,t,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class n1{constructor(e,t,i,r){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.update(e,t,i,r)}update(e,t,i,r){this.height!=t&&(this.dom.style.height=(this.height=t)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),O_(this.markers,r)||this.setMarkers(e,r)}setMarkers(e,t){let i="cm-gutterElement",r=this.dom.firstChild;for(let s=0,o=0;;){let l=o,a=s<t.length?t[s++]:null,u=!1;if(a){let h=a.elementClass;h&&(i+=" "+h);for(let c=o;c<this.markers.length;c++)if(this.markers[c].compare(a)){l=c,u=!0;break}}else l=this.markers.length;for(;o<l;){let h=this.markers[o++];if(h.toDOM){h.destroy(r);let c=r.nextSibling;r.remove(),r=c}}if(!a)break;a.toDOM&&(u?r=r.nextSibling:this.dom.insertBefore(a.toDOM(e),r)),u&&o++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function O_(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].compare(e[t]))return!1;return!0}const __=Y.define(),as=Y.define({combine(n){return Ji(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let r in t){let s=i[r],o=t[r];i[r]=s?(l,a,u)=>s(l,a,u)||o(l,a,u):o}return i}})}});class Yc extends Dn{constructor(e){super();this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Xc(n,e){return n.state.facet(as).formatNumber(e,n.state)}const P_=Zo.compute([as],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(__)},lineMarker(e,t,i){return i.some(r=>r.toDOM)?null:new Yc(Xc(e,e.state.doc.lineAt(t.from).number))},lineMarkerChange:e=>e.startState.facet(as)!=e.state.facet(as),initialSpacer(e){return new Yc(Xc(e,C0(e.state.doc.lines)))},updateSpacer(e,t){let i=Xc(t.view,C0(t.view.state.doc.lines));return i==e.number?e:new Yc(i)},domEventHandlers:n.facet(as).domEventHandlers}));function T_(n={}){return[as.of(n),e1(),P_]}function C0(n){let e=9;for(;e<n;)e=e*10+9;return e}const A_=new class extends Dn{constructor(){super(...arguments);this.elementClass="cm-activeLineGutter"}},N_=cu.compute(["selection"],n=>{let e=[],t=-1;for(let i of n.selection.ranges)if(i.empty){let r=n.doc.lineAt(i.head).from;r>t&&(t=r,e.push(A_.range(r)))}return de.of(e)});function I_(){return N_}function i1(n,e){let t=e.mapPos(n.from,1),i=e.mapPos(n.to,-1);return t>=i?void 0:{from:t,to:i}}const _h=ie.define({map:i1}),Fl=ie.define({map:i1});function r1(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(i=>i.from<=t&&i.to>=t)||e.push(n.lineBlockAt(t));return e}const br=Ye.define({create(){return Z.none},update(n,e){n=n.map(e.changes);for(let t of e.effects)t.is(_h)&&!D_(n,t.value.from,t.value.to)?n=n.update({add:[B_.range(t.value.from,t.value.to)]}):t.is(Fl)&&(n=n.update({filter:(i,r)=>t.value.from!=i||t.value.to!=r,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:i}=e.selection.main;n.between(i,i,(r,s)=>{r<i&&s>i&&(t=!0)}),t&&(n=n.update({filterFrom:i,filterTo:i,filter:(r,s)=>s<=i||r>=i}))}return n},provide:n=>J.decorations.from(n)});function Yu(n,e,t){var i;let r=null;return(i=n.field(br,!1))===null||i===void 0||i.between(e,t,(s,o)=>{(!r||r.from>s)&&(r={from:s,to:o})}),r}function D_(n,e,t){let i=!1;return n.between(e,e,(r,s)=>{r==e&&s==t&&(i=!0)}),i}function s1(n,e){return n.field(br,!1)?e:e.concat(ie.appendConfig.of(a1()))}const R_=n=>{for(let e of r1(n)){let t=Ju(n.state,e.from,e.to);if(t)return n.dispatch({effects:s1(n.state,[_h.of(t),o1(n,t)])}),!0}return!1},L_=n=>{if(!n.state.field(br,!1))return!1;let e=[];for(let t of r1(n)){let i=Yu(n.state,t.from,t.to);i&&e.push(Fl.of(i),o1(n,i,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function o1(n,e,t=!0){let i=n.state.doc.lineAt(e.from).number,r=n.state.doc.lineAt(e.to).number;return J.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${i} ${n.state.phrase("to")} ${r}.`)}const M_=n=>{let{state:e}=n,t=[];for(let i=0;i<e.doc.length;){let r=n.lineBlockAt(i),s=Ju(e,r.from,r.to);s&&t.push(_h.of(s)),i=(s?n.lineBlockAt(s.to):r).to+1}return t.length&&n.dispatch({effects:s1(n.state,t)}),!!t.length},F_=n=>{let e=n.state.field(br,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(i,r)=>{t.push(Fl.of({from:i,to:r}))}),n.dispatch({effects:t}),!0},V_=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:R_},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:L_},{key:"Ctrl-Alt-[",run:M_},{key:"Ctrl-Alt-]",run:F_}],W_={placeholderDOM:null,placeholderText:"\u2026"},l1=Y.define({combine(n){return Ji(n,W_)}});function a1(n){let e=[br,G_];return n&&e.push(l1.of(n)),e}const B_=Z.replace({widget:new class extends ti{toDOM(n){let{state:e}=n,t=e.facet(l1),i=s=>{let o=n.lineBlockAt(n.posAtDOM(s.target)),l=Yu(n.state,o.from,o.to);l&&n.dispatch({effects:Fl.of(l)}),s.preventDefault()};if(t.placeholderDOM)return t.placeholderDOM(n,i);let r=document.createElement("span");return r.textContent=t.placeholderText,r.setAttribute("aria-label",e.phrase("folded code")),r.title=e.phrase("unfold"),r.className="cm-foldPlaceholder",r.onclick=i,r}}}),j_={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{}};class Qc extends Dn{constructor(e,t){super();this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function $_(n={}){let e=Object.assign(Object.assign({},j_),n),t=new Qc(e,!0),i=new Qc(e,!1),r=Ve.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(zi)!=o.state.facet(zi)||o.startState.field(br,!1)!=o.state.field(br,!1))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let l=new Gi;for(let a of o.viewportLineBlocks){let u=Yu(o.state,a.from,a.to)?i:Ju(o.state,a.from,a.to)?t:null;u&&l.add(a.from,a.from,u)}return l.finish()}}),{domEventHandlers:s}=e;return[r,Zw({class:"cm-foldGutter",markers(o){var l;return((l=o.plugin(r))===null||l===void 0?void 0:l.markers)||de.empty},initialSpacer(){return new Qc(e,!1)},domEventHandlers:Object.assign(Object.assign({},s),{click:(o,l,a)=>{if(s.click&&s.click(o,l,a))return!0;let u=Yu(o.state,l.from,l.to);if(u)return o.dispatch({effects:Fl.of(u)}),!0;let h=Ju(o.state,l.from,l.to);return h?(o.dispatch({effects:_h.of(h)}),!0):!1}})}),a1()]}const G_=J.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}}),H_=J.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),u1=1e4,h1="()[]{}",c1=Y.define({combine(n){return Ji(n,{afterCursor:!0,brackets:h1,maxScanDistance:u1})}}),z_=Z.mark({class:"cm-matchingBracket"}),U_=Z.mark({class:"cm-nonmatchingBracket"}),q_=Ye.define({create(){return Z.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],i=e.state.facet(c1);for(let r of e.state.selection.ranges){if(!r.empty)continue;let s=An(e.state,r.head,-1,i)||r.head>0&&An(e.state,r.head-1,1,i)||i.afterCursor&&(An(e.state,r.head,1,i)||r.head<e.state.doc.length&&An(e.state,r.head+1,-1,i));if(!s)continue;let o=s.matched?z_:U_;t.push(o.range(s.start.from,s.start.to)),s.end&&t.push(o.range(s.end.from,s.end.to))}return Z.set(t,!0)},provide:n=>J.decorations.from(n)}),K_=[q_,H_];function J_(n={}){return[c1.of(n),K_]}function Xd(n,e,t){let i=n.prop(e<0?ue.openedBy:ue.closedBy);if(i)return i;if(n.name.length==1){let r=t.indexOf(n.name);if(r>-1&&r%2==(e<0?1:0))return[t[r+e]]}return null}function An(n,e,t,i={}){let r=i.maxScanDistance||u1,s=i.brackets||h1,o=Rt(n),l=o.resolveInner(e,t);for(let a=l;a;a=a.parent){let u=Xd(a.type,t,s);if(u&&a.from<a.to)return Y_(n,e,t,a,u,s)}return X_(n,e,t,o,l.type,r,s)}function Y_(n,e,t,i,r,s){let o=i.parent,l={from:i.from,to:i.to},a=0,u=o==null?void 0:o.cursor;if(u&&(t<0?u.childBefore(i.from):u.childAfter(i.to)))do if(t<0?u.to<=i.from:u.from>=i.to){if(a==0&&r.indexOf(u.type.name)>-1&&u.from<u.to)return{start:l,end:{from:u.from,to:u.to},matched:!0};if(Xd(u.type,t,s))a++;else if(Xd(u.type,-t,s)&&(a--,a==0))return{start:l,end:u.from==u.to?void 0:{from:u.from,to:u.to},matched:!1}}while(t<0?u.prevSibling():u.nextSibling());return{start:l,matched:!1}}function X_(n,e,t,i,r,s,o){let l=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),a=o.indexOf(l);if(a<0||a%2==0!=t>0)return null;let u={from:t<0?e-1:e,to:t>0?e+1:e},h=n.doc.iterRange(e,t>0?n.doc.length:0),c=0;for(let f=0;!h.next().done&&f<=s;){let d=h.value;t<0&&(f+=d.length);let m=e+f*t;for(let w=t>0?0:d.length-1,v=t>0?d.length:-1;w!=v;w+=t){let p=o.indexOf(d[w]);if(!(p<0||i.resolve(m+w,1).type!=r))if(p%2==0==t>0)c++;else{if(c==1)return{start:u,end:{from:m+w,to:m+w+1},matched:p>>1==a>>1};c--}}t>0&&(f+=d.length)}return h.done?{start:u,matched:!1}:null}function Bs(n,e){return F.create(n.ranges.map(e),n.mainIndex)}function Ln(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function ni({state:n,dispatch:e},t){let i=Bs(n.selection,t);return i.eq(n.selection)?!1:(e(Ln(n,i)),!0)}function Ph(n,e){return F.cursor(e?n.to:n.from)}function f1(n,e){return ni(n,t=>t.empty?n.moveByChar(t,e):Ph(t,e))}const d1=n=>f1(n,n.textDirection!=fe.LTR),p1=n=>f1(n,n.textDirection==fe.LTR);function m1(n,e){return ni(n,t=>t.empty?n.moveByGroup(t,e):Ph(t,e))}const Q_=n=>m1(n,n.textDirection!=fe.LTR),Z_=n=>m1(n,n.textDirection==fe.LTR);function eP(n,e,t){if(e.type.prop(t))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function Th(n,e,t){let i=Rt(n).resolveInner(e.head),r=t?ue.closedBy:ue.openedBy;for(let a=e.head;;){let u=t?i.childAfter(a):i.childBefore(a);if(!u)break;eP(n,u,r)?i=u:a=t?u.to:u.from}let s=i.type.prop(r),o,l;return s&&(o=t?An(n,i.from,1):An(n,i.to,-1))&&o.matched?l=t?o.end.to:o.end.from:l=t?i.to:i.from,F.cursor(l,t?-1:1)}const tP=n=>ni(n,e=>Th(n.state,e,n.textDirection!=fe.LTR)),nP=n=>ni(n,e=>Th(n.state,e,n.textDirection==fe.LTR));function g1(n,e){return ni(n,t=>{if(!t.empty)return Ph(t,e);let i=n.moveVertically(t,e);return i.head!=t.head?i:n.moveToLineBoundary(t,e)})}const v1=n=>g1(n,!1),y1=n=>g1(n,!0);function C1(n,e){let{state:t}=n,i=Bs(t.selection,o=>o.empty?n.moveVertically(o,e,n.dom.clientHeight):Ph(o,e));if(i.eq(t.selection))return!1;let r=n.coordsAtPos(t.selection.main.head),s=n.scrollDOM.getBoundingClientRect();return n.dispatch(Ln(t,i),{effects:r&&r.top>s.top&&r.bottom<s.bottom?J.scrollIntoView(i.main.head,{y:"start",yMargin:r.top-s.top}):void 0}),!0}const S0=n=>C1(n,!1),Qd=n=>C1(n,!0);function Ah(n,e,t){let i=n.lineBlockAt(e.head),r=n.moveToLineBoundary(e,t);if(r.head==e.head&&r.head!=(t?i.to:i.from)&&(r=n.moveToLineBoundary(e,t,!1)),!t&&r.head==i.from&&i.length){let s=/^\s*/.exec(n.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;s&&e.head!=i.from+s&&(r=F.cursor(i.from+s))}return r}const w0=n=>ni(n,e=>Ah(n,e,!0)),x0=n=>ni(n,e=>Ah(n,e,!1)),iP=n=>ni(n,e=>F.cursor(n.lineBlockAt(e.head).from,1)),rP=n=>ni(n,e=>F.cursor(n.lineBlockAt(e.head).to,-1));function sP(n,e,t){let i=!1,r=Bs(n.selection,s=>{let o=An(n,s.head,-1)||An(n,s.head,1)||s.head>0&&An(n,s.head-1,1)||s.head<n.doc.length&&An(n,s.head+1,-1);if(!o||!o.end)return s;i=!0;let l=o.start.from==s.head?o.end.to:o.end.from;return t?F.range(s.anchor,l):F.cursor(l)});return i?(e(Ln(n,r)),!0):!1}const oP=({state:n,dispatch:e})=>sP(n,e,!1);function Mn(n,e){let t=Bs(n.state.selection,i=>{let r=e(i);return F.range(i.anchor,r.head,r.goalColumn)});return t.eq(n.state.selection)?!1:(n.dispatch(Ln(n.state,t)),!0)}function S1(n,e){return Mn(n,t=>n.moveByChar(t,e))}const w1=n=>S1(n,n.textDirection!=fe.LTR),x1=n=>S1(n,n.textDirection==fe.LTR);function b1(n,e){return Mn(n,t=>n.moveByGroup(t,e))}const lP=n=>b1(n,n.textDirection!=fe.LTR),aP=n=>b1(n,n.textDirection==fe.LTR),uP=n=>Mn(n,e=>Th(n.state,e,n.textDirection!=fe.LTR)),hP=n=>Mn(n,e=>Th(n.state,e,n.textDirection==fe.LTR));function E1(n,e){return Mn(n,t=>n.moveVertically(t,e))}const k1=n=>E1(n,!1),O1=n=>E1(n,!0);function _1(n,e){return Mn(n,t=>n.moveVertically(t,e,n.dom.clientHeight))}const b0=n=>_1(n,!1),E0=n=>_1(n,!0),k0=n=>Mn(n,e=>Ah(n,e,!0)),O0=n=>Mn(n,e=>Ah(n,e,!1)),cP=n=>Mn(n,e=>F.cursor(n.lineBlockAt(e.head).from)),fP=n=>Mn(n,e=>F.cursor(n.lineBlockAt(e.head).to)),_0=({state:n,dispatch:e})=>(e(Ln(n,{anchor:0})),!0),P0=({state:n,dispatch:e})=>(e(Ln(n,{anchor:n.doc.length})),!0),T0=({state:n,dispatch:e})=>(e(Ln(n,{anchor:n.selection.main.anchor,head:0})),!0),A0=({state:n,dispatch:e})=>(e(Ln(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),dP=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),pP=({state:n,dispatch:e})=>{let t=Dh(n).map(({from:i,to:r})=>F.range(i,Math.min(r+1,n.doc.length)));return e(n.update({selection:F.create(t),userEvent:"select"})),!0},mP=({state:n,dispatch:e})=>{let t=Bs(n.selection,i=>{var r;let s=Rt(n).resolveInner(i.head,1);for(;!(s.from<i.from&&s.to>=i.to||s.to>i.to&&s.from<=i.from||!((r=s.parent)===null||r===void 0?void 0:r.parent));)s=s.parent;return F.range(s.to,s.from)});return e(Ln(n,t)),!0},gP=({state:n,dispatch:e})=>{let t=n.selection,i=null;return t.ranges.length>1?i=F.create([t.main]):t.main.empty||(i=F.create([F.cursor(t.main.head)])),i?(e(Ln(n,i)),!0):!1};function Nh({state:n,dispatch:e},t){if(n.readOnly)return!1;let i="delete.selection",r=n.changeByRange(s=>{let{from:o,to:l}=s;if(o==l){let a=t(o);a<o?i="delete.backward":a>o&&(i="delete.forward"),o=Math.min(o,a),l=Math.max(l,a)}return o==l?{range:s}:{changes:{from:o,to:l},range:F.cursor(o)}});return r.changes.empty?!1:(e(n.update(r,{scrollIntoView:!0,userEvent:i})),!0)}function Ih(n,e,t){if(n instanceof J)for(let i of n.pluginField(pt.atomicRanges))i.between(e,e,(r,s)=>{r<e&&s>e&&(e=t?s:r)});return e}const P1=(n,e)=>Nh(n,t=>{let{state:i}=n,r=i.doc.lineAt(t),s,o;if(!e&&t>r.from&&t<r.from+200&&!/[^ \t]/.test(s=r.text.slice(0,t-r.from))){if(s[s.length-1]=="	")return t-1;let l=Dl(s,i.tabSize),a=l%Ku(i)||Ku(i);for(let u=0;u<a&&s[s.length-1-u]==" ";u++)t--;o=t}else o=jt(r.text,t-r.from,e,e)+r.from,o==t&&r.number!=(e?i.doc.lines:1)&&(o+=e?1:-1);return Ih(n,o,e)}),Zd=n=>P1(n,!1),T1=n=>P1(n,!0),A1=(n,e)=>Nh(n,t=>{let i=t,{state:r}=n,s=r.doc.lineAt(i),o=r.charCategorizer(i);for(let l=null;;){if(i==(e?s.to:s.from)){i==t&&s.number!=(e?r.doc.lines:1)&&(i+=e?1:-1);break}let a=jt(s.text,i-s.from,e)+s.from,u=s.text.slice(Math.min(i,a)-s.from,Math.max(i,a)-s.from),h=o(u);if(l!=null&&h!=l)break;(u!=" "||i!=t)&&(l=h),i=a}return Ih(n,i,e)}),N1=n=>A1(n,!1),vP=n=>A1(n,!0),I1=n=>Nh(n,e=>{let t=n.lineBlockAt(e).to;return Ih(n,e<t?t:Math.min(n.state.doc.length,e+1),!0)}),yP=n=>Nh(n,e=>{let t=n.lineBlockAt(e).from;return Ih(n,e>t?t:Math.max(0,e-1),!1)}),CP=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:me.of(["",""])},range:F.cursor(i.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},SP=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>{if(!i.empty||i.from==0||i.from==n.doc.length)return{range:i};let r=i.from,s=n.doc.lineAt(r),o=r==s.from?r-1:jt(s.text,r-s.from,!1)+s.from,l=r==s.to?r+1:jt(s.text,r-s.from,!0)+s.from;return{changes:{from:o,to:l,insert:n.doc.slice(r,l).append(n.doc.slice(o,r))},range:F.cursor(l)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Dh(n){let e=[],t=-1;for(let i of n.selection.ranges){let r=n.doc.lineAt(i.from),s=n.doc.lineAt(i.to);if(!i.empty&&i.to==s.from&&(s=n.doc.lineAt(i.to-1)),t>=r.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(i)}else e.push({from:r.from,to:s.to,ranges:[i]});t=s.number+1}return e}function D1(n,e,t){if(n.readOnly)return!1;let i=[],r=[];for(let s of Dh(n)){if(t?s.to==n.doc.length:s.from==0)continue;let o=n.doc.lineAt(t?s.to+1:s.from-1),l=o.length+1;if(t){i.push({from:s.to,to:o.to},{from:s.from,insert:o.text+n.lineBreak});for(let a of s.ranges)r.push(F.range(Math.min(n.doc.length,a.anchor+l),Math.min(n.doc.length,a.head+l)))}else{i.push({from:o.from,to:s.from},{from:s.to,insert:n.lineBreak+o.text});for(let a of s.ranges)r.push(F.range(a.anchor-l,a.head-l))}}return i.length?(e(n.update({changes:i,scrollIntoView:!0,selection:F.create(r,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const wP=({state:n,dispatch:e})=>D1(n,e,!1),xP=({state:n,dispatch:e})=>D1(n,e,!0);function R1(n,e,t){if(n.readOnly)return!1;let i=[];for(let r of Dh(n))t?i.push({from:r.from,insert:n.doc.slice(r.from,r.to)+n.lineBreak}):i.push({from:r.to,insert:n.lineBreak+n.doc.slice(r.from,r.to)});return e(n.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const bP=({state:n,dispatch:e})=>R1(n,e,!1),EP=({state:n,dispatch:e})=>R1(n,e,!0),kP=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(Dh(e).map(({from:r,to:s})=>(r>0?r--:s<e.doc.length&&s++,{from:r,to:s}))),i=Bs(e.selection,r=>n.moveVertically(r,!0)).map(t);return n.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function OP(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=Rt(n).resolveInner(e),i=t.childBefore(e),r=t.childAfter(e),s;return i&&r&&i.to<=e&&r.from>=e&&(s=i.type.prop(ue.closedBy))&&s.indexOf(r.name)>-1&&n.doc.lineAt(i.to).from==n.doc.lineAt(r.from).from?{from:i.to,to:r.from}:null}const _P=L1(!1),PP=L1(!0);function L1(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(r=>{let{from:s,to:o}=r,l=e.doc.lineAt(s),a=!n&&s==o&&OP(e,s);n&&(s=o=(o<=l.to?l:e.doc.lineAt(o)).to);let u=new Oh(e,{simulateBreak:s,simulateDoubleBreak:!!a}),h=Sm(u,s);for(h==null&&(h=/^\s*/.exec(e.doc.lineAt(s).text)[0].length);o<l.to&&/\s/.test(l.text[o-l.from]);)o++;a?{from:s,to:o}=a:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let c=["",wl(e,h)];return a&&c.push(wl(e,u.lineIndent(l.from,-1))),{changes:{from:s,to:o,insert:me.of(c)},range:F.cursor(s+1+c[1].length)}});return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function wm(n,e){let t=-1;return n.changeByRange(i=>{let r=[];for(let o=i.from;o<=i.to;){let l=n.doc.lineAt(o);l.number>t&&(i.empty||i.to>l.from)&&(e(l,r,i),t=l.number),o=l.to+1}let s=n.changes(r);return{changes:r,range:F.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}})}const TP=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),i=new Oh(n,{overrideIndentation:s=>{let o=t[s];return o==null?-1:o}}),r=wm(n,(s,o,l)=>{let a=Sm(i,s.from);if(a==null)return;/\S/.test(s.text)||(a=0);let u=/^\s*/.exec(s.text)[0],h=wl(n,a);(u!=h||l.from<s.from+u.length)&&(t[s.from]=a,o.push({from:s.from,to:s.from+u.length,insert:h}))});return r.changes.empty||e(n.update(r,{userEvent:"indent"})),!0},M1=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(wm(n,(t,i)=>{i.push({from:t.from,insert:n.facet(Cm)})}),{userEvent:"input.indent"})),!0),F1=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(wm(n,(t,i)=>{let r=/^\s*/.exec(t.text)[0];if(!r)return;let s=Dl(r,n.tabSize),o=0,l=wl(n,Math.max(0,s-Ku(n)));for(;o<r.length&&o<l.length&&r.charCodeAt(o)==l.charCodeAt(o);)o++;i.push({from:t.from+o,to:t.from+r.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),AP=[{key:"Ctrl-b",run:d1,shift:w1,preventDefault:!0},{key:"Ctrl-f",run:p1,shift:x1},{key:"Ctrl-p",run:v1,shift:k1},{key:"Ctrl-n",run:y1,shift:O1},{key:"Ctrl-a",run:iP,shift:cP},{key:"Ctrl-e",run:rP,shift:fP},{key:"Ctrl-d",run:T1},{key:"Ctrl-h",run:Zd},{key:"Ctrl-k",run:I1},{key:"Ctrl-Alt-h",run:N1},{key:"Ctrl-o",run:CP},{key:"Ctrl-t",run:SP},{key:"Ctrl-v",run:Qd}],NP=[{key:"ArrowLeft",run:d1,shift:w1,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Q_,shift:lP},{mac:"Cmd-ArrowLeft",run:x0,shift:O0},{key:"ArrowRight",run:p1,shift:x1,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Z_,shift:aP},{mac:"Cmd-ArrowRight",run:w0,shift:k0},{key:"ArrowUp",run:v1,shift:k1,preventDefault:!0},{mac:"Cmd-ArrowUp",run:_0,shift:T0},{mac:"Ctrl-ArrowUp",run:S0,shift:b0},{key:"ArrowDown",run:y1,shift:O1,preventDefault:!0},{mac:"Cmd-ArrowDown",run:P0,shift:A0},{mac:"Ctrl-ArrowDown",run:Qd,shift:E0},{key:"PageUp",run:S0,shift:b0},{key:"PageDown",run:Qd,shift:E0},{key:"Home",run:x0,shift:O0},{key:"Mod-Home",run:_0,shift:T0},{key:"End",run:w0,shift:k0},{key:"Mod-End",run:P0,shift:A0},{key:"Enter",run:_P},{key:"Mod-a",run:dP},{key:"Backspace",run:Zd,shift:Zd},{key:"Delete",run:T1},{key:"Mod-Backspace",mac:"Alt-Backspace",run:N1},{key:"Mod-Delete",mac:"Alt-Delete",run:vP},{mac:"Mod-Backspace",run:yP},{mac:"Mod-Delete",run:I1}].concat(AP.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),IP=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:tP,shift:uP},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:nP,shift:hP},{key:"Alt-ArrowUp",run:wP},{key:"Shift-Alt-ArrowUp",run:bP},{key:"Alt-ArrowDown",run:xP},{key:"Shift-Alt-ArrowDown",run:EP},{key:"Escape",run:gP},{key:"Mod-Enter",run:PP},{key:"Alt-l",mac:"Ctrl-l",run:pP},{key:"Mod-i",run:mP,preventDefault:!0},{key:"Mod-[",run:F1},{key:"Mod-]",run:M1},{key:"Mod-Alt-\\",run:TP},{key:"Shift-Mod-k",run:kP},{key:"Shift-Mod-\\",run:oP}].concat(NP),DP={key:"Tab",run:M1,shift:F1},Xu={brackets:["(","[","{","'",'"'],before:`)]}'":;>`},cr=ie.define({map(n,e){let t=e.mapPos(n,-1,Ct.TrackAfter);return t==null?void 0:t}}),xm=ie.define({map(n,e){return e.mapPos(n)}}),bm=new class extends Cr{};bm.startSide=1;bm.endSide=-1;const V1=Ye.define({create(){return de.empty},update(n,e){if(e.selection){let t=e.state.doc.lineAt(e.selection.main.head).from,i=e.startState.doc.lineAt(e.startState.selection.main.head).from;t!=e.changes.mapPos(i,-1)&&(n=de.empty)}n=n.map(e.changes);for(let t of e.effects)t.is(cr)?n=n.update({add:[bm.range(t.value,t.value+1)]}):t.is(xm)&&(n=n.update({filter:i=>i!=t.value}));return n}});function RP(){return[MP,V1]}const Zc="()[]{}<>";function W1(n){for(let e=0;e<Zc.length;e+=2)if(Zc.charCodeAt(e)==n)return Zc.charAt(e+1);return om(n<128?n:n+1)}function B1(n,e){return n.languageDataAt("closeBrackets",e)[0]||Xu}const LP=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),MP=J.inputHandler.of((n,e,t,i)=>{if((LP?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let r=n.state.selection.main;if(i.length>2||i.length==2&&Yt(at(i,0))==1||e!=r.from||t!=r.to)return!1;let s=WP(n.state,i);return s?(n.dispatch(s),!0):!1}),FP=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let i=B1(n,n.selection.main.head).brackets||Xu.brackets,r=null,s=n.changeByRange(o=>{if(o.empty){let l=BP(n.doc,o.head);for(let a of i)if(a==l&&Rh(n.doc,o.head)==W1(at(a,0)))return{changes:{from:o.head-a.length,to:o.head+a.length},range:F.cursor(o.head-a.length),userEvent:"delete.backward"}}return{range:r=o}});return r||e(n.update(s,{scrollIntoView:!0})),!r},VP=[{key:"Backspace",run:FP}];function WP(n,e){let t=B1(n,n.selection.main.head),i=t.brackets||Xu.brackets;for(let r of i){let s=W1(at(r,0));if(e==r)return s==r?GP(n,r,i.indexOf(r+r+r)>-1):jP(n,r,s,t.before||Xu.before);if(e==s&&j1(n,n.selection.main.from))return $P(n,r,s)}return null}function j1(n,e){let t=!1;return n.field(V1).between(0,n.doc.length,i=>{i==e&&(t=!0)}),t}function Rh(n,e){let t=n.sliceString(e,e+2);return t.slice(0,Yt(at(t,0)))}function BP(n,e){let t=n.sliceString(e-2,e);return Yt(at(t,0))==t.length?t:t.slice(1)}function jP(n,e,t,i){let r=null,s=n.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:t,from:o.to}],effects:cr.of(o.to+e.length),range:F.range(o.anchor+e.length,o.head+e.length)};let l=Rh(n.doc,o.head);return!l||/\s/.test(l)||i.indexOf(l)>-1?{changes:{insert:e+t,from:o.head},effects:cr.of(o.head+e.length),range:F.cursor(o.head+e.length)}:{range:r=o}});return r?null:n.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function $P(n,e,t){let i=null,r=n.selection.ranges.map(s=>s.empty&&Rh(n.doc,s.head)==t?F.cursor(s.head+t.length):i=s);return i?null:n.update({selection:F.create(r,n.selection.mainIndex),scrollIntoView:!0,effects:n.selection.ranges.map(({from:s})=>xm.of(s))})}function GP(n,e,t){let i=null,r=n.changeByRange(s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:e,from:s.to}],effects:cr.of(s.to+e.length),range:F.range(s.anchor+e.length,s.head+e.length)};let o=s.head,l=Rh(n.doc,o);if(l==e){if(N0(n,o))return{changes:{insert:e+e,from:o},effects:cr.of(o+e.length),range:F.cursor(o+e.length)};if(j1(n,o)){let a=t&&n.sliceDoc(o,o+e.length*3)==e+e+e;return{range:F.cursor(o+e.length*(a?3:1)),effects:xm.of(o)}}}else{if(t&&n.sliceDoc(o-2*e.length,o)==e+e&&N0(n,o-2*e.length))return{changes:{insert:e+e+e+e,from:o},effects:cr.of(o+e.length),range:F.cursor(o+e.length)};if(n.charCategorizer(o)(l)!=$t.Word){let a=n.sliceDoc(o-1,o);if(a!=e&&n.charCategorizer(o)(a)!=$t.Word&&!HP(n,o,e))return{changes:{insert:e+e,from:o},effects:cr.of(o+e.length),range:F.cursor(o+e.length)}}}return{range:i=s}});return i?null:n.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function N0(n,e){let t=Rt(n).resolveInner(e+1);return t.parent&&t.from==e}function HP(n,e,t){let i=Rt(n).resolveInner(e,-1);for(let r=0;r<5;r++){if(n.sliceDoc(i.from,i.from+t.length)==t)return!0;let s=i.to==e&&i.parent;if(!s)break;i=s}return!1}const I0=Y.define({combine(n){let e,t;for(let i of n)e=e||i.topContainer,t=t||i.bottomContainer;return{topContainer:e,bottomContainer:t}}});function xl(n,e){let t=n.plugin($1),i=t?t.specs.indexOf(e):-1;return i>-1?t.panels[i]:null}const $1=Ve.fromClass(class{constructor(n){this.input=n.state.facet(bl),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(n));let e=n.state.facet(I0);this.top=new Ea(n,!0,e.topContainer),this.bottom=new Ea(n,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(n){let e=n.state.facet(I0);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Ea(n.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Ea(n.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=n.state.facet(bl);if(t!=this.input){let i=t.filter(a=>a),r=[],s=[],o=[],l=[];for(let a of i){let u=this.specs.indexOf(a),h;u<0?(h=a(n.view),l.push(h)):(h=this.panels[u],h.update&&h.update(n)),r.push(h),(h.top?s:o).push(h)}this.specs=i,this.panels=r,this.top.sync(s),this.bottom.sync(o);for(let a of l)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let i of this.panels)i.update&&i.update(n)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:pt.scrollMargins.from(n=>({top:n.top.scrollMargin(),bottom:n.bottom.scrollMargin()}))});class Ea{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=D0(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=D0(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function D0(n){let e=n.nextSibling;return n.remove(),e}const zP=J.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}}),bl=Y.define({enables:[$1,zP]});function _e(){var n=arguments[0];typeof n=="string"&&(n=document.createElement(n));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=t[i];typeof r=="string"?n.setAttribute(i,r):r!=null&&(n[i]=r)}e++}for(;e<arguments.length;e++)G1(n,arguments[e]);return n}function G1(n,e){if(typeof e=="string")n.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)n.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)G1(n,e[t]);else throw new RangeError("Unsupported child node: "+e)}const R0=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class Ns{constructor(e,t,i=0,r=e.length,s){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,r),this.bufferStart=i,this.normalize=s?o=>s(R0(o)):R0,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return at(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=om(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=Yt(e);let r=this.normalize(t);for(let s=0,o=i;;s++){let l=r.charCodeAt(s),a=this.match(l,o);if(a)return this.value=a,this;if(s==r.length-1)break;o==i&&s<t.length&&t.charCodeAt(s)==l&&o++}}}match(e,t){let i=null;for(let r=0;r<this.matches.length;r+=2){let s=this.matches[r],o=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?i={from:this.matches[r+1],to:t+1}:(this.matches[r]++,o=!0)),o||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?i={from:t,to:t+1}:this.matches.push(1,t)),i}}typeof Symbol!="undefined"&&(Ns.prototype[Symbol.iterator]=function(){return this});const H1={from:-1,to:-1,match:/.*/.exec("")},Em="gm"+(/x/.unicode==null?"":"u");class z1{constructor(e,t,i,r=0,s=e.length){if(this.to=s,this.curLine="",this.done=!1,this.value=H1,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new U1(e,t,i,r,s);this.re=new RegExp(t,Em+((i==null?void 0:i.ignoreCase)?"i":"")),this.iter=e.iter();let o=e.lineAt(r);this.curLineStart=o.from,this.matchPos=r,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,r=i+t[0].length;if(this.matchPos=r+(i==r?1:0),i==this.curLine.length&&this.nextLine(),i<r||i>this.value.to)return this.value={from:i,to:r,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const ef=new WeakMap;class xs{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let r=ef.get(e);if(!r||r.from>=i||r.to<=t){let l=new xs(t,e.sliceString(t,i));return ef.set(e,l),l}if(r.from==t&&r.to==i)return r;let{text:s,from:o}=r;return o>t&&(s=e.sliceString(t,o)+s,o=t),r.to<i&&(s+=e.sliceString(r.to,i)),ef.set(e,new xs(o,s)),new xs(t,s.slice(t-o,i-o))}}class U1{constructor(e,t,i,r,s){this.text=e,this.to=s,this.done=!1,this.value=H1,this.matchPos=r,this.re=new RegExp(t,Em+((i==null?void 0:i.ignoreCase)?"i":"")),this.flat=xs.get(e,r,this.chunkEnd(r+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10&&(t=null),t){let i=this.flat.from+t.index,r=i+t[0].length;return this.value={from:i,to:r,match:t},this.matchPos=r+(i==r?1:0),this}else{if(this.flat.to==this.to)return this.done=!0,this;this.flat=xs.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}}typeof Symbol!="undefined"&&(z1.prototype[Symbol.iterator]=U1.prototype[Symbol.iterator]=function(){return this});function UP(n){try{return new RegExp(n,Em),!0}catch{return!1}}function ep(n){let e=_e("input",{class:"cm-textfield",name:"line"}),t=_e("form",{class:"cm-gotoLine",onkeydown:r=>{r.keyCode==27?(r.preventDefault(),n.dispatch({effects:Qu.of(!1)}),n.focus()):r.keyCode==13&&(r.preventDefault(),i())},onsubmit:r=>{r.preventDefault(),i()}},_e("label",n.state.phrase("Go to line"),": ",e)," ",_e("button",{class:"cm-button",type:"submit"},n.state.phrase("go")));function i(){let r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!r)return;let{state:s}=n,o=s.doc.lineAt(s.selection.main.head),[,l,a,u,h]=r,c=u?+u.slice(1):0,f=a?+a:o.number;if(a&&h){let m=f/100;l&&(m=m*(l=="-"?-1:1)+o.number/s.doc.lines),f=Math.round(s.doc.lines*m)}else a&&l&&(f=f*(l=="-"?-1:1)+o.number);let d=s.doc.line(Math.max(1,Math.min(s.doc.lines,f)));n.dispatch({effects:Qu.of(!1),selection:F.cursor(d.from+Math.max(0,Math.min(c,d.length))),scrollIntoView:!0}),n.focus()}return{dom:t,pos:-10}}const Qu=ie.define(),L0=Ye.define({create(){return!0},update(n,e){for(let t of e.effects)t.is(Qu)&&(n=t.value);return n},provide:n=>bl.from(n,e=>e?ep:null)}),qP=n=>{let e=xl(n,ep);if(!e){let t=[Qu.of(!0)];n.state.field(L0,!1)==null&&t.push(ie.appendConfig.of([L0,KP])),n.dispatch({effects:t}),e=xl(n,ep)}return e&&e.dom.querySelector("input").focus(),!0},KP=J.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),JP={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100},q1=Y.define({combine(n){return Ji(n,JP,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function YP(n){let e=[eT,ZP];return n&&e.push(q1.of(n)),e}const XP=Z.mark({class:"cm-selectionMatch"}),QP=Z.mark({class:"cm-selectionMatch cm-selectionMatch-main"}),ZP=Ve.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(q1),{state:t}=n,i=t.selection;if(i.ranges.length>1)return Z.none;let r=i.main,s,o=null;if(r.empty){if(!e.highlightWordAroundCursor)return Z.none;let a=t.wordAt(r.head);if(!a)return Z.none;o=t.charCategorizer(r.head),s=t.sliceDoc(a.from,a.to)}else{let a=r.to-r.from;if(a<e.minSelectionLength||a>200||(s=t.sliceDoc(r.from,r.to).trim(),!s))return Z.none}let l=[];for(let a of n.visibleRanges){let u=new Ns(t.doc,s,a.from,a.to);for(;!u.next().done;){let{from:h,to:c}=u.value;if((!o||(h==0||o(t.sliceDoc(h-1,h))!=$t.Word)&&(c==t.doc.length||o(t.sliceDoc(c,c+1))!=$t.Word))&&(o&&h<=r.from&&c>=r.to?l.push(QP.range(h,c)):(h>=r.to||c<=r.from)&&l.push(XP.range(h,c)),l.length>e.maxMatches))return Z.none}}return Z.set(l)}},{decorations:n=>n.decorations}),eT=J.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),tT=({state:n,dispatch:e})=>{let{selection:t}=n,i=F.create(t.ranges.map(r=>n.wordAt(r.head)||F.cursor(r.head)),t.mainIndex);return i.eq(t)?!1:(e(n.update({selection:i})),!0)};function nT(n,e){let{main:t,ranges:i}=n.selection,r=n.wordAt(t.head),s=r&&r.from==t.from&&r.to==t.to;for(let o=!1,l=new Ns(n.doc,e,i[i.length-1].to);;)if(l.next(),l.done){if(o)return null;l=new Ns(n.doc,e,0,Math.max(0,i[i.length-1].from-1)),o=!0}else{if(o&&i.some(a=>a.from==l.value.from))continue;if(s){let a=n.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const iT=({state:n,dispatch:e})=>{let{ranges:t}=n.selection;if(t.some(s=>s.from===s.to))return tT({state:n,dispatch:e});let i=n.sliceDoc(t[0].from,t[0].to);if(n.selection.ranges.some(s=>n.sliceDoc(s.from,s.to)!=i))return!1;let r=nT(n,i);return r?(e(n.update({selection:n.selection.addRange(F.range(r.from,r.to),!1),effects:J.scrollIntoView(r.to)})),!0):!1},km=Y.define({combine(n){var e;return{top:n.reduce((t,i)=>t!=null?t:i.top,void 0)||!1,caseSensitive:n.reduce((t,i)=>t!=null?t:i.caseSensitive||i.matchCase,void 0)||!1,createPanel:((e=n.find(t=>t.createPanel))===null||e===void 0?void 0:e.createPanel)||(t=>new dT(t))}}});class K1{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||UP(this.search))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new sT(this):new rT(this)}}class J1{constructor(e){this.spec=e}}class rT extends J1{constructor(e){super(e);this.unquoted=e.search.replace(/\\([nrt\\])/g,(t,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}cursor(e,t=0,i=e.length){return new Ns(e,this.unquoted,t,i,this.spec.caseSensitive?void 0:r=>r.toLowerCase())}nextMatch(e,t,i){let r=this.cursor(e,i).nextOverlapping();return r.done&&(r=this.cursor(e,0,t).nextOverlapping()),r.done?null:r.value}prevMatchInRange(e,t,i){for(let r=i;;){let s=Math.max(t,r-1e4-this.unquoted.length),o=this.cursor(e,s,r),l=null;for(;!o.nextOverlapping().done;)l=o.value;if(l)return l;if(s==t)return null;r-=1e4}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,t){let i=this.cursor(e),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=this.cursor(e,Math.max(0,t-this.unquoted.length),Math.min(i+this.unquoted.length,e.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}class sT extends J1{cursor(e,t=0,i=e.length){return new z1(e,this.spec.search,this.spec.caseSensitive?void 0:{ignoreCase:!0},t,i)}nextMatch(e,t,i){let r=this.cursor(e,i).next();return r.done&&(r=this.cursor(e,0,t).next()),r.done?null:r.value}prevMatchInRange(e,t,i){for(let r=1;;r++){let s=Math.max(t,i-r*1e4),o=this.cursor(e,s,i),l=null;for(;!o.next().done;)l=o.value;if(l&&(s==t||l.from>s+10))return l;if(s==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,(t,i)=>i=="$"?"$":i=="&"?e.match[0]:i!="0"&&+i<e.match.length?e.match[i]:t)}matchAll(e,t){let i=this.cursor(e),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=this.cursor(e,Math.max(0,t-250),Math.min(i+250,e.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}const El=ie.define(),Om=ie.define(),Mi=Ye.define({create(n){return new tf(tp(n).create(),null)},update(n,e){for(let t of e.effects)t.is(El)?n=new tf(t.value.create(),n.panel):t.is(Om)&&(n=new tf(n.query,t.value?_m:null));return n},provide:n=>bl.from(n,e=>e.panel)});class tf{constructor(e,t){this.query=e,this.panel=t}}const oT=Z.mark({class:"cm-searchMatch"}),lT=Z.mark({class:"cm-searchMatch cm-searchMatch-selected"}),aT=Ve.fromClass(class{constructor(n){this.view=n,this.decorations=this.highlight(n.state.field(Mi))}update(n){let e=n.state.field(Mi);(e!=n.startState.field(Mi)||n.docChanged||n.selectionSet)&&(this.decorations=this.highlight(e))}highlight({query:n,panel:e}){if(!e||!n.spec.valid)return Z.none;let{view:t}=this,i=new Gi;for(let r=0,s=t.visibleRanges,o=s.length;r<o;r++){let{from:l,to:a}=s[r];for(;r<o-1&&a>s[r+1].from-2*250;)a=s[++r].to;n.highlight(t.state.doc,l,a,(u,h)=>{let c=t.state.selection.ranges.some(f=>f.from==u&&f.to==h);i.add(u,h,c?lT:oT)})}return i.finish()}},{decorations:n=>n.decorations});function Vl(n){return e=>{let t=e.state.field(Mi,!1);return t&&t.query.spec.valid?n(e,t):Y1(e)}}const Zu=Vl((n,{query:e})=>{let{from:t,to:i}=n.state.selection.main,r=e.nextMatch(n.state.doc,t,i);return!r||r.from==t&&r.to==i?!1:(n.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:Pm(n,r),userEvent:"select.search"}),!0)}),eh=Vl((n,{query:e})=>{let{state:t}=n,{from:i,to:r}=t.selection.main,s=e.prevMatch(t.doc,i,r);return s?(n.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:Pm(n,s),userEvent:"select.search"}),!0):!1}),uT=Vl((n,{query:e})=>{let t=e.matchAll(n.state.doc,1e3);return!t||!t.length?!1:(n.dispatch({selection:F.create(t.map(i=>F.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),hT=({state:n,dispatch:e})=>{let t=n.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:i,to:r}=t.main,s=[],o=0;for(let l=new Ns(n.doc,n.sliceDoc(i,r));!l.next().done;){if(s.length>1e3)return!1;l.value.from==i&&(o=s.length),s.push(F.range(l.value.from,l.value.to))}return e(n.update({selection:F.create(s,o),userEvent:"select.search.matches"})),!0},M0=Vl((n,{query:e})=>{let{state:t}=n,{from:i,to:r}=t.selection.main;if(t.readOnly)return!1;let s=e.nextMatch(t.doc,i,i);if(!s)return!1;let o=[],l,a;if(s.from==i&&s.to==r&&(a=t.toText(e.getReplacement(s)),o.push({from:s.from,to:s.to,insert:a}),s=e.nextMatch(t.doc,s.from,s.to)),s){let u=o.length==0||o[0].from>=s.to?0:s.to-s.from-a.length;l={anchor:s.from-u,head:s.to-u}}return n.dispatch({changes:o,selection:l,scrollIntoView:!!l,effects:s?Pm(n,s):void 0,userEvent:"input.replace"}),!0}),cT=Vl((n,{query:e})=>{if(n.state.readOnly)return!1;let t=e.matchAll(n.state.doc,1e9).map(i=>{let{from:r,to:s}=i;return{from:r,to:s,insert:e.getReplacement(i)}});return t.length?(n.dispatch({changes:t,userEvent:"input.replace.all"}),!0):!1});function _m(n){return n.state.facet(km).createPanel(n)}function tp(n,e){var t;let i=n.selection.main,r=i.empty||i.to>i.from+100?"":n.sliceDoc(i.from,i.to),s=(t=e==null?void 0:e.caseSensitive)!==null&&t!==void 0?t:n.facet(km).caseSensitive;return e&&!r?e:new K1({search:r.replace(/\n/g,"\\n"),caseSensitive:s})}const Y1=n=>{let e=n.state.field(Mi,!1);if(e&&e.panel){let t=xl(n,_m);if(!t)return!1;let i=t.dom.querySelector("[name=search]");if(i!=n.root.activeElement){let r=tp(n.state,e.query.spec);r.valid&&n.dispatch({effects:El.of(r)}),i.focus(),i.select()}}else n.dispatch({effects:[Om.of(!0),e?El.of(tp(n.state,e.query.spec)):ie.appendConfig.of(mT)]});return!0},X1=n=>{let e=n.state.field(Mi,!1);if(!e||!e.panel)return!1;let t=xl(n,_m);return t&&t.dom.contains(n.root.activeElement)&&n.focus(),n.dispatch({effects:Om.of(!1)}),!0},fT=[{key:"Mod-f",run:Y1,scope:"editor search-panel"},{key:"F3",run:Zu,shift:eh,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Zu,shift:eh,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:X1,scope:"editor search-panel"},{key:"Mod-Shift-l",run:hT},{key:"Alt-g",run:qP},{key:"Mod-d",run:iT,preventDefault:!0}];class dT{constructor(e){this.view=e;let t=this.query=e.state.field(Mi).query.spec;this.commit=this.commit.bind(this),this.searchField=_e("input",{value:t.search,placeholder:Ut(e,"Find"),"aria-label":Ut(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=_e("input",{value:t.replace,placeholder:Ut(e,"Replace"),"aria-label":Ut(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=_e("input",{type:"checkbox",name:"case",checked:t.caseSensitive,onchange:this.commit}),this.reField=_e("input",{type:"checkbox",name:"re",checked:t.regexp,onchange:this.commit});function i(r,s,o){return _e("button",{class:"cm-button",name:r,onclick:s,type:"button"},o)}this.dom=_e("div",{onkeydown:r=>this.keydown(r),class:"cm-search"},[this.searchField,i("next",()=>Zu(e),[Ut(e,"next")]),i("prev",()=>eh(e),[Ut(e,"previous")]),i("select",()=>uT(e),[Ut(e,"all")]),_e("label",null,[this.caseField,Ut(e,"match case")]),_e("label",null,[this.reField,Ut(e,"regexp")]),...e.state.readOnly?[]:[_e("br"),this.replaceField,i("replace",()=>M0(e),[Ut(e,"replace")]),i("replaceAll",()=>cT(e),[Ut(e,"replace all")]),_e("button",{name:"close",onclick:()=>X1(e),"aria-label":Ut(e,"close"),type:"button"},["\xD7"])]])}commit(){let e=new K1({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:El.of(e)}))}keydown(e){dO(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?eh:Zu)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),M0(this.view))}update(e){for(let t of e.transactions)for(let i of t.effects)i.is(El)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(km).top}}function Ut(n,e){return n.state.phrase(e)}const ka=30,Oa=/[\s\.,:;?!]/;function Pm(n,{from:e,to:t}){let i=n.state.doc.lineAt(e).from,r=n.state.doc.lineAt(t).to,s=Math.max(i,e-ka),o=Math.min(r,t+ka),l=n.state.sliceDoc(s,o);if(s!=i){for(let a=0;a<ka;a++)if(!Oa.test(l[a+1])&&Oa.test(l[a])){l=l.slice(a);break}}if(o!=r){for(let a=l.length-1;a>l.length-ka;a--)if(!Oa.test(l[a-1])&&Oa.test(l[a])){l=l.slice(0,a);break}}return J.announce.of(`${n.state.phrase("current match")}. ${l} ${n.state.phrase("on line")} ${n.state.doc.lineAt(e).number}`)}const pT=J.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),mT=[Mi,Rl.lowest(aT),pT],gT=typeof navigator!="undefined"&&!/Edge\/(\d+)/.exec(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),nf="-10000px";class Q1{constructor(e,t,i){this.facet=t,this.createTooltipView=i,this.input=e.state.facet(t),this.tooltips=this.input.filter(r=>r),this.tooltipViews=this.tooltips.map(i)}update(e){let t=e.state.facet(this.facet),i=t.filter(s=>s);if(t===this.input){for(let s of this.tooltipViews)s.update&&s.update(e);return!1}let r=[];for(let s=0;s<i.length;s++){let o=i[s],l=-1;if(!!o){for(let a=0;a<this.tooltips.length;a++){let u=this.tooltips[a];u&&u.create==o.create&&(l=a)}if(l<0)r[s]=this.createTooltipView(o);else{let a=r[s]=this.tooltipViews[l];a.update&&a.update(e)}}}for(let s of this.tooltipViews)r.indexOf(s)<0&&s.dom.remove();return this.input=t,this.tooltips=i,this.tooltipViews=r,!0}}function vT(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const rf=Y.define({combine:n=>{var e,t,i;return{position:gT?"absolute":((e=n.find(r=>r.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=n.find(r=>r.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((i=n.find(r=>r.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||vT}}}),Z1=Ve.fromClass(class{constructor(n){var e;this.view=n,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let t=n.state.facet(rf);this.position=t.position,this.parent=t.parent,this.classes=n.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new Q1(n,Lh,i=>this.createTooltip(i)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(i=>{Date.now()>this.lastTransaction-50&&i.length>0&&i[i.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(e=n.dom.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let n of this.manager.tooltipViews)this.intersectionObserver.observe(n.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(n){n.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(n);e&&this.observeIntersection();let t=e||n.geometryChanged,i=n.state.facet(rf);if(i.position!=this.position){this.position=i.position;for(let r of this.manager.tooltipViews)r.dom.style.position=this.position;t=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let r of this.manager.tooltipViews)this.container.appendChild(r.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(n){let e=n.create(this.view);if(e.dom.classList.add("cm-tooltip"),n.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top=nf,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var n,e;(n=this.view.dom.ownerDocument.defaultView)===null||n===void 0||n.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let n=this.view.dom.getBoundingClientRect();return{editor:n,parent:this.parent?this.container.getBoundingClientRect():n,pos:this.manager.tooltips.map(e=>this.view.coordsAtPos(e.pos)),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(rf).tooltipSpace(this.view)}}writeMeasure(n){let{editor:e,space:t}=n,i=[];for(let r=0;r<this.manager.tooltips.length;r++){let s=this.manager.tooltips[r],o=this.manager.tooltipViews[r],{dom:l}=o,a=n.pos[r],u=n.size[r];if(!a||a.bottom<=Math.max(e.top,t.top)||a.top>=Math.min(e.bottom,t.bottom)||a.right<Math.max(e.left,t.left)-.1||a.left>Math.min(e.right,t.right)+.1){l.style.top=nf;continue}let h=s.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,c=h?7:0,f=u.right-u.left,d=u.bottom-u.top,m=o.offset||CT,w=this.view.textDirection==fe.LTR,v=u.width>t.right-t.left?w?t.left:t.right-u.width:w?Math.min(a.left-(h?14:0)+m.x,t.right-f):Math.max(t.left,a.left-f+(h?14:0)-m.x),p=!!s.above;!s.strictSide&&(p?a.top-(u.bottom-u.top)-m.y<t.top:a.bottom+(u.bottom-u.top)+m.y>t.bottom)&&p==t.bottom-a.bottom>a.top-t.top&&(p=!p);let y=p?a.top-d-c-m.y:a.bottom+c+m.y,C=v+f;if(o.overlap!==!0)for(let b of i)b.left<C&&b.right>v&&b.top<y+d&&b.bottom>y&&(y=p?b.top-d-2-c:b.bottom+c+2);this.position=="absolute"?(l.style.top=y-n.parent.top+"px",l.style.left=v-n.parent.left+"px"):(l.style.top=y+"px",l.style.left=v+"px"),h&&(h.style.left=`${a.left+(w?m.x:-m.x)-(v+14-7)}px`),o.overlap!==!0&&i.push({left:v,top:y,right:C,bottom:y+d}),l.classList.toggle("cm-tooltip-above",p),l.classList.toggle("cm-tooltip-below",!p),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let n of this.manager.tooltipViews)n.dom.style.top=nf}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),yT=J.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:`${7}px`,width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:`${7}px solid transparent`,borderRight:`${7}px solid transparent`},".cm-tooltip-above &":{bottom:`-${7}px`,"&:before":{borderTop:`${7}px solid #bbb`},"&:after":{borderTop:`${7}px solid #f5f5f5`,bottom:"1px"}},".cm-tooltip-below &":{top:`-${7}px`,"&:before":{borderBottom:`${7}px solid #bbb`},"&:after":{borderBottom:`${7}px solid #f5f5f5`,top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),CT={x:0,y:0},Lh=Y.define({enables:[Z1,yT]}),th=Y.define();class Tm{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new Q1(e,th,t=>this.createHostedView(t))}static create(e){return new Tm(e)}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned()}update(e){this.manager.update(e)}}const ST=Lh.compute([th],n=>{let e=n.facet(th).filter(t=>t);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.filter(t=>t.end!=null).map(t=>t.end)),create:Tm.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class wT{constructor(e,t,i,r,s){this.view=e,this.source=t,this.field=i,this.setHover=r,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){var e;clearTimeout(this.restartTimeout);let{lastMove:t}=this,i=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(i==null)return;let r=this.view.coordsAtPos(i);if(r==null||t.y<r.top||t.y>r.bottom||t.x<r.left-this.view.defaultCharacterWidth||t.x>r.right+this.view.defaultCharacterWidth)return;let s=this.view.bidiSpans(this.view.state.doc.lineAt(i)).find(a=>a.from<=i&&a.to>=i),o=s&&s.dir==fe.RTL?-1:1,l=this.source(this.view,i,t.x<r.left?-o:o);if((e=l)===null||e===void 0?void 0:e.then){let a=this.pending={pos:i};l.then(u=>{this.pending==a&&(this.pending=null,u&&this.view.dispatch({effects:this.setHover.of(u)}))},u=>Ht(this.view.state,u,"hover tooltip"))}else l&&this.view.dispatch({effects:this.setHover.of(l)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!xT(this.lastMove.target)||this.pending){let{pos:r}=i||this.pending,s=(t=i==null?void 0:i.end)!==null&&t!==void 0?t:r;(r==s?this.view.posAtCoords(this.lastMove)!=r:!bT(this.view,r,s,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function xT(n){for(let e=n;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function bT(n,e,t,i,r,s){let o=document.createRange(),l=n.domAtPos(e),a=n.domAtPos(t);o.setEnd(a.node,a.offset),o.setStart(l.node,l.offset);let u=o.getClientRects();o.detach();for(let h=0;h<u.length;h++){let c=u[h];if(Math.max(c.top-r,r-c.bottom,c.left-i,i-c.right)<=s)return!0}return!1}function ET(n,e={}){let t=ie.define(),i=Ye.define({create(){return null},update(r,s){if(r&&e.hideOnChange&&(s.docChanged||s.selection))return null;for(let o of s.effects){if(o.is(t))return o.value;if(o.is(OT))return null}if(r&&s.docChanged){let o=s.changes.mapPos(r.pos,-1,Ct.TrackDel);if(o==null)return null;let l=Object.assign(Object.create(null),r);return l.pos=o,r.end!=null&&(l.end=s.changes.mapPos(r.end)),l}return r},provide:r=>th.from(r)});return[i,Ve.define(r=>new wT(r,n,i,t,e.hoverTime||300)),ST]}function kT(n,e){let t=n.plugin(Z1);if(!t)return null;let i=t.manager.tooltips.indexOf(e);return i<0?null:t.manager.tooltipViews[i]}const OT=ie.define();class _T{constructor(e,t,i){this.state=e,this.pos=t,this.explicit=i,this.abortListeners=[]}tokenBefore(e){let t=Rt(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),r=t.text.slice(i-t.from,this.pos-t.from),s=r.search(ex(e,!1));return s<0?null:{from:i+s,to:this.pos,text:r.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t){e=="abort"&&this.abortListeners&&this.abortListeners.push(t)}}function F0(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function PT(n){let e=Object.create(null),t=Object.create(null);for(let{label:r}of n){e[r[0]]=!0;for(let s=1;s<r.length;s++)t[r[s]]=!0}let i=F0(e)+F0(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function TT(n){let e=n.map(r=>typeof r=="string"?{label:r}:r),[t,i]=e.every(r=>/^\w+$/.test(r.label))?[/\w*$/,/\w+$/]:PT(e);return r=>{let s=r.matchBefore(i);return s||r.explicit?{from:s?s.from:r.pos,options:e,span:t}:null}}class V0{constructor(e,t,i){this.completion=e,this.source=t,this.match=i}}function Er(n){return n.selection.main.head}function ex(n,e){var t;let{source:i}=n,r=e&&i[0]!="^",s=i[i.length-1]!="$";return!r&&!s?n:new RegExp(`${r?"^":""}(?:${i})${s?"$":""}`,(t=n.flags)!==null&&t!==void 0?t:n.ignoreCase?"i":"")}const AT=Ki.define();function tx(n,e){let t=e.completion.apply||e.completion.label,i=e.source;typeof t=="string"?n.dispatch({changes:{from:i.from,to:i.to,insert:t},selection:{anchor:i.from+t.length},userEvent:"input.complete",annotations:AT.of(e.completion)}):t(n,e.completion,i.from,i.to)}const W0=new WeakMap;function NT(n){if(!Array.isArray(n))return n;let e=W0.get(n);return e||W0.set(n,e=TT(n)),e}class IT{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){let i=at(e,t),r=Yt(i);this.chars.push(i);let s=e.slice(t,t+r),o=s.toUpperCase();this.folded.push(at(o==s?s.toLowerCase():o,0)),t+=r}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:r,precise:s,byWord:o}=this;if(t.length==1){let y=at(e,0);return y==t[0]?[0,0,Yt(y)]:y==i[0]?[-200,0,Yt(y)]:null}let l=e.indexOf(this.pattern);if(l==0)return[0,0,this.pattern.length];let a=t.length,u=0;if(l<0){for(let y=0,C=Math.min(e.length,200);y<C&&u<a;){let b=at(e,y);(b==t[u]||b==i[u])&&(r[u++]=y),y+=Yt(b)}if(u<a)return null}let h=0,c=0,f=!1,d=0,m=-1,w=-1,v=/[a-z]/.test(e),p=!0;for(let y=0,C=Math.min(e.length,200),b=0;y<C&&c<a;){let _=at(e,y);l<0&&(h<a&&_==t[h]&&(s[h++]=y),d<a&&(_==t[d]||_==i[d]?(d==0&&(m=y),w=y+1,d++):d=0));let O,R=_<255?_>=48&&_<=57||_>=97&&_<=122?2:_>=65&&_<=90?1:0:(O=om(_))!=O.toLowerCase()?1:O!=O.toUpperCase()?2:0;(!y||R==1&&v||b==0&&R!=0)&&(t[c]==_||i[c]==_&&(f=!0)?o[c++]=y:o.length&&(p=!1)),b=R,y+=Yt(_)}return c==a&&o[0]==0&&p?this.result(-100+(f?-200:0),o,e):d==a&&m==0?[-200-e.length,0,w]:l>-1?[-700-e.length,l,l+this.pattern.length]:d==a?[-200+-700-e.length,m,w]:c==a?this.result(-100+(f?-200:0)+-700+(p?0:-1100),o,e):t.length==2?null:this.result((r[0]?-700:0)+-200+-1100,r,e)}result(e,t,i){let r=[e-i.length],s=1;for(let o of t){let l=o+(this.astral?Yt(at(i,o)):1);s>1&&r[s-1]==o?r[s-1]=l:(r[s++]=o,r[s++]=l)}return r}}const kr=Y.define({combine(n){return Ji(n,{activateOnTyping:!0,override:null,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,t)=>e&&t,icons:(e,t)=>e&&t,optionClass:(e,t)=>i=>DT(e(i),t(i)),addToOptions:(e,t)=>e.concat(t)})}});function DT(n,e){return n?e?n+" "+e:n:e}function RT(n){let e=n.addToOptions.slice();return n.icons&&e.push({render(t){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),t.type&&i.classList.add(...t.type.split(/\s+/g).map(r=>"cm-completionIcon-"+r)),i.setAttribute("aria-hidden","true"),i},position:20}),e.push({render(t,i,r){let s=document.createElement("span");s.className="cm-completionLabel";let{label:o}=t,l=0;for(let a=1;a<r.length;){let u=r[a++],h=r[a++];u>l&&s.appendChild(document.createTextNode(o.slice(l,u)));let c=s.appendChild(document.createElement("span"));c.appendChild(document.createTextNode(o.slice(u,h))),c.className="cm-completionMatchedText",l=h}return l<o.length&&s.appendChild(document.createTextNode(o.slice(l))),s},position:50},{render(t){if(!t.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=t.detail,i},position:80}),e.sort((t,i)=>t.position-i.position).map(t=>t.render)}function LT(n,e){let t=document.createElement("div");t.className="cm-tooltip cm-completionInfo";let{info:i}=n.completion;if(typeof i=="string")t.textContent=i;else{let r=i(n.completion);r.then?r.then(s=>t.appendChild(s),s=>Ht(e.state,s,"completion info")):t.appendChild(r)}return t}function B0(n,e,t){if(n<=t)return{from:0,to:n};if(e<=n>>1){let r=Math.floor(e/t);return{from:r*t,to:(r+1)*t}}let i=Math.floor((n-e)/t);return{from:n-(i+1)*t,to:n-i*t}}class MT{constructor(e,t){this.view=e,this.stateField=t,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:l=>this.positionInfo(l),key:this};let i=e.state.field(t),{options:r,selected:s}=i.open,o=e.state.facet(kr);this.optionContent=RT(o),this.optionClass=o.optionClass,this.range=B0(r.length,s,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",l=>{for(let a=l.target,u;a&&a!=this.dom;a=a.parentNode)if(a.nodeName=="LI"&&(u=/-(\d+)$/.exec(a.id))&&+u[1]<r.length){tx(e,r[+u[1]]),l.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(r,i.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=B0(t.options.length,t.selected,this.view.state.facet(kr).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(t.selected)){this.info&&(this.info.remove(),this.info=null);let i=t.options[t.selected];i.completion.info&&(this.info=this.dom.appendChild(LT(i,this.view)),this.view.requestMeasure(this.placeInfo))}}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,r=this.range.from;i;i=i.nextSibling,r++)r==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return t&&VT(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),r=e.getBoundingClientRect();if(r.top>Math.min(innerHeight,t.bottom)-10||r.bottom<Math.max(0,t.top)+10)return null;let s=Math.max(0,Math.min(r.top,innerHeight-i.height))-t.top,o=this.view.textDirection==fe.RTL,l=t.left,a=innerWidth-t.right;return o&&l<Math.min(i.width,a)?o=!1:!o&&a<Math.min(i.width,l)&&(o=!0),{top:s,left:o}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,t,i){const r=document.createElement("ul");r.id=t,r.setAttribute("role","listbox");for(let s=i.from;s<i.to;s++){let{completion:o,match:l}=e[s];const a=r.appendChild(document.createElement("li"));a.id=t+"-"+s,a.setAttribute("role","option");let u=this.optionClass(o);u&&(a.className=u);for(let h of this.optionContent){let c=h(o,this.view.state,l);c&&a.appendChild(c)}}return i.from&&r.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&r.classList.add("cm-completionListIncompleteBottom"),r}}function FT(n){return e=>new MT(e,n)}function VT(n,e){let t=n.getBoundingClientRect(),i=e.getBoundingClientRect();i.top<t.top?n.scrollTop-=t.top-i.top:i.bottom>t.bottom&&(n.scrollTop+=i.bottom-t.bottom)}const WT=300;function j0(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function BT(n,e){let t=[],i=0;for(let o of n)if(o.hasResult())if(o.result.filter===!1)for(let l of o.result.options)t.push(new V0(l,o,[1e9-i++]));else{let l=new IT(e.sliceDoc(o.from,o.to)),a;for(let u of o.result.options)(a=l.match(u.label))&&(u.boost!=null&&(a[0]+=u.boost),t.push(new V0(u,o,a)))}t.sort(G0);let r=[],s=null;for(let o of t.sort(G0)){if(r.length==WT)break;!s||s.label!=o.completion.label||s.detail!=o.completion.detail||s.type!=o.completion.type||s.apply!=o.completion.apply?r.push(o):j0(o.completion)>j0(s)&&(r[r.length-1]=o),s=o.completion}return r}class el{constructor(e,t,i,r,s){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=r,this.selected=s}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new el(this.options,$0(t,e),this.tooltip,this.timestamp,e)}static build(e,t,i,r,s){let o=BT(e,t);if(!o.length)return null;let l=0;if(r&&r.selected){let a=r.options[r.selected].completion;for(let u=0;u<o.length&&!l;u++)o[u].completion==a&&(l=u)}return new el(o,$0(i,l),{pos:e.reduce((a,u)=>u.hasResult()?Math.min(a,u.from):a,1e8),create:FT(fn),above:s.aboveCursor},r?r.timestamp:Date.now(),l)}map(e){return new el(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class nh{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new nh(GT,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,i=t.facet(kr),s=(i.override||t.languageDataAt("autocomplete",Er(t)).map(NT)).map(l=>(this.active.find(u=>u.source==l)||new Pt(l,this.active.some(u=>u.state!=0)?1:0)).update(e,i));s.length==this.active.length&&s.every((l,a)=>l==this.active[a])&&(s=this.active);let o=e.selection||s.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!jT(s,this.active)?el.build(s,t,this.id,this.open,i):this.open&&e.docChanged?this.open.map(e.changes):this.open;!o&&s.every(l=>l.state!=1)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new Pt(l.source,0):l));for(let l of e.effects)l.is(ix)&&(o=o&&o.setSelected(l.value,this.id));return s==this.active&&o==this.open?this:new nh(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:$T}}function jT(n,e){if(n==e)return!0;for(let t=0,i=0;;){for(;t<n.length&&!n[t].hasResult;)t++;for(;i<e.length&&!e[i].hasResult;)i++;let r=t==n.length,s=i==e.length;if(r||s)return r==s;if(n[t++].result!=e[i++].result)return!1}}const $T={"aria-autocomplete":"list","aria-expanded":"false"};function $0(n,e){return{"aria-autocomplete":"list","aria-expanded":"true","aria-activedescendant":n+"-"+e,"aria-controls":n}}const GT=[];function G0(n,e){let t=e.match[0]-n.match[0];return t||n.completion.label.localeCompare(e.completion.label)}function np(n){return n.isUserEvent("input.type")?"input":n.isUserEvent("delete.backward")?"delete":null}class Pt{constructor(e,t,i=-1){this.source=e,this.state=t,this.explicitPos=i}hasResult(){return!1}update(e,t){let i=np(e),r=this;i?r=r.handleUserEvent(e,i,t):e.docChanged?r=r.handleChange(e):e.selection&&r.state!=0&&(r=new Pt(r.source,0));for(let s of e.effects)if(s.is(Am))r=new Pt(r.source,1,s.value?Er(e.state):-1);else if(s.is(Nm))r=new Pt(r.source,0);else if(s.is(nx))for(let o of s.value)o.source==r.source&&(r=o);return r}handleUserEvent(e,t,i){return t=="delete"||!i.activateOnTyping?this.map(e.changes):new Pt(this.source,1)}handleChange(e){return e.changes.touchesRange(Er(e.startState))?new Pt(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Pt(this.source,this.state,e.mapPos(this.explicitPos))}}class ih extends Pt{constructor(e,t,i,r,s,o){super(e,2,t);this.result=i,this.from=r,this.to=s,this.span=o}hasResult(){return!0}handleUserEvent(e,t,i){let r=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),o=Er(e.state);if((this.explicitPos<0?o<=r:o<this.from)||o>s||t=="delete"&&Er(e.startState)==this.from)return new Pt(this.source,t=="input"&&i.activateOnTyping?1:0);let l=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);return this.span&&(r==s||this.span.test(e.state.sliceDoc(r,s)))?new ih(this.source,l,this.result,r,s,this.span):new Pt(this.source,1,l)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new Pt(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new ih(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1),this.span)}}const Am=ie.define(),Nm=ie.define(),nx=ie.define({map(n,e){return n.map(t=>t.map(e))}}),ix=ie.define(),fn=Ye.define({create(){return nh.start()},update(n,e){return n.update(e)},provide:n=>[Lh.from(n,e=>e.tooltip),J.contentAttributes.from(n,e=>e.attrs)]}),rx=75;function _a(n,e="option"){return t=>{let i=t.state.field(fn,!1);if(!i||!i.open||Date.now()-i.open.timestamp<rx)return!1;let r=1,s;e=="page"&&(s=kT(t,i.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let o=i.open.selected+r*(n?1:-1),{length:l}=i.open.options;return o<0?o=e=="page"?0:l-1:o>=l&&(o=e=="page"?l-1:0),t.dispatch({effects:ix.of(o)}),!0}}const HT=n=>{let e=n.state.field(fn,!1);return n.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<rx?!1:(tx(n,e.open.options[e.open.selected]),!0)},zT=n=>n.state.field(fn,!1)?(n.dispatch({effects:Am.of(!0)}),!0):!1,UT=n=>{let e=n.state.field(fn,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(n.dispatch({effects:Nm.of(null)}),!0)};class qT{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const H0=50,KT=50,JT=1e3,YT=Ve.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of n.state.field(fn).active)e.state==1&&this.startQuery(e)}update(n){let e=n.state.field(fn);if(!n.selectionSet&&!n.docChanged&&n.startState.field(fn)==e)return;let t=n.transactions.some(i=>(i.selection||i.docChanged)&&!np(i));for(let i=0;i<this.running.length;i++){let r=this.running[i];if(t||r.updates.length+n.transactions.length>KT&&r.time-Date.now()>JT){for(let s of r.context.abortListeners)try{s()}catch(o){Ht(this.view.state,o)}r.context.abortListeners=null,this.running.splice(i--,1)}else r.updates.push(...n.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(i=>i.state==1&&!this.running.some(r=>r.active.source==i.source))?setTimeout(()=>this.startUpdate(),H0):-1,this.composing!=0)for(let i of n.transactions)np(i)=="input"?this.composing=2:this.composing==2&&i.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:n}=this.view,e=n.field(fn);for(let t of e.active)t.state==1&&!this.running.some(i=>i.active.source==t.source)&&this.startQuery(t)}startQuery(n){let{state:e}=this.view,t=Er(e),i=new _T(e,t,n.explicitPos==t),r=new qT(n,i);this.running.push(r),Promise.resolve(n.source(i)).then(s=>{r.context.aborted||(r.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:Nm.of(null)}),Ht(this.view.state,s)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),H0))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(kr);for(let i=0;i<this.running.length;i++){let r=this.running[i];if(r.done===void 0)continue;if(this.running.splice(i--,1),r.done){let o=new ih(r.active.source,r.active.explicitPos,r.done,r.done.from,(n=r.done.to)!==null&&n!==void 0?n:Er(r.updates.length?r.updates[0].startState:this.view.state),r.done.span&&r.done.filter!==!1?ex(r.done.span,!0):null);for(let l of r.updates)o=o.update(l,t);if(o.hasResult()){e.push(o);continue}}let s=this.view.state.field(fn).active.find(o=>o.source==r.active.source);if(s&&s.state==1)if(r.done==null){let o=new Pt(r.active.source,0);for(let l of r.updates)o=o.update(l,t);o.state!=1&&e.push(o)}else this.startQuery(s)}e.length&&this.view.dispatch({effects:nx.of(e)})}},{eventHandlers:{compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Am.of(!1)}),20),this.composing=0}}}),XT=J.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});function QT(n={}){return[fn,kr.of(n),YT,ZT,XT]}const sx=[{key:"Ctrl-Space",run:zT},{key:"Escape",run:UT},{key:"ArrowDown",run:_a(!0)},{key:"ArrowUp",run:_a(!1)},{key:"PageDown",run:_a(!0,"page")},{key:"PageUp",run:_a(!1,"page")},{key:"Enter",run:HT}],ZT=Rl.highest(Eh.computeN([kr],n=>n.facet(kr).defaultKeymap?[sx]:[])),eA=n=>{let e=Dm(n.state);return e.line?tA(n):e.block?iA(n):!1};function Im(n,e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let r=n(e,t);return r?(i(t.update(r)),!0):!1}}const tA=Im(lA,0),nA=Im(ox,0),iA=Im((n,e)=>ox(n,e,oA(e)),0),rA=[{key:"Mod-/",run:eA},{key:"Alt-A",run:nA}];function Dm(n,e=n.selection.main.head){let t=n.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const go=50;function sA(n,{open:e,close:t},i,r){let s=n.sliceDoc(i-go,i),o=n.sliceDoc(r,r+go),l=/\s*$/.exec(s)[0].length,a=/^\s*/.exec(o)[0].length,u=s.length-l;if(s.slice(u-e.length,u)==e&&o.slice(a,a+t.length)==t)return{open:{pos:i-l,margin:l&&1},close:{pos:r+a,margin:a&&1}};let h,c;r-i<=2*go?h=c=n.sliceDoc(i,r):(h=n.sliceDoc(i,i+go),c=n.sliceDoc(r-go,r));let f=/^\s*/.exec(h)[0].length,d=/\s*$/.exec(c)[0].length,m=c.length-d-t.length;return h.slice(f,f+e.length)==e&&c.slice(m,m+t.length)==t?{open:{pos:i+f+e.length,margin:/\s/.test(h.charAt(f+e.length))?1:0},close:{pos:r-d-t.length,margin:/\s/.test(c.charAt(m-1))?1:0}}:null}function oA(n){let e=[];for(let t of n.selection.ranges){let i=n.doc.lineAt(t.from),r=t.to<=i.to?i:n.doc.lineAt(t.to),s=e.length-1;s>=0&&e[s].to>i.from?e[s].to=r.to:e.push({from:i.from,to:r.to})}return e}function ox(n,e,t=e.selection.ranges){let i=t.map(s=>Dm(e,s.from).block);if(!i.every(s=>s))return null;let r=t.map((s,o)=>sA(e,i[o],s.from,s.to));if(n!=2&&!r.every(s=>s))return{changes:e.changes(t.map((s,o)=>r[o]?[]:[{from:s.from,insert:i[o].open+" "},{from:s.to,insert:" "+i[o].close}]))};if(n!=1&&r.some(s=>s)){let s=[];for(let o=0,l;o<r.length;o++)if(l=r[o]){let a=i[o],{open:u,close:h}=l;s.push({from:u.pos-a.open.length,to:u.pos+u.margin},{from:h.pos-h.margin,to:h.pos+a.close.length})}return{changes:s}}return null}function lA(n,e,t=e.selection.ranges){let i=[],r=-1;for(let{from:s,to:o}of t){let l=i.length,a=1e9;for(let u=s;u<=o;){let h=e.doc.lineAt(u);if(h.from>r&&(s==o||o>h.from)){r=h.from;let c=Dm(e,u).line;if(!c)continue;let f=/^\s*/.exec(h.text)[0].length,d=f==h.length,m=h.text.slice(f,f+c.length)==c?f:-1;f<h.text.length&&f<a&&(a=f),i.push({line:h,comment:m,token:c,indent:f,empty:d,single:!1})}u=h.to+1}if(a<1e9)for(let u=l;u<i.length;u++)i[u].indent<i[u].line.text.length&&(i[u].indent=a);i.length==l+1&&(i[l].single=!0)}if(n!=2&&i.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:a,indent:u,empty:h,single:c}of i)(c||!h)&&s.push({from:l.from+u,insert:a+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(n!=1&&i.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:l,token:a}of i)if(l>=0){let u=o.from+l,h=u+a.length;o.text[h-o.from]==" "&&h++,s.push({from:u,to:h})}return{changes:s}}return null}const ip=2e3;function aA(n,e,t){let i=Math.min(e.line,t.line),r=Math.max(e.line,t.line),s=[];if(e.off>ip||t.off>ip||e.col<0||t.col<0){let o=Math.min(e.off,t.off),l=Math.max(e.off,t.off);for(let a=i;a<=r;a++){let u=n.doc.line(a);u.length<=l&&s.push(F.range(u.from+o,u.to+l))}}else{let o=Math.min(e.col,t.col),l=Math.max(e.col,t.col);for(let a=i;a<=r;a++){let u=n.doc.line(a),h=gd(u.text,o,n.tabSize,!0);if(h>-1){let c=gd(u.text,l,n.tabSize);s.push(F.range(u.from+h,u.from+c))}}}return s}function uA(n,e){let t=n.coordsAtPos(n.viewport.from);return t?Math.round(Math.abs((t.left-e)/n.defaultCharacterWidth)):-1}function z0(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1),i=n.state.doc.lineAt(t),r=t-i.from,s=r>ip?-1:r==i.length?uA(n,e.clientX):Dl(i.text,n.state.tabSize,t-i.from);return{line:i.number,col:s,off:r}}function hA(n,e){let t=z0(n,e),i=n.state.selection;return t?{update(r){if(r.docChanged){let s=r.changes.mapPos(r.startState.doc.line(t.line).from),o=r.state.doc.lineAt(s);t={line:o.number,col:t.col,off:Math.min(t.off,o.length)},i=i.map(r.changes)}},get(r,s,o){let l=z0(n,r);if(!l)return i;let a=aA(n.state,t,l);return a.length?o?F.create(a.concat(i.ranges)):F.create(a):i}}:null}function cA(n){let e=(n==null?void 0:n.eventFilter)||(t=>t.altKey&&t.button==0);return J.mouseSelectionStyle.of((t,i)=>e(i)?hA(t,i):null)}let fA=0;class En{constructor(e,t,i){this.set=e,this.base=t,this.modified=i,this.id=fA++}static define(e){if(e==null?void 0:e.base)throw new Error("Can not derive from a modified tag");let t=new En([],null,[]);if(t.set.push(t),e)for(let i of e.set)t.set.push(i);return t}static defineModifier(){let e=new rh;return t=>t.modified.indexOf(e)>-1?t:rh.get(t.base||t,t.modified.concat(e).sort((i,r)=>i.id-r.id))}}let dA=0;class rh{constructor(){this.instances=[],this.id=dA++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(l=>l.base==e&&pA(t,l.modified));if(i)return i;let r=[],s=new En(r,e,t);for(let l of t)l.instances.push(s);let o=lx(t);for(let l of e.set)for(let a of o)r.push(rh.get(l,a));return s}}function pA(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function lx(n){let e=[n];for(let t=0;t<n.length;t++)for(let i of lx(n.slice(0,t).concat(n.slice(t+1))))e.push(i);return e}const mA=new ue,Rm=Y.define({combine(n){return n.length?js.combinedMatch(n):null}}),ax=Y.define({combine(n){return n.length?n[0].match:null}});function rp(n){return n.facet(Rm)||n.facet(ax)}class js{constructor(e,t){this.map=Object.create(null);let i;function r(o){let l=$i.newName();return(i||(i=Object.create(null)))["."+l]=o,l}this.all=typeof t.all=="string"?t.all:t.all?r(t.all):null;for(let o of e){let l=(o.class||r(Object.assign({},o,{tag:null})))+(this.all?" "+this.all:""),a=o.tag;if(!Array.isArray(a))this.map[a.id]=l;else for(let u of a)this.map[u.id]=l}this.module=i?new $i(i):null,this.scope=t.scope||null,this.match=this.match.bind(this);let s=[vA];this.module&&s.push(J.styleModule.of(this.module)),this.extension=s.concat(Rm.of(this)),this.fallback=s.concat(ax.of(this))}match(e,t){if(this.scope&&t!=this.scope)return null;for(let i of e.set){let r=this.map[i.id];if(r!==void 0)return i!=e&&(this.map[e.id]=r),r}return this.map[e.id]=this.all}static combinedMatch(e){if(e.length==1)return e[0].match;let t=e.some(i=>i.scope)?void 0:Object.create(null);return(i,r)=>{let s=t&&t[i.id];if(s!==void 0)return s;let o=null;for(let l of e){let a=l.match(i,r);a&&(o=o?o+" "+a:a)}return t&&(t[i.id]=o),o}}static define(e,t){return new js(e,t||{})}static get(e,t,i){let r=rp(e);return r&&r(t,i||pn.none)}}class gA{constructor(e){this.markCache=Object.create(null),this.tree=Rt(e.state),this.decorations=this.buildDeco(e,rp(e.state))}update(e){let t=Rt(e.state),i=rp(e.state),r=i!=e.startState.facet(Rm);t.length<e.view.viewport.to&&!r&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||r)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i))}buildDeco(e,t){if(!t||!this.tree.length)return Z.none;let i=new Gi;for(let{from:r,to:s}of e.visibleRanges)CA(this.tree,r,s,t,(o,l,a)=>{i.add(o,l,this.markCache[a]||(this.markCache[a]=Z.mark({class:a})))});return i.finish()}}const vA=Rl.high(Ve.fromClass(gA,{decorations:n=>n.decorations})),U0=[""];class yA{constructor(e,t,i){this.at=e,this.style=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,s,o){let{type:l,from:a,to:u}=e;if(a>=i||u<=t)return;U0[s]=l.name,l.isTop&&(o=l);let h=r,c=l.prop(mA),f=!1;for(;c;){if(!c.context||SA(c.context,U0,s)){for(let m of c.tags){let w=this.style(m,o);w&&(h&&(h+=" "),h+=w,c.mode==1?r+=(r?" ":"")+w:c.mode==0&&(f=!0))}break}c=c.next}if(this.startSpan(e.from,h),f)return;let d=e.tree&&e.tree.prop(ue.mounted);if(d&&d.overlay){let m=e.node.enter(d.overlay[0].from+a,1),w=e.firstChild();for(let v=0,p=a;;v++){let y=v<d.overlay.length?d.overlay[v]:null,C=y?y.from+a:u,b=Math.max(t,p),_=Math.min(i,C);if(b<_&&w)for(;e.from<_&&(this.highlightRange(e,b,_,r,s+1,o),this.startSpan(Math.min(i,e.to),h),!(e.to>=C||!e.nextSibling())););if(!y||C>i)break;p=y.to+a,p>t&&(this.highlightRange(m.cursor,Math.max(t,y.from+a),Math.min(i,p),r,s,d.tree.type),this.startSpan(p,h))}w&&e.parent()}else if(e.firstChild()){do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,s+1,o),this.startSpan(Math.min(i,e.to),h)}while(e.nextSibling());e.parent()}}}function CA(n,e,t,i,r){let s=new yA(e,i,r);s.highlightRange(n.cursor(),e,t,"",0,n.type),s.flush(t)}function SA(n,e,t){if(n.length>t-1)return!1;for(let i=t-1,r=n.length-1;r>=0;r--,i--){let s=n[r];if(s&&s!=e[i])return!1}return!0}const B=En.define,Pa=B(),vi=B(),q0=B(vi),K0=B(vi),yi=B(),Ta=B(yi),sf=B(yi),bn=B(),er=B(bn),vn=B(),yn=B(),sp=B(),vo=B(sp),Aa=B(),I={comment:Pa,lineComment:B(Pa),blockComment:B(Pa),docComment:B(Pa),name:vi,variableName:B(vi),typeName:q0,tagName:B(q0),propertyName:K0,attributeName:B(K0),className:B(vi),labelName:B(vi),namespace:B(vi),macroName:B(vi),literal:yi,string:Ta,docString:B(Ta),character:B(Ta),attributeValue:B(Ta),number:sf,integer:B(sf),float:B(sf),bool:B(yi),regexp:B(yi),escape:B(yi),color:B(yi),url:B(yi),keyword:vn,self:B(vn),null:B(vn),atom:B(vn),unit:B(vn),modifier:B(vn),operatorKeyword:B(vn),controlKeyword:B(vn),definitionKeyword:B(vn),moduleKeyword:B(vn),operator:yn,derefOperator:B(yn),arithmeticOperator:B(yn),logicOperator:B(yn),bitwiseOperator:B(yn),compareOperator:B(yn),updateOperator:B(yn),definitionOperator:B(yn),typeOperator:B(yn),controlOperator:B(yn),punctuation:sp,separator:B(sp),bracket:vo,angleBracket:B(vo),squareBracket:B(vo),paren:B(vo),brace:B(vo),content:bn,heading:er,heading1:B(er),heading2:B(er),heading3:B(er),heading4:B(er),heading5:B(er),heading6:B(er),contentSeparator:B(bn),list:B(bn),quote:B(bn),emphasis:B(bn),strong:B(bn),link:B(bn),monospace:B(bn),strikethrough:B(bn),inserted:B(),deleted:B(),changed:B(),invalid:B(),meta:Aa,documentMeta:B(Aa),annotation:B(Aa),processingInstruction:B(Aa),definition:En.defineModifier(),constant:En.defineModifier(),function:En.defineModifier(),standard:En.defineModifier(),local:En.defineModifier(),special:En.defineModifier()},wA=js.define([{tag:I.link,textDecoration:"underline"},{tag:I.heading,textDecoration:"underline",fontWeight:"bold"},{tag:I.emphasis,fontStyle:"italic"},{tag:I.strong,fontWeight:"bold"},{tag:I.strikethrough,textDecoration:"line-through"},{tag:I.keyword,color:"#708"},{tag:[I.atom,I.bool,I.url,I.contentSeparator,I.labelName],color:"#219"},{tag:[I.literal,I.inserted],color:"#164"},{tag:[I.string,I.deleted],color:"#a11"},{tag:[I.regexp,I.escape,I.special(I.string)],color:"#e40"},{tag:I.definition(I.variableName),color:"#00f"},{tag:I.local(I.variableName),color:"#30a"},{tag:[I.typeName,I.namespace],color:"#085"},{tag:I.className,color:"#167"},{tag:[I.special(I.variableName),I.macroName],color:"#256"},{tag:I.definition(I.propertyName),color:"#00c"},{tag:I.comment,color:"#940"},{tag:I.meta,color:"#7a757a"},{tag:I.invalid,color:"#f00"}]);I.link,I.heading,I.emphasis,I.strong,I.keyword,I.atom,I.bool,I.url,I.labelName,I.inserted,I.deleted,I.literal,I.string,I.number,I.regexp,I.escape,I.string,I.variableName,I.variableName,I.variableName,I.variableName,I.propertyName,I.typeName,I.namespace,I.className,I.macroName,I.propertyName,I.operator,I.comment,I.meta,I.invalid,I.punctuation;class xA{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class ir{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let r=Z.set(e.map(s=>s.from==s.to||s.from==s.to-1&&i.doc.lineAt(s.from).to==s.from?Z.widget({widget:new AA(s),diagnostic:s}).range(s.from):Z.mark({attributes:{class:"cm-lintRange cm-lintRange-"+s.severity},diagnostic:s}).range(s.from,s.to)),!0);return new ir(r,t,Is(r))}}function Is(n,e=null,t=0){let i=null;return n.between(t,1e9,(r,s,{spec:o})=>{if(!(e&&o.diagnostic!=e))return i=new xA(r,s,o.diagnostic),!1}),i}function ux(n,e){return n.field(At,!1)?e:e.concat(ie.appendConfig.of([At,J.decorations.compute([At],t=>{let{selected:i,panel:r}=t.field(At);return!i||!r||i.from==i.to?Z.none:Z.set([EA.range(i.from,i.to)])}),ET(kA),NA]))}function bA(n,e){return{effects:ux(n,[Lm.of(e)])}}const Lm=ie.define(),Mm=ie.define(),hx=ie.define(),At=Ye.define({create(){return new ir(Z.none,null,null)},update(n,e){if(e.docChanged){let t=n.diagnostics.map(e.changes),i=null;if(n.selected){let r=e.changes.mapPos(n.selected.from,1);i=Is(t,n.selected.diagnostic,r)||Is(t,null,r)}n=new ir(t,n.panel,i)}for(let t of e.effects)t.is(Lm)?n=ir.init(t.value,n.panel,e.state):t.is(Mm)?n=new ir(n.diagnostics,t.value?Mh.open:null,n.selected):t.is(hx)&&(n=new ir(n.diagnostics,n.panel,t.value));return n},provide:n=>[bl.from(n,e=>e.panel),J.decorations.from(n,e=>e.diagnostics)]}),EA=Z.mark({class:"cm-lintRange cm-lintRange-active"});function kA(n,e,t){let{diagnostics:i}=n.state.field(At),r=[],s=2e8,o=0;return i.between(e-(t<0?1:0),e+(t>0?1:0),(l,a,{spec:u})=>{e>=l&&e<=a&&(l==a||(e>l||t>0)&&(e<a||t<0))&&(r.push(u.diagnostic),s=Math.min(l,s),o=Math.max(a,o))}),r.length?{pos:s,end:o,above:n.state.doc.lineAt(s).to<o,create(){return{dom:cx(n,r)}}}:null}function cx(n,e){return _e("ul",{class:"cm-tooltip-lint"},e.map(t=>dx(n,t,!1)))}const OA=n=>{let e=n.state.field(At,!1);(!e||!e.panel)&&n.dispatch({effects:ux(n.state,[Mm.of(!0)])});let t=xl(n,Mh.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},J0=n=>{let e=n.state.field(At,!1);return!e||!e.panel?!1:(n.dispatch({effects:Mm.of(!1)}),!0)},_A=n=>{let e=n.state.field(At,!1);if(!e)return!1;let t=n.state.selection.main,i=e.diagnostics.iter(t.to+1);return!i.value&&(i=e.diagnostics.iter(0),!i.value||i.from==t.from&&i.to==t.to)?!1:(n.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)},PA=[{key:"Mod-Shift-m",run:OA},{key:"F8",run:_A}],TA=Ve.fromClass(class{constructor(n){this.view=n,this.timeout=-1,this.set=!0;let{delay:e}=n.state.facet(Vo);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let n=Date.now();if(n<this.lintTime-10)setTimeout(this.run,this.lintTime-n);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(Vo);Promise.all(t.map(i=>Promise.resolve(i(this.view)))).then(i=>{var r,s;let o=i.reduce((l,a)=>l.concat(a));this.view.state.doc==e.doc&&(o.length||((s=(r=this.view.state.field(At,!1))===null||r===void 0?void 0:r.diagnostics)===null||s===void 0?void 0:s.size))&&this.view.dispatch(bA(this.view.state,o))},i=>{Ht(this.view.state,i)})}}update(n){let e=n.state.facet(Vo);(n.docChanged||e!=n.startState.facet(Vo))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),Vo=Y.define({combine(n){return{sources:n.map(e=>e.source),delay:n.length?Math.max(...n.map(e=>e.delay)):750}},enables:TA});function $L(n,e={}){var t;return Vo.of({source:n,delay:(t=e.delay)!==null&&t!==void 0?t:750})}function fx(n){let e=[];if(n)e:for(let{name:t}of n){for(let i=0;i<t.length;i++){let r=t[i];if(/[a-zA-Z]/.test(r)&&!e.some(s=>s.toLowerCase()==r.toLowerCase())){e.push(r);continue e}}e.push("")}return e}function dx(n,e,t){var i;let r=t?fx(e.actions):[];return _e("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},_e("span",{class:"cm-diagnosticText"},e.message),(i=e.actions)===null||i===void 0?void 0:i.map((s,o)=>{let l=c=>{c.preventDefault();let f=Is(n.state.field(At).diagnostics,e);f&&s.apply(n,f.from,f.to)},{name:a}=s,u=r[o]?a.indexOf(r[o]):-1,h=u<0?a:[a.slice(0,u),_e("u",a.slice(u,u+1)),a.slice(u+1)];return _e("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${a}${u<0?"":` (access key "${r[o]})"`}.`},h)}),e.source&&_e("div",{class:"cm-diagnosticSource"},e.source))}class AA extends ti{constructor(e){super();this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return _e("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class Y0{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=dx(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Mh{constructor(e){this.view=e,this.items=[];let t=r=>{if(r.keyCode==27)J0(this.view),this.view.focus();else if(r.keyCode==38||r.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(r.keyCode==40||r.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(r.keyCode==36)this.moveSelection(0);else if(r.keyCode==35)this.moveSelection(this.items.length-1);else if(r.keyCode==13)this.view.focus();else if(r.keyCode>=65&&r.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=fx(s.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==r.keyCode){let a=Is(this.view.state.field(At).diagnostics,s);a&&s.actions[l].apply(e,a.from,a.to)}}else return;r.preventDefault()},i=r=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(r.target)&&this.moveSelection(s)};this.list=_e("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:i}),this.dom=_e("div",{class:"cm-panel-lint"},this.list,_e("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>J0(this.view)},"\xD7")),this.update()}get selectedIndex(){let e=this.view.state.field(At).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(At),i=0,r=!1,s=null;for(e.between(0,this.view.state.doc.length,(o,l,{spec:a})=>{let u=-1,h;for(let c=i;c<this.items.length;c++)if(this.items[c].diagnostic==a.diagnostic){u=c;break}u<0?(h=new Y0(this.view,a.diagnostic),this.items.splice(i,0,h),r=!0):(h=this.items[u],u>i&&(this.items.splice(i,u-i),r=!0)),t&&h.diagnostic==t.diagnostic?h.dom.hasAttribute("aria-selected")||(h.dom.setAttribute("aria-selected","true"),s=h):h.dom.hasAttribute("aria-selected")&&h.dom.removeAttribute("aria-selected"),i++});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();this.items.length==0&&(this.items.push(new Y0(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:l})=>{o.top<l.top?this.list.scrollTop-=l.top-o.top:o.bottom>l.bottom&&(this.list.scrollTop+=o.bottom-l.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let e=this.list.firstChild;function t(){let i=e;e=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(At),i=Is(t.diagnostics,this.items[e].diagnostic);!i||this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:hx.of(i)})}static open(e){return new Mh(e)}}function fu(n,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(n)}</svg>')`}function of(n){return fu(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${n}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const NA=J.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:of("#d11")},".cm-lintRange-warning":{backgroundImage:of("orange")},".cm-lintRange-info":{backgroundImage:of("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});class IA extends Dn{constructor(e){super();this.diagnostics=e,this.severity=e.reduce((t,i)=>{let r=i.severity;return r=="error"||r=="warning"&&t=="info"?r:t},"info")}toDOM(e){let t=document.createElement("div");return t.className="cm-lint-marker cm-lint-marker-"+this.severity,t.onmouseover=()=>RA(e,t,this.diagnostics),t}}function DA(n,e){let t=i=>{let r=e.getBoundingClientRect();if(!(i.clientX>r.left-10&&i.clientX<r.right+10&&i.clientY>r.top-10&&i.clientY<r.bottom+10)){for(let s=i.target;s;s=s.parentNode)if(s.nodeType==1&&s.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",t),n.state.field(mx)&&n.dispatch({effects:Fm.of(null)})}};window.addEventListener("mousemove",t)}function RA(n,e,t){function i(){let s=n.visualLineAtHeight(e.getBoundingClientRect().top+5);const o=n.coordsAtPos(s.from),l=e.getBoundingClientRect();o&&n.dispatch({effects:Fm.of({pos:s.from,above:!1,create(){return{dom:cx(n,t),offset:{x:l.left-o.left,y:0}}}})}),e.onmouseout=e.onmousemove=null,DA(n,e)}let r=setTimeout(i,600);e.onmouseout=()=>{clearTimeout(r),e.onmouseout=e.onmousemove=null},e.onmousemove=()=>{clearTimeout(r),r=setTimeout(i,600)}}function LA(n,e){let t=Object.create(null);for(let r of e){let s=n.lineAt(r.from);(t[s.from]||(t[s.from]=[])).push(r)}let i=[];for(let r in t)i.push(new IA(t[r]).range(+r));return de.of(i,!0)}const MA=Zw({class:"cm-gutter-lint",markers:n=>n.state.field(px)}),px=Ye.define({create(){return de.empty},update(n,e){n=n.map(e.changes);for(let t of e.effects)t.is(Lm)&&(n=LA(e.state.doc,t.value));return n}}),Fm=ie.define(),mx=Ye.define({create(){return null},update(n,e){return n&&e.docChanged&&(n=Object.assign(Object.assign({},n),{pos:e.changes.mapPos(n.pos)})),e.effects.reduce((t,i)=>i.is(Fm)?i.value:t,n)},provide:n=>Lh.from(n)}),FA=J.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:"0 .2em",display:"flex",flexDirection:"column",justifyContent:"center"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:fu('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:fu('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error:before":{content:fu('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}});function GL(){return[px,MA,FA,mx]}const VA=[T_(),I_(),PO(),$O(),$_(),gO(),xO(),ce.allowMultipleSelections.of(!0),y_(),wA.fallback,J_(),RP(),QT(),cA(),RO(),YP(),Eh.of([...VP,...IP,...fT,...XO,...V_,...rA,...sx,...PA])],WA="#e5c07b",X0="#e06c75",BA="#56b6c2",jA="#ffffff",du="#abb2bf",op="#7d8799",$A="#61afef",GA="#98c379",Q0="#d19a66",HA="#c678dd",zA="#21252b",lf="#2c313a",Z0="#282c34",af="#353a42",UA="#3E4451",ey="#528bff",qA=J.theme({"&":{color:du,backgroundColor:Z0},".cm-content":{caretColor:ey},"&.cm-focused .cm-cursor":{borderLeftColor:ey},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:UA},".cm-panels":{backgroundColor:zA,color:du},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:lf},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847",outline:"1px solid #515a6b"},".cm-gutters":{backgroundColor:Z0,color:op,border:"none"},".cm-activeLineGutter":{backgroundColor:lf},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:af},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:af,borderBottomColor:af},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:lf,color:du}}},{dark:!0}),KA=js.define([{tag:I.keyword,color:HA},{tag:[I.name,I.deleted,I.character,I.propertyName,I.macroName],color:X0},{tag:[I.function(I.variableName),I.labelName],color:$A},{tag:[I.color,I.constant(I.name),I.standard(I.name)],color:Q0},{tag:[I.definition(I.name),I.separator],color:du},{tag:[I.typeName,I.className,I.number,I.changed,I.annotation,I.modifier,I.self,I.namespace],color:WA},{tag:[I.operator,I.operatorKeyword,I.url,I.escape,I.regexp,I.link,I.special(I.string)],color:BA},{tag:[I.meta,I.comment],color:op},{tag:I.strong,fontWeight:"bold"},{tag:I.emphasis,fontStyle:"italic"},{tag:I.strikethrough,textDecoration:"line-through"},{tag:I.link,color:op,textDecoration:"underline"},{tag:I.heading,fontWeight:"bold",color:X0},{tag:[I.atom,I.bool,I.special(I.variableName)],color:Q0},{tag:[I.processingInstruction,I.string,I.inserted],color:GA},{tag:I.invalid,color:jA}]),JA=[qA,KA];var YA=J.theme({"&":{backgroundColor:"#fff"}},{dark:!1});function XA(n){var{value:e,selection:t,onChange:i,onUpdate:r,extensions:s=[],autoFocus:o,theme:l="light",height:a="",minHeight:u="",maxHeight:h="",placeholder:c="",width:f="",minWidth:d="",maxWidth:m="",editable:w=!0,indentWithTab:v=!0,basicSetup:p=!0,root:y}=n,[C,b]=vt.exports.useState(n.container),[_,O]=vt.exports.useState(),[R,L]=vt.exports.useState(),A=J.theme({"&":{height:a,minHeight:u,maxHeight:h,width:f,minWidth:d,maxWidth:m}}),$=J.updateListener.of(X=>{if(X.docChanged&&typeof i=="function"){var H=X.state.doc,Ce=H.toString();i(Ce,X)}}),U=[$,A];switch(v&&U.unshift(Eh.of([DP])),p&&U.unshift(VA),c&&U.unshift(VO(c)),l){case"light":U.push(YA);break;case"dark":U.push(JA);break;default:U.push(l);break}return w===!1&&U.push(J.editable.of(!1)),r&&typeof r=="function"&&U.push(J.updateListener.of(r)),U=U.concat(s),vt.exports.useEffect(()=>{if(C&&!R){var X=ce.create({doc:e,selection:t,extensions:U});if(L(X),!_){var H=new J({state:X,parent:C,root:y});O(H)}}},[C,R]),vt.exports.useEffect(()=>()=>{_&&(_.destroy(),O(void 0))},[_]),vt.exports.useEffect(()=>{o&&_&&_.focus()},[o,_]),vt.exports.useEffect(()=>{var X=_?_.state.doc.toString():"";_&&e!==X&&_.dispatch({changes:{from:0,to:X.length,insert:e||""}})},[e,_]),vt.exports.useEffect(()=>{_&&_.dispatch({effects:ie.reconfigure.of(U)})},[l,s,a,u,h,f,c,d,m,w,v,p]),{state:R,setState:L,view:_,setView:O,container:C,setContainer:b}}var Vm={exports:{}},Wl={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QA=vt.exports,gx=60103;Wl.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var ty=Symbol.for;gx=ty("react.element"),Wl.Fragment=ty("react.fragment")}var ZA=QA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,eN=Object.prototype.hasOwnProperty,tN={key:!0,ref:!0,__self:!0,__source:!0};function vx(n,e,t){var i,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)eN.call(e,i)&&!tN.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:gx,type:n,key:s,ref:o,props:r,_owner:ZA.current}}Wl.jsx=vx;Wl.jsxs=vx;Vm.exports=Wl;const nN=Vm.exports.jsx,HL=Vm.exports.jsxs;var iN=["className","value","selection","extensions","onChange","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","root"],rN=Rx.forwardRef((n,e)=>{var{className:t,value:i="",selection:r,extensions:s=[],onChange:o,onUpdate:l,autoFocus:a,theme:u="light",height:h,minHeight:c,maxHeight:f,width:d,minWidth:m,maxWidth:w,basicSetup:v,placeholder:p,indentWithTab:y,editable:C,root:b}=n,_=TE(n,iN),O=vt.exports.useRef(null),{state:R,view:L,container:A,setContainer:$}=XA({container:O.current,root:b,value:i,autoFocus:a,theme:u,height:h,minHeight:c,maxHeight:f,width:d,minWidth:m,maxWidth:w,basicSetup:v,placeholder:p,indentWithTab:y,editable:C,selection:r,onChange:o,onUpdate:l,extensions:s});if(vt.exports.useImperativeHandle(e,()=>({editor:A,state:R,view:L}),[A,R,L]),vt.exports.useEffect(()=>{$(O.current)},[]),typeof i!="string")throw new Error("value must be typeof string but got "+typeof i);var U=typeof u=="string"?"cm-theme-"+u:"cm-theme";return nN("div",md({ref:O,className:""+U+(t?" "+t:"")},_))});rN.displayName="CodeMirror";var sN={},kl={};Object.defineProperty(kl,"__esModule",{value:!0});kl.CompilerOptions=void 0;class oN{constructor(e=null,t=[],i=!1,r=null,s=null){this.sourceFilename=e,this.pluginNames=t,this.countAllVisits=i,this.errorHandler=r,this.fileHandler=s}}kl.CompilerOptions=oN;var Fh={};Object.defineProperty(Fh,"__esModule",{value:!0});Fh.DebugSourceRange=void 0;class lN{constructor(e,t,i){this.length=e,this.debugMetadata=t,this.text=i}}Fh.DebugSourceRange=lN;var Wm={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Error=1]="Error",e[e.Warning=2]="Warning"}(n.ErrorType||(n.ErrorType={}))})(Wm);var yx={},Vh={};Object.defineProperty(Vh,"__esModule",{value:!0});Vh.Argument=void 0;class aN{constructor(e=null,t=null,i=null){this.identifier=e,this.isByReference=t,this.isDivertTarget=i}}Vh.Argument=aN;var $s={},ke={},re={};Object.defineProperty(re,"__esModule",{value:!0});re.filterUndef=re.isEquatable=re.nullIfUndefined=re.asINamedContentOrNull=re.asBooleanOrThrows=re.asNumberOrThrows=re.asOrThrows=re.asOrNull=void 0;function uN(n,e){return n instanceof e?Cx(n):null}re.asOrNull=uN;function hN(n,e){if(n instanceof e)return Cx(n);throw new Error(`${n} is not of type ${e}`)}re.asOrThrows=hN;function cN(n){if(typeof n=="number")return n;throw new Error(`${n} is not a number`)}re.asNumberOrThrows=cN;function fN(n){if(typeof n=="boolean")return n;throw new Error(`${n} is not a boolean`)}re.asBooleanOrThrows=fN;function dN(n){return n.hasValidName&&n.name?n:null}re.asINamedContentOrNull=dN;function pN(n){return typeof n=="undefined"?null:n}re.nullIfUndefined=pN;function mN(n){return typeof n=="object"&&typeof n.Equals=="function"}re.isEquatable=mN;function Cx(n,e){return n}function gN(n){return n!=null}re.filterUndef=gN;Object.defineProperty(ke,"__esModule",{value:!0});ke.ParsedObject=void 0;const ny=re;class vN{constructor(){this._alreadyHadError=!1,this._alreadyHadWarning=!1,this._debugMetadata=null,this._runtimeObject=null,this.content=[],this.parent=null,this.GetType=()=>this.typeName,this.AddContent=e=>{this.content===null&&(this.content=[]);const t=Array.isArray(e)?e:[e];for(const i of t)i.hasOwnProperty("parent")&&(i.parent=this),this.content.push(i);if(!Array.isArray(e))return e},this.InsertContent=(e,t)=>(this.content===null&&(this.content=[]),t.parent=this,this.content.splice(e,0,t),t),this.Find=e=>(t=null)=>{let i=ny.asOrNull(this,e);if(i!==null&&(t===null||t(i)===!0))return i;if(this.content===null)return null;for(const r of this.content){let s=r.Find&&r.Find(e)(t);if(s)return s}return null},this.FindAll=e=>(t,i)=>{const r=Array.isArray(i)?i:[],s=ny.asOrNull(this,e);if(s!==null&&(!t||t(s)===!0)&&r.push(s),this.content===null)return[];for(const o of this.content)o.FindAll&&o.FindAll(e)(t,r);return r},this.Warning=(e,t=null)=>{this.Error(e,t,!0)}}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get hasOwnDebugMetadata(){return Boolean(this.debugMetadata)}get typeName(){return"ParsedObject"}get story(){let e=this;for(;e.parent;)e=e.parent;return e}get runtimeObject(){return this._runtimeObject||(this._runtimeObject=this.GenerateRuntimeObject(),this._runtimeObject&&(this._runtimeObject.debugMetadata=this.debugMetadata)),this._runtimeObject}set runtimeObject(e){this._runtimeObject=e}get runtimePath(){if(!this.runtimeObject.path)throw new Error;return this.runtimeObject.path}get containerForCounting(){return this.runtimeObject}get ancestry(){let e=[],t=this.parent;for(;t;)e.push(t),t=t.parent;return e=e.reverse(),e}ResolveReferences(e){if(this.content!==null)for(const t of this.content)t.ResolveReferences(e)}Error(e,t=null,i=!1){if(t===null&&(t=this),!(t._alreadyHadError&&!i||t._alreadyHadWarning&&i)){if(this.parent)this.parent.Error(e,t,i);else throw new Error(`No parent object to send error to: ${e}`);i?t._alreadyHadWarning=!0:t._alreadyHadError=!0}}}ke.ParsedObject=vN;Object.defineProperty($s,"__esModule",{value:!0});$s.AuthorWarning=void 0;const yN=ke;class CN extends yN.ParsedObject{constructor(e){super();this.warningMessage=e,this.GenerateRuntimeObject=()=>(this.Warning(this.warningMessage),null)}get typeName(){return"AuthorWarning"}}$s.AuthorWarning=CN;var Bl={},Lt={},Be={},Ae={},mt={},Mt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Path=void 0;class e{constructor(){if(this._components=[],this._componentsString=null,this._isRelative=!1,typeof arguments[0]=="string"){let i=arguments[0];this.componentsString=i}else if(arguments[0]instanceof e.Component&&arguments[1]instanceof e){let i=arguments[0],r=arguments[1];this._components.push(i),this._components=this._components.concat(r._components)}else if(arguments[0]instanceof Array){let i=arguments[0],r=!!arguments[1];this._components=this._components.concat(i),this._isRelative=r}}get isRelative(){return this._isRelative}get componentCount(){return this._components.length}get head(){return this._components.length>0?this._components[0]:null}get tail(){if(this._components.length>=2){let i=this._components.slice(1,this._components.length);return new e(i)}else return e.self}get length(){return this._components.length}get lastComponent(){let i=this._components.length-1;return i>=0?this._components[i]:null}get containsNamedComponent(){for(let i=0,r=this._components.length;i<r;i++)if(!this._components[i].isIndex)return!0;return!1}static get self(){let i=new e;return i._isRelative=!0,i}GetComponent(i){return this._components[i]}PathByAppendingPath(i){let r=new e,s=0;for(let o=0;o<i._components.length&&i._components[o].isParent;++o)s++;for(let o=0;o<this._components.length-s;++o)r._components.push(this._components[o]);for(let o=s;o<i._components.length;++o)r._components.push(i._components[o]);return r}get componentsString(){return this._componentsString==null&&(this._componentsString=this._components.join("."),this.isRelative&&(this._componentsString="."+this._componentsString)),this._componentsString}set componentsString(i){if(this._components.length=0,this._componentsString=i,this._componentsString==null||this._componentsString=="")return;this._componentsString[0]=="."&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));let r=this._componentsString.split(".");for(let s of r)/^(\-|\+)?([0-9]+|Infinity)$/.test(s)?this._components.push(new e.Component(parseInt(s))):this._components.push(new e.Component(s))}toString(){return this.componentsString}Equals(i){if(i==null||i._components.length!=this._components.length||i.isRelative!=this.isRelative)return!1;for(let r=0,s=i._components.length;r<s;r++)if(!i._components[r].Equals(this._components[r]))return!1;return!0}PathByAppendingComponent(i){let r=new e;return r._components.push(...this._components),r._components.push(i),r}}n.Path=e,e.parentId="^",function(t){class i{constructor(s){this.index=-1,this.name=null,typeof s=="string"?this.name=s:this.index=s}get isIndex(){return this.index>=0}get isParent(){return this.name==t.parentId}static ToParent(){return new i(t.parentId)}toString(){return this.isIndex?this.index.toString():this.name}Equals(s){return s!=null&&s.isIndex==this.isIndex?this.isIndex?this.index==s.index:this.name==s.name:!1}}t.Component=i}(e=n.Path||(n.Path={}))})(Mt);var jl={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Debug=void 0,function(e){function t(r,s,o){i(r instanceof s,o)}e.AssertType=t;function i(r,s){if(!r)throw typeof s!="undefined"&&console.warn(s),console.trace&&console.trace(),new Error("")}e.Assert=i}(n.Debug||(n.Debug={}))})(jl);var We={};Object.defineProperty(We,"__esModule",{value:!0});We.throwNullException=We.NullException=void 0;class Sx extends Error{}We.NullException=Sx;function SN(n){throw new Sx(`${n} is null or undefined`)}We.throwNullException=SN;Object.defineProperty(mt,"__esModule",{value:!0});mt.InkObject=void 0;const zr=Mt,yo=Be,uf=jl,Ur=re,Na=We;class wN{constructor(){this.parent=null,this._debugMetadata=null,this._path=null}get debugMetadata(){return this._debugMetadata===null&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(e){this._debugMetadata=e}get ownDebugMetadata(){return this._debugMetadata}DebugLineNumberOfPath(e){if(e===null)return null;let t=this.rootContentContainer;if(t){let i=t.ContentAtPath(e).obj;if(i){let r=i.debugMetadata;if(r!==null)return r.startLineNumber}}return null}get path(){if(this._path==null)if(this.parent==null)this._path=new zr.Path;else{let e=[],t=this,i=Ur.asOrNull(t.parent,yo.Container);for(;i!==null;){let r=Ur.asINamedContentOrNull(t);if(r!=null&&r.hasValidName){if(r.name===null)return Na.throwNullException("namedChild.name");e.unshift(new zr.Path.Component(r.name))}else e.unshift(new zr.Path.Component(i.content.indexOf(t)));t=i,i=Ur.asOrNull(i.parent,yo.Container)}this._path=new zr.Path(e)}return this._path}ResolvePath(e){if(e===null)return Na.throwNullException("path");if(e.isRelative){let t=Ur.asOrNull(this,yo.Container);return t===null&&(uf.Debug.Assert(this.parent!==null,"Can't resolve relative path because we don't have a parent"),t=Ur.asOrNull(this.parent,yo.Container),uf.Debug.Assert(t!==null,"Expected parent to be a container"),uf.Debug.Assert(e.GetComponent(0).isParent),e=e.tail),t===null?Na.throwNullException("nearestContainer"):t.ContentAtPath(e)}else{let t=this.rootContentContainer;return t===null?Na.throwNullException("contentContainer"):t.ContentAtPath(e)}}ConvertPathToRelative(e){let t=this.path,i=Math.min(e.length,t.length),r=-1;for(let a=0;a<i;++a){let u=t.GetComponent(a),h=e.GetComponent(a);if(u.Equals(h))r=a;else break}if(r==-1)return e;let s=t.componentCount-1-r,o=[];for(let a=0;a<s;++a)o.push(zr.Path.Component.ToParent());for(let a=r+1;a<e.componentCount;++a)o.push(e.GetComponent(a));return new zr.Path(o,!0)}CompactPathString(e){let t=null,i=null;return e.isRelative?(i=e.componentsString,t=this.path.PathByAppendingPath(e).componentsString):(i=this.ConvertPathToRelative(e).componentsString,t=e.componentsString),i.length<t.length?i:t}get rootContentContainer(){let e=this;for(;e.parent;)e=e.parent;return Ur.asOrNull(e,yo.Container)}Copy(){throw Error("Not Implemented: Doesn't support copying")}SetChild(e,t,i){e[t]&&(e[t]=null),e[t]=i,e[t]&&(e[t].parent=this)}Equals(e){return e===this}}mt.InkObject=wN;var Je={},ii={};Object.defineProperty(ii,"__esModule",{value:!0});ii.StringBuilder=void 0;class xN{constructor(e){e=typeof e!="undefined"?e.toString():"",this.string=e}get Length(){return this.string.length}Append(e){e!==null&&(this.string+=e)}AppendLine(e){typeof e!="undefined"&&this.Append(e),this.string+=`
`}AppendFormat(e,...t){this.string+=e.replace(/{(\d+)}/g,(i,r)=>typeof t[r]!="undefined"?t[r]:i)}toString(){return this.string}}ii.StringBuilder=xN;Object.defineProperty(Je,"__esModule",{value:!0});Je.InkList=Je.InkListItem=void 0;const Cn=We,bN=ii;class $e{constructor(){if(this.originName=null,this.itemName=null,typeof arguments[1]!="undefined"){let e=arguments[0],t=arguments[1];this.originName=e,this.itemName=t}else if(arguments[0]){let t=arguments[0].toString().split(".");this.originName=t[0],this.itemName=t[1]}}static get Null(){return new $e(null,null)}get isNull(){return this.originName==null&&this.itemName==null}get fullName(){return(this.originName!==null?this.originName:"?")+"."+this.itemName}toString(){return this.fullName}Equals(e){if(e instanceof $e){let t=e;return t.itemName==this.itemName&&t.originName==this.originName}return!1}copy(){return new $e(this.originName,this.itemName)}serialized(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}static fromSerializedKey(e){let t=JSON.parse(e);if(!$e.isLikeInkListItem(t))return $e.Null;let i=t;return new $e(i.originName,i.itemName)}static isLikeInkListItem(e){return!(typeof e!="object"||!e.hasOwnProperty("originName")||!e.hasOwnProperty("itemName")||typeof e.originName!="string"&&typeof e.originName!==null||typeof e.itemName!="string"&&typeof e.itemName!==null)}}Je.InkListItem=$e;class je extends Map{constructor(){super((()=>arguments[0]instanceof je?arguments[0]:[])());if(this.origins=null,this._originNames=[],arguments[0]instanceof je){let e=arguments[0];this._originNames=e.originNames,e.origins!==null&&(this.origins=e.origins.slice())}else if(typeof arguments[0]=="string"){let e=arguments[0],t=arguments[1];if(this.SetInitialOriginName(e),t.listDefinitions===null)return Cn.throwNullException("originStory.listDefinitions");let i=t.listDefinitions.TryListGetDefinition(e,null);if(i.exists){if(i.result===null)return Cn.throwNullException("def.result");this.origins=[i.result]}else throw new Error("InkList origin could not be found in story when constructing new list: "+e)}else if(typeof arguments[0]=="object"&&arguments[0].hasOwnProperty("Key")&&arguments[0].hasOwnProperty("Value")){let e=arguments[0];this.Add(e.Key,e.Value)}}static FromString(e,t){var i;let r=(i=t.listDefinitions)===null||i===void 0?void 0:i.FindSingleItemListWithName(e);if(r)return r.value===null?Cn.throwNullException("listValue.value"):new je(r.value);throw new Error("Could not find the InkListItem from the string '"+e+"' to create an InkList because it doesn't exist in the original list definition in ink.")}AddItem(e){if(e instanceof $e){let t=e;if(t.originName==null){this.AddItem(t.itemName);return}if(this.origins===null)return Cn.throwNullException("this.origins");for(let i of this.origins)if(i.name==t.originName){let r=i.TryGetValueForItem(t,0);if(r.exists){this.Add(t,r.result);return}else throw new Error("Could not add the item "+t+" to this list because it doesn't exist in the original list definition in ink.")}throw new Error("Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.")}else{let t=e,i=null;if(this.origins===null)return Cn.throwNullException("this.origins");for(let o of this.origins){if(t===null)return Cn.throwNullException("itemName");if(o.ContainsItemWithName(t)){if(i!=null)throw new Error("Could not add the item "+t+" to this list because it could come from either "+o.name+" or "+i.name);i=o}}if(i==null)throw new Error("Could not add the item "+t+" to this list because it isn't known to any list definitions previously associated with this list.");let r=new $e(i.name,t),s=i.ValueForItem(r);this.Add(r,s)}}ContainsItemNamed(e){for(let[t]of this)if($e.fromSerializedKey(t).itemName==e)return!0;return!1}ContainsKey(e){return this.has(e.serialized())}Add(e,t){let i=e.serialized();if(this.has(i))throw new Error(`The Map already contains an entry for ${e}`);this.set(i,t)}Remove(e){return this.delete(e.serialized())}get Count(){return this.size}get originOfMaxItem(){if(this.origins==null)return null;let e=this.maxItem.Key.originName,t=null;return this.origins.every(i=>i.name==e?(t=i,!1):!0),t}get originNames(){if(this.Count>0){this._originNames==null&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);for(let[e]of this){let t=$e.fromSerializedKey(e);if(t.originName===null)return Cn.throwNullException("item.originName");this._originNames.push(t.originName)}}return this._originNames}SetInitialOriginName(e){this._originNames=[e]}SetInitialOriginNames(e){e==null?this._originNames=null:this._originNames=e.slice()}get maxItem(){let e={Key:$e.Null,Value:0};for(let[t,i]of this){let r=$e.fromSerializedKey(t);(e.Key.isNull||i>e.Value)&&(e={Key:r,Value:i})}return e}get minItem(){let e={Key:$e.Null,Value:0};for(let[t,i]of this){let r=$e.fromSerializedKey(t);(e.Key.isNull||i<e.Value)&&(e={Key:r,Value:i})}return e}get inverse(){let e=new je;if(this.origins!=null)for(let t of this.origins)for(let[i,r]of t.items){let s=$e.fromSerializedKey(i);this.ContainsKey(s)||e.Add(s,r)}return e}get all(){let e=new je;if(this.origins!=null)for(let t of this.origins)for(let[i,r]of t.items){let s=$e.fromSerializedKey(i);e.set(s.serialized(),r)}return e}Union(e){let t=new je(this);for(let[i,r]of e)t.set(i,r);return t}Intersect(e){let t=new je;for(let[i,r]of this)e.has(i)&&t.set(i,r);return t}Without(e){let t=new je(this);for(let[i]of e)t.delete(i);return t}Contains(e){for(let[t]of e)if(!this.has(t))return!1;return!0}GreaterThan(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>e.maxItem.Value}GreaterThanOrEquals(e){return this.Count==0?!1:e.Count==0?!0:this.minItem.Value>=e.minItem.Value&&this.maxItem.Value>=e.maxItem.Value}LessThan(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<e.minItem.Value}LessThanOrEquals(e){return e.Count==0?!1:this.Count==0?!0:this.maxItem.Value<=e.maxItem.Value&&this.minItem.Value<=e.minItem.Value}MaxAsList(){return this.Count>0?new je(this.maxItem):new je}MinAsList(){return this.Count>0?new je(this.minItem):new je}ListWithSubRange(e,t){if(this.Count==0)return new je;let i=this.orderedItems,r=0,s=Number.MAX_SAFE_INTEGER;Number.isInteger(e)?r=e:e instanceof je&&e.Count>0&&(r=e.minItem.Value),Number.isInteger(t)?s=t:e instanceof je&&e.Count>0&&(s=t.maxItem.Value);let o=new je;o.SetInitialOriginNames(this.originNames);for(let l of i)l.Value>=r&&l.Value<=s&&o.Add(l.Key,l.Value);return o}Equals(e){if(!(e instanceof je)||e.Count!=this.Count)return!1;for(let[t]of this)if(!e.has(t))return!1;return!0}get orderedItems(){let e=new Array;for(let[t,i]of this){let r=$e.fromSerializedKey(t);e.push({Key:r,Value:i})}return e.sort((t,i)=>t.Key.originName===null?Cn.throwNullException("x.Key.originName"):i.Key.originName===null?Cn.throwNullException("y.Key.originName"):t.Value==i.Value?t.Key.originName.localeCompare(i.Key.originName):t.Value<i.Value?-1:t.Value>i.Value?1:0),e}toString(){let e=this.orderedItems,t=new bN.StringBuilder;for(let i=0;i<e.length;i++){i>0&&t.Append(", ");let r=e[i].Key;if(r.itemName===null)return Cn.throwNullException("item.itemName");t.Append(r.itemName)}return t.toString()}valueOf(){return NaN}}Je.InkList=je;var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.StoryException=void 0;class EN extends Error{constructor(e){super(e);this.useEndLineNumber=!1,this.message=e,this.name="StoryException"}}Nr.StoryException=EN;var tn={};Object.defineProperty(tn,"__esModule",{value:!0});tn.tryParseFloat=tn.tryParseInt=tn.tryGetValueFromMap=void 0;function kN(n,e,t){if(n===null)return{result:t,exists:!1};let i=n.get(e);return typeof i=="undefined"?{result:t,exists:!1}:{result:i,exists:!0}}tn.tryGetValueFromMap=kN;function ON(n,e=0){let t=parseInt(n);return Number.isNaN(t)?{result:e,exists:!1}:{result:t,exists:!0}}tn.tryParseInt=ON;function _N(n,e=0){let t=parseFloat(n);return Number.isNaN(t)?{result:e,exists:!1}:{result:t,exists:!0}}tn.tryParseFloat=_N;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ValueType=n.ListValue=n.VariablePointerValue=n.DivertTargetValue=n.StringValue=n.FloatValue=n.IntValue=n.BoolValue=n.Value=n.AbstractValue=void 0;const e=mt,t=Mt,i=Je,r=Nr,s=re,o=tn,l=We;class a extends e.InkObject{static Create(C,b){if(b){if(b===p.Int&&Number.isInteger(Number(C)))return new c(Number(C));if(b===p.Float&&!isNaN(C))return new f(Number(C))}if(typeof C=="boolean")return new h(Boolean(C));if(typeof C=="string")return new d(String(C));if(Number.isInteger(Number(C)))return new c(Number(C));if(isNaN(C)){if(C instanceof t.Path)return new m(s.asOrThrows(C,t.Path));if(C instanceof i.InkList)return new v(s.asOrThrows(C,i.InkList))}else return new f(Number(C));return null}Copy(){return s.asOrThrows(a.Create(this.valueObject),e.InkObject)}BadCastException(C){return new r.StoryException("Can't cast "+this.valueObject+" from "+this.valueType+" to "+C)}}n.AbstractValue=a;class u extends a{constructor(C){super();this.value=C}get valueObject(){return this.value}toString(){return this.value===null?l.throwNullException("Value.value"):this.value.toString()}}n.Value=u;class h extends u{constructor(C){super(C||!1)}get isTruthy(){return Boolean(this.value)}get valueType(){return p.Bool}Cast(C){if(this.value===null)return l.throwNullException("Value.value");if(C==this.valueType)return this;if(C==p.Int)return new c(this.value?1:0);if(C==p.Float)return new f(this.value?1:0);if(C==p.String)return new d(this.value?"true":"false");throw this.BadCastException(C)}toString(){return this.value?"true":"false"}}n.BoolValue=h;class c extends u{constructor(C){super(C||0)}get isTruthy(){return this.value!=0}get valueType(){return p.Int}Cast(C){if(this.value===null)return l.throwNullException("Value.value");if(C==this.valueType)return this;if(C==p.Bool)return new h(this.value!==0);if(C==p.Float)return new f(this.value);if(C==p.String)return new d(""+this.value);throw this.BadCastException(C)}}n.IntValue=c;class f extends u{constructor(C){super(C||0)}get isTruthy(){return this.value!=0}get valueType(){return p.Float}Cast(C){if(this.value===null)return l.throwNullException("Value.value");if(C==this.valueType)return this;if(C==p.Bool)return new h(this.value!==0);if(C==p.Int)return new c(this.value);if(C==p.String)return new d(""+this.value);throw this.BadCastException(C)}}n.FloatValue=f;class d extends u{constructor(C){super(C||"");if(this._isNewline=this.value==`
`,this._isInlineWhitespace=!0,this.value===null)return l.throwNullException("Value.value");this.value.length>0&&this.value.split("").every(b=>b!=" "&&b!="	"?(this._isInlineWhitespace=!1,!1):!0)}get valueType(){return p.String}get isTruthy(){return this.value===null?l.throwNullException("Value.value"):this.value.length>0}get isNewline(){return this._isNewline}get isInlineWhitespace(){return this._isInlineWhitespace}get isNonWhitespace(){return!this.isNewline&&!this.isInlineWhitespace}Cast(C){if(C==this.valueType)return this;if(C==p.Int){let b=o.tryParseInt(this.value);if(b.exists)return new c(b.result);throw this.BadCastException(C)}if(C==p.Float){let b=o.tryParseFloat(this.value);if(b.exists)return new f(b.result);throw this.BadCastException(C)}throw this.BadCastException(C)}}n.StringValue=d;class m extends u{constructor(C=null){super(C)}get valueType(){return p.DivertTarget}get targetPath(){return this.value===null?l.throwNullException("Value.value"):this.value}set targetPath(C){this.value=C}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a divert target")}Cast(C){if(C==this.valueType)return this;throw this.BadCastException(C)}toString(){return"DivertTargetValue("+this.targetPath+")"}}n.DivertTargetValue=m;class w extends u{constructor(C,b=-1){super(C);this._contextIndex=b}get contextIndex(){return this._contextIndex}set contextIndex(C){this._contextIndex=C}get variableName(){return this.value===null?l.throwNullException("Value.value"):this.value}set variableName(C){this.value=C}get valueType(){return p.VariablePointer}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a variable pointer")}Cast(C){if(C==this.valueType)return this;throw this.BadCastException(C)}toString(){return"VariablePointerValue("+this.variableName+")"}Copy(){return new w(this.variableName,this.contextIndex)}}n.VariablePointerValue=w;class v extends u{get isTruthy(){return this.value===null?l.throwNullException("this.value"):this.value.Count>0}get valueType(){return p.List}Cast(C){if(this.value===null)return l.throwNullException("Value.value");if(C==p.Int){let b=this.value.maxItem;return b.Key.isNull?new c(0):new c(b.Value)}else if(C==p.Float){let b=this.value.maxItem;return b.Key.isNull?new f(0):new f(b.Value)}else if(C==p.String){let b=this.value.maxItem;return b.Key.isNull?new d(""):new d(b.Key.toString())}if(C==this.valueType)return this;throw this.BadCastException(C)}constructor(C,b){super(null);!C&&!b?this.value=new i.InkList:C instanceof i.InkList?this.value=new i.InkList(C):C instanceof i.InkListItem&&typeof b=="number"&&(this.value=new i.InkList({Key:C,Value:b}))}static RetainListOriginsForAssignment(C,b){let _=s.asOrNull(C,v),O=s.asOrNull(b,v);if(O&&O.value===null)return l.throwNullException("newList.value");if(_&&_.value===null)return l.throwNullException("oldList.value");_&&O&&O.value.Count==0&&O.value.SetInitialOriginNames(_.value.originNames)}}n.ListValue=v;var p;(function(y){y[y.Bool=-1]="Bool",y[y.Int=0]="Int",y[y.Float=1]="Float",y[y.List=2]="List",y[y.String=3]="String",y[y.DivertTarget=4]="DivertTarget",y[y.VariablePointer=5]="VariablePointer"})(p=n.ValueType||(n.ValueType={}))})(Ae);var Wh={};Object.defineProperty(Wh,"__esModule",{value:!0});Wh.SearchResult=void 0;const PN=Be;class Bm{constructor(){this.obj=null,this.approximate=!1}get correctObj(){return this.approximate?null:this.obj}get container(){return this.obj instanceof PN.Container?this.obj:null}copy(){let e=new Bm;return e.obj=this.obj,e.approximate=this.approximate,e}}Wh.SearchResult=Bm;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Container=void 0;const e=Ae,t=We,i=ii,r=mt,s=Wh,o=Mt,l=jl,a=tn,u=re;class h extends r.InkObject{constructor(){super(...arguments);this.name=null,this._content=[],this.namedContent=new Map,this.visitsShouldBeCounted=!1,this.turnIndexShouldBeCounted=!1,this.countingAtStartOnly=!1,this._pathToFirstLeafContent=null}get hasValidName(){return this.name!=null&&this.name.length>0}get content(){return this._content}set content(f){this.AddContent(f)}get namedOnlyContent(){let f=new Map;for(let[d,m]of this.namedContent){let w=u.asOrThrows(m,r.InkObject);f.set(d,w)}for(let d of this.content){let m=u.asINamedContentOrNull(d);m!=null&&m.hasValidName&&f.delete(m.name)}return f.size==0&&(f=null),f}set namedOnlyContent(f){let d=this.namedOnlyContent;if(d!=null)for(let[m]of d)this.namedContent.delete(m);if(f!=null)for(let[,m]of f){let w=u.asINamedContentOrNull(m);w!=null&&this.AddToNamedContentOnly(w)}}get countFlags(){let f=0;return this.visitsShouldBeCounted&&(f|=h.CountFlags.Visits),this.turnIndexShouldBeCounted&&(f|=h.CountFlags.Turns),this.countingAtStartOnly&&(f|=h.CountFlags.CountStartOnly),f==h.CountFlags.CountStartOnly&&(f=0),f}set countFlags(f){let d=f;(d&h.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(d&h.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(d&h.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}get pathToFirstLeafContent(){return this._pathToFirstLeafContent==null&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}get internalPathToFirstLeafContent(){let f=[],d=this;for(;d instanceof h;)d.content.length>0&&(f.push(new o.Path.Component(0)),d=d.content[0]);return new o.Path(f)}AddContent(f){if(f instanceof Array){let d=f;for(let m of d)this.AddContent(m)}else{let d=f;if(this._content.push(d),d.parent)throw new Error("content is already in "+d.parent);d.parent=this,this.TryAddNamedContent(d)}}TryAddNamedContent(f){let d=u.asINamedContentOrNull(f);d!=null&&d.hasValidName&&this.AddToNamedContentOnly(d)}AddToNamedContentOnly(f){l.Debug.AssertType(f,r.InkObject,"Can only add Runtime.Objects to a Runtime.Container");let d=u.asOrThrows(f,r.InkObject);if(d.parent=this,f.name===null)return t.throwNullException("namedContentObj.name");this.namedContent.set(f.name,f)}ContentAtPath(f,d=0,m=-1){m==-1&&(m=f.length);let w=new s.SearchResult;w.approximate=!1;let v=this,p=this;for(let y=d;y<m;++y){let C=f.GetComponent(y);if(v==null){w.approximate=!0;break}let b=v.ContentWithPathComponent(C);if(b==null){w.approximate=!0;break}p=b,v=u.asOrNull(b,h)}return w.obj=p,w}InsertContent(f,d){if(this.content.splice(d,0,f),f.parent)throw new Error("content is already in "+f.parent);f.parent=this,this.TryAddNamedContent(f)}AddContentsOfContainer(f){this.content.push(...f.content);for(let d of f.content)d.parent=this,this.TryAddNamedContent(d)}ContentWithPathComponent(f){if(f.isIndex)return f.index>=0&&f.index<this.content.length?this.content[f.index]:null;if(f.isParent)return this.parent;{if(f.name===null)return t.throwNullException("component.name");let d=a.tryGetValueFromMap(this.namedContent,f.name,null);return d.exists?u.asOrThrows(d.result,r.InkObject):null}}BuildStringOfHierarchy(){let f;if(arguments.length==0)return f=new i.StringBuilder,this.BuildStringOfHierarchy(f,0,null),f.toString();f=arguments[0];let d=arguments[1],m=arguments[2];function w(){for(let y=0;y<4*d;++y)f.Append(" ")}w(),f.Append("["),this.hasValidName&&f.AppendFormat(" ({0})",this.name),this==m&&f.Append("  <---"),f.AppendLine(),d++;for(let p=0;p<this.content.length;++p){let y=this.content[p];y instanceof h?y.BuildStringOfHierarchy(f,d,m):(w(),y instanceof e.StringValue?(f.Append('"'),f.Append(y.toString().replace(`
`,"\\n")),f.Append('"')):f.Append(y.toString())),p!=this.content.length-1&&f.Append(","),!(y instanceof h)&&y==m&&f.Append("  <---"),f.AppendLine()}let v=new Map;for(let[p,y]of this.namedContent)this.content.indexOf(u.asOrThrows(y,r.InkObject))>=0||v.set(p,y);if(v.size>0){w(),f.AppendLine("-- named: --");for(let[,p]of v)l.Debug.AssertType(p,h,"Can only print out named Containers"),p.BuildStringOfHierarchy(f,d,m),f.AppendLine()}d--,w(),f.Append("]")}}n.Container=h,function(c){(function(f){f[f.Visits=1]="Visits",f[f.Turns=2]="Turns",f[f.CountStartOnly=4]="CountStartOnly"})(c.CountFlags||(c.CountFlags={}))}(h=n.Container||(n.Container={}))})(Be);var bt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ControlCommand=void 0;const e=mt;class t extends e.InkObject{constructor(r=t.CommandType.NotSet){super();this._commandType=r}get commandType(){return this._commandType}Copy(){return new t(this.commandType)}static EvalStart(){return new t(t.CommandType.EvalStart)}static EvalOutput(){return new t(t.CommandType.EvalOutput)}static EvalEnd(){return new t(t.CommandType.EvalEnd)}static Duplicate(){return new t(t.CommandType.Duplicate)}static PopEvaluatedValue(){return new t(t.CommandType.PopEvaluatedValue)}static PopFunction(){return new t(t.CommandType.PopFunction)}static PopTunnel(){return new t(t.CommandType.PopTunnel)}static BeginString(){return new t(t.CommandType.BeginString)}static EndString(){return new t(t.CommandType.EndString)}static NoOp(){return new t(t.CommandType.NoOp)}static ChoiceCount(){return new t(t.CommandType.ChoiceCount)}static Turns(){return new t(t.CommandType.Turns)}static TurnsSince(){return new t(t.CommandType.TurnsSince)}static ReadCount(){return new t(t.CommandType.ReadCount)}static Random(){return new t(t.CommandType.Random)}static SeedRandom(){return new t(t.CommandType.SeedRandom)}static VisitIndex(){return new t(t.CommandType.VisitIndex)}static SequenceShuffleIndex(){return new t(t.CommandType.SequenceShuffleIndex)}static StartThread(){return new t(t.CommandType.StartThread)}static Done(){return new t(t.CommandType.Done)}static End(){return new t(t.CommandType.End)}static ListFromInt(){return new t(t.CommandType.ListFromInt)}static ListRange(){return new t(t.CommandType.ListRange)}static ListRandom(){return new t(t.CommandType.ListRandom)}toString(){return this.commandType.toString()}}n.ControlCommand=t,function(i){(function(r){r[r.NotSet=-1]="NotSet",r[r.EvalStart=0]="EvalStart",r[r.EvalOutput=1]="EvalOutput",r[r.EvalEnd=2]="EvalEnd",r[r.Duplicate=3]="Duplicate",r[r.PopEvaluatedValue=4]="PopEvaluatedValue",r[r.PopFunction=5]="PopFunction",r[r.PopTunnel=6]="PopTunnel",r[r.BeginString=7]="BeginString",r[r.EndString=8]="EndString",r[r.NoOp=9]="NoOp",r[r.ChoiceCount=10]="ChoiceCount",r[r.Turns=11]="Turns",r[r.TurnsSince=12]="TurnsSince",r[r.Random=13]="Random",r[r.SeedRandom=14]="SeedRandom",r[r.VisitIndex=15]="VisitIndex",r[r.SequenceShuffleIndex=16]="SequenceShuffleIndex",r[r.StartThread=17]="StartThread",r[r.Done=18]="Done",r[r.End=19]="End",r[r.ListFromInt=20]="ListFromInt",r[r.ListRange=21]="ListRange",r[r.ListRandom=22]="ListRandom",r[r.ReadCount=23]="ReadCount",r[r.TOTAL_VALUES=24]="TOTAL_VALUES"})(i.CommandType||(i.CommandType={}))}(t=n.ControlCommand||(n.ControlCommand={}))})(bt);Object.defineProperty(Lt,"__esModule",{value:!0});Lt.Expression=void 0;const iy=Be,hf=bt,TN=ke;class AN extends TN.ParsedObject{constructor(){super(...arguments);this._prototypeRuntimeConstantExpression=null,this.outputWhenComplete=!1,this.GenerateRuntimeObject=()=>{const e=new iy.Container;return e.AddContent(hf.ControlCommand.EvalStart()),this.GenerateIntoContainer(e),this.outputWhenComplete&&e.AddContent(hf.ControlCommand.EvalOutput()),e.AddContent(hf.ControlCommand.EvalEnd()),e},this.GenerateConstantIntoContainer=e=>{this._prototypeRuntimeConstantExpression===null&&(this._prototypeRuntimeConstantExpression=new iy.Container,this.GenerateIntoContainer(this._prototypeRuntimeConstantExpression));for(const t of this._prototypeRuntimeConstantExpression.content){const i=t.Copy();i&&e.AddContent(i)}},this.toString=()=>"No string value in JavaScript."}get typeName(){return"Expression"}}Lt.Expression=AN;var on={},ri={};Object.defineProperty(ri,"__esModule",{value:!0});ri.Void=void 0;const NN=mt;class IN extends NN.InkObject{}ri.Void=IN;Object.defineProperty(on,"__esModule",{value:!0});on.NativeFunctionCall=void 0;const q=Ae,Co=Nr,DN=ri,Ia=Je,RN=mt,qt=re,Ot=We;class te extends RN.InkObject{constructor(){super();if(this._name=null,this._numberOfParameters=0,this._prototype=null,this._isPrototype=!1,this._operationFuncs=null,arguments.length===0)te.GenerateNativeFunctionsIfNecessary();else if(arguments.length===1){let e=arguments[0];te.GenerateNativeFunctionsIfNecessary(),this.name=e}else if(arguments.length===2){let e=arguments[0],t=arguments[1];this._isPrototype=!0,this.name=e,this.numberOfParameters=t}}static CallWithName(e){return new te(e)}static CallExistsWithName(e){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(e)}get name(){return this._name===null?Ot.throwNullException("NativeFunctionCall._name"):this._name}set name(e){this._name=e,this._isPrototype||(te._nativeFunctions===null?Ot.throwNullException("NativeFunctionCall._nativeFunctions"):this._prototype=te._nativeFunctions.get(this._name)||null)}get numberOfParameters(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters}set numberOfParameters(e){this._numberOfParameters=e}Call(e){if(this._prototype)return this._prototype.Call(e);if(this.numberOfParameters!=e.length)throw new Error("Unexpected number of parameters");let t=!1;for(let s of e){if(s instanceof DN.Void)throw new Co.StoryException('Attempting to perform operation on a void value. Did you forget to "return" a value from a function you called here?');s instanceof q.ListValue&&(t=!0)}if(e.length==2&&t)return this.CallBinaryListOperation(e);let i=this.CoerceValuesToSingleType(e),r=i[0].valueType;return r==q.ValueType.Int?this.CallType(i):r==q.ValueType.Float?this.CallType(i):r==q.ValueType.String?this.CallType(i):r==q.ValueType.DivertTarget?this.CallType(i):r==q.ValueType.List?this.CallType(i):null}CallType(e){let t=qt.asOrThrows(e[0],q.Value),i=t.valueType,r=t,s=e.length;if(s==2||s==1){if(this._operationFuncs===null)return Ot.throwNullException("NativeFunctionCall._operationFuncs");let o=this._operationFuncs.get(i);if(!o){const l=q.ValueType[i];throw new Co.StoryException("Cannot perform operation "+this.name+" on "+l)}if(s==2){let a=qt.asOrThrows(e[1],q.Value),u=o;if(r.value===null||a.value===null)return Ot.throwNullException("NativeFunctionCall.Call BinaryOp values");let h=u(r.value,a.value);return q.Value.Create(h)}else{let l=o;if(r.value===null)return Ot.throwNullException("NativeFunctionCall.Call UnaryOp value");let a=l(r.value);return this.name===te.Int?q.Value.Create(a,q.ValueType.Int):this.name===te.Float?q.Value.Create(a,q.ValueType.Float):q.Value.Create(a,t.valueType)}}else throw new Error("Unexpected number of parameters to NativeFunctionCall: "+e.length)}CallBinaryListOperation(e){if((this.name=="+"||this.name=="-")&&e[0]instanceof q.ListValue&&e[1]instanceof q.IntValue)return this.CallListIncrementOperation(e);let t=qt.asOrThrows(e[0],q.Value),i=qt.asOrThrows(e[1],q.Value);if((this.name=="&&"||this.name=="||")&&(t.valueType!=q.ValueType.List||i.valueType!=q.ValueType.List)){if(this._operationFuncs===null)return Ot.throwNullException("NativeFunctionCall._operationFuncs");let r=this._operationFuncs.get(q.ValueType.Int);if(r===null)return Ot.throwNullException("NativeFunctionCall.CallBinaryListOperation op");let s=qt.asBooleanOrThrows(r(t.isTruthy?1:0,i.isTruthy?1:0));return new q.BoolValue(s)}if(t.valueType==q.ValueType.List&&i.valueType==q.ValueType.List)return this.CallType([t,i]);throw new Co.StoryException("Can not call use "+this.name+" operation on "+q.ValueType[t.valueType]+" and "+q.ValueType[i.valueType])}CallListIncrementOperation(e){let t=qt.asOrThrows(e[0],q.ListValue),i=qt.asOrThrows(e[1],q.IntValue),r=new Ia.InkList;if(t.value===null)return Ot.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value");for(let[s,o]of t.value){let l=Ia.InkListItem.fromSerializedKey(s);if(this._operationFuncs===null)return Ot.throwNullException("NativeFunctionCall._operationFuncs");let a=this._operationFuncs.get(q.ValueType.Int);if(i.value===null)return Ot.throwNullException("NativeFunctionCall.CallListIncrementOperation intVal.value");let u=a(o,i.value),h=null;if(t.value.origins===null)return Ot.throwNullException("NativeFunctionCall.CallListIncrementOperation listVal.value.origins");for(let c of t.value.origins)if(c.name==l.originName){h=c;break}if(h!=null){let c=h.TryGetItemWithValue(u,Ia.InkListItem.Null);c.exists&&r.Add(c.result,u)}}return new q.ListValue(r)}CoerceValuesToSingleType(e){let t=q.ValueType.Int,i=null;for(let s of e){let o=qt.asOrThrows(s,q.Value);o.valueType>t&&(t=o.valueType),o.valueType==q.ValueType.List&&(i=qt.asOrNull(o,q.ListValue))}let r=[];if(q.ValueType[t]==q.ValueType[q.ValueType.List])for(let s of e){let o=qt.asOrThrows(s,q.Value);if(o.valueType==q.ValueType.List)r.push(o);else if(o.valueType==q.ValueType.Int){let l=parseInt(o.valueObject);if(i=qt.asOrThrows(i,q.ListValue),i.value===null)return Ot.throwNullException("NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value");let a=i.value.originOfMaxItem;if(a===null)return Ot.throwNullException("NativeFunctionCall.CoerceValuesToSingleType list");let u=a.TryGetItemWithValue(l,Ia.InkListItem.Null);if(u.exists){let h=new q.ListValue(u.result,l);r.push(h)}else throw new Co.StoryException("Could not find List item with the value "+l+" in "+a.name)}else{const l=q.ValueType[o.valueType];throw new Co.StoryException("Cannot mix Lists and "+l+" values in this operation")}}else for(let s of e){let l=qt.asOrThrows(s,q.Value).Cast(t);r.push(l)}return r}static Identity(e){return e}static GenerateNativeFunctionsIfNecessary(){if(this._nativeFunctions==null){this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,(i,r)=>i+r),this.AddIntBinaryOp(this.Subtract,(i,r)=>i-r),this.AddIntBinaryOp(this.Multiply,(i,r)=>i*r),this.AddIntBinaryOp(this.Divide,(i,r)=>Math.floor(i/r)),this.AddIntBinaryOp(this.Mod,(i,r)=>i%r),this.AddIntUnaryOp(this.Negate,i=>-i),this.AddIntBinaryOp(this.Equal,(i,r)=>i==r),this.AddIntBinaryOp(this.Greater,(i,r)=>i>r),this.AddIntBinaryOp(this.Less,(i,r)=>i<r),this.AddIntBinaryOp(this.GreaterThanOrEquals,(i,r)=>i>=r),this.AddIntBinaryOp(this.LessThanOrEquals,(i,r)=>i<=r),this.AddIntBinaryOp(this.NotEquals,(i,r)=>i!=r),this.AddIntUnaryOp(this.Not,i=>i==0),this.AddIntBinaryOp(this.And,(i,r)=>i!=0&&r!=0),this.AddIntBinaryOp(this.Or,(i,r)=>i!=0||r!=0),this.AddIntBinaryOp(this.Max,(i,r)=>Math.max(i,r)),this.AddIntBinaryOp(this.Min,(i,r)=>Math.min(i,r)),this.AddIntBinaryOp(this.Pow,(i,r)=>Math.pow(i,r)),this.AddIntUnaryOp(this.Floor,te.Identity),this.AddIntUnaryOp(this.Ceiling,te.Identity),this.AddIntUnaryOp(this.Int,te.Identity),this.AddIntUnaryOp(this.Float,i=>i),this.AddFloatBinaryOp(this.Add,(i,r)=>i+r),this.AddFloatBinaryOp(this.Subtract,(i,r)=>i-r),this.AddFloatBinaryOp(this.Multiply,(i,r)=>i*r),this.AddFloatBinaryOp(this.Divide,(i,r)=>i/r),this.AddFloatBinaryOp(this.Mod,(i,r)=>i%r),this.AddFloatUnaryOp(this.Negate,i=>-i),this.AddFloatBinaryOp(this.Equal,(i,r)=>i==r),this.AddFloatBinaryOp(this.Greater,(i,r)=>i>r),this.AddFloatBinaryOp(this.Less,(i,r)=>i<r),this.AddFloatBinaryOp(this.GreaterThanOrEquals,(i,r)=>i>=r),this.AddFloatBinaryOp(this.LessThanOrEquals,(i,r)=>i<=r),this.AddFloatBinaryOp(this.NotEquals,(i,r)=>i!=r),this.AddFloatUnaryOp(this.Not,i=>i==0),this.AddFloatBinaryOp(this.And,(i,r)=>i!=0&&r!=0),this.AddFloatBinaryOp(this.Or,(i,r)=>i!=0||r!=0),this.AddFloatBinaryOp(this.Max,(i,r)=>Math.max(i,r)),this.AddFloatBinaryOp(this.Min,(i,r)=>Math.min(i,r)),this.AddFloatBinaryOp(this.Pow,(i,r)=>Math.pow(i,r)),this.AddFloatUnaryOp(this.Floor,i=>Math.floor(i)),this.AddFloatUnaryOp(this.Ceiling,i=>Math.ceil(i)),this.AddFloatUnaryOp(this.Int,i=>Math.floor(i)),this.AddFloatUnaryOp(this.Float,te.Identity),this.AddStringBinaryOp(this.Add,(i,r)=>i+r),this.AddStringBinaryOp(this.Equal,(i,r)=>i===r),this.AddStringBinaryOp(this.NotEquals,(i,r)=>i!==r),this.AddStringBinaryOp(this.Has,(i,r)=>i.includes(r)),this.AddStringBinaryOp(this.Hasnt,(i,r)=>!i.includes(r)),this.AddListBinaryOp(this.Add,(i,r)=>i.Union(r)),this.AddListBinaryOp(this.Subtract,(i,r)=>i.Without(r)),this.AddListBinaryOp(this.Has,(i,r)=>i.Contains(r)),this.AddListBinaryOp(this.Hasnt,(i,r)=>!i.Contains(r)),this.AddListBinaryOp(this.Intersect,(i,r)=>i.Intersect(r)),this.AddListBinaryOp(this.Equal,(i,r)=>i.Equals(r)),this.AddListBinaryOp(this.Greater,(i,r)=>i.GreaterThan(r)),this.AddListBinaryOp(this.Less,(i,r)=>i.LessThan(r)),this.AddListBinaryOp(this.GreaterThanOrEquals,(i,r)=>i.GreaterThanOrEquals(r)),this.AddListBinaryOp(this.LessThanOrEquals,(i,r)=>i.LessThanOrEquals(r)),this.AddListBinaryOp(this.NotEquals,(i,r)=>!i.Equals(r)),this.AddListBinaryOp(this.And,(i,r)=>i.Count>0&&r.Count>0),this.AddListBinaryOp(this.Or,(i,r)=>i.Count>0||r.Count>0),this.AddListUnaryOp(this.Not,i=>i.Count==0?1:0),this.AddListUnaryOp(this.Invert,i=>i.inverse),this.AddListUnaryOp(this.All,i=>i.all),this.AddListUnaryOp(this.ListMin,i=>i.MinAsList()),this.AddListUnaryOp(this.ListMax,i=>i.MaxAsList()),this.AddListUnaryOp(this.Count,i=>i.Count),this.AddListUnaryOp(this.ValueOfList,i=>i.maxItem.Value);let e=(i,r)=>i.Equals(r),t=(i,r)=>!i.Equals(r);this.AddOpToNativeFunc(this.Equal,2,q.ValueType.DivertTarget,e),this.AddOpToNativeFunc(this.NotEquals,2,q.ValueType.DivertTarget,t)}}AddOpFuncForType(e,t){this._operationFuncs==null&&(this._operationFuncs=new Map),this._operationFuncs.set(e,t)}static AddOpToNativeFunc(e,t,i,r){if(this._nativeFunctions===null)return Ot.throwNullException("NativeFunctionCall._nativeFunctions");let s=this._nativeFunctions.get(e);s||(s=new te(e,t),this._nativeFunctions.set(e,s)),s.AddOpFuncForType(i,r)}static AddIntBinaryOp(e,t){this.AddOpToNativeFunc(e,2,q.ValueType.Int,t)}static AddIntUnaryOp(e,t){this.AddOpToNativeFunc(e,1,q.ValueType.Int,t)}static AddFloatBinaryOp(e,t){this.AddOpToNativeFunc(e,2,q.ValueType.Float,t)}static AddFloatUnaryOp(e,t){this.AddOpToNativeFunc(e,1,q.ValueType.Float,t)}static AddStringBinaryOp(e,t){this.AddOpToNativeFunc(e,2,q.ValueType.String,t)}static AddListBinaryOp(e,t){this.AddOpToNativeFunc(e,2,q.ValueType.List,t)}static AddListUnaryOp(e,t){this.AddOpToNativeFunc(e,1,q.ValueType.List,t)}toString(){return'Native "'+this.name+'"'}}on.NativeFunctionCall=te;te.Add="+";te.Subtract="-";te.Divide="/";te.Multiply="*";te.Mod="%";te.Negate="_";te.Equal="==";te.Greater=">";te.Less="<";te.GreaterThanOrEquals=">=";te.LessThanOrEquals="<=";te.NotEquals="!=";te.Not="!";te.And="&&";te.Or="||";te.Min="MIN";te.Max="MAX";te.Pow="POW";te.Floor="FLOOR";te.Ceiling="CEILING";te.Int="INT";te.Float="FLOAT";te.Has="?";te.Hasnt="!?";te.Intersect="^";te.ListMin="LIST_MIN";te.ListMax="LIST_MAX";te.All="LIST_ALL";te.Count="LIST_COUNT";te.ValueOfList="LIST_VALUE";te.Invert="LIST_INVERT";te._nativeFunctions=null;var $l={},Gs={};Object.defineProperty(Gs,"__esModule",{value:!0});Gs.NumberExpression=void 0;const LN=Lt,cf=Ae;class MN extends LN.Expression{constructor(e,t){super();if(this.isInt=()=>this.subtype=="int",this.isFloat=()=>this.subtype=="float",this.isBool=()=>this.subtype=="bool",this.GenerateIntoContainer=i=>{this.isInt()?i.AddContent(new cf.IntValue(this.value)):this.isFloat()?i.AddContent(new cf.FloatValue(this.value)):this.isBool()&&i.AddContent(new cf.BoolValue(this.value))},this.toString=()=>String(this.value),typeof e=="number"&&!Number.isNaN(e)||typeof e=="boolean")this.value=e,this.subtype=t;else throw new Error("Unexpected object type in NumberExpression.")}get typeName(){return"Number"}}Gs.NumberExpression=MN;Object.defineProperty($l,"__esModule",{value:!0});$l.UnaryExpression=void 0;const FN=Lt,VN=on,qr=Gs,WN=re;class lp extends FN.Expression{constructor(e,t){super();this.op=t,this.GenerateIntoContainer=i=>{this.innerExpression.GenerateIntoContainer(i),i.AddContent(VN.NativeFunctionCall.CallWithName(this.nativeNameForOp))},this.toString=()=>this.nativeNameForOp+this.innerExpression,this.innerExpression=this.AddContent(e)}get nativeNameForOp(){return this.op==="-"?"_":this.op==="not"?"!":this.op}get typeName(){return"UnaryExpression"}}$l.UnaryExpression=lp;lp.WithInner=(n,e)=>{const t=WN.asOrNull(n,qr.NumberExpression);if(t){if(e==="-"){if(t.isInt())return new qr.NumberExpression(-t.value,"int");if(t.isFloat())return new qr.NumberExpression(-t.value,"float")}else if(e=="!"||e=="not"){if(t.isInt())return new qr.NumberExpression(t.value==0,"bool");if(t.isFloat())return new qr.NumberExpression(t.value==0,"bool");if(t.isBool())return new qr.NumberExpression(!t.value,"bool")}throw new Error("Unexpected operation or number type")}return new lp(n,e)};Object.defineProperty(Bl,"__esModule",{value:!0});Bl.BinaryExpression=void 0;const BN=Lt,jN=on,$N=$l,GN=re;class HN extends BN.Expression{constructor(e,t,i){super();this.opName=i,this.GenerateIntoContainer=r=>{this.leftExpression.GenerateIntoContainer(r),this.rightExpression.GenerateIntoContainer(r),this.opName=this.NativeNameForOp(this.opName),r.AddContent(jN.NativeFunctionCall.CallWithName(this.opName))},this.NativeNameForOp=r=>r==="and"?"&&":r==="or"?"||":r==="mod"?"%":r==="has"?"?":r==="hasnt"?"!?":r,this.toString=()=>`(${this.leftExpression} ${this.opName} ${this.rightExpression})`,this.leftExpression=this.AddContent(e),this.rightExpression=this.AddContent(t),this.opName=i}get typeName(){return"BinaryExpression"}ResolveReferences(e){if(super.ResolveReferences(e),this.NativeNameForOp(this.opName)==="?"){const t=GN.asOrNull(this.leftExpression,$N.UnaryExpression);t!==null&&(t.op==="not"||t.op==="!")&&this.Error(`Using 'not' or '!' here negates '${t.innerExpression}' rather than the result of the '?' or 'has' operator. You need to add parentheses around the (A ? B) expression.`)}}}Bl.BinaryExpression=HN;var Bh={},Ir={};Object.defineProperty(Ir,"__esModule",{value:!0});Ir.CharacterSet=void 0;class ap{constructor(e){this.set=new Set,this.Add=t=>this.set.add(t),this.AddRange=(t,i)=>{for(let r=t.charCodeAt(0);r<=i.charCodeAt(0);++r)this.Add(String.fromCharCode(r));return this},this.AddCharacters=t=>{if(typeof t=="string"||Array.isArray(t))for(const i of t)this.Add(i);else for(const i of t.set)this.Add(i);return this},e&&this.AddCharacters(e)}}Ir.CharacterSet=ap;ap.FromRange=(n,e)=>new ap().AddRange(n,e);Object.defineProperty(Bh,"__esModule",{value:!0});Bh.CharacterRange=void 0;const ry=Ir;class up{constructor(e,t,i=[]){if(this._start=e,this._end=t,this._correspondingCharSet=new ry.CharacterSet,this._excludes=new Set,this.ToCharacterSet=()=>{if(this._correspondingCharSet.set.size===0)for(let r=this.start.charCodeAt(0),s=String.fromCharCode(r);r<=this.end.charCodeAt(0);r+=1)this._excludes.has(s)||this._correspondingCharSet.AddCharacters(s);return this._correspondingCharSet},i instanceof ry.CharacterSet)this._excludes=i.set;else for(const r of i)this._excludes.add(r)}get start(){return this._start}get end(){return this._end}}Bh.CharacterRange=up;up.Define=(n,e,t=[])=>new up(n,e,t);var Dr={},Hs={};Object.defineProperty(Hs,"__esModule",{value:!0});Hs.ChoicePoint=void 0;const zN=mt,UN=Mt,ff=We;class qN extends zN.InkObject{constructor(e=!0){super();this._pathOnChoice=null,this.hasCondition=!1,this.hasStartContent=!1,this.hasChoiceOnlyContent=!1,this.isInvisibleDefault=!1,this.onceOnly=!0,this.onceOnly=e}get pathOnChoice(){if(this._pathOnChoice!=null&&this._pathOnChoice.isRelative){let e=this.choiceTarget;e&&(this._pathOnChoice=e.path)}return this._pathOnChoice}set pathOnChoice(e){this._pathOnChoice=e}get choiceTarget(){return this._pathOnChoice===null?ff.throwNullException("ChoicePoint._pathOnChoice"):this.ResolvePath(this._pathOnChoice).container}get pathStringOnChoice(){return this.pathOnChoice===null?ff.throwNullException("ChoicePoint.pathOnChoice"):this.CompactPathString(this.pathOnChoice)}set pathStringOnChoice(e){this.pathOnChoice=new UN.Path(e)}get flags(){let e=0;return this.hasCondition&&(e|=1),this.hasStartContent&&(e|=2),this.hasChoiceOnlyContent&&(e|=4),this.isInvisibleDefault&&(e|=8),this.onceOnly&&(e|=16),e}set flags(e){this.hasCondition=(e&1)>0,this.hasStartContent=(e&2)>0,this.hasChoiceOnlyContent=(e&4)>0,this.isInvisibleDefault=(e&8)>0,this.onceOnly=(e&16)>0}toString(){if(this.pathOnChoice===null)return ff.throwNullException("ChoicePoint.pathOnChoice");let e=this.pathOnChoice.toString();return"Choice: -> "+e}}Hs.ChoicePoint=qN;var mn={},Rr={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.PushPopType=void 0,function(e){e[e.Tunnel=0]="Tunnel",e[e.Function=1]="Function",e[e.FunctionEvaluationFromGame=2]="FunctionEvaluationFromGame"}(n.PushPopType||(n.PushPopType={}))})(Rr);var Lr={};Object.defineProperty(Lr,"__esModule",{value:!0});Lr.Pointer=void 0;const KN=Mt;class tl{constructor(){this.container=null,this.index=-1,arguments.length===2&&(this.container=arguments[0],this.index=arguments[1])}Resolve(){return this.index<0?this.container:this.container==null?null:this.container.content.length==0?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}get isNull(){return this.container==null}get path(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new KN.Path.Component(this.index)):this.container.path}toString(){return this.container?"Ink Pointer -> "+this.container.path.toString()+" -- index "+this.index:"Ink Pointer (null)"}copy(){return new tl(this.container,this.index)}static StartOf(e){return new tl(e,0)}static get Null(){return new tl(null,-1)}}Lr.Pointer=tl;Object.defineProperty(mn,"__esModule",{value:!0});mn.Divert=void 0;const JN=Mt,YN=Rr,XN=ii,QN=mt,df=Lr,sy=Be,Da=We;class jm extends QN.InkObject{constructor(e){super();this._targetPath=null,this._targetPointer=df.Pointer.Null,this.variableDivertName=null,this.pushesToStack=!1,this.stackPushType=0,this.isExternal=!1,this.externalArgs=0,this.isConditional=!1,this.pushesToStack=!1,typeof e!="undefined"&&(this.pushesToStack=!0,this.stackPushType=e)}get targetPath(){if(this._targetPath!=null&&this._targetPath.isRelative){let e=this.targetPointer.Resolve();e&&(this._targetPath=e.path)}return this._targetPath}set targetPath(e){this._targetPath=e,this._targetPointer=df.Pointer.Null}get targetPointer(){if(this._targetPointer.isNull){let e=this.ResolvePath(this._targetPath).obj;if(this._targetPath===null)return Da.throwNullException("this._targetPath");if(this._targetPath.lastComponent===null)return Da.throwNullException("this._targetPath.lastComponent");if(this._targetPath.lastComponent.isIndex){if(e===null)return Da.throwNullException("targetObj");this._targetPointer.container=e.parent instanceof sy.Container?e.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=df.Pointer.StartOf(e instanceof sy.Container?e:null)}return this._targetPointer.copy()}get targetPathString(){return this.targetPath==null?null:this.CompactPathString(this.targetPath)}set targetPathString(e){e==null?this.targetPath=null:this.targetPath=new JN.Path(e)}get hasVariableTarget(){return this.variableDivertName!=null}Equals(e){let t=e;return t instanceof jm&&this.hasVariableTarget==t.hasVariableTarget?this.hasVariableTarget?this.variableDivertName==t.variableDivertName:this.targetPath===null?Da.throwNullException("this.targetPath"):this.targetPath.Equals(t.targetPath):!1}toString(){if(this.hasVariableTarget)return"Divert(variable: "+this.variableDivertName+")";if(this.targetPath==null)return"Divert(null)";{let e=new XN.StringBuilder,t=this.targetPath.toString();return e.Append("Divert"),this.isConditional&&e.Append("?"),this.pushesToStack&&(this.stackPushType==YN.PushPopType.Function?e.Append(" function"):e.Append(" tunnel")),e.Append(" -> "),e.Append(this.targetPathString),e.Append(" ("),e.Append(t),e.Append(")"),e.toString()}}}mn.Divert=jm;var si={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SymbolType=void 0,function(e){e[e.Arg=0]="Arg",e[e.Knot=1]="Knot",e[e.List=2]="List",e[e.ListItem=3]="ListItem",e[e.SubFlowAndWeave=4]="SubFlowAndWeave",e[e.Temp=5]="Temp",e[e.Var=6]="Var"}(n.SymbolType||(n.SymbolType={}))})(si);var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.VariableAssignment=void 0;const ZN=mt;class eI extends ZN.InkObject{constructor(e,t){super();this.variableName=e||null,this.isNewDeclaration=!!t,this.isGlobal=!1}toString(){return"VarAssign to "+this.variableName}}Fn.VariableAssignment=eI;Object.defineProperty(Dr,"__esModule",{value:!0});Dr.Choice=void 0;const tI=Hs,Ra=Be,di=bt,pf=mn,oy=Ae,nI=ke,iI=si,ly=Fn;class rI extends nI.ParsedObject{constructor(e,t,i){super();this._condition=null,this._innerContentContainer=null,this._outerContainer=null,this._runtimeChoice=null,this._returnToR1=null,this._returnToR2=null,this._r1Label=null,this._r2Label=null,this._divertToStartContentOuter=null,this._divertToStartContentInner=null,this._startContentRuntimeContainer=null,this.isInvisibleDefault=!1,this.hasWeaveStyleInlineBrackets=!1,this.GenerateRuntimeObject=()=>{if(this._outerContainer=new Ra.Container,this._runtimeChoice=new tI.ChoicePoint(this.onceOnly),this._runtimeChoice.isInvisibleDefault=this.isInvisibleDefault,(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(di.ControlCommand.EvalStart()),this.startContent){this._returnToR1=new oy.DivertTargetValue,this._outerContainer.AddContent(this._returnToR1);const r=new ly.VariableAssignment("$r",!0);this._outerContainer.AddContent(r),this._outerContainer.AddContent(di.ControlCommand.BeginString()),this._divertToStartContentOuter=new pf.Divert,this._outerContainer.AddContent(this._divertToStartContentOuter),this._startContentRuntimeContainer=this.startContent.GenerateRuntimeObject(),this._startContentRuntimeContainer.name="s";const s=new pf.Divert;s.variableDivertName="$r",this._startContentRuntimeContainer.AddContent(s),this._outerContainer.AddToNamedContentOnly(this._startContentRuntimeContainer),this._r1Label=new Ra.Container,this._r1Label.name="$r1",this._outerContainer.AddContent(this._r1Label),this._outerContainer.AddContent(di.ControlCommand.EndString()),this._runtimeChoice.hasStartContent=!0}if(this.choiceOnlyContent){this._outerContainer.AddContent(di.ControlCommand.BeginString());const r=this.choiceOnlyContent.GenerateRuntimeObject();this._outerContainer.AddContentsOfContainer(r),this._outerContainer.AddContent(di.ControlCommand.EndString()),this._runtimeChoice.hasChoiceOnlyContent=!0}if(this.condition&&(this.condition.GenerateIntoContainer(this._outerContainer),this._runtimeChoice.hasCondition=!0),(this.startContent||this.choiceOnlyContent||this.condition)&&this._outerContainer.AddContent(di.ControlCommand.EvalEnd()),this._outerContainer.AddContent(this._runtimeChoice),this._innerContentContainer=new Ra.Container,this.startContent){this._returnToR2=new oy.DivertTargetValue,this._innerContentContainer.AddContent(di.ControlCommand.EvalStart()),this._innerContentContainer.AddContent(this._returnToR2),this._innerContentContainer.AddContent(di.ControlCommand.EvalEnd());const r=new ly.VariableAssignment("$r",!0);this._innerContentContainer.AddContent(r),this._divertToStartContentInner=new pf.Divert,this._innerContentContainer.AddContent(this._divertToStartContentInner),this._r2Label=new Ra.Container,this._r2Label.name="$r2",this._innerContentContainer.AddContent(this._r2Label)}if(this.innerContent){const r=this.innerContent.GenerateRuntimeObject();this._innerContentContainer.AddContentsOfContainer(r)}return this.story.countAllVisits&&(this._innerContentContainer.visitsShouldBeCounted=!0),this._innerContentContainer.countingAtStartOnly=!0,this._outerContainer},this.toString=()=>this.choiceOnlyContent!==null?`* ${this.startContent}[${this.choiceOnlyContent}]...`:`* ${this.startContent}...`,this.startContent=e,this.choiceOnlyContent=t,this.innerContent=i,this.indentationDepth=1,e&&this.AddContent(this.startContent),t&&this.AddContent(this.choiceOnlyContent),i&&this.AddContent(this.innerContent),this.onceOnly=!0}get runtimeChoice(){if(!this._runtimeChoice)throw new Error;return this._runtimeChoice}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get condition(){return this._condition}set condition(e){this._condition=e,e&&this.AddContent(e)}get runtimeContainer(){return this._innerContentContainer}get innerContentContainer(){return this._innerContentContainer}get containerForCounting(){return this._innerContentContainer}get runtimePath(){if(!this.innerContentContainer||!this.innerContentContainer.path)throw new Error;return this.innerContentContainer.path}get typeName(){return"Choice"}ResolveReferences(e){var t;if(this._innerContentContainer&&(this.runtimeChoice.pathOnChoice=this._innerContentContainer.path,this.onceOnly&&(this._innerContentContainer.visitsShouldBeCounted=!0)),this._returnToR1){if(!this._r1Label)throw new Error;this._returnToR1.targetPath=this._r1Label.path}if(this._returnToR2){if(!this._r2Label)throw new Error;this._returnToR2.targetPath=this._r2Label.path}if(this._divertToStartContentOuter){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentOuter.targetPath=this._startContentRuntimeContainer.path}if(this._divertToStartContentInner){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentInner.targetPath=this._startContentRuntimeContainer.path}super.ResolveReferences(e),this.identifier&&(((t=this.identifier)===null||t===void 0?void 0:t.name)||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,iI.SymbolType.SubFlowAndWeave)}}Dr.Choice=rI;var jh={},$m={},$h={},Gh={};Object.defineProperty(Gh,"__esModule",{value:!0});Gh.StringParserElement=void 0;class Ol{constructor(){this.characterIndex=0,this.characterInLineIndex=0,this.lineIndex=0,this.reportedErrorInScope=!1,this.uniqueId=0,this.customFlags=0,this.CopyFrom=e=>{Ol._uniqueIdCounter++,this.uniqueId=Ol._uniqueIdCounter,this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.customFlags=e.customFlags,this.reportedErrorInScope=!1},this.SquashFrom=e=>{this.characterIndex=e.characterIndex,this.characterInLineIndex=e.characterInLineIndex,this.lineIndex=e.lineIndex,this.reportedErrorInScope=e.reportedErrorInScope}}}Gh.StringParserElement=Ol;Ol._uniqueIdCounter=1e3;Object.defineProperty($h,"__esModule",{value:!0});$h.StringParserState=void 0;const ay=Gh;class sI{constructor(){this._stack=[],this._numElements=0,this.StringParserState=()=>{this._stack=new Array(200);for(let i=0;i<200;++i)this._stack[i]=new ay.StringParserElement;this._numElements=1},this.Push=()=>{if(this._numElements>=this._stack.length&&this._numElements>0)throw new Error("Stack overflow in parser state.");const t=this._stack[this._numElements-1],i=this._stack[this._numElements];return this._numElements++,i.CopyFrom(t),i.uniqueId},this.Pop=t=>{if(this._numElements==1)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");if(this.currentElement.uniqueId!=t)throw new Error("Mismatched rule IDs while Poping - do you have mismatched Begin/Succeed/Fail?");this._numElements-=1},this.Peek=t=>{if(this.currentElement.uniqueId!=t)throw new Error("Mismatched rule IDs while Peeking - do you have mismatched Begin/Succeed/Fail?");return this._stack[this._numElements-1]},this.PeekPenultimate=()=>this._numElements>=2?this._stack[this._numElements-2]:null,this.Squash=()=>{if(this._numElements<2)throw new Error("Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?");const t=this._stack[this._numElements-2],i=this._stack[this._numElements-1];t.SquashFrom(i),this._numElements-=1},this.NoteErrorReported=()=>{for(const t of this._stack)t.reportedErrorInScope=!0};const e=200;for(let t=0;t<e;t++)this._stack[t]=new ay.StringParserElement;this._numElements=1}get currentElement(){return this._stack[this._numElements-1]}get lineIndex(){return this.currentElement.lineIndex}set lineIndex(e){this.currentElement.lineIndex=e}get characterIndex(){return this.currentElement.characterIndex}set characterIndex(e){this.currentElement.characterIndex=e}get characterInLineIndex(){return this.currentElement.characterInLineIndex}set characterInLineIndex(e){this.currentElement.characterInLineIndex=e}get customFlags(){return this.currentElement.customFlags}set customFlags(e){this.currentElement.customFlags=e}get errorReportedAlreadyInScope(){return this.currentElement.reportedErrorInScope}get stackHeight(){return this._numElements}}$h.StringParserState=sI;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.StringParser=n.ParseSuccess=void 0;const e=Ir,t=$h;n.ParseSuccess=Symbol("ParseSuccessStruct");class i{constructor(s){this.ParseRule=null,this.errorHandler=null,this.hadError=!1,this.BeginRule=()=>this.state.Push(),this.FailRule=l=>(this.state.Pop(l),null),this.CancelRule=l=>{this.state.Pop(l)},this.SucceedRule=(l,a=null)=>{const u=this.state.Peek(l),h=this.state.PeekPenultimate();this.RuleDidSucceed&&this.RuleDidSucceed(a,h,u),this.state.Squash();let c=a;return c===null&&(c=i.ParseSuccess),c},this.Expect=(l,a=null,u=null)=>{let h=this.ParseObject(l);if(h===null){a===null&&(a=l.name);let c;const f=this.LineRemainder();f===null||f.length===0?c="end of line":c=`'${f}'`,this.Error(`Expected ${a} but saw ${c}`),u!==null&&(h=u())}return h},this.Error=(l,a=!1)=>{this.ErrorOnLine(l,this.lineIndex+1,a)},this.ErrorWithParsedObject=(l,a,u=!1)=>{this.ErrorOnLine(l,a.debugMetadata?a.debugMetadata.startLineNumber:-1,u)},this.ErrorOnLine=(l,a,u)=>{if(!this.state.errorReportedAlreadyInScope){const h=u?"Warning":"Error";if(this.errorHandler)this.errorHandler(l,this.index,a-1,u);else throw new Error(`${h} on line ${a}: ${l}`);this.state.NoteErrorReported()}u||(this.hadError=!0)},this.Warning=l=>this.Error(l,!0),this.LineRemainder=()=>this.Peek(()=>this.ParseUntilCharactersFromString(`
\r`)),this.SetFlag=(l,a)=>{a?this.state.customFlags|=l:this.state.customFlags&=~l},this.GetFlag=l=>Boolean(this.state.customFlags&l),this.ParseObject=l=>{const a=this.BeginRule(),u=this.state.stackHeight,h=l();if(u!==this.state.stackHeight)throw new Error("Mismatched Begin/Fail/Succeed rules");return h===null?this.FailRule(a):(this.SucceedRule(a,h),h)},this.Parse=l=>{const a=this.BeginRule(),u=l();return u===null?(this.FailRule(a),null):(this.SucceedRule(a,u),u)},this.OneOf=l=>{for(const a of l){const u=this.ParseObject(a);if(u!==null)return u}return null},this.OneOrMore=l=>{const a=[];let u=null;do u=this.ParseObject(l),u!==null&&a.push(u);while(u!==null);return a.length>0?a:null},this.Optional=l=>()=>this.ParseObject(l)||i.ParseSuccess,this.Exclude=l=>()=>this.ParseObject(l)&&i.ParseSuccess,this.OptionalExclude=l=>()=>(this.ParseObject(l),i.ParseSuccess),this.String=l=>()=>this.ParseString(l),this.TryAddResultToList=(l,a,u=!0)=>{if(l!==i.ParseSuccess){if(u&&Array.isArray(l)){const h=l;if(h!==null){for(const c of h)a.push(c);return}}a.push(l)}},this.Interleave=(l,a,u=null,h=!0)=>{const c=this.BeginRule(),f=[],d=this.ParseObject(l);if(d===null)return this.FailRule(c);this.TryAddResultToList(d,f,h);let m=null,w=null;do{if(u!==null&&this.Peek(u)!==null||(m=this.ParseObject(a),m===null))break;if(this.TryAddResultToList(m,f,h),w=null,m!==null){if(w=this.ParseObject(l),w===null)break;this.TryAddResultToList(w,f,h)}}while((m!==null||w!==null)&&!(m===i.ParseSuccess&&w==i.ParseSuccess)&&this.remainingLength>0);return f.length===0?this.FailRule(c):this.SucceedRule(c,f)},this.ParseString=l=>{if(l.length>this.remainingLength)return null;const a=this.BeginRule();let u=this.index,h=this.characterInLineIndex,c=this.lineIndex,f=!0;for(let d=0;d<l.length;d+=1){const m=l[d];if(this._chars[u]!==m){f=!1;break}m===`
`&&(c++,h=-1),u++,h++}return this.index=u,this.characterInLineIndex=h,this.lineIndex=c,f?this.SucceedRule(a,l):this.FailRule(a)},this.ParseSingleCharacter=()=>{if(this.remainingLength>0){const l=this._chars[this.index];return l===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1,l}return"0"},this.ParseUntilCharactersFromString=(l,a=-1)=>this.ParseCharactersFromString(l,!1,a),this.ParseUntilCharactersFromCharSet=(l,a=-1)=>this.ParseCharactersFromCharSet(l,!1,a),this.ParseCharactersFromString=(l,a=-1,u=-1)=>{const h=new e.CharacterSet(l);return typeof a=="number"?this.ParseCharactersFromCharSet(h,!0,a):this.ParseCharactersFromCharSet(h,a,u)},this.ParseCharactersFromCharSet=(l,a=!0,u=-1)=>{u===-1&&(u=Number.MAX_SAFE_INTEGER);const h=this.index;let c=this.index,f=this.characterInLineIndex,d=this.lineIndex,m=0;for(;c<this._chars.length&&l.set.has(this._chars[c])===a&&m<u;)this._chars[c]===`
`&&(d+=1,f=-1),c+=1,f+=1,m+=1;return this.index=c,this.characterInLineIndex=f,this.lineIndex=d,this.index>h?this._chars.slice(h,this.index).join(""):null},this.Peek=l=>{const a=this.BeginRule(),u=l();return this.CancelRule(a),u},this.ParseInt=()=>{const l=this.index,a=this.characterInLineIndex,u=this.ParseString("-")!==null;this.ParseCharactersFromString(" 	");const h=this.ParseCharactersFromCharSet(i.numbersCharacterSet);if(h===null)return this.index=l,this.characterInLineIndex=a,null;let c;return Number.isNaN(Number(h))?(this.Error("Failed to read integer value: "+h+". Perhaps it's out of the range of acceptable numbers ink supports? ("+Number.MIN_SAFE_INTEGER+" to "+Number.MAX_SAFE_INTEGER+")"),null):(c=Number(h),u?-c:c)},this.ParseFloat=()=>{const l=this.index,a=this.characterInLineIndex,u=this.ParseInt();if(u!==null&&this.ParseString(".")!==null){const h=this.ParseCharactersFromCharSet(i.numbersCharacterSet);return Number(`${u}.${h}`)}return this.index=l,this.characterInLineIndex=a,null},this.ParseNewline=()=>{const l=this.BeginRule();return this.ParseString("\r"),this.ParseString(`
`)===null?this.FailRule(l):this.SucceedRule(l,`
`)};const o=this.PreProcessInputString(s);this.state=new t.StringParserState,s?this._chars=o.split(""):this._chars=[],this.inputString=o}get currentCharacter(){return this.index>=0&&this.remainingLength>0?this._chars[this.index]:"0"}PreProcessInputString(s){return s}get endOfInput(){return this.index>=this._chars.length}get remainingString(){return this._chars.slice(this.index,this.index+this.remainingLength).join("")}get remainingLength(){return this._chars.length-this.index}get lineIndex(){return this.state.lineIndex}set lineIndex(s){this.state.lineIndex=s}set characterInLineIndex(s){this.state.characterInLineIndex=s}get characterInLineIndex(){return this.state.characterInLineIndex}get index(){return this.state.characterIndex}set index(s){this.state.characterIndex=s}ParseUntil(s,o=null,l=null){const a=this.BeginRule(),u=new e.CharacterSet;o!==null&&(u.set=new Set([...u.set.values(),...o.set.values()])),l!==null&&(u.set=new Set([...u.set.values(),...l.set.values()]));let h="",c=null;do{const f=this.ParseUntilCharactersFromCharSet(u);if(f&&(h+=f),c=this.Peek(s),c!==null)break;{if(this.endOfInput)break;const d=this.currentCharacter;if(o!==null&&o.set.has(d)){h+=d,d===`
`&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1;continue}else break}}while(!0);return h.length>0?this.SucceedRule(a,String(h)):this.FailRule(a)}}n.StringParser=i,i.ParseSuccess=n.ParseSuccess,i.numbersCharacterSet=new e.CharacterSet("0123456789")})($m);Object.defineProperty(jh,"__esModule",{value:!0});jh.CommentEliminator=void 0;const mf=Ir,oI=$m;class lI extends oI.StringParser{constructor(){super(...arguments);this._commentOrNewlineStartCharacter=new mf.CharacterSet(`/\r
`),this._commentBlockEndCharacter=new mf.CharacterSet("*"),this._newlineCharacters=new mf.CharacterSet(`
\r`),this.Process=()=>{const e=this.Interleave(this.Optional(this.CommentsAndNewlines),this.Optional(this.MainInk));return e!==null?e.join(""):""},this.MainInk=()=>this.ParseUntil(this.CommentsAndNewlines,this._commentOrNewlineStartCharacter,null),this.CommentsAndNewlines=()=>{let e=this.Interleave(this.Optional(this.ParseNewline),this.Optional(this.ParseSingleComment));return e!==null?e.join(""):null},this.ParseSingleComment=()=>this.OneOf([this.EndOfLineComment,this.BlockComment]),this.EndOfLineComment=()=>this.ParseString("//")===null?null:(this.ParseUntilCharactersFromCharSet(this._newlineCharacters),""),this.BlockComment=()=>{if(this.ParseString("/*")===null)return null;const e=this.lineIndex,t=this.ParseUntil(this.String("*/"),this._commentBlockEndCharacter,null);return this.endOfInput||this.ParseString("*/"),t!=null?`
`.repeat(this.lineIndex-e):null}}PreProcessInputString(e){return e}}jh.CommentEliminator=lI;var zs={};Object.defineProperty(zs,"__esModule",{value:!0});zs.Conditional=void 0;const aI=Be,uy=bt,uI=ke;class hI extends uI.ParsedObject{constructor(e,t){super();this.initialCondition=e,this.branches=t,this._reJoinTarget=null,this.GenerateRuntimeObject=()=>{const i=new aI.Container;this.initialCondition&&i.AddContent(this.initialCondition.runtimeObject);for(const r of this.branches){const s=r.runtimeObject;i.AddContent(s)}return this.initialCondition!==null&&this.branches[0].ownExpression!==null&&!this.branches[this.branches.length-1].isElse&&i.AddContent(uy.ControlCommand.PopEvaluatedValue()),this._reJoinTarget=uy.ControlCommand.NoOp(),i.AddContent(this._reJoinTarget),i},this.initialCondition&&this.AddContent(this.initialCondition),this.branches!==null&&this.AddContent(this.branches)}get typeName(){return"Conditional"}ResolveReferences(e){const t=this._reJoinTarget.path;for(const i of this.branches){if(!i.returnDivert)throw new Error;i.returnDivert.targetPath=t}super.ResolveReferences(e)}}zs.Conditional=hI;var Gl={},oi={};Object.defineProperty(oi,"__esModule",{value:!0});oi.Text=void 0;const cI=ke,fI=Ae;class dI extends cI.ParsedObject{constructor(e){super();this.text=e,this.GenerateRuntimeObject=()=>new fI.StringValue(this.text),this.toString=()=>this.text}get typeName(){return"Text"}}oi.Text=dI;var li={},Us={};Object.defineProperty(Us,"__esModule",{value:!0});Us.ConstantDeclaration=void 0;const pI=ke,mI=si;class gI extends pI.ParsedObject{constructor(e,t){super();this._expression=null,this.GenerateRuntimeObject=()=>null,this.constantIdentifier=e,t&&(this._expression=this.AddContent(t))}get constantName(){var e;return(e=this.constantIdentifier)===null||e===void 0?void 0:e.name}get expression(){if(!this._expression)throw new Error;return this._expression}get typeName(){return"CONST"}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.constantIdentifier,mI.SymbolType.Var)}}Us.ConstantDeclaration=gI;var Mr={},Yi={},ln={},qs={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.FlowLevel=void 0,function(e){e[e.Story=0]="Story",e[e.Knot=1]="Knot",e[e.Stitch=2]="Stitch",e[e.WeavePoint=3]="WeavePoint"}(n.FlowLevel||(n.FlowLevel={}))})(qs);var Ks={};Object.defineProperty(Ks,"__esModule",{value:!0});Ks.Gather=void 0;const vI=Be,yI=ke,CI=si;class SI extends yI.ParsedObject{constructor(e,t){super();this.indentationDepth=t,this.GenerateRuntimeObject=()=>{const i=new vI.Container;if(i.name=this.name,this.story.countAllVisits&&(i.visitsShouldBeCounted=!0),i.countingAtStartOnly=!0,this.content)for(const r of this.content)i.AddContent(r.runtimeObject);return i},this.toString=()=>{var i,r;return`- ${((i=this.identifier)===null||i===void 0?void 0:i.name)?"("+((r=this.identifier)===null||r===void 0?void 0:r.name)+")":"gather"}`},e&&(this.identifier=e)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get runtimeContainer(){return this.runtimeObject}get typeName(){return"Gather"}ResolveReferences(e){super.ResolveReferences(e),this.identifier&&(this.identifier.name||"").length>0&&e.CheckForNamingCollisions(this,this.identifier,CI.SymbolType.SubFlowAndWeave)}}Ks.Gather=SI;var ai={};Object.defineProperty(ai,"__esModule",{value:!0});ai.Path=void 0;const La=re,hy=ln,Kr=qs,wI=li;class xI{constructor(e,t){this._dotSeparatedComponents=null,this.toString=()=>this.components===null||this.components.length===0?this.baseTargetLevel===Kr.FlowLevel.WeavePoint?"-> <next gather point>":"<invalid Path>":`-> ${this.dotSeparatedComponents}`,this.ResolveFromContext=i=>{if(this.components==null||this.components.length==0)return null;let r=this.ResolveBaseTarget(i);return r===null?null:this.components.length>1?this.ResolveTailComponents(r):r},this.ResolveBaseTarget=i=>{const r=this.firstComponent;let s=i;for(;s;){const o=s===i,l=this.GetChildFromContext(s,r,null,o);if(l)return l;s=s.parent}return null},this.ResolveTailComponents=i=>{let r=i;if(!this.components)return null;for(let s=1;s<this.components.length;++s){const o=this.components[s].name;let l,a=La.asOrNull(r,hy.FlowBase);if(a!==null?l=a.flowLevel+1:l=Kr.FlowLevel.WeavePoint,r=this.GetChildFromContext(r,o,l),r===null)break}return r},this.GetChildFromContext=(i,r,s,o=!1)=>{const l=s===null,a=La.asOrNull(i,wI.Weave);if(r&&a!==null&&(l||s===Kr.FlowLevel.WeavePoint))return a.WeavePointNamed(r);let u=La.asOrNull(i,hy.FlowBase);if(r&&u!==null){const h=o||u.flowLevel===Kr.FlowLevel.Knot;return u.ContentWithNameAtLevel(r,s,h)}return null},Object.values(Kr.FlowLevel).includes(e)?(this._baseTargetLevel=e,this.components=t||[]):Array.isArray(e)?(this._baseTargetLevel=null,this.components=e||[]):(this._baseTargetLevel=null,this.components=[e])}get baseTargetLevel(){return this.baseLevelIsAmbiguous?Kr.FlowLevel.Story:this._baseTargetLevel}get baseLevelIsAmbiguous(){return!this._baseTargetLevel}get firstComponent(){return this.components==null||!this.components.length?null:this.components[0].name}get numberOfComponents(){return this.components?this.components.length:0}get dotSeparatedComponents(){return this._dotSeparatedComponents==null&&(this._dotSeparatedComponents=(this.components?this.components:[]).map(e=>e.name).filter(La.filterUndef).join(".")),this._dotSeparatedComponents}get typeName(){return"Path"}}ai.Path=xI;var Hl={};Object.defineProperty(Hl,"__esModule",{value:!0});Hl.ReturnType=void 0;const bI=ke,EI=Be,gf=bt,kI=ri;class OI extends bI.ParsedObject{constructor(e=null){super();this.returnedExpression=null,this.GenerateRuntimeObject=()=>{const t=new EI.Container;return this.returnedExpression?t.AddContent(this.returnedExpression.runtimeObject):(t.AddContent(gf.ControlCommand.EvalStart()),t.AddContent(new kI.Void),t.AddContent(gf.ControlCommand.EvalEnd())),t.AddContent(gf.ControlCommand.PopFunction()),t},e&&(this.returnedExpression=this.AddContent(e))}get typeName(){return"ReturnType"}}Hl.ReturnType=OI;var Fr={};Object.defineProperty(Fr,"__esModule",{value:!0});Fr.ClosestFlowBase=void 0;function _I(n){let e=n.parent;for(;e;){if(e.hasOwnProperty("iamFlowbase")&&e.iamFlowbase())return e;e=e.parent}return null}Fr.ClosestFlowBase=_I;var Js={};Object.defineProperty(Js,"__esModule",{value:!0});Js.Identifier=void 0;class Gm{constructor(e){this.debugMetadata=null,this.toString=()=>this.name||"undefined identifer",this.name=e}get typeName(){return"Identifier"}static Done(){return new Gm("DONE")}}Js.Identifier=Gm;Object.defineProperty(ln,"__esModule",{value:!0});ln.FlowBase=void 0;const PI=Dr,vf=Mr,TI=Yi,Sn=qs,AI=Ks,NI=ke,II=ai,DI=Hl,RI=Be,LI=mn,MI=Fn,yf=si,FI=li,VI=Fr,WI=Js,cy=re;class sh extends NI.ParsedObject{constructor(e,t=null,i=null,r=!1,s=!1){super();this.isFunction=r,this._rootWeave=null,this._subFlowsByName=new Map,this._startingSubFlowDivert=null,this._startingSubFlowRuntime=null,this._firstChildFlow=null,this.variableDeclarations=new Map,this.identifier=null,this.args=null,this.iamFlowbase=()=>!0,this.SplitWeaveAndSubFlowContent=(o,l)=>{var a,u;const h=[],c=[];this._subFlowsByName=new Map;for(const d of o){const m=cy.asOrNull(d,sh);m?(this._firstChildFlow===null&&(this._firstChildFlow=m),c.push(d),((a=m.identifier)===null||a===void 0?void 0:a.name)&&this._subFlowsByName.set((u=m.identifier)===null||u===void 0?void 0:u.name,m)):h.push(d)}l&&h.push(new AI.Gather(null,1),new vf.Divert(new II.Path(WI.Identifier.Done())));const f=[];return h.length>0&&(this._rootWeave=new FI.Weave(h,0),f.push(this._rootWeave)),c.length>0&&f.push(...c),f},this.ResolveVariableWithName=(o,l)=>{var a;const u={},h=l===null?this:VI.ClosestFlowBase(l);if(h){if(h.args!==null){for(const c of h.args)if(((a=c.identifier)===null||a===void 0?void 0:a.name)===o)return u.found=!0,u.isArgument=!0,u.ownerFlow=h,u}if(h!==this.story&&h.variableDeclarations.has(o))return u.found=!0,u.ownerFlow=h,u.isTemporary=!0,u}return this.story.variableDeclarations.has(o)?(u.found=!0,u.ownerFlow=this.story,u.isGlobal=!0,u):(u.found=!1,u)},this.AddNewVariableDeclaration=o=>{const l=o.variableName;if(this.variableDeclarations.has(l)){const a=this.variableDeclarations.get(l);let u="";a.debugMetadata&&(u=` (${a.debugMetadata})`),this.Error(`found declaration variable '${l}' that was already declared${u}`,o,!1);return}this.variableDeclarations.set(o.variableName,o)},this.ResolveWeavePointNaming=()=>{this._rootWeave&&this._rootWeave.ResolveWeavePointNaming();for(const[,o]of this._subFlowsByName)o.hasOwnProperty("ResolveWeavePointNaming")&&o.ResolveWeavePointNaming()},this.GenerateRuntimeObject=()=>{var o;let l=null;this.isFunction?this.CheckForDisallowedFunctionFlowControl():(this.flowLevel===Sn.FlowLevel.Knot||this.flowLevel===Sn.FlowLevel.Stitch)&&(l=this.Find(DI.ReturnType)(),l!==null&&this.Error(`Return statements can only be used in knots that are declared as functions: == function ${this.identifier} ==`,l));const a=new RI.Container;a.name=(o=this.identifier)===null||o===void 0?void 0:o.name,this.story.countAllVisits&&(a.visitsShouldBeCounted=!0),this.GenerateArgumentVariableAssignments(a);let u=0;for(;this.content!==null&&u<this.content.length;){const h=this.content[u];if(h instanceof sh){const c=h,f=c.runtimeObject;u===0&&!c.hasParameters&&this.flowLevel===Sn.FlowLevel.Knot&&(this._startingSubFlowDivert=new LI.Divert,a.AddContent(this._startingSubFlowDivert),this._startingSubFlowRuntime=f);const d=f,m=a.namedContent.get(d.name)||null;if(m){const w=`${this.GetType()} already contains flow named '${d.name}' (at ${m.debugMetadata})`;this.Error(w,c)}a.AddToNamedContentOnly(d)}else h&&a.AddContent(h.runtimeObject);u+=1}return this.flowLevel!==Sn.FlowLevel.Story&&!this.isFunction&&this._rootWeave!==null&&l===null&&this._rootWeave.ValidateTermination(this.WarningInTermination),a},this.GenerateArgumentVariableAssignments=o=>{var l;if(!(this.args===null||this.args.length===0))for(let a=this.args.length-1;a>=0;--a){const u=((l=this.args[a].identifier)===null||l===void 0?void 0:l.name)||null,h=new MI.VariableAssignment(u,!0);o.AddContent(h)}},this.ContentWithNameAtLevel=(o,l=null,a=!1)=>{var u;if((l===this.flowLevel||l===null)&&o===((u=this.identifier)===null||u===void 0?void 0:u.name))return this;if(l===Sn.FlowLevel.WeavePoint||l===null){let c=null;if(this._rootWeave&&(c=this._rootWeave.WeavePointNamed(o),c))return c;if(l===Sn.FlowLevel.WeavePoint)return a?this.DeepSearchForAnyLevelContent(o):null}if(l!==null&&l<this.flowLevel)return null;let h=this._subFlowsByName.get(o)||null;return h&&(l===null||l===h.flowLevel)?h:a?this.DeepSearchForAnyLevelContent(o):null},this.DeepSearchForAnyLevelContent=o=>{const l=this.ContentWithNameAtLevel(o,Sn.FlowLevel.WeavePoint,!1);if(l)return l;for(const[,a]of this._subFlowsByName){const u=a.ContentWithNameAtLevel(o,null,!0);if(u)return u}return null},this.CheckForDisallowedFunctionFlowControl=()=>{this.flowLevel!==Sn.FlowLevel.Knot&&this.Error("Functions cannot be stitches - i.e. they should be defined as '== function myFunc ==' rather than internal to another knot.");for(const[a,u]of this._subFlowsByName)this.Error(`Functions may not contain stitches, but saw '${a}' within the function '${this.identifier}'`,u);if(!this._rootWeave)throw new Error;const o=this._rootWeave.FindAll(vf.Divert)();for(const a of o)!a.isFunctionCall&&!(a.parent instanceof TI.DivertTarget)&&this.Error(`Functions may not contain diverts, but saw '${a}'`,a);const l=this._rootWeave.FindAll(PI.Choice)();for(const a of l)this.Error(`Functions may not contain choices, but saw '${a}'`,a)},this.WarningInTermination=o=>{let l="Apparent loose end exists where the flow runs out. Do you need a '-> DONE' statement, choice or divert?";o.parent===this._rootWeave&&this._firstChildFlow&&(l=`${l} Note that if you intend to enter '${this._firstChildFlow.identifier}' next, you need to divert to it explicitly.`);const a=cy.asOrNull(o,vf.Divert);a&&a.isTunnel&&(l+=` When final tunnel to '${a.target} ->' returns it won't have anywhere to go.`),this.Warning(l,o)},this.toString=()=>`${this.typeName} '${this.identifier}'`,this.identifier=e,this.args=i,t===null&&(t=[]),this.PreProcessTopLevelObjects(t),t=this.SplitWeaveAndSubFlowContent(t,this.GetType()=="Story"&&!s),this.AddContent(t)}get hasParameters(){return this.args!==null&&this.args.length>0}get subFlowsByName(){return this._subFlowsByName}get typeName(){return this.isFunction?"Function":String(this.flowLevel)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}PreProcessTopLevelObjects(e){}ResolveReferences(e){var t,i;if(this._startingSubFlowDivert){if(!this._startingSubFlowRuntime)throw new Error;this._startingSubFlowDivert.targetPath=this._startingSubFlowRuntime.path}if(super.ResolveReferences(e),this.args!==null){for(const r of this.args)e.CheckForNamingCollisions(this,r.identifier,yf.SymbolType.Arg,"argument");for(let r=0;r<this.args.length;r+=1)for(let s=r+1;s<this.args.length;s+=1)((t=this.args[r].identifier)===null||t===void 0?void 0:t.name)==((i=this.args[s].identifier)===null||i===void 0?void 0:i.name)&&this.Error(`Multiple arguments with the same name: '${this.args[r].identifier}'`)}if(this.flowLevel!==Sn.FlowLevel.Story){const r=this.flowLevel===Sn.FlowLevel.Knot?yf.SymbolType.Knot:yf.SymbolType.SubFlowAndWeave;e.CheckForNamingCollisions(this,this.identifier,r)}}}ln.FlowBase=sh;var Vr={},Xi={},Ys={};Object.defineProperty(Ys,"__esModule",{value:!0});Ys.ContentList=void 0;const BI=Be,jI=ke,$I=oi,GI=re;class HI extends jI.ParsedObject{constructor(e,...t){super();this.dontFlatten=!1,this.TrimTrailingWhitespace=()=>{for(let i=this.content.length-1;i>=0;--i){const r=GI.asOrNull(this.content[i],$I.Text);if(r===null)break;if(r.text=r.text.replace(new RegExp(/[ \t]/g),""),r.text.length===0)this.content.splice(i,1);else break}},this.GenerateRuntimeObject=()=>{const i=new BI.Container;if(this.content!==null)for(const r of this.content){const s=r.runtimeObject;s&&i.AddContent(s)}return this.dontFlatten&&this.story.DontFlattenContainer(i),i},this.toString=()=>`ContentList(${this.content.join(", ")})`,e&&this.AddContent(e),t&&this.AddContent(t)}get runtimeContainer(){return this.runtimeObject}get typeName(){return"ContentList"}}Ys.ContentList=HI;var Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.VariableReference=void 0;const zI=mt,UI=Mt;class qI extends zI.InkObject{constructor(e=null){super();this.pathForCount=null,this.name=e}get containerForCount(){return this.pathForCount===null?null:this.ResolvePath(this.pathForCount).container}get pathStringForCount(){return this.pathForCount===null?null:this.CompactPathString(this.pathForCount)}set pathStringForCount(e){e===null?this.pathForCount=null:this.pathForCount=new UI.Path(e)}toString(){if(this.name!=null)return"var("+this.name+")";{let e=this.pathStringForCount;return"read_count("+e+")"}}}Wr.VariableReference=qI;Object.defineProperty(Xi,"__esModule",{value:!0});Xi.VariableReference=void 0;const KI=Ys,JI=Lt,fy=ln,YI=ai,XI=Wr,QI=li,ZI=Js,dy=re;class eD extends JI.Expression{constructor(e){super();this.pathIdentifiers=e,this._runtimeVarRef=null,this.isConstantReference=!1,this.isListItemReference=!1,this.GenerateIntoContainer=t=>{let i=this.story.constants.get(this.name);if(i){i.GenerateConstantIntoContainer(t),this.isConstantReference=!0;return}if(this._runtimeVarRef=new XI.VariableReference(this.name),this.path.length===1||this.path.length===2){let r="",s="";this.path.length===1?r=this.path[0]:(s=this.path[0],r=this.path[1]),this.story.ResolveListItem(s,r,this)&&(this.isListItemReference=!0)}t.AddContent(this._runtimeVarRef)},this.toString=()=>`{${this.path.join(".")}}`}get name(){return this.path.join(".")}get path(){return this.pathIdentifiers.map(e=>e.name).filter(dy.filterUndef)}get identifier(){if(!this.pathIdentifiers||this.pathIdentifiers.length==0)return null;const e=this.path.join(".");return new ZI.Identifier(e)}get runtimeVarRef(){return this._runtimeVarRef}get typeName(){return"ref"}ResolveReferences(e){if(super.ResolveReferences(e),this.isConstantReference||this.isListItemReference)return;const t=new YI.Path(this.pathIdentifiers),i=t.ResolveFromContext(this);if(i){if(!i.containerForCounting)throw new Error;if(i.containerForCounting.visitsShouldBeCounted=!0,this._runtimeVarRef===null)return;this._runtimeVarRef.pathForCount=i.runtimePath,this._runtimeVarRef.name=null;let r=dy.asOrNull(i,fy.FlowBase);r&&r.isFunction&&(parent instanceof QI.Weave||parent instanceof KI.ContentList||parent instanceof fy.FlowBase)&&this.Warning(`'${r.identifier}' being used as read count rather than being called as function. Perhaps you intended to write ${r.identifier}()`);return}if(this.path.length>1){let r=`Could not find target for read count: ${t}`;this.path.length<=2&&(r+=`, or couldn't find list item with the name ${this.path.join(",")}`),this.Error(r);return}e.ResolveVariableWithName(this.name,this).found||this.Error(`Unresolved variable: ${this}`,this)}}Xi.VariableReference=eD;Object.defineProperty(Vr,"__esModule",{value:!0});Vr.FunctionCall=void 0;const wn=bt,tD=Mr,nD=Yi,iD=Lt,rD=Je,sD=Ae,pu=on,py=Gs,oD=ai,lD=Ae,aD=Xi,Ma=re;class wx extends iD.Expression{constructor(e,t){super();this._divertTargetToCount=null,this._variableReferenceToCount=null,this.shouldPopReturnedValue=!1,this.GenerateIntoContainer=i=>{const r=this.story.ResolveList(this.name);let s=!1;if(this.isChoiceCount)this.args.length>0&&this.Error("The CHOICE_COUNT() function shouldn't take any arguments"),i.AddContent(wn.ControlCommand.ChoiceCount());else if(this.isTurns)this.args.length>0&&this.Error("The TURNS() function shouldn't take any arguments"),i.AddContent(wn.ControlCommand.Turns());else if(this.isTurnsSince||this.isReadCount){const o=Ma.asOrNull(this.args[0],nD.DivertTarget),l=Ma.asOrNull(this.args[0],aD.VariableReference);if(this.args.length!==1||o===null&&l===null){this.Error(`The ${this.name}() function should take one argument: a divert target to the target knot, stitch, gather or choice you want to check. e.g. TURNS_SINCE(-> myKnot)`);return}o?(this._divertTargetToCount=o,this.AddContent(this._divertTargetToCount),this._divertTargetToCount.GenerateIntoContainer(i)):l&&(this._variableReferenceToCount=l,this.AddContent(this._variableReferenceToCount),this._variableReferenceToCount.GenerateIntoContainer(i)),this.isTurnsSince?i.AddContent(wn.ControlCommand.TurnsSince()):i.AddContent(wn.ControlCommand.ReadCount())}else if(this.isRandom){this.args.length!==2&&this.Error("RANDOM should take 2 parameters: a minimum and a maximum integer");for(let o=0;o<this.args.length;o+=1){const l=Ma.asOrNull(this.args[o],py.NumberExpression);if(l&&!l.isInt()){const a=o===0?"minimum":"maximum";this.Error(`RANDOM's ${a} parameter should be an integer`)}this.args[o].GenerateIntoContainer(i)}i.AddContent(wn.ControlCommand.Random())}else if(this.isSeedRandom){this.args.length!==1&&this.Error("SEED_RANDOM should take 1 parameter - an integer seed");const o=Ma.asOrNull(this.args[0],py.NumberExpression);o&&!o.isInt()&&this.Error("SEED_RANDOM's parameter should be an integer seed"),this.args[0].GenerateIntoContainer(i),i.AddContent(wn.ControlCommand.SeedRandom())}else if(this.isListRange){this.args.length!==3&&this.Error("LIST_RANGE should take 3 parameters - a list, a min and a max");for(let o=0;o<this.args.length;o+=1)this.args[o].GenerateIntoContainer(i);i.AddContent(wn.ControlCommand.ListRange())}else if(this.isListRandom)this.args.length!==1&&this.Error("LIST_RANDOM should take 1 parameter - a list"),this.args[0].GenerateIntoContainer(i),i.AddContent(wn.ControlCommand.ListRandom());else if(pu.NativeFunctionCall.CallExistsWithName(this.name)){const o=pu.NativeFunctionCall.CallWithName(this.name);if(o.numberOfParameters!==this.args.length){let l=`${name} should take ${o.numberOfParameters} parameter`;o.numberOfParameters>1&&(l+="s"),this.Error(l)}for(let l=0;l<this.args.length;l+=1)this.args[l].GenerateIntoContainer(i);i.AddContent(pu.NativeFunctionCall.CallWithName(this.name))}else if(r!==null)if(this.args.length>1&&this.Error("Can currently only construct a list from one integer (or an empty list from a given list definition)"),this.args.length===1)i.AddContent(new lD.StringValue(this.name)),this.args[0].GenerateIntoContainer(i),i.AddContent(wn.ControlCommand.ListFromInt());else{const o=new rD.InkList;o.SetInitialOriginName(this.name),i.AddContent(new sD.ListValue(o))}else i.AddContent(this._proxyDivert.runtimeObject),s=!0;s||this.content.splice(this.content.indexOf(this._proxyDivert),1),this.shouldPopReturnedValue&&i.AddContent(wn.ControlCommand.PopEvaluatedValue())},this.toString=()=>{const i=this.args.join(", ");return`${this.name}(${i})`},this._proxyDivert=new tD.Divert(new oD.Path(e),t),this._proxyDivert.isFunctionCall=!0,this.AddContent(this._proxyDivert)}get proxyDivert(){return this._proxyDivert}get name(){return this._proxyDivert.target.firstComponent||""}get args(){return this._proxyDivert.args}get runtimeDivert(){return this._proxyDivert.runtimeDivert}get isChoiceCount(){return this.name==="CHOICE_COUNT"}get isTurns(){return this.name==="TURNS"}get isTurnsSince(){return this.name==="TURNS_SINCE"}get isRandom(){return this.name==="RANDOM"}get isSeedRandom(){return this.name==="SEED_RANDOM"}get isListRange(){return this.name==="LIST_RANGE"}get isListRandom(){return this.name==="LIST_RANDOM"}get isReadCount(){return this.name==="READ_COUNT"}get typeName(){return"FunctionCall"}ResolveReferences(e){if(super.ResolveReferences(e),!this.content.includes(this._proxyDivert)&&this.args!==null)for(const t of this.args)t.ResolveReferences(e);if(this._divertTargetToCount){const t=this._divertTargetToCount.divert,i=t.runtimeDivert.variableDivertName!=null;if(i){this.Error(`When getting the TURNS_SINCE() of a variable target, remove the '->' - i.e. it should just be TURNS_SINCE(${t.runtimeDivert.variableDivertName})`);return}const r=t.targetContent;if(r===null)i||this.Error(`Failed to find target for TURNS_SINCE: '${t.target}'`);else{if(!r.containerForCounting)throw new Error;r.containerForCounting.turnIndexShouldBeCounted=!0}}else if(this._variableReferenceToCount){const t=this._variableReferenceToCount.runtimeVarRef;if(!t)throw new Error;t.pathForCount!==null&&this.Error(`Should be '${name}'(-> '${this._variableReferenceToCount.name}). Usage without the '->' only makes sense for variable targets.`)}}}Vr.FunctionCall=wx;wx.IsBuiltIn=n=>pu.NativeFunctionCall.CallExistsWithName(n)?!0:n==="CHOICE_COUNT"||n==="TURNS_SINCE"||n==="TURNS"||n==="RANDOM"||n==="SEED_RANDOM"||n==="LIST_VALUE"||n==="LIST_RANDOM"||n==="READ_COUNT";var zl={};Object.defineProperty(zl,"__esModule",{value:!0});zl.MultipleConditionExpression=void 0;const uD=Lt,hD=on;class cD extends uD.Expression{constructor(e){super();this.GenerateIntoContainer=t=>{let i=!0;for(const r of this.subExpressions)r.GenerateIntoContainer(t),i||t.AddContent(hD.NativeFunctionCall.CallWithName("&&")),i=!1},this.AddContent(e)}get subExpressions(){return this.content}get typeName(){return"MultipleConditionExpression"}}zl.MultipleConditionExpression=cD;Object.defineProperty(Yi,"__esModule",{value:!0});Yi.DivertTarget=void 0;const fD=Bl,dD=Dr,pD=zs,mD=Gl,gD=Ae,Cf=Lt,vD=ln,my=Vr,yD=zl,gy=Xi,Sf=re;class nl extends Cf.Expression{constructor(e){super();this._runtimeDivert=null,this._runtimeDivertTargetValue=null,this.GenerateIntoContainer=t=>{this.divert.GenerateRuntimeObject(),this._runtimeDivert=this.divert.runtimeDivert,this._runtimeDivertTargetValue=new gD.DivertTargetValue,t.AddContent(this.runtimeDivertTargetValue)},this.Equals=t=>{const i=Sf.asOrNull(t,nl);if(!i||!this.divert.target||!i.divert.target)return!1;const r=this.divert.target.dotSeparatedComponents,s=i.divert.target.dotSeparatedComponents;return r===s},this.divert=this.AddContent(e)}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}get runtimeDivertTargetValue(){if(!this._runtimeDivertTargetValue)throw new Error;return this._runtimeDivertTargetValue}get typeName(){return"DivertTarget"}ResolveReferences(e){if(super.ResolveReferences(e),this.divert.isDone||this.divert.isEnd){this.Error("Can't use -> DONE or -> END as variable divert targets",this);return}let t=this;for(;t&&t instanceof Cf.Expression;){let r=!1,s=!1;const o=t.parent;if(o instanceof fD.BinaryExpression){const l=o;l.opName!=="=="&&l.opName!=="!="?r=!0:(l.leftExpression instanceof nl||l.leftExpression instanceof gy.VariableReference)&&(l.rightExpression instanceof nl||l.rightExpression instanceof gy.VariableReference)||(r=!0),s=!0}else if(o instanceof my.FunctionCall){const l=o;!l.isTurnsSince&&!l.isReadCount&&(r=!0),s=!0}else(o instanceof Cf.Expression||o instanceof yD.MultipleConditionExpression||o instanceof dD.Choice&&o.condition===t||o instanceof pD.Conditional||o instanceof mD.ConditionalSingleBranch)&&(r=!0,s=!0);if(r&&this.Error(`Can't use a divert target like that. Did you intend to call '${this.divert.target}' as a function: likeThis(), or check the read count: likeThis, with no arrows?`,this),s)break;t=o}if(this.runtimeDivert.hasVariableTarget){if(!this.divert.target)throw new Error;this.Error(`Since '${this.divert.target.dotSeparatedComponents}' is a variable, it shouldn't be preceded by '->' here.`)}this.runtimeDivert.targetPath&&(this.runtimeDivertTargetValue.targetPath=this.runtimeDivert.targetPath);let i=this.divert.targetContent;if(i!==null){let r=i.containerForCounting;if(r!==null){const o=Sf.asOrNull(this.parent,my.FunctionCall);o&&o.isTurnsSince||(r.visitsShouldBeCounted=!0),r.turnIndexShouldBeCounted=!0}let s=Sf.asOrNull(i,vD.FlowBase);if(s!=null&&s.args!==null)for(const o of s.args)o.isByReference&&this.Error(`Can't store a divert target to a knot or function that has by-reference arguments ('${s.identifier}' has 'ref ${o.identifier}').`)}}}Yi.DivertTarget=nl;Object.defineProperty(Mr,"__esModule",{value:!0});Mr.Divert=void 0;const CD=Be,So=bt,SD=mn,wf=Yi,xf=ln,wD=Vr,xD=ke,vy=ai,bD=Mt,yy=Rr,ED=Ae,Cy=Xi,kD=Fr,wo=re;class OD extends xD.ParsedObject{constructor(e,t){super();this.args=[],this.target=null,this.targetContent=null,this._runtimeDivert=null,this.isFunctionCall=!1,this.isEmpty=!1,this.isTunnel=!1,this.isThread=!1,this.GenerateRuntimeObject=()=>{if(this.isEnd)return So.ControlCommand.End();if(this.isDone)return So.ControlCommand.Done();this.runtimeDivert=new SD.Divert,this.ResolveTargetContent(),this.CheckArgumentValidity();const i=this.args!==null&&this.args.length>0;if(i||this.isFunctionCall||this.isTunnel||this.isThread){const r=new CD.Container;if(i){this.isFunctionCall||r.AddContent(So.ControlCommand.EvalStart());let s=null;this.targetContent&&(s=this.targetContent.args);for(let o=0;o<this.args.length;++o){const l=this.args[o];let a=null;if(s&&o<s.length&&(a=s[o]),a&&a.isByReference){const u=wo.asOrNull(l,Cy.VariableReference);if(!u){this.Error(`Expected variable name to pass by reference to 'ref ${a.identifier}' but saw ${l}`);break}const h=new vy.Path(u.pathIdentifiers);if(h.ResolveFromContext(this)){this.Error(`can't pass a read count by reference. '${h.dotSeparatedComponents}' is a knot/stitch/label, but '${this.target.dotSeparatedComponents}' requires the name of a VAR to be passed.`);break}const f=new ED.VariablePointerValue(u.name);r.AddContent(f)}else l.GenerateIntoContainer(r)}this.isFunctionCall||r.AddContent(So.ControlCommand.EvalEnd())}return this.isThread?r.AddContent(So.ControlCommand.StartThread()):(this.isFunctionCall||this.isTunnel)&&(this.runtimeDivert.pushesToStack=!0,this.runtimeDivert.stackPushType=this.isFunctionCall?yy.PushPopType.Function:yy.PushPopType.Tunnel),r.AddContent(this.runtimeDivert),r}return this.runtimeDivert},this.PathAsVariableName=()=>this.target?this.target.firstComponent:null,this.ResolveTargetContent=()=>{if(!(this.isEmpty||this.isEnd)&&this.targetContent===null){let i=this.PathAsVariableName();if(i!==null){const r=wo.asOrNull(kD.ClosestFlowBase(this),xf.FlowBase);if(r){const s=r.ResolveVariableWithName(i,this);if(s.found){if(s.isArgument&&s.ownerFlow&&s.ownerFlow.args){let o=s.ownerFlow.args.find(l=>{var a;return((a=l.identifier)===null||a===void 0?void 0:a.name)==i});o&&!o.isDivertTarget&&this.Error(`Since '${o.identifier}' is used as a variable divert target (on ${this.debugMetadata}), it should be marked as: -> ${o.identifier}`,s.ownerFlow)}this.runtimeDivert.variableDivertName=i;return}}}if(!this.target)throw new Error;this.targetContent=this.target.ResolveFromContext(this)}},this.CheckArgumentValidity=()=>{if(this.isEmpty)return;let i=0;if(this.args!==null&&this.args.length>0&&(i=this.args.length),this.targetContent===null)return;const r=wo.asOrNull(this.targetContent,xf.FlowBase);if(i===0&&(r===null||!r.hasParameters))return;if(r===null&&i>0){this.Error("target needs to be a knot or stitch in order to pass arguments");return}else if(r!==null&&(r.args===null||!r.args&&i>0)){this.Error(`target (${r.name}) doesn't take parameters`);return}else if(this.parent instanceof wf.DivertTarget){i>0&&this.Error("can't store arguments in a divert target variable");return}const s=r.args.length;if(s!==i){let o;i===0?o="but there weren't any passed to it":i<s?o=`but only got ${i}`:o=`but got ${i}`,this.Error(`to '${r.identifier}' requires ${s} arguments, ${o}`);return}for(let o=0;o<s;++o){const l=r.args[o],a=this.args[o];if(l.isDivertTarget){let u=wo.asOrNull(a,Cy.VariableReference);if(!(a instanceof wf.DivertTarget)&&u===null)this.Error(`Target '${r.identifier}' expects a divert target for the parameter named -> ${l.identifier} but saw ${a}`,a);else if(u){const h=new vy.Path(u.pathIdentifiers);h.ResolveFromContext(u)&&this.Error(`Passing read count of '${h.dotSeparatedComponents}' instead of a divert target. You probably meant '${h}'`)}}}if(r===null){this.Error("Can't call as a function or with arguments unless it's a knot or stitch");return}},this.CheckExternalArgumentValidity=i=>{const r=this.target?this.target.firstComponent:null,s=i.externals.get(r);if(!s)throw new Error("external not found");const o=s.argumentNames.length;let l=0;this.args&&(l=this.args.length),l!==o&&this.Error(`incorrect number of arguments sent to external function '${r}'. Expected ${o} but got ${l}`)},this.toString=()=>{let i="";if(this.target!==null)i+=this.target.toString();else return"-> <empty divert>";return this.isTunnel&&(i+=" ->"),this.isFunctionCall&&(i+=" ()"),i},e&&(this.target=e),t&&(this.args=t,this.AddContent(t))}get runtimeDivert(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}set runtimeDivert(e){this._runtimeDivert=e}get isEnd(){return Boolean(this.target&&this.target.dotSeparatedComponents==="END")}get isDone(){return Boolean(this.target&&this.target.dotSeparatedComponents==="DONE")}get typeName(){return"Divert"}ResolveReferences(e){if(this.isEmpty||this.isEnd||this.isDone)return;if(!this.runtimeDivert)throw new Error;this.targetContent&&(this.runtimeDivert.targetPath=this.targetContent.runtimePath),super.ResolveReferences(e);let t=wo.asOrNull(this.targetContent,xf.FlowBase);t&&(!t.isFunction&&this.isFunctionCall?super.Error(`${t.identifier} hasn't been marked as a function, but it's being called as one. Do you need to delcare the knot as '== function ${t.identifier} =='?`):t.isFunction&&!this.isFunctionCall&&!(this.parent instanceof wf.DivertTarget)&&super.Error(t.identifier+" can't be diverted to. It can only be called as a function since it's been marked as such: '"+t.identifier+"(...)'"));const i=this.targetContent!==null;let r=!1,s=!1;if(this.target){if(this.target.numberOfComponents===1){if(!this.target.firstComponent)throw new Error;if(r=wD.FunctionCall.IsBuiltIn(this.target.firstComponent),s=e.IsExternal(this.target.firstComponent),r||s){this.isFunctionCall||super.Error(`${this.target.firstComponent} must be called as a function: ~ ${this.target.firstComponent}()`),s&&(this.runtimeDivert.isExternal=!0,this.args!==null&&(this.runtimeDivert.externalArgs=this.args.length),this.runtimeDivert.pushesToStack=!1,this.runtimeDivert.targetPath=new bD.Path(this.target.firstComponent),this.CheckExternalArgumentValidity(e));return}}}else throw new Error;this.runtimeDivert.variableDivertName==null&&!i&&!r&&!s&&this.Error(`target not found: '${this.target}'`)}Error(e,t=null,i=!1){if(t!==this&&t){super.Error(e,t);return}this.isFunctionCall?super.Error(`Function call ${e}`,t,i):super.Error(`Divert ${e}`,t,i)}}Mr.Divert=OD;var Hh={};Object.defineProperty(Hh,"__esModule",{value:!0});Hh.GatherPointToResolve=void 0;class _D{constructor(e,t){this.divert=e,this.targetRuntimeObj=t}}Hh.GatherPointToResolve=_D;var Ul={},zh={};Object.defineProperty(zh,"__esModule",{value:!0});zh.SequenceDivertToResolve=void 0;class PD{constructor(e,t){this.divert=e,this.targetContent=t}}zh.SequenceDivertToResolve=PD;var Hm={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SequenceType=void 0,function(e){e[e.Stopping=1]="Stopping",e[e.Cycle=2]="Cycle",e[e.Shuffle=4]="Shuffle",e[e.Once=8]="Once"}(n.SequenceType||(n.SequenceType={}))})(Hm);Object.defineProperty(Ul,"__esModule",{value:!0});Ul.Sequence=void 0;const Sy=Be,un=bt,bf=mn,xo=Ae,Fa=on,TD=ke,AD=zh,Va=Hm,ND=li;class ID extends TD.ParsedObject{constructor(e,t){super();this.sequenceType=t,this._sequenceDivertsToResolve=[],this.GenerateRuntimeObject=()=>{const i=new Sy.Container;i.visitsShouldBeCounted=!0,i.countingAtStartOnly=!0,this._sequenceDivertsToResolve=[],i.AddContent(un.ControlCommand.EvalStart()),i.AddContent(un.ControlCommand.VisitIndex());const r=(this.sequenceType&Va.SequenceType.Once)>0,s=(this.sequenceType&Va.SequenceType.Cycle)>0,o=(this.sequenceType&Va.SequenceType.Stopping)>0,l=(this.sequenceType&Va.SequenceType.Shuffle)>0;let a=this.sequenceElements.length;if(r&&(a+=1),o||r?(i.AddContent(new xo.IntValue(a-1)),i.AddContent(Fa.NativeFunctionCall.CallWithName("MIN"))):s&&(i.AddContent(new xo.IntValue(this.sequenceElements.length)),i.AddContent(Fa.NativeFunctionCall.CallWithName("%"))),l){const h=un.ControlCommand.NoOp();if(r||o){const f=o?this.sequenceElements.length-1:this.sequenceElements.length;i.AddContent(un.ControlCommand.Duplicate()),i.AddContent(new xo.IntValue(f)),i.AddContent(Fa.NativeFunctionCall.CallWithName("=="));const d=new bf.Divert;d.isConditional=!0,i.AddContent(d),this.AddDivertToResolve(d,h)}let c=this.sequenceElements.length;o&&(c-=1),i.AddContent(new xo.IntValue(c)),i.AddContent(un.ControlCommand.SequenceShuffleIndex()),(r||o)&&i.AddContent(h)}i.AddContent(un.ControlCommand.EvalEnd());const u=un.ControlCommand.NoOp();for(let h=0;h<a;h+=1){i.AddContent(un.ControlCommand.EvalStart()),i.AddContent(un.ControlCommand.Duplicate()),i.AddContent(new xo.IntValue(h)),i.AddContent(Fa.NativeFunctionCall.CallWithName("==")),i.AddContent(un.ControlCommand.EvalEnd());const c=new bf.Divert;c.isConditional=!0,i.AddContent(c);let f;h<this.sequenceElements.length?f=this.sequenceElements[h].runtimeObject:f=new Sy.Container,f.name=`s${h}`,f.InsertContent(un.ControlCommand.PopEvaluatedValue(),0);const d=new bf.Divert;f.AddContent(d),i.AddToNamedContentOnly(f),this.AddDivertToResolve(c,f),this.AddDivertToResolve(d,u)}return i.AddContent(u),i},this.AddDivertToResolve=(i,r)=>{this._sequenceDivertsToResolve.push(new AD.SequenceDivertToResolve(i,r))},this.sequenceType=t,this.sequenceElements=[];for(const i of e){const r=i.content;let s=null;r===null||r.length===0?s=i:s=new ND.Weave(r),this.sequenceElements.push(s),this.AddContent(s)}}get typeName(){return"Sequence"}ResolveReferences(e){super.ResolveReferences(e);for(const t of this._sequenceDivertsToResolve)t.divert.targetPath=t.targetContent.path}}Ul.Sequence=ID;var ql={};Object.defineProperty(ql,"__esModule",{value:!0});ql.TunnelOnwards=void 0;const DD=Be,bo=bt,RD=Ae,LD=ke,MD=ri;class FD extends LD.ParsedObject{constructor(){super(...arguments);this._overrideDivertTarget=null,this._divertAfter=null,this.GenerateRuntimeObject=()=>{const e=new DD.Container;if(e.AddContent(bo.ControlCommand.EvalStart()),this.divertAfter){const i=this.divertAfter.GenerateRuntimeObject();if(i){const r=this.divertAfter.args;if(r!==null&&r.length>0){let s=-1,o=-1;for(let l=0;l<i.content.length;l+=1){const a=i.content[l];a&&(s==-1&&a.commandType===bo.ControlCommand.CommandType.EvalStart?s=l:a.commandType===bo.ControlCommand.CommandType.EvalEnd&&(o=l))}for(let l=s+1;l<o;l+=1){const a=i.content[l];a.parent=null,e.AddContent(i.content[l])}}}this._overrideDivertTarget=new RD.DivertTargetValue,e.AddContent(this._overrideDivertTarget)}else e.AddContent(new MD.Void);return e.AddContent(bo.ControlCommand.EvalEnd()),e.AddContent(bo.ControlCommand.PopTunnel()),e},this.toString=()=>` -> ${this._divertAfter}`}get divertAfter(){return this._divertAfter}set divertAfter(e){this._divertAfter=e,this._divertAfter&&this.AddContent(this._divertAfter)}get typeName(){return"TunnelOnwards"}ResolveReferences(e){super.ResolveReferences(e),this.divertAfter&&this.divertAfter.targetContent&&(this._overrideDivertTarget.targetPath=this.divertAfter.targetContent.runtimePath)}}ql.TunnelOnwards=FD;var Kl={},Xs={},Jl={};Object.defineProperty(Jl,"__esModule",{value:!0});Jl.ListDefinition=void 0;const Ef=Je;class VD{constructor(e,t){this._name=e||"",this._items=null,this._itemNameToValues=t||new Map}get name(){return this._name}get items(){if(this._items==null){this._items=new Map;for(let[e,t]of this._itemNameToValues){let i=new Ef.InkListItem(this.name,e);this._items.set(i.serialized(),t)}}return this._items}ValueForItem(e){if(!e.itemName)return 0;let t=this._itemNameToValues.get(e.itemName);return typeof t!="undefined"?t:0}ContainsItem(e){return!e.itemName||e.originName!=this.name?!1:this._itemNameToValues.has(e.itemName)}ContainsItemWithName(e){return this._itemNameToValues.has(e)}TryGetItemWithValue(e,t){for(let[i,r]of this._itemNameToValues)if(r==e)return t=new Ef.InkListItem(this.name,i),{result:t,exists:!0};return t=Ef.InkListItem.Null,{result:t,exists:!1}}TryGetValueForItem(e,t){if(!e.itemName)return{result:0,exists:!1};let i=this._itemNameToValues.get(e.itemName);return i?{result:i,exists:!0}:{result:0,exists:!1}}}Jl.ListDefinition=VD;Object.defineProperty(Xs,"__esModule",{value:!0});Xs.ListDefinition=void 0;const WD=Je,BD=Je,jD=Jl,$D=Ae,GD=ke,HD=si;class zD extends GD.ParsedObject{constructor(e){super();this.itemDefinitions=e,this.identifier=null,this.variableAssignment=null,this._elementsByName=null,this.ItemNamed=i=>{if(this._elementsByName===null){this._elementsByName=new Map;for(const s of this.itemDefinitions)this._elementsByName.set(s.name,s)}return this._elementsByName.get(i)||null},this.GenerateRuntimeObject=()=>{var i,r;const s=new WD.InkList;for(const o of this.itemDefinitions)if(o.inInitialList){const l=new BD.InkListItem(((i=this.identifier)===null||i===void 0?void 0:i.name)||null,o.name||null);s.Add(l,o.seriesValue)}return s.SetInitialOriginName(((r=this.identifier)===null||r===void 0?void 0:r.name)||""),new $D.ListValue(s)};let t=1;for(const i of this.itemDefinitions)i.explicitValue!==null&&(t=i.explicitValue),i.seriesValue=t,t+=1;this.AddContent(e)}get typeName(){return"ListDefinition"}get runtimeListDefinition(){var e;const t=new Map;for(const i of this.itemDefinitions)t.has(i.name)?this.Error(`List '${this.identifier}' contains duplicate items called '${i.name}'`):t.set(i.name,i.seriesValue);return new jD.ListDefinition(((e=this.identifier)===null||e===void 0?void 0:e.name)||"",t)}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.identifier,HD.SymbolType.List)}}Xs.ListDefinition=zD;Object.defineProperty(Kl,"__esModule",{value:!0});Kl.VariableAssignment=void 0;const UD=Be,qD=Fr,KD=Xs,JD=ke,wy=si,YD=Fn,XD=Xi,QD=re;class ZD extends JD.ParsedObject{constructor({assignedExpression:e,isGlobalDeclaration:t,isTemporaryNewDeclaration:i,listDef:r,variableIdentifier:s}){super();this._runtimeAssignment=null,this.expression=null,this.listDefinition=null,this.GenerateRuntimeObject=()=>{let o=null;if(this.isGlobalDeclaration?o=this.story:this.isNewTemporaryDeclaration&&(o=qD.ClosestFlowBase(this)),o&&o.AddNewVariableDeclaration(this),this.isGlobalDeclaration)return null;const l=new UD.Container;return this.expression?l.AddContent(this.expression.runtimeObject):this.listDefinition&&l.AddContent(this.listDefinition.runtimeObject),this._runtimeAssignment=new YD.VariableAssignment(this.variableName,this.isNewTemporaryDeclaration),l.AddContent(this._runtimeAssignment),l},this.toString=()=>`${this.isGlobalDeclaration?"VAR":this.isNewTemporaryDeclaration?"~ temp":""} ${this.variableName}`,this.variableIdentifier=s,this.isGlobalDeclaration=Boolean(t),this.isNewTemporaryDeclaration=Boolean(i),r instanceof KD.ListDefinition?(this.listDefinition=this.AddContent(r),this.listDefinition.variableAssignment=this,this.isGlobalDeclaration=!0):e&&(this.expression=this.AddContent(e))}get variableName(){return this.variableIdentifier.name}get typeName(){return this.isNewTemporaryDeclaration?"temp":this.isGlobalDeclaration?"VAR":"variable assignment"}get isDeclaration(){return this.isGlobalDeclaration||this.isNewTemporaryDeclaration}ResolveReferences(e){if(super.ResolveReferences(e),this.isDeclaration&&this.listDefinition===null&&e.CheckForNamingCollisions(this,this.variableIdentifier,this.isGlobalDeclaration?wy.SymbolType.Var:wy.SymbolType.Temp),this.isGlobalDeclaration){const t=QD.asOrNull(this.expression,XD.VariableReference);t&&!t.isConstantReference&&!t.isListItemReference&&this.Error("global variable assignments cannot refer to other variables, only literal values, constants and list items")}if(!this.isNewTemporaryDeclaration){const t=e.ResolveVariableWithName(this.variableName,this);t.found||(this.variableName in this.story.constants?this.Error(`Can't re-assign to a constant (do you need to use VAR when declaring '${this.variableName}'?)`,this):this.Error(`Variable could not be found to assign to: '${this.variableName}'`,this)),this._runtimeAssignment&&(this._runtimeAssignment.isGlobal=t.isGlobal)}}}Kl.VariableAssignment=ZD;Object.defineProperty(li,"__esModule",{value:!0});li.Weave=void 0;const xy=$s,Kt=Dr,Wa=zs,eR=Us,tR=Be,Ba=Mr,nR=mn,iR=Yi,rR=ln,xn=Ks,sR=Hh,oR=ke,kf=Ul,lR=oi,aR=ql,uR=Kl,Jt=re;class Ci extends oR.ParsedObject{constructor(e,t=-1){super();this.previousWeavePoint=null,this.addContentToPreviousWeavePoint=!1,this.hasSeenChoiceInSection=!1,this.currentContainer=null,this._unnamedGatherCount=0,this._choiceCount=0,this._rootContainer=null,this._namedWeavePoints=new Map,this.looseEnds=[],this.gatherPointsToResolve=[],this.ResolveWeavePointNaming=()=>{var i,r,s;const o=[...this.FindAll(xn.Gather)(l=>!(l.name===null||l.name===void 0)),...this.FindAll(Kt.Choice)(l=>!(l.name===null||l.name===void 0))];this._namedWeavePoints=new Map;for(const l of o){const a=this.namedWeavePoints.get(((i=l.identifier)===null||i===void 0?void 0:i.name)||"");if(a){const u=a instanceof xn.Gather?"gather":"choice",h=a;this.Error(`A ${u} with the same label name '${l.name}' already exists in this context on line ${h.debugMetadata?h.debugMetadata.startLineNumber:"NO DEBUG METADATA AVAILABLE"}`,l)}((r=l.identifier)===null||r===void 0?void 0:r.name)&&this.namedWeavePoints.set((s=l.identifier)===null||s===void 0?void 0:s.name,l)}},this.ConstructWeaveHierarchyFromIndentation=()=>{let i=0;for(;i<this.content.length;){const r=this.content[i];if(r instanceof Kt.Choice||r instanceof xn.Gather){const o=r.indentationDepth-1;if(o>this.baseIndentIndex){let l=i;for(;i<this.content.length;){const c=Jt.asOrNull(this.content[i],Kt.Choice)||Jt.asOrNull(this.content[i],xn.Gather);if(c!==null&&c.indentationDepth-1<=this.baseIndentIndex)break;i+=1}const a=i-l,u=this.content.slice(l,l+a);this.content.splice(l,a);const h=new Ci(u,o);this.InsertContent(l,h),i=l}}i+=1}},this.DetermineBaseIndentationFromContent=i=>{for(const r of i)if(r instanceof Kt.Choice||r instanceof xn.Gather)return r.indentationDepth-1;return 0},this.GenerateRuntimeObject=()=>{this._rootContainer=new tR.Container,this.currentContainer=this._rootContainer,this.looseEnds=[],this.gatherPointsToResolve=[];for(const i of this.content)if(i instanceof Kt.Choice||i instanceof xn.Gather)this.AddRuntimeForWeavePoint(i);else if(i instanceof Ci){const r=i;this.AddRuntimeForNestedWeave(r),this.gatherPointsToResolve.splice(0,0,...r.gatherPointsToResolve)}else this.AddGeneralRuntimeContent(i.runtimeObject);return this.PassLooseEndsToAncestors(),this._rootContainer},this.AddRuntimeForGather=i=>{const r=!this.hasSeenChoiceInSection;this.hasSeenChoiceInSection=!1;const s=i.runtimeContainer;if(i.name||(s.name=`g-${this._unnamedGatherCount}`,this._unnamedGatherCount+=1),r){if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(s)}else this.rootContainer.AddToNamedContentOnly(s);for(const o of this.looseEnds){const l=o;if(l instanceof xn.Gather&&l.indentationDepth==i.indentationDepth)continue;let a=null;if(l instanceof Ba.Divert)a=l.runtimeObject;else{a=new nR.Divert;const u=l;if(!u.runtimeContainer)throw new Error;u.runtimeContainer.AddContent(a)}this.gatherPointsToResolve.push(new sR.GatherPointToResolve(a,s))}this.looseEnds=[],this.currentContainer=s},this.AddRuntimeForWeavePoint=i=>{if(i instanceof xn.Gather)this.AddRuntimeForGather(i);else if(i instanceof Kt.Choice){if(!this.currentContainer)throw new Error;this.previousWeavePoint instanceof xn.Gather&&this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1);const r=i;if(this.currentContainer.AddContent(r.runtimeObject),!r.innerContentContainer)throw new Error;r.innerContentContainer.name=`c-${this._choiceCount}`,this.currentContainer.AddToNamedContentOnly(r.innerContentContainer),this._choiceCount+=1,this.hasSeenChoiceInSection=!0}this.addContentToPreviousWeavePoint=!1,this.WeavePointHasLooseEnd(i)&&(this.looseEnds.push(i),Jt.asOrNull(i,Kt.Choice)&&(this.addContentToPreviousWeavePoint=!0)),this.previousWeavePoint=i},this.AddRuntimeForNestedWeave=i=>{this.AddGeneralRuntimeContent(i.rootContainer),this.previousWeavePoint!==null&&(this.looseEnds.splice(this.looseEnds.indexOf(this.previousWeavePoint),1),this.addContentToPreviousWeavePoint=!1)},this.AddGeneralRuntimeContent=i=>{if(i!==null)if(this.addContentToPreviousWeavePoint){if(!this.previousWeavePoint||!this.previousWeavePoint.runtimeContainer)throw new Error;this.previousWeavePoint.runtimeContainer.AddContent(i)}else{if(!this.currentContainer)throw new Error;this.currentContainer.AddContent(i)}},this.PassLooseEndsToAncestors=()=>{if(this.looseEnds.length===0)return;let i=null,r=null,s=!1;for(let o=this.parent;o!==null;o=o.parent){const l=Jt.asOrNull(o,Ci);l&&(!s&&i===null&&(i=l),s&&r===null&&(r=l)),(o instanceof kf.Sequence||o instanceof Wa.Conditional)&&(s=!0)}if(!(i===null&&r===null))for(let o=this.looseEnds.length-1;o>=0;o-=1){const l=this.looseEnds[o];let a=!1;if(s){if(l instanceof Kt.Choice&&i!==null)i.ReceiveLooseEnd(l),a=!0;else if(!(l instanceof Kt.Choice)){const u=i||r;u!==null&&(u.ReceiveLooseEnd(l),a=!0)}}else(i==null?void 0:i.hasOwnProperty("ReceiveLooseEnd"))&&i.ReceiveLooseEnd(l),a=!0;a&&this.looseEnds.splice(o,1)}},this.ReceiveLooseEnd=i=>{this.looseEnds.push(i)},this.WeavePointNamed=i=>{if(!this.namedWeavePoints)return null;let r=this.namedWeavePoints.get(i);return r||null},this.IsGlobalDeclaration=i=>{const r=Jt.asOrNull(i,uR.VariableAssignment);return!!(r&&r.isGlobalDeclaration&&r.isDeclaration||Jt.asOrNull(i,eR.ConstantDeclaration))},this.ContentThatFollowsWeavePoint=i=>{const r=[],s=i;if(s.content!==null)for(const a of s.content)this.IsGlobalDeclaration(a)||r.push(a);const o=Jt.asOrNull(s.parent,Ci);if(o===null)throw new Error("Expected weave point parent to be weave?");const l=o.content.indexOf(s);for(let a=l+1;a<o.content.length;a+=1){const u=o.content[a];if(!this.IsGlobalDeclaration(u)){if(u instanceof Kt.Choice||u instanceof xn.Gather||u instanceof Ci)break;r.push(u)}}return r},this.ValidateTermination=i=>{if(this.lastParsedSignificantObject instanceof xy.AuthorWarning)return;if(this.looseEnds!==null&&this.looseEnds.length>0)for(const s of this.looseEnds){const o=this.ContentThatFollowsWeavePoint(s);this.ValidateFlowOfObjectsTerminates(o,s,i)}else{for(const s of this.content)if(s instanceof Kt.Choice||s instanceof Ba.Divert)return;this.ValidateFlowOfObjectsTerminates(this.content,this,i)}},this.BadNestedTerminationHandler=i=>{let r=null;for(let o=i.parent;o!==null;o=o.parent)if(o instanceof kf.Sequence||o instanceof Wa.Conditional){r=Jt.asOrNull(o,Wa.Conditional);break}let s="Choices nested in conditionals or sequences need to explicitly divert afterwards.";r!==null&&r.FindAll(Kt.Choice)().length===1&&(s=`Choices with conditions should be written: '* {condition} choice'. Otherwise, ${s.toLowerCase()}`),this.Error(s,i)},this.ValidateFlowOfObjectsTerminates=(i,r,s)=>{let o=!1,l=r;for(const a of i){if(a.Find(Ba.Divert)(h=>!h.isThread&&!h.isTunnel&&!h.isFunctionCall&&!(h.parent instanceof iR.DivertTarget))!==null&&(o=!0),a.Find(aR.TunnelOnwards)()!=null){o=!0;break}l=a}if(!o){if(l instanceof xy.AuthorWarning)return;s(l)}},this.WeavePointHasLooseEnd=i=>{if(i.content===null)return!0;for(let r=i.content.length-1;r>=0;--r){let s=Jt.asOrNull(i.content[r],Ba.Divert);if(s&&!(s.isThread||s.isTunnel||s.isFunctionCall))return!1}return!0},this.CheckForWeavePointNamingCollisions=()=>{if(!this.namedWeavePoints)return;const i=[];for(const r of this.ancestry){const s=Jt.asOrNull(r,rR.FlowBase);if(s)i.push(s);else break}for(const[r,s]of this.namedWeavePoints)for(const o of i){const l=o.ContentWithNameAtLevel(r);if(l&&l!==s){const a=`${s.GetType()} '${r}' has the same label name as a ${l.GetType()} (on ${l.debugMetadata})`;this.Error(a,s)}}},t==-1?this.baseIndentIndex=this.DetermineBaseIndentationFromContent(e):this.baseIndentIndex=t,this.AddContent(e),this.ConstructWeaveHierarchyFromIndentation()}get rootContainer(){return this._rootContainer||(this._rootContainer=this.GenerateRuntimeObject()),this._rootContainer}get namedWeavePoints(){return this._namedWeavePoints}get lastParsedSignificantObject(){if(this.content.length===0)return null;let e=null;for(let i=this.content.length-1;i>=0;--i){e=this.content[i];let r=Jt.asOrNull(e,lR.Text);if(!(r&&r.text===`
`)&&!this.IsGlobalDeclaration(e))break}const t=Jt.asOrNull(e,Ci);return t&&(e=t.lastParsedSignificantObject),e}get typeName(){return"Weave"}ResolveReferences(e){if(super.ResolveReferences(e),this.looseEnds!==null&&this.looseEnds.length>0){let t=!1;for(let i=this.parent;i!==null;i=i.parent)if(i instanceof kf.Sequence||i instanceof Wa.Conditional){t=!0;break}t&&this.ValidateTermination(this.BadNestedTerminationHandler)}for(const t of this.gatherPointsToResolve)t.divert.targetPath=t.targetRuntimeObj.path;this.CheckForWeavePointNamingCollisions()}}li.Weave=Ci;Object.defineProperty(Gl,"__esModule",{value:!0});Gl.ConditionalSingleBranch=void 0;const by=Be,ja=bt,Ey=mn,hR=ke,cR=on,fR=Ae,dR=oi,pR=li,mR=re;class gR extends hR.ParsedObject{constructor(e){super();this._contentContainer=null,this._conditionalDivert=null,this._ownExpression=null,this._innerWeave=null,this.isTrueBranch=!1,this.matchingEquality=!1,this.isElse=!1,this.isInline=!1,this.returnDivert=null,this.GenerateRuntimeObject=()=>{if(this._innerWeave)for(const r of this._innerWeave.content){const s=mR.asOrNull(r,dR.Text);s&&s.text.startsWith("else:")&&this.Warning("Saw the text 'else:' which is being treated as content. Did you mean '- else:'?",s)}const t=new by.Container,i=this.matchingEquality&&!this.isElse;if(i&&t.AddContent(ja.ControlCommand.Duplicate()),this._conditionalDivert=new Ey.Divert,this._conditionalDivert.isConditional=!this.isElse,!this.isTrueBranch&&!this.isElse){const r=this.ownExpression!==null;r&&t.AddContent(ja.ControlCommand.EvalStart()),this.ownExpression&&this.ownExpression.GenerateIntoContainer(t),this.matchingEquality&&t.AddContent(cR.NativeFunctionCall.CallWithName("==")),r&&t.AddContent(ja.ControlCommand.EvalEnd())}return t.AddContent(this._conditionalDivert),this._contentContainer=this.GenerateRuntimeForContent(),this._contentContainer.name="b",this.isInline||this._contentContainer.InsertContent(new fR.StringValue(`
`),0),(i||this.isElse&&this.matchingEquality)&&this._contentContainer.InsertContent(ja.ControlCommand.PopEvaluatedValue(),0),t.AddToNamedContentOnly(this._contentContainer),this.returnDivert=new Ey.Divert,this._contentContainer.AddContent(this.returnDivert),t},this.GenerateRuntimeForContent=()=>this._innerWeave===null?new by.Container:this._innerWeave.rootContainer,e&&(this._innerWeave=new pR.Weave(e),this.AddContent(this._innerWeave))}get ownExpression(){return this._ownExpression}set ownExpression(e){this._ownExpression=e,this._ownExpression&&this.AddContent(this._ownExpression)}get typeName(){return"ConditionalSingleBranch"}ResolveReferences(e){if(!this._conditionalDivert||!this._contentContainer)throw new Error;this._conditionalDivert.targetPath=this._contentContainer.path,super.ResolveReferences(e)}}Gl.ConditionalSingleBranch=gR;var xx={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.CustomFlags=void 0,function(e){e[e.ParsingString=1]="ParsingString"}(n.CustomFlags||(n.CustomFlags={}))})(xx);var Uh={};Object.defineProperty(Uh,"__esModule",{value:!0});Uh.DebugMetadata=void 0;class zm{constructor(){this.startLineNumber=0,this.endLineNumber=0,this.startCharacterNumber=0,this.endCharacterNumber=0,this.fileName=null,this.sourceName=null}Merge(e){let t=new zm;return t.fileName=this.fileName,t.sourceName=this.sourceName,this.startLineNumber<e.startLineNumber?(t.startLineNumber=this.startLineNumber,t.startCharacterNumber=this.startCharacterNumber):this.startLineNumber>e.startLineNumber?(t.startLineNumber=e.startLineNumber,t.startCharacterNumber=e.startCharacterNumber):(t.startLineNumber=this.startLineNumber,t.startCharacterNumber=Math.min(this.startCharacterNumber,e.startCharacterNumber)),this.endLineNumber>e.endLineNumber?(t.endLineNumber=this.endLineNumber,t.endCharacterNumber=this.endCharacterNumber):this.endLineNumber<e.endLineNumber?(t.endLineNumber=e.endLineNumber,t.endCharacterNumber=e.endCharacterNumber):(t.endLineNumber=this.endLineNumber,t.endCharacterNumber=Math.max(this.endCharacterNumber,e.endCharacterNumber)),t}toString(){return this.fileName!==null?`line ${this.startLineNumber} of ${this.fileName}"`:"line "+this.startLineNumber}}Uh.DebugMetadata=zm;var qh={};Object.defineProperty(qh,"__esModule",{value:!0});qh.ExternalDeclaration=void 0;const vR=ke;class yR extends vR.ParsedObject{constructor(e,t){super();this.identifier=e,this.argumentNames=t,this.GenerateRuntimeObject=()=>(this.story.AddExternal(this),null)}get name(){var e;return((e=this.identifier)===null||e===void 0?void 0:e.name)||null}get typeName(){return"EXTERNAL"}toString(){var e;return`EXTERNAL ${(e=this.identifier)===null||e===void 0?void 0:e.name}`}}qh.ExternalDeclaration=yR;var Kh={};Object.defineProperty(Kh,"__esModule",{value:!0});Kh.FlowDecl=void 0;class CR{constructor(e,t,i){this.name=e,this.args=t,this.isFunction=i}}Kh.FlowDecl=CR;var Jh={},Yl={};Object.defineProperty(Yl,"__esModule",{value:!0});Yl.Wrap=void 0;const SR=ke;class wR extends SR.ParsedObject{constructor(e){super();this._objToWrap=e,this.GenerateRuntimeObject=()=>this._objToWrap}}Yl.Wrap=wR;Object.defineProperty(Jh,"__esModule",{value:!0});Jh.Glue=void 0;const xR=Yl;class bR extends xR.Wrap{constructor(e){super(e)}get typeName(){return"Glue"}}Jh.Glue=bR;var Qs={};Object.defineProperty(Qs,"__esModule",{value:!0});Qs.Glue=void 0;const ER=mt;class kR extends ER.InkObject{toString(){return"Glue"}}Qs.Glue=kR;var Yh={};Object.defineProperty(Yh,"__esModule",{value:!0});Yh.IncDecExpression=void 0;const OR=Ys,ky=Lt,_R=ln,PR=on,TR=Ae,AR=Fn,NR=Wr,IR=li;class DR extends ky.Expression{constructor(e,t,i){super();this.varIdentifier=e,this._runtimeAssignment=null,this.expression=null,this.GenerateIntoContainer=r=>{var s,o;r.AddContent(new NR.VariableReference(((s=this.varIdentifier)===null||s===void 0?void 0:s.name)||null)),this.expression?this.expression.GenerateIntoContainer(r):r.AddContent(new TR.IntValue(1)),r.AddContent(PR.NativeFunctionCall.CallWithName(this.isInc?"+":"-")),this._runtimeAssignment=new AR.VariableAssignment(((o=this.varIdentifier)===null||o===void 0?void 0:o.name)||null,!1),r.AddContent(this._runtimeAssignment)},this.toString=()=>{var r,s;return this.expression?`${(r=this.varIdentifier)===null||r===void 0?void 0:r.name}${this.isInc?" += ":" -= "}${this.expression}`:`${(s=this.varIdentifier)===null||s===void 0?void 0:s.name}`+(this.isInc?"++":"--")},t instanceof ky.Expression?(this.expression=t,this.AddContent(this.expression),this.isInc=Boolean(i)):this.isInc=t}get typeName(){return"IncDecExpression"}ResolveReferences(e){var t;super.ResolveReferences(e);const i=e.ResolveVariableWithName(((t=this.varIdentifier)===null||t===void 0?void 0:t.name)||"",this);if(i.found||this.Error(`variable for ${this.incrementDecrementWord} could not be found: '${this.varIdentifier}' after searching: {this.descriptionOfScope}`),!this._runtimeAssignment)throw new Error;this._runtimeAssignment.isGlobal=i.isGlobal,!(this.parent instanceof IR.Weave)&&!(this.parent instanceof _R.FlowBase)&&!(this.parent instanceof OR.ContentList)&&this.Error(`Can't use ${this.incrementDecrementWord} as sub-expression`)}get incrementDecrementWord(){return this.isInc?"increment":"decrement"}}Yh.IncDecExpression=DR;var Xl={};Object.defineProperty(Xl,"__esModule",{value:!0});Xl.IncludedFile=void 0;const RR=ke;class LR extends RR.ParsedObject{constructor(e){super();this.includedStory=e,this.GenerateRuntimeObject=()=>null}}Xl.IncludedFile=LR;var Xh={};Object.defineProperty(Xh,"__esModule",{value:!0});Xh.InfixOperator=void 0;class MR{constructor(e,t,i){this.type=e,this.precedence=t,this.requireWhitespace=i,this.toString=()=>this.type}}Xh.InfixOperator=MR;var Qh={};Object.defineProperty(Qh,"__esModule",{value:!0});Qh.Knot=void 0;const FR=ln,Oy=qs;class VR extends FR.FlowBase{get flowLevel(){return Oy.FlowLevel.Knot}constructor(e,t,i,r){super(e,t,i,r)}get typeName(){return"Knot"}ResolveReferences(e){super.ResolveReferences(e);let t=this.story;for(const i in this.subFlowsByName){const r=t.ContentWithNameAtLevel(i,Oy.FlowLevel.Knot,!1);if(r){const s=this.subFlowsByName.get(i),o=`Stitch '${s?s.name:"NO STITCH FOUND"}' has the same name as a knot (on ${r.debugMetadata})`;this.Error(o,s)}}}}Qh.Knot=VR;var Zh={};Object.defineProperty(Zh,"__esModule",{value:!0});Zh.List=void 0;const WR=Lt,BR=Je,jR=Je,$R=Ae;class GR extends WR.Expression{constructor(e){super();this.itemIdentifierList=e,this.GenerateIntoContainer=t=>{var i,r;const s=new BR.InkList;if(this.itemIdentifierList!=null)for(const o of this.itemIdentifierList){const l=((i=o==null?void 0:o.name)===null||i===void 0?void 0:i.split("."))||[];let a=null,u="";l.length>1?(a=l[0],u=l[1]):u=l[0];const h=this.story.ResolveListItem(a,u,this);if(h===null)a===null?this.Error(`Could not find list definition that contains item '${o}'`):this.Error(`Could not find list item ${o}`);else{if(h.parent==null){this.Error(`Could not find list definition for item ${o}`);return}a||(a=((r=h.parent.identifier)===null||r===void 0?void 0:r.name)||null);const c=new jR.InkListItem(a,h.name||null);s.has(c.serialized())?this.Warning(`Duplicate of item '${o}' in list.`):s.Add(c,h.seriesValue)}}t.AddContent(new $R.ListValue(s))}}get typeName(){return"List"}}Zh.List=GR;var Ql={};Object.defineProperty(Ql,"__esModule",{value:!0});Ql.ListElementDefinition=void 0;const HR=ke,zR=si;class UR extends HR.ParsedObject{constructor(e,t,i=null){super();this.indentifier=e,this.inInitialList=t,this.explicitValue=i,this.seriesValue=0,this.parent=null,this.GenerateRuntimeObject=()=>{throw new Error("Not implemented.")},this.toString=()=>this.fullName,this.parent=super.parent}get fullName(){var e;const t=this.parent;if(t===null)throw new Error("Can't get full name without a parent list.");return`${(e=t.identifier)===null||e===void 0?void 0:e.name}.${this.name}`}get typeName(){return"ListElement"}get name(){var e;return((e=this.indentifier)===null||e===void 0?void 0:e.name)||null}ResolveReferences(e){super.ResolveReferences(e),e.CheckForNamingCollisions(this,this.indentifier,zR.SymbolType.ListItem)}}Ql.ListElementDefinition=UR;var bx={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.StatementLevel=void 0,function(e){e[e.InnerBlock=0]="InnerBlock",e[e.Stitch=1]="Stitch",e[e.Knot=2]="Knot",e[e.Top=3]="Top"}(n.StatementLevel||(n.StatementLevel={}))})(bx);var ec={};Object.defineProperty(ec,"__esModule",{value:!0});ec.Stitch=void 0;const qR=ln,KR=qs;class JR extends qR.FlowBase{constructor(e,t,i,r){super(e,t,i,r);this.toString=()=>`${this.parent!==null?this.parent+" > ":""}${super.toString()}`}get flowLevel(){return KR.FlowLevel.Stitch}get typeName(){return"Stitch"}}ec.Stitch=JR;var tc={},Zl={},Qi={},Br={};Object.defineProperty(Br,"__esModule",{value:!0});Br.Tag=void 0;const YR=mt;class XR extends YR.InkObject{constructor(e){super();this.text=e.toString()||""}toString(){return"# "+this.text}}Br.Tag=XR;var ea={};Object.defineProperty(ea,"__esModule",{value:!0});ea.Choice=void 0;const QR=Mt,ZR=We,eL=mt;class tL extends eL.InkObject{constructor(){super(...arguments);this.text="",this.index=0,this.threadAtGeneration=null,this.sourcePath="",this.targetPath=null,this.isInvisibleDefault=!1,this.originalThreadIndex=0}get pathStringOnChoice(){return this.targetPath===null?ZR.throwNullException("Choice.targetPath"):this.targetPath.toString()}set pathStringOnChoice(e){this.targetPath=new QR.Path(e)}}ea.Choice=tL;var ta={};Object.defineProperty(ta,"__esModule",{value:!0});ta.ListDefinitionsOrigin=void 0;const nL=Je,iL=Ae,rL=We;class sL{constructor(e){this._lists=new Map,this._allUnambiguousListValueCache=new Map;for(let t of e){this._lists.set(t.name,t);for(let[i,r]of t.items){let s=nL.InkListItem.fromSerializedKey(i),o=new iL.ListValue(s,r);if(!s.itemName)throw new Error("item.itemName is null or undefined.");this._allUnambiguousListValueCache.set(s.itemName,o),this._allUnambiguousListValueCache.set(s.fullName,o)}}}get lists(){let e=[];for(let[,t]of this._lists)e.push(t);return e}TryListGetDefinition(e,t){if(e===null)return{result:t,exists:!1};let i=this._lists.get(e);return i?{result:i,exists:!0}:{result:t,exists:!1}}FindSingleItemListWithName(e){if(e===null)return rL.throwNullException("name");let t=this._allUnambiguousListValueCache.get(e);return typeof t!="undefined"?t:null}}ta.ListDefinitionsOrigin=sL;Object.defineProperty(Qi,"__esModule",{value:!0});Qi.JsonSerialisation=void 0;const $a=Be,Vt=Ae,_y=Qs,pe=bt,Jr=Rr,Py=mn,Ty=Hs,Of=Wr,Ay=Fn,_f=on,Ny=ri,Iy=Br,oL=Mt,Dy=ea,lL=Jl,aL=ta,Ga=Je,Fe=re,tr=We;class bs{static JArrayToRuntimeObjList(e,t=!1){let i=e.length;t&&i--;let r=[];for(let s=0;s<i;s++){let o=e[s],l=this.JTokenToRuntimeObject(o);if(l===null)return tr.throwNullException("runtimeObj");r.push(l)}return r}static WriteDictionaryRuntimeObjs(e,t){e.WriteObjectStart();for(let[i,r]of t)e.WritePropertyStart(i),this.WriteRuntimeObject(e,r),e.WritePropertyEnd();e.WriteObjectEnd()}static WriteListRuntimeObjs(e,t){e.WriteArrayStart();for(let i of t)this.WriteRuntimeObject(e,i);e.WriteArrayEnd()}static WriteIntDictionary(e,t){e.WriteObjectStart();for(let[i,r]of t)e.WriteIntProperty(i,r);e.WriteObjectEnd()}static WriteRuntimeObject(e,t){let i=Fe.asOrNull(t,$a.Container);if(i){this.WriteRuntimeContainer(e,i);return}let r=Fe.asOrNull(t,Py.Divert);if(r){let _="->";r.isExternal?_="x()":r.pushesToStack&&(r.stackPushType==Jr.PushPopType.Function?_="f()":r.stackPushType==Jr.PushPopType.Tunnel&&(_="->t->"));let O;r.hasVariableTarget?O=r.variableDivertName:O=r.targetPathString,e.WriteObjectStart(),e.WriteProperty(_,O),r.hasVariableTarget&&e.WriteProperty("var",!0),r.isConditional&&e.WriteProperty("c",!0),r.externalArgs>0&&e.WriteIntProperty("exArgs",r.externalArgs),e.WriteObjectEnd();return}let s=Fe.asOrNull(t,Ty.ChoicePoint);if(s){e.WriteObjectStart(),e.WriteProperty("*",s.pathStringOnChoice),e.WriteIntProperty("flg",s.flags),e.WriteObjectEnd();return}let o=Fe.asOrNull(t,Vt.BoolValue);if(o){e.WriteBool(o.value);return}let l=Fe.asOrNull(t,Vt.IntValue);if(l){e.WriteInt(l.value);return}let a=Fe.asOrNull(t,Vt.FloatValue);if(a){e.WriteFloat(a.value);return}let u=Fe.asOrNull(t,Vt.StringValue);if(u){u.isNewline?e.Write(`
`,!1):(e.WriteStringStart(),e.WriteStringInner("^"),e.WriteStringInner(u.value),e.WriteStringEnd());return}let h=Fe.asOrNull(t,Vt.ListValue);if(h){this.WriteInkList(e,h);return}let c=Fe.asOrNull(t,Vt.DivertTargetValue);if(c){if(e.WriteObjectStart(),c.value===null)return tr.throwNullException("divTargetVal.value");e.WriteProperty("^->",c.value.componentsString),e.WriteObjectEnd();return}let f=Fe.asOrNull(t,Vt.VariablePointerValue);if(f){e.WriteObjectStart(),e.WriteProperty("^var",f.value),e.WriteIntProperty("ci",f.contextIndex),e.WriteObjectEnd();return}if(Fe.asOrNull(t,_y.Glue)){e.Write("<>");return}let m=Fe.asOrNull(t,pe.ControlCommand);if(m){e.Write(bs._controlCommandNames[m.commandType]);return}let w=Fe.asOrNull(t,_f.NativeFunctionCall);if(w){let _=w.name;_=="^"&&(_="L^"),e.Write(_);return}let v=Fe.asOrNull(t,Of.VariableReference);if(v){e.WriteObjectStart();let _=v.pathStringForCount;_!=null?e.WriteProperty("CNT?",_):e.WriteProperty("VAR?",v.name),e.WriteObjectEnd();return}let p=Fe.asOrNull(t,Ay.VariableAssignment);if(p){e.WriteObjectStart();let _=p.isGlobal?"VAR=":"temp=";e.WriteProperty(_,p.variableName),p.isNewDeclaration||e.WriteProperty("re",!0),e.WriteObjectEnd();return}if(Fe.asOrNull(t,Ny.Void)){e.Write("void");return}let C=Fe.asOrNull(t,Iy.Tag);if(C){e.WriteObjectStart(),e.WriteProperty("#",C.text),e.WriteObjectEnd();return}let b=Fe.asOrNull(t,Dy.Choice);if(b){this.WriteChoice(e,b);return}throw new Error("Failed to convert runtime object to Json token: "+t)}static JObjectToDictionaryRuntimeObjs(e){let t=new Map;for(let i in e)if(e.hasOwnProperty(i)){let r=this.JTokenToRuntimeObject(e[i]);if(r===null)return tr.throwNullException("inkObject");t.set(i,r)}return t}static JObjectToIntDictionary(e){let t=new Map;for(let i in e)e.hasOwnProperty(i)&&t.set(i,parseInt(e[i]));return t}static JTokenToRuntimeObject(e){if(typeof e=="number"&&!isNaN(e)||typeof e=="boolean")return Vt.Value.Create(e);if(typeof e=="string"){let t=e.toString(),i=t[0];if(i=="^")return new Vt.StringValue(t.substring(1));if(i==`
`&&t.length==1)return new Vt.StringValue(`
`);if(t=="<>")return new _y.Glue;for(let r=0;r<bs._controlCommandNames.length;++r){let s=bs._controlCommandNames[r];if(t==s)return new pe.ControlCommand(r)}if(t=="L^"&&(t="^"),_f.NativeFunctionCall.CallExistsWithName(t))return _f.NativeFunctionCall.CallWithName(t);if(t=="->->")return pe.ControlCommand.PopTunnel();if(t=="~ret")return pe.ControlCommand.PopFunction();if(t=="void")return new Ny.Void}if(typeof e=="object"&&!Array.isArray(e)){let t=e,i;if(t["^->"])return i=t["^->"],new Vt.DivertTargetValue(new oL.Path(i.toString()));if(t["^var"]){i=t["^var"];let h=new Vt.VariablePointerValue(i.toString());return"ci"in t&&(i=t.ci,h.contextIndex=parseInt(i)),h}let r=!1,s=!1,o=Jr.PushPopType.Function,l=!1;if((i=t["->"])?r=!0:(i=t["f()"])?(r=!0,s=!0,o=Jr.PushPopType.Function):(i=t["->t->"])?(r=!0,s=!0,o=Jr.PushPopType.Tunnel):(i=t["x()"])&&(r=!0,l=!0,s=!1,o=Jr.PushPopType.Function),r){let h=new Py.Divert;h.pushesToStack=s,h.stackPushType=o,h.isExternal=l;let c=i.toString();return(i=t.var)?h.variableDivertName=c:h.targetPathString=c,h.isConditional=!!t.c,l&&(i=t.exArgs)&&(h.externalArgs=parseInt(i)),h}if(i=t["*"]){let h=new Ty.ChoicePoint;return h.pathStringOnChoice=i.toString(),(i=t.flg)&&(h.flags=parseInt(i)),h}if(i=t["VAR?"])return new Of.VariableReference(i.toString());if(i=t["CNT?"]){let h=new Of.VariableReference;return h.pathStringForCount=i.toString(),h}let a=!1,u=!1;if((i=t["VAR="])?(a=!0,u=!0):(i=t["temp="])&&(a=!0,u=!1),a){let h=i.toString(),c=!t.re,f=new Ay.VariableAssignment(h,c);return f.isGlobal=u,f}if(t["#"]!==void 0)return i=t["#"],new Iy.Tag(i.toString());if(i=t.list){let h=i,c=new Ga.InkList;if(i=t.origins){let f=i;c.SetInitialOriginNames(f)}for(let f in h)if(h.hasOwnProperty(f)){let d=h[f],m=new Ga.InkListItem(f),w=parseInt(d);c.Add(m,w)}return new Vt.ListValue(c)}if(t.originalChoicePath!=null)return this.JObjectToChoice(t)}if(Array.isArray(e))return this.JArrayToContainer(e);if(e==null)return null;throw new Error("Failed to convert token to runtime object: "+this.toJson(e,["parent"]))}static toJson(e,t,i){return JSON.stringify(e,(r,s)=>(t==null?void 0:t.some(o=>o===r))?void 0:s,i)}static WriteRuntimeContainer(e,t,i=!1){if(e.WriteArrayStart(),t===null)return tr.throwNullException("container");for(let a of t.content)this.WriteRuntimeObject(e,a);let r=t.namedOnlyContent,s=t.countFlags,o=t.name!=null&&!i,l=r!=null||s>0||o;if(l&&e.WriteObjectStart(),r!=null)for(let[a,u]of r){let h=a,c=Fe.asOrNull(u,$a.Container);e.WritePropertyStart(h),this.WriteRuntimeContainer(e,c,!0),e.WritePropertyEnd()}s>0&&e.WriteIntProperty("#f",s),o&&e.WriteProperty("#n",t.name),l?e.WriteObjectEnd():e.WriteNull(),e.WriteArrayEnd()}static JArrayToContainer(e){let t=new $a.Container;t.content=this.JArrayToRuntimeObjList(e,!0);let i=e[e.length-1];if(i!=null){let r=new Map;for(let s in i)if(s=="#f")t.countFlags=parseInt(i[s]);else if(s=="#n")t.name=i[s].toString();else{let o=this.JTokenToRuntimeObject(i[s]),l=Fe.asOrNull(o,$a.Container);l&&(l.name=s),r.set(s,o)}t.namedOnlyContent=r}return t}static JObjectToChoice(e){let t=new Dy.Choice;return t.text=e.text.toString(),t.index=parseInt(e.index),t.sourcePath=e.originalChoicePath.toString(),t.originalThreadIndex=parseInt(e.originalThreadIndex),t.pathStringOnChoice=e.targetPath.toString(),t}static WriteChoice(e,t){e.WriteObjectStart(),e.WriteProperty("text",t.text),e.WriteIntProperty("index",t.index),e.WriteProperty("originalChoicePath",t.sourcePath),e.WriteIntProperty("originalThreadIndex",t.originalThreadIndex),e.WriteProperty("targetPath",t.pathStringOnChoice),e.WriteObjectEnd()}static WriteInkList(e,t){let i=t.value;if(i===null)return tr.throwNullException("rawList");e.WriteObjectStart(),e.WritePropertyStart("list"),e.WriteObjectStart();for(let[r,s]of i){let o=Ga.InkListItem.fromSerializedKey(r),l=s;if(o.itemName===null)return tr.throwNullException("item.itemName");e.WritePropertyNameStart(),e.WritePropertyNameInner(o.originName?o.originName:"?"),e.WritePropertyNameInner("."),e.WritePropertyNameInner(o.itemName),e.WritePropertyNameEnd(),e.Write(l),e.WritePropertyEnd()}if(e.WriteObjectEnd(),e.WritePropertyEnd(),i.Count==0&&i.originNames!=null&&i.originNames.length>0){e.WritePropertyStart("origins"),e.WriteArrayStart();for(let r of i.originNames)e.Write(r);e.WriteArrayEnd(),e.WritePropertyEnd()}e.WriteObjectEnd()}static ListDefinitionsToJToken(e){let t={};for(let i of e.lists){let r={};for(let[s,o]of i.items){let l=Ga.InkListItem.fromSerializedKey(s);if(l.itemName===null)return tr.throwNullException("item.itemName");r[l.itemName]=o}t[i.name]=r}return t}static JTokenToListDefinitions(e){let t=e,i=[];for(let r in t)if(t.hasOwnProperty(r)){let s=r.toString(),o=t[r],l=new Map;for(let u in o)if(t.hasOwnProperty(r)){let h=o[u];l.set(u,parseInt(h))}let a=new lL.ListDefinition(s,l);i.push(a)}return new aL.ListDefinitionsOrigin(i)}}Qi.JsonSerialisation=bs;bs._controlCommandNames=(()=>{let n=[];n[pe.ControlCommand.CommandType.EvalStart]="ev",n[pe.ControlCommand.CommandType.EvalOutput]="out",n[pe.ControlCommand.CommandType.EvalEnd]="/ev",n[pe.ControlCommand.CommandType.Duplicate]="du",n[pe.ControlCommand.CommandType.PopEvaluatedValue]="pop",n[pe.ControlCommand.CommandType.PopFunction]="~ret",n[pe.ControlCommand.CommandType.PopTunnel]="->->",n[pe.ControlCommand.CommandType.BeginString]="str",n[pe.ControlCommand.CommandType.EndString]="/str",n[pe.ControlCommand.CommandType.NoOp]="nop",n[pe.ControlCommand.CommandType.ChoiceCount]="choiceCnt",n[pe.ControlCommand.CommandType.Turns]="turn",n[pe.ControlCommand.CommandType.TurnsSince]="turns",n[pe.ControlCommand.CommandType.ReadCount]="readc",n[pe.ControlCommand.CommandType.Random]="rnd",n[pe.ControlCommand.CommandType.SeedRandom]="srnd",n[pe.ControlCommand.CommandType.VisitIndex]="visit",n[pe.ControlCommand.CommandType.SequenceShuffleIndex]="seq",n[pe.ControlCommand.CommandType.StartThread]="thread",n[pe.ControlCommand.CommandType.Done]="done",n[pe.ControlCommand.CommandType.End]="end",n[pe.ControlCommand.CommandType.ListFromInt]="listInt",n[pe.ControlCommand.CommandType.ListRange]="range",n[pe.ControlCommand.CommandType.ListRandom]="lrnd";for(let e=0;e<pe.ControlCommand.CommandType.TOTAL_VALUES;++e)if(n[e]==null)throw new Error("Control command not accounted for in serialisation");return n})();var nc={},Um={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.CallStack=void 0;const e=Rr,t=Mt,i=Zl,r=Qi,s=Ae,o=ii,l=Lr,a=jl,u=tn,h=We;class c{constructor(){if(this._threadCounter=0,this._startOfRoot=l.Pointer.Null,arguments[0]instanceof i.Story){let d=arguments[0];this._startOfRoot=l.Pointer.StartOf(d.rootContentContainer),this.Reset()}else{let d=arguments[0];this._threads=[];for(let m of d._threads)this._threads.push(m.Copy());this._threadCounter=d._threadCounter,this._startOfRoot=d._startOfRoot.copy()}}get elements(){return this.callStack}get depth(){return this.elements.length}get currentElement(){let m=this._threads[this._threads.length-1].callstack;return m[m.length-1]}get currentElementIndex(){return this.callStack.length-1}get currentThread(){return this._threads[this._threads.length-1]}set currentThread(d){a.Debug.Assert(this._threads.length==1,"Shouldn't be directly setting the current thread when we have a stack of them"),this._threads.length=0,this._threads.push(d)}get canPop(){return this.callStack.length>1}Reset(){this._threads=[],this._threads.push(new c.Thread),this._threads[0].callstack.push(new c.Element(e.PushPopType.Tunnel,this._startOfRoot))}SetJsonToken(d,m){this._threads.length=0;let w=d.threads;for(let v of w){let p=v,y=new c.Thread(p,m);this._threads.push(y)}this._threadCounter=parseInt(d.threadCounter),this._startOfRoot=l.Pointer.StartOf(m.rootContentContainer)}WriteJson(d){d.WriteObject(m=>{m.WritePropertyStart("threads"),m.WriteArrayStart();for(let w of this._threads)w.WriteJson(m);m.WriteArrayEnd(),m.WritePropertyEnd(),m.WritePropertyStart("threadCounter"),m.WriteInt(this._threadCounter),m.WritePropertyEnd()})}PushThread(){let d=this.currentThread.Copy();this._threadCounter++,d.threadIndex=this._threadCounter,this._threads.push(d)}ForkThread(){let d=this.currentThread.Copy();return this._threadCounter++,d.threadIndex=this._threadCounter,d}PopThread(){if(this.canPopThread)this._threads.splice(this._threads.indexOf(this.currentThread),1);else throw new Error("Can't pop thread")}get canPopThread(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}get elementIsEvaluateFromGame(){return this.currentElement.type==e.PushPopType.FunctionEvaluationFromGame}Push(d,m=0,w=0){let v=new c.Element(d,this.currentElement.currentPointer,!1);v.evaluationStackHeightWhenPushed=m,v.functionStartInOutputStream=w,this.callStack.push(v)}CanPop(d=null){return this.canPop?d==null?!0:this.currentElement.type==d:!1}Pop(d=null){if(this.CanPop(d)){this.callStack.pop();return}else throw new Error("Mismatched push/pop in Callstack")}GetTemporaryVariableWithName(d,m=-1){m==-1&&(m=this.currentElementIndex+1);let w=this.callStack[m-1],v=u.tryGetValueFromMap(w.temporaryVariables,d,null);return v.exists?v.result:null}SetTemporaryVariable(d,m,w,v=-1){v==-1&&(v=this.currentElementIndex+1);let p=this.callStack[v-1];if(!w&&!p.temporaryVariables.get(d))throw new Error("Could not find temporary variable to set: "+d);let y=u.tryGetValueFromMap(p.temporaryVariables,d,null);y.exists&&s.ListValue.RetainListOriginsForAssignment(y.result,m),p.temporaryVariables.set(d,m)}ContextForVariableNamed(d){return this.currentElement.temporaryVariables.get(d)?this.currentElementIndex+1:0}ThreadWithIndex(d){let m=this._threads.filter(w=>{if(w.threadIndex==d)return w});return m.length>0?m[0]:null}get callStack(){return this.currentThread.callstack}get callStackTrace(){let d=new o.StringBuilder;for(let m=0;m<this._threads.length;m++){let w=this._threads[m],v=m==this._threads.length-1;d.AppendFormat(`=== THREAD {0}/{1} {2}===
`,m+1,this._threads.length,v?"(current) ":"");for(let p=0;p<w.callstack.length;p++){w.callstack[p].type==e.PushPopType.Function?d.Append("  [FUNCTION] "):d.Append("  [TUNNEL] ");let y=w.callstack[p].currentPointer;if(!y.isNull){if(d.Append("<SOMEWHERE IN "),y.container===null)return h.throwNullException("pointer.container");d.Append(y.container.path.toString()),d.AppendLine(">")}}}return d.toString()}}n.CallStack=c,function(f){class d{constructor(v,p,y=!1){this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=p.copy(),this.inExpressionEvaluation=y,this.temporaryVariables=new Map,this.type=v}Copy(){let v=new d(this.type,this.currentPointer,this.inExpressionEvaluation);return v.temporaryVariables=new Map(this.temporaryVariables),v.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,v.functionStartInOutputStream=this.functionStartInOutputStream,v}}f.Element=d;class m{constructor(){if(this.threadIndex=0,this.previousPointer=l.Pointer.Null,this.callstack=[],arguments[0]&&arguments[1]){let v=arguments[0],p=arguments[1];this.threadIndex=parseInt(v.threadIndex);let y=v.callstack;for(let b of y){let _=b,O=parseInt(_.type),R=l.Pointer.Null,L,A=_.cPath;if(typeof A!="undefined"){L=A.toString();let H=p.ContentAtPath(new t.Path(L));if(R.container=H.container,R.index=parseInt(_.idx),H.obj==null)throw new Error("When loading state, internal story location couldn't be found: "+L+". Has the story changed since this save data was created?");if(H.approximate){if(R.container===null)return h.throwNullException("pointer.container");p.Warning("When loading state, exact internal story location couldn't be found: '"+L+"', so it was approximated to '"+R.container.path.toString()+"' to recover. Has the story changed since this save data was created?")}}let $=!!_.exp,U=new d(O,R,$),X=_.temp;typeof X!="undefined"?U.temporaryVariables=r.JsonSerialisation.JObjectToDictionaryRuntimeObjs(X):U.temporaryVariables.clear(),this.callstack.push(U)}let C=v.previousContentObject;if(typeof C!="undefined"){let b=new t.Path(C.toString());this.previousPointer=p.PointerAtPath(b)}}}Copy(){let v=new m;v.threadIndex=this.threadIndex;for(let p of this.callstack)v.callstack.push(p.Copy());return v.previousPointer=this.previousPointer.copy(),v}WriteJson(v){v.WriteObjectStart(),v.WritePropertyStart("callstack"),v.WriteArrayStart();for(let p of this.callstack){if(v.WriteObjectStart(),!p.currentPointer.isNull){if(p.currentPointer.container===null)return h.throwNullException("el.currentPointer.container");v.WriteProperty("cPath",p.currentPointer.container.path.componentsString),v.WriteIntProperty("idx",p.currentPointer.index)}v.WriteProperty("exp",p.inExpressionEvaluation),v.WriteIntProperty("type",p.type),p.temporaryVariables.size>0&&(v.WritePropertyStart("temp"),r.JsonSerialisation.WriteDictionaryRuntimeObjs(v,p.temporaryVariables),v.WritePropertyEnd()),v.WriteObjectEnd()}if(v.WriteArrayEnd(),v.WritePropertyEnd(),v.WriteIntProperty("threadIndex",this.threadIndex),!this.previousPointer.isNull){let p=this.previousPointer.Resolve();if(p===null)return h.throwNullException("this.previousPointer.Resolve()");v.WriteProperty("previousContentObject",p.path.toString())}v.WriteObjectEnd()}}f.Thread=m}(c=n.CallStack||(n.CallStack={}))})(Um);var ic={};Object.defineProperty(ic,"__esModule",{value:!0});ic.VariablesState=void 0;const Qe=Ae,uL=Nr,Ry=Qi,st=re,Eo=tn,Bn=We;class rc{constructor(e,t){this.variableChangedEventCallbacks=[],this.patch=null,this._batchObservingVariableChanges=!1,this._defaultGlobalVariables=new Map,this._changedVariablesForBatchObs=new Set,this._globalVariables=new Map,this._callStack=e,this._listDefsOrigin=t;try{return new Proxy(this,{get(r,s){return s in r?r[s]:r.$(s)},set(r,s,o){return s in r?r[s]=o:r.$(s,o),!0}})}catch{}}variableChangedEvent(e,t){for(let i of this.variableChangedEventCallbacks)i(e,t)}get batchObservingVariableChanges(){return this._batchObservingVariableChanges}set batchObservingVariableChanges(e){if(this._batchObservingVariableChanges=e,e)this._changedVariablesForBatchObs=new Set;else if(this._changedVariablesForBatchObs!=null){for(let t of this._changedVariablesForBatchObs){let i=this._globalVariables.get(t);i?this.variableChangedEvent(t,i):Bn.throwNullException("currentValue")}this._changedVariablesForBatchObs=null}}get callStack(){return this._callStack}set callStack(e){this._callStack=e}$(e,t){if(typeof t=="undefined"){let i=null;return this.patch!==null&&(i=this.patch.TryGetGlobal(e,null),i.exists)?i.result.valueObject:(i=this._globalVariables.get(e),typeof i=="undefined"&&(i=this._defaultGlobalVariables.get(e)),typeof i!="undefined"?i.valueObject:null)}else{if(typeof this._defaultGlobalVariables.get(e)=="undefined")throw new uL.StoryException("Cannot assign to a variable ("+e+") that hasn't been declared in the story");let i=Qe.Value.Create(t);if(i==null)throw t==null?new Error("Cannot pass null to VariableState"):new Error("Invalid value passed to VariableState: "+t.toString());this.SetGlobal(e,i)}}ApplyPatch(){if(this.patch===null)return Bn.throwNullException("this.patch");for(let[e,t]of this.patch.globals)this._globalVariables.set(e,t);if(this._changedVariablesForBatchObs!==null)for(let e of this.patch.changedVariables)this._changedVariablesForBatchObs.add(e);this.patch=null}SetJsonToken(e){this._globalVariables.clear();for(let[t,i]of this._defaultGlobalVariables){let r=e[t];if(typeof r!="undefined"){let s=Ry.JsonSerialisation.JTokenToRuntimeObject(r);if(s===null)return Bn.throwNullException("tokenInkObject");this._globalVariables.set(t,s)}else this._globalVariables.set(t,i)}}WriteJson(e){e.WriteObjectStart();for(let[t,i]of this._globalVariables){let r=t,s=i;if(rc.dontSaveDefaultValues&&this._defaultGlobalVariables.has(r)){let o=this._defaultGlobalVariables.get(r);if(this.RuntimeObjectsEqual(s,o))continue}e.WritePropertyStart(r),Ry.JsonSerialisation.WriteRuntimeObject(e,s),e.WritePropertyEnd()}e.WriteObjectEnd()}RuntimeObjectsEqual(e,t){if(e===null)return Bn.throwNullException("obj1");if(t===null)return Bn.throwNullException("obj2");if(e.constructor!==t.constructor)return!1;let i=st.asOrNull(e,Qe.BoolValue);if(i!==null)return i.value===st.asOrThrows(t,Qe.BoolValue).value;let r=st.asOrNull(e,Qe.IntValue);if(r!==null)return r.value===st.asOrThrows(t,Qe.IntValue).value;let s=st.asOrNull(e,Qe.FloatValue);if(s!==null)return s.value===st.asOrThrows(t,Qe.FloatValue).value;let o=st.asOrNull(e,Qe.Value),l=st.asOrNull(t,Qe.Value);if(o!==null&&l!==null)return st.isEquatable(o.valueObject)&&st.isEquatable(l.valueObject)?o.valueObject.Equals(l.valueObject):o.valueObject===l.valueObject;throw new Error("FastRoughDefinitelyEquals: Unsupported runtime object type: "+e.constructor.name)}GetVariableWithName(e,t=-1){let i=this.GetRawVariableWithName(e,t),r=st.asOrNull(i,Qe.VariablePointerValue);return r!==null&&(i=this.ValueAtVariablePointer(r)),i}TryGetDefaultVariableValue(e){let t=Eo.tryGetValueFromMap(this._defaultGlobalVariables,e,null);return t.exists?t.result:null}GlobalVariableExistsWithName(e){return this._globalVariables.has(e)||this._defaultGlobalVariables!==null&&this._defaultGlobalVariables.has(e)}GetRawVariableWithName(e,t){let i=null;if(t==0||t==-1){let r=null;if(this.patch!==null&&(r=this.patch.TryGetGlobal(e,null),r.exists)||(r=Eo.tryGetValueFromMap(this._globalVariables,e,null),r.exists)||this._defaultGlobalVariables!==null&&(r=Eo.tryGetValueFromMap(this._defaultGlobalVariables,e,null),r.exists))return r.result;if(this._listDefsOrigin===null)return Bn.throwNullException("VariablesState._listDefsOrigin");let s=this._listDefsOrigin.FindSingleItemListWithName(e);if(s)return s}return i=this._callStack.GetTemporaryVariableWithName(e,t),i}ValueAtVariablePointer(e){return this.GetVariableWithName(e.variableName,e.contextIndex)}Assign(e,t){let i=e.variableName;if(i===null)return Bn.throwNullException("name");let r=-1,s=!1;if(e.isNewDeclaration?s=e.isGlobal:s=this.GlobalVariableExistsWithName(i),e.isNewDeclaration){let o=st.asOrNull(t,Qe.VariablePointerValue);o!==null&&(t=this.ResolveVariablePointer(o))}else{let o=null;do o=st.asOrNull(this.GetRawVariableWithName(i,r),Qe.VariablePointerValue),o!=null&&(i=o.variableName,r=o.contextIndex,s=r==0);while(o!=null)}s?this.SetGlobal(i,t):this._callStack.SetTemporaryVariable(i,t,e.isNewDeclaration,r)}SnapshotDefaultGlobals(){this._defaultGlobalVariables=new Map(this._globalVariables)}RetainListOriginsForAssignment(e,t){let i=st.asOrThrows(e,Qe.ListValue),r=st.asOrThrows(t,Qe.ListValue);i.value&&r.value&&r.value.Count==0&&r.value.SetInitialOriginNames(i.value.originNames)}SetGlobal(e,t){let i=null;if(this.patch===null&&(i=Eo.tryGetValueFromMap(this._globalVariables,e,null)),this.patch!==null&&(i=this.patch.TryGetGlobal(e,null),i.exists||(i=Eo.tryGetValueFromMap(this._globalVariables,e,null))),Qe.ListValue.RetainListOriginsForAssignment(i.result,t),e===null)return Bn.throwNullException("variableName");if(this.patch!==null?this.patch.SetGlobal(e,t):this._globalVariables.set(e,t),this.variableChangedEvent!==null&&i!==null&&t!==i.result)if(this.batchObservingVariableChanges){if(this._changedVariablesForBatchObs===null)return Bn.throwNullException("this._changedVariablesForBatchObs");this.patch!==null?this.patch.AddChangedVariable(e):this._changedVariablesForBatchObs!==null&&this._changedVariablesForBatchObs.add(e)}else this.variableChangedEvent(e,t)}ResolveVariablePointer(e){let t=e.contextIndex;t==-1&&(t=this.GetContextIndexOfVariableNamed(e.variableName));let i=this.GetRawVariableWithName(e.variableName,t),r=st.asOrNull(i,Qe.VariablePointerValue);return r!=null?r:new Qe.VariablePointerValue(e.variableName,t)}GetContextIndexOfVariableNamed(e){return this.GlobalVariableExistsWithName(e)?0:this._callStack.currentElementIndex}ObserveVariableChange(e){this.variableChangedEventCallbacks.push(e)}}ic.VariablesState=rc;rc.dontSaveDefaultValues=!0;var na={};Object.defineProperty(na,"__esModule",{value:!0});na.PRNG=void 0;class hL{constructor(e){this.seed=e%2147483647,this.seed<=0&&(this.seed+=2147483646)}next(){return this.seed=this.seed*16807%2147483647}nextFloat(){return(this.next()-1)/2147483646}}na.PRNG=hL;var sc={};Object.defineProperty(sc,"__esModule",{value:!0});sc.StatePatch=void 0;class cL{constructor(){if(this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,arguments.length===1&&arguments[0]!==null){let e=arguments[0];this._globals=new Map(e._globals),this._changedVariables=new Set(e._changedVariables),this._visitCounts=new Map(e._visitCounts),this._turnIndices=new Map(e._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}get globals(){return this._globals}get changedVariables(){return this._changedVariables}get visitCounts(){return this._visitCounts}get turnIndices(){return this._turnIndices}TryGetGlobal(e,t){return e!==null&&this._globals.has(e)?{result:this._globals.get(e),exists:!0}:{result:t,exists:!1}}SetGlobal(e,t){this._globals.set(e,t)}AddChangedVariable(e){return this._changedVariables.add(e)}TryGetVisitCount(e,t){return this._visitCounts.has(e)?{result:this._visitCounts.get(e),exists:!0}:{result:t,exists:!1}}SetVisitCount(e,t){this._visitCounts.set(e,t)}SetTurnIndex(e,t){this._turnIndices.set(e,t)}TryGetTurnIndex(e,t){return this._turnIndices.has(e)?{result:this._turnIndices.get(e),exists:!0}:{result:t,exists:!1}}}sc.StatePatch=cL;var qm={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SimpleJson=void 0;class e{static TextToDictionary(i){return new e.Reader(i).ToDictionary()}static TextToArray(i){return new e.Reader(i).ToArray()}}n.SimpleJson=e,function(t){class i{constructor(o){this._rootObject=JSON.parse(o)}ToDictionary(){return this._rootObject}ToArray(){return this._rootObject}}t.Reader=i;class r{constructor(){this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}WriteObject(o){this.WriteObjectStart(),o(this),this.WriteObjectEnd()}WriteObjectStart(){this.StartNewObject(!0);let o={};if(this.state===t.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let l=this._propertyNameStack.pop();this.currentCollection[l]=o,this._collectionStack.push(o)}else this.state===t.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(o),this._collectionStack.push(o)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=o,this._collectionStack.push(o));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Object))}WriteObjectEnd(){this.Assert(this.state===t.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}WriteProperty(o,l){if(this.WritePropertyStart(o),arguments[1]instanceof Function)arguments[1](this);else{let a=arguments[1];this.Write(a)}this.WritePropertyEnd()}WriteIntProperty(o,l){this.WritePropertyStart(o),this.WriteInt(l),this.WritePropertyEnd()}WriteFloatProperty(o,l){this.WritePropertyStart(o),this.WriteFloat(l),this.WritePropertyEnd()}WritePropertyStart(o){this.Assert(this.state===t.Writer.State.Object),this._propertyNameStack.push(o),this.IncrementChildCount(),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property))}WritePropertyEnd(){this.Assert(this.state===t.Writer.State.Property),this.Assert(this.childCount===1),this._stateStack.pop()}WritePropertyNameStart(){this.Assert(this.state===t.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName="",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property)),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.PropertyName))}WritePropertyNameEnd(){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}WritePropertyNameInner(o){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(this._currentPropertyName!==null),this._currentPropertyName+=o}WriteArrayStart(){this.StartNewObject(!0);let o=[];if(this.state===t.Writer.State.Property){this.Assert(this.currentCollection!==null),this.Assert(this.currentPropertyName!==null);let l=this._propertyNameStack.pop();this.currentCollection[l]=o,this._collectionStack.push(o)}else this.state===t.Writer.State.Array?(this.Assert(this.currentCollection!==null),this.currentCollection.push(o),this._collectionStack.push(o)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=o,this._collectionStack.push(o));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Array))}WriteArrayEnd(){this.Assert(this.state===t.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}Write(o,l=!0){if(o===null){console.error("Warning: trying to write a null value");return}this.StartNewObject(!1),this._addToCurrentObject(o)}WriteBool(o){o!==null&&(this.StartNewObject(!1),this._addToCurrentObject(o))}WriteInt(o){o!==null&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(o)))}WriteFloat(o){o!==null&&(this.StartNewObject(!1),o==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):o==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(o)?this._addToCurrentObject(0):this._addToCurrentObject(o))}WriteNull(){this.StartNewObject(!1),this._addToCurrentObject(null)}WriteStringStart(){this.StartNewObject(!1),this._currentString="",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.String))}WriteStringEnd(){this.Assert(this.state==t.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}WriteStringInner(o,l=!0){if(this.Assert(this.state===t.Writer.State.String),o===null){console.error("Warning: trying to write a null string");return}this._currentString+=o}toString(){return this._jsonObject===null?"":JSON.stringify(this._jsonObject)}StartNewObject(o){o?this.Assert(this.state===t.Writer.State.None||this.state===t.Writer.State.Property||this.state===t.Writer.State.Array):this.Assert(this.state===t.Writer.State.Property||this.state===t.Writer.State.Array),this.state===t.Writer.State.Property&&this.Assert(this.childCount===0),(this.state===t.Writer.State.Array||this.state===t.Writer.State.Property)&&this.IncrementChildCount()}get state(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:t.Writer.State.None}get childCount(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}get currentCollection(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}get currentPropertyName(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}IncrementChildCount(){this.Assert(this._stateStack.length>0);let o=this._stateStack.pop();o.childCount++,this._stateStack.push(o)}Assert(o){if(!o)throw Error("Assert failed while writing JSON")}_addToCurrentObject(o){this.Assert(this.currentCollection!==null),this.state===t.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(o)):this.state===t.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(this.currentPropertyName!==null),this.currentCollection[this.currentPropertyName]=o,this._propertyNameStack.pop())}}t.Writer=r,function(s){(function(l){l[l.None=0]="None",l[l.Object=1]="Object",l[l.Array=2]="Array",l[l.Property=3]="Property",l[l.PropertyName=4]="PropertyName",l[l.String=5]="String"})(s.State||(s.State={}));class o{constructor(a){this.type=t.Writer.State.None,this.childCount=0,this.type=a}}s.StateElement=o}(r=t.Writer||(t.Writer={}))}(e=n.SimpleJson||(n.SimpleJson={}))})(qm);var oc={};Object.defineProperty(oc,"__esModule",{value:!0});oc.Flow=void 0;const Ly=Um,Ha=Qi,fL=We;class dL{constructor(){let e=arguments[0],t=arguments[1];if(this.name=e,this.callStack=new Ly.CallStack(t),arguments[2]){let i=arguments[2];this.callStack.SetJsonToken(i.callstack,t),this.outputStream=Ha.JsonSerialisation.JArrayToRuntimeObjList(i.outputStream),this.currentChoices=Ha.JsonSerialisation.JArrayToRuntimeObjList(i.currentChoices);let r=i.choiceThreads;typeof r!="undefined"&&this.LoadFlowChoiceThreads(r,t)}else this.outputStream=[],this.currentChoices=[]}WriteJson(e){e.WriteObjectStart(),e.WriteProperty("callstack",i=>this.callStack.WriteJson(i)),e.WriteProperty("outputStream",i=>Ha.JsonSerialisation.WriteListRuntimeObjs(i,this.outputStream));let t=!1;for(let i of this.currentChoices){if(i.threadAtGeneration===null)return fL.throwNullException("c.threadAtGeneration");i.originalThreadIndex=i.threadAtGeneration.threadIndex,this.callStack.ThreadWithIndex(i.originalThreadIndex)===null&&(t||(t=!0,e.WritePropertyStart("choiceThreads"),e.WriteObjectStart()),e.WritePropertyStart(i.originalThreadIndex),i.threadAtGeneration.WriteJson(e),e.WritePropertyEnd())}t&&(e.WriteObjectEnd(),e.WritePropertyEnd()),e.WriteProperty("currentChoices",i=>{i.WriteArrayStart();for(let r of this.currentChoices)Ha.JsonSerialisation.WriteChoice(i,r);i.WriteArrayEnd()}),e.WriteObjectEnd()}LoadFlowChoiceThreads(e,t){for(let i of this.currentChoices){let r=this.callStack.ThreadWithIndex(i.originalThreadIndex);if(r!==null)i.threadAtGeneration=r.Copy();else{let s=e[`${i.originalThreadIndex}`];i.threadAtGeneration=new Ly.CallStack.Thread(s,t)}}}}oc.Flow=dL;Object.defineProperty(nc,"__esModule",{value:!0});nc.StoryState=void 0;const pL=Um,mL=ic,Ze=Ae,pi=Rr,gL=Br,Pf=Qs,My=Mt,jn=bt,Fy=ii,mi=Qi,vL=na,yL=ri,Yr=Lr,ko=tn,ot=re,CL=jl,hn=We,SL=Zl,wL=sc,Vy=qm,za=oc,xL=Je;class Km{constructor(e){this.kInkSaveStateVersion=9,this.kMinCompatibleLoadVersion=8,this.onDidLoadState=null,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=Yr.Pointer.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this._namedFlows=null,this.kDefaultFlowName="DEFAULT_FLOW",this.story=e,this._currentFlow=new za.Flow(this.kDefaultFlowName,e),this.OutputStreamDirty(),this._evaluationStack=[],this._variablesState=new mL.VariablesState(this.callStack,e.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;let t=new Date().getTime();this.storySeed=new vL.PRNG(t).next()%100,this.previousRandom=0,this.GoToStart()}ToJson(e=!1){let t=new Vy.SimpleJson.Writer;return this.WriteJson(t),t.toString()}toJson(e=!1){return this.ToJson(e)}LoadJson(e){let t=Vy.SimpleJson.TextToDictionary(e);this.LoadJsonObj(t),this.onDidLoadState!==null&&this.onDidLoadState()}VisitCountAtPathString(e){let t;if(this._patch!==null){let i=this.story.ContentAtPath(new My.Path(e)).container;if(i===null)throw new Error("Content at path not found: "+e);if(t=this._patch.TryGetVisitCount(i,0),t.exists)return t.result}return t=ko.tryGetValueFromMap(this._visitCounts,e,null),t.exists?t.result:0}VisitCountForContainer(e){if(e===null)return hn.throwNullException("container");if(!e.visitsShouldBeCounted)return this.story.Error("Read count for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),0;if(this._patch!==null){let r=this._patch.TryGetVisitCount(e,0);if(r.exists)return r.result}let t=e.path.toString(),i=ko.tryGetValueFromMap(this._visitCounts,t,null);return i.exists?i.result:0}IncrementVisitCountForContainer(e){if(this._patch!==null){let r=this.VisitCountForContainer(e);r++,this._patch.SetVisitCount(e,r);return}let t=e.path.toString(),i=ko.tryGetValueFromMap(this._visitCounts,t,null);i.exists?this._visitCounts.set(t,i.result+1):this._visitCounts.set(t,1)}RecordTurnIndexVisitToContainer(e){if(this._patch!==null){this._patch.SetTurnIndex(e,this.currentTurnIndex);return}let t=e.path.toString();this._turnIndices.set(t,this.currentTurnIndex)}TurnsSinceForContainer(e){if(e.turnIndexShouldBeCounted||this.story.Error("TURNS_SINCE() for target ("+e.name+" - on "+e.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),this._patch!==null){let r=this._patch.TryGetTurnIndex(e,0);if(r.exists)return this.currentTurnIndex-r.result}let t=e.path.toString(),i=ko.tryGetValueFromMap(this._turnIndices,t,0);return i.exists?this.currentTurnIndex-i.result:-1}get callstackDepth(){return this.callStack.depth}get outputStream(){return this._currentFlow.outputStream}get currentChoices(){return this.canContinue?[]:this._currentFlow.currentChoices}get generatedChoices(){return this._currentFlow.currentChoices}get currentErrors(){return this._currentErrors}get currentWarnings(){return this._currentWarnings}get variablesState(){return this._variablesState}set variablesState(e){this._variablesState=e}get callStack(){return this._currentFlow.callStack}get evaluationStack(){return this._evaluationStack}get currentTurnIndex(){return this._currentTurnIndex}set currentTurnIndex(e){this._currentTurnIndex=e}get currentPathString(){let e=this.currentPointer;return e.isNull?null:e.path===null?hn.throwNullException("pointer.path"):e.path.toString()}get currentPointer(){return this.callStack.currentElement.currentPointer.copy()}set currentPointer(e){this.callStack.currentElement.currentPointer=e.copy()}get previousPointer(){return this.callStack.currentThread.previousPointer.copy()}set previousPointer(e){this.callStack.currentThread.previousPointer=e.copy()}get canContinue(){return!this.currentPointer.isNull&&!this.hasError}get hasError(){return this.currentErrors!=null&&this.currentErrors.length>0}get hasWarning(){return this.currentWarnings!=null&&this.currentWarnings.length>0}get currentText(){if(this._outputStreamTextDirty){let e=new Fy.StringBuilder;for(let t of this.outputStream){let i=ot.asOrNull(t,Ze.StringValue);i!==null&&e.Append(i.value)}this._currentText=this.CleanOutputWhitespace(e.toString()),this._outputStreamTextDirty=!1}return this._currentText}CleanOutputWhitespace(e){let t=new Fy.StringBuilder,i=-1,r=0;for(let s=0;s<e.length;s++){let o=e.charAt(s),l=o==" "||o=="	";l&&i==-1&&(i=s),l||(o!=`
`&&i>0&&i!=r&&t.Append(" "),i=-1),o==`
`&&(r=s+1),l||t.Append(o)}return t.toString()}get currentTags(){if(this._outputStreamTagsDirty){this._currentTags=[];for(let e of this.outputStream){let t=ot.asOrNull(e,gL.Tag);t!==null&&this._currentTags.push(t.text)}this._outputStreamTagsDirty=!1}return this._currentTags}get currentFlowName(){return this._currentFlow.name}get inExpressionEvaluation(){return this.callStack.currentElement.inExpressionEvaluation}set inExpressionEvaluation(e){this.callStack.currentElement.inExpressionEvaluation=e}GoToStart(){this.callStack.currentElement.currentPointer=Yr.Pointer.StartOf(this.story.mainContentContainer)}SwitchFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.SwitchFlow");if(this._namedFlows===null&&(this._namedFlows=new Map,this._namedFlows.set(this.kDefaultFlowName,this._currentFlow)),e===this._currentFlow.name)return;let t,i=ko.tryGetValueFromMap(this._namedFlows,e,null);i.exists?t=i.result:(t=new za.Flow(e,this.story),this._namedFlows.set(e,t)),this._currentFlow=t,this.variablesState.callStack=this._currentFlow.callStack,this.OutputStreamDirty()}SwitchToDefaultFlow_Internal(){this._namedFlows!==null&&this.SwitchFlow_Internal(this.kDefaultFlowName)}RemoveFlow_Internal(e){if(e===null)throw new Error("Must pass a non-null string to Story.DestroyFlow");if(e===this.kDefaultFlowName)throw new Error("Cannot destroy default flow");if(this._currentFlow.name===e&&this.SwitchToDefaultFlow_Internal(),this._namedFlows===null)return hn.throwNullException("this._namedFlows");this._namedFlows.delete(e)}CopyAndStartPatching(){let e=new Km(this.story);if(e._patch=new wL.StatePatch(this._patch),e._currentFlow.name=this._currentFlow.name,e._currentFlow.callStack=new pL.CallStack(this._currentFlow.callStack),e._currentFlow.currentChoices.push(...this._currentFlow.currentChoices),e._currentFlow.outputStream.push(...this._currentFlow.outputStream),e.OutputStreamDirty(),this._namedFlows!==null){e._namedFlows=new Map;for(let[t,i]of this._namedFlows)e._namedFlows.set(t,i);e._namedFlows.set(this._currentFlow.name,e._currentFlow)}return this.hasError&&(e._currentErrors=[],e._currentErrors.push(...this.currentErrors||[])),this.hasWarning&&(e._currentWarnings=[],e._currentWarnings.push(...this.currentWarnings||[])),e.variablesState=this.variablesState,e.variablesState.callStack=e.callStack,e.variablesState.patch=e._patch,e.evaluationStack.push(...this.evaluationStack),this.divertedPointer.isNull||(e.divertedPointer=this.divertedPointer.copy()),e.previousPointer=this.previousPointer.copy(),e._visitCounts=this._visitCounts,e._turnIndices=this._turnIndices,e.currentTurnIndex=this.currentTurnIndex,e.storySeed=this.storySeed,e.previousRandom=this.previousRandom,e.didSafeExit=this.didSafeExit,e}RestoreAfterPatch(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}ApplyAnyPatch(){if(this._patch!==null){this.variablesState.ApplyPatch();for(let[e,t]of this._patch.visitCounts)this.ApplyCountChanges(e,t,!0);for(let[e,t]of this._patch.turnIndices)this.ApplyCountChanges(e,t,!1);this._patch=null}}ApplyCountChanges(e,t,i){(i?this._visitCounts:this._turnIndices).set(e.path.toString(),t)}WriteJson(e){if(e.WriteObjectStart(),e.WritePropertyStart("flows"),e.WriteObjectStart(),this._namedFlows!==null)for(let[t,i]of this._namedFlows)e.WriteProperty(t,r=>i.WriteJson(r));else e.WriteProperty(this._currentFlow.name,t=>this._currentFlow.WriteJson(t));if(e.WriteObjectEnd(),e.WritePropertyEnd(),e.WriteProperty("currentFlowName",this._currentFlow.name),e.WriteProperty("variablesState",t=>this.variablesState.WriteJson(t)),e.WriteProperty("evalStack",t=>mi.JsonSerialisation.WriteListRuntimeObjs(t,this.evaluationStack)),!this.divertedPointer.isNull){if(this.divertedPointer.path===null)return hn.throwNullException("divertedPointer");e.WriteProperty("currentDivertTarget",this.divertedPointer.path.componentsString)}e.WriteProperty("visitCounts",t=>mi.JsonSerialisation.WriteIntDictionary(t,this._visitCounts)),e.WriteProperty("turnIndices",t=>mi.JsonSerialisation.WriteIntDictionary(t,this._turnIndices)),e.WriteIntProperty("turnIdx",this.currentTurnIndex),e.WriteIntProperty("storySeed",this.storySeed),e.WriteIntProperty("previousRandom",this.previousRandom),e.WriteIntProperty("inkSaveVersion",this.kInkSaveStateVersion),e.WriteIntProperty("inkFormatVersion",SL.Story.inkVersionCurrent),e.WriteObjectEnd()}LoadJsonObj(e){let t=e,i=t.inkSaveVersion;if(i==null)throw new Error("ink save format incorrect, can't load.");if(parseInt(i)<this.kMinCompatibleLoadVersion)throw new Error("Ink save format isn't compatible with the current version (saw '"+i+"', but minimum is "+this.kMinCompatibleLoadVersion+"), so can't load.");let r=t.flows;if(r!=null){let o=r;Object.keys(o).length===1?this._namedFlows=null:this._namedFlows===null?this._namedFlows=new Map:this._namedFlows.clear();let l=Object.entries(o);for(let[a,u]of l){let h=a,c=u,f=new za.Flow(h,this.story,c);if(Object.keys(o).length===1)this._currentFlow=new za.Flow(h,this.story,c);else{if(this._namedFlows===null)return hn.throwNullException("this._namedFlows");this._namedFlows.set(h,f)}}if(this._namedFlows!=null&&this._namedFlows.size>1){let a=t.currentFlowName;this._currentFlow=this._namedFlows.get(a)}}else{this._namedFlows=null,this._currentFlow.name=this.kDefaultFlowName,this._currentFlow.callStack.SetJsonToken(t.callstackThreads,this.story),this._currentFlow.outputStream=mi.JsonSerialisation.JArrayToRuntimeObjList(t.outputStream),this._currentFlow.currentChoices=mi.JsonSerialisation.JArrayToRuntimeObjList(t.currentChoices);let o=t.choiceThreads;this._currentFlow.LoadFlowChoiceThreads(o,this.story)}this.OutputStreamDirty(),this.variablesState.SetJsonToken(t.variablesState),this.variablesState.callStack=this._currentFlow.callStack,this._evaluationStack=mi.JsonSerialisation.JArrayToRuntimeObjList(t.evalStack);let s=t.currentDivertTarget;if(s!=null){let o=new My.Path(s.toString());this.divertedPointer=this.story.PointerAtPath(o)}this._visitCounts=mi.JsonSerialisation.JObjectToIntDictionary(t.visitCounts),this._turnIndices=mi.JsonSerialisation.JObjectToIntDictionary(t.turnIndices),this.currentTurnIndex=parseInt(t.turnIdx),this.storySeed=parseInt(t.storySeed),this.previousRandom=parseInt(t.previousRandom)}ResetErrors(){this._currentErrors=null,this._currentWarnings=null}ResetOutput(e=null){this.outputStream.length=0,e!==null&&this.outputStream.push(...e),this.OutputStreamDirty()}PushToOutputStream(e){let t=ot.asOrNull(e,Ze.StringValue);if(t!==null){let i=this.TrySplittingHeadTailWhitespace(t);if(i!==null){for(let r of i)this.PushToOutputStreamIndividual(r);this.OutputStreamDirty();return}}this.PushToOutputStreamIndividual(e),this.OutputStreamDirty()}PopFromOutputStream(e){this.outputStream.splice(this.outputStream.length-e,e),this.OutputStreamDirty()}TrySplittingHeadTailWhitespace(e){let t=e.value;if(t===null)return hn.throwNullException("single.value");let i=-1,r=-1;for(let h=0;h<t.length;h++){let c=t[h];if(c==`
`)i==-1&&(i=h),r=h;else{if(c==" "||c=="	")continue;break}}let s=-1,o=-1;for(let h=t.length-1;h>=0;h--){let c=t[h];if(c==`
`)s==-1&&(s=h),o=h;else{if(c==" "||c=="	")continue;break}}if(i==-1&&s==-1)return null;let l=[],a=0,u=t.length;if(i!=-1){if(i>0){let h=new Ze.StringValue(t.substring(0,i));l.push(h)}l.push(new Ze.StringValue(`
`)),a=r+1}if(s!=-1&&(u=o),u>a){let h=t.substring(a,u-a);l.push(new Ze.StringValue(h))}if(s!=-1&&o>r&&(l.push(new Ze.StringValue(`
`)),s<t.length-1)){let h=t.length-s-1,c=new Ze.StringValue(t.substring(s+1,h));l.push(c)}return l}PushToOutputStreamIndividual(e){let t=ot.asOrNull(e,Pf.Glue),i=ot.asOrNull(e,Ze.StringValue),r=!0;if(t)this.TrimNewlinesFromOutputStream(),r=!0;else if(i){let s=-1,o=this.callStack.currentElement;o.type==pi.PushPopType.Function&&(s=o.functionStartInOutputStream);let l=-1;for(let u=this.outputStream.length-1;u>=0;u--){let h=this.outputStream[u],c=h instanceof jn.ControlCommand?h:null;if((h instanceof Pf.Glue?h:null)!=null){l=u;break}else if(c!=null&&c.commandType==jn.ControlCommand.CommandType.BeginString){u>=s&&(s=-1);break}}let a=-1;if(l!=-1&&s!=-1?a=Math.min(s,l):l!=-1?a=l:a=s,a!=-1){if(i.isNewline)r=!1;else if(i.isNonWhitespace&&(l>-1&&this.RemoveExistingGlue(),s>-1)){let u=this.callStack.elements;for(let h=u.length-1;h>=0;h--){let c=u[h];if(c.type==pi.PushPopType.Function)c.functionStartInOutputStream=-1;else break}}}else i.isNewline&&(this.outputStreamEndsInNewline||!this.outputStreamContainsContent)&&(r=!1)}if(r){if(e===null)return hn.throwNullException("obj");this.outputStream.push(e),this.OutputStreamDirty()}}TrimNewlinesFromOutputStream(){let e=-1,t=this.outputStream.length-1;for(;t>=0;){let i=this.outputStream[t],r=ot.asOrNull(i,jn.ControlCommand),s=ot.asOrNull(i,Ze.StringValue);if(r!=null||s!=null&&s.isNonWhitespace)break;s!=null&&s.isNewline&&(e=t),t--}if(e>=0)for(t=e;t<this.outputStream.length;)ot.asOrNull(this.outputStream[t],Ze.StringValue)?this.outputStream.splice(t,1):t++;this.OutputStreamDirty()}RemoveExistingGlue(){for(let e=this.outputStream.length-1;e>=0;e--){let t=this.outputStream[e];if(t instanceof Pf.Glue)this.outputStream.splice(e,1);else if(t instanceof jn.ControlCommand)break}this.OutputStreamDirty()}get outputStreamEndsInNewline(){if(this.outputStream.length>0)for(let e=this.outputStream.length-1;e>=0&&!(this.outputStream[e]instanceof jn.ControlCommand);e--){let i=this.outputStream[e];if(i instanceof Ze.StringValue){if(i.isNewline)return!0;if(i.isNonWhitespace)break}}return!1}get outputStreamContainsContent(){for(let e of this.outputStream)if(e instanceof Ze.StringValue)return!0;return!1}get inStringEvaluation(){for(let e=this.outputStream.length-1;e>=0;e--){let t=ot.asOrNull(this.outputStream[e],jn.ControlCommand);if(t instanceof jn.ControlCommand&&t.commandType==jn.ControlCommand.CommandType.BeginString)return!0}return!1}PushEvaluationStack(e){let t=ot.asOrNull(e,Ze.ListValue);if(t){let i=t.value;if(i===null)return hn.throwNullException("rawList");if(i.originNames!=null){i.origins||(i.origins=[]),i.origins.length=0;for(let r of i.originNames){if(this.story.listDefinitions===null)return hn.throwNullException("StoryState.story.listDefinitions");let s=this.story.listDefinitions.TryListGetDefinition(r,null);if(s.result===null)return hn.throwNullException("StoryState def.result");i.origins.indexOf(s.result)<0&&i.origins.push(s.result)}}}if(e===null)return hn.throwNullException("obj");this.evaluationStack.push(e)}PopEvaluationStack(e){if(typeof e=="undefined"){let t=this.evaluationStack.pop();return ot.nullIfUndefined(t)}else{if(e>this.evaluationStack.length)throw new Error("trying to pop too many objects");let t=this.evaluationStack.splice(this.evaluationStack.length-e,e);return ot.nullIfUndefined(t)}}PeekEvaluationStack(){return this.evaluationStack[this.evaluationStack.length-1]}ForceEnd(){this.callStack.Reset(),this._currentFlow.currentChoices.length=0,this.currentPointer=Yr.Pointer.Null,this.previousPointer=Yr.Pointer.Null,this.didSafeExit=!0}TrimWhitespaceFromFunctionEnd(){CL.Debug.Assert(this.callStack.currentElement.type==pi.PushPopType.Function);let e=this.callStack.currentElement.functionStartInOutputStream;e==-1&&(e=0);for(let t=this.outputStream.length-1;t>=e;t--){let i=this.outputStream[t],r=ot.asOrNull(i,Ze.StringValue),s=ot.asOrNull(i,jn.ControlCommand);if(r!=null){if(s)break;if(r.isNewline||r.isInlineWhitespace)this.outputStream.splice(t,1),this.OutputStreamDirty();else break}}}PopCallStack(e=null){this.callStack.currentElement.type==pi.PushPopType.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(e)}SetChosenPath(e,t){this._currentFlow.currentChoices.length=0;let i=this.story.PointerAtPath(e);!i.isNull&&i.index==-1&&(i.index=0),this.currentPointer=i,t&&this.currentTurnIndex++}StartFunctionEvaluationFromGame(e,t){this.callStack.Push(pi.PushPopType.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=Yr.Pointer.StartOf(e),this.PassArgumentsToEvaluationStack(t)}PassArgumentsToEvaluationStack(e){if(e!==null)for(let t=0;t<e.length;t++){if(!(typeof e[t]=="number"||typeof e[t]=="string")||e[t]instanceof xL.InkList)throw new Error("ink arguments when calling EvaluateFunction / ChoosePathStringWithParameters must benumber, string or InkList. Argument was "+(ot.nullIfUndefined(arguments[t])===null)?"null":arguments[t].constructor.name);this.PushEvaluationStack(Ze.Value.Create(e[t]))}}TryExitFunctionEvaluationFromGame(){return this.callStack.currentElement.type==pi.PushPopType.FunctionEvaluationFromGame?(this.currentPointer=Yr.Pointer.Null,this.didSafeExit=!0,!0):!1}CompleteFunctionEvaluationFromGame(){if(this.callStack.currentElement.type!=pi.PushPopType.FunctionEvaluationFromGame)throw new Error("Expected external function evaluation to be complete. Stack trace: "+this.callStack.callStackTrace);let e=this.callStack.currentElement.evaluationStackHeightWhenPushed,t=null;for(;this.evaluationStack.length>e;){let i=this.PopEvaluationStack();t===null&&(t=i)}if(this.PopCallStack(pi.PushPopType.FunctionEvaluationFromGame),t){if(t instanceof yL.Void)return null;let i=ot.asOrThrows(t,Ze.Value);return i.valueType==Ze.ValueType.DivertTarget?i.valueObject.toString():i.valueObject}return null}AddError(e,t){t?(this._currentWarnings==null&&(this._currentWarnings=[]),this._currentWarnings.push(e)):(this._currentErrors==null&&(this._currentErrors=[]),this._currentErrors.push(e))}OutputStreamDirty(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}nc.StoryState=Km;var lc={};Object.defineProperty(lc,"__esModule",{value:!0});lc.Stopwatch=void 0;class bL{constructor(){this.startTime=void 0}get ElapsedMilliseconds(){return typeof this.startTime=="undefined"?0:new Date().getTime()-this.startTime}Start(){this.startTime=new Date().getTime()}Stop(){this.startTime=void 0}}lc.Stopwatch=bL;var Ex={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorType=void 0,function(e){e[e.Author=0]="Author",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(n.ErrorType||(n.ErrorType={}))})(Ex);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Story=n.InkList=void 0;const e=Be,t=mt,i=Qi,r=nc,s=bt,o=Rr,l=Hs,a=ea,u=mn,h=Ae,c=Mt,f=ri,d=Br,m=Fn,w=Wr,v=on,p=Nr,y=na,C=ii,b=ta,_=lc,O=Lr,R=Je,L=re,A=We,$=qm,U=Ex;var X=Je;Object.defineProperty(n,"InkList",{enumerable:!0,get:function(){return X.InkList}}),Number.isInteger||(Number.isInteger=function(S){return typeof S=="number"&&isFinite(S)&&S>-9007199254740992&&S<9007199254740992&&Math.floor(S)===S});class H extends t.InkObject{constructor(){super();this.inkVersionMinimumCompatible=18,this.onError=null,this.onDidContinue=null,this.onMakeChoice=null,this.onEvaluateFunction=null,this.onCompleteEvaluateFunction=null,this.onChoosePathString=null,this._prevContainers=[],this.allowExternalFunctionFallbacks=!1,this._listDefinitions=null,this._variableObservers=null,this._hasValidatedExternals=!1,this._temporaryEvaluationContainer=null,this._asyncContinueActive=!1,this._stateSnapshotAtLastNewline=null,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount=0,this._asyncSaving=!1,this._profiler=null;let S,E=null,P=null;if(arguments[0]instanceof e.Container)S=arguments[0],typeof arguments[1]!="undefined"&&(E=arguments[1]),this._mainContentContainer=S;else if(typeof arguments[0]=="string"){let T=arguments[0];P=$.SimpleJson.TextToDictionary(T)}else P=arguments[0];if(E!=null&&(this._listDefinitions=new b.ListDefinitionsOrigin(E)),this._externals=new Map,P!==null){let T=P,N=T.inkVersion;if(N==null)throw new Error("ink version number not found. Are you sure it's a valid .ink.json file?");let j=parseInt(N);if(j>H.inkVersionCurrent)throw new Error("Version of ink used to build story was newer than the current version of the engine");if(j<this.inkVersionMinimumCompatible)throw new Error("Version of ink used to build story is too old to be loaded by this version of the engine");j!=H.inkVersionCurrent&&console.warn("WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.");let D=T.root;if(D==null)throw new Error("Root node for ink not found. Are you sure it's a valid .ink.json file?");let W;(W=T.listDefs)&&(this._listDefinitions=i.JsonSerialisation.JTokenToListDefinitions(W)),this._mainContentContainer=L.asOrThrows(i.JsonSerialisation.JTokenToRuntimeObject(D),e.Container),this.ResetState()}}get currentChoices(){let S=[];if(this._state===null)return A.throwNullException("this._state");for(let E of this._state.currentChoices)E.isInvisibleDefault||(E.index=S.length,S.push(E));return S}get currentText(){return this.IfAsyncWeCant("call currentText since it's a work in progress"),this.state.currentText}get currentTags(){return this.IfAsyncWeCant("call currentTags since it's a work in progress"),this.state.currentTags}get currentErrors(){return this.state.currentErrors}get currentWarnings(){return this.state.currentWarnings}get currentFlowName(){return this.state.currentFlowName}get hasError(){return this.state.hasError}get hasWarning(){return this.state.hasWarning}get variablesState(){return this.state.variablesState}get listDefinitions(){return this._listDefinitions}get state(){return this._state}StartProfiling(){}EndProfiling(){}ToJson(S){let E=!1;if(S||(E=!0,S=new $.SimpleJson.Writer),S.WriteObjectStart(),S.WriteIntProperty("inkVersion",H.inkVersionCurrent),S.WriteProperty("root",P=>i.JsonSerialisation.WriteRuntimeContainer(P,this._mainContentContainer)),this._listDefinitions!=null){S.WritePropertyStart("listDefs"),S.WriteObjectStart();for(let P of this._listDefinitions.lists){S.WritePropertyStart(P.name),S.WriteObjectStart();for(let[T,N]of P.items){let j=R.InkListItem.fromSerializedKey(T),D=N;S.WriteIntProperty(j.itemName,D)}S.WriteObjectEnd(),S.WritePropertyEnd()}S.WriteObjectEnd(),S.WritePropertyEnd()}if(S.WriteObjectEnd(),E)return S.toString()}ResetState(){this.IfAsyncWeCant("ResetState"),this._state=new r.StoryState(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}ResetErrors(){if(this._state===null)return A.throwNullException("this._state");this._state.ResetErrors()}ResetCallstack(){if(this.IfAsyncWeCant("ResetCallstack"),this._state===null)return A.throwNullException("this._state");this._state.ForceEnd()}ResetGlobals(){if(this._mainContentContainer.namedContent.get("global decl")){let S=this.state.currentPointer.copy();this.ChoosePath(new c.Path("global decl"),!1),this.ContinueInternal(),this.state.currentPointer=S}this.state.variablesState.SnapshotDefaultGlobals()}SwitchFlow(S){if(this.IfAsyncWeCant("switch flow"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't switch flow to "+S);this.state.SwitchFlow_Internal(S)}RemoveFlow(S){this.state.RemoveFlow_Internal(S)}SwitchToDefaultFlow(){this.state.SwitchToDefaultFlow_Internal()}Continue(){return this.ContinueAsync(0),this.currentText}get canContinue(){return this.state.canContinue}get asyncContinueComplete(){return!this._asyncContinueActive}ContinueAsync(S){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(S)}ContinueInternal(S=0){this._profiler!=null&&this._profiler.PreContinue();let E=S>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=E,!this.canContinue)throw new Error("Can't continue - should check canContinue before calling Continue");this._state.didSafeExit=!1,this._state.ResetOutput(),this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!0)}let P=new _.Stopwatch;P.Start();let T=!1;this._sawLookaheadUnsafeFunctionAfterNewline=!1;do{try{T=this.ContinueSingleStep()}catch(N){if(!(N instanceof p.StoryException))throw N;this.AddError(N.message,void 0,N.useEndLineNumber);break}if(T||this._asyncContinueActive&&P.ElapsedMilliseconds>S)break}while(this.canContinue);if(P.Stop(),(T||!this.canContinue)&&(this._stateSnapshotAtLastNewline!==null&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError("Thread available to pop, threads should always be flat by the end of evaluation?"),this.state.generatedChoices.length==0&&!this.state.didSafeExit&&this._temporaryEvaluationContainer==null&&(this.state.callStack.CanPop(o.PushPopType.Tunnel)?this.AddError("unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?"):this.state.callStack.CanPop(o.PushPopType.Function)?this.AddError("unexpectedly reached end of content. Do you need a '~ return'?"):this.state.callStack.canPop?this.AddError("unexpectedly reached end of content for unknown reason. Please debug compiler!"):this.AddError("ran out of content. Do you need a '-> DONE' or '-> END'?"))),this.state.didSafeExit=!1,this._sawLookaheadUnsafeFunctionAfterNewline=!1,this._recursiveContinueCount==1&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1,this.onDidContinue!==null&&this.onDidContinue()),this._recursiveContinueCount--,this._profiler!=null&&this._profiler.PostContinue(),this.state.hasError||this.state.hasWarning)if(this.onError!==null){if(this.state.hasError)for(let N of this.state.currentErrors)this.onError(N,U.ErrorType.Error);if(this.state.hasWarning)for(let N of this.state.currentWarnings)this.onError(N,U.ErrorType.Warning);this.ResetErrors()}else{let N=new C.StringBuilder;throw N.Append("Ink had "),this.state.hasError&&(N.Append(`${this.state.currentErrors.length}`),N.Append(this.state.currentErrors.length==1?" error":"errors"),this.state.hasWarning&&N.Append(" and ")),this.state.hasWarning&&(N.Append(`${this.state.currentWarnings.length}`),N.Append(this.state.currentWarnings.length==1?" warning":"warnings"),this.state.hasWarning&&N.Append(" and ")),N.Append(". It is strongly suggested that you assign an error handler to story.onError. The first issue was: "),N.Append(this.state.hasError?this.state.currentErrors[0]:this.state.currentWarnings[0]),new p.StoryException(N.toString())}}ContinueSingleStep(){if(this._profiler!=null&&this._profiler.PreStep(),this.Step(),this._profiler!=null&&this._profiler.PostStep(),!this.canContinue&&!this.state.callStack.elementIsEvaluateFromGame&&this.TryFollowDefaultInvisibleChoice(),this._profiler!=null&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(this._stateSnapshotAtLastNewline!==null){if(this._stateSnapshotAtLastNewline.currentTags===null)return A.throwNullException("this._stateAtLastNewline.currentTags");if(this.state.currentTags===null)return A.throwNullException("this.state.currentTags");let S=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(S==H.OutputStateChange.ExtendedBeyondNewline||this._sawLookaheadUnsafeFunctionAfterNewline)return this.RestoreStateSnapshot(),!0;S==H.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?this._stateSnapshotAtLastNewline==null&&this.StateSnapshot():this.DiscardSnapshot())}return this._profiler!=null&&this._profiler.PostSnapshot(),!1}CalculateNewlineOutputStateChange(S,E,P,T){if(S===null)return A.throwNullException("prevText");if(E===null)return A.throwNullException("currText");let N=E.length>=S.length&&E.charAt(S.length-1)==`
`;if(P==T&&S.length==E.length&&N)return H.OutputStateChange.NoChange;if(!N)return H.OutputStateChange.NewlineRemoved;if(T>P)return H.OutputStateChange.ExtendedBeyondNewline;for(let j=S.length;j<E.length;j++){let D=E.charAt(j);if(D!=" "&&D!="	")return H.OutputStateChange.ExtendedBeyondNewline}return H.OutputStateChange.NoChange}ContinueMaximally(){this.IfAsyncWeCant("ContinueMaximally");let S=new C.StringBuilder;for(;this.canContinue;)S.Append(this.Continue());return S.toString()}ContentAtPath(S){return this.mainContentContainer.ContentAtPath(S)}KnotContainerWithName(S){let E=this.mainContentContainer.namedContent.get(S);return E instanceof e.Container?E:null}PointerAtPath(S){if(S.length==0)return O.Pointer.Null;let E=new O.Pointer,P=S.length,T=null;return S.lastComponent===null?A.throwNullException("path.lastComponent"):(S.lastComponent.isIndex?(P=S.length-1,T=this.mainContentContainer.ContentAtPath(S,void 0,P),E.container=T.container,E.index=S.lastComponent.index):(T=this.mainContentContainer.ContentAtPath(S),E.container=T.container,E.index=-1),T.obj==null||T.obj==this.mainContentContainer&&P>0?this.Error("Failed to find content at path '"+S+"', and no approximation of it was possible."):T.approximate&&this.Warning("Failed to find content at path '"+S+"', so it was approximated to: '"+T.obj.path+"'."),E)}StateSnapshot(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}RestoreStateSnapshot(){this._stateSnapshotAtLastNewline===null&&A.throwNullException("_stateSnapshotAtLastNewline"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}DiscardSnapshot(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}CopyStateForBackgroundThreadSave(){if(this.IfAsyncWeCant("start saving on a background thread"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!");let S=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,S}BackgroundSaveComplete(){this._stateSnapshotAtLastNewline===null&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}Step(){let S=!0,E=this.state.currentPointer.copy();if(E.isNull)return;let P=L.asOrNull(E.Resolve(),e.Container);for(;P&&(this.VisitContainer(P,!0),P.content.length!=0);)E=O.Pointer.StartOf(P),P=L.asOrNull(E.Resolve(),e.Container);this.state.currentPointer=E.copy(),this._profiler!=null&&this._profiler.Step(this.state.callStack);let T=E.Resolve(),N=this.PerformLogicAndFlowControl(T);if(this.state.currentPointer.isNull)return;N&&(S=!1);let j=L.asOrNull(T,l.ChoicePoint);if(j){let W=this.ProcessChoice(j);W&&this.state.generatedChoices.push(W),T=null,S=!1}if(T instanceof e.Container&&(S=!1),S){let W=L.asOrNull(T,h.VariablePointerValue);if(W&&W.contextIndex==-1){let z=this.state.callStack.ContextForVariableNamed(W.variableName);T=new h.VariablePointerValue(W.variableName,z)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(T):this.state.PushToOutputStream(T)}this.NextContent();let D=L.asOrNull(T,s.ControlCommand);D&&D.commandType==s.ControlCommand.CommandType.StartThread&&this.state.callStack.PushThread()}VisitContainer(S,E){(!S.countingAtStartOnly||E)&&(S.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(S),S.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(S))}VisitChangedContainersDueToDivert(){let S=this.state.previousPointer.copy(),E=this.state.currentPointer.copy();if(E.isNull||E.index==-1)return;if(this._prevContainers.length=0,!S.isNull){let j=S.Resolve(),D=L.asOrNull(j,e.Container)||L.asOrNull(S.container,e.Container);for(;D;)this._prevContainers.push(D),D=L.asOrNull(D.parent,e.Container)}let P=E.Resolve();if(P==null)return;let T=L.asOrNull(P.parent,e.Container),N=!0;for(;T&&(this._prevContainers.indexOf(T)<0||T.countingAtStartOnly);){let j=T.content.length>0&&P==T.content[0]&&N;j||(N=!1),this.VisitContainer(T,j),P=T,T=L.asOrNull(T.parent,e.Container)}}ProcessChoice(S){let E=!0;if(S.hasCondition){let j=this.state.PopEvaluationStack();this.IsTruthy(j)||(E=!1)}let P="",T="";if(S.hasChoiceOnlyContent&&(T=L.asOrThrows(this.state.PopEvaluationStack(),h.StringValue).value||""),S.hasStartContent&&(P=L.asOrThrows(this.state.PopEvaluationStack(),h.StringValue).value||""),S.onceOnly&&this.state.VisitCountForContainer(S.choiceTarget)>0&&(E=!1),!E)return null;let N=new a.Choice;return N.targetPath=S.pathOnChoice,N.sourcePath=S.path.toString(),N.isInvisibleDefault=S.isInvisibleDefault,N.threadAtGeneration=this.state.callStack.ForkThread(),N.text=(P+T).replace(/^[ \t]+|[ \t]+$/g,""),N}IsTruthy(S){let E=!1;if(S instanceof h.Value){let P=S;if(P instanceof h.DivertTargetValue){let T=P;return this.Error("Shouldn't use a divert target (to "+T.targetPath+") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)"),!1}return P.isTruthy}return E}PerformLogicAndFlowControl(S){if(S==null)return!1;if(S instanceof u.Divert){let E=S;if(E.isConditional){let P=this.state.PopEvaluationStack();if(!this.IsTruthy(P))return!0}if(E.hasVariableTarget){let P=E.variableDivertName,T=this.state.variablesState.GetVariableWithName(P);if(T==null)this.Error("Tried to divert using a target from a variable that could not be found ("+P+")");else if(!(T instanceof h.DivertTargetValue)){let j=L.asOrNull(T,h.IntValue),D="Tried to divert to a target from a variable, but the variable ("+P+") didn't contain a divert target, it ";j instanceof h.IntValue&&j.value==0?D+="was empty/null (the value 0).":D+="contained '"+T+"'.",this.Error(D)}let N=L.asOrThrows(T,h.DivertTargetValue);this.state.divertedPointer=this.PointerAtPath(N.targetPath)}else{if(E.isExternal)return this.CallExternalFunction(E.targetPathString,E.externalArgs),!0;this.state.divertedPointer=E.targetPointer.copy()}return E.pushesToStack&&this.state.callStack.Push(E.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!E.isExternal&&(E&&E.debugMetadata&&E.debugMetadata.sourceName!=null?this.Error("Divert target doesn't exist: "+E.debugMetadata.sourceName):this.Error("Divert resolution failed: "+E)),!0}else if(S instanceof s.ControlCommand){let E=S;switch(E.commandType){case s.ControlCommand.CommandType.EvalStart:this.Assert(this.state.inExpressionEvaluation===!1,"Already in expression evaluation?"),this.state.inExpressionEvaluation=!0;break;case s.ControlCommand.CommandType.EvalEnd:this.Assert(this.state.inExpressionEvaluation===!0,"Not in expression evaluation mode"),this.state.inExpressionEvaluation=!1;break;case s.ControlCommand.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){let oe=this.state.PopEvaluationStack();if(!(oe instanceof f.Void)){let Oe=new h.StringValue(oe.toString());this.state.PushToOutputStream(Oe)}}break;case s.ControlCommand.CommandType.NoOp:break;case s.ControlCommand.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case s.ControlCommand.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case s.ControlCommand.CommandType.PopFunction:case s.ControlCommand.CommandType.PopTunnel:let P=E.commandType==s.ControlCommand.CommandType.PopFunction?o.PushPopType.Function:o.PushPopType.Tunnel,T=null;if(P==o.PushPopType.Tunnel){let oe=this.state.PopEvaluationStack();T=L.asOrNull(oe,h.DivertTargetValue),T===null&&this.Assert(oe instanceof f.Void,"Expected void if ->-> doesn't override target")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type!=P||!this.state.callStack.canPop){let oe=new Map;oe.set(o.PushPopType.Function,"function return statement (~ return)"),oe.set(o.PushPopType.Tunnel,"tunnel onwards statement (->->)");let Oe=oe.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(Oe="end of flow (-> END or choice)");let Xe="Found "+oe.get(P)+", when expected "+Oe;this.Error(Xe)}else this.state.PopCallStack(),T&&(this.state.divertedPointer=this.PointerAtPath(T.targetPath));break;case s.ControlCommand.CommandType.BeginString:this.state.PushToOutputStream(E),this.Assert(this.state.inExpressionEvaluation===!0,"Expected to be in an expression when evaluating a string"),this.state.inExpressionEvaluation=!1;break;case s.ControlCommand.CommandType.EndString:let N=[],j=0;for(let oe=this.state.outputStream.length-1;oe>=0;--oe){let Oe=this.state.outputStream[oe];j++;let Xe=L.asOrNull(Oe,s.ControlCommand);if(Xe&&Xe.commandType==s.ControlCommand.CommandType.BeginString)break;Oe instanceof h.StringValue&&N.push(Oe)}this.state.PopFromOutputStream(j),N=N.reverse();let D=new C.StringBuilder;for(let oe of N)D.Append(oe.toString());this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new h.StringValue(D.toString()));break;case s.ControlCommand.CommandType.ChoiceCount:let W=this.state.generatedChoices.length;this.state.PushEvaluationStack(new h.IntValue(W));break;case s.ControlCommand.CommandType.Turns:this.state.PushEvaluationStack(new h.IntValue(this.state.currentTurnIndex+1));break;case s.ControlCommand.CommandType.TurnsSince:case s.ControlCommand.CommandType.ReadCount:let z=this.state.PopEvaluationStack();if(!(z instanceof h.DivertTargetValue)){let oe="";z instanceof h.IntValue&&(oe=". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?"),this.Error("TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw "+z+oe);break}let se=L.asOrThrows(z,h.DivertTargetValue),ge=L.asOrNull(this.ContentAtPath(se.targetPath).correctObj,e.Container),Me;ge!=null?E.commandType==s.ControlCommand.CommandType.TurnsSince?Me=this.state.TurnsSinceForContainer(ge):Me=this.state.VisitCountForContainer(ge):(E.commandType==s.ControlCommand.CommandType.TurnsSince?Me=-1:Me=0,this.Warning("Failed to find container for "+E.toString()+" lookup at "+se.targetPath.toString())),this.state.PushEvaluationStack(new h.IntValue(Me));break;case s.ControlCommand.CommandType.Random:{let oe=L.asOrNull(this.state.PopEvaluationStack(),h.IntValue),Oe=L.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(Oe==null||!(Oe instanceof h.IntValue))return this.Error("Invalid value for minimum parameter of RANDOM(min, max)");if(oe==null||!(Oe instanceof h.IntValue))return this.Error("Invalid value for maximum parameter of RANDOM(min, max)");if(oe.value===null)return A.throwNullException("maxInt.value");if(Oe.value===null)return A.throwNullException("minInt.value");let Xe=oe.value-Oe.value+1;(!isFinite(Xe)||Xe>Number.MAX_SAFE_INTEGER)&&(Xe=Number.MAX_SAFE_INTEGER,this.Error("RANDOM was called with a range that exceeds the size that ink numbers can use.")),Xe<=0&&this.Error("RANDOM was called with minimum as "+Oe.value+" and maximum as "+oe.value+". The maximum must be larger");let $r=this.state.storySeed+this.state.previousRandom,g=new y.PRNG($r).next(),x=g%Xe+Oe.value;this.state.PushEvaluationStack(new h.IntValue(x)),this.state.previousRandom=g;break}case s.ControlCommand.CommandType.SeedRandom:let le=L.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(le==null||!(le instanceof h.IntValue))return this.Error("Invalid value passed to SEED_RANDOM");if(le.value===null)return A.throwNullException("minInt.value");this.state.storySeed=le.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new f.Void);break;case s.ControlCommand.CommandType.VisitIndex:let gt=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new h.IntValue(gt));break;case s.ControlCommand.CommandType.SequenceShuffleIndex:let Et=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new h.IntValue(Et));break;case s.ControlCommand.CommandType.StartThread:break;case s.ControlCommand.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=O.Pointer.Null);break;case s.ControlCommand.CommandType.End:this.state.ForceEnd();break;case s.ControlCommand.CommandType.ListFromInt:let ui=L.asOrNull(this.state.PopEvaluationStack(),h.IntValue),ia=L.asOrThrows(this.state.PopEvaluationStack(),h.StringValue);if(ui===null)throw new p.StoryException("Passed non-integer when creating a list element from a numerical value.");let Ft=null;if(this.listDefinitions===null)return A.throwNullException("this.listDefinitions");let hi=this.listDefinitions.TryListGetDefinition(ia.value,null);if(hi.exists){if(ui.value===null)return A.throwNullException("minInt.value");let oe=hi.result.TryGetItemWithValue(ui.value,R.InkListItem.Null);oe.exists&&(Ft=new h.ListValue(oe.result,ui.value))}else throw new p.StoryException("Failed to find LIST called "+ia.value);Ft==null&&(Ft=new h.ListValue),this.state.PushEvaluationStack(Ft);break;case s.ControlCommand.CommandType.ListRange:let Vn=L.asOrNull(this.state.PopEvaluationStack(),h.Value),jr=L.asOrNull(this.state.PopEvaluationStack(),h.Value),ve=L.asOrNull(this.state.PopEvaluationStack(),h.ListValue);if(ve===null||jr===null||Vn===null)throw new p.StoryException("Expected list, minimum and maximum for LIST_RANGE");if(ve.value===null)return A.throwNullException("targetList.value");let ci=ve.value.ListWithSubRange(jr.valueObject,Vn.valueObject);this.state.PushEvaluationStack(new h.ListValue(ci));break;case s.ControlCommand.CommandType.ListRandom:{let oe=this.state.PopEvaluationStack();if(oe===null)throw new p.StoryException("Expected list for LIST_RANDOM");let Oe=oe.value,Xe=null;if(Oe===null)throw A.throwNullException("list");if(Oe.Count==0)Xe=new R.InkList;else{let $r=this.state.storySeed+this.state.previousRandom,g=new y.PRNG($r).next(),x=g%Oe.Count,k=Oe.entries();for(let K=0;K<=x-1;K++)k.next();let M=k.next().value,ee={Key:R.InkListItem.fromSerializedKey(M[0]),Value:M[1]};if(ee.Key.originName===null)return A.throwNullException("randomItem.Key.originName");Xe=new R.InkList(ee.Key.originName,this),Xe.Add(ee.Key,ee.Value),this.state.previousRandom=g}this.state.PushEvaluationStack(new h.ListValue(Xe));break}default:this.Error("unhandled ControlCommand: "+E);break}return!0}else if(S instanceof m.VariableAssignment){let E=S,P=this.state.PopEvaluationStack();return this.state.variablesState.Assign(E,P),!0}else if(S instanceof w.VariableReference){let E=S,P=null;if(E.pathForCount!=null){let T=E.containerForCount,N=this.state.VisitCountForContainer(T);P=new h.IntValue(N)}else P=this.state.variablesState.GetVariableWithName(E.name),P==null&&(this.Warning("Variable not found: '"+E.name+"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state."),P=new h.IntValue(0));return this.state.PushEvaluationStack(P),!0}else if(S instanceof v.NativeFunctionCall){let E=S,P=this.state.PopEvaluationStack(E.numberOfParameters),T=E.Call(P);return this.state.PushEvaluationStack(T),!0}return!1}ChoosePathString(S,E=!0,P=[]){if(this.IfAsyncWeCant("call ChoosePathString right now"),this.onChoosePathString!==null&&this.onChoosePathString(S,P),E)this.ResetCallstack();else if(this.state.callStack.currentElement.type==o.PushPopType.Function){let T="",N=this.state.callStack.currentElement.currentPointer.container;throw N!=null&&(T="("+N.path.toString()+") "),new Error("Story was running a function "+T+"when you called ChoosePathString("+S+`) - this is almost certainly not not what you want! Full stack trace: 
`+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(P),this.ChoosePath(new c.Path(S))}IfAsyncWeCant(S){if(this._asyncContinueActive)throw new Error("Can't "+S+". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.")}ChoosePath(S,E=!0){this.state.SetChosenPath(S,E),this.VisitChangedContainersDueToDivert()}ChooseChoiceIndex(S){S=S;let E=this.currentChoices;this.Assert(S>=0&&S<E.length,"choice out of range");let P=E[S];if(this.onMakeChoice!==null&&this.onMakeChoice(P),P.threadAtGeneration===null)return A.throwNullException("choiceToChoose.threadAtGeneration");if(P.targetPath===null)return A.throwNullException("choiceToChoose.targetPath");this.state.callStack.currentThread=P.threadAtGeneration,this.ChoosePath(P.targetPath)}HasFunction(S){try{return this.KnotContainerWithName(S)!=null}catch{return!1}}EvaluateFunction(S,E=[],P=!1){if(this.onEvaluateFunction!==null&&this.onEvaluateFunction(S,E),this.IfAsyncWeCant("evaluate a function"),S==null)throw new Error("Function is null");if(S==""||S.trim()=="")throw new Error("Function is empty or white space.");let T=this.KnotContainerWithName(S);if(T==null)throw new Error("Function doesn't exist: '"+S+"'");let N=[];N.push(...this.state.outputStream),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(T,E);let j=new C.StringBuilder;for(;this.canContinue;)j.Append(this.Continue());let D=j.toString();this._state.ResetOutput(N);let W=this.state.CompleteFunctionEvaluationFromGame();return this.onCompleteEvaluateFunction!=null&&this.onCompleteEvaluateFunction(S,E,D,W),P?{returned:W,output:D}:W}EvaluateExpression(S){let E=this.state.callStack.elements.length;this.state.callStack.Push(o.PushPopType.Tunnel),this._temporaryEvaluationContainer=S,this.state.GoToStart();let P=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>E&&this.state.PopCallStack(),this.state.evaluationStack.length>P?this.state.PopEvaluationStack():null}CallExternalFunction(S,E){if(S===null)return A.throwNullException("funcName");let P=this._externals.get(S),T=null,N=typeof P!="undefined";if(N&&!P.lookAheadSafe&&this._stateSnapshotAtLastNewline!==null){this._sawLookaheadUnsafeFunctionAfterNewline=!0;return}if(!N)if(this.allowExternalFunctionFallbacks){T=this.KnotContainerWithName(S),this.Assert(T!==null,"Trying to call EXTERNAL function '"+S+"' which has not been bound, and fallback ink function could not be found."),this.state.callStack.Push(o.PushPopType.Function,void 0,this.state.outputStream.length),this.state.divertedPointer=O.Pointer.StartOf(T);return}else this.Assert(!1,"Trying to call EXTERNAL function '"+S+"' which has not been bound (and ink fallbacks disabled).");let j=[];for(let z=0;z<E;++z){let ge=L.asOrThrows(this.state.PopEvaluationStack(),h.Value).valueObject;j.push(ge)}j.reverse();let D=P.function(j),W=null;D!=null?(W=h.Value.Create(D),this.Assert(W!==null,"Could not create ink value from returned object of type "+typeof D)):W=new f.Void,this.state.PushEvaluationStack(W)}BindExternalFunctionGeneral(S,E,P){this.IfAsyncWeCant("bind an external function"),this.Assert(!this._externals.has(S),"Function '"+S+"' has already been bound."),this._externals.set(S,{function:E,lookAheadSafe:P})}TryCoerce(S){return S}BindExternalFunction(S,E,P){this.Assert(E!=null,"Can't bind a null function"),this.BindExternalFunctionGeneral(S,T=>{this.Assert(T.length>=E.length,"External function expected "+E.length+" arguments");let N=[];for(let j=0,D=T.length;j<D;j++)N[j]=this.TryCoerce(T[j]);return E.apply(null,N)},P)}UnbindExternalFunction(S){this.IfAsyncWeCant("unbind an external a function"),this.Assert(this._externals.has(S),"Function '"+S+"' has not been bound."),this._externals.delete(S)}ValidateExternalBindings(){let S=null,E=null,P=arguments[1]||new Set;if(arguments[0]instanceof e.Container&&(S=arguments[0]),arguments[0]instanceof t.InkObject&&(E=arguments[0]),S===null&&E===null)if(this.ValidateExternalBindings(this._mainContentContainer,P),this._hasValidatedExternals=!0,P.size==0)this._hasValidatedExternals=!0;else{let T="Error: Missing function binding for external";T+=P.size>1?"s":"",T+=": '",T+=Array.from(P).join("', '"),T+="' ",T+=this.allowExternalFunctionFallbacks?", and no fallback ink function found.":" (ink fallbacks disabled)",this.Error(T)}else if(S!=null){for(let T of S.content){let N=T;(N==null||!N.hasValidName)&&this.ValidateExternalBindings(T,P)}for(let[,T]of S.namedContent)this.ValidateExternalBindings(L.asOrNull(T,t.InkObject),P)}else if(E!=null){let T=L.asOrNull(E,u.Divert);if(T&&T.isExternal){let N=T.targetPathString;if(N===null)return A.throwNullException("name");this._externals.has(N)||this.allowExternalFunctionFallbacks&&this.mainContentContainer.namedContent.has(N)||P.add(N)}}}ObserveVariable(S,E){if(this.IfAsyncWeCant("observe a new variable"),this._variableObservers===null&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(S))throw new Error("Cannot observe variable '"+S+"' because it wasn't declared in the ink story.");this._variableObservers.has(S)?this._variableObservers.get(S).push(E):this._variableObservers.set(S,[E])}ObserveVariables(S,E){for(let P=0,T=S.length;P<T;P++)this.ObserveVariable(S[P],E[P])}RemoveVariableObserver(S,E){if(this.IfAsyncWeCant("remove a variable observer"),this._variableObservers!==null){if(E!=null){if(this._variableObservers.has(E))if(S!=null){let P=this._variableObservers.get(E);P!=null&&(P.splice(P.indexOf(S),1),P.length===0&&this._variableObservers.delete(E))}else this._variableObservers.delete(E)}else if(S!=null){let P=this._variableObservers.keys();for(let T of P){let N=this._variableObservers.get(T);N!=null&&(N.splice(N.indexOf(S),1),N.length===0&&this._variableObservers.delete(T))}}}}VariableStateDidChangeEvent(S,E){if(this._variableObservers===null)return;let P=this._variableObservers.get(S);if(typeof P!="undefined"){if(!(E instanceof h.Value))throw new Error("Tried to get the value of a variable that isn't a standard type");let T=L.asOrThrows(E,h.Value);for(let N of P)N(S,T.valueObject)}}get globalTags(){return this.TagsAtStartOfFlowContainerWithPathString("")}TagsForContentAtPath(S){return this.TagsAtStartOfFlowContainerWithPathString(S)}TagsAtStartOfFlowContainerWithPathString(S){let E=new c.Path(S),P=this.ContentAtPath(E).container;if(P===null)return A.throwNullException("flowContainer");for(;;){let N=P.content[0];if(N instanceof e.Container)P=N;else break}let T=null;for(let N of P.content){let j=L.asOrNull(N,d.Tag);if(j)T==null&&(T=[]),T.push(j.text);else break}return T}BuildStringOfHierarchy(){let S=new C.StringBuilder;return this.mainContentContainer.BuildStringOfHierarchy(S,0,this.state.currentPointer.Resolve()),S.toString()}BuildStringOfContainer(S){let E=new C.StringBuilder;return S.BuildStringOfHierarchy(E,0,this.state.currentPointer.Resolve()),E.toString()}NextContent(){if(this.state.previousPointer=this.state.currentPointer.copy(),!this.state.divertedPointer.isNull&&(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=O.Pointer.Null,this.VisitChangedContainersDueToDivert(),!this.state.currentPointer.isNull))return;if(!this.IncrementContentPointer()){let E=!1;this.state.callStack.CanPop(o.PushPopType.Function)?(this.state.PopCallStack(o.PushPopType.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new f.Void),E=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),E=!0):this.state.TryExitFunctionEvaluationFromGame(),E&&!this.state.currentPointer.isNull&&this.NextContent()}}IncrementContentPointer(){let S=!0,E=this.state.callStack.currentElement.currentPointer.copy();if(E.index++,E.container===null)return A.throwNullException("pointer.container");for(;E.index>=E.container.content.length;){S=!1;let P=L.asOrNull(E.container.parent,e.Container);if(!(P instanceof e.Container))break;let T=P.content.indexOf(E.container);if(T==-1)break;if(E=new O.Pointer(P,T),E.index++,S=!0,E.container===null)return A.throwNullException("pointer.container")}return S||(E=O.Pointer.Null),this.state.callStack.currentElement.currentPointer=E.copy(),S}TryFollowDefaultInvisibleChoice(){let S=this._state.currentChoices,E=S.filter(T=>T.isInvisibleDefault);if(E.length==0||S.length>E.length)return!1;let P=E[0];return P.targetPath===null?A.throwNullException("choice.targetPath"):P.threadAtGeneration===null?A.throwNullException("choice.threadAtGeneration"):(this.state.callStack.currentThread=P.threadAtGeneration,this._stateSnapshotAtLastNewline!==null&&(this.state.callStack.currentThread=this.state.callStack.ForkThread()),this.ChoosePath(P.targetPath,!1),!0)}NextSequenceShuffleIndex(){let S=L.asOrNull(this.state.PopEvaluationStack(),h.IntValue);if(!(S instanceof h.IntValue))return this.Error("expected number of elements in sequence for shuffle index"),0;let E=this.state.currentPointer.container;if(E===null)return A.throwNullException("seqContainer");if(S.value===null)return A.throwNullException("numElementsIntVal.value");let P=S.value,N=L.asOrThrows(this.state.PopEvaluationStack(),h.IntValue).value;if(N===null)return A.throwNullException("seqCount");let j=N/P,D=N%P,W=E.path.toString(),z=0;for(let le=0,gt=W.length;le<gt;le++)z+=W.charCodeAt(le)||0;let se=z+j+this.state.storySeed,ge=new y.PRNG(Math.floor(se)),Me=[];for(let le=0;le<P;++le)Me.push(le);for(let le=0;le<=D;++le){let gt=ge.next()%Me.length,Et=Me[gt];if(Me.splice(gt,1),le==D)return Et}throw new Error("Should never reach here")}Error(S,E=!1){let P=new p.StoryException(S);throw P.useEndLineNumber=E,P}Warning(S){this.AddError(S,!0)}AddError(S,E=!1,P=!1){let T=this.currentDebugMetadata,N=E?"WARNING":"ERROR";if(T!=null){let j=P?T.endLineNumber:T.startLineNumber;S="RUNTIME "+N+": '"+T.fileName+"' line "+j+": "+S}else this.state.currentPointer.isNull?S="RUNTIME "+N+": "+S:S="RUNTIME "+N+": ("+this.state.currentPointer+"): "+S;this.state.AddError(S,E),E||this.state.ForceEnd()}Assert(S,E=null){if(S==!1)throw E==null&&(E="Story assert"),new Error(E+" "+this.currentDebugMetadata)}get currentDebugMetadata(){let S,E=this.state.currentPointer;if(!E.isNull&&E.Resolve()!==null&&(S=E.Resolve().debugMetadata,S!==null))return S;for(let P=this.state.callStack.elements.length-1;P>=0;--P)if(E=this.state.callStack.elements[P].currentPointer,!E.isNull&&E.Resolve()!==null&&(S=E.Resolve().debugMetadata,S!==null))return S;for(let P=this.state.outputStream.length-1;P>=0;--P)if(S=this.state.outputStream[P].debugMetadata,S!==null)return S;return null}get mainContentContainer(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}n.Story=H,H.inkVersionCurrent=20,function(Ce){(function(S){S[S.NoChange=0]="NoChange",S[S.ExtendedBeyondNewline=1]="ExtendedBeyondNewline",S[S.NewlineRemoved=2]="NewlineRemoved"})(Ce.OutputStateChange||(Ce.OutputStateChange={}))}(H=n.Story||(n.Story={}))})(Zl);Object.defineProperty(tc,"__esModule",{value:!0});tc.Story=void 0;const EL=$s,kL=Us,Ua=Be,qa=bt,Oo=Wm,Ka=ln,Wy=qs,OL=Xl,_L=Xs,PL=Ql,TL=Zl,Xr=si,AL=oi,NL=Fn,_o=re,IL=Fr,DL=Vr,RL=ai;class ac extends Ka.FlowBase{constructor(e,t=!1){super(null,e,null,!1,t);this._errorHandler=null,this._hadError=!1,this._hadWarning=!1,this._dontFlattenContainers=new Set,this._listDefs=new Map,this.constants=new Map,this.externals=new Map,this.countAllVisits=!1,this.ExportRuntime=(i=null)=>{var r,s;this._errorHandler=i,this.constants=new Map;for(const h of this.FindAll(kL.ConstantDeclaration)()){const c=this.constants.get(h.constantName);if(c&&!(c.GenerateRuntimeObject()||{Equals:()=>!1}).Equals(h.expression)){const d=`CONST '${h.constantName}' has been redefined with a different value. Multiple definitions of the same CONST are valid so long as they contain the same value. Initial definition was on ${c.debugMetadata}.`;this.Error(d,h,!1)}this.constants.set(h.constantName,h.expression)}this._listDefs=new Map;for(const h of this.FindAll(_L.ListDefinition)())((r=h.identifier)===null||r===void 0?void 0:r.name)&&this._listDefs.set((s=h.identifier)===null||s===void 0?void 0:s.name,h);this.externals=new Map,this.ResolveWeavePointNaming();const o=this.runtimeObject,l=new Ua.Container;l.AddContent(qa.ControlCommand.EvalStart());const a=[];for(const[h,c]of this.variableDeclarations)if(c.isGlobalDeclaration){if(c.listDefinition)this._listDefs.set(h,c.listDefinition),l.AddContent(c.listDefinition.runtimeObject),a.push(c.listDefinition.runtimeListDefinition);else{if(!c.expression)throw new Error;c.expression.GenerateIntoContainer(l)}const f=new NL.VariableAssignment(h,!0);f.isGlobal=!0,l.AddContent(f)}l.AddContent(qa.ControlCommand.EvalEnd()),l.AddContent(qa.ControlCommand.End()),this.variableDeclarations.size>0&&(l.name="global decl",o.AddToNamedContentOnly(l)),o.AddContent(qa.ControlCommand.Done());const u=new TL.Story(o,a);return this.runtimeObject=u,this.hadError||(this.FlattenContainersIn(o),this.ResolveReferences(this),this.hadError)?null:(u.ResetState(),u)},this.ResolveList=i=>{let r=this._listDefs.get(i);return r||null},this.ResolveListItem=(i,r,s=null)=>{let o=null;if(i)return(o=this._listDefs.get(i))?o.ItemNamed(r):null;{let l=null,a=null;for(const[u,h]of this._listDefs.entries()){const c=h.ItemNamed(r);c&&(l?this.Error(`Ambiguous item name '${r}' found in multiple sets, including ${a.identifier} and ${h.identifier}`,s,!1):(l=c,a=h))}return l}},this.FlattenContainersIn=i=>{const r=new Set;if(i.content)for(const s of i.content){const o=_o.asOrNull(s,Ua.Container);o&&r.add(o)}if(i.namedContent)for(const[s,o]of i.namedContent){const l=_o.asOrNull(o,Ua.Container);l&&r.add(l)}for(const s of r)this.TryFlattenContainer(s),this.FlattenContainersIn(s)},this.TryFlattenContainer=i=>{if(i.namedContent&&i.namedContent.size>0||i.hasValidName||this._dontFlattenContainers.has(i))return;const r=_o.asOrNull(i.parent,Ua.Container);if(r){let s=r.content.indexOf(i);r.content.splice(s,1);const o=i.ownDebugMetadata;if(i.content)for(const l of i.content)l.parent=null,o!==null&&l.ownDebugMetadata===null&&(l.debugMetadata=o),r.InsertContent(l,s),s+=1}},this.Error=(i,r,s)=>{let o=s?Oo.ErrorType.Warning:Oo.ErrorType.Error,l="";if(r instanceof EL.AuthorWarning?(l+="TODO: ",o=Oo.ErrorType.Author):s?l+="WARNING: ":l+="ERROR: ",r&&r.debugMetadata!==null&&r.debugMetadata.startLineNumber>=1&&(r.debugMetadata.fileName!=null&&(l+=`'${r.debugMetadata.fileName}' `),l+=`line ${r.debugMetadata.startLineNumber}: `),l+=i,i=l,this._errorHandler!==null)this._errorHandler(i,o);else throw new Error(i);this._hadError=o===Oo.ErrorType.Error,this._hadWarning=o===Oo.ErrorType.Warning},this.ResetError=()=>{this._hadError=!1,this._hadWarning=!1},this.IsExternal=i=>this.externals.has(i),this.AddExternal=i=>{this.externals.has(i.name)?this.Error(`Duplicate EXTERNAL definition of '${i.name}'`,i,!1):i.name&&this.externals.set(i.name,i)},this.DontFlattenContainer=i=>{this._dontFlattenContainers.add(i)},this.NameConflictError=(i,r,s,o)=>{i.Error(`${o} '${r}': name has already been used for a ${s.typeName.toLowerCase()} on ${s.debugMetadata}`)},this.CheckForNamingCollisions=(i,r,s,o="")=>{var l;const a=o||i.typeName;if(ac.IsReservedKeyword(r==null?void 0:r.name)){i.Error(`'${r}' cannot be used for the name of a ${a.toLowerCase()} because it's a reserved keyword`);return}else if(DL.FunctionCall.IsBuiltIn((r==null?void 0:r.name)||"")){i.Error(`'${r}' cannot be used for the name of a ${a.toLowerCase()} because it's a built in function`);return}const u=this.ContentWithNameAtLevel((r==null?void 0:r.name)||"",Wy.FlowLevel.Knot),h=_o.asOrNull(u,Ka.FlowBase);if(h&&(h!==i||s===Xr.SymbolType.Arg)){this.NameConflictError(i,(r==null?void 0:r.name)||"",h,a);return}if(s<Xr.SymbolType.List)return;for(const[m,w]of this._listDefs)if((r==null?void 0:r.name)===m&&i!==w&&w.variableAssignment!==i&&this.NameConflictError(i,r==null?void 0:r.name,w,a),!(i instanceof PL.ListElementDefinition))for(const v of w.itemDefinitions)(r==null?void 0:r.name)===v.name&&this.NameConflictError(i,(r==null?void 0:r.name)||"",v,a);if(s<=Xr.SymbolType.Var)return;const c=(r==null?void 0:r.name)&&this.variableDeclarations.get(r==null?void 0:r.name)||null;if(c&&c!==i&&c.isGlobalDeclaration&&c.listDefinition==null&&this.NameConflictError(i,(r==null?void 0:r.name)||"",c,a),s<Xr.SymbolType.SubFlowAndWeave)return;const d=new RL.Path(this.identifier).ResolveFromContext(i);if(d&&d!==i){this.NameConflictError(i,(r==null?void 0:r.name)||"",d,a);return}if(!(s<Xr.SymbolType.Arg)&&s!==Xr.SymbolType.Arg){let m=_o.asOrNull(i,Ka.FlowBase);if(m||(m=IL.ClosestFlowBase(i)),m&&m.hasParameters&&m.args){for(const w of m.args)if(((l=w.identifier)===null||l===void 0?void 0:l.name)===(r==null?void 0:r.name)){i.Error(`${a} '${r}': Name has already been used for a argument to ${m.identifier} on ${m.debugMetadata}`);return}}}}}get flowLevel(){return Wy.FlowLevel.Story}get hadError(){return this._hadError}get hadWarning(){return this._hadWarning}get typeName(){return"Story"}PreProcessTopLevelObjects(e){super.PreProcessTopLevelObjects(e);const t=[];for(let i of e)if(i instanceof OL.IncludedFile){const r=i,s=e.indexOf(i);if(e.splice(s,1),r.includedStory){const o=[],l=r.includedStory;if(l.content!=null){for(const a of l.content)a instanceof Ka.FlowBase?t.push(a):o.push(a);o.push(new AL.Text(`
`)),e.splice(s,0,...o)}}continue}e.splice(0,0,...t)}}tc.Story=ac;ac.IsReservedKeyword=n=>{switch(n){case"true":case"false":case"not":case"return":case"else":case"VAR":case"CONST":case"temp":case"LIST":case"function":return!0}return!1};var uc={};Object.defineProperty(uc,"__esModule",{value:!0});uc.StringExpression=void 0;const By=bt,LL=Lt,ML=oi,FL=re;class Jm extends LL.Expression{constructor(e){super();this.GenerateIntoContainer=t=>{t.AddContent(By.ControlCommand.BeginString());for(const i of this.content)t.AddContent(i.runtimeObject);t.AddContent(By.ControlCommand.EndString())},this.toString=()=>{let t="";for(const i of this.content)t+=i;return t},this.Equals=t=>{const i=FL.asOrNull(t,Jm);if(i===null||!this.isSingleString||!i.isSingleString)return!1;const r=this.toString(),s=i.toString();return r===s},this.AddContent(e)}get isSingleString(){return!(this.content.length!==1||!(this.content[0]instanceof ML.Text))}get typeName(){return"String"}}uc.StringExpression=Jm;var hc={};Object.defineProperty(hc,"__esModule",{value:!0});hc.Tag=void 0;const VL=Yl;class WL extends VL.Wrap{constructor(e){super(e)}get typeName(){return"Tag"}}hc.Tag=WL;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.InkParser=n.ErrorType=void 0;const e=Vh,t=$s,i=Bl,r=Bh,s=Ir,o=Dr,l=jh,a=zs,u=Gl,h=Ys,c=Us,f=xx,d=Uh,m=Mr,w=Yi,v=Lt,p=qh,y=Kh,C=Vr,b=Ks,_=Jh,O=Qs,R=Yh,L=Xl,A=Xh,$=Qh,U=Zh,X=Xs,H=Ql,Ce=zl,S=ke,E=ai,P=Hl,T=Ul,N=Hm,j=bx,D=ec,W=tc,z=uc,se=$m,ge=hc,Me=Br,le=oi,gt=ql,Et=Kl,ui=Xi,ia=$l,Ft=re,hi=Js,Vn=Gs;var jr;(function(ci){ci[ci.Author=0]="Author",ci[ci.Error=1]="Error",ci[ci.Warning=2]="Warning"})(jr=n.ErrorType||(n.ErrorType={}));class ve extends se.StringParser{constructor(oe,Oe=null,Xe=null,$r=null,cc=null){super(oe);if(this._filename=Oe,this._externalErrorHandler=Xe,this._fileHandler=cc,this.ParseStory=()=>{const g=this.StatementsAtLevel(j.StatementLevel.Top);return new W.Story(g,this._rootParser!==this)},this.SeparatedList=(g,x)=>{const k=this.Parse(g);if(k===null)return null;const M=[];M.push(k);do{const ee=this.BeginRule();if(x()===null){this.FailRule(ee);break}const he=this.Parse(g);if(he===null){this.FailRule(ee);break}this.SucceedRule(ee),M.push(he)}while(!0);return M},this.CreateDebugMetadata=(g,x)=>{const k=new d.DebugMetadata;return k.startLineNumber=((g==null?void 0:g.lineIndex)||0)+1,k.endLineNumber=x.lineIndex+1,k.startCharacterNumber=((g==null?void 0:g.characterInLineIndex)||0)+1,k.endCharacterNumber=x.characterInLineIndex+1,k.fileName=this._filename,k},this.RuleDidSucceed=(g,x,k)=>{const M=Ft.asOrNull(g,S.ParsedObject);M&&(M.debugMetadata=this.CreateDebugMetadata(x,k));const ee=Array.isArray(g)?g:null;if(ee!==null)for(const he of ee)!Ft.asOrNull(he,S.ParsedObject)||he.hasOwnDebugMetadata||(he.debugMetadata=this.CreateDebugMetadata(x,k));const K=Ft.asOrNull(g,hi.Identifier);K!=null&&(K.debugMetadata=this.CreateDebugMetadata(x,k))},this.OnStringParserError=(g,x,k=0,M=!1)=>{let K=M?"WARNING:":"ERROR:";if(this._filename!==null&&(K+=` '${this._filename}'`),K+=` line ${k+1}: ${g}`,this._externalErrorHandler!==null)this._externalErrorHandler(K,M?jr.Warning:jr.Error);else throw new Error(K)},this.AuthorWarning=()=>{this.Whitespace();const g=this.Parse(this.IdentifierWithMetadata);if(g===null||g.name!=="TODO")return null;this.Whitespace(),this.ParseString(":"),this.Whitespace();const x=this.ParseUntilCharactersFromString(`
\r`);return x?new t.AuthorWarning(x):null},this.ExtendIdentifierCharacterRanges=g=>{const x=ve.ListAllCharacterRanges();for(const k of x)g.AddCharacters(k.ToCharacterSet())},this._parsingChoice=!1,this.Choice=()=>{let g=!0,x=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("*"));if(!x){if(x=this.Interleave(this.OptionalExclude(this.Whitespace),this.String("+")),x===null)return null;g=!1}const k=this.Parse(this.BracketedName);this.Whitespace();const M=this.Parse(this.ChoiceCondition);if(this.Whitespace(),this._parsingChoice)throw new Error("Already parsing a choice - shouldn't have nested choices");this._parsingChoice=!0;let ee=null;const K=this.Parse(this.MixedTextAndLogic);K&&(ee=new h.ContentList(K));let he=null,ye=null;const Wn=this.ParseString("[")!==null;if(Wn){const Zs=this.Parse(this.MixedTextAndLogic);Zs!==null&&(he=new h.ContentList(Zs)),this.Expect(this.String("]"),"closing ']' for weave-style option");let eo=this.Parse(this.MixedTextAndLogic);eo!==null&&(ye=new h.ContentList(eo))}this.Whitespace();const fc=this.Parse(this.MultiDivert);this._parsingChoice=!1,this.Whitespace();const Ym=!ee&&!ye&&!he;Ym&&fc===null&&this.Warning("Choice is completely empty. Interpretting as a default fallback choice. Add a divert arrow to remove this warning: * ->"),!ee&&Wn&&!he&&this.Warning("Blank choice - if you intended a default fallback choice, use the `* ->` syntax"),ye||(ye=new h.ContentList);const Xm=this.Parse(this.Tags);if(Xm!==null&&ye.AddContent(Xm),fc!==null)for(const Zs of fc){const eo=Ft.asOrNull(Zs,m.Divert);eo&&eo.isEmpty||ye.AddContent(Zs)}ye.AddContent(new le.Text(`
`));const Zi=new o.Choice(ee,he,ye);return k&&(Zi.identifier=k),Zi.indentationDepth=x.length,Zi.hasWeaveStyleInlineBrackets=Wn,Zi.condition=M,Zi.onceOnly=g,Zi.isInvisibleDefault=Ym,Zi},this.ChoiceCondition=()=>{const g=this.Interleave(this.ChoiceSingleCondition,this.ChoiceConditionsSpace);return g===null?null:g.length===1?g[0]:new Ce.MultipleConditionExpression(g)},this.ChoiceConditionsSpace=()=>(this.Newline(),this.Whitespace(),se.ParseSuccess),this.ChoiceSingleCondition=()=>{if(this.ParseString("{")===null)return null;const g=this.Expect(this.Expression,"choice condition inside { }");return this.DisallowIncrement(g),this.Expect(this.String("}"),"closing '}' for choice condition"),g},this.Gather=()=>{const g=this.Parse(this.GatherDashes);if(g===null)return null;const x=Number(g),k=this.Parse(this.BracketedName),M=new b.Gather(k,x);return this.Newline(),M},this.GatherDashes=()=>{this.Whitespace();let g=0;for(;this.ParseDashNotArrow()!==null;)g+=1,this.Whitespace();return g===0?null:g},this.ParseDashNotArrow=()=>{const g=this.BeginRule();return this.ParseString("->")===null&&this.ParseSingleCharacter()==="-"?this.SucceedRule(g):this.FailRule(g)},this.BracketedName=()=>{if(this.ParseString("(")===null)return null;this.Whitespace();const g=this.Parse(this.IdentifierWithMetadata);return g===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing ')' for bracketed name"),g)},this.InnerConditionalContent=g=>{if(g===void 0){const K=this.Parse(this.ConditionExpression),he=this.Parse(()=>this.InnerConditionalContent(K));return he===null?null:he}let x;const k=g!==null,M=this.Parse(this.Newline)===null;if(M&&!k)return null;if(M)x=this.InlineConditionalBranches();else{if(x=this.MultilineConditionalBranches(),x===null){if(g){let K=this.StatementsAtLevel(j.StatementLevel.InnerBlock);if(K!==null){x=[new u.ConditionalSingleBranch(K)];const ye=this.Parse(this.SingleMultilineCondition);ye&&(ye.isElse||(this.ErrorWithParsedObject("Expected an '- else:' clause here rather than an extra condition",ye),ye.isElse=!0),x.push(ye))}}if(x===null)return null}else if(x.length===1&&x[0].isElse&&g){const K=new u.ConditionalSingleBranch(null);K.isTrueBranch=!0,x.unshift(K)}if(g){let K=!1;for(let he=0;he<x.length;++he){const ye=x[he],Wn=he===x.length-1;ye.ownExpression?(ye.matchingEquality=!0,K=!0):K&&Wn?(ye.matchingEquality=!0,ye.isElse=!0):!Wn&&x.length>2?this.ErrorWithParsedObject("Only final branch can be an 'else'. Did you miss a ':'?",ye):he===0?ye.isTrueBranch=!0:ye.isElse=!0}}else{for(let K=0;K<x.length;++K){const he=x[K],ye=K===x.length-1;if(he.ownExpression===null)if(ye)he.isElse=!0;else if(he.isElse){const Wn=x[x.length-1];Wn.isElse?this.ErrorWithParsedObject("Multiple 'else' cases. Can have a maximum of one, at the end.",Wn):this.ErrorWithParsedObject("'else' case in conditional should always be the final one",he)}else this.ErrorWithParsedObject("Branch doesn't have condition. Are you missing a ':'? ",he)}x.length===1&&x[0].ownExpression===null&&this.ErrorWithParsedObject("Condition block with no conditions",x[0])}}if(x===null)return null;for(const K of x)K.isInline=M;return new a.Conditional(g,x)},this.InlineConditionalBranches=()=>{const g=this.Interleave(this.MixedTextAndLogic,this.Exclude(this.String("|")),null,!1);if(g===null||g.length===0)return null;const x=[];if(g.length>2)this.Error("Expected one or two alternatives separated by '|' in inline conditional");else{const k=new u.ConditionalSingleBranch(g[0]);if(k.isTrueBranch=!0,x.push(k),g.length>1){const M=new u.ConditionalSingleBranch(g[1]);M.isElse=!0,x.push(M)}}return x},this.MultilineConditionalBranches=()=>{this.MultilineWhitespace();const g=this.OneOrMore(this.SingleMultilineCondition);return g===null?null:(this.MultilineWhitespace(),g)},this.SingleMultilineCondition=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();let g=null;const x=this.Parse(this.ElseExpression)!==null;x||(g=this.Parse(this.ConditionExpression));let k=this.StatementsAtLevel(j.StatementLevel.InnerBlock);g===null&&k===null&&(this.Error("expected content for the conditional branch following '-'"),k=[new le.Text("")]),this.MultilineWhitespace();const M=new u.ConditionalSingleBranch(k);return M.ownExpression=g,M.isElse=x,M},this.ConditionExpression=()=>{const g=this.Parse(this.Expression);return g===null||(this.DisallowIncrement(g),this.Whitespace(),this.ParseString(":")===null)?null:g},this.ElseExpression=()=>this.ParseString("else")===null||(this.Whitespace(),this.ParseString(":")===null)?null:se.ParseSuccess,this._nonTextPauseCharacters=null,this._nonTextEndCharacters=null,this._notTextEndCharactersChoice=null,this._notTextEndCharactersString=null,this.TrimEndWhitespace=(g,x)=>{if(g.length>0){const k=g.length-1,M=g[k];if(M instanceof le.Text){const ee=M;ee.text=ee.text.replace(new RegExp(/[ \t]+$/g),""),x?ee.text+=" ":ee.text.length===0&&(g.splice(k,1),this.TrimEndWhitespace(g,!1))}}},this.LineOfMixedTextAndLogic=()=>{this.Parse(this.Whitespace);let g=this.Parse(this.MixedTextAndLogic),x=!1;const k=this.Parse(this.Tags);if(k)if(!g)g=k,x=!0;else for(const K of k)g.push(K);if(!g||!g.length)return null;const M=g[0];return M&&M.text&&M.text.startsWith("return")&&this.Warning("Do you need a '~' before 'return'? If not, perhaps use a glue: <> (since it's lowercase) or rewrite somehow?"),g.length===0?null:(g[g.length-1]instanceof m.Divert||this.TrimEndWhitespace(g,!1),x||g.push(new le.Text(`
`)),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),g)},this.MixedTextAndLogic=()=>{this.ParseObject(this.Spaced(this.String("~")))!==null&&this.Error("You shouldn't use a '~' here - tildas are for logic that's on its own line. To do inline logic, use { curly braces } instead");let x=this.Interleave(this.Optional(this.ContentText),this.Optional(this.InlineLogicOrGlue));if(!this._parsingChoice){const k=this.Parse(this.MultiDivert);k!==null&&(x===null&&(x=[]),this.TrimEndWhitespace(x,!0),x.push(...k))}return x||null},this.ContentText=()=>this.ContentTextAllowingEscapeChar(),this.ContentTextAllowingEscapeChar=()=>{let g=null;do{let x=this.Parse(this.ContentTextNoEscape);const k=this.ParseString("\\")!==null;if(k||x!==null)g===null&&(g=""),x!==null&&(g+=String(x)),k&&(g+=this.ParseSingleCharacter());else break}while(!0);return g!==null?new le.Text(g):null},this.ContentTextNoEscape=()=>{this._nonTextPauseCharacters===null&&(this._nonTextPauseCharacters=new s.CharacterSet("-<")),this._nonTextEndCharacters===null&&(this._nonTextEndCharacters=new s.CharacterSet(`{}|
\r\\#`),this._notTextEndCharactersChoice=new s.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersChoice.AddCharacters("[]"),this._notTextEndCharactersString=new s.CharacterSet(this._nonTextEndCharacters),this._notTextEndCharactersString.AddCharacters('"'));const g=()=>this.OneOf([this.ParseDivertArrow,this.ParseThreadArrow,this.EndOfLine,this.Glue]);let x=null;this.parsingStringExpression?x=this._notTextEndCharactersString:this._parsingChoice?x=this._notTextEndCharactersChoice:x=this._nonTextEndCharacters;const k=this.ParseUntil(g,this._nonTextPauseCharacters,x);return k!==null?k:null},this.MultiDivert=()=>{this.Whitespace();let g=[];const x=this.Parse(this.StartThread);if(x)return g=[x],g;const k=this.Interleave(this.ParseDivertArrowOrTunnelOnwards,this.DivertIdentifierWithArguments);if(!k)return null;g=[];for(let M=0;M<k.length;++M)if(M%2===0){if(k[M]==="->->"){M===0||M===k.length-1||M===k.length-2||this.Error("Tunnel onwards '->->' must only come at the begining or the start of a divert");const he=new gt.TunnelOnwards;if(M<k.length-1){const ye=Ft.asOrNull(k[M+1],m.Divert);he.divertAfter=ye}g.push(he);break}}else{const K=k[M];M<k.length-1&&(K.isTunnel=!0),g.push(K)}if(g.length===0&&k.length===1){const M=new m.Divert(null);M.isEmpty=!0,g.push(M),this._parsingChoice||this.Error("Empty diverts (->) are only valid on choices")}return g},this.StartThread=()=>{if(this.Whitespace(),this.ParseThreadArrow()===null)return null;this.Whitespace();const g=this.Expect(this.DivertIdentifierWithArguments,"target for new thread",()=>new m.Divert(null));return g.isThread=!0,g},this.DivertIdentifierWithArguments=()=>{this.Whitespace();const g=this.Parse(this.DotSeparatedDivertPathComponents);if(!g)return null;this.Whitespace();const x=this.Parse(this.ExpressionFunctionCallArguments);this.Whitespace();const k=new E.Path(g);return new m.Divert(k,x)},this.SingleDivert=()=>{const g=this.Parse(this.MultiDivert);if(!g||g.length!==1||g[0]instanceof gt.TunnelOnwards)return null;const k=g[0];return k.isTunnel?null:k},this.DotSeparatedDivertPathComponents=()=>this.Interleave(this.Spaced(this.IdentifierWithMetadata),this.Exclude(this.String("."))),this.ParseDivertArrowOrTunnelOnwards=()=>{let g=0;for(;this.ParseString("->")!==null;)g+=1;return g===0?null:g===1?"->":(g===2||this.Error("Unexpected number of arrows in divert. Should only have '->' or '->->'"),"->->")},this.ParseDivertArrow=()=>this.ParseString("->"),this.ParseThreadArrow=()=>this.ParseString("<-"),this._binaryOperators=[],this._maxBinaryOpLength=0,this.TempDeclarationOrAssignment=()=>{this.Whitespace();const g=this.ParseTempKeyword();this.Whitespace();let x=null;if(g?x=this.Expect(this.IdentifierWithMetadata,"variable name"):x=this.Parse(this.IdentifierWithMetadata),x===null)return null;this.Whitespace();const k=this.ParseString("+")!==null,M=this.ParseString("-")!==null;if(k&&M&&this.Error("Unexpected sequence '+-'"),this.ParseString("=")===null)return g&&this.Error("Expected '='"),null;const ee=this.Expect(this.Expression,"value expression to be assigned");return k||M?new R.IncDecExpression(x,ee,k):new Et.VariableAssignment({variableIdentifier:x,assignedExpression:ee,isTemporaryNewDeclaration:g})},this.DisallowIncrement=g=>{g instanceof R.IncDecExpression&&this.Error("Can't use increment/decrement here. It can only be used on a ~ line")},this.ParseTempKeyword=()=>{const g=this.BeginRule();return this.Parse(this.Identifier)==="temp"?(this.SucceedRule(g),!0):(this.FailRule(g),!1)},this.ReturnStatement=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="return")return null;this.Whitespace();const x=this.Parse(this.Expression);return new P.ReturnType(x)},this.Expression=(g=0)=>{this.Whitespace();let x=this.ExpressionUnary();if(x===null)return null;for(this.Whitespace();;){const k=this.BeginRule(),M=this.ParseInfixOperator();if(M!==null&&M.precedence>g){const ee=`right side of '${M.type}' expression`,K=this.Expect(()=>this.ExpressionInfixRight(x,M),ee);if(K===null)return this.FailRule(k),null;x=this.SucceedRule(k,K);continue}this.FailRule(k);break}return this.Whitespace(),x},this.ExpressionUnary=()=>{const g=this.Parse(this.ExpressionDivertTarget);if(g!==null)return g;let x=this.OneOf([this.String("-"),this.String("!")]);x===null&&(x=this.Parse(this.ExpressionNot)),this.Whitespace();let k=this.OneOf([this.ExpressionList,this.ExpressionParen,this.ExpressionFunctionCall,this.ExpressionVariableName,this.ExpressionLiteral]);if(k===null&&x!==null&&(k=this.ExpressionUnary()),k===null)return null;x!==null&&(k=ia.UnaryExpression.WithInner(k,x)),this.Whitespace();const M=this.OneOf([this.String("++"),this.String("--")]);if(M!==null){const ee=M==="++";if(!(k instanceof ui.VariableReference))this.Error(`can only increment and decrement variables, but saw '${k}'.`);else{const K=k;k=new R.IncDecExpression(K.identifier,ee)}}return k},this.ExpressionNot=()=>{const g=this.Identifier();return g==="not"?g:null},this.ExpressionLiteral=()=>this.OneOf([this.ExpressionFloat,this.ExpressionInt,this.ExpressionBool,this.ExpressionString]),this.ExpressionDivertTarget=()=>{this.Whitespace();const g=this.Parse(this.SingleDivert);return!g||g&&g.isThread?null:(this.Whitespace(),new w.DivertTarget(g))},this.ExpressionInt=()=>{const g=this.ParseInt();return g===null?null:new Vn.NumberExpression(g,"int")},this.ExpressionFloat=()=>{const g=this.ParseFloat();return g===null?null:new Vn.NumberExpression(g,"float")},this.ExpressionString=()=>{if(this.ParseString('"')===null)return null;this.parsingStringExpression=!0;let x=this.Parse(this.MixedTextAndLogic);return this.Expect(this.String('"'),"close quote for string expression"),this.parsingStringExpression=!1,x===null?x=[new le.Text("")]:x.find(k=>k instanceof m.Divert)&&this.Error("String expressions cannot contain diverts (->)"),new z.StringExpression(x)},this.ExpressionBool=()=>{const g=this.Parse(this.Identifier);return g==="true"?new Vn.NumberExpression(!0,"bool"):g==="false"?new Vn.NumberExpression(!1,"bool"):null},this.ExpressionFunctionCall=()=>{const g=this.Parse(this.IdentifierWithMetadata);if(g===null)return null;this.Whitespace();const x=this.Parse(this.ExpressionFunctionCallArguments);return x===null?null:new C.FunctionCall(g,x)},this.ExpressionFunctionCallArguments=()=>{if(this.ParseString("(")===null)return null;const g=this.Exclude(this.String(","));let x=this.Interleave(this.Expression,g);return x===null&&(x=[]),this.Whitespace(),this.Expect(this.String(")"),"closing ')' for function call"),x},this.ExpressionVariableName=()=>{const g=this.Interleave(this.IdentifierWithMetadata,this.Exclude(this.Spaced(this.String("."))));return g===null||W.Story.IsReservedKeyword(g[0].name)?null:new ui.VariableReference(g)},this.ExpressionParen=()=>{if(this.ParseString("(")===null)return null;const g=this.Parse(this.Expression);return g===null?null:(this.Whitespace(),this.Expect(this.String(")"),"closing parenthesis ')' for expression"),g)},this.ExpressionInfixRight=(g,x)=>{if(!g)return null;this.Whitespace();const k=this.Parse(()=>this.Expression(x.precedence));return k?new i.BinaryExpression(g,k,x.type):null},this.ParseInfixOperator=()=>{for(const g of this._binaryOperators){const x=this.BeginRule();if(this.ParseString(g.type)!==null){if(g.requireWhitespace&&this.Whitespace()===null){this.FailRule(x);continue}return this.SucceedRule(x,g)}this.FailRule(x)}return null},this.ExpressionList=()=>{if(this.Whitespace(),this.ParseString("(")===null)return null;this.Whitespace();const g=this.SeparatedList(this.ListMember,this.Spaced(this.String(",")));return this.Whitespace(),this.ParseString(")")===null?null:new U.List(g)},this.ListMember=()=>{this.Whitespace();let g=this.Parse(this.IdentifierWithMetadata);if(g===null)return null;if(this.ParseString(".")!==null){const k=this.Expect(this.IdentifierWithMetadata,`element name within the set ${g}`);g.name+=`.${k==null?void 0:k.name}`}return this.Whitespace(),g},this.RegisterExpressionOperators=()=>{this.RegisterBinaryOperator("&&",1),this.RegisterBinaryOperator("||",1),this.RegisterBinaryOperator("and",1,!0),this.RegisterBinaryOperator("or",1,!0),this.RegisterBinaryOperator("==",2),this.RegisterBinaryOperator(">=",2),this.RegisterBinaryOperator("<=",2),this.RegisterBinaryOperator("<",2),this.RegisterBinaryOperator(">",2),this.RegisterBinaryOperator("!=",2),this.RegisterBinaryOperator("?",3),this.RegisterBinaryOperator("has",3,!0),this.RegisterBinaryOperator("!?",3),this.RegisterBinaryOperator("hasnt",3,!0),this.RegisterBinaryOperator("^",3),this.RegisterBinaryOperator("+",4),this.RegisterBinaryOperator("-",5),this.RegisterBinaryOperator("*",6),this.RegisterBinaryOperator("/",7),this.RegisterBinaryOperator("%",8),this.RegisterBinaryOperator("mod",8,!0)},this.RegisterBinaryOperator=(g,x,k=!1)=>{const M=new A.InfixOperator(g,x,k);this._binaryOperators.push(M),this._maxBinaryOpLength=Math.max(this._maxBinaryOpLength,g.length)},this._openFilenames=[],this.IncludeStatement=()=>{if(this.Whitespace(),this.ParseString("INCLUDE")===null)return null;this.Whitespace();let g=this.Expect(()=>this.ParseUntilCharactersFromString(`
\r`),"filename for include statement");g=g.replace(new RegExp(/[ \t]+$/g),"");const x=this.fileHandler.ResolveInkFilename(g);if(this.FilenameIsAlreadyOpen(x))return this.Error(`Recursive INCLUDE detected: '${x}' is already open.`),this.ParseUntilCharactersFromString(`\r
`),new L.IncludedFile(null);this.AddOpenFilename(x);let k=null,M="";try{M=this._rootParser.fileHandler.LoadInkFileContents(x)}catch(ee){this.Error(`Failed to load: '${g}'.
Error:${ee}`)}return M&&(k=new ve(M,g,this._externalErrorHandler,this._rootParser,this.fileHandler).ParseStory()),this.RemoveOpenFilename(x),new L.IncludedFile(k)},this.FilenameIsAlreadyOpen=g=>this._rootParser._openFilenames.includes(g),this.AddOpenFilename=g=>{this._rootParser._openFilenames.push(g)},this.RemoveOpenFilename=g=>{this._rootParser._openFilenames.splice(this._rootParser._openFilenames.indexOf(g),1)},this.KnotDefinition=()=>{const g=this.Parse(this.KnotDeclaration);if(g===null)return null;this.Expect(this.EndOfLine,"end of line after knot name definition",this.SkipToNextLine);const x=()=>this.StatementsAtLevel(j.StatementLevel.Knot),k=this.Expect(x,"at least one line within the knot",this.KnotStitchNoContentRecoveryRule);return new $.Knot(g.name,k,g.args,g.isFunction)},this.KnotDeclaration=()=>{if(this.Whitespace(),this.KnotTitleEquals()===null)return null;this.Whitespace();const g=this.Parse(this.IdentifierWithMetadata);let x;const k=(g==null?void 0:g.name)==="function";k?(this.Expect(this.Whitespace,"whitespace after the 'function' keyword"),x=this.Parse(this.IdentifierWithMetadata)):x=g,x===null&&(this.Error(`Expected the name of the ${k?"function":"knot"}`),x=new hi.Identifier("")),this.Whitespace();const M=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),this.Parse(this.KnotTitleEquals),new y.FlowDecl(x,M,k)},this.KnotTitleEquals=()=>{const g=this.ParseCharactersFromString("=");return g===null||g.length<=1?null:g},this.StitchDefinition=()=>{const g=this.Parse(this.StitchDeclaration);if(g===null)return null;this.Expect(this.EndOfLine,"end of line after stitch name",this.SkipToNextLine);const x=()=>this.StatementsAtLevel(j.StatementLevel.Stitch),k=this.Expect(x,"at least one line within the stitch",this.KnotStitchNoContentRecoveryRule);return new D.Stitch(g.name,k,g.args,g.isFunction)},this.StitchDeclaration=()=>{if(this.Whitespace(),this.ParseString("=")===null||this.ParseString("=")!==null)return null;this.Whitespace();const g=this.ParseString("function")!==null;g&&this.Whitespace();const x=this.Parse(this.IdentifierWithMetadata);if(x===null)return null;this.Whitespace();const k=this.Parse(this.BracketedKnotDeclArguments);return this.Whitespace(),new y.FlowDecl(x,k,g)},this.KnotStitchNoContentRecoveryRule=()=>(this.ParseUntil(this.KnotDeclaration,new s.CharacterSet("="),null),[new le.Text("<ERROR IN FLOW>")]),this.BracketedKnotDeclArguments=()=>{if(this.ParseString("(")===null)return null;let g=this.Interleave(this.Spaced(this.FlowDeclArgument),this.Exclude(this.String(",")));return this.Expect(this.String(")"),"closing ')' for parameter list"),g===null&&(g=[]),g},this.FlowDeclArgument=()=>{const g=this.Parse(this.IdentifierWithMetadata);this.Whitespace();const x=this.ParseDivertArrow();this.Whitespace();const k=this.Parse(this.IdentifierWithMetadata);if(g==null&&k===null)return null;const M=new e.Argument;return x!==null&&(M.isDivertTarget=!0),g!==null&&g.name==="ref"?(k===null&&this.Error("Expected an parameter name after 'ref'"),M.identifier=k,M.isByReference=!0):(M.isDivertTarget?M.identifier=k:M.identifier=g,M.identifier===null&&this.Error("Expected an parameter name"),M.isByReference=!1),M},this.ExternalDeclaration=()=>{this.Whitespace();const g=this.Parse(this.IdentifierWithMetadata);if(g===null||g.name!="EXTERNAL")return null;this.Whitespace();const x=this.Expect(this.IdentifierWithMetadata,"name of external function")||new hi.Identifier("");this.Whitespace();let k=this.Expect(this.BracketedKnotDeclArguments,`declaration of arguments for EXTERNAL, even if empty, i.e. 'EXTERNAL ${x}()'`);k===null&&(k=[]);const M=k.map(ee=>{var K;return(K=ee.identifier)===null||K===void 0?void 0:K.name}).filter(Ft.filterUndef);return new p.ExternalDeclaration(x,M)},this._identifierCharSet=null,this.LogicLine=()=>{if(this.Whitespace(),this.ParseString("~")===null)return null;this.Whitespace();const g=()=>this.OneOf([this.ReturnStatement,this.TempDeclarationOrAssignment,this.Expression]);let x=this.Expect(g,"expression after '~'",this.SkipToNextLine);if(x===null)return new h.ContentList;x instanceof v.Expression&&!(x instanceof C.FunctionCall||x instanceof R.IncDecExpression)&&this.Error(`Logic following a '~' can't be that type of expression. It can only be something like:
	~ return
	~ var x = blah
	~ x++
	~ myFunction()`);const k=Ft.asOrNull(x,C.FunctionCall);return k&&(k.shouldPopReturnedValue=!0),x.Find(C.FunctionCall)()!==null&&(x=new h.ContentList(x,new le.Text(`
`))),this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),x},this.VariableDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="VAR")return null;this.Whitespace();const x=this.Expect(this.IdentifierWithMetadata,"variable name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const M=this.Expect(this.Expression,"initial value for ");return M?(M instanceof Vn.NumberExpression||M instanceof z.StringExpression||M instanceof w.DivertTarget||M instanceof ui.VariableReference||M instanceof U.List||this.Error("initial value for a variable must be a number, constant, list or divert target"),this.Parse(this.ListElementDefinitionSeparator)!==null?this.Error("Unexpected ','. If you're trying to declare a new list, use the LIST keyword, not VAR"):M instanceof z.StringExpression&&(M.isSingleString||this.Error("Constant strings cannot contain any logic.")),new Et.VariableAssignment({assignedExpression:M,isGlobalDeclaration:!0,variableIdentifier:x})):null},this.ListDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!="LIST")return null;this.Whitespace();const x=this.Expect(this.IdentifierWithMetadata,"list name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of the list definition"),this.Whitespace();const k=this.Expect(this.ListDefinition,"list item names");return k?(k.identifier=new hi.Identifier(x.name),new Et.VariableAssignment({variableIdentifier:x,listDef:k})):null},this.ListDefinition=()=>{this.AnyWhitespace();const g=this.SeparatedList(this.ListElementDefinition,this.ListElementDefinitionSeparator);return g===null?null:new X.ListDefinition(g)},this.ListElementDefinitionSeparator=()=>(this.AnyWhitespace(),this.ParseString(",")===null?null:(this.AnyWhitespace(),",")),this.ListElementDefinition=()=>{const g=this.ParseString("(")!==null;let x=g;this.Whitespace();const k=this.Parse(this.IdentifierWithMetadata);if(k===null)return null;this.Whitespace(),g&&this.ParseString(")")!=null&&(x=!1,this.Whitespace());let M=null;if(this.ParseString("=")!==null){this.Whitespace();const ee=this.Expect(this.ExpressionInt,"value to be assigned to list item");ee!==null&&(M=ee.value),x&&(this.Whitespace(),this.ParseString(")")!==null&&(x=!1))}return x&&this.Error("Expected closing ')'"),new H.ListElementDefinition(k,g,M)},this.ConstDeclaration=()=>{if(this.Whitespace(),this.Parse(this.Identifier)!=="CONST")return null;this.Whitespace();const x=this.Expect(this.IdentifierWithMetadata,"constant name");this.Whitespace(),this.Expect(this.String("="),"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)"),this.Whitespace();const k=this.Expect(this.Expression,"initial value for ");return k instanceof Vn.NumberExpression||k instanceof w.DivertTarget||k instanceof z.StringExpression?k instanceof z.StringExpression&&(k.isSingleString||this.Error("Constant strings cannot contain any logic.")):this.Error("initial value for a constant must be a number or divert target"),new c.ConstantDeclaration(x,k)},this.InlineLogicOrGlue=()=>this.OneOf([this.InlineLogic,this.Glue]),this.Glue=()=>this.ParseString("<>")!==null?new _.Glue(new O.Glue):null,this.InlineLogic=()=>{if(this.ParseString("{")===null)return null;this.Whitespace();const g=this.Expect(this.InnerLogic,"some kind of logic, conditional or sequence within braces: { ... }");if(g===null)return null;this.DisallowIncrement(g);let x=Ft.asOrNull(g,h.ContentList);return x||(x=new h.ContentList(g)),this.Whitespace(),this.Expect(this.String("}"),"closing brace '}' for inline logic"),x},this.InnerLogic=()=>{this.Whitespace();const g=this.ParseObject(this.SequenceTypeAnnotation);if(g!==null){const M=this.Expect(this.InnerSequenceObjects,"sequence elements (for cycle/stoping etc)");return M===null?null:new T.Sequence(M,g)}const x=this.Parse(this.ConditionExpression);if(x)return this.Expect(()=>this.InnerConditionalContent(x),"conditional content following query");const k=[this.InnerConditionalContent,this.InnerSequence,this.InnerExpression];for(const M of k){const ee=this.BeginRule(),K=this.ParseObject(M);if(K)if(this.Peek(this.Spaced(this.String("}")))===null)this.FailRule(ee);else return this.SucceedRule(ee,K);else this.FailRule(ee)}return null},this.InnerExpression=()=>{const g=this.Parse(this.Expression);return g&&(g.outputWhenComplete=!0),g},this.IdentifierWithMetadata=()=>{const g=this.Identifier();return g===null?null:new hi.Identifier(g)},this.Identifier=()=>{const g=this.ParseCharactersFromCharSet(this.identifierCharSet);if(g===null)return null;let x=!0;for(let k of g)if(!(k>="0"&&k<="9")){x=!1;break}return x?null:g},this._sequenceTypeSymbols=new s.CharacterSet("!&~$"),this.InnerSequence=()=>{this.Whitespace();let g=N.SequenceType.Stopping;const x=this.Parse(this.SequenceTypeAnnotation);x!==null&&(g=x);const k=this.Parse(this.InnerSequenceObjects);return k===null||k.length<=1?null:new T.Sequence(k,g)},this.SequenceTypeAnnotation=()=>{let g=this.Parse(this.SequenceTypeSymbolAnnotation);if(g===null&&(g=this.Parse(this.SequenceTypeWordAnnotation)),g===null)return null;switch(g){case N.SequenceType.Once:case N.SequenceType.Cycle:case N.SequenceType.Stopping:case N.SequenceType.Shuffle:case N.SequenceType.Shuffle|N.SequenceType.Stopping:case N.SequenceType.Shuffle|N.SequenceType.Once:break;default:return this.Error(`Sequence type combination not supported: ${g}`),N.SequenceType.Stopping}return g},this.SequenceTypeSymbolAnnotation=()=>{this._sequenceTypeSymbols===null&&(this._sequenceTypeSymbols=new s.CharacterSet("!&~$ "));let g=0;const x=this.ParseCharactersFromCharSet(this._sequenceTypeSymbols);if(x===null)return null;for(const k of x)switch(k){case"!":g|=N.SequenceType.Once;break;case"&":g|=N.SequenceType.Cycle;break;case"~":g|=N.SequenceType.Shuffle;break;case"$":g|=N.SequenceType.Stopping;break}return g===0?null:g},this.SequenceTypeWordAnnotation=()=>{const g=this.Interleave(this.SequenceTypeSingleWord,this.Exclude(this.Whitespace));if(g===null||g.length===0||this.ParseString(":")===null)return null;let x=0;for(const k of g)x|=k;return x},this.SequenceTypeSingleWord=()=>{let g=null;const x=this.Parse(this.IdentifierWithMetadata);if(x!==null)switch(x.name){case"once":g=N.SequenceType.Once;break;case"cycle":g=N.SequenceType.Cycle;break;case"shuffle":g=N.SequenceType.Shuffle;break;case"stopping":g=N.SequenceType.Stopping;break}return g===null?null:g},this.InnerSequenceObjects=()=>{const g=this.Parse(this.Newline)!==null;let x=null;return g?x=this.Parse(this.InnerMultilineSequenceObjects):x=this.Parse(this.InnerInlineSequenceObjects),x},this.InnerInlineSequenceObjects=()=>{const g=this.Interleave(this.Optional(this.MixedTextAndLogic),this.String("|"),null,!1);if(g===null)return null;const x=[];let k=!1;for(const M of g)if(M==="|")k||x.push(new h.ContentList),k=!1;else{const ee=M;ee===null?this.Error(`Expected content, but got ${M} (this is an ink compiler bug!)`):x.push(new h.ContentList(ee)),k=!0}return k||x.push(new h.ContentList),x},this.InnerMultilineSequenceObjects=()=>{this.MultilineWhitespace();const g=this.OneOrMore(this.SingleMultilineSequenceElement);return g===null?null:g},this.SingleMultilineSequenceElement=()=>{if(this.Whitespace(),this.ParseString("->")!==null||this.ParseString("-")===null)return null;this.Whitespace();const g=this.StatementsAtLevel(j.StatementLevel.InnerBlock);return g===null?this.MultilineWhitespace():g.unshift(new le.Text(`
`)),new h.ContentList(g)},this._statementRulesAtLevel=[],this._statementBreakRulesAtLevel=[],this.StatementsAtLevel=g=>(g===j.StatementLevel.InnerBlock&&this.Parse(this.GatherDashes)!==null&&this.Error("You can't use a gather (the dashes) within the { curly braces } context. For multi-line sequences and conditions, you should only use one dash."),this.Interleave(this.Optional(this.MultilineWhitespace),()=>this.StatementAtLevel(g),()=>this.StatementsBreakForLevel(g))),this.StatementAtLevel=g=>{const x=this._statementRulesAtLevel[g],k=this.OneOf(x);return g===j.StatementLevel.Top&&k instanceof P.ReturnType&&this.Error("should not have return statement outside of a knot"),k},this.StatementsBreakForLevel=g=>{this.Whitespace();const x=this._statementBreakRulesAtLevel[g],k=this.OneOf(x);return k===null?null:k},this.GenerateStatementLevelRules=()=>{const g=Object.values(j.StatementLevel);this._statementRulesAtLevel="f".repeat(g.length).split("f").map(()=>[]),this._statementBreakRulesAtLevel="f".repeat(g.length).split("f").map(()=>[]);for(const x of g){const k=[],M=[];k.push(this.Line(this.MultiDivert)),x>=j.StatementLevel.Top&&k.push(this.KnotDefinition),k.push(this.Line(this.Choice)),k.push(this.Line(this.AuthorWarning)),x>j.StatementLevel.InnerBlock&&k.push(this.Gather),x>=j.StatementLevel.Knot&&k.push(this.StitchDefinition),k.push(this.Line(this.ListDeclaration)),k.push(this.Line(this.VariableDeclaration)),k.push(this.Line(this.ConstDeclaration)),k.push(this.Line(this.ExternalDeclaration)),k.push(this.Line(this.IncludeStatement)),k.push(this.LogicLine),k.push(this.LineOfMixedTextAndLogic),x<=j.StatementLevel.Knot&&M.push(this.KnotDeclaration),x<=j.StatementLevel.Stitch&&M.push(this.StitchDeclaration),x<=j.StatementLevel.InnerBlock&&(M.push(this.ParseDashNotArrow),M.push(this.String("}"))),this._statementRulesAtLevel[x]=k,this._statementBreakRulesAtLevel[x]=M}},this.SkipToNextLine=()=>(this.ParseUntilCharactersFromString(`
\r`),this.ParseNewline(),se.ParseSuccess),this.Line=g=>()=>{const x=this.ParseObject(g);return x===null?null:(this.Expect(this.EndOfLine,"end of line",this.SkipToNextLine),x)},this._endOfTagCharSet=new s.CharacterSet(`#
\r\\`),this.Tag=()=>{if(this.Whitespace(),this.ParseString("#")===null)return null;this.Whitespace();let g="";do{if(g+=this.ParseUntilCharactersFromCharSet(this._endOfTagCharSet)||"",this.ParseString("\\")!==null){const M=this.ParseSingleCharacter();M!=="\0"&&(g+=M);continue}break}while(!0);const x=g.trim();return new ge.Tag(new Me.Tag(x))},this.Tags=()=>{const g=this.OneOrMore(this.Tag);return g===null?null:g},this._inlineWhitespaceChars=new s.CharacterSet(" 	"),this.EndOfLine=()=>this.OneOf([this.Newline,this.EndOfFile]),this.Newline=()=>(this.Whitespace(),this.ParseNewline()!==null?se.ParseSuccess:null),this.EndOfFile=()=>(this.Whitespace(),this.endOfInput?se.ParseSuccess:null),this.MultilineWhitespace=()=>{let g=this.OneOrMore(this.Newline);return g===null?null:g.length>=1?se.ParseSuccess:null},this.Whitespace=()=>this.ParseCharactersFromCharSet(this._inlineWhitespaceChars)!==null?se.ParseSuccess:null,this.Spaced=g=>()=>{this.Whitespace();const x=this.ParseObject(g);return x===null?null:(this.Whitespace(),x)},this.AnyWhitespace=()=>{let g=!1;for(;this.OneOf([this.Whitespace,this.MultilineWhitespace])!==null;)g=!0;return g?se.ParseSuccess:null},this.MultiSpaced=g=>()=>{this.AnyWhitespace();const x=this.ParseObject(g);return x===null?null:(this.AnyWhitespace(),x)},this.RegisterExpressionOperators(),this.GenerateStatementLevelRules(),this.errorHandler=this.OnStringParserError,$r===null){if(this._rootParser=this,this._openFilenames=[],this._filename!==null){const g=this.fileHandler.ResolveInkFilename(this._filename);this._openFilenames.push(g)}}else this._rootParser=$r}get fileHandler(){if(!this._fileHandler)throw new Error("No FileHandler defined");return this._fileHandler}set fileHandler(oe){this._fileHandler=oe}PreProcessInputString(oe){return new l.CommentEliminator(oe).Process()}get parsingStringExpression(){return this.GetFlag(Number(f.CustomFlags.ParsingString))}set parsingStringExpression(oe){this.SetFlag(Number(f.CustomFlags.ParsingString),oe)}get identifierCharSet(){return this._identifierCharSet===null&&((this._identifierCharSet=new s.CharacterSet).AddRange("A","Z").AddRange("a","z").AddRange("0","9").Add("_"),this.ExtendIdentifierCharacterRanges(this._identifierCharSet)),this._identifierCharSet}}n.InkParser=ve,ve.LatinBasic=r.CharacterRange.Define("A","z",new s.CharacterSet().AddRange("[","`")),ve.LatinExtendedA=r.CharacterRange.Define("\u0100","\u017F"),ve.LatinExtendedB=r.CharacterRange.Define("\u0180","\u024F"),ve.Greek=r.CharacterRange.Define("\u0370","\u03FF",new s.CharacterSet().AddRange("\u0378","\u0385").AddCharacters("\u0374\u0375\u0378\u0387\u038B\u038D\u03A2")),ve.Cyrillic=r.CharacterRange.Define("\u0400","\u04FF",new s.CharacterSet().AddRange("\u0482","\u0489")),ve.Armenian=r.CharacterRange.Define("\u0530","\u058F",new s.CharacterSet().AddCharacters("\u0530").AddRange("\u0557","\u0560").AddRange("\u0588","\u058E")),ve.Hebrew=r.CharacterRange.Define("\u0590","\u05FF",new s.CharacterSet),ve.Arabic=r.CharacterRange.Define("\u0600","\u06FF",new s.CharacterSet),ve.Korean=r.CharacterRange.Define("\uAC00","\uD7AF",new s.CharacterSet),ve.ListAllCharacterRanges=()=>[ve.LatinBasic,ve.LatinExtendedA,ve.LatinExtendedB,ve.Arabic,ve.Armenian,ve.Cyrillic,ve.Greek,ve.Hebrew,ve.Korean]})(yx);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Compiler=n.Story=n.InkList=n.CompilerOptions=void 0;const e=kl,t=Fh,i=Wm,r=yx,s=Ae,o=re;var l=kl;Object.defineProperty(n,"CompilerOptions",{enumerable:!0,get:function(){return l.CompilerOptions}});var a=Zl;Object.defineProperty(n,"InkList",{enumerable:!0,get:function(){return a.InkList}}),Object.defineProperty(n,"Story",{enumerable:!0,get:function(){return a.Story}});class u{constructor(c,f=null){this._errors=[],this._warnings=[],this._authorMessages=[],this._parsedStory=null,this._runtimeStory=null,this._parser=null,this._debugSourceRanges=[],this.Compile=()=>(this._parser=new r.InkParser(this.inputString,this.options.sourceFilename||null,this.OnError,null,this.options.fileHandler),this._parsedStory=this.parser.ParseStory(),this.errors.length===0?(this.parsedStory.countAllVisits=this.options.countAllVisits,this._runtimeStory=this.parsedStory.ExportRuntime(this.OnError)):this._runtimeStory=null,this.runtimeStory),this.RetrieveDebugSourceForLatestContent=()=>{var d;for(const m of this.runtimeStory.state.outputStream){const w=o.asOrNull(m,s.StringValue);if(w!==null){const v=new t.DebugSourceRange(((d=w.value)===null||d===void 0?void 0:d.length)||0,w.debugMetadata,w.value||"unknown");this.debugSourceRanges.push(v)}}},this.DebugMetadataForContentAtOffset=d=>{let m=0,w=null;for(const v of this.debugSourceRanges){if(v.debugMetadata!==null&&(w=v.debugMetadata),d>=m&&d<m+v.length)return w;m+=v.length}return null},this.OnError=(d,m)=>{switch(m){case i.ErrorType.Author:this._authorMessages.push(d);break;case i.ErrorType.Warning:this._warnings.push(d);break;case i.ErrorType.Error:this._errors.push(d);break}this.options.errorHandler!==null&&this.options.errorHandler(d,m)},this._inputString=c,this._options=f||new e.CompilerOptions}get errors(){return this._errors}get warnings(){return this._warnings}get authorMessages(){return this._authorMessages}get inputString(){return this._inputString}get options(){return this._options}get parsedStory(){if(!this._parsedStory)throw new Error;return this._parsedStory}get runtimeStory(){if(!this._runtimeStory)throw new Error("Compilation failed.");return this._runtimeStory}get parser(){if(!this._parser)throw new Error;return this._parser}get debugSourceRanges(){return this._debugSourceRanges}}n.Compiler=u})(sN);export{sN as C,BL as R,GL as a,HL as b,Rx as c,nN as j,$L as l,vt as r,bl as s,XA as u};
